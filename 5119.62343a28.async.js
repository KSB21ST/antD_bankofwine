(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[5119],{35099:function(It,ie,F){"use strict";var J=F(67294),Y=F(83280),g=F(23185),fe=F(4322),N=F(24770),oe=F(89182),ne=function(re,ke){var Ve={};for(var Ne in re)Object.prototype.hasOwnProperty.call(re,Ne)&&ke.indexOf(Ne)<0&&(Ve[Ne]=re[Ne]);if(re!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Je=0,Ne=Object.getOwnPropertySymbols(re);Je<Ne.length;Je++)ke.indexOf(Ne[Je])<0&&Object.prototype.propertyIsEnumerable.call(re,Ne[Je])&&(Ve[Ne[Je]]=re[Ne[Je]]);return Ve},we=(0,J.forwardRef)(function(re,ke){var Ve=re.chartRef,Ne=re.style,Je=Ne===void 0?{height:"inherit"}:Ne,Jt=re.className,_t=re.loading,Ut=re.loadingTemplate,Tt=re.errorTemplate,vt=ne(re,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),pt=(0,g.Z)(Y.aC,vt),Vt=pt.chart,ee=pt.container;return(0,J.useEffect)(function(){(0,fe.J)(Ve,Vt.current)},[Vt.current]),(0,J.useImperativeHandle)(ke,function(){return{getChart:function(){return Vt.current}}}),J.createElement(N.Z,{errorTemplate:Tt},_t&&J.createElement(oe.Z,{loadingTemplate:Ut,theme:re.theme}),J.createElement("div",{className:Jt,style:Je,ref:ee}))});ie.Z=we},65337:function(It,ie,F){"use strict";var J=F(67294),Y=F(83280),g=F(23185),fe=F(4322),N=F(24770),oe=F(89182),ne=function(re,ke){var Ve={};for(var Ne in re)Object.prototype.hasOwnProperty.call(re,Ne)&&ke.indexOf(Ne)<0&&(Ve[Ne]=re[Ne]);if(re!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Je=0,Ne=Object.getOwnPropertySymbols(re);Je<Ne.length;Je++)ke.indexOf(Ne[Je])<0&&Object.prototype.propertyIsEnumerable.call(re,Ne[Je])&&(Ve[Ne[Je]]=re[Ne[Je]]);return Ve},we=(0,J.forwardRef)(function(re,ke){var Ve=re.chartRef,Ne=re.style,Je=Ne===void 0?{height:"inherit"}:Ne,Jt=re.className,_t=re.loading,Ut=re.loadingTemplate,Tt=re.errorTemplate,vt=ne(re,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),pt=(0,g.Z)(Y.Kj,vt),Vt=pt.chart,ee=pt.container;return(0,J.useEffect)(function(){(0,fe.J)(Ve,Vt.current)},[Vt.current]),(0,J.useImperativeHandle)(ke,function(){return{getChart:function(){return Vt.current}}}),J.createElement(N.Z,{errorTemplate:Tt},_t&&J.createElement(oe.Z,{loadingTemplate:Ut,theme:re.theme}),J.createElement("div",{className:Jt,style:Je,ref:ee}))});ie.Z=we},90829:function(It,ie,F){"use strict";var J=F(67294),Y=F(83280),g=F(23185),fe=F(4322),N=F(24770),oe=F(89182),ne=function(re,ke){var Ve={};for(var Ne in re)Object.prototype.hasOwnProperty.call(re,Ne)&&ke.indexOf(Ne)<0&&(Ve[Ne]=re[Ne]);if(re!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Je=0,Ne=Object.getOwnPropertySymbols(re);Je<Ne.length;Je++)ke.indexOf(Ne[Je])<0&&Object.prototype.propertyIsEnumerable.call(re,Ne[Je])&&(Ve[Ne[Je]]=re[Ne[Je]]);return Ve},we=(0,J.forwardRef)(function(re,ke){var Ve=re.chartRef,Ne=re.style,Je=Ne===void 0?{height:"inherit"}:Ne,Jt=re.className,_t=re.loading,Ut=re.loadingTemplate,Tt=re.errorTemplate,vt=ne(re,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),pt=(0,g.Z)(Y.TZ,vt),Vt=pt.chart,ee=pt.container;return(0,J.useEffect)(function(){(0,fe.J)(Ve,Vt.current)},[Vt.current]),(0,J.useImperativeHandle)(ke,function(){return{getChart:function(){return Vt.current}}}),J.createElement(N.Z,{errorTemplate:Tt},_t&&J.createElement(oe.Z,{loadingTemplate:Ut,theme:re.theme}),J.createElement("div",{className:Jt,style:Je,ref:ee}))});ie.Z=we},93343:function(It,ie,F){"use strict";var J=F(67294),Y=F(83280),g=F(23185),fe=F(4322),N=F(24770),oe=F(89182),ne=function(re,ke){var Ve={};for(var Ne in re)Object.prototype.hasOwnProperty.call(re,Ne)&&ke.indexOf(Ne)<0&&(Ve[Ne]=re[Ne]);if(re!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Je=0,Ne=Object.getOwnPropertySymbols(re);Je<Ne.length;Je++)ke.indexOf(Ne[Je])<0&&Object.prototype.propertyIsEnumerable.call(re,Ne[Je])&&(Ve[Ne[Je]]=re[Ne[Je]]);return Ve},we=(0,J.forwardRef)(function(re,ke){var Ve=re.chartRef,Ne=re.style,Je=Ne===void 0?{height:"inherit"}:Ne,Jt=re.className,_t=re.loading,Ut=re.loadingTemplate,Tt=re.errorTemplate,vt=ne(re,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),pt=(0,g.Z)(Y.m,vt),Vt=pt.chart,ee=pt.container;return(0,J.useEffect)(function(){(0,fe.J)(Ve,Vt.current)},[Vt.current]),(0,J.useImperativeHandle)(ke,function(){return{getChart:function(){return Vt.current}}}),J.createElement(N.Z,{errorTemplate:Tt},_t&&J.createElement(oe.Z,{loadingTemplate:Ut,theme:re.theme}),J.createElement("div",{className:Jt,style:Je,ref:ee}))});ie.Z=we},92688:function(It,ie,F){"use strict";var J=F(67294),Y=F(83280),g=F(23185),fe=F(4322),N=F(24770),oe=F(89182),ne=function(re,ke){var Ve={};for(var Ne in re)Object.prototype.hasOwnProperty.call(re,Ne)&&ke.indexOf(Ne)<0&&(Ve[Ne]=re[Ne]);if(re!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Je=0,Ne=Object.getOwnPropertySymbols(re);Je<Ne.length;Je++)ke.indexOf(Ne[Je])<0&&Object.prototype.propertyIsEnumerable.call(re,Ne[Je])&&(Ve[Ne[Je]]=re[Ne[Je]]);return Ve},we=(0,J.forwardRef)(function(re,ke){var Ve=re.chartRef,Ne=re.style,Je=Ne===void 0?{height:"inherit"}:Ne,Jt=re.className,_t=re.loading,Ut=re.loadingTemplate,Tt=re.errorTemplate,vt=ne(re,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),pt=(0,g.Z)(Y.kB,vt),Vt=pt.chart,ee=pt.container;return(0,J.useEffect)(function(){(0,fe.J)(Ve,Vt.current)},[Vt.current]),(0,J.useImperativeHandle)(ke,function(){return{getChart:function(){return Vt.current}}}),J.createElement(N.Z,{errorTemplate:Tt},_t&&J.createElement(oe.Z,{loadingTemplate:Ut,theme:re.theme}),J.createElement("div",{className:Jt,style:Je,ref:ee}))});ie.Z=we},64335:function(It,ie,F){"use strict";var J=F(67294),Y=(0,J.createContext)({});ie.Z=Y},21349:function(It,ie,F){"use strict";var J=F(84305),Y=F(75901),g=F(85893),fe=F(94184),N=F.n(fe),oe=F(67294),ne=F(64335),we=F(53645),re=F.n(we),ke=function(Ne){var Je=(0,oe.useContext)(ne.Z),Jt=Ne.children,_t=Ne.contentWidth,Ut=Ne.className,Tt=Ne.style,vt=(0,oe.useContext)(Y.ZP.ConfigContext),pt=vt.getPrefixCls,Vt=Ne.prefixCls||pt("pro"),ee=_t||Je.contentWidth,rr="".concat(Vt,"-grid-content");return(0,g.jsx)("div",{className:N()(rr,Ut,{wide:ee==="Fixed"}),style:Tt,children:(0,g.jsx)("div",{className:"".concat(Vt,"-grid-content-children"),children:Jt})})};ie.Z=ke},46849:function(It,ie,F){(function(J,Y){Y(ie,F(3054))})(this,function(J,Y){"use strict";function g(V,X,k,Ce,et){var Qt=V*V,Oe=Qt*V;return((1-3*V+3*Qt-Oe)*X+(4-6*Qt+3*Oe)*k+(1+3*V+3*Qt-3*Oe)*Ce+Oe*et)/6}function fe(V){var X=V.length-1;return function(k){var Ce=k<=0?k=0:k>=1?(k=1,X-1):Math.floor(k*X),et=V[Ce],Qt=V[Ce+1],Oe=Ce>0?V[Ce-1]:2*et-Qt,$e=Ce<X-1?V[Ce+2]:2*Qt-et;return g((k-Ce/X)*X,Oe,et,Qt,$e)}}function N(V){var X=V.length;return function(k){var Ce=Math.floor(((k%=1)<0?++k:k)*X),et=V[(Ce+X-1)%X],Qt=V[Ce%X],Oe=V[(Ce+1)%X],$e=V[(Ce+2)%X];return g((k-Ce/X)*X,et,Qt,Oe,$e)}}function oe(V){return function(){return V}}function ne(V,X){return function(k){return V+k*X}}function we(V,X,k){return V=Math.pow(V,k),X=Math.pow(X,k)-V,k=1/k,function(Ce){return Math.pow(V+Ce*X,k)}}function re(V,X){var k=X-V;return k?ne(V,k>180||k<-180?k-360*Math.round(k/360):k):oe(isNaN(V)?X:V)}function ke(V){return(V=+V)==1?Ve:function(X,k){return k-X?we(X,k,V):oe(isNaN(X)?k:X)}}function Ve(V,X){var k=X-V;return k?ne(V,k):oe(isNaN(V)?X:V)}var Ne=function V(X){var k=ke(X);function Ce(et,Qt){var Oe=k((et=Y.rgb(et)).r,(Qt=Y.rgb(Qt)).r),$e=k(et.g,Qt.g),Ht=k(et.b,Qt.b),or=k(et.opacity,Qt.opacity);return function(pr){return et.r=Oe(pr),et.g=$e(pr),et.b=Ht(pr),et.opacity=or(pr),et+""}}return Ce.gamma=V,Ce}(1);function Je(V){return function(X){var k=X.length,Ce=new Array(k),et=new Array(k),Qt=new Array(k),Oe,$e;for(Oe=0;Oe<k;++Oe)$e=Y.rgb(X[Oe]),Ce[Oe]=$e.r||0,et[Oe]=$e.g||0,Qt[Oe]=$e.b||0;return Ce=V(Ce),et=V(et),Qt=V(Qt),$e.opacity=1,function(Ht){return $e.r=Ce(Ht),$e.g=et(Ht),$e.b=Qt(Ht),$e+""}}}var Jt=Je(fe),_t=Je(N);function Ut(V,X){var k=X?X.length:0,Ce=V?Math.min(k,V.length):0,et=new Array(k),Qt=new Array(k),Oe;for(Oe=0;Oe<Ce;++Oe)et[Oe]=nt(V[Oe],X[Oe]);for(;Oe<k;++Oe)Qt[Oe]=X[Oe];return function($e){for(Oe=0;Oe<Ce;++Oe)Qt[Oe]=et[Oe]($e);return Qt}}function Tt(V,X){return V=+V,X-=V,function(k){return V+X*k}}function vt(V,X){var k={},Ce={},et;(V===null||typeof V!="object")&&(V={}),(X===null||typeof X!="object")&&(X={});for(et in X)et in V?k[et]=nt(V[et],X[et]):Ce[et]=X[et];return function(Qt){for(et in k)Ce[et]=k[et](Qt);return Ce}}var pt=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Vt=new RegExp(pt.source,"g");function ee(V){return function(){return V}}function rr(V){return function(X){return V(X)+""}}function At(V,X){var k=pt.lastIndex=Vt.lastIndex=0,Ce,et,Qt,Oe=-1,$e=[],Ht=[];for(V=V+"",X=X+"";(Ce=pt.exec(V))&&(et=Vt.exec(X));)(Qt=et.index)>k&&(Qt=X.slice(k,Qt),$e[Oe]?$e[Oe]+=Qt:$e[++Oe]=Qt),(Ce=Ce[0])===(et=et[0])?$e[Oe]?$e[Oe]+=et:$e[++Oe]=et:($e[++Oe]=null,Ht.push({i:Oe,x:Tt(Ce,et)})),k=Vt.lastIndex;return k<X.length&&(Qt=X.slice(k),$e[Oe]?$e[Oe]+=Qt:$e[++Oe]=Qt),$e.length<2?Ht[0]?rr(Ht[0].x):ee(X):(X=Ht.length,function(or){for(var pr=0,xr;pr<X;++pr)$e[(xr=Ht[pr]).i]=xr.x(or);return $e.join("")})}function nt(V,X){var k=typeof X,Ce;return X==null||k==="boolean"?oe(X):(k==="number"?Tt:k==="string"?(Ce=Y.color(X))?(X=Ce,Ne):At:X instanceof Y.color?Ne:Array.isArray(X)?Ut:vt)(V,X)}function Zt(V,X){return V=+V,X-=V,function(k){return Math.round(V+X*k)}}var ut=180/Math.PI,nr={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Mr(V,X,k,Ce,et,Qt){var Oe,$e,Ht;return(Oe=Math.sqrt(V*V+X*X))&&(V/=Oe,X/=Oe),(Ht=V*k+X*Ce)&&(k-=V*Ht,Ce-=X*Ht),($e=Math.sqrt(k*k+Ce*Ce))&&(k/=$e,Ce/=$e,Ht/=$e),V*Ce<X*k&&(V=-V,X=-X,Ht=-Ht,Oe=-Oe),{translateX:et,translateY:Qt,rotate:Math.atan2(X,V)*ut,skewX:Math.atan(Ht)*ut,scaleX:Oe,scaleY:$e}}var q,pe,b,le;function xe(V){if(V==="none")return nr;q||(q=document.createElement("DIV"),pe=document.documentElement,b=document.defaultView),q.style.transform=V,V=b.getComputedStyle(pe.appendChild(q),null).getPropertyValue("transform"),pe.removeChild(q);var X=V.slice(7,-1).split(",");return Mr(+X[0],+X[1],+X[2],+X[3],+X[4],+X[5])}function Qe(V){le||(le=document.createElementNS("http://www.w3.org/2000/svg","g")),le.setAttribute("transform",V==null?"":V);var X=le.transform.baseVal.consolidate().matrix;return Mr(X.a,X.b,X.c,X.d,X.e,X.f)}function xt(V,X,k,Ce){function et(or){return or.length?or.pop()+" ":""}function Qt(or,pr,xr,Qr,en,Dr){if(or!==xr||pr!==Qr){var Wn=en.push("translate(",null,X,null,k);Dr.push({i:Wn-4,x:Tt(or,xr)},{i:Wn-2,x:Tt(pr,Qr)})}else(xr||Qr)&&en.push("translate("+xr+X+Qr+k)}function Oe(or,pr,xr,Qr){or!==pr?(or-pr>180?pr+=360:pr-or>180&&(or+=360),Qr.push({i:xr.push(et(xr)+"rotate(",null,Ce)-2,x:Tt(or,pr)})):pr&&xr.push(et(xr)+"rotate("+pr+Ce)}function $e(or,pr,xr,Qr){or!==pr?Qr.push({i:xr.push(et(xr)+"skewX(",null,Ce)-2,x:Tt(or,pr)}):pr&&xr.push(et(xr)+"skewX("+pr+Ce)}function Ht(or,pr,xr,Qr,en,Dr){if(or!==xr||pr!==Qr){var Wn=en.push(et(en)+"scale(",null,",",null,")");Dr.push({i:Wn-4,x:Tt(or,xr)},{i:Wn-2,x:Tt(pr,Qr)})}else(xr!==1||Qr!==1)&&en.push(et(en)+"scale("+xr+","+Qr+")")}return function(or,pr){var xr=[],Qr=[];return or=V(or),pr=V(pr),Qt(or.translateX,or.translateY,pr.translateX,pr.translateY,xr,Qr),Oe(or.rotate,pr.rotate,xr,Qr),$e(or.skewX,pr.skewX,xr,Qr),Ht(or.scaleX,or.scaleY,pr.scaleX,pr.scaleY,xr,Qr),or=pr=null,function(en){for(var Dr=-1,Wn=Qr.length,qn;++Dr<Wn;)xr[(qn=Qr[Dr]).i]=qn.x(en);return xr.join("")}}}var Bt=xt(xe,"px, ","px)","deg)"),Fe=xt(Qe,", ",")",")"),bt=Math.SQRT2,br=2,mr=4,An=1e-12;function mn(V){return((V=Math.exp(V))+1/V)/2}function wn(V){return((V=Math.exp(V))-1/V)/2}function Ri(V){return((V=Math.exp(2*V))-1)/(V+1)}function Qn(V,X){var k=V[0],Ce=V[1],et=V[2],Qt=X[0],Oe=X[1],$e=X[2],Ht=Qt-k,or=Oe-Ce,pr=Ht*Ht+or*or,xr,Qr;if(pr<An)Qr=Math.log($e/et)/bt,xr=function(na){return[k+na*Ht,Ce+na*or,et*Math.exp(bt*na*Qr)]};else{var en=Math.sqrt(pr),Dr=($e*$e-et*et+mr*pr)/(2*et*br*en),Wn=($e*$e-et*et-mr*pr)/(2*$e*br*en),qn=Math.log(Math.sqrt(Dr*Dr+1)-Dr),ta=Math.log(Math.sqrt(Wn*Wn+1)-Wn);Qr=(ta-qn)/bt,xr=function(na){var ba=na*Qr,ia=mn(qn),Ki=et/(br*en)*(ia*Ri(bt*ba+qn)-wn(qn));return[k+Ki*Ht,Ce+Ki*or,et*ia/mn(bt*ba+qn)]}}return xr.duration=Qr*1e3,xr}function ii(V){return function(X,k){var Ce=V((X=Y.hsl(X)).h,(k=Y.hsl(k)).h),et=Ve(X.s,k.s),Qt=Ve(X.l,k.l),Oe=Ve(X.opacity,k.opacity);return function($e){return X.h=Ce($e),X.s=et($e),X.l=Qt($e),X.opacity=Oe($e),X+""}}}var Vi=ii(re),Ni=ii(Ve);function ai(V,X){var k=Ve((V=Y.lab(V)).l,(X=Y.lab(X)).l),Ce=Ve(V.a,X.a),et=Ve(V.b,X.b),Qt=Ve(V.opacity,X.opacity);return function(Oe){return V.l=k(Oe),V.a=Ce(Oe),V.b=et(Oe),V.opacity=Qt(Oe),V+""}}function Vn(V){return function(X,k){var Ce=V((X=Y.hcl(X)).h,(k=Y.hcl(k)).h),et=Ve(X.c,k.c),Qt=Ve(X.l,k.l),Oe=Ve(X.opacity,k.opacity);return function($e){return X.h=Ce($e),X.c=et($e),X.l=Qt($e),X.opacity=Oe($e),X+""}}}var Yn=Vn(re),Li=Vn(Ve);function ra(V){return function X(k){k=+k;function Ce(et,Qt){var Oe=V((et=Y.cubehelix(et)).h,(Qt=Y.cubehelix(Qt)).h),$e=Ve(et.s,Qt.s),Ht=Ve(et.l,Qt.l),or=Ve(et.opacity,Qt.opacity);return function(pr){return et.h=Oe(pr),et.s=$e(pr),et.l=Ht(Math.pow(pr,k)),et.opacity=or(pr),et+""}}return Ce.gamma=X,Ce}(1)}var ri=ra(re),Et=ra(Ve);function de(V,X){for(var k=new Array(X),Ce=0;Ce<X;++Ce)k[Ce]=V(Ce/(X-1));return k}J.interpolate=nt,J.interpolateArray=Ut,J.interpolateBasis=fe,J.interpolateBasisClosed=N,J.interpolateNumber=Tt,J.interpolateObject=vt,J.interpolateRound=Zt,J.interpolateString=At,J.interpolateTransformCss=Bt,J.interpolateTransformSvg=Fe,J.interpolateZoom=Qn,J.interpolateRgb=Ne,J.interpolateRgbBasis=Jt,J.interpolateRgbBasisClosed=_t,J.interpolateHsl=Vi,J.interpolateHslLong=Ni,J.interpolateLab=ai,J.interpolateHcl=Yn,J.interpolateHclLong=Li,J.interpolateCubehelix=ri,J.interpolateCubehelixLong=Et,J.quantize=de,Object.defineProperty(J,"__esModule",{value:!0})})},7476:function(It,ie,F){"use strict";F.d(ie,{zP:function(){return G4},JE:function(){return t4},ns:function(){return V4}});var J={};F.r(J),F.d(J,{add:function(){return Ko},adjoint:function(){return st},clone:function(){return ze},copy:function(){return fr},create:function(){return Ls},determinant:function(){return Nt},equals:function(){return Ap},exactEquals:function(){return sd},frob:function(){return O0},fromQuat:function(){return wa},fromQuat2:function(){return Zn},fromRotation:function(){return Or},fromRotationTranslation:function(){return $r},fromRotationTranslationScale:function(){return On},fromRotationTranslationScaleOrigin:function(){return hi},fromScaling:function(){return Kt},fromTranslation:function(){return Ft},fromValues:function(){return Xt},fromXRotation:function(){return nn},fromYRotation:function(){return an},fromZRotation:function(){return xn},frustum:function(){return as},getRotation:function(){return Nn},getScaling:function(){return Bn},getTranslation:function(){return Cn},identity:function(){return qi},invert:function(){return ye},lookAt:function(){return Pu},mul:function(){return jh},multiply:function(){return Yt},multiplyScalar:function(){return uf},multiplyScalarAndAdd:function(){return od},ortho:function(){return Mu},orthoNO:function(){return Vu},orthoZO:function(){return Cp},perspective:function(){return fa},perspectiveFromFieldOfView:function(){return ks},perspectiveNO:function(){return La},perspectiveZO:function(){return Cl},rotate:function(){return Ct},rotateX:function(){return Pe},rotateY:function(){return tt},rotateZ:function(){return Be},scale:function(){return Xe},set:function(){return Pn},str:function(){return dh},sub:function(){return lf},subtract:function(){return Uh},targetTo:function(){return Cc},translate:function(){return ht},transpose:function(){return De}});var Y=F(67294),g=(0,Y.createContext)({});function fe(){return(0,Y.useContext)(g)}var N={},oe={},ne=function(i){return oe[i]},we=function(i,t){oe[i]=t},re=function(i){return N[i]},ke=function(i,t){N[i]=t},Ve={},Ne={},Je=34,Jt=10,_t=13;function Ut(e){return new Function("d","return {"+e.map(function(i,t){return JSON.stringify(i)+": d["+t+'] || ""'}).join(",")+"}")}function Tt(e,i){var t=Ut(e);return function(r,a){return i(t(r),a,e)}}function vt(e){var i=Object.create(null),t=[];return e.forEach(function(r){for(var a in r)a in i||t.push(i[a]=a)}),t}function pt(e,i){var t=e+"",r=t.length;return r<i?new Array(i-r+1).join(0)+t:t}function Vt(e){return e<0?"-"+pt(-e,6):e>9999?"+"+pt(e,6):pt(e,4)}function ee(e){var i=e.getUTCHours(),t=e.getUTCMinutes(),r=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Vt(e.getUTCFullYear(),4)+"-"+pt(e.getUTCMonth()+1,2)+"-"+pt(e.getUTCDate(),2)+(a?"T"+pt(i,2)+":"+pt(t,2)+":"+pt(r,2)+"."+pt(a,3)+"Z":r?"T"+pt(i,2)+":"+pt(t,2)+":"+pt(r,2)+"Z":t||i?"T"+pt(i,2)+":"+pt(t,2)+"Z":"")}function rr(e){var i=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function r(w,I){var L,U,K=a(w,function(ae,Ae){if(L)return L(ae,Ae-1);U=ae,L=I?Tt(ae,I):Ut(ae)});return K.columns=U||[],K}function a(w,I){var L=[],U=w.length,K=0,ae=0,Ae,Ge=U<=0,ot=!1;w.charCodeAt(U-1)===Jt&&--U,w.charCodeAt(U-1)===_t&&--U;function St(){if(Ge)return Ne;if(ot)return ot=!1,Ve;var Ot,er=K,_r;if(w.charCodeAt(er)===Je){for(;K++<U&&w.charCodeAt(K)!==Je||w.charCodeAt(++K)===Je;);return(Ot=K)>=U?Ge=!0:(_r=w.charCodeAt(K++))===Jt?ot=!0:_r===_t&&(ot=!0,w.charCodeAt(K)===Jt&&++K),w.slice(er+1,Ot-1).replace(/""/g,'"')}for(;K<U;){if((_r=w.charCodeAt(Ot=K++))===Jt)ot=!0;else if(_r===_t)ot=!0,w.charCodeAt(K)===Jt&&++K;else if(_r!==t)continue;return w.slice(er,Ot)}return Ge=!0,w.slice(er,U)}for(;(Ae=St())!==Ne;){for(var zt=[];Ae!==Ve&&Ae!==Ne;)zt.push(Ae),Ae=St();I&&(zt=I(zt,ae++))==null||L.push(zt)}return L}function s(w,I){return w.map(function(L){return I.map(function(U){return C(L[U])}).join(e)})}function l(w,I){return I==null&&(I=vt(w)),[I.map(C).join(e)].concat(s(w,I)).join(`
`)}function d(w,I){return I==null&&(I=vt(w)),s(w,I).join(`
`)}function m(w){return w.map(y).join(`
`)}function y(w){return w.map(C).join(e)}function C(w){return w==null?"":w instanceof Date?ee(w):i.test(w+="")?'"'+w.replace(/"/g,'""')+'"':w}return{parse:r,parseRows:a,format:l,formatBody:d,formatRows:m,formatRow:y,formatValue:C}}var At=rr(","),nt=At.parse,Zt=At.parseRows,ut=At.format,nr=At.formatBody,Mr=At.formatRows,q=At.formatRow,pe=At.formatValue,b=F(96156),le=F(85061),xe=F(38163),Qe=F.n(xe);function xt(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Bt(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?xt(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):xt(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function Fe(e,i){var t=i.x,r=i.y,a=i.x1,s=i.y1,l=i.coordinates,d=[];return Array.isArray(e)?(e.forEach(function(m,y){var C=[];if(t&&r&&(C=[parseFloat(m[t]),parseFloat(m[r])]),t&&r&&a&&s){var w=[parseFloat(m[t]),parseFloat(m[r])],I=[parseFloat(m[a]),parseFloat(m[s])];C=[w,I]}if(l){var L="Polygon";Array.isArray(l[0])||(L="Point"),Array.isArray(l[0])&&!Array.isArray(l[0][0])&&(L="LineString");var U={type:L,coordinates:(0,le.Z)(m[l])};Qe()(U,!0),C=U.coordinates}var K=Bt(Bt({},m),{},{_id:y,coordinates:C});d.push(K)}),{dataArray:d}):{dataArray:[]}}var bt=[{lng1:100,lat1:30,lng2:130,lat2:30}],br={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function mr(e,i){var t=nt(e);return Fe(t,i)}var An=63710088e-1,mn={centimeters:An*100,centimetres:An*100,degrees:An/111325,feet:An*3.28084,inches:An*39.37,kilometers:An/1e3,kilometres:An/1e3,meters:An,metres:An,miles:An/1609.344,millimeters:An*1e3,millimetres:An*1e3,nauticalmiles:An/1852,radians:1,yards:An*1.0936},wn={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/An,yards:1.0936133},Ri={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Qn(e,i,t){t===void 0&&(t={});var r={type:"Feature"};return(t.id===0||t.id)&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.properties=i||{},r.geometry=e,r}function ii(e,i,t){switch(t===void 0&&(t={}),e){case"Point":return Vi(i).geometry;case"LineString":return Yn(i).geometry;case"Polygon":return ai(i).geometry;case"MultiPoint":return Et(i).geometry;case"MultiLineString":return ri(i).geometry;case"MultiPolygon":return de(i).geometry;default:throw new Error(e+" is invalid")}}function Vi(e,i,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!pr(e[0])||!pr(e[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:e};return Qn(r,i,t)}function Ni(e,i,t){return t===void 0&&(t={}),ra(e.map(function(r){return Vi(r,i)}),t)}function ai(e,i,t){t===void 0&&(t={});for(var r=0,a=e;r<a.length;r++){var s=a[r];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<s[s.length-1].length;l++)if(s[s.length-1][l]!==s[0][l])throw new Error("First and last Position are not equivalent.")}var d={type:"Polygon",coordinates:e};return Qn(d,i,t)}function Vn(e,i,t){return t===void 0&&(t={}),ra(e.map(function(r){return ai(r,i)}),t)}function Yn(e,i,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:e};return Qn(r,i,t)}function Li(e,i,t){return t===void 0&&(t={}),ra(e.map(function(r){return Yn(r,i)}),t)}function ra(e,i){i===void 0&&(i={});var t={type:"FeatureCollection"};return i.id&&(t.id=i.id),i.bbox&&(t.bbox=i.bbox),t.features=e,t}function ri(e,i,t){t===void 0&&(t={});var r={type:"MultiLineString",coordinates:e};return Qn(r,i,t)}function Et(e,i,t){t===void 0&&(t={});var r={type:"MultiPoint",coordinates:e};return Qn(r,i,t)}function de(e,i,t){t===void 0&&(t={});var r={type:"MultiPolygon",coordinates:e};return Qn(r,i,t)}function V(e,i,t){t===void 0&&(t={});var r={type:"GeometryCollection",geometries:e};return Qn(r,i,t)}function X(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,i||0);return Math.round(e*t)/t}function k(e,i){i===void 0&&(i="kilometers");var t=mn[i];if(!t)throw new Error(i+" units is invalid");return e*t}function Ce(e,i){i===void 0&&(i="kilometers");var t=mn[i];if(!t)throw new Error(i+" units is invalid");return e/t}function et(e,i){return Oe(Ce(e,i))}function Qt(e){var i=e%360;return i<0&&(i+=360),i}function Oe(e){var i=e%(2*Math.PI);return i*180/Math.PI}function $e(e){var i=e%360;return i*Math.PI/180}function Ht(e,i,t){if(i===void 0&&(i="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return k(Ce(e,i),t)}function or(e,i,t){if(i===void 0&&(i="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var r=Ri[i];if(!r)throw new Error("invalid original units");var a=Ri[t];if(!a)throw new Error("invalid final units");return e/r*a}function pr(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function xr(e){return!!e&&e.constructor===Object}function Qr(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!pr(i))throw new Error("bbox must only contain numbers")})}function en(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Dr(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Wn(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function qn(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return qn(e[0]);throw new Error("coordinates must only contain numbers")}function ta(e,i,t){if(!i||!t)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+t+": must be a "+i+", given "+e.type)}function na(e,i,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+t+": must be a "+i+", given "+e.geometry.type)}function ba(e,i,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var r=0,a=e.features;r<a.length;r++){var s=a[r];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+t+": must be a "+i+", given "+s.geometry.type)}}function ia(e){return e.type==="Feature"?e.geometry:e}function Ki(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function $(e,i,t){if(e!==null)for(var r,a,s,l,d,m,y,C=0,w=0,I,L=e.type,U=L==="FeatureCollection",K=L==="Feature",ae=U?e.features.length:1,Ae=0;Ae<ae;Ae++){y=U?e.features[Ae].geometry:K?e.geometry:e,I=y?y.type==="GeometryCollection":!1,d=I?y.geometries.length:1;for(var Ge=0;Ge<d;Ge++){var ot=0,St=0;if(l=I?y.geometries[Ge]:y,l!==null){m=l.coordinates;var zt=l.type;switch(C=t&&(zt==="Polygon"||zt==="MultiPolygon")?1:0,zt){case null:break;case"Point":if(i(m,w,Ae,ot,St)===!1)return!1;w++,ot++;break;case"LineString":case"MultiPoint":for(r=0;r<m.length;r++){if(i(m[r],w,Ae,ot,St)===!1)return!1;w++,zt==="MultiPoint"&&ot++}zt==="LineString"&&ot++;break;case"Polygon":case"MultiLineString":for(r=0;r<m.length;r++){for(a=0;a<m[r].length-C;a++){if(i(m[r][a],w,Ae,ot,St)===!1)return!1;w++}zt==="MultiLineString"&&ot++,zt==="Polygon"&&St++}zt==="Polygon"&&ot++;break;case"MultiPolygon":for(r=0;r<m.length;r++){for(St=0,a=0;a<m[r].length;a++){for(s=0;s<m[r][a].length-C;s++){if(i(m[r][a][s],w,Ae,ot,St)===!1)return!1;w++}St++}ot++}break;case"GeometryCollection":for(r=0;r<l.geometries.length;r++)if($(l.geometries[r],i,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ue(e,i,t,r){var a=t;return $(e,function(s,l,d,m,y){l===0&&t===void 0?a=s:a=i(a,s,l,d,m,y)},r),a}function ve(e,i){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&i(e.features[t].properties,t)!==!1;t++);break;case"Feature":i(e.properties,0);break}}function Te(e,i,t){var r=t;return ve(e,function(a,s){s===0&&t===void 0?r=a:r=i(r,a,s)}),r}function Ze(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&i(e.features[t],t)!==!1;t++);}function it(e,i,t){var r=t;return Ze(e,function(a,s){s===0&&t===void 0?r=a:r=i(r,a,s)}),r}function gt(e){var i=[];return $(e,function(t){i.push(t)}),i}function be(e,i){var t,r,a,s,l,d,m,y,C,w,I=0,L=e.type==="FeatureCollection",U=e.type==="Feature",K=L?e.features.length:1;for(t=0;t<K;t++){for(d=L?e.features[t].geometry:U?e.geometry:e,y=L?e.features[t].properties:U?e.properties:{},C=L?e.features[t].bbox:U?e.bbox:void 0,w=L?e.features[t].id:U?e.id:void 0,m=d?d.type==="GeometryCollection":!1,l=m?d.geometries.length:1,a=0;a<l;a++){if(s=m?d.geometries[a]:d,s===null){if(i(null,I,y,C,w)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,I,y,C,w)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<s.geometries.length;r++)if(i(s.geometries[r],I,y,C,w)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}I++}}function Ye(e,i,t){var r=t;return be(e,function(a,s,l,d,m){s===0&&t===void 0?r=a:r=i(r,a,s,l,d,m)}),r}function jt(e,i){be(e,function(t,r,a,s,l){var d=t===null?null:t.type;switch(d){case null:case"Point":case"LineString":case"Polygon":return i(Qn(t,a,{bbox:s,id:l}),r,0)===!1?!1:void 0}var m;switch(d){case"MultiPoint":m="Point";break;case"MultiLineString":m="LineString";break;case"MultiPolygon":m="Polygon";break}for(var y=0;y<t.coordinates.length;y++){var C=t.coordinates[y],w={type:m,coordinates:C};if(i(Qn(w,a),r,y)===!1)return!1}})}function Ir(e,i,t){var r=t;return jt(e,function(a,s,l){s===0&&l===0&&t===void 0?r=a:r=i(r,a,s,l)}),r}function sr(e,i){jt(e,function(t,r,a){var s=0;if(!!t.geometry){var l=t.geometry.type;if(!(l==="Point"||l==="MultiPoint")){var d,m=0,y=0,C=0;if($(t,function(w,I,L,U,K){if(d===void 0||r>m||U>y||K>C){d=w,m=r,y=U,C=K,s=0;return}var ae=lineString([d,w],t.properties);if(i(ae,r,a,K,s)===!1)return!1;s++,d=w})===!1)return!1}}})}function cr(e,i,t){var r=t,a=!1;return sr(e,function(s,l,d,m,y){a===!1&&t===void 0?r=s:r=i(r,s,l,d,m,y),a=!0}),r}function Rr(e,i){if(!e)throw new Error("geojson is required");jt(e,function(t,r,a){if(t.geometry!==null){var s=t.geometry.type,l=t.geometry.coordinates;switch(s){case"LineString":if(i(t,r,a,0,0)===!1)return!1;break;case"Polygon":for(var d=0;d<l.length;d++)if(i(lineString(l[d],t.properties),r,a,d)===!1)return!1;break}}})}function zn(e,i,t){var r=t;return Rr(e,function(a,s,l,d){s===0&&t===void 0?r=a:r=i(r,a,s,l,d)}),r}function Tn(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var t=i.featureIndex||0,r=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,l=i.properties,d;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),l=l||e.features[t].properties,d=e.features[t].geometry;break;case"Feature":l=l||e.properties,d=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":d=e;break;default:throw new Error("geojson is invalid")}if(d===null)return null;var m=d.coordinates;switch(d.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=m.length+s-1),lineString([m[s],m[s+1]],l,i);case"Polygon":return a<0&&(a=m.length+a),s<0&&(s=m[a].length+s-1),lineString([m[a][s],m[a][s+1]],l,i);case"MultiLineString":return r<0&&(r=m.length+r),s<0&&(s=m[r].length+s-1),lineString([m[r][s],m[r][s+1]],l,i);case"MultiPolygon":return r<0&&(r=m.length+r),a<0&&(a=m[r].length+a),s<0&&(s=m[r][a].length-s-1),lineString([m[r][a][s],m[r][a][s+1]],l,i)}throw new Error("geojson is invalid")}function tr(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var t=i.featureIndex||0,r=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,l=i.properties,d;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),l=l||e.features[t].properties,d=e.features[t].geometry;break;case"Feature":l=l||e.properties,d=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":d=e;break;default:throw new Error("geojson is invalid")}if(d===null)return null;var m=d.coordinates;switch(d.type){case"Point":return point(m,l,i);case"MultiPoint":return r<0&&(r=m.length+r),point(m[r],l,i);case"LineString":return s<0&&(s=m.length+s),point(m[s],l,i);case"Polygon":return a<0&&(a=m.length+a),s<0&&(s=m[a].length+s),point(m[a][s],l,i);case"MultiLineString":return r<0&&(r=m.length+r),s<0&&(s=m[r].length+s),point(m[r][s],l,i);case"MultiPolygon":return r<0&&(r=m.length+r),a<0&&(a=m[r].length+a),s<0&&(s=m[r][a].length-s),point(m[r][a][s],l,i)}throw new Error("geojson is invalid")}function _n(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function rn(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?_n(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_n(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function cn(e){for(var i=e.toString(),t=5381,r=i.length;r;)t=t*33^i.charCodeAt(--r);return t>>>0}function wi(e,i){return i===void 0?null:i==="id"&&e.id?e.id:e[i]?e[i]:e.properties&&e.properties[i]?cn(e.properties[i]+"")%1000019:null}function gn(e,i){var t=[],r={};return e.features?(e.features=e.features.filter(function(a){var s=a.geometry;return a!=null&&s&&s.type&&s.coordinates&&s.coordinates.length>0}),Qe()(e,!0),e.features.length===0?{dataArray:[],featureKeys:r}:(jt(e,function(a,s){var l=wi(a,i==null?void 0:i.featureId);l===null&&(l=s);var d=l,m=Wn(a),y=rn(rn({},a.properties),{},{coordinates:m,_id:d});t.push(y)}),{dataArray:t,featureKeys:r})):(e.features=[],{dataArray:[]})}function zi(e){var i=131,t=137,r=0;e+="x";for(var a=Math.floor(9007199254740991/t),s=0;s<e.length;s++)r>a&&(r=Math.floor(r/t)),r=r*i+e.charCodeAt(s);return r}function ca(e){e=e.toString();for(var i=5381,t=e.length;t;)i=i*33^e.charCodeAt(--t);return i>>>0}var sn=F(28481),ki="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Pi(e){this.message=e}Pi.prototype=new Error,Pi.prototype.name="InvalidCharacterError";function vi(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new Pi("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",r=0,a,s,l=0;s=i.charAt(l++);~s&&(a=r%4?a*64+s:s,r++%4)?t+=String.fromCharCode(255&a>>(-2*r&6)):0)s=ki.indexOf(s);return t}function Ji(e){e=String(e);for(var i,t,r,a,s="",l=0,d=e.length%3;l<e.length;){if((t=e.charCodeAt(l++))>255||(r=e.charCodeAt(l++))>255||(a=e.charCodeAt(l++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=t<<16|r<<8|a,s+=ki.charAt(i>>18&63)+ki.charAt(i>>12&63)+ki.charAt(i>>6&63)+ki.charAt(i&63)}return d?s.slice(0,d-3)+"===".substring(d):s}var qt=F(6610),Gt=F(5991),ji=function(){function e(i,t){(0,qt.Z)(this,e),this.buffers=i,this.type=t}return(0,Gt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,r,a){throw new Error("not implemented")}}]),e}(),Hi,Pa=function(){return Hi||(Hi=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof F.g!="undefined"?F.g:{})};Hi=Pa();var so;typeof window=="undefined"?so={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,t,r){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:so=window;var Fa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ea=Fa?my.getSystemInfoSync().pixelRatio:so.devicePixelRatio,Wr=F(10379),Hr=F(46070),yt=F(77608),Bs=(0,Gt.Z)(function e(i,t){(0,qt.Z)(this,e),(0,b.Z)(this,"cancelBubble",void 0),(0,b.Z)(this,"cancelable",void 0),(0,b.Z)(this,"target",void 0),(0,b.Z)(this,"currentTarget",void 0),(0,b.Z)(this,"preventDefault",void 0),(0,b.Z)(this,"stopPropagation",void 0),(0,b.Z)(this,"type",void 0),(0,b.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),he=F(63349);function Na(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ya(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function Ya(e,i){if(!!e){if(typeof e=="string")return oa(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return oa(e,i)}}function oa(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}var uo=new WeakMap,Co=function(){function e(){(0,qt.Z)(this,e),uo.set(this,{})}return(0,Gt.Z)(e,[{key:"addEventListener",value:function(t,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=uo.get(this);s||(s={}),s[t]||(s[t]=[]),s[t].push(r),uo.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(t,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=uo.get(this);if(s){var l=s[t];if(l&&l.length>0){for(var d=l.length;d--;d>0)if(l[d]===r){l.splice(d,1);break}}}}},{key:"dispatchEvent",value:function(t){var r=uo.get(this)[t.type];if(r){var a=Na(r),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;l(t)}}catch(d){a.e(d)}finally{a.f()}}}}]),e}();function Ru(e){var i=yo();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function yo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ao=function(e){(0,Wr.Z)(t,e);var i=Ru(t);function t(){var r;return(0,qt.Z)(this,t),r=i.call(this),(0,b.Z)((0,he.Z)(r),"childNodes",void 0),r.childNodes=[],r}return(0,Gt.Z)(t,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(l){return l===a});return s>-1?this.childNodes.splice(s,1):null}}]),t}(Co);function da(e){var i=lo();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function lo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vo=function(e){(0,Wr.Z)(t,e);var i=da(t);function t(){var r;return(0,qt.Z)(this,t),r=i.call(this),(0,b.Z)((0,he.Z)(r),"className",void 0),(0,b.Z)((0,he.Z)(r),"children",void 0),r.className="",r.children=[],r}return(0,Gt.Z)(t,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),t}(Ao),co=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ns,ul,us,me;if(co){var Le=my.getSystemInfoSync();Ns=Le.screenWidth,ul=Le.screenHeight,us=Le.windowWidth,me=Le.windowHeight}else{var dt=so.innerWidth,ir=so.innerHeight;Ns=dt,ul=ir,us=dt,me=ir}var Vr={width:Ns,height:ul,availWidth:us,availHeight:me,availLeft:0,availTop:0},Un=Vr.availWidth,Bi=Vr.availHeight,qa={style:[]};function Oa(e,i){if(!("parentNode"in e)){var t;i===0?t=function(){return null}:i===1?t=function(){return qa}:t=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return qa}:r=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:r})}}function ja(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:Un+"px",height:Bi+"px",margin:"0px",padding:"0px"})}function Go(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=Un,e.clientHeight=Bi),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function ms(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=Un,e.offsetHeight=Bi)}function Ho(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=Un,e.scrollHeight=Bi)}function ls(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function gs(e){var i=ws();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function ws(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Qo(){}var cs=function(e){(0,Wr.Z)(t,e);var i=gs(t);function t(){var r,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,qt.Z)(this,t),r=i.call(this),(0,b.Z)((0,he.Z)(r),"className",void 0),(0,b.Z)((0,he.Z)(r),"children",void 0),(0,b.Z)((0,he.Z)(r),"focus",void 0),(0,b.Z)((0,he.Z)(r),"blur",void 0),(0,b.Z)((0,he.Z)(r),"insertBefore",void 0),(0,b.Z)((0,he.Z)(r),"appendChild",void 0),(0,b.Z)((0,he.Z)(r),"removeChild",void 0),(0,b.Z)((0,he.Z)(r),"remove",void 0),(0,b.Z)((0,he.Z)(r),"innerHTML",void 0),(0,b.Z)((0,he.Z)(r),"tagName",void 0),r.className="",r.children=[],r.focus=Qo,r.blur=Qo,r.insertBefore=Qo,r.appendChild=Qo,r.removeChild=Qo,r.remove=Qo,r.innerHTML="",r.tagName=a.toUpperCase(),Oa((0,he.Z)(r),s),ja((0,he.Z)(r)),ls((0,he.Z)(r)),Go((0,he.Z)(r)),ms((0,he.Z)(r)),Ho((0,he.Z)(r)),r}return(0,Gt.Z)(t)}(Vo);function ys(e){var i=Sa();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function Sa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _o=function(e){(0,Wr.Z)(t,e);var i=ys(t);function t(r){return(0,qt.Z)(this,t),i.call(this,r)}return(0,Gt.Z)(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(cs);function ec(e){var i=kc();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function kc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yu=function(e){(0,Wr.Z)(t,e);var i=ec(t);function t(){return(0,qt.Z)(this,t),i.call(this,"video")}return(0,Gt.Z)(t)}(_o),fs={},Jo={};function Ol(e,i){fs=e,fs.id=i,"tagName"in fs||(fs.tagName="CANVAS"),fs.type="canvas",Mixin.parentNode(fs),Mixin.style(fs),Mixin.classList(fs),Mixin.clientRegion(fs),Mixin.offsetRegion(fs),fs.focus=function(){},fs.blur=function(){}}function bu(e,i){var t=1024,r=1024;Jo={width:t,height:r,clientWidth:t/devicePixelRatio,clientHeight:r/devicePixelRatio,id:i,type:"canvas"},"tagName"in Jo||(Jo.tagName="CANVAS"),Mixin.parentNode(Jo),Mixin.style(Jo),Mixin.classList(Jo),Mixin.clientRegion(Jo),Mixin.offsetRegion(Jo),Jo.getContext=function(a){if(a==="2d")return e},Jo.focus=function(){},Jo.blur=function(){}}function Ts(){return fs}function x(){return Jo}var M=(0,Gt.Z)(function e(){(0,qt.Z)(this,e);var i=Ts(),t=i.createImage&&i.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=e.prototype),Oa(t),ls(t),Object.assign(t,{addEventListener:function(a,s){t["on".concat(a)]=s.bind(t)},removeEventListener:function(a){t["on".concat(a)]=null}}),t}),z={href:"",protocol:"",host:""};function R(e){var i=se();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function se(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ie=function(e){(0,Wr.Z)(t,e);var i=R(t);function t(){return(0,qt.Z)(this,t),i.call(this,"body",0)}return(0,Gt.Z)(t,[{key:"addEventListener",value:function(a,s){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,l){}},{key:"dispatchEvent",value:function(a){}}]),t}(cs),ct=function(e){(0,Wr.Z)(t,e);var i=R(t);function t(){return(0,qt.Z)(this,t),i.call(this,"html",0)}return(0,Gt.Z)(t,[{key:"addEventListener",value:function(a,s){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),t}(cs),Dt={},Rt={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:z,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new M:i==="video"?new Yu:new cs(i)},createElementNS:function(i,t){return this.createElement(t)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,t){return this.getElementsByTagName(t)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,t,r){Dt[i]||(Dt[i]=[]),Dt[i].push(t)},removeEventListener:function(i,t){var r=Dt[i];if(r&&r.length>0){for(var a=r.length;a--;a>0)if(r[a]===t){r.splice(a,1);break}}},dispatchEvent:function(i){var t=i.type,r=Dt[t];if(r)for(var a=0;a<r.length;a++)r[a](i);i.target&&typeof i.target["on"+t]=="function"&&i.target["on"+t](i)},createEvent:function(i){return new Bs(i)}};Rt.documentElement=new ct,Rt.head=new cs("head"),Rt.body=new Ie;var wr=Object,Br=F(90484),Xn=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"_w",void 0),(0,b.Z)(this,"_h",void 0),(0,b.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,Br.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Gt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),bi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ci,Ei,ua;if(bi){var Ca=my.getSystemInfoSync();ci=Ca.system,Ei=Ca.platform,ua=Ca.language}else{var Si={versions:function(){var e=so.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(so.navigator.browserLanguage||so.navigator.language).toLowerCase()};Si.versions.android?Ei="android":Si.versions.trident?Ei="IE":Si.versions.presto?Ei="Opera":Si.versions.webKit?Ei="webKit":Si.versions.gecko?Ei="Firefox":Si.versions.mobile?Ei="mobile":Si.versions.ios?Ei="ios":Si.versions.iPhone?Ei="iPhone":Si.versions.iPad?Ei="ipad":Si.versions.webApp?Ei="webApp":Si.versions.weixin?Ei="weixin":Si.versions.qq&&(Ei="qq"),ci=so.navigator.userAgent,ua=Si.language}var _s=ci.toLowerCase().indexOf("android")!==-1,uu=_s?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",ll="Mozilla/5.0 (".concat(uu,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(ua),mf={platform:Ei,language:ua,appVersion:"5.0 (".concat(uu,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:ll},cl={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,t,r){return{duration:0}},now:function(){}},tc=0,Eu=0;function Lu(e){var i=Date.now(),t=Math.max(tc+23,i);return Eu=setTimeout(function(){e(tc=t)},t-i),Eu}function ku(e){var i=Ts();return i.requestAnimationFrame?i.requestAnimationFrame(e):Lu(e)}function fo(e){var i=Ts();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var $f=function(){function e(i){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,qt.Z)(this,e),(0,b.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=t+i}return(0,Gt.Z)(e,null,[{key:"createObjectURL",value:function(t){var r=t.buffers[0],a=t.type,s=Qf(r),l="data:".concat(a,";base64, ");return l+s}}]),e}();function Qf(e){for(var i="",t=new Uint8Array(e),r=t.byteLength,a=0;a<r;a++)i+=String.fromCharCode(t[a]);return Ji(i)}var xs={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},gf={};function Du(e){var i=Ks();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function Ks(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rc=new Map,qu=new Map,Aa=new Map,nc={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Oh(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Il(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Oh.call(this,"readystatechange",i)}var zs=function(e){(0,Wr.Z)(t,e);var i=Du(t);function t(){var r;return(0,qt.Z)(this,t),r=i.call(this),(0,b.Z)((0,he.Z)(r),"onabort",void 0),(0,b.Z)((0,he.Z)(r),"onerror",void 0),(0,b.Z)((0,he.Z)(r),"onload",void 0),(0,b.Z)((0,he.Z)(r),"onloadstart",void 0),(0,b.Z)((0,he.Z)(r),"onprogress",void 0),(0,b.Z)((0,he.Z)(r),"ontimeout",void 0),(0,b.Z)((0,he.Z)(r),"onloadend",void 0),(0,b.Z)((0,he.Z)(r),"onreadystatechange",void 0),(0,b.Z)((0,he.Z)(r),"readyState",void 0),(0,b.Z)((0,he.Z)(r),"response",void 0),(0,b.Z)((0,he.Z)(r),"responseText",void 0),(0,b.Z)((0,he.Z)(r),"_responseType",void 0),(0,b.Z)((0,he.Z)(r),"responseXML",void 0),(0,b.Z)((0,he.Z)(r),"status",void 0),(0,b.Z)((0,he.Z)(r),"statusText",void 0),(0,b.Z)((0,he.Z)(r),"upload",void 0),(0,b.Z)((0,he.Z)(r),"withCredentials",void 0),(0,b.Z)((0,he.Z)(r),"timeout",void 0),(0,b.Z)((0,he.Z)(r),"_url",void 0),(0,b.Z)((0,he.Z)(r),"_method",void 0),r.onabort=null,r.onerror=null,r.onload=null,r.onloadstart=null,r.onprogress=null,r.ontimeout=null,r.onloadend=null,r.onreadystatechange=null,r.readyState=0,r.response=null,r.responseText=null,r._responseType="text",r.responseXML=null,r.status=0,r.statusText="",r.upload={},r.withCredentials=!1,rc.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),r}return(0,Gt.Z)(t,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=Aa.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=qu.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return qu.get("responseHeader")[a]}},{key:"open",value:function(a,s,l){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var l=rc.get("requestHeader");l[a]=s,rc.set("requestHeader",l)}},{key:"addEventListener",value:function(a,s){var l=this;typeof s=="function"&&(this["on"+a]=function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};d.target=d.target||l,s.call(l,d)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),t}(Co);(0,b.Z)(zs,"UNSEND",void 0),(0,b.Z)(zs,"OPENED",void 0),(0,b.Z)(zs,"HEADERS_RECEIVED",void 0),(0,b.Z)(zs,"LOADING",void 0),(0,b.Z)(zs,"DONE",void 0),zs.UNSEND=0,zs.OPENED=1,zs.HEADERS_RECEIVED=2,zs.LOADING=3,zs.DONE=4;function up(e){var i=Ih();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function Ih(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yf=function(e){(0,Wr.Z)(t,e);var i=up(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this,r),(0,b.Z)((0,he.Z)(a),"touches",void 0),(0,b.Z)((0,he.Z)(a),"targetTouches",void 0),(0,b.Z)((0,he.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=Ts(),a.currentTarget=Ts(),a}return(0,Gt.Z)(t)}(Bs);function fl(e){var i=e||{},t=i.x,r=t===void 0?0:t,a=i.y,s=a===void 0?0:a,l=i.clientX,d=l===void 0?0:l,m=i.clientY,y=m===void 0?0:m;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=r,e.pageY=e.clientY=s):(e.x=d,e.y=y)}function Ku(e){return function(i){var t=new yf(e);t.changedTouches=i.changedTouches,t.touches=i.touches,t.targetTouches=Array.prototype.slice.call(i.touches),t.timeStamp=i.timeStamp,t.changedTouches.forEach(function(r){return fl(r)}),t.touches.forEach(function(r){return fl(r)}),t.targetTouches.forEach(function(r){return fl(r)}),Rt.dispatchEvent(t)}}function Rl(e){return function(i){i.type=e,Rt.dispatchEvent(i)}}var ic=Ku("touchstart"),Ll=Ku("touchmove"),ac=Ku("touchend"),kl=Rl("mapCameaParams");function $s(e){var i=_f();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function _f(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xf=function(e){(0,Wr.Z)(t,e);var i=$s(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this,r),(0,b.Z)((0,he.Z)(a),"buttons",void 0),(0,b.Z)((0,he.Z)(a),"which",void 0),(0,b.Z)((0,he.Z)(a),"pointerId",void 0),(0,b.Z)((0,he.Z)(a),"bubbles",void 0),(0,b.Z)((0,he.Z)(a),"button",void 0),(0,b.Z)((0,he.Z)(a),"width",void 0),(0,b.Z)((0,he.Z)(a),"height",void 0),(0,b.Z)((0,he.Z)(a),"pressure",void 0),(0,b.Z)((0,he.Z)(a),"isPrimary",void 0),(0,b.Z)((0,he.Z)(a),"pointerType",void 0),(0,b.Z)((0,he.Z)(a),"altKey",void 0),(0,b.Z)((0,he.Z)(a),"ctrlKey",void 0),(0,b.Z)((0,he.Z)(a),"metaKey",void 0),(0,b.Z)((0,he.Z)(a),"shiftKey",void 0),a.target=Ts(),a.currentTarget=Ts(),a}return(0,Gt.Z)(t)}(Bs),bf=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],hl=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],oc="touch";function Dc(e,i,t){for(var r=new xf(e),a=0;a<bf.length;a++){var s=bf[a];r[s]=i[s]||hl[a]}return r.type=e,r.target=Ts(),r.currentTarget=Ts(),r.buttons=Ef(e),r.which=r.buttons,r.pointerId=(i.identifier||0)+2,r.bubbles=!0,r.cancelable=!0,r.button=0,r.width=(i.radiusX||.5)*2,r.height=(i.radiusY||.5)*2,r.pressure=i.force||.5,r.isPrimary=Rh(i),r.pointerType=oc,r.altKey=t.altKey,r.ctrlKey=t.ctrlKey,r.metaKey=t.metaKey,r.shiftKey=t.shiftKey,t.preventDefault&&(r.preventDefault=function(){t.preventDefault()}),r}function Ef(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var $u=null;function Rh(e){return $u===e.identifier}function Fc(e){$u===null&&($u=e.identifier)}function pl(e){$u===e.identifier&&($u=null)}function sc(e){return function(i){for(var t=i.changedTouches,r=0;r<t.length;r++){var a=t[r];r===0&&e==="pointerdown"?Fc(a):(e==="pointerup"||e==="pointercancel")&&pl(a);var s=Dc(e,a,i);Rt.dispatchEvent(s)}}}var Jf=sc("pointerdown"),Dl=sc("pointermove"),Lh=sc("pointerup");function eh(e){var i=th();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function th(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uc=function(e){(0,Wr.Z)(t,e);var i=eh(t);function t(r){return(0,qt.Z)(this,t),i.call(this,r)}return(0,Gt.Z)(t)}(Bs);function Sf(e){return function(i){i.type=e,Rt.dispatchEvent(i)}}var lc=Sf("mousedown"),Ka=Sf("mousemove"),Bc=Sf("mouseup"),Fl=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Fu=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ci=Fl||Fu,Ia={atob:vi,btoa:Ji,devicePixelRatio:Ea,Blob:ji,document:Rt,Element:Vo,Event:Bs,EventTarget:Co,HTMLCanvasElement:wr,HTMLElement:cs,HTMLMediaElement:_o,HTMLVideoElement:Yu,Image:M,ImageData:Xn,navigator:mf,Node:Ao,requestAnimationFrame:ku,cancelAnimationFrame:fo,screen:Vr,XMLHttpRequest:zs,performance:cl,URL:$f,WebGLRenderingContext:xs,WebGL2RenderingContext:gf,addEventListener:function(i,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Rt.addEventListener(i,t,r)},removeEventListener:function(i,t,r){Rt.removeEventListener(i,t)},dispatchEvent:function(i){Rt.dispatchEvent(i)},innerWidth:Vr.availWidth,innerHeight:Vr.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Gi=Ci?Ia:so,Nc=Ci?zs:so.XMLHttpRequest,dl=Ci?z:so.location;function zc(e){var i=e;return typeof e=="string"&&(i=Gi.document.getElementById(e)),i}function kh(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function lp(e){return kh(e).split(/\s+/)}function Zc(e){var i,t,r=Gi==null||(i=Gi.document)===null||i===void 0||(t=i.documentElement)===null||t===void 0?void 0:t.style;if(!r)return e[0];for(var a in e)if(e[a]&&e[a]in r)return e[a];return e[0]}function za(e,i,t){var r=Gi.document.createElement(e);return r.className=i||"",t&&t.appendChild(r),r}function Zs(e){var i=e.parentNode;i&&i.removeChild(e)}function Va(e,i){if(e.classList!==void 0)for(var t=lp(i),r=0,a=t.length;r<a;r++)e.classList.add(t[r]);else if(!cc(e,i)){var s=Mn(e);go(e,(s?s+" ":"")+i)}}function Bu(e,i){e.classList!==void 0?e.classList.remove(i):go(e,kh((" "+Mn(e)+" ").replace(" "+i+" "," ")))}function cc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var t=Mn(e);return t.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(t)}function go(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function Mn(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function $a(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Qu=Zc(["transform","WebkitTransform"]);function vl(e,i){e.style[Qu]=i}function lu(){if(typeof Event=="function")Gi.dispatchEvent(new Event("resize"));else{var e=Gi.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Gi,0),Gi.dispatchEvent(e)}}function Us(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Cf(){var e,i=Gi.document.querySelector('meta[name="viewport"]');if(!i)return 1;var t=(e=i.content)===null||e===void 0?void 0:e.split(","),r=t.find(function(a){var s=a.split("="),l=(0,sn.Z)(s,2),d=l[0],m=l[1];return d==="initial-scale"});return r?r.split("=")[1]*1:1}var Nr=Cf()<1?1:Gi.devicePixelRatio;function Af(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],t=1;t<e.length;t++)e[t]>i&&(i=e[t]);return i*1}function wf(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],t=1;t<e.length;t++)e[t]<i&&(i=e[t]);return i*1}function Ju(e){if(e.length===0)return 0;for(var i=e[0]*1,t=1;t<e.length;t++)i+=e[t]*1;return i}function Ba(e){if(e.length===0)throw new Error("mean requires at least one data point");return Ju(e)/e.length}function Ms(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],t=NaN,r=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>r&&(r=a,t=i),a=1,i=e[s]):a++;return t*1}var Bl={min:wf,max:Af,mean:Ba,sum:Ju,mode:Ms};function cu(e,i){return e.map(function(t){return t[i]})}function Ps(e,i){return Bl[e](i)}var Ta=F(92137),rh=F(14665);function Uc(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var nh=F(51814);function fc(e,i,t){return(0,nh.Z)()?fc=Reflect.construct.bind():fc=function(a,s,l){var d=[null];d.push.apply(d,s);var m=Function.bind.apply(a,d),y=new m;return l&&(0,rh.Z)(y,l.prototype),y},fc.apply(null,arguments)}function Os(e){var i=typeof Map=="function"?new Map:void 0;return Os=function(r){if(r===null||!Uc(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(r))return i.get(r);i.set(r,a)}function a(){return fc(r,arguments,(0,yt.Z)(this).constructor)}return a.prototype=Object.create(r.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,rh.Z)(a,r)},Os(e)}var js=F(87757),Sn=F.n(js);function Su(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function fu(){return typeof importScripts=="function"}var es=fu()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href};function el(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Qs(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?el(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):el(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function Vs(e){var i=bs();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function bs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Js=function(e){(0,Wr.Z)(t,e);var i=Vs(t);function t(r,a,s,l){var d;return(0,qt.Z)(this,t),d=i.call(this,"AJAXError: ".concat(a," (").concat(r,"): ").concat(s)),(0,b.Z)((0,he.Z)(d),"status",void 0),(0,b.Z)((0,he.Z)(d),"statusText",void 0),(0,b.Z)((0,he.Z)(d),"url",void 0),(0,b.Z)((0,he.Z)(d),"body",void 0),d.status=r,d.statusText=a,d.url=s,d.body=l,d}return(0,Gt.Z)(t)}(Os(Error));function Kn(e,i){var t=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:getReferrer(),signal:e==null?void 0:e.signal});return e.type==="json"&&t.headers.set("Accept","application/json"),fetch(t).then(function(r){return r.ok?(e.type==="arrayBuffer"?r.arrayBuffer():e.type==="json"?r.json():r.text()).then(function(a){i(null,a,r.headers.get("Cache-Control"),r.headers.get("Expires"))}).catch(function(a){i(new Error(a.message))}):r.blob().then(function(a){return i(new Js(r.status,r.statusText,e.url,a))})}).catch(function(r){i(new Error(r.message))})}function jn(e,i){var t=new Nc;t.open(e.method||"GET",e.url,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var r in e.headers)e.headers.hasOwnProperty(r)&&t.setRequestHeader(r,e.headers[r]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){i(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var a=t.response;if(e.type==="json")try{a=JSON.parse(t.response)}catch(l){return i(l)}i(null,a,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"))}else{var s=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});i(new Js(t.status,t.statusText,e.url,s))}},t.send(e.body),t}function Nl(e,i){return jn(e,i)}var Es=function(i,t){return Nl(Qs(Qs({},i),{},{type:"json"}),t)},Gs=function(i,t){return Nl(Qs(Qs({},i),{},{type:"arrayBuffer"}),t)},ts=function(i,t){return Nl(Qs(Qs({},i),{},{method:"POST"}),t)};function Nu(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var jc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Vc(e,i){var t=new Gi.Image,r=Gi.URL||Gi.webkitURL;t.crossOrigin="anonymous",t.onload=function(){i(null,t),r.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=jc})},t.onerror=function(){return i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var a=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?r.createObjectURL(a):jc}function va(e,i){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(r){i(null,r)}).catch(function(r){i(new Error("Could not load image because of ".concat(r.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Ma=function(i,t){return Gs(i,function(r,a){if(r)t(r);else if(a){var s=typeof createImageBitmap=="function";s?va(a,t):Vc(a,t)}})},ih=function(){var e=(0,Ta.Z)(Sn().mark(function i(t,r,a){var s,l,d,m,y,C;return Sn().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.prev=0,I.next=3,a(t);case 3:s=I.sent,l=s.rasterData,d=s.width,m=s.height,y=0,C=8e3,r(null,{data:l,width:d,height:m,min:y,max:C}),I.next=15;break;case 12:I.prev=12,I.t0=I.catch(0),r(null,new Error(""+I.t0));case 15:case"end":return I.stop()}},i,null,[[0,12]])}));return function(t,r,a){return e.apply(this,arguments)}}(),zl=function(i,t,r){return Gs(i,function(a,s){a?t(a):s&&ih(s,t,r)})},Hs=2*Math.PI*6378137/2;function Cu(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(t){var r=t.coordinates;wo(i,r)}),i}function wo(e,i){return Array.isArray(i[0])?i.forEach(function(t){wo(e,t)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function ml(e,i){return hu(e,i)}function hu(e,i){return Array.isArray(e[0])?e.map(function(t){return hu(t,i)}):i(e)}function Zl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=dc(e,i);var r=e[0],a=e[1],s=r*Hs/180,l=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return l=l*Hs/180,t.enable&&(s=Number(s.toFixed(t.decimal)),l=Number(l.toFixed(t.decimal))),e.length===3?[s,l,e[2]]:[s,l]}function hc(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],r=e[1],a=t/Hs*180,s=r/Hs*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function pc(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Tf(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function dc(e,i){if(i===!1)return e;var t=pc(e[0]),r=Tf(e[1]);return r>85&&(r=85),r<-85&&(r=-85),e.length===3?[t,r,e[2]]:[t,r]}function Ss(e){var i=85.0511287798,t=Math.max(Math.min(i,e[1]),-i),r=256<<20,a=Math.PI/180,s=e[0]*a,l=t*a;l=Math.log(Math.tan(Math.PI/4+l/2));var d=.5/Math.PI,m=.5,y=-.5/Math.PI;return a=.5,s=r*(d*s+m),l=r*(y*l+a),[Math.floor(s),Math.floor(l)]}function Dh(e){var i=.5/Math.PI,t=.5,r=-.5/Math.PI,a=.5,s=256<<20,l=_slicedToArray(e,2),d=l[0],m=l[1];d=(d/s-t)/i,m=(m/s-a)/r,m=(Math.atan(Math.pow(Math.E,m))-Math.PI/4)*2,a=Math.PI/180;var y=m/a,C=d/a;return[C,y]}function Ul(e,i){var t=85.0511287798,r=Math.PI/180,a=6378137;return i=Math.max(Math.min(t,i),-t),e*=r,i*=r,i=Math.log(Math.tan(Math.PI/4+i/2)),[e*a,i*a]}function gl(e,i,t){var r=$e(i[1]-e[1]),a=$e(i[0]-e[0]),s=$e(e[1]),l=$e(i[1]),d=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(l);return k(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),t="meters")}function ah(e){var i=Math.PI/180,t=85.0511287798,r=6378137,a=Math.max(Math.min(t,e[1]),-t),s=Math.sin(a*i),l=r*e[0]*i,d=r*Math.log((1+s)/(1-s))/2;return[l,d]}function pu(e,i){var t=Math.abs(e[1][1]-e[0][1])*i,r=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-r,e[0][1]-t],[e[1][0]+r,e[1][1]+t]]}function Is(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function jl(e){return[[e[0],e[1]],[e[2],e[3]]]}function vc(e){var i=Mf(e,[0,0]);return[e[0]/i,e[1]/i]}function Mf(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function mc(e,i){return e[0]*i[0]+e[1]*i[1]}function c(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function h(e,i){return Math.acos(mc(e,i)/(c(e)*c(i)))*180/Math.PI}function f(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function v(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],r=0,a=[],s=0;s<e.length-1;s++){var l=e[s],d=e[s+1],m=Mf(l,d);r+=m;var y=[l[0]-d[0],l[1]-d[1]],C=f(t,y);if(s>0){var w=a[s-1].rotation;w-C>360-w+C&&(C=C+360)}a.push({start:l,end:d,dis:m,rotation:C,duration:0})}return a.map(function(I){I.duration=i*(I.dis/r)}),a}}var S=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,qt.Z)(this,e),(0,b.Z)(this,"limit",void 0),(0,b.Z)(this,"cache",void 0),(0,b.Z)(this,"destroy",void 0),(0,b.Z)(this,"order",void 0),this.limit=i,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,Gt.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(r){t.delete(r)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var r=this.cache[t];return r&&(this.deleteOrder(t),this.appendOrder(t)),r}},{key:"set",value:function(t,r){this.cache[t]?(this.delete(t),this.cache[t]=r,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=r,this.appendOrder(t))}},{key:"delete",value:function(t){var r=this.cache[t];r&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(r,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var r=this.order.findIndex(function(a){return a===t});r>=0&&this.order.splice(r,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,r){return null}}]),e}();function T(e,i){e.forEach(function(t){!i[t]||(i[t]=i[t].bind(i))})}var P=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,qt.Z)(this,e),(0,b.Z)(this,"duration",16),(0,b.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,Gt.Z)(e,[{key:"run",value:function(t){var r=new Date().getTime(),a=r-this.timestamp;this.timestamp=r,a>=this.duration&&t()}}]),e}(),D=F(16372);function G(e){return typeof e=="string"?!!D.ZP(e):!1}function Q(e){var i=D.ZP(e),t=[0,0,0,0];return i!=null&&(t[0]=i.r/255,t[1]=i.g/255,t[2]=i.b/255,t[3]=i.opacity),t}function ge(e){var i=e&&e[0],t=e&&e[1],r=e&&e[2],a=i+t*256+r*65536-1;return a}function Ee(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Se(e){var i=Gi.document.createElement("canvas"),t=i.getContext("2d");i.width=256,i.height=1;for(var r=t.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],l=e.positions[e.positions.length-1],d=0;d<e.colors.length;++d){var m=(e.positions[d]-s)/(l-s);r.addColorStop(m,e.colors[d])}if(t.fillStyle=r,t.fillRect(0,0,256,1),Ci)return a=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=t.getImageData(0,0,256,1).data;for(var y=t.createImageData(256,1),C=0;C<y.data.length;C+=4)y.data[C+0]=a[C+0],y.data[C+1]=a[C+1],y.data[C+2]=a[C+2],y.data[C+3]=a[C+3];return y}var We;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(We||(We={}));var je={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function lt(e,i,t){var r=e.classList;for(var a in je)je.hasOwnProperty(a)&&r.remove("l7-".concat(t,"-anchor-").concat(a));r.add("l7-".concat(t,"-anchor-").concat(i))}function Re(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var at={BACK:1029,FRONT:1028};function mt(e){switch(e){case"GAODE1.x":return at.BACK;case"GAODE2.x":return at.BACK;case"MAPBOX":return at.FRONT;case"SIMPLE":return at.FRONT;case"GLOBEL":return at.BACK;case"L7MAP":return at.FRONT;default:return at.FRONT}}function Wt(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function vr(e,i){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=i.x,r=i.y,a=i.z;if(Array.isArray(e)){var s=Math.abs(t+r)%e.length;e=e[s]}return e.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,a.toString()).replace(/\{-y\}/g,(Math.pow(2,a)-r-1).toString())}var ur;(function(e){e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace"})(ur||(ur={}));var hr;(function(e){e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled"})(hr||(hr={}));function Lr(e,i){i===void 0&&(i={});var t=Number(e[0]),r=Number(e[1]),a=Number(e[2]),s=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var l=[t,r],d=[t,s],m=[a,s],y=[a,r];return ai([[l,y,m,d,l]],i.properties,{bbox:e,id:i.id})}var Jr=0,Yr=1,yn=2;function Jn(e){e.forEach(function(i){i.isCurrent&&(i.isVisible=i.isLoaded)})}function ei(e){e.forEach(function(i){i.properties.state=Jr}),e.forEach(function(i){i.isCurrent&&!Wi(i)&&bn(i)}),e.forEach(function(i){i.isVisible=Boolean(i.properties.state&yn)})}function ni(e){e.forEach(function(t){t.properties.state=Jr}),e.forEach(function(t){t.isCurrent&&Wi(t)});var i=e.slice().sort(function(t,r){return t.z-r.z});i.forEach(function(t){t.isVisible=Boolean(t.properties.state&yn),t.children.length&&(t.isVisible||t.properties.state&Yr)?t.children.forEach(function(r){r.properties.state=Yr}):t.isCurrent&&bn(t)})}function Wi(e){for(;e;){if(e.isLoaded)return e.properties.state|=yn,!0;e=e.parent}return!1}function bn(e){e.children.forEach(function(i){i.isLoaded?i.properties.state|=yn:bn(i)})}var pi,Ti=256,mi=[-Infinity,-Infinity,Infinity,Infinity],ui=.2,Oi=5,fi=(pi={},(0,b.Z)(pi,ur.Realtime,Jn),(0,b.Z)(pi,ur.Overlap,ei),(0,b.Z)(pi,ur.Replace,ni),pi),li=function(){};function ho(e,i,t){var r=Math.floor((e+180)/360*Math.pow(2,t)),a=Math.floor((1-Math.log(Math.tan(i*Math.PI/180)+1/Math.cos(i*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[r,a]}function Ga(e,i,t){var r=e/Math.pow(2,t)*360-180,a=Math.PI-2*Math.PI*i/Math.pow(2,t),s=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[r,s]}var Ro=function(i,t,r){var a=Ga(i,t,r),s=(0,sn.Z)(a,2),l=s[0],d=s[1],m=Ga(i+1,t+1,r),y=(0,sn.Z)(m,2),C=y[0],w=y[1];return[l,w,C,d]};function Lo(e){var i=e.zoom,t=e.latLonBounds,r=e.maxZoom,a=r===void 0?Infinity:r,s=e.minZoom,l=s===void 0?0:s,d=e.zoomOffset,m=d===void 0?0:d,y=e.extent,C=y===void 0?mi:y,w=Math.ceil(i)+m;if(Number.isFinite(l)&&w<l)return[];Number.isFinite(a)&&w>a&&(w=a);for(var I=(0,sn.Z)(t,4),L=I[0],U=I[1],K=I[2],ae=I[3],Ae=[Math.max(L,C[0]),Math.max(U,C[1]),Math.min(K,C[2]),Math.min(ae,C[3])],Ge=[],ot=ho(Ae[0],Ae[1],w),St=(0,sn.Z)(ot,2),zt=St[0],Ot=St[1],er=ho(Ae[2],Ae[3],w),_r=(0,sn.Z)(er,2),kr=_r[0],Kr=_r[1],Pr=zt;Pr<=kr;Pr++)for(var ln=Kr;ln<=Ot;ln++)Ge.push({x:Pr,y:ln,z:w});var kn=(kr+zt)/2,Hn=(Ot+Kr)/2,xa=function(Io,Ds){return Math.abs(Io-kn)+Math.abs(Ds-Hn)};return Ge.sort(function(Ua,Io){return xa(Ua.x,Ua.y)-xa(Io.x,Io.y)}),Ge}var Qa=function(i,t,r){var a=Math.pow(2,r),s=a-1,l=a,d=i,m=t;return d<0?d=d+l:d>s&&(d=d%l),{warpX:d,warpY:m}},po=function(){function e(i){(0,qt.Z)(this,e),(0,b.Z)(this,"x",void 0),(0,b.Z)(this,"y",void 0),(0,b.Z)(this,"z",void 0),(0,b.Z)(this,"tileSize",256),(0,b.Z)(this,"isVisible",!1),(0,b.Z)(this,"isCurrent",!1),(0,b.Z)(this,"isVisibleChange",!1),(0,b.Z)(this,"parentLayerIDList",[]),(0,b.Z)(this,"layerIDList",[]),(0,b.Z)(this,"parent",null),(0,b.Z)(this,"children",[]),(0,b.Z)(this,"data",null),(0,b.Z)(this,"properties",{}),(0,b.Z)(this,"xhrCancel",void 0),(0,b.Z)(this,"loadStatus",void 0),(0,b.Z)(this,"abortController",void 0),(0,b.Z)(this,"loadDataId",0);var t=i.x,r=i.y,a=i.z,s=i.tileSize;this.x=t,this.y=r,this.z=a,this.tileSize=s}return(0,Gt.Z)(e,[{key:"isLoading",get:function(){return this.loadStatus===hr.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===hr.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===hr.Failure}},{key:"isCancelled",get:function(){return this.loadStatus===hr.Cancelled}},{key:"isDone",get:function(){return[hr.Loaded,hr.Cancelled,hr.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Ro(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,sn.Z)(this.bounds,4),r=t[0],a=t[1],s=t[2],l=t[3],d=[(s-r)/2,(l-a)/2],m=Lr(this.bounds,{properties:{key:this.key,bbox:this.bounds,center:d,meta:`
      `.concat(this.key,`
      `)}});return m}},{key:"key",get:function(){var t="".concat(this.x,",").concat(this.y,",").concat(this.z);return t}},{key:"loadData",value:function(){var i=(0,Ta.Z)(Sn().mark(function r(a){var s,l,d,m,y,C,w,I,L,U,K,ae,Ae,Ge,ot,St;return Sn().wrap(function(Ot){for(;;)switch(Ot.prev=Ot.next){case 0:return s=a.getData,l=a.onLoad,d=a.onError,this.loadDataId++,m=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=hr.Loading,y=null,Ot.prev=7,w=this.x,I=this.y,L=this.z,U=this.bounds,K=this.tileSize,ae=Qa(w,I,L),Ae=ae.warpX,Ge=ae.warpY,ot=this.abortController.signal,St={x:Ae,y:Ge,z:L,bounds:U,tileSize:K,signal:ot},Ot.next=14,s(St,this);case 14:y=Ot.sent,Ot.next=20;break;case 17:Ot.prev=17,Ot.t0=Ot.catch(7),C=Ot.t0;case 20:if(m===this.loadDataId){Ot.next=22;break}return Ot.abrupt("return");case 22:if(!(this.isCancelled&&!y)){Ot.next=24;break}return Ot.abrupt("return");case 24:if(!(C||!y)){Ot.next=28;break}return this.loadStatus=hr.Failure,d(C,this),Ot.abrupt("return");case 28:this.loadStatus=hr.Loaded,this.data=y,l(this);case 31:case"end":return Ot.stop()}},r,this,[[7,17]])}));function t(r){return i.apply(this,arguments)}return t}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=hr.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),e}(),Ja=F(26729),Wo=F.n(Ja),zu=function(i,t){var r=jl(i),a=pu(r,t),s=360*3-180,l=85.0511287798065,d=[Math.max(a[0][0],-s),Math.max(a[0][1],-l),Math.min(a[1][0],s),Math.min(a[1][1],l)];return d},hs=function(i,t){var r=jl(i),a=jl(t),s=Is(r,a);return s};function Xo(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=eu(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function eu(e,i){if(!!e){if(typeof e=="string")return Vl(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Vl(e,i)}}function Vl(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function yl(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function du(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?yl(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):yl(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function Gl(e){var i=gc();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function gc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vu=function(e){(0,Wr.Z)(t,e);var i=Gl(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this),(0,b.Z)((0,he.Z)(a),"currentTiles",[]),(0,b.Z)((0,he.Z)(a),"options",void 0),(0,b.Z)((0,he.Z)(a),"cacheTiles",new Map),(0,b.Z)((0,he.Z)(a),"lastViewStates",void 0),(0,b.Z)((0,he.Z)(a),"onTileLoad",function(s){a.emit("tile-loaded",s),a.updateTileVisible()}),(0,b.Z)((0,he.Z)(a),"onTileError",function(s,l){a.emit("tile-error",{error:s,tile:l}),a.updateTileVisible()}),(0,b.Z)((0,he.Z)(a),"onTileUnload",function(s){a.emit("tile-unload",s)}),a.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:mi,getTileData:li,updateStrategy:ur.Replace},a.updateOptions(r),a}return(0,Gt.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(a){return a.isDone})}},{key:"tiles",get:function(){var a=Array.from(this.cacheTiles.values()).sort(function(s,l){return s.z-l.z});return a}},{key:"updateOptions",value:function(a){var s=a.minZoom===void 0?this.options.minZoom:Math.ceil(a.minZoom),l=a.maxZoom===void 0?this.options.maxZoom:Math.floor(a.maxZoom);this.options=du(du(du({},this.options),a),{},{minZoom:s,maxZoom:l})}},{key:"update",value:function(a,s){var l=this,d=Math.ceil(a);if(!(this.lastViewStates&&this.lastViewStates.zoom===d&&hs(this.lastViewStates.latLonBoundsBuffer,s))){var m=zu(s,ui);this.lastViewStates={zoom:d,latLonBounds:s,latLonBoundsBuffer:m};var y=!1,C=this.getTileIndices(d,m);this.currentTiles=C.map(function(w){var I=w.x,L=w.y,U=w.z,K=l.getTile(I,L,U);if(K){var ae,Ae,Ge=((ae=K)===null||ae===void 0?void 0:ae.isFailure)||((Ae=K)===null||Ae===void 0?void 0:Ae.isCancelled);return Ge&&K.loadData({getData:l.options.getTileData,onLoad:l.onTileLoad,onError:l.onTileError}),K}return K=l.createTile(I,L,U),y=!0,K}),y&&(this.resizeCacheTiles(),this.rebuildTileTree()),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var a=Xo(this.cacheTiles),s;try{for(a.s();!(s=a.n()).done;){var l=(0,sn.Z)(s.value,2),d=l[0],m=l[1];this.currentTiles.includes(m)||(this.cacheTiles.delete(d),this.onTileUnload(m)),this.onTileUnload(m),m.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(y){a.e(y)}finally{a.f()}}},{key:"pruneRequests",value:function(){var a=[],s=Xo(this.cacheTiles.values()),l;try{for(s.s();!(l=s.n()).done;){var d=l.value;d.isLoading&&!d.isCurrent&&!d.isVisible&&a.push(d)}}catch(y){s.e(y)}finally{s.f()}for(;a.length>0;){var m=a.shift();m.abortLoad()}}},{key:"destroy",value:function(){var a=Xo(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;l.isLoading&&l.abortLoad()}}catch(d){a.e(d)}finally{a.f()}this.cacheTiles.clear(),this.currentTiles=[],this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var a=this.options.updateStrategy,s=new Map,l=Xo(this.cacheTiles.values()),d;try{for(l.s();!(d=l.n()).done;){var m=d.value;s.set(m.key,m.isVisible),m.isCurrent=!1,m.isVisible=!1}}catch(U){l.e(U)}finally{l.f()}var y=Xo(this.currentTiles),C;try{for(y.s();!(C=y.n()).done;){var w=C.value;w.isCurrent=!0,w.isVisible=!0}}catch(U){y.e(U)}finally{y.f()}var I=Array.from(this.cacheTiles.values());typeof a=="function"?a(I):fi[a](I);var L=!1;Array.from(this.cacheTiles.values()).forEach(function(U){U.isVisible!==s.get(U.key)?(U.isVisibleChange=!0,L=!0):U.isVisibleChange=!1}),L&&this.emit("tile-update")}},{key:"getTileIndices",value:function(a,s){var l=this.options,d=l.tileSize,m=l.extent,y=l.zoomOffset,C=Math.floor(this.options.maxZoom),w=Math.ceil(this.options.minZoom),I=Lo({maxZoom:C,minZoom:w,zoomOffset:y,tileSize:d,zoom:a,latLonBounds:s,extent:m});return I}},{key:"getTileId",value:function(a,s,l){var d="".concat(a,",").concat(s,",").concat(l);return d}},{key:"getTile",value:function(a,s,l){var d=this.getTileId(a,s,l),m=this.cacheTiles.get(d);return m}},{key:"createTile",value:function(a,s,l){var d=this.getTileId(a,s,l),m=new po({x:a,y:s,z:l,tileSize:this.options.tileSize});return this.cacheTiles.set(d,m),m.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),m}},{key:"resizeCacheTiles",value:function(){var a=Oi*this.currentTiles.length,s=this.cacheTiles.size>a;if(s){var l=Xo(this.cacheTiles),d;try{for(l.s();!(d=l.n()).done;){var m=(0,sn.Z)(d.value,2),y=m[0],C=m[1];if(!C.isVisible&&!this.currentTiles.includes(C)&&(this.cacheTiles.delete(y),this.onTileUnload(C)),this.cacheTiles.size<=a)break}}catch(w){l.e(w)}finally{l.f()}}}},{key:"rebuildTileTree",value:function(){var a=Xo(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;l.parent=null,l.children.length=0}}catch(w){a.e(w)}finally{a.f()}var d=Xo(this.cacheTiles.values()),m;try{for(d.s();!(m=d.n()).done;){var y=m.value,C=this.getNearestAncestor(y.x,y.y,y.z);y.parent=C,C!=null&&C.children&&C.children.push(y)}}catch(w){d.e(w)}finally{d.f()}}},{key:"getNearestAncestor",value:function(a,s,l){for(;l>this.options.minZoom;){a=Math.floor(a/2),s=Math.floor(s/2),l=l-1;var d=this.getTile(a,s,l);if(d)return d}return null}}]),t}(Wo());function _l(e,i){var t=i.extent,r=t===void 0?[121.168,30.2828,121.384,30.4219]:t,a=new Promise(function(l){e instanceof HTMLImageElement||Su(e)?l([e]):Au(e,function(d){l(d)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return s}function Au(e,i){var t=e,r=[];if(typeof t=="string")Ma({url:t},function(l,d){d&&(r.push(d),i(r))});else{var a=t.length,s=0;t.forEach(function(l){Ma({url:l},function(d,m){s++,m&&r.push(m),s===a&&i(r)})})}return _l}var xo=F(38929),Zu=F(3614),tl=F.n(Zu);function Uu(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function aa(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Uu(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Uu(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var Ws={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},rs=512;function rl(e,i,t){var r=e/Math.pow(2,t)*360-180,a=Math.PI-2*Math.PI*i/Math.pow(2,t),s=180/Math.PI*Math.atan(.5*(Math.exp(a)-Math.exp(-a)));return[r,s]}function Gc(e){for(var i=0,t=0,r=e.length,a=r-1,s,l;t<r;a=t++)s=e[t],l=e[a],i+=(l.x-s.x)*(s.y+l.y);return i}function Hc(e){var i=e.length;if(i<=1)return[e];for(var t=[],r,a,s=0;s<i;s++){var l=Gc(e[s]);l!==0&&(a===void 0&&(a=l<0),a===l<0?(r&&t.push(r),r=[e[s]]):r.push(e[s]))}return r&&t.push(r),t}var Pf=["Unknown","Point","LineString","Polygon"];function tu(e,i){var t=i.extent,r=i.loadGeometry(),a=i.type,s=i.properties,l=i.id,d=t*Math.pow(2,e),m=Pf[a],y,C;function w(U){for(var K=0;K<U.length;K++){var ae=U[K];U[K]=[ae.x/d*rs,ae.y/d*rs]}}switch(a){case 1:var I=[];for(y=0;y<r.length;y++)I[y]=r[y][0];r=I,w(r);break;case 2:for(y=0;y<r.length;y++)w(r[y]);break;case 3:for(r=Hc(r),y=0;y<r.length;y++)for(C=0;C<r[y].length;C++)w(r[y][C]);break}r.length===1?r=r[0]:m="Multi"+m;var L={type:"Feature",geometry:{type:m,coordinates:r},properties:s,id:l,tileOrigin:[0,0],coord:""};return L}var yc=function(){var e=(0,Ta.Z)(Sn().mark(function i(t,r,a,s){var l;return Sn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return l=vr(t,r),m.abrupt("return",new Promise(function(y){var C=Gs({url:l},function(w,I){if(w||!I)y({layers:{}});else{for(var L=new xo.VectorTile(new(tl())(I)),U=rl(r.x,r.y,r.z),K=r.z,ae=0,Ae=Object.keys(L.layers);ae<Ae.length;ae++){for(var Ge=Ae[ae],ot=[],St=L.layers[Ge],zt=0;zt<L.layers[Ge].length;zt++){var Ot=L.layers[Ge].feature(zt),er=void 0;s==="lnglat"?er=Ot.toGeoJSON(r.x,r.y,r.z):(er=tu(K,Ot),St.l7TileOrigin=U,St.l7TileCoord=s),ot.push(er)}St.features=ot}y(L)}});a.xhrCancel=function(){return C.abort()}}));case 2:case"end":return m.stop()}},i)}));return function(t,r,a,s){return e.apply(this,arguments)}}();function mu(e,i){var t=(i==null?void 0:i.coord)||"lnglat",r=function(l,d){return yc(e,l,d,t)},a=aa(aa(aa({},Ws),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:a,isTile:!0}}function xl(e,i){var t=i.extent,r=i.width,a=i.height,s=i.min,l=i.max,d={_id:1,dataArray:[{_id:1,data:Array.from(e),width:r,height:a,min:s,max:l,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return d}var bl;(function(e){e.IMAGE="image",e.ARRAYBUFFER="arraybuffer"})(bl||(bl={}));var wu=function(){var e=(0,Ta.Z)(Sn().mark(function i(t,r,a,s){var l;return Sn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return l=vr(t,r),m.abrupt("return",new Promise(function(y,C){var w=zl({url:l},function(I,L){I?C(I):L&&y(L)},s);a.xhrCancel=function(){return w.abort()}}));case 2:case"end":return m.stop()}},i)}));return function(t,r,a,s){return e.apply(this,arguments)}}(),ko=function(){var e=(0,Ta.Z)(Sn().mark(function i(t,r,a){var s;return Sn().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s=vr(t,r),d.abrupt("return",new Promise(function(m,y){var C=Ma({url:s},function(w,I){w?y(w):I&&m(I)});a.xhrCancel=function(){return C.abort()}}));case 2:case"end":return d.stop()}},i)}));return function(t,r,a){return e.apply(this,arguments)}}(),Wc=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}};function Of(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function If(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Of(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Of(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var oh={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function cp(e,i){var t=(i==null?void 0:i.dataType)||bl.IMAGE,r=function(l,d){return t===bl.IMAGE?ko(e,l,d):wu(e,l,d,(i==null?void 0:i.format)||Wc)},a=If(If(If({},oh),i),{},{getTileData:r});return{data:e,dataArray:[],tilesetOptions:a,isTile:!0}}var fp=F(30236),_c=F.n(fp),Rf=F(47037),gu=F.n(Rf),Qp=F(23560),ru=F.n(Qp),Lf=F(50361),Xc=F.n(Lf),hp=F(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function kf(e,i,t,r){function a(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function d(C){try{y(r.next(C))}catch(w){l(w)}}function m(C){try{y(r.throw(C))}catch(w){l(w)}}function y(C){C.done?s(C.value):a(C.value).then(d,m)}y((r=r.apply(e,i||[])).next())})}function pp(e,i){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,a,s,l;return l={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(y){return function(C){return m([y,C])}}function m(y){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(s=y[0]&2?a.return:y[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,y[1])).done)return s;switch(a=0,s&&(y=[y[0]&2,s.value]),y[0]){case 0:case 1:s=y;break;case 4:return t.label++,{value:y[1],done:!1};case 5:t.label++,a=y[1],y=[0];continue;case 7:y=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(y[0]===6||y[0]===2)){t=0;continue}if(y[0]===3&&(!s||y[1]>s[0]&&y[1]<s[3])){t.label=y[1];break}if(y[0]===6&&t.label<s[1]){t.label=s[1],s=y;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(y);break}s[2]&&t.ops.pop(),t.trys.pop();continue}y=i.call(e,t)}catch(C){y=[6,C],a=0}finally{r=s=0}if(y[0]&5)throw y[1];return{value:y[0]?y[1]:void 0,done:!0}}}function kd(e,i){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var r=t.call(e),a,s=[],l;try{for(;(i===void 0||i-- >0)&&!(a=r.next()).done;)s.push(a.value)}catch(d){l={error:d}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(l)throw l.error}}return s}function Dd(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(kd(arguments[i]));return e}function Yo(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Do(e,i){return i={exports:{}},e(i,i.exports),i.exports}var Fh=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=t;function t(r){return r&&typeof r.length=="number"&&r.length>=0&&r.length%1==0}e.exports=i.default});Yo(Fh);var Yc=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){return function(){for(var r=[],a=arguments.length;a--;)r[a]=arguments[a];var s=r.pop();return t.call(this,r,s)}},e.exports=i.default});Yo(Yc);var Df=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var t=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,r=i.hasNextTick=typeof hp=="object"&&typeof hp.nextTick=="function";function a(d){setTimeout(d,0)}function s(d){return function(m){for(var y=[],C=arguments.length-1;C-- >0;)y[C]=arguments[C+1];return d(function(){return m.apply(void 0,y)})}}var l;t?l=setImmediate:r?l=hp.nextTick:l=a,i.default=s(l)});Yo(Df);var Fo=Df.fallback,dp=Df.wrap,Fd=Df.hasSetImmediate,vp=Df.hasNextTick,sh=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var t=a(Yc),r=a(Df);function a(m){return m&&m.__esModule?m:{default:m}}function s(m){return(0,nu.isAsync)(m)?function(){for(var y=[],C=arguments.length;C--;)y[C]=arguments[C];var w=y.pop(),I=m.apply(this,y);return l(I,w)}:(0,t.default)(function(y,C){var w;try{w=m.apply(this,y)}catch(I){return C(I)}if(w&&typeof w.then=="function")return l(w,C);C(null,w)})}function l(m,y){return m.then(function(C){d(y,null,C)},function(C){d(y,C&&C.message?C:new Error(C))})}function d(m,y,C){try{m(y,C)}catch(w){(0,r.default)(function(I){throw I},w)}}e.exports=i.default});Yo(sh);var nu=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var t=r(sh);function r(m){return m&&m.__esModule?m:{default:m}}function a(m){return m[Symbol.toStringTag]==="AsyncFunction"}function s(m){return m[Symbol.toStringTag]==="AsyncGenerator"}function l(m){return typeof m[Symbol.asyncIterator]=="function"}function d(m){if(typeof m!="function")throw new Error("expected a function");return a(m)?(0,t.default)(m):m}i.default=d,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=l});Yo(nu);var mp=nu.isAsyncIterable,Bh=nu.isAsyncGenerator,qc=nu.isAsync,nl=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=t;function t(r,a){if(a===void 0&&(a=r.length),!a)throw new Error("arity is undefined");function s(){for(var l=this,d=[],m=arguments.length;m--;)d[m]=arguments[m];return typeof d[a-1]=="function"?r.apply(this,d):new Promise(function(y,C){d[a-1]=function(w){for(var I=[],L=arguments.length-1;L-- >0;)I[L]=arguments[L+1];if(w)return C(w);y(I.length>1?I:I[0])},r.apply(l,d)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+r.name+")"}),s}e.exports=i.default});Yo(nl);var Kc=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=s(Fh),r=s(nu),a=s(nl);function s(l){return l&&l.__esModule?l:{default:l}}i.default=(0,a.default)(function(l,d,m){var y=(0,t.default)(d)?[]:{};l(d,function(C,w,I){(0,r.default)(C)(function(L){for(var U,K=[],ae=arguments.length-1;ae-- >0;)K[ae]=arguments[ae+1];K.length<2&&(U=K,K=U[0]),y[w]=K,I(L)})},function(C){return m(C,y)})},3),e.exports=i.default});Yo(Kc);var $c=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=t;function t(r){function a(){for(var s=[],l=arguments.length;l--;)s[l]=arguments[l];if(r!==null){var d=r;r=null,d.apply(this,s)}}return Object.assign(a,r),a}e.exports=i.default});Yo($c);var Hl=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=i.default});Yo(Hl);var uh=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=m;var t=a(Fh),r=a(Hl);function a(y){return y&&y.__esModule?y:{default:y}}function s(y){var C=-1,w=y.length;return function(){return++C<w?{value:y[C],key:C}:null}}function l(y){var C=-1;return function(){var I=y.next();return I.done?null:(C++,{value:I.value,key:C})}}function d(y){var C=y?Object.keys(y):[],w=-1,I=C.length;return function(){var U=C[++w];return w<I?{value:y[U],key:U}:null}}function m(y){if((0,t.default)(y))return s(y);var C=(0,r.default)(y);return C?l(C):d(y)}e.exports=i.default});Yo(uh);var xc=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=t;function t(r){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(r===null)throw new Error("Callback was already called.");var l=r;r=null,l.apply(this,a)}}e.exports=i.default});Yo(xc);var Qc=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t={};i.default=t,e.exports=i.default});Yo(Qc);var Jc=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var t=r(Qc);function r(s){return s&&s.__esModule?s:{default:s}}function a(s,l,d,m){var y=!1,C=!1,w=!1,I=0,L=0;function U(){I>=l||w||y||(w=!0,s.next().then(function(Ae){var Ge=Ae.value,ot=Ae.done;if(!(C||y)){if(w=!1,ot){y=!0,I<=0&&m(null);return}I++,d(Ge,L,K),L++,U()}}).catch(ae))}function K(Ae,Ge){if(I-=1,!C){if(Ae)return ae(Ae);if(Ae===!1){y=!0,C=!0;return}if(Ge===t.default||y&&I<=0)return y=!0,m(null);U()}}function ae(Ae){C||(w=!1,y=!0,m(Ae))}U()}e.exports=i.default});Yo(Jc);var ef=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=d($c),r=d(uh),a=d(xc),s=d(Jc),l=d(Qc);function d(m){return m&&m.__esModule?m:{default:m}}i.default=function(m){return function(y,C,w){if(w=(0,t.default)(w),m<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!y)return w(null);if((0,nu.isAsyncGenerator)(y))return(0,s.default)(y,m,C,w);if((0,nu.isAsyncIterable)(y))return(0,s.default)(y[Symbol.asyncIterator](),m,C,w);var I=(0,r.default)(y),L=!1,U=!1,K=0,ae=!1;function Ae(ot,St){if(!U)if(K-=1,ot)L=!0,w(ot);else if(ot===!1)L=!0,U=!0;else{if(St===l.default||L&&K<=0)return L=!0,w(null);ae||Ge()}}function Ge(){for(ae=!0;K<m&&!L;){var ot=I();if(ot===null){L=!0,K<=0&&w(null);return}K+=1,C(ot.value,ot.key,(0,a.default)(Ae))}ae=!1}Ge()}},e.exports=i.default});Yo(ef);var Rs=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=s(ef),r=s(nu),a=s(nl);function s(d){return d&&d.__esModule?d:{default:d}}function l(d,m,y,C){return(0,t.default)(m)(d,(0,r.default)(y),C)}i.default=(0,a.default)(l,4),e.exports=i.default});Yo(Rs);var Ff=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=a(Rs),r=a(nl);function a(l){return l&&l.__esModule?l:{default:l}}function s(l,d,m){return(0,t.default)(l,1,d,m)}i.default=(0,r.default)(s,3),e.exports=i.default});Yo(Ff);var lh=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var t=a(Kc),r=a(Ff);function a(l){return l&&l.__esModule?l:{default:l}}function s(l,d){return(0,t.default)(r.default,l,d)}e.exports=i.default}),Bf=Yo(lh),yu=function(){function e(){for(var i=arguments,t=[],r=0;r<arguments.length;r++)t[r]=i[r];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,t=[],r=0;r<arguments.length;r++)t[r]=i[r];return this.args=t,Bf(this.tasks)},e.prototype.tap=function(i,t){var r=this;this.tasks.push(function(a){t.apply(void 0,Dd(r.args)),a(null,i)})},e}(),ch=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=y(Fh),r=y(Qc),a=y(Rs),s=y($c),l=y(xc),d=y(nu),m=y(nl);function y(L){return L&&L.__esModule?L:{default:L}}function C(L,U,K){K=(0,s.default)(K);var ae=0,Ae=0,Ge=L.length,ot=!1;Ge===0&&K(null);function St(zt,Ot){zt===!1&&(ot=!0),ot!==!0&&(zt?K(zt):(++Ae===Ge||Ot===r.default)&&K(null))}for(;ae<Ge;ae++)U(L[ae],ae,(0,l.default)(St))}function w(L,U,K){return(0,a.default)(L,Infinity,U,K)}function I(L,U,K){var ae=(0,t.default)(L)?C:w;return ae(L,(0,d.default)(U),K)}i.default=(0,m.default)(I,3),e.exports=i.default});Yo(ch);var El=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var t=a(ch),r=a(Kc);function a(l){return l&&l.__esModule?l:{default:l}}function s(l,d){return(0,r.default)(t.default,l,d)}e.exports=i.default}),tf=Yo(El),Jp=function(){function e(){for(var i=arguments,t=[],r=0;r<arguments.length;r++)t[r]=i[r];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,t=[],r=0;r<arguments.length;r++)t[r]=i[r];return tf(this.tasks)},e.prototype.tapPromise=function(i,t){var r=this;this.tasks.push(function(a){return kf(r,void 0,void 0,function(){return pp(this,function(s){switch(s.label){case 0:return[4,t()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),Nh=Do(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var t=l($c),r=l(xc),a=l(nu),s=l(nl);function l(m){return m&&m.__esModule?m:{default:m}}function d(m,y){if(y=(0,t.default)(y),!Array.isArray(m))return y(new Error("First argument to waterfall must be an array of functions"));if(!m.length)return y();var C=0;function w(L){var U=(0,a.default)(m[C++]);U.apply(void 0,L.concat([(0,r.default)(I)]))}function I(L){for(var U=[],K=arguments.length-1;K-- >0;)U[K]=arguments[K+1];if(L!==!1){if(L||C===m.length)return y.apply(void 0,[L].concat(U));w(U)}}w([])}i.default=(0,s.default)(d),e.exports=i.default}),ed=Yo(Nh),Bd=function(){function e(){for(var i=arguments,t=[],r=0;r<arguments.length;r++)t[r]=i[r];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,t=[],r=0;r<arguments.length;r++)t[r]=i[r];return ed(this.tasks)},e.prototype.tap=function(i,t){this.tasks.length===0?this.tasks.push(function(r){var a=t();r(a?null:!1,a)}):this.tasks.push(function(r,a){var s=t();a(s?null:!1,i)})},e}(),gp=function(){function e(){for(var i=arguments,t=[],r=0;r<arguments.length;r++)t[r]=i[r];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,t=[],r=0;r<arguments.length;r++)t[r]=i[r];return Bf(this.tasks)},e.prototype.tap=function(i,t){this.tasks.push(function(r){var a=t();r(a,i)})},e}(),Tu=F(69848),yp=F.n(Tu);function fh(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function rf(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?fh(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):fh(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function ju(e,i){var t=i.radius,r=t===void 0?40:t,a=i.maxZoom,s=a===void 0?18:a,l=i.minZoom,d=l===void 0?0:l,m=i.zoom,y=m===void 0?2:m;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(y));return e.dataArray=td(C),e}var w=new(yp())({radius:r,minZoom:d,maxZoom:s}),I={type:"FeatureCollection",features:[]};return I.features=e.dataArray.map(function(L){return{type:"Feature",geometry:{type:"Point",coordinates:L.coordinates},properties:rf({},L)}}),w.load(I.features),w}function td(e){return e.map(function(i,t){return rf({coordinates:i.geometry.coordinates,_id:t+1},i.properties)})}function Nd(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],t=1;t<e.length;t++)e[t]>i&&(i=e[t]);return i}function Sl(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],t=1;t<e.length;t++)e[t]<i&&(i=e[t]);return i}function nf(e){if(e.length===0)return 0;for(var i=e[0],t=0,r,a=1;a<e.length;a++)r=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?t+=i-r+e[a]:t+=e[a]-r+i,i=r;return i+t*1}function af(e){if(e.length===0)throw new Error("mean requires at least one data point");return nf(e)/e.length}var bc={min:Sl,max:Nd,mean:af,sum:nf};function rd(e,i){return e.map(function(t){return t[i]*1})}function zh(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Ec(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?zh(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):zh(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _p(e){var i=ya();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function ya(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Sc(e,i){if(Array.isArray(i))return i}var To=function(e){(0,Wr.Z)(t,e);var i=_p(t);function t(r,a){var s;return(0,qt.Z)(this,t),s=i.call(this),(0,b.Z)((0,he.Z)(s),"data",void 0),(0,b.Z)((0,he.Z)(s),"center",void 0),(0,b.Z)((0,he.Z)(s),"extent",void 0),(0,b.Z)((0,he.Z)(s),"hooks",{init:new yu}),(0,b.Z)((0,he.Z)(s),"parser",{type:"geojson"}),(0,b.Z)((0,he.Z)(s),"transforms",[]),(0,b.Z)((0,he.Z)(s),"cluster",!1),(0,b.Z)((0,he.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,b.Z)((0,he.Z)(s),"tileset",void 0),(0,b.Z)((0,he.Z)(s),"mapService",void 0),(0,b.Z)((0,he.Z)(s),"invalidExtent",!1),(0,b.Z)((0,he.Z)(s),"dataArrayChanged",!1),(0,b.Z)((0,he.Z)(s),"originData",void 0),(0,b.Z)((0,he.Z)(s),"rawData",void 0),(0,b.Z)((0,he.Z)(s),"cfg",{}),(0,b.Z)((0,he.Z)(s),"clusterIndex",void 0),s.originData=r,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,Gt.Z)(t,[{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,l=this.clusterOptions,d=l.method,m=d===void 0?"sum":d,y=l.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(w){w.id||(w.properties.point_count=1)}),(y||ru()(m))&&(C=C.map(function(w){var I=w.id;if(I){var L=s.clusterIndex.getLeaves(I,Infinity),U=L.map(function(Ae){return Ae.properties}),K;if(gu()(m)&&y){var ae=rd(U,y);K=bc[m](ae)}ru()(m)&&(K=m(U)),w.properties.stat=K}else w.properties.point_count=1;return w})),this.data=ne("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,l=s===void 0?"geojson":s;if(l==="geojson"&&!this.cluster){var d=a<this.originData.features.length?this.originData.features[a]:"null",m=Xc()(d);if(this.transforms.length!==0||this.dataArrayChanged){var y=this.data.dataArray.find(function(C){return C._id===a});m.properties=y}return m}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(l){return l._id===a?Ec(Ec({},l),s):l}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var l=this.data.dataArray.find(function(d){return d[a]===s});return l==null?void 0:l._id}},{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"destroy",value:function(){var a;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(a=this.tileset)===null||a===void 0||a.destroy()}},{key:"initCfg",value:function(a){this.cfg=_c()(this.cfg,a,Sc);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=Ec(Ec({},this.clusterOptions),s.clusterOptions)))}},{key:"init",value:function(){this.hooks.init.call(this)}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson",l=ne(s);this.data=l(this.originData,a),this.extent=Cu(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3],this.tileset=this.initTileset()}},{key:"setCenter",value:function(a){this.center=[(a[0]+a[2])/2,(a[1]+a[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var a=this.data.tilesetOptions;if(!!a){if(this.tileset)return this.tileset.updateOptions(a),this.tileset;var s=new vu(Ec({},a));return s}}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(l){var d=l.type,m=re(d)(a.data,l);Object.assign(a.data,m)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=ju(this.data,a)}}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=pu(jl(this.extent),a)),s[0].concat(s[1])}}]),t}(Ja.EventEmitter);function iu(e,i){var t=i.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function xp(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=nd(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function nd(e,i){if(!!e){if(typeof e=="string")return id(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return id(e,i)}}function id(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}var bp=6378e3;function zd(e,i){var t=e.dataArray,r=i.size,a=r===void 0?10:r,s=a/(2*Math.PI*bp)*(256<<20)/2,l=Ep(t,a),d=l.gridHash,m=l.gridOffset,y=ad(d,m,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:y}}function Ep(e,i){var t=Infinity,r=-Infinity,a,s=xp(e),l;try{for(s.s();!(l=s.n()).done;){var d=l.value;a=d.coordinates[1],Number.isFinite(a)&&(t=a<t?a:t,r=a>r?a:r)}}catch(ot){s.e(ot)}finally{s.f()}var m=(t+r)/2,y=Zd(i,m);if(y.xOffset<=0||y.yOffset<=0)return{gridHash:{},gridOffset:y};var C={},w=xp(e),I;try{for(w.s();!(I=w.n()).done;){var L=I.value,U=L.coordinates[1],K=L.coordinates[0];if(Number.isFinite(U)&&Number.isFinite(K)){var ae=Math.floor((U+90)/y.yOffset),Ae=Math.floor((K+180)/y.xOffset),Ge="".concat(ae,"-").concat(Ae);C[Ge]=C[Ge]||{count:0,points:[]},C[Ge].count+=1,C[Ge].points.push(L)}}}catch(ot){w.e(ot)}finally{w.f()}return{gridHash:C,gridOffset:y}}function Zd(e,i){var t=Ud(e),r=hh(i,e);return{yOffset:t,xOffset:r}}function Ud(e){return e/bp*(180/Math.PI)}function hh(e,i){return i/bp*(180/Math.PI)/Math.cos(e*Math.PI/180)}function ad(e,i,t){return Object.keys(e).reduce(function(r,a,s){var l=a.split("-"),d=parseInt(l[0],10),m=parseInt(l[1],10),y={};if(t.field&&t.method){var C=cu(e[a].points,t.field);y[t.method]=Bl[t.method](C)}return Object.assign(y,{_id:s,coordinates:Ss([-180+i.xOffset*(m+.5),-90+i.yOffset*(d+.5)]),rawData:e[a].points,count:e[a].count}),r.push(y),r},[])}var of=Math.PI/3,ph=[0,of,2*of,3*of,4*of,5*of];function Ra(e){return e[0]}function Sp(e){return e[1]}function Wl(){var e=0,i=0,t=1,r=1,a=Ra,s=Sp,l,d,m;function y(w){var I={},L=[],U,K=w.length;for(U=0;U<K;++U)if(!(isNaN(Ae=+a.call(null,ae=w[U],U,w))||isNaN(Ge=+s.call(null,ae,U,w)))){var ae,Ae,Ge,ot=Math.round(Ge=Ge/m),St=Math.round(Ae=Ae/d-(ot&1)/2),zt=Ge-ot;if(Math.abs(zt)*3>1){var Ot=Ae-St,er=St+(Ae<St?-1:1)/2,_r=ot+(Ge<ot?-1:1),kr=Ae-er,Kr=Ge-_r;Ot*Ot+zt*zt>kr*kr+Kr*Kr&&(St=er+(ot&1?1:-1)/2,ot=_r)}var Pr=St+"-"+ot,ln=I[Pr];ln?ln.push(ae):(L.push(ln=I[Pr]=[ae]),ln.x=(St+(ot&1)/2)*d,ln.y=ot*m)}return L}function C(w){var I=0,L=0;return ph.map(function(U){var K=Math.sin(U)*w,ae=-Math.cos(U)*w,Ae=K-I,Ge=ae-L;return I=K,L=ae,[Ae,Ge]})}return y.hexagon=function(w){return"m"+C(w==null?l:+w).join("l")+"z"},y.centers=function(){for(var w=[],I=Math.round(i/m),L=Math.round(e/d),U=I*m;U<r+l;U+=m,++I)for(var K=L*d+(I&1)*d/2;K<t+d/2;K+=d)w.push([K,U]);return w},y.mesh=function(){var w=C(l).slice(0,4).join("l");return y.centers().map(function(I){return"M"+I+"m"+w}).join("")},y.x=function(w){return arguments.length?(a=w,y):a},y.y=function(w){return arguments.length?(s=w,y):s},y.radius=function(w){return arguments.length?(l=+w,d=l*2*Math.sin(of),m=l*1.5,y):l},y.size=function(w){return arguments.length?(e=i=0,t=+w[0],r=+w[1],y):[t-e,r-i]},y.extent=function(w){return arguments.length?(e=+w[0][0],i=+w[0][1],t=+w[1][0],r=+w[1][1],y):[[e,i],[t,r]]},y.radius(1)}function sf(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Zh(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?sf(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):sf(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var jd=6378e3;function Z(e,i){var t=e.dataArray,r=i.size,a=r===void 0?10:r,s=i.method,l=s===void 0?"sum":s,d=a/(2*Math.PI*jd)*(256<<20)/2,m=t.map(function(I){var L=Ss(I.coordinates),U=(0,sn.Z)(L,2),K=U[0],ae=U[1];return Zh(Zh({},I),{},{coordinates:[K,ae]})}),y=Wl().radius(d).x(function(I){return I.coordinates[0]}).y(function(I){return I.coordinates[1]}),C=y(m),w={dataArray:C.map(function(I,L){var U;if(i.field&&l){var K=cu(I,i.field);I[l]=Bl[l](K)}return U={},(0,b.Z)(U,i.method,I[l]),(0,b.Z)(U,"count",I.length),(0,b.Z)(U,"rawData",I),(0,b.Z)(U,"coordinates",[I.x,I.y]),(0,b.Z)(U,"_id",L),U}),radius:d,xOffset:d,yOffset:d,type:"hexagon"};return w}function Me(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function qe(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Me(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Me(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function lr(e,i){var t=i.sourceField,r=i.targetField,a=i.data,s={};return a.forEach(function(l){s[l[t]]=l}),e.dataArray=e.dataArray.map(function(l){var d=l[r];return qe(qe({},l),s[d])}),e}function Sr(e,i){var t=i.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}we("rasterTile",cp),we("mvt",mu),we("geojson",gn),we("image",_l),we("csv",mr),we("json",Fe),we("raster",xl),ke("cluster",ju),ke("filter",iu),ke("join",lr),ke("map",Sr),ke("grid",zd),ke("hexagon",Z);var ar=bt,yr=br,Tr=To,Fr=F(28660),wt=F(86700),Gr=F(84879),Ke={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},on=F(31745),zr=F.n(on);function jr(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function kt(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?jr(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):jr(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function dr(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Zr(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function Zr(e,i){if(!!e){if(typeof e=="string")return tn(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return tn(e,i)}}function tn(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}var Ar=30;function qr(e){var i=e.characterSet,t=e.getFontWidth,r=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,l=e.mapping,d=l===void 0?{}:l,m=e.xOffset,y=m===void 0?0:m,C=e.yOffset,w=C===void 0?0:C,I=0,L=y;Array.from(i).forEach(function(K,ae){if(!d[K]){var Ae=t(K,ae);L+Ar>s&&(L=0,I++),d[K]={x:L,y:w+I*Ar,width:Ar,height:Ar,advance:Ae},L+=Ar}});var U=r+a*2;return{mapping:d,xOffset:L,yOffset:w+I*U,canvasHeight:gr(w+(I+1)*U)}}function vn(e,i,t){var r=0,a=0,s=0,l=[],d={},m=dr(e),y;try{for(m.s();!(y=m.n()).done;){var C=y.value;if(!d[C.id]){var w=C.size;r+w+i>t&&($n(d,l,a),r=0,a=s+a+i,s=0,l=[]),l.push({icon:C,xOffset:r}),r=r+w+i,s=Math.max(s,w)}}}catch(L){m.e(L)}finally{m.f()}l.length>0&&$n(d,l,a);var I=gr(s+a+i);return{mapping:d,canvasHeight:I}}function $n(e,i,t){var r=dr(i),a;try{for(r.s();!(a=r.n()).done;){var s=a.value,l=s.icon,d=s.xOffset;e[l.id]=kt(kt({},l),{},{x:d,y:t,image:l.image,width:l.width,height:l.height})}}catch(m){r.e(m)}finally{r.f()}}function gr(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Er,Fn;function un(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ur(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function Ur(e,i){if(!!e){if(typeof e=="string")return fn(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fn(e,i)}}function fn(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function dn(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Mi(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?dn(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):dn(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var yi=bo(),hn="sans-serif",En="normal",di=24,Ai=3,$i=.25,no=8,io=1024,Yi=1,qo=1,Ha=3,ns=null;function bo(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function Bo(e,i,t,r){e.font="".concat(r," ").concat(t,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Mo(e,i){for(var t=0;t<e.length;t++)i.data[4*t+3]=e[t]}var ps=(Er=(0,wt.b2)(),Er(Fn=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"fontAtlas",void 0),(0,b.Z)(this,"iconFontMap",void 0),(0,b.Z)(this,"iconFontGlyphs",{}),(0,b.Z)(this,"fontOptions",void 0),(0,b.Z)(this,"key",void 0),(0,b.Z)(this,"cache",new S(Ha))}return(0,Gt.Z)(e,[{key:"scale",get:function(){return qo}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:hn,fontWeight:En,characterSet:yi,fontSize:di,buffer:Ai,sdf:!0,cutoff:$i,radius:no,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var r=this;t.forEach(function(a){r.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(t,r){this.iconFontMap.set(t,r)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=Mi(Mi({},this.fontOptions),t),this.key=this.getKey();var r=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&r.length===0)){var s=this.generateFontAtlas(this.key,r,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,r,a){var s=this.fontOptions,l=s.fontFamily,d=s.fontWeight,m=s.fontSize,y=s.buffer,C=s.sdf,w=s.radius,I=s.cutoff,L=s.iconfont,U=a&&a.data;U||(U=Gi.document.createElement("canvas"),U.width=io);var K=U.getContext("2d");Bo(K,l,m,d);var ae=qr(Mi({getFontWidth:function(Io){return K.measureText(Io).width},fontHeight:m*qo,buffer:y,characterSet:r,maxCanvasWidth:io},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),Ae=ae.mapping,Ge=ae.canvasHeight,ot=ae.xOffset,St=ae.yOffset,zt=K.getImageData(0,0,U.width,U.height);if(U.height=Ge,K.putImageData(zt,0,0),Bo(K,l,m,d),C){var Ot=new(zr())(m,y,w,I,l,d),er=K.getImageData(0,0,Ot.size,Ot.size),_r=un(r),kr;try{for(_r.s();!(kr=_r.n()).done;){var Kr=kr.value;if(L){var Pr=String.fromCharCode(parseInt(Kr.replace("&#x","").replace(";",""),16)),ln=Ot.draw(Pr);Mo(ln,er)}else Mo(Ot.draw(Kr),er);K.putImageData(er,Ae[Kr].x,Ae[Kr].y)}}catch(Ua){_r.e(Ua)}finally{_r.f()}}else{var kn=un(r),Hn;try{for(kn.s();!(Hn=kn.n()).done;){var xa=Hn.value;K.fillText(xa,Ae[xa].x,Ae[xa].y+m*Yi)}}catch(Ua){kn.e(Ua)}finally{kn.f()}}return{xOffset:ot,yOffset:St,mapping:Ae,data:U,width:U.width,height:U.height}}},{key:"getKey",value:function(){return"key";var t,r,a,s,l,d,m,y}},{key:"getNewChars",value:function(t,r){var a=this.cache.get(t);if(!a)return r;var s=[],l=a.mapping,d=new Set(Object.keys(l)),m=new Set(r);return m.forEach(function(y){d.has(y)||s.push(y)}),s}}]),e}())||Fn),ao,Ii;function No(e){var i=sa();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function sa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var is=3,gi=1024,Zi=64,ma=(ao=(0,wt.b2)(),ao(Ii=function(e){(0,Wr.Z)(t,e);var i=No(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"canvasHeight",128),(0,b.Z)((0,he.Z)(r),"texture",void 0),(0,b.Z)((0,he.Z)(r),"canvas",void 0),(0,b.Z)((0,he.Z)(r),"iconData",void 0),(0,b.Z)((0,he.Z)(r),"iconMap",void 0),(0,b.Z)((0,he.Z)(r),"ctx",void 0),(0,b.Z)((0,he.Z)(r),"loadingImageCount",0),r}return(0,Gt.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Gi.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var l=this,d=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:Zi}),this.updateIconMap(),this.loadImage(s).then(function(m){d=m;var y=l.iconData.find(function(C){return C.id===a});y&&(y.image=d,y.width=d.width,y.height=d.height),l.update()})}},{key:"addImageMini",value:function(a,s,l){var d=this,m=l.getSceneConfig().canvas,y=m.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:Zi}),this.updateIconMap(),this.loadImageMini(s,m).then(function(C){y=C;var w=d.iconData.find(function(I){return I.id===a});w&&(w.image=y,w.width=y.width,w.height=y.height),d.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,l){if(a instanceof HTMLImageElement){s(a);return}var d=new Image;d.crossOrigin="anonymous",d.onload=function(){s(d)},d.onerror=function(){l(new Error("Could not load image at "+a))},d.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=gi,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var l=a.iconMap[s],d=l.x,m=l.y,y=l.image,C=l.width,w=C===void 0?64:C,I=l.height,L=I===void 0?64:I,U=Math.max(w,L),K=U/Zi,ae=L/K,Ae=w/K;y&&a.ctx.drawImage(y,d+(Zi-Ae)/2,m+(Zi-ae)/2,Ae,ae)})}},{key:"updateIconMap",value:function(){var a=vn(this.iconData,is,gi),s=a.mapping,l=a.canvasHeight;this.iconMap=s,this.canvasHeight=l}},{key:"loadImageMini",value:function(a,s){return new Promise(function(l,d){var m=s.createImage();m.crossOrigin="anonymous",m.onload=function(){l(m)},m.onerror=function(){d(new Error("Could not load image at "+a))},m.src=a})}}]),t}(Ja.EventEmitter))||Ii),Di=F(49685);function Ls(){var e=new Di.WT(16);return Di.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function ze(e){var i=new Di.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function fr(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Xt(e,i,t,r,a,s,l,d,m,y,C,w,I,L,U,K){var ae=new Di.WT(16);return ae[0]=e,ae[1]=i,ae[2]=t,ae[3]=r,ae[4]=a,ae[5]=s,ae[6]=l,ae[7]=d,ae[8]=m,ae[9]=y,ae[10]=C,ae[11]=w,ae[12]=I,ae[13]=L,ae[14]=U,ae[15]=K,ae}function Pn(e,i,t,r,a,s,l,d,m,y,C,w,I,L,U,K,ae){return e[0]=i,e[1]=t,e[2]=r,e[3]=a,e[4]=s,e[5]=l,e[6]=d,e[7]=m,e[8]=y,e[9]=C,e[10]=w,e[11]=I,e[12]=L,e[13]=U,e[14]=K,e[15]=ae,e}function qi(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function De(e,i){if(e===i){var t=i[1],r=i[2],a=i[3],s=i[6],l=i[7],d=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=t,e[6]=i[9],e[7]=i[13],e[8]=r,e[9]=s,e[11]=i[14],e[12]=a,e[13]=l,e[14]=d}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function ye(e,i){var t=i[0],r=i[1],a=i[2],s=i[3],l=i[4],d=i[5],m=i[6],y=i[7],C=i[8],w=i[9],I=i[10],L=i[11],U=i[12],K=i[13],ae=i[14],Ae=i[15],Ge=t*d-r*l,ot=t*m-a*l,St=t*y-s*l,zt=r*m-a*d,Ot=r*y-s*d,er=a*y-s*m,_r=C*K-w*U,kr=C*ae-I*U,Kr=C*Ae-L*U,Pr=w*ae-I*K,ln=w*Ae-L*K,kn=I*Ae-L*ae,Hn=Ge*kn-ot*ln+St*Pr+zt*Kr-Ot*kr+er*_r;return Hn?(Hn=1/Hn,e[0]=(d*kn-m*ln+y*Pr)*Hn,e[1]=(a*ln-r*kn-s*Pr)*Hn,e[2]=(K*er-ae*Ot+Ae*zt)*Hn,e[3]=(I*Ot-w*er-L*zt)*Hn,e[4]=(m*Kr-l*kn-y*kr)*Hn,e[5]=(t*kn-a*Kr+s*kr)*Hn,e[6]=(ae*St-U*er-Ae*ot)*Hn,e[7]=(C*er-I*St+L*ot)*Hn,e[8]=(l*ln-d*Kr+y*_r)*Hn,e[9]=(r*Kr-t*ln-s*_r)*Hn,e[10]=(U*Ot-K*St+Ae*Ge)*Hn,e[11]=(w*St-C*Ot-L*Ge)*Hn,e[12]=(d*kr-l*Pr-m*_r)*Hn,e[13]=(t*Pr-r*kr+a*_r)*Hn,e[14]=(K*ot-U*zt-ae*Ge)*Hn,e[15]=(C*zt-w*ot+I*Ge)*Hn,e):null}function st(e,i){var t=i[0],r=i[1],a=i[2],s=i[3],l=i[4],d=i[5],m=i[6],y=i[7],C=i[8],w=i[9],I=i[10],L=i[11],U=i[12],K=i[13],ae=i[14],Ae=i[15];return e[0]=d*(I*Ae-L*ae)-w*(m*Ae-y*ae)+K*(m*L-y*I),e[1]=-(r*(I*Ae-L*ae)-w*(a*Ae-s*ae)+K*(a*L-s*I)),e[2]=r*(m*Ae-y*ae)-d*(a*Ae-s*ae)+K*(a*y-s*m),e[3]=-(r*(m*L-y*I)-d*(a*L-s*I)+w*(a*y-s*m)),e[4]=-(l*(I*Ae-L*ae)-C*(m*Ae-y*ae)+U*(m*L-y*I)),e[5]=t*(I*Ae-L*ae)-C*(a*Ae-s*ae)+U*(a*L-s*I),e[6]=-(t*(m*Ae-y*ae)-l*(a*Ae-s*ae)+U*(a*y-s*m)),e[7]=t*(m*L-y*I)-l*(a*L-s*I)+C*(a*y-s*m),e[8]=l*(w*Ae-L*K)-C*(d*Ae-y*K)+U*(d*L-y*w),e[9]=-(t*(w*Ae-L*K)-C*(r*Ae-s*K)+U*(r*L-s*w)),e[10]=t*(d*Ae-y*K)-l*(r*Ae-s*K)+U*(r*y-s*d),e[11]=-(t*(d*L-y*w)-l*(r*L-s*w)+C*(r*y-s*d)),e[12]=-(l*(w*ae-I*K)-C*(d*ae-m*K)+U*(d*I-m*w)),e[13]=t*(w*ae-I*K)-C*(r*ae-a*K)+U*(r*I-a*w),e[14]=-(t*(d*ae-m*K)-l*(r*ae-a*K)+U*(r*m-a*d)),e[15]=t*(d*I-m*w)-l*(r*I-a*w)+C*(r*m-a*d),e}function Nt(e){var i=e[0],t=e[1],r=e[2],a=e[3],s=e[4],l=e[5],d=e[6],m=e[7],y=e[8],C=e[9],w=e[10],I=e[11],L=e[12],U=e[13],K=e[14],ae=e[15],Ae=i*l-t*s,Ge=i*d-r*s,ot=i*m-a*s,St=t*d-r*l,zt=t*m-a*l,Ot=r*m-a*d,er=y*U-C*L,_r=y*K-w*L,kr=y*ae-I*L,Kr=C*K-w*U,Pr=C*ae-I*U,ln=w*ae-I*K;return Ae*ln-Ge*Pr+ot*Kr+St*kr-zt*_r+Ot*er}function Yt(e,i,t){var r=i[0],a=i[1],s=i[2],l=i[3],d=i[4],m=i[5],y=i[6],C=i[7],w=i[8],I=i[9],L=i[10],U=i[11],K=i[12],ae=i[13],Ae=i[14],Ge=i[15],ot=t[0],St=t[1],zt=t[2],Ot=t[3];return e[0]=ot*r+St*d+zt*w+Ot*K,e[1]=ot*a+St*m+zt*I+Ot*ae,e[2]=ot*s+St*y+zt*L+Ot*Ae,e[3]=ot*l+St*C+zt*U+Ot*Ge,ot=t[4],St=t[5],zt=t[6],Ot=t[7],e[4]=ot*r+St*d+zt*w+Ot*K,e[5]=ot*a+St*m+zt*I+Ot*ae,e[6]=ot*s+St*y+zt*L+Ot*Ae,e[7]=ot*l+St*C+zt*U+Ot*Ge,ot=t[8],St=t[9],zt=t[10],Ot=t[11],e[8]=ot*r+St*d+zt*w+Ot*K,e[9]=ot*a+St*m+zt*I+Ot*ae,e[10]=ot*s+St*y+zt*L+Ot*Ae,e[11]=ot*l+St*C+zt*U+Ot*Ge,ot=t[12],St=t[13],zt=t[14],Ot=t[15],e[12]=ot*r+St*d+zt*w+Ot*K,e[13]=ot*a+St*m+zt*I+Ot*ae,e[14]=ot*s+St*y+zt*L+Ot*Ae,e[15]=ot*l+St*C+zt*U+Ot*Ge,e}function ht(e,i,t){var r=t[0],a=t[1],s=t[2],l,d,m,y,C,w,I,L,U,K,ae,Ae;return i===e?(e[12]=i[0]*r+i[4]*a+i[8]*s+i[12],e[13]=i[1]*r+i[5]*a+i[9]*s+i[13],e[14]=i[2]*r+i[6]*a+i[10]*s+i[14],e[15]=i[3]*r+i[7]*a+i[11]*s+i[15]):(l=i[0],d=i[1],m=i[2],y=i[3],C=i[4],w=i[5],I=i[6],L=i[7],U=i[8],K=i[9],ae=i[10],Ae=i[11],e[0]=l,e[1]=d,e[2]=m,e[3]=y,e[4]=C,e[5]=w,e[6]=I,e[7]=L,e[8]=U,e[9]=K,e[10]=ae,e[11]=Ae,e[12]=l*r+C*a+U*s+i[12],e[13]=d*r+w*a+K*s+i[13],e[14]=m*r+I*a+ae*s+i[14],e[15]=y*r+L*a+Ae*s+i[15]),e}function Xe(e,i,t){var r=t[0],a=t[1],s=t[2];return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Ct(e,i,t,r){var a=r[0],s=r[1],l=r[2],d=Math.hypot(a,s,l),m,y,C,w,I,L,U,K,ae,Ae,Ge,ot,St,zt,Ot,er,_r,kr,Kr,Pr,ln,kn,Hn,xa;return d<Di.Ib?null:(d=1/d,a*=d,s*=d,l*=d,m=Math.sin(t),y=Math.cos(t),C=1-y,w=i[0],I=i[1],L=i[2],U=i[3],K=i[4],ae=i[5],Ae=i[6],Ge=i[7],ot=i[8],St=i[9],zt=i[10],Ot=i[11],er=a*a*C+y,_r=s*a*C+l*m,kr=l*a*C-s*m,Kr=a*s*C-l*m,Pr=s*s*C+y,ln=l*s*C+a*m,kn=a*l*C+s*m,Hn=s*l*C-a*m,xa=l*l*C+y,e[0]=w*er+K*_r+ot*kr,e[1]=I*er+ae*_r+St*kr,e[2]=L*er+Ae*_r+zt*kr,e[3]=U*er+Ge*_r+Ot*kr,e[4]=w*Kr+K*Pr+ot*ln,e[5]=I*Kr+ae*Pr+St*ln,e[6]=L*Kr+Ae*Pr+zt*ln,e[7]=U*Kr+Ge*Pr+Ot*ln,e[8]=w*kn+K*Hn+ot*xa,e[9]=I*kn+ae*Hn+St*xa,e[10]=L*kn+Ae*Hn+zt*xa,e[11]=U*kn+Ge*Hn+Ot*xa,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function Pe(e,i,t){var r=Math.sin(t),a=Math.cos(t),s=i[4],l=i[5],d=i[6],m=i[7],y=i[8],C=i[9],w=i[10],I=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+y*r,e[5]=l*a+C*r,e[6]=d*a+w*r,e[7]=m*a+I*r,e[8]=y*a-s*r,e[9]=C*a-l*r,e[10]=w*a-d*r,e[11]=I*a-m*r,e}function tt(e,i,t){var r=Math.sin(t),a=Math.cos(t),s=i[0],l=i[1],d=i[2],m=i[3],y=i[8],C=i[9],w=i[10],I=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-y*r,e[1]=l*a-C*r,e[2]=d*a-w*r,e[3]=m*a-I*r,e[8]=s*r+y*a,e[9]=l*r+C*a,e[10]=d*r+w*a,e[11]=m*r+I*a,e}function Be(e,i,t){var r=Math.sin(t),a=Math.cos(t),s=i[0],l=i[1],d=i[2],m=i[3],y=i[4],C=i[5],w=i[6],I=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+y*r,e[1]=l*a+C*r,e[2]=d*a+w*r,e[3]=m*a+I*r,e[4]=y*a-s*r,e[5]=C*a-l*r,e[6]=w*a-d*r,e[7]=I*a-m*r,e}function Ft(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Kt(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Or(e,i,t){var r=t[0],a=t[1],s=t[2],l=Math.hypot(r,a,s),d,m,y;return l<Di.Ib?null:(l=1/l,r*=l,a*=l,s*=l,d=Math.sin(i),m=Math.cos(i),y=1-m,e[0]=r*r*y+m,e[1]=a*r*y+s*d,e[2]=s*r*y-a*d,e[3]=0,e[4]=r*a*y-s*d,e[5]=a*a*y+m,e[6]=s*a*y+r*d,e[7]=0,e[8]=r*s*y+a*d,e[9]=a*s*y-r*d,e[10]=s*s*y+m,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function nn(e,i){var t=Math.sin(i),r=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function an(e,i){var t=Math.sin(i),r=Math.cos(i);return e[0]=r,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xn(e,i){var t=Math.sin(i),r=Math.cos(i);return e[0]=r,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $r(e,i,t){var r=i[0],a=i[1],s=i[2],l=i[3],d=r+r,m=a+a,y=s+s,C=r*d,w=r*m,I=r*y,L=a*m,U=a*y,K=s*y,ae=l*d,Ae=l*m,Ge=l*y;return e[0]=1-(L+K),e[1]=w+Ge,e[2]=I-Ae,e[3]=0,e[4]=w-Ge,e[5]=1-(C+K),e[6]=U+ae,e[7]=0,e[8]=I+Ae,e[9]=U-ae,e[10]=1-(C+L),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Zn(e,i){var t=new Di.WT(3),r=-i[0],a=-i[1],s=-i[2],l=i[3],d=i[4],m=i[5],y=i[6],C=i[7],w=r*r+a*a+s*s+l*l;return w>0?(t[0]=(d*l+C*r+m*s-y*a)*2/w,t[1]=(m*l+C*a+y*r-d*s)*2/w,t[2]=(y*l+C*s+d*a-m*r)*2/w):(t[0]=(d*l+C*r+m*s-y*a)*2,t[1]=(m*l+C*a+y*r-d*s)*2,t[2]=(y*l+C*s+d*a-m*r)*2),$r(e,i,t),e}function Cn(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Bn(e,i){var t=i[0],r=i[1],a=i[2],s=i[4],l=i[5],d=i[6],m=i[8],y=i[9],C=i[10];return e[0]=Math.hypot(t,r,a),e[1]=Math.hypot(s,l,d),e[2]=Math.hypot(m,y,C),e}function Nn(e,i){var t=new Di.WT(3);Bn(t,i);var r=1/t[0],a=1/t[1],s=1/t[2],l=i[0]*r,d=i[1]*a,m=i[2]*s,y=i[4]*r,C=i[5]*a,w=i[6]*s,I=i[8]*r,L=i[9]*a,U=i[10]*s,K=l+C+U,ae=0;return K>0?(ae=Math.sqrt(K+1)*2,e[3]=.25*ae,e[0]=(w-L)/ae,e[1]=(I-m)/ae,e[2]=(d-y)/ae):l>C&&l>U?(ae=Math.sqrt(1+l-C-U)*2,e[3]=(w-L)/ae,e[0]=.25*ae,e[1]=(d+y)/ae,e[2]=(I+m)/ae):C>U?(ae=Math.sqrt(1+C-l-U)*2,e[3]=(I-m)/ae,e[0]=(d+y)/ae,e[1]=.25*ae,e[2]=(w+L)/ae):(ae=Math.sqrt(1+U-l-C)*2,e[3]=(d-y)/ae,e[0]=(I+m)/ae,e[1]=(w+L)/ae,e[2]=.25*ae),e}function On(e,i,t,r){var a=i[0],s=i[1],l=i[2],d=i[3],m=a+a,y=s+s,C=l+l,w=a*m,I=a*y,L=a*C,U=s*y,K=s*C,ae=l*C,Ae=d*m,Ge=d*y,ot=d*C,St=r[0],zt=r[1],Ot=r[2];return e[0]=(1-(U+ae))*St,e[1]=(I+ot)*St,e[2]=(L-Ge)*St,e[3]=0,e[4]=(I-ot)*zt,e[5]=(1-(w+ae))*zt,e[6]=(K+Ae)*zt,e[7]=0,e[8]=(L+Ge)*Ot,e[9]=(K-Ae)*Ot,e[10]=(1-(w+U))*Ot,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function hi(e,i,t,r,a){var s=i[0],l=i[1],d=i[2],m=i[3],y=s+s,C=l+l,w=d+d,I=s*y,L=s*C,U=s*w,K=l*C,ae=l*w,Ae=d*w,Ge=m*y,ot=m*C,St=m*w,zt=r[0],Ot=r[1],er=r[2],_r=a[0],kr=a[1],Kr=a[2],Pr=(1-(K+Ae))*zt,ln=(L+St)*zt,kn=(U-ot)*zt,Hn=(L-St)*Ot,xa=(1-(I+Ae))*Ot,Ua=(ae+Ge)*Ot,Io=(U+ot)*er,Ds=(ae-Ge)*er,Fs=(1-(I+K))*er;return e[0]=Pr,e[1]=ln,e[2]=kn,e[3]=0,e[4]=Hn,e[5]=xa,e[6]=Ua,e[7]=0,e[8]=Io,e[9]=Ds,e[10]=Fs,e[11]=0,e[12]=t[0]+_r-(Pr*_r+Hn*kr+Io*Kr),e[13]=t[1]+kr-(ln*_r+xa*kr+Ds*Kr),e[14]=t[2]+Kr-(kn*_r+Ua*kr+Fs*Kr),e[15]=1,e}function wa(e,i){var t=i[0],r=i[1],a=i[2],s=i[3],l=t+t,d=r+r,m=a+a,y=t*l,C=r*l,w=r*d,I=a*l,L=a*d,U=a*m,K=s*l,ae=s*d,Ae=s*m;return e[0]=1-w-U,e[1]=C+Ae,e[2]=I-ae,e[3]=0,e[4]=C-Ae,e[5]=1-y-U,e[6]=L+K,e[7]=0,e[8]=I+ae,e[9]=L-K,e[10]=1-y-w,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function as(e,i,t,r,a,s,l){var d=1/(t-i),m=1/(a-r),y=1/(s-l);return e[0]=s*2*d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*m,e[6]=0,e[7]=0,e[8]=(t+i)*d,e[9]=(a+r)*m,e[10]=(l+s)*y,e[11]=-1,e[12]=0,e[13]=0,e[14]=l*s*2*y,e[15]=0,e}function La(e,i,t,r,a){var s=1/Math.tan(i/2),l;return e[0]=s/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(l=1/(r-a),e[10]=(a+r)*l,e[14]=2*a*r*l):(e[10]=-1,e[14]=-2*r),e}var fa=La;function Cl(e,i,t,r,a){var s=1/Math.tan(i/2),l;return e[0]=s/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(l=1/(r-a),e[10]=a*l,e[14]=a*r*l):(e[10]=-1,e[14]=-r),e}function ks(e,i,t,r){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),l=Math.tan(i.leftDegrees*Math.PI/180),d=Math.tan(i.rightDegrees*Math.PI/180),m=2/(l+d),y=2/(a+s);return e[0]=m,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=y,e[6]=0,e[7]=0,e[8]=-((l-d)*m*.5),e[9]=(a-s)*y*.5,e[10]=r/(t-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*t/(t-r),e[15]=0,e}function Vu(e,i,t,r,a,s,l){var d=1/(i-t),m=1/(r-a),y=1/(s-l);return e[0]=-2*d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*m,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*y,e[11]=0,e[12]=(i+t)*d,e[13]=(a+r)*m,e[14]=(l+s)*y,e[15]=1,e}var Mu=Vu;function Cp(e,i,t,r,a,s,l){var d=1/(i-t),m=1/(r-a),y=1/(s-l);return e[0]=-2*d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*m,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=y,e[11]=0,e[12]=(i+t)*d,e[13]=(a+r)*m,e[14]=s*y,e[15]=1,e}function Pu(e,i,t,r){var a,s,l,d,m,y,C,w,I,L,U=i[0],K=i[1],ae=i[2],Ae=r[0],Ge=r[1],ot=r[2],St=t[0],zt=t[1],Ot=t[2];return Math.abs(U-St)<Di.Ib&&Math.abs(K-zt)<Di.Ib&&Math.abs(ae-Ot)<Di.Ib?qi(e):(C=U-St,w=K-zt,I=ae-Ot,L=1/Math.hypot(C,w,I),C*=L,w*=L,I*=L,a=Ge*I-ot*w,s=ot*C-Ae*I,l=Ae*w-Ge*C,L=Math.hypot(a,s,l),L?(L=1/L,a*=L,s*=L,l*=L):(a=0,s=0,l=0),d=w*l-I*s,m=I*a-C*l,y=C*s-w*a,L=Math.hypot(d,m,y),L?(L=1/L,d*=L,m*=L,y*=L):(d=0,m=0,y=0),e[0]=a,e[1]=d,e[2]=C,e[3]=0,e[4]=s,e[5]=m,e[6]=w,e[7]=0,e[8]=l,e[9]=y,e[10]=I,e[11]=0,e[12]=-(a*U+s*K+l*ae),e[13]=-(d*U+m*K+y*ae),e[14]=-(C*U+w*K+I*ae),e[15]=1,e)}function Cc(e,i,t,r){var a=i[0],s=i[1],l=i[2],d=r[0],m=r[1],y=r[2],C=a-t[0],w=s-t[1],I=l-t[2],L=C*C+w*w+I*I;L>0&&(L=1/Math.sqrt(L),C*=L,w*=L,I*=L);var U=m*I-y*w,K=y*C-d*I,ae=d*w-m*C;return L=U*U+K*K+ae*ae,L>0&&(L=1/Math.sqrt(L),U*=L,K*=L,ae*=L),e[0]=U,e[1]=K,e[2]=ae,e[3]=0,e[4]=w*ae-I*K,e[5]=I*U-C*ae,e[6]=C*K-w*U,e[7]=0,e[8]=C,e[9]=w,e[10]=I,e[11]=0,e[12]=a,e[13]=s,e[14]=l,e[15]=1,e}function dh(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function O0(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Ko(e,i,t){return e[0]=i[0]+t[0],e[1]=i[1]+t[1],e[2]=i[2]+t[2],e[3]=i[3]+t[3],e[4]=i[4]+t[4],e[5]=i[5]+t[5],e[6]=i[6]+t[6],e[7]=i[7]+t[7],e[8]=i[8]+t[8],e[9]=i[9]+t[9],e[10]=i[10]+t[10],e[11]=i[11]+t[11],e[12]=i[12]+t[12],e[13]=i[13]+t[13],e[14]=i[14]+t[14],e[15]=i[15]+t[15],e}function Uh(e,i,t){return e[0]=i[0]-t[0],e[1]=i[1]-t[1],e[2]=i[2]-t[2],e[3]=i[3]-t[3],e[4]=i[4]-t[4],e[5]=i[5]-t[5],e[6]=i[6]-t[6],e[7]=i[7]-t[7],e[8]=i[8]-t[8],e[9]=i[9]-t[9],e[10]=i[10]-t[10],e[11]=i[11]-t[11],e[12]=i[12]-t[12],e[13]=i[13]-t[13],e[14]=i[14]-t[14],e[15]=i[15]-t[15],e}function uf(e,i,t){return e[0]=i[0]*t,e[1]=i[1]*t,e[2]=i[2]*t,e[3]=i[3]*t,e[4]=i[4]*t,e[5]=i[5]*t,e[6]=i[6]*t,e[7]=i[7]*t,e[8]=i[8]*t,e[9]=i[9]*t,e[10]=i[10]*t,e[11]=i[11]*t,e[12]=i[12]*t,e[13]=i[13]*t,e[14]=i[14]*t,e[15]=i[15]*t,e}function od(e,i,t,r){return e[0]=i[0]+t[0]*r,e[1]=i[1]+t[1]*r,e[2]=i[2]+t[2]*r,e[3]=i[3]+t[3]*r,e[4]=i[4]+t[4]*r,e[5]=i[5]+t[5]*r,e[6]=i[6]+t[6]*r,e[7]=i[7]+t[7]*r,e[8]=i[8]+t[8]*r,e[9]=i[9]+t[9]*r,e[10]=i[10]+t[10]*r,e[11]=i[11]+t[11]*r,e[12]=i[12]+t[12]*r,e[13]=i[13]+t[13]*r,e[14]=i[14]+t[14]*r,e[15]=i[15]+t[15]*r,e}function sd(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Ap(e,i){var t=e[0],r=e[1],a=e[2],s=e[3],l=e[4],d=e[5],m=e[6],y=e[7],C=e[8],w=e[9],I=e[10],L=e[11],U=e[12],K=e[13],ae=e[14],Ae=e[15],Ge=i[0],ot=i[1],St=i[2],zt=i[3],Ot=i[4],er=i[5],_r=i[6],kr=i[7],Kr=i[8],Pr=i[9],ln=i[10],kn=i[11],Hn=i[12],xa=i[13],Ua=i[14],Io=i[15];return Math.abs(t-Ge)<=Di.Ib*Math.max(1,Math.abs(t),Math.abs(Ge))&&Math.abs(r-ot)<=Di.Ib*Math.max(1,Math.abs(r),Math.abs(ot))&&Math.abs(a-St)<=Di.Ib*Math.max(1,Math.abs(a),Math.abs(St))&&Math.abs(s-zt)<=Di.Ib*Math.max(1,Math.abs(s),Math.abs(zt))&&Math.abs(l-Ot)<=Di.Ib*Math.max(1,Math.abs(l),Math.abs(Ot))&&Math.abs(d-er)<=Di.Ib*Math.max(1,Math.abs(d),Math.abs(er))&&Math.abs(m-_r)<=Di.Ib*Math.max(1,Math.abs(m),Math.abs(_r))&&Math.abs(y-kr)<=Di.Ib*Math.max(1,Math.abs(y),Math.abs(kr))&&Math.abs(C-Kr)<=Di.Ib*Math.max(1,Math.abs(C),Math.abs(Kr))&&Math.abs(w-Pr)<=Di.Ib*Math.max(1,Math.abs(w),Math.abs(Pr))&&Math.abs(I-ln)<=Di.Ib*Math.max(1,Math.abs(I),Math.abs(ln))&&Math.abs(L-kn)<=Di.Ib*Math.max(1,Math.abs(L),Math.abs(kn))&&Math.abs(U-Hn)<=Di.Ib*Math.max(1,Math.abs(U),Math.abs(Hn))&&Math.abs(K-xa)<=Di.Ib*Math.max(1,Math.abs(K),Math.abs(xa))&&Math.abs(ae-Ua)<=Di.Ib*Math.max(1,Math.abs(ae),Math.abs(Ua))&&Math.abs(Ae-Io)<=Di.Ib*Math.max(1,Math.abs(Ae),Math.abs(Io))}var jh=Yt,lf=Uh,Vd,Gd,kv=(Vd=(0,wt.b2)(),Vd(Gd=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"viewport",void 0),(0,b.Z)(this,"overridedViewProjectionMatrix",void 0),(0,b.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,b.Z)(this,"jitteredProjectionMatrix",void 0),(0,b.Z)(this,"viewMatrixInverse",void 0),(0,b.Z)(this,"cameraPosition",void 0)}return(0,Gt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=Ls(),ye(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),r=(0,sn.Z)(t,2),a=r[0],s=r[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,r){return this.viewport.projectFlat(t,r)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,r){var a=Ft(Ls(),[t,r,0]);this.jitteredProjectionMatrix=Yt(Ls(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Yt(Ls(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Gd),os,cf;function I0(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=n(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function n(e,i){if(!!e){if(typeof e=="string")return o(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return o(e,i)}}function o(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}var u=(os=(0,wt.b2)(),os(cf=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"container",void 0),(0,b.Z)(this,"controlCorners",void 0),(0,b.Z)(this,"controlContainer",void 0),(0,b.Z)(this,"scene",void 0),(0,b.Z)(this,"mapsService",void 0),(0,b.Z)(this,"controls",[]),(0,b.Z)(this,"unAddControls",[])}return(0,Gt.Z)(e,[{key:"init",value:function(t,r){this.container=t.container,this.scene=r,this.mapsService=r.get(Ke.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,r){var a=r.get(Ke.IMapService);a.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(r){return r.controlOption.name===t})}},{key:"removeControl",value:function(t){var r=this.controls.indexOf(t);return r>-1&&this.controls.splice(r,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(r){r.addTo(t.scene),t.controls.push(r)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=I0(this.controls),r;try{for(t.s();!(r=t.n()).done;){var a=r.value;a.remove()}}catch(s){t.e(s)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},r="l7-",a=this.controlContainer=za("div",r+"control-container",this.container);function s(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],d=l.map(function(m){return r+m}).join(" ");t[l.join("")]=za("div",d,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&Zs(this.controlCorners[t]);this.controlContainer&&Zs(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||cf),p,_,E=(p=(0,wt.b2)(),p(_=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"container",void 0),(0,b.Z)(this,"scene",void 0),(0,b.Z)(this,"mapsService",void 0),(0,b.Z)(this,"markers",[]),(0,b.Z)(this,"markerLayers",[]),(0,b.Z)(this,"unAddMarkers",[]),(0,b.Z)(this,"unAddMarkerLayers",[])}return(0,Gt.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var r=this.markerLayers.indexOf(t);r>-1&&this.markerLayers.splice(r,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(r){r.addTo(t.scene),t.markers.push(r)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(r){t.markerLayers.push(r),r.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var r=this.markers.indexOf(t);r>-1&&this.markers.splice(r,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Ke.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||_),A,O,B=(A=(0,wt.b2)(),A(O=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"scene",void 0),(0,b.Z)(this,"popup",void 0),(0,b.Z)(this,"mapsService",void 0),(0,b.Z)(this,"unAddPopup",void 0)}return(0,Gt.Z)(e,[{key:"removePopup",value:function(t){t.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(t){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(t.addTo(this.scene),this.popup=t):this.unAddPopup=t}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Ke.IMapService)}}]),e}())||O),j=F(82492),H=F.n(j),te={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},ce=te,_e,Ue;function He(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function ft(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?He(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):He(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var rt={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Lt={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},$t=(_e=(0,wt.b2)(),_e(Ue=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"sceneConfigCache",{}),(0,b.Z)(this,"layerConfigCache",{})}return(0,Gt.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return ce[t]}},{key:"setSceneConfig",value:function(t,r){this.sceneConfigCache[t]=ft(ft({},rt),r)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,r,a){this.layerConfigCache[r]=ft({},H()({},this.sceneConfigCache[t],Lt,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Ue);function Mt(e,i,t,r){!t||Object.defineProperty(e,i,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(r):void 0})}function Pt(e,i,t,r,a){var s={};return Object.keys(r).forEach(function(l){s[l]=r[l]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=t.slice().reverse().reduce(function(l,d){return d(e,i,l)||l},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function Cr(){var e=new Di.WT(4);return Di.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Xr(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function pn(e,i,t,r){var a=new Di.WT(4);return a[0]=e,a[1]=i,a[2]=t,a[3]=r,a}function ti(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function In(e,i,t,r,a){return e[0]=i,e[1]=t,e[2]=r,e[3]=a,e}function oi(e,i,t){return e[0]=i[0]+t[0],e[1]=i[1]+t[1],e[2]=i[2]+t[2],e[3]=i[3]+t[3],e}function Rn(e,i,t){return e[0]=i[0]-t[0],e[1]=i[1]-t[1],e[2]=i[2]-t[2],e[3]=i[3]-t[3],e}function Xi(e,i,t){return e[0]=i[0]*t[0],e[1]=i[1]*t[1],e[2]=i[2]*t[2],e[3]=i[3]*t[3],e}function _i(e,i,t){return e[0]=i[0]/t[0],e[1]=i[1]/t[1],e[2]=i[2]/t[2],e[3]=i[3]/t[3],e}function Gn(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function ea(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Ui(e,i,t){return e[0]=Math.min(i[0],t[0]),e[1]=Math.min(i[1],t[1]),e[2]=Math.min(i[2],t[2]),e[3]=Math.min(i[3],t[3]),e}function la(e,i,t){return e[0]=Math.max(i[0],t[0]),e[1]=Math.max(i[1],t[1]),e[2]=Math.max(i[2],t[2]),e[3]=Math.max(i[3],t[3]),e}function si(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function ga(e,i,t){return e[0]=i[0]*t,e[1]=i[1]*t,e[2]=i[2]*t,e[3]=i[3]*t,e}function vo(e,i,t,r){return e[0]=i[0]+t[0]*r,e[1]=i[1]+t[1]*r,e[2]=i[2]+t[2]*r,e[3]=i[3]+t[3]*r,e}function Po(e,i){var t=i[0]-e[0],r=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(t,r,a,s)}function Eo(e,i){var t=i[0]-e[0],r=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return t*t+r*r+a*a+s*s}function mo(e){var i=e[0],t=e[1],r=e[2],a=e[3];return Math.hypot(i,t,r,a)}function Oo(e){var i=e[0],t=e[1],r=e[2],a=e[3];return i*i+t*t+r*r+a*a}function ds(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function vs(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function au(e,i){var t=i[0],r=i[1],a=i[2],s=i[3],l=t*t+r*r+a*a+s*s;return l>0&&(l=1/Math.sqrt(l)),e[0]=t*l,e[1]=r*l,e[2]=a*l,e[3]=s*l,e}function Cs(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function ou(e,i,t,r){var a=t[0]*r[1]-t[1]*r[0],s=t[0]*r[2]-t[2]*r[0],l=t[0]*r[3]-t[3]*r[0],d=t[1]*r[2]-t[2]*r[1],m=t[1]*r[3]-t[3]*r[1],y=t[2]*r[3]-t[3]*r[2],C=i[0],w=i[1],I=i[2],L=i[3];return e[0]=w*y-I*m+L*d,e[1]=-(C*y)+I*l-L*s,e[2]=C*m-w*l+L*a,e[3]=-(C*d)+w*s-I*a,e}function zo(e,i,t,r){var a=i[0],s=i[1],l=i[2],d=i[3];return e[0]=a+r*(t[0]-a),e[1]=s+r*(t[1]-s),e[2]=l+r*(t[2]-l),e[3]=d+r*(t[3]-d),e}function As(e,i){i=i||1;var t,r,a,s,l,d;do t=glMatrix.RANDOM()*2-1,r=glMatrix.RANDOM()*2-1,l=t*t+r*r;while(l>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,d=a*a+s*s;while(d>=1);var m=Math.sqrt((1-l)/d);return e[0]=i*t,e[1]=i*r,e[2]=i*a*m,e[3]=i*s*m,e}function Qi(e,i,t){var r=i[0],a=i[1],s=i[2],l=i[3];return e[0]=t[0]*r+t[4]*a+t[8]*s+t[12]*l,e[1]=t[1]*r+t[5]*a+t[9]*s+t[13]*l,e[2]=t[2]*r+t[6]*a+t[10]*s+t[14]*l,e[3]=t[3]*r+t[7]*a+t[11]*s+t[15]*l,e}function Za(e,i,t){var r=i[0],a=i[1],s=i[2],l=t[0],d=t[1],m=t[2],y=t[3],C=y*r+d*s-m*a,w=y*a+m*r-l*s,I=y*s+l*a-d*r,L=-l*r-d*a-m*s;return e[0]=C*y+L*-l+w*-m-I*-d,e[1]=w*y+L*-d+I*-l-C*-m,e[2]=I*y+L*-m+C*-d-w*-l,e[3]=i[3],e}function ka(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function ha(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function _u(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function Xs(e,i){var t=e[0],r=e[1],a=e[2],s=e[3],l=i[0],d=i[1],m=i[2],y=i[3];return Math.abs(t-l)<=glMatrix.EPSILON*Math.max(1,Math.abs(t),Math.abs(l))&&Math.abs(r-d)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-m)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))}var oo=null,$o=null,Ys=null,_a=null,ff=null,il=null,hf=null,Zo=function(){var e=Cr();return function(i,t,r,a,s,l){var d,m;for(t||(t=4),r||(r=0),a?m=Math.min(a*t+r,i.length):m=i.length,d=r;d<m;d+=t)e[0]=i[d],e[1]=i[d+1],e[2]=i[d+2],e[3]=i[d+3],s(e,e,l),i[d]=e[0],i[d+1]=e[1],i[d+2]=e[2],i[d+3]=e[3];return i}}(),Al=Math.PI/180,wl=512,vh=4003e4;function Nf(e){var i=e.latitude,t=i===void 0?0:i,r=e.zoom,a=r===void 0?0:r,s=e.scale,l=e.highPrecision,d=l===void 0?!1:l,m=e.flipY,y=m===void 0?!1:m;s=s!==void 0?s:Math.pow(2,a);var C={},w=wl*s,I=Math.cos(t*Al),L=w/360,U=L/I,K=w/vh/I;if(C.pixelsPerMeter=[K,-K,K],C.metersPerPixel=[1/K,-1/K,1/K],C.pixelsPerDegree=[L,-U,K],C.degreesPerPixel=[1/L,-1/U,1/K],d){var ae=Al*Math.tan(t*Al)/I,Ae=L*ae/2,Ge=w/vh*ae,ot=Ge/U*K;C.pixelsPerDegree2=[0,-Ae,Ge],C.pixelsPerMeter2=[ot,0,ot],y&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return y&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var al;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(al||(al={}));var Ou={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},mh,wp,gh,yh,Tp,ud=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],pf=(mh=(0,wt.b2)(),wp=(0,wt.f3)(Ke.ICameraService),mh(gh=(yh=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"needRefresh",!0),Mt(this,"cameraService",Tp,this),(0,b.Z)(this,"coordinateSystem",void 0),(0,b.Z)(this,"viewportCenter",void 0),(0,b.Z)(this,"viewportCenterProjection",void 0),(0,b.Z)(this,"pixelsPerDegree",void 0),(0,b.Z)(this,"pixelsPerDegree2",void 0),(0,b.Z)(this,"pixelsPerMeter",void 0)}return(0,Gt.Z)(e,[{key:"refresh",value:function(t){var r=this.cameraService.getZoom(),a=this.cameraService.getZoomScale(),s=t||this.cameraService.getCenter(),l=Nf({latitude:s[1],zoom:r}),d=l.pixelsPerMeter,m=l.pixelsPerDegree;this.viewportCenter=s,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=d,this.pixelsPerDegree=m,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===al.LNGLAT||this.coordinateSystem===al.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===al.LNGLAT_OFFSET?this.calculateLnglatOffset(s,r):this.coordinateSystem===al.P20_OFFSET&&this.calculateLnglatOffset(s,r,a,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,r,a,s){var l=Nf({latitude:t[1],zoom:r,scale:a,flipY:s,highPrecision:!0}),d=l.pixelsPerMeter,m=l.pixelsPerDegree,y=l.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),w=this.cameraService.getProjectionMatrix(),I=Yt([],w,C),L=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,r));this.viewportCenterProjection=Qi([],[L[0],L[1],0,1],I),C=this.cameraService.getViewMatrixUncentered()||C,I=Yt([],w,C),I=Yt([],I,ud),this.cameraService.setViewProjectionMatrix(I),this.pixelsPerMeter=d,this.pixelsPerDegree=m,this.pixelsPerDegree2=y}}]),e}(),Tp=Pt(yh.prototype,"cameraService",[wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yh))||gh),Mp=F(20396),Ac=F.n(Mp),Uo;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Uo||(Uo={}));var _h,Pp,Op,xh,Vh;function ld(e){var i=Ip();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function Ip(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rp={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Lp=(_h=(0,wt.b2)(),Pp=(0,wt.f3)(Ke.IMapService),_h(Op=(xh=function(e){(0,Wr.Z)(t,e);var i=ld(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"indragging",!1),Mt((0,he.Z)(r),"mapService",Vh,(0,he.Z)(r)),(0,b.Z)((0,he.Z)(r),"hammertime",void 0),(0,b.Z)((0,he.Z)(r),"lastClickTime",0),(0,b.Z)((0,he.Z)(r),"lastClickXY",[-1,-1]),(0,b.Z)((0,he.Z)(r),"clickTimer",void 0),(0,b.Z)((0,he.Z)(r),"$containter",void 0),(0,b.Z)((0,he.Z)(r),"onDrag",function(d){var m=r.interactionEvent(d);m.type=Rp[m.type],m.type==="dragging"?r.indragging=!0:r.indragging=!1,r.emit(Uo.Drag,m)}),(0,b.Z)((0,he.Z)(r),"onHammer",function(d){d.srcEvent.stopPropagation();var m=r.interactionEvent(d);r.emit(Uo.Hover,m)}),(0,b.Z)((0,he.Z)(r),"onTouch",function(d){var m=d.touches[0];r.onHover({x:m.pageX,y:m.pageY,type:"touch"})}),(0,b.Z)((0,he.Z)(r),"onHover",function(d){var m=d.clientX,y=d.clientY,C=m,w=y,I=d.type,L=r.mapService.getMapContainer();if(L)if(Ci)C=C-L.left-0,w=w-L.top-0;else{var U=L.getBoundingClientRect(),K=U.top,ae=U.left;C=C-ae-L.clientLeft,w=w-K-L.clientTop}var Ae=r.mapService.containerToLngLat([C,w]);if(I==="click"){if(!Ci&&"ontouchstart"in document.documentElement)return;r.isDoubleTap(C,w,Ae);return}if(I==="touch"){r.isDoubleTap(C,w,Ae);return}I!=="click"&&I!=="dblclick"&&r.emit(Uo.Hover,{x:C,y:w,lngLat:Ae,type:I,target:d})}),r}return(0,Gt.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Uo.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,l=a.y;this.emit(Uo.Hover,{x:s,y:l})}},{key:"triggerSelect",value:function(a){this.emit(Uo.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(Uo.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(Ci)Gi.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Ac()).Manager(a);s.add(new(Ac()).Tap({event:"dblclick",taps:2})),s.add(new(Ac()).Tap({event:"click"})),s.add(new(Ac()).Pan({threshold:0,pointers:0})),s.add(new(Ac()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(Ci)Gi.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,l=a.pointerType,d,m;l==="touch"?(m=Math.floor(a.pointers[0].clientY),d=Math.floor(a.pointers[0].clientX)):(m=Math.floor(a.srcEvent.y),d=Math.floor(a.srcEvent.x));var y=this.mapService.getMapContainer();if(y){var C=y.getBoundingClientRect(),w=C.top,I=C.left;d-=I,m-=w}var L=this.mapService.containerToLngLat([d,m]);return{x:d,y:m,lngLat:L,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,l){var d=this,m=new Date().getTime(),y="click";m-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),y="dblclick",this.emit(Uo.Hover,{x:a,y:s,lngLat:l,type:y})):(this.lastClickTime=m,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){y="click",d.emit(Uo.Hover,{x:a,y:s,lngLat:l,type:y})},400))}}]),t}(Wo()),Vh=Pt(xh.prototype,"mapService",[Pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xh))||Op),cd=0;function Gh(e){if(Ci)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(cd++),t.classList.add("l7-scene"),i.appendChild(t),t}return null}function fd(e){var i,t,r=!0;return e==null||(i=e.target)===null||i===void 0||(t=i.path)===null||t===void 0||t.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(l){(l==="l7-marker"||l==="l7-popup")&&(r=!1)})}}),r}var W;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(W||(W={}));var Hh,zf,Wh,bh,hd,Hd,pd,Zf,dd,R0,Xh,So,Tl;function L0(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Xl(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?L0(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):L0(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var Wd=(Hh=(0,wt.b2)(),zf=(0,wt.f3)(Ke.IMapService),Wh=(0,wt.f3)(Ke.IRendererService),bh=(0,wt.f3)(Ke.IGlobalConfigService),hd=(0,wt.f3)(Ke.IInteractionService),Hd=(0,wt.f3)(Ke.ILayerService),Hh(pd=(Zf=function(){function e(){var i=this;(0,qt.Z)(this,e),(0,b.Z)(this,"pickedColors",void 0),(0,b.Z)(this,"pickedTileLayers",[]),Mt(this,"mapService",dd,this),Mt(this,"rendererService",R0,this),Mt(this,"configService",Xh,this),Mt(this,"interactionService",So,this),Mt(this,"layerService",Tl,this),(0,b.Z)(this,"pickingFBO",void 0),(0,b.Z)(this,"width",0),(0,b.Z)(this,"height",0),(0,b.Z)(this,"alreadyInPicking",!1),(0,b.Z)(this,"pickBufferScale",1),(0,b.Z)(this,"pickedLayers",[]),(0,b.Z)(this,"pickFromPickingFBO",function(t,r){var a,s=r.x,l=r.y,d=r.lngLat,m=r.type,y=r.target,C=!1,w=i.rendererService,I=w.getViewportSize,L=w.readPixels,U=w.getContainer,K=i.getContainerSize(U()),ae=K.width,Ae=K.height;ae*=Nr,Ae*=Nr;var Ge=t.getLayerConfig(),ot=Ge.enableHighlight,St=Ge.enableSelect,zt=s*Nr,Ot=l*Nr;if(zt>ae-1*Nr||zt<0||Ot>Ae-1*Nr||Ot<0)return!1;var er;if(er=L({x:Math.floor(zt/i.pickBufferScale),y:Math.floor((Ae-(l+1)*Nr)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),i.pickedColors=er,er[0]!==0||er[1]!==0||er[2]!==0){var _r=ge(er),kr=t.getSource().getFeatureById(_r);_r!==t.getCurrentPickId()&&m==="mousemove"&&(m="mouseenter");var Kr={x:s,y:l,type:m,lngLat:d,featureId:_r,feature:kr,target:y};kr&&(C=!0,t.setCurrentPickId(_r),i.pickedLayers=[t],i.triggerHoverOnLayer(t,Kr))}else{var Pr={x:s,y:l,lngLat:d,type:t.getCurrentPickId()!==null&&m==="mousemove"?"mouseout":"un"+m,featureId:null,target:y,feature:null};i.triggerHoverOnLayer(t,Xl(Xl({},Pr),{},{type:"unpick"})),i.triggerHoverOnLayer(t,Pr),t.setCurrentPickId(null),i.pickedLayers=[]}if(ot&&i.highlightPickedFeature(t,er),St&&m==="click"&&((a=er)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var ln=ge(er);t.getCurrentSelectedId()===null||ln!==t.getCurrentSelectedId()?(i.selectFeature(t,er),t.setCurrentSelectedId(ln)):(i.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null)),t.isVector||i.layerService.getLayers().filter(function(kn){return kn.tileLayer}).map(function(kn){kn.tileLayer.clearPickState()})}return C})}return(0,Gt.Z)(e,[{key:"init",value:function(t){var r=this.rendererService,a=r.createTexture2D,s=r.createFramebuffer,l=r.getViewportSize,d=r.getContainer,m=this.getContainerSize(d()),y=m.width,C=m.height;y*=Nr,C*=Nr,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(y/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.interactionService.on(Uo.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,Ta.Z)(Sn().mark(function r(a,s,l){var d=this,m,y,C,w;return Sn().wrap(function(L){for(;;)switch(L.prev=L.next){case 0:m=this.rendererService,y=m.useFramebuffer,C=m.clear,w=m.getContainer,this.resizePickingFBO(),y(this.pickingFBO,function(){C({framebuffer:d.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var U=d.pickBox(a,s);l(U)});case 3:case"end":return L.stop()}},r,this)}));function t(r,a,s){return i.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,r){var a=this,s=r.map(function(Pr){var ln=Pr<0?0:Pr;return Math.floor(ln*Nr/a.pickBufferScale)}),l=(0,sn.Z)(s,4),d=l[0],m=l[1],y=l[2],C=l[3],w=this.rendererService,I=w.getViewportSize,L=w.readPixels,U=w.getContainer,K=this.getContainerSize(U()),ae=K.width,Ae=K.height;if(ae*=Nr,Ae*=Nr,d>(ae-1)*Nr/this.pickBufferScale||y<0||m>(Ae-1)*Nr/this.pickBufferScale||C<0)return[];var Ge,ot=Math.min(ae/this.pickBufferScale,y)-d,St=Math.min(Ae/this.pickBufferScale,C)-m;Ge=L({x:d,y:Math.floor(Ae/this.pickBufferScale-(C+1)),width:ot,height:St,data:new Uint8Array(ot*St*4),framebuffer:this.pickingFBO});for(var zt=[],Ot={},er=0;er<Ge.length/4;er=er+1){var _r=Ge.slice(er*4,er*4+4),kr=ge(_r);if(kr!==-1&&!Ot[kr]){var Kr=t.getSource().getFeatureById(kr);zt.push(Xl(Xl({},Kr),{},{pickedFeatureIdx:kr})),Ot[kr]=!0}}return zt}},{key:"handleCursor",value:function(t,r){var a=t.getLayerConfig(),s=a.cursor,l=s===void 0?"":s,d=a.cursorEnabled;if(d){var m=this.mapService.version,y=m==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=y==null?void 0:y.style.getPropertyValue("cursor");r==="unmousemove"&&C!==""?y==null||y.style.setProperty("cursor",""):r==="mousemove"&&(y==null||y.style.setProperty("cursor",l))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/Nr,height:t.height/Nr}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,Ta.Z)(Sn().mark(function r(a){return Sn().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){l.next=2;break}return l.abrupt("return");case 2:return this.alreadyInPicking=!0,l.next=5,this.pickingLayers(a);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return l.stop()}},r,this)}));function t(r){return i.apply(this,arguments)}return t}()},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,r=this.getContainerSize(t()),a=r.width,s=r.height;a*=Nr,s*=Nr,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,Ta.Z)(Sn().mark(function r(a){var s=this,l,d,m,y,C;return Sn().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:l=this.rendererService,d=l.getViewportSize,m=l.useFramebuffer,y=l.clear,C=l.getContainer,this.resizePickingFBO(),m(this.pickingFBO,function(){var L=s.layerService.getRenderList();L.filter(function(U){return U.needPick(a.type)}).reverse().some(function(U){if(y({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),s.pickedLayers.filter(function(ae){return!ae.isVector}).map(function(ae){s.selectFeature(ae,new Uint8Array([0,0,0,0]))}),s.pickedTileLayers.map(function(ae){var Ae;return(Ae=ae.tileLayer)===null||Ae===void 0?void 0:Ae.clearPick(a.type)}),U.tileLayer)return U.tileLayer.pickLayers(a);U.hooks.beforePickingEncode.call(),U.masks.length>0&&U.masks.map(function(ae){ae.hooks.beforeRenderData.call(),ae.hooks.beforeRender.call(),ae.render(),ae.hooks.afterRender.call()}),U.renderModels(!0),U.hooks.afterPickingEncode.call();var K=s.pickFromPickingFBO(U,a);return s.layerService.pickedLayerId=K?+U.id:-1,K&&!U.getLayerConfig().enablePropagation})});case 3:case"end":return I.stop()}},r,this)}));function t(r){return i.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,r){fd(r)&&(this.handleCursor(t,r.type),t.emit(r.type,r))}},{key:"highlightPickedFeature",value:function(t,r){var a=(0,sn.Z)(r,3),s=a[0],l=a[1],d=a[2];t.hooks.beforeHighlight.call([s,l,d])}},{key:"selectFeature",value:function(t,r){var a=(0,sn.Z)(r,3),s=a[0],l=a[1],d=a[2];t.hooks.beforeSelect.call([s,l,d])}}]),e}(),dd=Pt(Zf.prototype,"mapService",[zf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R0=Pt(Zf.prototype,"rendererService",[Wh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xh=Pt(Zf.prototype,"configService",[bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),So=Pt(Zf.prototype,"interactionService",[hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tl=Pt(Zf.prototype,"layerService",[Hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zf))||pd),k0=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,qt.Z)(this,e),(0,b.Z)(this,"autoStart",void 0),(0,b.Z)(this,"startTime",0),(0,b.Z)(this,"oldTime",0),(0,b.Z)(this,"running",!1),(0,b.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Gt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var r=(typeof performance=="undefined"?Date:performance).now();t=(r-this.oldTime)/1e3,this.oldTime=r,this.elapsedTime+=t}return t}}]),e}(),kp,Yl,Dp,Yh,Fp,Uf,vd,Xd,qh;function D0(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=F0(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function F0(e,i){if(!!e){if(typeof e=="string")return Yd(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Yd(e,i)}}function Yd(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}var B0=(kp=(0,wt.b2)(),Yl=(0,wt.f3)(Ke.IRendererService),Dp=(0,wt.f3)(Ke.IMapService),Yh=(0,wt.f3)(Ke.IGlobalConfigService),kp(Fp=(Uf=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"pickedLayerId",-1),(0,b.Z)(this,"clock",new k0),(0,b.Z)(this,"alreadyInRendering",!1),(0,b.Z)(this,"layers",[]),(0,b.Z)(this,"layerList",[]),(0,b.Z)(this,"layerRenderID",void 0),(0,b.Z)(this,"sceneInited",!1),(0,b.Z)(this,"animateInstanceCount",0),(0,b.Z)(this,"shaderPicking",!0),(0,b.Z)(this,"enableRender",!0),Mt(this,"renderService",vd,this),Mt(this,"mapService",Xd,this),Mt(this,"configService",qh,this)}return(0,Gt.Z)(e,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList()}},{key:"addMask",value:function(t){this.sceneInited&&t.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(t){t.inited||t.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(r){return r.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(r){return r.name===t})}},{key:"cleanRemove",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,a=this.layers.indexOf(t);a>-1&&this.layers.splice(a,1),r&&(this.updateLayerRenderList(),this.renderLayers())}},{key:"remove",value:function(t,r){if(r){var a=r.layerChildren.indexOf(t);a>-1&&r.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(t);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var i=(0,Ta.Z)(Sn().mark(function r(){var a,s,l;return Sn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){m.next=2;break}return m.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=D0(this.layerList),m.prev=5,a.s();case 7:if((s=a.n()).done){m.next=21;break}if(l=s.value,l.hooks.beforeRenderData.call(),l.hooks.beforeRender.call(),l.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),l.masks.map(function(y){y.hooks.beforeRenderData.call(),y.hooks.beforeRender.call(),y.render(),y.hooks.afterRender.call()})),!l.getLayerConfig().enableMultiPassRenderer){m.next=17;break}return m.next=15,l.renderMultiPass();case 15:m.next=18;break;case 17:l.render();case 18:l.hooks.afterRender.call();case 19:m.next=7;break;case 21:m.next=26;break;case 23:m.prev=23,m.t0=m.catch(5),a.e(m.t0);case 26:return m.prev=26,a.f(),m.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return m.stop()}},r,this,[[5,23,26,29]])}));function t(){return i.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(r){return r.inited}).filter(function(r){return r.isVisible()}).sort(function(r,a){return r.zIndex-a.zIndex}).forEach(function(r){t.layerList.push(r)})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=Q(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Gi.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Gi.cancelAnimationFrame(this.layerRenderID)}}]),e}(),vd=Pt(Uf.prototype,"renderService",[Yl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xd=Pt(Uf.prototype,"mapService",[Dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qh=Pt(Uf.prototype,"configService",[Yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uf))||Fp),Eh=F(81253),Gu=F(14293),Ml=F.n(Gu),N0=function(){function e(i){var t=this;(0,qt.Z)(this,e),(0,b.Z)(this,"name",void 0),(0,b.Z)(this,"type",void 0),(0,b.Z)(this,"scale",void 0),(0,b.Z)(this,"descriptor",void 0),(0,b.Z)(this,"featureBufferLayout",[]),(0,b.Z)(this,"needRescale",!1),(0,b.Z)(this,"needRemapping",!1),(0,b.Z)(this,"needRegenerateVertices",!1),(0,b.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,b.Z)(this,"vertexAttribute",void 0),(0,b.Z)(this,"defaultCallback",function(r){if(r.length===0){var a;return((a=t.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return r.map(function(s,l){var d,m=(d=t.scale)===null||d===void 0?void 0:d.scalers[l].func,y=m(s);return y})}),this.setProps(i)}return(0,Gt.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var r;if((r=this.scale)!==null&&r!==void 0&&r.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,le.Z)(t));if(!Ml()(s))return[s]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),wc=["buffer","update","name"],Dv=["buffer","update","name"],Kh,jf,Sh,Ch,Vf,Ah;function qd(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Bp(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?qd(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):qd(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function Fv(e){return new Promise(function(i){return setTimeout(i,e)})}var z0=(Kh={},(0,b.Z)(Kh,W.FLOAT,4),(0,b.Z)(Kh,W.UNSIGNED_BYTE,1),(0,b.Z)(Kh,W.UNSIGNED_SHORT,2),Kh),Kd=(jf=(0,wt.b2)(),Sh=(0,wt.f3)(Ke.IRendererService),jf(Ch=(Vf=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"attributesAndIndices",void 0),Mt(this,"rendererService",Ah,this),(0,b.Z)(this,"attributes",[]),(0,b.Z)(this,"triangulation",void 0),(0,b.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Gt.Z)(e,[{key:"registerStyleAttribute",value:function(t){var r=this.getLayerStyleAttribute(t.name||"");return r?r.setProps(t):(r=new N0(t),this.attributes.push(r)),r}},{key:"updateStyleAttribute",value:function(t,r,a){var s=this.getLayerStyleAttribute(t);s||(s=this.registerStyleAttribute(Bp(Bp({},r),{},{name:t})));var l=r.scale;l&&s&&(s.scale=l,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(r){return r.name===t})}},{key:"getLayerAttributeScale",value:function(t){var r,a=this.getLayerStyleAttribute(t),s=a==null||(r=a.scale)===null||r===void 0?void 0:r.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,r){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,l=this.attributes.find(function(St){return St.name===t});if(l&&l.descriptor){var d=l.descriptor,m=d.update,y=d.buffer,C=d.size,w=C===void 0?0:C,I=z0[y.type||W.FLOAT];if(m){var L=this.featureLayout,U=L.elements,K=L.sizePerElement,ae=U.slice(a,s);if(!ae.length)return;var Ae=ae[0].offset,Ge=Ae*w*I,ot=ae.map(function(St,zt){for(var Ot=St.featureIdx,er=St.vertices,_r=St.normals,kr=er.length/K,Kr=[],Pr=0;Pr<kr;Pr++){var ln=_r?_r.slice(Pr*3,Pr*3+3):[];Kr.push.apply(Kr,(0,le.Z)(m(r[Ot],Ot,er.slice(Pr*K,Pr*K+K),zt,ln)))}return Kr}).reduce(function(St,zt){return St.push.apply(St,(0,le.Z)(zt)),St},[]);l.vertexAttribute.updateBuffer({data:ot,offset:Ge})}}}},{key:"createAttributesAndIndices",value:function(t,r,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},r&&(this.triangulation=r);var l=this.attributes.map(function(Ge){return Ge.resetDescriptor(),Ge.descriptor}),d=0,m=[],y=[],C=[],w=3;t.forEach(function(Ge,ot){var St=s.triangulation(Ge,a),zt=St.indices,Ot=St.vertices,er=St.normals,_r=St.size,kr=St.indexes;zt.forEach(function(kn){y.push(kn+d)}),w=_r;var Kr=Ot.length/_r;s.featureLayout.sizePerElement=w,s.featureLayout.elements.push({featureIdx:ot,vertices:Ot,normals:er,offset:d}),d+=Kr;for(var Pr=function(Hn){var xa=(er==null?void 0:er.slice(Hn*3,Hn*3+3))||[],Ua=Ot.slice(Hn*_r,Hn*_r+_r),Io=0;kr&&kr[Hn]!==void 0&&(Io=kr[Hn]),l.forEach(function(Ds,Fs){if(Ds&&Ds.update){var Lc;(Lc=Ds.buffer.data).push.apply(Lc,(0,le.Z)(Ds.update(Ge,ot,Ua,Hn,xa,Io)))}})},ln=0;ln<Kr;ln++)Pr(ln)});var I=this.rendererService,L=I.createAttribute,U=I.createBuffer,K=I.createElements,ae={};l.forEach(function(Ge,ot){if(Ge){var St=Ge.buffer,zt=Ge.update,Ot=Ge.name,er=(0,Eh.Z)(Ge,wc),_r=L(Bp({buffer:U(St)},er));ae[Ge.name||""]=_r,s.attributes[ot].vertexAttribute=_r}});var Ae=K({data:y,type:W.UNSIGNED_INT,count:y.length});return this.attributesAndIndices={attributes:ae,elements:Ae},this.attributesAndIndices}},{key:"createAttributes",value:function(t,r){var a=this;this.featureLayout={sizePerElement:0,elements:[]},r&&(this.triangulation=r);var s=this.attributes.map(function(L){return L.resetDescriptor(),L.descriptor}),l=0,d=[],m=3;t.forEach(function(L,U){var K=a.triangulation(L),ae=K.indices,Ae=K.vertices,Ge=K.normals,ot=K.size,St=K.indexes;ae.forEach(function(_r){d.push(_r+l)}),m=ot;var zt=Ae.length/ot;a.featureLayout.sizePerElement=m,a.featureLayout.elements.push({featureIdx:U,vertices:Ae,normals:Ge,offset:l}),l+=zt;for(var Ot=function(kr){var Kr=(Ge==null?void 0:Ge.slice(kr*3,kr*3+3))||[],Pr=Ae.slice(kr*ot,kr*ot+ot),ln=0;St&&St[kr]!==void 0&&(ln=St[kr]),s.forEach(function(kn,Hn){if(kn&&kn.update){var xa;(xa=kn.buffer.data).push.apply(xa,(0,le.Z)(kn.update(L,U,Pr,kr,Kr,ln)))}})},er=0;er<zt;er++)Ot(er)});var y=this.rendererService,C=y.createAttribute,w=y.createBuffer,I={};return s.forEach(function(L,U){if(L){var K=L.buffer,ae=L.update,Ae=L.name,Ge=(0,Eh.Z)(L,Dv),ot=C(Bp({buffer:w(K)},Ge));I[L.name||""]=ot,a.attributes[U].vertexAttribute=ot}}),{attributes:I}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(r){r.vertexAttribute&&r.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}]),e}(),Ah=Pt(Vf.prototype,"rendererService",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vf))||Ch),md=F(67709),df=F.n(md),$d,gd,yd,Qd,_d,Jd,e0,xd,t0,$h,r0,Np,Z0,n0,U0,j0,V0,su,G0,H0,W0,X0,ql,zp,i0,Qh,a0,Mm,Pm,Om,Im,Rm,Lm;function Bb(e){var i=Nb();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function Nb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zb=($d=(0,wt.b2)(),gd=(0,wt.f3)(Ke.SceneID),yd=(0,wt.f3)(Ke.IIconService),Qd=(0,wt.f3)(Ke.IFontService),_d=(0,wt.f3)(Ke.IControlService),Jd=(0,wt.f3)(Ke.IGlobalConfigService),e0=(0,wt.f3)(Ke.IMapService),xd=(0,wt.f3)(Ke.ICoordinateSystemService),t0=(0,wt.f3)(Ke.IRendererService),$h=(0,wt.f3)(Ke.ILayerService),r0=(0,wt.f3)(Ke.ICameraService),Np=(0,wt.f3)(Ke.IInteractionService),Z0=(0,wt.f3)(Ke.IPickingService),n0=(0,wt.f3)(Ke.IShaderModuleService),U0=(0,wt.f3)(Ke.IMarkerService),j0=(0,wt.f3)(Ke.IPopupService),$d(V0=(su=function(e){(0,Wr.Z)(t,e);var i=Bb(t);function t(){var r;return(0,qt.Z)(this,t),r=i.call(this),(0,b.Z)((0,he.Z)(r),"destroyed",!1),(0,b.Z)((0,he.Z)(r),"loaded",!1),(0,b.Z)((0,he.Z)(r),"loadFont",!1),(0,b.Z)((0,he.Z)(r),"fontFamily",""),Mt((0,he.Z)(r),"id",G0,(0,he.Z)(r)),Mt((0,he.Z)(r),"iconService",H0,(0,he.Z)(r)),Mt((0,he.Z)(r),"fontService",W0,(0,he.Z)(r)),Mt((0,he.Z)(r),"controlService",X0,(0,he.Z)(r)),Mt((0,he.Z)(r),"configService",ql,(0,he.Z)(r)),Mt((0,he.Z)(r),"map",zp,(0,he.Z)(r)),Mt((0,he.Z)(r),"coordinateSystemService",i0,(0,he.Z)(r)),Mt((0,he.Z)(r),"rendererService",Qh,(0,he.Z)(r)),Mt((0,he.Z)(r),"layerService",a0,(0,he.Z)(r)),Mt((0,he.Z)(r),"cameraService",Mm,(0,he.Z)(r)),Mt((0,he.Z)(r),"interactionService",Pm,(0,he.Z)(r)),Mt((0,he.Z)(r),"pickingService",Om,(0,he.Z)(r)),Mt((0,he.Z)(r),"shaderModuleService",Im,(0,he.Z)(r)),Mt((0,he.Z)(r),"markerService",Rm,(0,he.Z)(r)),Mt((0,he.Z)(r),"popupService",Lm,(0,he.Z)(r)),(0,b.Z)((0,he.Z)(r),"inited",!1),(0,b.Z)((0,he.Z)(r),"initPromise",void 0),(0,b.Z)((0,he.Z)(r),"rendering",!1),(0,b.Z)((0,he.Z)(r),"$container",void 0),(0,b.Z)((0,he.Z)(r),"canvas",void 0),(0,b.Z)((0,he.Z)(r),"markerContainer",void 0),(0,b.Z)((0,he.Z)(r),"hooks",void 0),(0,b.Z)((0,he.Z)(r),"handleWindowResized",function(){r.emit("resize"),r.$container&&(r.initContainer(),lu(),r.coordinateSystemService.needRefresh=!0,r.render())}),(0,b.Z)((0,he.Z)(r),"handleMapCameraChanged",function(a){r.cameraService.update(a),r.render()}),r.hooks={init:new Jp},r}return(0,Gt.Z)(t,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ta.Z)(Sn().mark(function l(){return Sn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,new Promise(function(y){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&y()}),s.map.version!=="GAODE2.x"?s.map.init():y()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){m.next=6;break}return m.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(Uo.Drag,s.addSceneEvent.bind(s));case 13:case"end":return m.stop()}},l)}))),this.hooks.init.tapPromise("initRenderer",(0,Ta.Z)(Sn().mark(function l(){var d,m;return Sn().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(d=Gh(s.configService.getSceneConfig(s.id).id||""),s.$container=d,!d){C.next=11;break}return s.canvas=za("canvas","",d),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:df()(s.$container,s.handleWindowResized),Gi.matchMedia&&((m=Gi.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||m===void 0||m.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},l)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ta.Z)(Sn().mark(function l(){return Sn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,new Promise(function(y){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&y()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(Uo.Drag,s.addSceneEvent.bind(s));case 5:case"end":return m.stop()}},l)}))),this.hooks.init.tapPromise("initRenderer",(0,Ta.Z)(Sn().mark(function l(){var d;return Sn().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(d=a.canvas,s.$container=d||null,!s.$container){y.next=7;break}return y.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:y.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return y.stop()}},l)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var r=(0,Ta.Z)(Sn().mark(function s(){return Sn().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(this.rendering||this.destroyed)){d.next=2;break}return d.abrupt("return");case 2:if(this.rendering=!0,this.inited){d.next=23;break}return d.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){d.next=18;break}return d.prev=8,d.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:d.next=18;break;case 13:d.prev=13,d.t0=d.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(d.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return d.stop()}},s,this,[[8,13]])}));function a(){return r.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(l),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,l=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var d=a==="jpg"?l==null?void 0:l.toDataURL("image/jpeg"):l==null?void 0:l.toDataURL("image/png");return d}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=za("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,l;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var m;(m=a.$container)===null||m===void 0||m.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(l=s.parentNode)===null||l===void 0||l.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,md.unbind)(this.$container,this.handleWindowResized),Gi.matchMedia){var d;(d=Gi.matchMedia("screen and (min-resolution: 2dppx)"))===null||d===void 0||d.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,l=Nr,d=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,m=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,y=this.canvas;y&&(y.width=d*l,y.height=m*l),this.rendererService.viewport({x:0,y:0,width:l*d,height:l*m})}},{key:"setCanvas",value:function(){var a,s,l=Nr,d=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,m=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,y=this.canvas;y.width=d*l,y.height=m*l,y.style.width="100%",y.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),t}(Ja.EventEmitter),G0=Pt(su.prototype,"id",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H0=Pt(su.prototype,"iconService",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W0=Pt(su.prototype,"fontService",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X0=Pt(su.prototype,"controlService",[_d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ql=Pt(su.prototype,"configService",[Jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zp=Pt(su.prototype,"map",[e0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i0=Pt(su.prototype,"coordinateSystemService",[xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qh=Pt(su.prototype,"rendererService",[t0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a0=Pt(su.prototype,"layerService",[$h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mm=Pt(su.prototype,"cameraService",[r0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm=Pt(su.prototype,"interactionService",[Np],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Om=Pt(su.prototype,"pickingService",[Z0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Im=Pt(su.prototype,"shaderModuleService",[n0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rm=Pt(su.prototype,"markerService",[U0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lm=Pt(su.prototype,"popupService",[j0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),su))||V0),Zb=F(44908),km=F.n(Zb);function Ub(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var jb=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Dm(e){var i={};return e=e.replace(jb,function(t,r,a){var s=a.split(":"),l=s[0].trim(),d="";switch(s.length>1&&(d=s[1].trim()),r){case"bool":d=d==="true";break;case"float":case"int":d=Number(d);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":d?d=d.replace("[","").replace("]","").split(",").reduce(function(m,y){return m.push(Number(y.trim())),m},[]):d=new Array(Ub(r)).fill(0);break;default:}return i[l]=d,"uniform ".concat(r," ").concat(l,`;
`)}),{content:e,uniforms:i}}var Fm,Bm;function Nm(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function o0(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Nm(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Nm(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var zm="#define PI 3.14159265359",Vb=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Gb=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Hb=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Wb=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,Xb=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Yb=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,qb=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Kb=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,$b=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Qb=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Jb=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,e2=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,t2=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,r2=/precision\s+(high|low|medium)p\s+float/,n2=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,i2=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,a2=(Fm=(0,wt.b2)(),Fm(Bm=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"moduleCache",{}),(0,b.Z)(this,"rawContentCache",{})}return(0,Gt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:zm,fs:zm}),this.registerModule("decode",{vs:Vb,fs:""}),this.registerModule("projection",{vs:qb,fs:""}),this.registerModule("project",{vs:Yb,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Kb}),this.registerModule("lighting",{vs:Hb,fs:""}),this.registerModule("light",{vs:Gb,fs:""}),this.registerModule("picking",{vs:Xb,fs:Wb}),this.registerModule("styleMapping",{vs:$b,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:t2,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Qb,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Jb,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:e2,fs:""})}},{key:"registerModule",value:function(t,r){if(!this.rawContentCache[t]){var a=r.vs,s=r.fs,l=r.uniforms,d=Dm(a),m=d.content,y=d.uniforms,C=Dm(s),w=C.content,I=C.uniforms;this.rawContentCache[t]={fs:w,uniforms:o0(o0(o0({},y),I),l),vs:m}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var r=this;if(this.moduleCache[t])return this.moduleCache[t];var a=this.rawContentCache[t].vs,s=this.rawContentCache[t].fs,l=this.processModule(a,[],"vs"),d=l.content,m=l.includeList,y=this.processModule(s,[],"fs"),C=y.content,w=y.includeList,I=C,L=km()(m.concat(w).concat(t)).reduce(function(U,K){return o0(o0({},U),r.rawContentCache[K].uniforms)},{});return r2.test(C)||(I=n2+C),this.moduleCache[t]={fs:I.trim(),uniforms:L,vs:d.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,r,a){var s=this,l=t.replace(i2,function(d,m){var y=m.split(" "),C=y[0].replace(/"/g,"");if(r.indexOf(C)>-1)return"";var w=s.rawContentCache[C][a];r.push(C);var I=s.processModule(w,r,a),L=I.content;return L});return{content:l,includeList:r}}}]),e}())||Bm),Y0=F(66213),Jh;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Jh||(Jh={}));var Zm,Um,q0=(Zm=(0,wt.b2)(),Zm(Um=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"shaderModuleService",void 0),(0,b.Z)(this,"rendererService",void 0),(0,b.Z)(this,"cameraService",void 0),(0,b.Z)(this,"mapService",void 0),(0,b.Z)(this,"interactionService",void 0),(0,b.Z)(this,"layerService",void 0),(0,b.Z)(this,"config",void 0)}return(0,Gt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Jh.Normal}},{key:"init",value:function(t,r){this.config=r,this.rendererService=t.getContainer().get(Ke.IRendererService),this.cameraService=t.getContainer().get(Ke.ICameraService),this.mapService=t.getContainer().get(Ke.IMapService),this.interactionService=t.getContainer().get(Ke.IInteractionService),this.layerService=t.getContainer().get(Ke.ILayerService),this.shaderModuleService=t.getContainer().get(Ke.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||Um),jm,Vm;function o2(e){var i=s2();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function s2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var u2=(jm=(0,wt.b2)(),jm(Vm=function(e){(0,Wr.Z)(t,e);var i=o2(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,Y0.Z)((0,yt.Z)(t.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(q0))||Vm),Gm,Hm,Wm,Bv,Xm;function l2(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=c2(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function c2(e,i){if(!!e){if(typeof e=="string")return Ym(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ym(e,i)}}function Ym(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}var f2=(Gm=(0,wt.b2)(),Hm=(0,wt.f3)(Ke.IPostProcessor),Gm(Wm=(Bv=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"passes",[]),Mt(this,"postProcessor",Xm,this),(0,b.Z)(this,"layer",void 0),(0,b.Z)(this,"renderFlag",void 0),(0,b.Z)(this,"width",0),(0,b.Z)(this,"height",0)}return(0,Gt.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,Ta.Z)(Sn().mark(function r(){var a,s,l;return Sn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:a=l2(this.passes),m.prev=1,a.s();case 3:if((s=a.n()).done){m.next=9;break}return l=s.value,m.next=7,l.render(this.layer);case 7:m.next=3;break;case 9:m.next=14;break;case 11:m.prev=11,m.t0=m.catch(1),a.e(m.t0);case 14:return m.prev=14,a.f(),m.finish(14);case 17:return m.next=19,this.postProcessor.render(this.layer);case 19:case"end":return m.stop()}},r,this,[[1,11,14,17]])}));function t(){return i.apply(this,arguments)}return t}()},{key:"resize",value:function(t,r){(this.width!==t||this.height!==r)&&(this.postProcessor.resize(t,r),this.width=t,this.height=r)}},{key:"add",value:function(t,r){t.getType()===Jh.PostProcessing?this.postProcessor.add(t,this.layer,r):(t.init(this.layer,r),this.passes.push(t))}},{key:"insert",value:function(t,r,a){t.init(this.layer,r),this.passes.splice(a,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Xm=Pt(Bv.prototype,"postProcessor",[Hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bv))||Wm),qm,Km;function $m(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Qm(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?$m(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$m(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function h2(e){var i=p2();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function p2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d2=(qm=(0,wt.b2)(),qm(Km=function(e){(0,Wr.Z)(t,e);var i=h2(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"pickingFBO",void 0),(0,b.Z)((0,he.Z)(r),"layer",void 0),(0,b.Z)((0,he.Z)(r),"width",0),(0,b.Z)((0,he.Z)(r),"height",0),(0,b.Z)((0,he.Z)(r),"alreadyInRendering",!1),(0,b.Z)((0,he.Z)(r),"pickFromPickingFBO",function(d){var m=d.x,y=d.y,C=d.lngLat,w=d.type;if(!(!r.layer.isVisible()||!r.layer.needPick(w))){var I=r.rendererService,L=I.getViewportSize,U=I.readPixels,K=I.useFramebuffer,ae=L(),Ae=ae.width,Ge=ae.height,ot=r.layer.getLayerConfig(),St=ot.enableHighlight,zt=ot.enableSelect,Ot=m*Nr,er=y*Nr;if(!(Ot>Ae||Ot<0||er>Ge||er<0)){var _r;K(r.pickingFBO,function(){var kr;if(_r=U({x:Math.round(Ot),y:Math.round(Ge-(y+1)*Nr),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO}),_r[0]!==0||_r[1]!==0||_r[2]!==0){var Kr=ge(_r),Pr=r.layer.getSource().getFeatureById(Kr),ln={x:m,y,type:w,lngLat:C,featureId:Kr,feature:Pr};Pr&&(r.layer.setCurrentPickId(Kr),r.triggerHoverOnLayer(ln))}else{var kn={x:m,y,lngLat:C,type:r.layer.getCurrentPickId()===null?"un"+w:"mouseout",featureId:null,feature:null};r.triggerHoverOnLayer(Qm(Qm({},kn),{},{type:"unpick"})),r.triggerHoverOnLayer(kn),r.layer.setCurrentPickId(null)}St&&r.highlightPickedFeature(_r),zt&&w==="click"&&((kr=_r)===null||kr===void 0?void 0:kr.toString())!==[0,0,0,0].toString()&&r.selectFeature(_r)})}}}),r}return(0,Gt.Z)(t,[{key:"getType",value:function(){return Jh.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,Y0.Z)((0,yt.Z)(t.prototype),"init",this).call(this,a,s),this.layer=a;var l=this.rendererService,d=l.createTexture2D,m=l.createFramebuffer,y=l.getViewportSize,C=y(),w=C.width,I=C.height;this.pickingFBO=m({color:d({width:w,height:I,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.interactionService.on(Uo.Hover,this.pickFromPickingFBO),this.interactionService.on(Uo.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Uo.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var l=this.rendererService,d=l.getViewportSize,m=l.useFramebuffer,y=l.clear,C=d(),w=C.width,I=C.height;this.alreadyInRendering=!0,(this.width!==w||this.height!==I)&&(this.pickingFBO.resize({width:w,height:I}),this.width=w,this.height=I),m(this.pickingFBO,function(){y({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var L=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(L),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,sn.Z)(a,3),l=s[0],d=s[1],m=s[2];this.layer.hooks.beforeHighlight.call([l,d,m]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,sn.Z)(a,3),l=s[0],d=s[1],m=s[2];this.layer.hooks.beforeSelect.call([l,d,m]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,l=Ee(s);this.selectFeature(new Uint8Array(l))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,l=Ee(s);this.highlightPickedFeature(new Uint8Array(l))}}]),t}(q0))||Km),v2=F(11700),m2=F.n(v2),g2=F(68929),y2=F.n(g2),Jm,eg,tg,Nv,rg;function ng(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function s0(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?ng(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ng(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var _2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,wh=(Jm=(0,wt.b2)(),eg=(0,wt.f3)(Ke.IShaderModuleService),Jm(tg=(Nv=function(){function e(){(0,qt.Z)(this,e),Mt(this,"shaderModuleService",rg,this),(0,b.Z)(this,"rendererService",void 0),(0,b.Z)(this,"config",void 0),(0,b.Z)(this,"quad",_2),(0,b.Z)(this,"enabled",!0),(0,b.Z)(this,"renderToScreen",!1),(0,b.Z)(this,"model",void 0),(0,b.Z)(this,"name",void 0),(0,b.Z)(this,"optionsToUpdate",{})}return(0,Gt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return Jh.PostProcessing}},{key:"init",value:function(t,r){this.config=r,this.rendererService=t.getContainer().get(Ke.IRendererService),this.shaderModuleService=t.getContainer().get(Ke.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,l=a.createBuffer,d=a.createModel,m=this.setupShaders(),y=m.vs,C=m.fs,w=m.uniforms;this.model=d({vs:y,fs:C,attributes:{a_Position:s({buffer:l({data:[-4,-4,4,-4,0,4],type:W.FLOAT}),size:2})},uniforms:s0(s0({u_Texture:null},w),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,r){var a=this,s=t.multiPassRenderer.getPostProcessor(),l=this.rendererService,d=l.useFramebuffer,m=l.getViewportSize,y=l.clear,C=m(),w=C.width,I=C.height;d(this.renderToScreen?null:s.getWriteFBO(),function(){y({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var L=s0({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[w,I]},a.convertOptionsToUniforms(a.optionsToUpdate));r&&(L.u_BloomFinal=1,L.u_Texture2=r),a.model.draw({uniforms:L})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=s0(s0({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var r={};return Object.keys(t).forEach(function(a){Ml()(t[a])||(r["u_".concat(m2()(y2()(a)))]=t[a])}),r}}]),e}(),rg=Pt(Nv.prototype,"shaderModuleService",[eg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv))||tg),ig,ag;function og(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function sg(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?og(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):og(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function x2(e){var i=b2();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function b2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var E2=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,S2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,C2=(ig=(0,wt.b2)(),ig(ag=function(e){(0,Wr.Z)(t,e);var i=x2(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:S2,fs:E2});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,l=a.fs,d=a.uniforms,m=this.rendererService.getViewportSize(),y=m.width,C=m.height;return{vs:s,fs:l,uniforms:sg(sg({},d),{},{u_ViewportSize:[y,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ml()(a.bloomRadius)||(s.u_radius=a.bloomRadius),Ml()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),Ml()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),t}(wh))||ag),ug,lg;function cg(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function fg(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?cg(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):cg(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function A2(e){var i=w2();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function w2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,M2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,P2=(ug=(0,wt.b2)(),ug(lg=function(e){(0,Wr.Z)(t,e);var i=A2(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:M2,fs:T2});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,l=a.fs,d=a.uniforms,m=this.rendererService.getViewportSize(),y=m.width,C=m.height;return{vs:s,fs:l,uniforms:fg(fg({},d),{},{u_ViewportSize:[y,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ml()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),t}(wh))||lg),hg,pg;function dg(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function vg(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?dg(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):dg(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function O2(e){var i=I2();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function I2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,L2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,k2=(hg=(0,wt.b2)(),hg(pg=function(e){(0,Wr.Z)(t,e);var i=O2(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:L2,fs:R2});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,l=a.fs,d=a.uniforms,m=this.rendererService.getViewportSize(),y=m.width,C=m.height;return{vs:s,fs:l,uniforms:vg(vg({},d),{},{u_ViewportSize:[y,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Ml()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),t}(wh))||pg),mg,gg;function yg(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function _g(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?yg(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):yg(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function D2(e){var i=F2();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function F2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,N2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,z2=(mg=(0,wt.b2)(),mg(gg=function(e){(0,Wr.Z)(t,e);var i=D2(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:N2,fs:B2});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,l=a.fs,d=a.uniforms,m=this.rendererService.getViewportSize(),y=m.width,C=m.height;return{vs:s,fs:l,uniforms:_g(_g({},d),{},{u_ViewportSize:[y,C]})}}}]),t}(wh))||gg),xg,bg;function Z2(e){var i=U2();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function U2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,V2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,G2=(xg=(0,wt.b2)(),xg(bg=function(e){(0,Wr.Z)(t,e);var i=Z2(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:V2,fs:j2}),this.shaderModuleService.getModule("copy-pass")}}]),t}(wh))||bg),Eg,Sg;function Cg(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Ag(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Cg(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Cg(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function H2(e){var i=W2();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function W2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Y2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,q2=(Eg=(0,wt.b2)(),Eg(Sg=function(e){(0,Wr.Z)(t,e);var i=H2(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Y2,fs:X2});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,l=a.fs,d=a.uniforms,m=this.rendererService.getViewportSize(),y=m.width,C=m.height;return{vs:s,fs:l,uniforms:Ag(Ag({},d),{},{u_ViewportSize:[y,C]})}}}]),t}(wh))||Sg),wg,Tg;function Mg(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Pg(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Mg(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Mg(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function K2(e){var i=$2();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function $2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Q2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,J2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,eE=(wg=(0,wt.b2)(),wg(Tg=function(e){(0,Wr.Z)(t,e);var i=K2(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:J2,fs:Q2});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,l=a.fs,d=a.uniforms,m=this.rendererService.getViewportSize(),y=m.width,C=m.height;return{vs:s,fs:l,uniforms:Pg(Pg({},d),{},{u_ViewportSize:[y,C]})}}}]),t}(wh))||Tg),Og,Ig;function tE(e){var i=rE();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function rE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nE=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,iE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,aE=(Og=(0,wt.b2)(),Og(Ig=function(e){(0,Wr.Z)(t,e);var i=tE(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:iE,fs:nE}),this.shaderModuleService.getModule("noise-pass")}}]),t}(wh))||Ig),Rg,Lg;function oE(e){var i=sE();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function sE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lE=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,cE=(Rg=(0,wt.b2)(),Rg(Lg=function(e){(0,Wr.Z)(t,e);var i=oE(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:uE,fs:lE}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(wh))||Lg),kg,Dg,Fg,Bg,bd,Ng,fE=(kg=(0,wt.b2)(),Dg=(0,wt.f3)(Ke.IRendererService),Fg=(0,wt.zY)(),kg(Bg=(bd=function(){function e(){(0,qt.Z)(this,e),Mt(this,"rendererService",Ng,this),(0,b.Z)(this,"passes",[]),(0,b.Z)(this,"readFBO",void 0),(0,b.Z)(this,"writeFBO",void 0)}return(0,Gt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,r=t.getViewportSize,a=t.createTexture2D,s=r(),l=s.width,d=s.height;return a({x:0,y:0,width:l,height:d,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,r=this.rendererService.useFramebuffer;return new Promise(function(a,s){r(t.readFBO,(0,Ta.Z)(Sn().mark(function l(){return Sn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:a(t.getCurrentFBOTex());case 1:case"end":return m.stop()}},l)})))})}},{key:"renderBloomPass",value:function(){var i=(0,Ta.Z)(Sn().mark(function r(a,s){var l,d;return Sn().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,this.getReadFBOTex();case 2:l=y.sent,d=0;case 4:if(!(d<4)){y.next=11;break}return y.next=7,s.render(a,l);case 7:this.swap(),d++,y.next=4;break;case 11:case"end":return y.stop()}},r,this)}));function t(r,a){return i.apply(this,arguments)}return t}()},{key:"render",value:function(){var i=(0,Ta.Z)(Sn().mark(function r(a){var s,l;return Sn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:s=0;case 1:if(!(s<this.passes.length)){m.next=15;break}if(l=this.passes[s],l.setRenderToScreen(this.isLastEnabledPass(s)),l.getName()!=="bloom"){m.next=9;break}return m.next=7,this.renderBloomPass(a,l);case 7:m.next=12;break;case 9:return m.next=11,l.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,m.next=1;break;case 15:case"end":return m.stop()}},r,this)}));function t(r){return i.apply(this,arguments)}return t}()},{key:"resize",value:function(t,r){this.readFBO.resize({width:t,height:r}),this.writeFBO.resize({width:t,height:r})}},{key:"add",value:function(t,r,a){t.init(r,a),this.passes.push(t)}},{key:"insert",value:function(t,r,a,s){t.init(a,s),this.passes.splice(r,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(r){return r.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,r=t.createFramebuffer,a=t.createTexture2D;this.readFBO=r({color:a({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.writeFBO=r({color:a({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var r=t+1;r<this.passes.length;r++)if(this.passes[r].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),Ng=Pt(bd.prototype,"rendererService",[Dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt(bd.prototype,"init",[Fg],Object.getOwnPropertyDescriptor(bd.prototype,"init"),bd.prototype),bd))||Bg),zg,Zg;function hE(e){var i=pE();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function pE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dE=(zg=(0,wt.b2)(),zg(Zg=function(e){(0,Wr.Z)(t,e);var i=hE(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getType",value:function(){return Jh.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,Y0.Z)((0,yt.Z)(t.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,l=s.useFramebuffer,d=s.clear,m=a.multiPassRenderer.getPostProcessor().getReadFBO();l(m,function(){d({color:[0,0,0,0],depth:1,stencil:0,framebuffer:m}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(y){y.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),t}(q0))||Zg),Ug,jg,Vg,zv,Gg;function Hg(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Wg(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Hg(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Hg(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function vE(e){var i=mE();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function mE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gE=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Xg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,yE=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Yg(e,i){for(var t=0,r=1/i,a=e;a>0;)t=t+r*(a%i),a=Math.floor(a/i),r=r/i;return t}var _E=1,xE=(Ug=(0,wt.b2)(),jg=(0,wt.f3)(Ke.IShaderModuleService),Ug(Vg=(zv=function(e){(0,Wr.Z)(t,e);var i=vE(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),Mt((0,he.Z)(r),"shaderModuleService",Gg,(0,he.Z)(r)),(0,b.Z)((0,he.Z)(r),"haltonSequence",[]),(0,b.Z)((0,he.Z)(r),"accumulatingId",0),(0,b.Z)((0,he.Z)(r),"frame",0),(0,b.Z)((0,he.Z)(r),"timer",void 0),(0,b.Z)((0,he.Z)(r),"sampleRenderTarget",void 0),(0,b.Z)((0,he.Z)(r),"prevRenderTarget",void 0),(0,b.Z)((0,he.Z)(r),"outputRenderTarget",void 0),(0,b.Z)((0,he.Z)(r),"copyRenderTarget",void 0),(0,b.Z)((0,he.Z)(r),"blendModel",void 0),(0,b.Z)((0,he.Z)(r),"outputModel",void 0),(0,b.Z)((0,he.Z)(r),"copyModel",void 0),r}return(0,Gt.Z)(t,[{key:"getType",value:function(){return Jh.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,Y0.Z)((0,yt.Z)(t.prototype),"init",this).call(this,a,s);var l=this.rendererService,d=l.createFramebuffer,m=l.createTexture2D;this.sampleRenderTarget=d({color:m({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.prevRenderTarget=d({color:m({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.outputRenderTarget=d({color:m({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})}),this.copyRenderTarget=d({color:m({width:1,height:1,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE})});for(var y=0;y<30;y++)this.haltonSequence.push([Yg(y,2),Yg(y,3)]);this.blendModel=this.createTriangleModel("blend-pass",gE),this.outputModel=this.createTriangleModel("copy-pass",Xg,{blend:{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE_MINUS_SRC_ALPHA,srcAlpha:W.ONE,dstAlpha:W.ONE_MINUS_SRC_ALPHA},equation:{rgb:W.FUNC_ADD,alpha:W.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Xg)}},{key:"render",value:function(a){var s=this,l=this.rendererService,d=l.clear,m=l.getViewportSize,y=l.useFramebuffer,C=m(),w=C.width,I=C.height;this.sampleRenderTarget.resize({width:w,height:I}),this.prevRenderTarget.resize({width:w,height:I}),this.outputRenderTarget.resize({width:w,height:I}),this.copyRenderTarget.resize({width:w,height:I}),this.resetFrame(),this.stopAccumulating();var L=a.multiPassRenderer.getPostProcessor().getReadFBO();y(L,function(){d({color:[0,0,0,0],depth:1,stencil:0,framebuffer:L}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var U=function K(ae){!s.accumulatingId||ae!==s.accumulatingId||s.isFinished()||(s.doRender(a),Gi.requestAnimationFrame(function(){K(ae)}))};this.accumulatingId=_E++,this.timer=Gi.setTimeout(function(){U(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,l=this.rendererService,d=l.clear,m=l.getViewportSize,y=l.useFramebuffer,C=m(),w=C.width,I=C.height,L=a.getLayerConfig(),U=L.jitterScale,K=U===void 0?1:U,ae=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ae[0]*2-1)/w*K,(ae[1]*2-1)/I*K),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),y(this.sampleRenderTarget,function(){d({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var Ae=a.getLayerConfig();y(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:Ae.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&d({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(y(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),y(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Ge=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Ge,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Gi.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,l){this.shaderModuleService.registerModule(a,{vs:yE,fs:s});var d=this.shaderModuleService.getModule(a),m=d.vs,y=d.fs,C=d.uniforms,w=this.rendererService,I=w.createAttribute,L=w.createBuffer,U=w.createModel;return U(Wg({vs:m,fs:y,attributes:{a_Position:I({buffer:L({data:[-4,-4,4,-4,0,4],type:W.FLOAT}),size:2})},uniforms:Wg({},C),depth:{enable:!1},count:3},l))}}]),t}(q0),Gg=Pt(zv.prototype,"shaderModuleService",[jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zv))||Vg),u0=new wt.W2;u0.bind(Ke.IGlobalConfigService).to($t).inSingletonScope(),(0,wt.GW)((0,wt.b2)(),Ja.EventEmitter),u0.bind(Ke.IEventEmitter).to(Ja.EventEmitter);var qg=(0,Gr.Z)(u0,!1),Zv=function(i){var t=qg.lazyInject(i);return function(r,a,s){t.call(this,r,a),s&&(s.initializer=function(){return r[a]})}},hO=function(i){var t=qg.lazyMultiInject(i);return function(r,a,s){t.call(this,r,a),s&&(s.initializer=function(){return r[a]})}},Kl=u0,bE=0;function EE(){var e=new wt.W2;return e.parent=u0,e.bind(Ke.SceneID).toConstantValue("".concat(bE++)),e.bind(Ke.IShaderModuleService).to(a2).inSingletonScope(),e.bind(Ke.ILayerService).to(B0).inSingletonScope(),e.bind(Ke.ISceneService).to(zb).inSingletonScope(),e.bind(Ke.ICameraService).to(kv).inSingletonScope(),e.bind(Ke.ICoordinateSystemService).to(pf).inSingletonScope(),e.bind(Ke.IInteractionService).to(Lp).inSingletonScope(),e.bind(Ke.IPickingService).to(Wd).inSingletonScope(),e.bind(Ke.IControlService).to(u).inSingletonScope(),e.bind(Ke.IMarkerService).to(E).inSingletonScope(),e.bind(Ke.IIconService).to(ma).inSingletonScope(),e.bind(Ke.IFontService).to(ps).inSingletonScope(),e.bind(Ke.IPopupService).to(B).inSingletonScope(),e.bind(Ke.INormalPass).to(u2).whenTargetNamed("clear"),e.bind(Ke.INormalPass).to(d2).whenTargetNamed("pixelPicking"),e.bind(Ke.INormalPass).to(dE).whenTargetNamed("render"),e.bind(Ke.INormalPass).to(xE).whenTargetNamed("taa"),e.bind(Ke.IFactoryNormalPass).toFactory(function(i){return function(t){return i.container.getNamed(Ke.INormalPass,t)}}),e.bind(Ke.IPostProcessingPass).to(G2).whenTargetNamed("copy"),e.bind(Ke.IPostProcessingPass).to(C2).whenTargetNamed("bloom"),e.bind(Ke.IPostProcessingPass).to(P2).whenTargetNamed("blurH"),e.bind(Ke.IPostProcessingPass).to(k2).whenTargetNamed("blurV"),e.bind(Ke.IPostProcessingPass).to(aE).whenTargetNamed("noise"),e.bind(Ke.IPostProcessingPass).to(cE).whenTargetNamed("sepia"),e.bind(Ke.IPostProcessingPass).to(z2).whenTargetNamed("colorHalftone"),e.bind(Ke.IPostProcessingPass).to(q2).whenTargetNamed("hexagonalPixelate"),e.bind(Ke.IPostProcessingPass).to(eE).whenTargetNamed("ink"),e.bind(Ke.IFactoryPostProcessingPass).toFactory(function(i){return function(t){var r=i.container.getNamed(Ke.IPostProcessingPass,t);return r.setName(t),r}}),e}function Uv(e){var i=new wt.W2;return i.parent=e,i.bind(Ke.IStyleAttributeService).to(Kd).inSingletonScope(),i.bind(Ke.IMultiPassRenderer).to(f2).inSingletonScope(),i.bind(Ke.IPostProcessor).to(fE).inSingletonScope(),i}var pO=F(74691),SE=null;function dO(e){return SE.indexOf(e)}var CE=2,vO=4,AE=64,mO=128,wE=256,TE=512,gO=8192,yO=16384,_O=32768,ME=null,Kg=131072,xO=262144,PE=524288,bO=1048576,OE=2097152,EO=4194304,IE=8388608,RE=16777216,LE=null;function K0(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function SO(e){var i=e.color,t=e.radius,r=e.tileX,a=e.tileY,s=e.shape,l=e.opacity,d=e.stroke,m=e.strokeWidth,y=e.strokeOpacity,C=[],w=[],I=[],L=[K0(i[0],i[1]),K0(i[2],i[3])],U=[K0(d[0],d[1]),K0(d[2],d[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(K){var ae=_slicedToArray(K,2),Ae=ae[0],Ge=ae[1];C.push([].concat(L,[(Ae+1)*IE+(Ge+1)*OE+getShapeIndex(s)*Kg+t,(r+512)*PE+(a+512)*AE])),w.push([].concat(U,[m,y])),I.push([l,0,0,0])}),{packedBuffer:C,packedBuffer2:w,packedBuffer3:I}}function CO(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var t=i?1:0,r=Math.floor(e*127);return r*LE+t*RE+r*Kg+t*ME+r*TE+t*wE+r*CE+t}var Tc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Tc||(Tc={}));var eo;(function(e){e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging"})(eo||(eo={}));var ep;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(ep||(ep={}));var Ln;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Ln||(Ln={}));var kE=["mapload","mapchange","mapAfterFrameChange"],Zp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},jv=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],tp;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(tp||(tp={}));function $g(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Qg(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?$g(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$g(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function DE(e){var i=FE();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function FE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BE=0,$0=function(e){(0,Wr.Z)(t,e);var i=DE(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this),(0,b.Z)((0,he.Z)(a),"controlOption",void 0),(0,b.Z)((0,he.Z)(a),"container",void 0),(0,b.Z)((0,he.Z)(a),"sceneContainer",void 0),(0,b.Z)((0,he.Z)(a),"mapsService",void 0),(0,b.Z)((0,he.Z)(a),"renderService",void 0),(0,b.Z)((0,he.Z)(a),"layerService",void 0),(0,b.Z)((0,he.Z)(a),"controlService",void 0),(0,b.Z)((0,he.Z)(a),"isShow",void 0),a.controlOption=Qg(Qg({},a.getDefault()),r||{}),a}return(0,Gt.Z)(t,[{key:"getDefault",value:function(){return{position:tp.TOPRIGHT,name:"".concat(BE++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:tp.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(Ke.IMapService),this.renderService=a.get(Ke.IRendererService),this.layerService=a.get(Ke.ILayerService),this.controlService=a.get(Ke.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,l=this.controlOption.position,d=this.controlService.controlCorners[l];return Va(s,"l7-control"),l.indexOf("bottom")!==-1?d.insertBefore(s,d.firstChild):d.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Va(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;Bu(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Zs(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),t}(Ja.EventEmitter);function NE(e){var i=zE();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function zE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AO=function(e){(0,Wr.Z)(t,e);var i=NE(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this,r),(0,b.Z)((0,he.Z)(a),"layerControlInputs",void 0),(0,b.Z)((0,he.Z)(a),"layers",void 0),(0,b.Z)((0,he.Z)(a),"lastZIndex",void 0),(0,b.Z)((0,he.Z)(a),"handlingClick",void 0),(0,b.Z)((0,he.Z)(a),"layersLink",void 0),(0,b.Z)((0,he.Z)(a),"baseLayersList",void 0),(0,b.Z)((0,he.Z)(a),"separator",void 0),(0,b.Z)((0,he.Z)(a),"overlaysList",void 0),(0,b.Z)((0,he.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),T(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,he.Z)(a)),a}return(0,Gt.Z)(t,[{key:"getDefault",value:function(){return{collapsed:!0,position:tp.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Va(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var l=s-(this.container.offsetTop+50);return l<this.form.clientHeight?(Va(this.form,"l7-control-layers-scrollbar"),this.form.style.height=l+"px"):Bu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Bu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=za("div",a),l=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var d=this.form=za("form",a+"-list");l&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=za("a",a+"-toggle",s);var m=this.layersLink;m.title="Layers",l||this.expand(),this.baseLayersList=za("div",a+"-base",d),this.separator=za("div",a+"-separator",d),this.overlaysList=za("div",a+"-overlays",d),s.appendChild(d)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,l=s.baseLayers,d=l===void 0?{}:l,m=s.overlayers,y=m===void 0?{}:m;Object.keys(d).forEach(function(C,w){a.addLayer(d[C],C,!1)}),Object.keys(y).forEach(function(C,w){a.addLayer(y[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;$a(this.baseLayersList),$a(this.overlaysList),this.layerControlInputs=[];var a,s,l,d,m=0;for(l=0;l<this.layers.length;l++)d=this.layers[l],this.addItem(d),s=s||d.overlay,a=a||!d.overlay,m+=d.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&m>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,l,d=this.mapsService.getZoom(),m=a.length-1;m>=0;m--)if(s=a[m],l=this.layerService.getLayer(s.layerId),l&&l.inited){var y=l.getMinZoom(),C=l.getMaxZoom();s.disabled=d<y||d>C}}},{key:"addLayer",value:function(a,s,l){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:l});var d=this.controlOption,m=d.sortLayers,y=d.sortFunction,C=d.autoZIndex;m&&this.layers.sort(function(w,I){return y(w.layer,I.layer,w.name,I.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),l=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;l&&this.emit(l,s)}},{key:"createRadioElement",value:function(a,s){var l='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",d=document.createElement("div");return d.innerHTML=l,d.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),l=this.layerService.getLayer(a.layer.id),d=l&&l.inited&&a.layer.isVisible(),m;a.overlay?(m=document.createElement("input"),m.type="checkbox",m.className="l7-control-layers-selector",m.defaultChecked=d):m=this.createRadioElement("l7-base-layers",d),this.layerControlInputs.push(m),m.layerId=a.layer.id,m.addEventListener("click",this.onInputClick);var y=document.createElement("span");y.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(m),C.appendChild(y);var w=a.overlay?this.overlaysList:this.baseLayersList;return w.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,l,d=[],m=[];this.handlingClick=!0;for(var y=a.length-1;y>=0;y--)s=a[y],l=this.layerService.getLayer(s.layerId),s.checked?d.push(l):s.checked||m.push(l);m.forEach(function(C){C.hide()}),d.forEach(function(C){C.show()}),this.handlingClick=!1}}]),t}($0);function ZE(e){var i=UE();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function UE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jE=function(e){(0,Wr.Z)(t,e);var i=ZE(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getDefault",value:function(){return{position:tp.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=za("div",a),l=za("a","l7-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://antv.alipay.com/l7",l.setAttribute("aria-label","AntV logo"),l.setAttribute("rel","noopener nofollow"),s.appendChild(l),s}},{key:"onRemove",value:function(){return null}}]),t}($0);function VE(e){var i=GE();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function GE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wO=function(e){(0,Wr.Z)(t,e);var i=VE(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this,r),(0,b.Z)((0,he.Z)(a),"mScale",void 0),(0,b.Z)((0,he.Z)(a),"iScale",void 0),T(["update"],(0,he.Z)(a)),a}return(0,Gt.Z)(t,[{key:"getDefault",value:function(){return{position:tp.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=za("div",a);this.addScales(a+"-line",s);var l=this.controlOption.updateWhenIdle;return this.mapsService.on(l?"moveend":"mapmove",this.update),this.mapsService.on(l?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,l=a.getSize()[1]/2,d=a.containerToLngLat([0,l]),m=a.containerToLngLat([s,l]),y=gl([d.lng,d.lat],[m.lng,m.lat]);this.updateScales(y)}},{key:"updateScales",value:function(a){var s=this.controlOption,l=s.metric,d=s.imperial;l&&a&&this.updateMetric(a),d&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),l=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,l,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,l,d,m;s>5280?(l=s/5280,d=this.getRoundNum(l),this.updateScale(this.iScale,d+" mi",d/l)):(m=this.getRoundNum(s),this.updateScale(this.iScale,m+" ft",m/s))}},{key:"updateScale",value:function(a,s,l){var d=this.controlOption.maxWidth;a.style.width=Math.round(d*l)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),l=a/s;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:1,s*l}},{key:"addScales",value:function(a,s){var l=this.controlOption,d=l.metric,m=l.imperial;d&&(this.mScale=za("div",a,s)),m&&(this.iScale=za("div",a,s))}}]),t}($0);function HE(e){var i=WE();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function WE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TO=function(e){(0,Wr.Z)(t,e);var i=HE(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this,r),(0,b.Z)((0,he.Z)(a),"disabled",void 0),(0,b.Z)((0,he.Z)(a),"zoomInButton",void 0),(0,b.Z)((0,he.Z)(a),"zoomOutButton",void 0),T(["updateDisabled","zoomIn","zoomOut"],(0,he.Z)(a)),a}return(0,Gt.Z)(t,[{key:"getDefault",value:function(){return{position:tp.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=za("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,l,d,m){var y=za("a",l,d);return y.innerHTML=a,y.title=s,y.href="javascript:void(0)",y.addEventListener("click",m),y}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";Bu(this.zoomInButton,s),Bu(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Va(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Va(this.zoomInButton,s)}}]),t}($0);function Jg(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function ey(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Jg(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Jg(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function XE(e){var i=YE();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function YE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ty=function(e){(0,Wr.Z)(t,e);var i=XE(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this),(0,b.Z)((0,he.Z)(a),"markerOption",void 0),(0,b.Z)((0,he.Z)(a),"defaultMarker",void 0),(0,b.Z)((0,he.Z)(a),"popup",void 0),(0,b.Z)((0,he.Z)(a),"mapsService",void 0),(0,b.Z)((0,he.Z)(a),"sceneSerive",void 0),(0,b.Z)((0,he.Z)(a),"lngLat",void 0),(0,b.Z)((0,he.Z)(a),"scene",void 0),(0,b.Z)((0,he.Z)(a),"added",!1),(0,b.Z)((0,he.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=ey(ey({},a.getDefault()),r),T(["update","onMove","onUp","addDragHandler","onMapClick"],(0,he.Z)(a)),a.init(),a}return(0,Gt.Z)(t,[{key:"getDefault",value:function(){return{element:void 0,anchor:We.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(Ke.IMapService),this.sceneSerive=a.get(Ke.ISceneService);var s=this.markerOption,l=s.element,d=s.draggable;return this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&Zs(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var l=this.markerOption.element;return l&&Zs(l),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,l=a.anchor;this.updatePosition(),vl(s,"".concat(je[l]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,l=a.offsets,d=this.lngLat,m=d.lng,y=d.lat,C=this.mapsService.getBounds(),w=this.mapsService.lngLatToContainer([m,y]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var I=this.mapsService.getContainer(),L=0,U=0;if(I&&(L=I.scrollWidth,U=I.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(w.x>L){var K=this.mapsService.lngLatToContainer([m-360,y]);w.x=K.x}if(w.x<0){var ae=this.mapsService.lngLatToContainer([m+360,y]);w.x=ae.x}}(w.x>L||w.x<0||w.y>U||w.y<0)&&(s.style.display="none"),s.style.left=w.x+l[0]+"px",s.style.top=w.y-l[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,l=this.markerOption,d=l.color,m=l.anchor;if(!s){this.defaultMarker=!0,s=za("div"),this.markerOption.element=s;var y=document.createElementNS("http://www.w3.org/2000/svg","svg");y.setAttributeNS(null,"display","block"),y.setAttributeNS(null,"height","48px"),y.setAttributeNS(null,"width","48px"),y.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",d),y.appendChild(C),s.appendChild(y)}Va(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(w){var I,L,U=((I=a.markerOption)===null||I===void 0?void 0:I.style)&&((L=a.markerOption)===null||L===void 0?void 0:L.style[w]);s&&(s.style[w]=U)}),s.addEventListener("click",function(w){a.onMapClick(w)}),s.addEventListener("click",this.eventHandle),lt(s,m,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),t}(Ja.EventEmitter);function ry(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function ny(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?ry(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ry(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function qE(e){var i=KE();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function KE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MO=function(e){(0,Wr.Z)(t,e);var i=qE(t);function t(r){var a,s;return(0,qt.Z)(this,t),s=i.call(this),(0,b.Z)((0,he.Z)(s),"markers",[]),(0,b.Z)((0,he.Z)(s),"markerLayerOption",void 0),(0,b.Z)((0,he.Z)(s),"clusterIndex",void 0),(0,b.Z)((0,he.Z)(s),"points",[]),(0,b.Z)((0,he.Z)(s),"clusterMarkers",[]),(0,b.Z)((0,he.Z)(s),"mapsService",void 0),(0,b.Z)((0,he.Z)(s),"scene",void 0),(0,b.Z)((0,he.Z)(s),"zoom",void 0),(0,b.Z)((0,he.Z)(s),"bbox",void 0),s.markerLayerOption=H()(s.getDefault(),r),T(["update"],(0,he.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,Gt.Z)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(Ke.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var l=this.mapsService.getZoom(),d=this.mapsService.getBounds();this.bbox=pu(d,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var l=a.getLnglat(),d=l.lng,m=l.lat,y={geometry:{type:"Point",coordinates:[d,m]},properties:ny(ny({},a.getExtData()),{},{marker_id:s})};this.points.push(y),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,l=a.minZoom,d=l===void 0?0:l,m=a.maxZoom;this.clusterIndex=new(yp())({radius:s,minZoom:d,maxZoom:m}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var l=this,d=a[0].concat(a[1]),m=this.clusterIndex.getClusters(d,s);this.clusterMarkers.forEach(function(y){y.remove()}),this.clusterMarkers=[],m.forEach(function(y){var C,w=l.markerLayerOption.clusterOption,I=w.field,L=w.method;if(y.properties&&(C=y.properties)!==null&&C!==void 0&&C.cluster_id){var U,K=l.getLeaves((U=y.properties)===null||U===void 0?void 0:U.cluster_id);if(y.properties.clusterData=K,I&&L){var ae=K==null?void 0:K.map(function(zt){var Ot=(0,b.Z)({},I,zt.properties[I]);return Ot}),Ae=cu(ae,I),Ge=Ps(L,Ae),ot="point_"+L;y.properties[ot]=Ge.toFixed(2)}}var St=l.clusterMarker(y);l.clusterMarkers.push(St),St.addTo(l.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,l):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,l=s,d=l.element,m=d===void 0?this.generateElement.bind(this):d,y=new ty({element:m(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return y}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!Is(this.bbox,s))&&(this.bbox=pu(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=za("div","l7-marker-cluster"),l=za("div","",s),d=za("span","",l),m=this.markerLayerOption.clusterOption,y=m.field,C=m.method;a.properties.point_count=a.properties.point_count||1;var w=y&&C?a.properties["point_"+C]||a.properties[y]:a.properties.point_count;return d.textContent=w,s}}]),t}(Ja.EventEmitter);function iy(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function ay(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?iy(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):iy(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function $E(e){var i=QE();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function QE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oy=function(e){(0,Wr.Z)(t,e);var i=$E(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this),(0,b.Z)((0,he.Z)(a),"popupOption",void 0),(0,b.Z)((0,he.Z)(a),"mapsService",void 0),(0,b.Z)((0,he.Z)(a),"sceneSerive",void 0),(0,b.Z)((0,he.Z)(a),"lngLat",void 0),(0,b.Z)((0,he.Z)(a),"content",void 0),(0,b.Z)((0,he.Z)(a),"closeButton",void 0),(0,b.Z)((0,he.Z)(a),"timeoutInstance",void 0),(0,b.Z)((0,he.Z)(a),"container",void 0),(0,b.Z)((0,he.Z)(a),"tip",void 0),(0,b.Z)((0,he.Z)(a),"scene",void 0),a.popupOption=ay(ay({},a.getdefault()),r),T(["update","onClickClose","remove"],(0,he.Z)(a)),a}return(0,Gt.Z)(t,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(Ke.IMapService),this.sceneSerive=a.get(Ke.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),l=window.document.createElement("body"),d;for(l.innerHTML=a;d=l.firstChild,!!d;)s.appendChild(d);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Zs(this.content),this.content=za("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=za("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,l){var d=window.document.createElement(a);return s!==void 0&&(d.className=s),l&&l.appendChild(d),d}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:We.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,l=this.popupOption,d=l.className,m=l.maxWidth,y=l.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),d&&d.split(" ").forEach(function(I){return a.container.classList.add(I)});var w=this.popupOption.stopPropagation;w&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(I){a.container.addEventListener(I,function(L){L.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}m&&this.container.style.maxWidth!==m&&(this.container.style.maxWidth=m),this.updatePosition(),vl(this.container,"".concat(je[y])),lt(this.container,y,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,l=a.lat,d=this.popupOption.offsets,m=this.mapsService.lngLatToContainer([s,l]);this.container.style.left=m.x+d[0]+"px",this.container.style.top=m.y-d[1]+"px"}}}]),t}(Ja.EventEmitter);function JE(e,i){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,r=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||r)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var l=i.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=e:l.appendChild(i.createTextNode(e)),a.appendChild(l),l}}JE(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.3);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var eS=F(52353),tS=F.n(eS),rS=F(13218),Hu=F.n(rS),rp,sy=(rp={},(0,b.Z)(rp,Tc.additive,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE,srcAlpha:1,dstAlpha:1}}),(0,b.Z)(rp,Tc.none,{enable:!1}),(0,b.Z)(rp,Tc.normal,{enable:!0,func:{srcRGB:W.SRC_ALPHA,dstRGB:W.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,b.Z)(rp,Tc.subtractive,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE,srcAlpha:W.ZERO,dstAlpha:W.ONE_MINUS_SRC_COLOR},equation:{rgb:W.FUNC_SUBTRACT,alpha:W.FUNC_SUBTRACT}}),(0,b.Z)(rp,Tc.max,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE},equation:{rgb:W.MAX_EXT}}),(0,b.Z)(rp,Tc.min,{enable:!0,func:{srcRGB:W.ONE,dstRGB:W.ONE},equation:{rgb:W.MIN_EXT}}),rp),nS=F(81763),pa=F.n(nS),PO=1024;function ol(e,i,t,r,a){i.updateStyleAttribute(e,t,r,a)}function iS(e,i){e.opacity&&Q0("opacity",i,e.opacity),e.strokeWidth&&Q0("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Q0("strokeOpacity",i,e.strokeOpacity),e.stroke&&aS("stroke",i,e.stroke),e.offsets&&uy("offsets",i,e.offsets),e.textOffset&&uy("textOffset",i,e.textOffset),e.thetaOffset&&Q0("thetaOffset",i,e.thetaOffset)}function Q0(e,i,t){gu()(t)?ol(e,i,t,function(r){return r}):pa()(t)?ol(e,i,[t],void 0):Array.isArray(t)&&t.length===2?gu()(t[0])&&ru()(t[1])||gu()(t[0])&&Array.isArray(t[1])&&pa()(t[1][0])&&pa()(t[1][1])?ol(e,i,t[0],t[1]):ol(e,i,[1],void 0):ol(e,i,[1],void 0)}function uy(e,i,t){gu()(t)?ol(e,i,t,function(r){return r}):Array.isArray(t)&&t.length===2&&gu()(t[0])&&ru()(t[1])?ol(e,i,t[0],t[1]):Array.isArray(t)&&t.length===2&&pa()(t[0])&&pa()(t[1])?ol(e,i,t,void 0):ol(e,i,[0,0],void 0)}function aS(e,i,t){gu()(t)?ol(e,i,t,void 0):Array.isArray(t)&&t.length===2&&(gu()(t[0])&&ru()(t[1])||gu()(t[0])&&Array.isArray(t[1])&&t[1].length>0)?ol(e,i,t[0],t[1]):ol(e,i,"#fff",void 0)}var ss;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(ss||(ss={}));function oS(e,i){var t=[i[0]-e[0],i[1]-e[1]],r=vc(t),a=[e[0]+r[0]*1e-4,e[1]+r[1]*1e-4];return a}function sS(e,i){var t=this;e.length>0&&i.version===ss["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(r){return!r.originCoordinates}).map(function(r){r.version=ss["GAODE2.x"],r.originCoordinates=cloneDeep(r.coordinates),r.coordinates=t.mapService.lngLatToCoord(r.coordinates)}):e.filter(function(r){return!r.originCoordinates}).map(function(r){r.version=ss["GAODE2.x"],r.originCoordinates=cloneDeep(r.coordinates),r.coordinates=t.mapService.lngLatToCoords(r.coordinates)}))}function uS(e,i){e.length>0&&i.version===ss.SIMPLE&&e.map(function(t){t.simpleCoordinate||(t.coordinates=lS(t.coordinates,i),t.simpleCoordinate=!0)})}function lS(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var t=[];return e.map(function(a){var s=[];a.map(function(l){s.push(i.simpleMapCoord.unproject(l))}),t.push(s)}),t}else{var r=[];return e.map(function(a){r.push(i.simpleMapCoord.unproject(a))}),r}}function cS(e,i,t){var r;if(!e.scale)return[];var a=(e==null||(r=e.scale)===null||r===void 0?void 0:r.scalers)||[],s=[];a.forEach(function(d){var m,y=d.field;(i.hasOwnProperty(y)||((m=e.scale)===null||m===void 0?void 0:m.type)==="variable")&&s.push(i[y])});var l=e.mapping?e.mapping(s):[];return e.name==="color"&&!G(l[0])?[t]:l}function fS(e,i,t,r,a,s){var l=s==null?void 0:s.getLayerConfig(),d=l.arrow,m=d===void 0?{enable:!1}:d,y=i.map(function(C){var w={id:C._id,coordinates:C.coordinates};if(e.filter(function(U){return U.scale!==void 0}).forEach(function(U){var K=cS(U,C,a);U.needRemapping=!1,U.name==="color"&&(K=K.map(function(ae){return Q(ae)})),w[U.name]=Array.isArray(K)&&K.length===1?K[0]:K,U.name==="shape"&&(w.shape=t.getIconFontKey(w[U.name]))}),w.shape==="line"&&m.enable){var I=w.coordinates,L=oS(I[0],I[1]);w.coordinates.splice(1,0,L,L)}return w});return sS(y,r),uS(y,r),y}function hS(e,i,t,r,a,s){var l=new Tr(a,s),d=e.getBottomColor(),m=r.getLayerStyleAttributes()||[],y=l.data.dataArray,C=y,w=fS(m,C,i,t,d,e);return l.destroy(),w}function ly(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function cy(e,i,t,r){var a=e.multiPassRenderer,s=e.getLayerConfig(),l=s.enablePicking,d=s.enableTAA;return d?a.add(r("taa")):a.add(r("render")),ly(i).forEach(function(m){var y=(0,sn.Z)(m,2),C=y[0],w=y[1];a.add(t(C),w)}),a.add(t("copy")),a}var pS=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function dS(e,i,t){if(typeof i=="string"&&typeof t=="string"&&i!==t){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}pS.map(function(r){if(r.includes(i)&&r.includes(t)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var vS=["passes"],mS=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],fy,Vv,hy;function gS(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=yS(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function yS(e,i){if(!!e){if(typeof e=="string")return py(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return py(e,i)}}function py(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function dy(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Wu(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?dy(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):dy(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _S(e){var i=xS();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function xS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vy=0,Gf=(fy=Zv(Ke.IGlobalConfigService),Vv=function(e){(0,Wr.Z)(t,e);var i=_S(t);function t(){var r,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,qt.Z)(this,t),r=i.call(this),(0,b.Z)((0,he.Z)(r),"id","".concat(vy++)),(0,b.Z)((0,he.Z)(r),"name","".concat(vy)),(0,b.Z)((0,he.Z)(r),"type",void 0),(0,b.Z)((0,he.Z)(r),"visible",!0),(0,b.Z)((0,he.Z)(r),"zIndex",0),(0,b.Z)((0,he.Z)(r),"minZoom",void 0),(0,b.Z)((0,he.Z)(r),"maxZoom",void 0),(0,b.Z)((0,he.Z)(r),"inited",!1),(0,b.Z)((0,he.Z)(r),"layerModelNeedUpdate",!1),(0,b.Z)((0,he.Z)(r),"pickedFeatureID",null),(0,b.Z)((0,he.Z)(r),"selectedFeatureID",null),(0,b.Z)((0,he.Z)(r),"styleNeedUpdate",!1),(0,b.Z)((0,he.Z)(r),"rendering",void 0),(0,b.Z)((0,he.Z)(r),"clusterZoom",0),(0,b.Z)((0,he.Z)(r),"layerType",void 0),(0,b.Z)((0,he.Z)(r),"triangulation",void 0),(0,b.Z)((0,he.Z)(r),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,b.Z)((0,he.Z)(r),"hooks",{init:new gp,afterInit:new gp,beforeRender:new gp,beforeRenderData:new Bd,afterRender:new yu,beforePickingEncode:new yu,afterPickingEncode:new yu,beforeHighlight:new yu(["pickedColor"]),afterHighlight:new yu,beforeSelect:new yu(["pickedColor"]),afterSelect:new yu,beforeDestroy:new yu,afterDestroy:new yu}),(0,b.Z)((0,he.Z)(r),"models",[]),(0,b.Z)((0,he.Z)(r),"multiPassRenderer",void 0),(0,b.Z)((0,he.Z)(r),"plugins",void 0),(0,b.Z)((0,he.Z)(r),"sourceOption",void 0),(0,b.Z)((0,he.Z)(r),"layerModel",void 0),(0,b.Z)((0,he.Z)(r),"shapeOption",void 0),(0,b.Z)((0,he.Z)(r),"sceneContainer",void 0),(0,b.Z)((0,he.Z)(r),"tileLayer",void 0),(0,b.Z)((0,he.Z)(r),"layerChildren",[]),(0,b.Z)((0,he.Z)(r),"masks",[]),(0,b.Z)((0,he.Z)(r),"isVector",!1),Mt((0,he.Z)(r),"configService",hy,(0,he.Z)(r)),(0,b.Z)((0,he.Z)(r),"shaderModuleService",void 0),(0,b.Z)((0,he.Z)(r),"cameraService",void 0),(0,b.Z)((0,he.Z)(r),"coordinateService",void 0),(0,b.Z)((0,he.Z)(r),"iconService",void 0),(0,b.Z)((0,he.Z)(r),"fontService",void 0),(0,b.Z)((0,he.Z)(r),"pickingService",void 0),(0,b.Z)((0,he.Z)(r),"rendererService",void 0),(0,b.Z)((0,he.Z)(r),"layerService",void 0),(0,b.Z)((0,he.Z)(r),"interactionService",void 0),(0,b.Z)((0,he.Z)(r),"mapService",void 0),(0,b.Z)((0,he.Z)(r),"styleAttributeService",void 0),(0,b.Z)((0,he.Z)(r),"layerSource",void 0),(0,b.Z)((0,he.Z)(r),"postProcessingPassFactory",void 0),(0,b.Z)((0,he.Z)(r),"normalPassFactory",void 0),(0,b.Z)((0,he.Z)(r),"animateOptions",{enable:!1}),(0,b.Z)((0,he.Z)(r),"container",void 0),(0,b.Z)((0,he.Z)(r),"encodedData",void 0),(0,b.Z)((0,he.Z)(r),"configSchema",void 0),(0,b.Z)((0,he.Z)(r),"currentPickId",null),(0,b.Z)((0,he.Z)(r),"rawConfig",void 0),(0,b.Z)((0,he.Z)(r),"needUpdateConfig",void 0),(0,b.Z)((0,he.Z)(r),"pendingStyleAttributes",[]),(0,b.Z)((0,he.Z)(r),"scaleOptions",{}),(0,b.Z)((0,he.Z)(r),"animateStartTime",void 0),(0,b.Z)((0,he.Z)(r),"aniamateStatus",!1),(0,b.Z)((0,he.Z)(r),"bottomColor","rgba(0, 0, 0, 0)"),(0,b.Z)((0,he.Z)(r),"isDestroied",!1),(0,b.Z)((0,he.Z)(r),"sourceEvent",function(){r.dataState.dataSourceNeedUpdate=!0;var s=r.getLayerConfig(),l=s.autoFit,d=s.fitBoundsOptions;l&&r.fitBounds(d),r.reRender()}),r.name=a.name||r.id,r.zIndex=a.zIndex||0,r.rawConfig=a,r}return(0,Gt.Z)(t,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getAttribute",value:function(a){return this.styleAttributeService.getLayerStyleAttribute(a)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Wu(Wu({},this.needUpdateConfig),a);else{var s=this.container.get(Ke.SceneID);iS(a,this),this.configService.setLayerConfig(s,this.id,Wu(Wu(Wu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(Ke.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Ke.IIconService),this.fontService=this.container.get(Ke.IFontService),this.rendererService=this.container.get(Ke.IRendererService),this.layerService=this.container.get(Ke.ILayerService),this.interactionService=this.container.get(Ke.IInteractionService),this.pickingService=this.container.get(Ke.IPickingService),this.mapService=this.container.get(Ke.IMapService);var l=this.getLayerConfig(),d=l.enableMultiPassRenderer,m=l.passes;d&&m!==null&&m!==void 0&&m.length&&m.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(Ke.ICameraService),this.coordinateService=this.container.get(Ke.ICoordinateSystemService),this.shaderModuleService=this.container.get(Ke.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Ke.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ke.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ke.IStyleAttributeService),this.multiPassRenderer=this.container.get(Ke.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(I){var L=I.attributeName,U=I.attributeField,K=I.attributeValues,ae=I.updateOptions;a.styleAttributeService.updateStyleAttribute(L,{scale:Wu({field:U},a.splitValuesAndCallbackInAttribute(K,a.getLayerConfig()[L]))},ae)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ke.ILayerPlugin);var y=gS(this.plugins),C;try{for(y.s();!(C=y.n()).done;){var w=C.value;w.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(I){y.e(I)}finally{y.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var l=this.calculateEncodeData(a,s),d=this.triangulation;return l&&d?this.styleAttributeService.createAttributesAndIndices(l,d):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?hS(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Wu(Wu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,l){return this.updateStyleAttribute("color",a,s,l),this}},{key:"texture",value:function(a,s,l){return this.updateStyleAttribute("texture",a,s,l),this}},{key:"rotate",value:function(a,s,l){return this.updateStyleAttribute("rotate",a,s,l),this}},{key:"size",value:function(a,s,l){return this.updateStyleAttribute("size",a,s,l),this}},{key:"filter",value:function(a,s,l){return this.updateStyleAttribute("filter",a,s,l),this}},{key:"shape",value:function(a,s,l){var d,m,y,C=(d=this.styleAttributeService)===null||d===void 0||(m=d.getLayerStyleAttribute("shape"))===null||m===void 0||(y=m.scale)===null||y===void 0?void 0:y.field,w=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,l),this.tileLayer||dS(this,C,w),this}},{key:"label",value:function(a,s,l){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:l}),this}},{key:"animate",value:function(a){var s={};return Hu()(a)?(s.enable=!0,s=Wu(Wu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var l=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var d=l.getSource();d?l.layerSource.setData(a,s):(l.source(new Tr(a,s)),l.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,l=this.getLayerConfig(),d=a.passes,m=(0,Eh.Z)(a,vS);return d&&ly(d).forEach(function(y){var C=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(y[0]);C&&C.updateOptions(y[1])}),this.rawConfig=Wu(Wu({},this.rawConfig),m),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),l&&l.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return Hu()(a)?this.scaleOptions=Wu(Wu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.tileLayer!==void 0?(this.tileLayer.render(),this):(this.getEncodedData().length!==0&&this.renderModels(),this)}},{key:"renderMultiPass",value:function(){var r=(0,Ta.Z)(Sn().mark(function s(){return Sn().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.getEncodedData().length===0){d.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){d.next=6;break}return d.next=4,this.multiPassRenderer.render();case 4:d.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return d.stop()}},s,this)}));function a(){return r.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=Hu()(a)?!0:a,Hu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var l=this;if(Hu()(a)){var d=a.x,m=d===void 0?0:d,y=a.y,C=y===void 0?0:y;this.updateLayerConfig({highlightColor:Hu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Hu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:m,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Hu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Hu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Ee(a)).then(function(){setTimeout(function(){l.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Hu()(a)?!0:a,Hu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var l=this;if(Hu()(a)){var d=a.x,m=d===void 0?0:d,y=a.y,C=y===void 0?0:y;this.updateLayerConfig({selectColor:Hu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Hu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:m,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Hu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Hu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ee(a)).then(function(){setTimeout(function(){l.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),l=s.visible,d=s.minZoom,m=d===void 0?-Infinity:d,y=s.maxZoom,C=y===void 0?Infinity:y;return!!l&&a>=m&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var l=this.getLayerConfig(),d=l.passes,m=d===void 0?[]:d;this.multiPassRenderer=cy(this,m,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var y=this.rendererService.getViewportSize(),C=y.width,w=y.height;this.multiPassRenderer.resize(C,w)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),l=s.extent,d=l.some(function(m){return Math.abs(m)===Infinity});return d?this:(this.mapService.fitBounds([[l[0],l[1]],[l[2],l[3]]],a),this)}},{key:"destroy",value:function(){var a,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isDestroied||(this.layerChildren.map(function(l){return l.destroy()}),this.layerChildren=[],this.masks.map(function(l){return l.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this,s),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var l=s.range().map(function(y){return(0,b.Z)({value:s.invertExtent(y)},a,y)});return l}else if(s.ticks){var d=s.ticks().map(function(y){return(0,b.Z)({value:y},a,s(y))});return d}else if(s!=null&&s.domain){var m=s.domain().filter(function(y){return!tS()(y)}).map(function(y){return(0,b.Z)({value:y},a,s(y))});return m}return[]}},{key:"pick",value:function(a){var s=a.x,l=a.y;this.interactionService.triggerHover({x:s,y:l})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,l=a.vertexShader,d=a.fragmentShader,m=a.triangulation,y=a.segmentNumber,C=(0,Eh.Z)(a,mS);this.shaderModuleService.registerModule(s,{vs:l,fs:d});var w=this.shaderModuleService.getModule(s),I=w.vs,L=w.fs,U=w.uniforms,K=this.rendererService.createModel,ae=this.styleAttributeService.createAttributesAndIndices(this.encodedData,m,y),Ae=ae.attributes,Ge=ae.elements;return K(Wu({attributes:Ae,uniforms:U,fs:L,vs:I,elements:Ge,blend:sy[Tc.normal]},C))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,l=this.styleAttributeService.createAttributes(this.encodedData,s),d=l.attributes;return d}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),l=s.enableHighlight,d=l===void 0?!0:l,m=s.enableSelect,y=m===void 0?!0:m,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&y&&(C=!0),a==="mousemove"&&(d||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var r=(0,Ta.Z)(Sn().mark(function s(l){return Sn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,l.render();case 2:case"end":return m.stop()}},s)}));function a(s){return r.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(l){l.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,l,d){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Wu({field:s},this.splitValuesAndCallbackInAttribute(l,this.getLayerConfig()[s]))},d):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:l,updateOptions:d})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:ru()(a)?void 0:a||s,callback:ru()(a)?a:void 0}}}]),t}(Ja.EventEmitter),hy=Pt(Vv.prototype,"configService",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vv),bS=F(18446),np=F.n(bS),gy,Gv,yy;function ES(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=SS(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function SS(e,i){if(!!e){if(typeof e=="string")return _y(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _y(e,i)}}function _y(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}var Wa=(gy=Zv(Ke.IGlobalConfigService),Gv=function(){function e(i){(0,qt.Z)(this,e),(0,b.Z)(this,"triangulation",void 0),(0,b.Z)(this,"createTexture2D",void 0),(0,b.Z)(this,"layer",void 0),(0,b.Z)(this,"dataTexture",void 0),(0,b.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,b.Z)(this,"rowCount",void 0),(0,b.Z)(this,"cacheStyleProperties",void 0),(0,b.Z)(this,"cellLength",void 0),(0,b.Z)(this,"cellProperties",void 0),(0,b.Z)(this,"cellTypeLayout",void 0),(0,b.Z)(this,"stylePropertyesExist",void 0),(0,b.Z)(this,"dataTextureTest",void 0),Mt(this,"configService",yy,this),(0,b.Z)(this,"shaderModuleService",void 0),(0,b.Z)(this,"rendererService",void 0),(0,b.Z)(this,"iconService",void 0),(0,b.Z)(this,"fontService",void 0),(0,b.Z)(this,"styleAttributeService",void 0),(0,b.Z)(this,"mapService",void 0),(0,b.Z)(this,"cameraService",void 0),(0,b.Z)(this,"layerService",void 0),(0,b.Z)(this,"pickingService",void 0),this.layer=i,this.rendererService=i.getContainer().get(Ke.IRendererService),this.pickingService=i.getContainer().get(Ke.IPickingService),this.shaderModuleService=i.getContainer().get(Ke.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Ke.IStyleAttributeService),this.mapService=i.getContainer().get(Ke.IMapService),this.iconService=i.getContainer().get(Ke.IIconService),this.fontService=i.getContainer().get(Ke.IFontService),this.cameraService=i.getContainer().get(Ke.ICameraService),this.layerService=i.getContainer().get(Ke.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:W.NEAREST,min:W.NEAREST,width:1,height:1}))}return(0,Gt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var r=!1;return np()(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(r=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),np()(t.opacity,this.cacheStyleProperties.opacity)||(r=!0,this.cacheStyleProperties.opacity=t.opacity),np()(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(r=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),np()(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(r=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),np()(t.stroke,this.cacheStyleProperties.stroke)||(r=!0,this.cacheStyleProperties.stroke=t.stroke),np()(t.offsets,this.cacheStyleProperties.offsets)||(r=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(r=!0),r}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!pa()(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!pa()(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!pa()(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!pa()(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return gu()(t)?!!(0,D.ZP)(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var r=Q(t);return r[0]=r[0]?r[0]:0,r[1]=r[1]?r[1]:0,r[2]=r[2]?r[2]:0,r[3]=r[3]?r[3]:0,r}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(Array.isArray(t)&&t.length===2&&pa()(t[0])&&pa()(t[1]))}},{key:"patchMod",value:function(t,r){for(var a=0;a<r;a++)t.push(-1)}},{key:"patchData",value:function(t,r,a){var s=ES(a),l;try{for(s.s();!(l=s.n()).done;){var d=l.value,m=d.attr,y=d.count,C=r[m];C!==void 0?m==="stroke"?t.push.apply(t,(0,le.Z)(Q(C))):m==="offsets"?this.isOffsetStatic(C)?t.push(-C[0],C[1]):t.push(0,0):t.push(pa()(C)?C:1):this.patchMod(t,y)}}catch(w){s.e(w)}finally{s.f()}}},{key:"calDataFrame",value:function(t,r,a){for(var s=r.length,l=Math.ceil(s*t/this.DATA_TEXTURE_WIDTH),d=l*this.DATA_TEXTURE_WIDTH,m=[],y=0;y<s;y++){var C=r[y];this.patchData(m,C,a)}for(var w=m.length;w<d;w++)m.push(-1);return{data:m,width:this.DATA_TEXTURE_WIDTH,height:l}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),r=t.blend,a=r===void 0?"normal":r;return sy[Tc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),r=t.animateOption;r.enable&&this.layer.setAnimateStartTime()}}]),e}(),yy=Pt(Gv.prototype,"configService",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gv),CS=F(9187),Hf=F.n(CS),xy=100,OO=36,IO=40;function by(e){return e/180*Math.acos(-1)}function Ey(e){var i=by(e[0])+Math.PI/2,t=by(e[1]),r=xy+Math.random()*.4,a=r*Math.cos(t)*Math.cos(i),s=r*Math.cos(t)*Math.sin(i),l=r*Math.sin(t);return[s,l,a]}function RO(e,i){var t=mat4.create(),r=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var l=typeof i.segments!="undefined"?i.segments:32,d=2+l,m=2*d,y=[],C=[],w=[],I=[],L=[],U=[],K=0;K<=d;K++){for(var ae=K/d,Ae=ae*Math.PI,Ge=0;Ge<=m;Ge++){var ot=Ge/m,St=ot*Math.PI*2;mat4.identity(r),mat4.rotateZ(r,r,-Ae),mat4.identity(t),mat4.rotateY(t,t,St),vec3.transformMat4(s,a,r),vec3.transformMat4(s,s,t),vec3.scale(s,s,-e),w.push(s.slice()),I.push.apply(I,_toConsumableArray(s.slice())),vec3.normalize(s,s),L.push.apply(L,_toConsumableArray(s.slice())),U.push([ot,1-ae]),I.push(ot,1-ae)}if(K>0)for(var zt=w.length,Ot=zt-2*(m+1);Ot+m+2<zt;Ot++)y.push([Ot,Ot+1,Ot+m+1]),C.push(Ot,Ot+1,Ot+m+1),y.push([Ot+m+1,Ot+1,Ot+m+2]),C.push(Ot+m+1,Ot+1,Ot+m+2)}return{cells:y,positions:w,uvs:U,positionsArr:I,indicesArr:C,normalArr:L}}var Fi=F(31437),J0=Fi.Ue(),LO=Fi.Ue(),qs=Fi.Ue(),ip=Fi.Ue(),Ed=Fi.Ue();function Hv(e,i,t,r,a){Fi.IH(e,t,r),Fi.Fv(e,e),i=Fi.al(-e[1],e[0]);var s=Fi.al(-t[1],t[0]);return[a/Fi.AK(i,s),i]}function ap(e,i){return Fi.t8(e,-i[1],i[0])}function Sd(e,i,t){return Fi.lu(e,i,t),Fi.Fv(e,e),e}function Wv(e,i){return e[0]===i[0]&&e[1]===i[1]}function kO(e){for(var i=new Map,t=0;t<e.length;t++){var r=e[0].toString()+"-"+e[1].toString();i.get(r)?(e.splice(t,1),t++):i.set(r,r)}return e}var Sy=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,qt.Z)(this,e),(0,b.Z)(this,"complex",void 0),(0,b.Z)(this,"join",void 0),(0,b.Z)(this,"cap",void 0),(0,b.Z)(this,"miterLimit",void 0),(0,b.Z)(this,"thickness",void 0),(0,b.Z)(this,"normal",void 0),(0,b.Z)(this,"lastFlip",-1),(0,b.Z)(this,"miter",Fi.al(0,0)),(0,b.Z)(this,"started",!1),(0,b.Z)(this,"dash",!1),(0,b.Z)(this,"totalDistance",0),(0,b.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,Gt.Z)(e,[{key:"extrude_gaode2",value:function(t,r){var a=this.complex;if(t.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=t.length,l=a.startIndex,d=1;d<s;d++){var m,y,C,w=t[d-1];w.push((m=r[d-1][2])!==null&&m!==void 0?m:0);var I=r[d-1],L=t[d];L.push((y=r[d][2])!==null&&y!==void 0?y:0);var U=r[d],K=d<t.length-1?[].concat((0,le.Z)(t[d+1]),[(C=r[d+1][2])!==null&&C!==void 0?C:0]):null,ae=d<r.length-1?r[d+1]:null,Ae=this.segment_gaode2(a,l,w,L,K,I,U,ae);l+=Ae}if(this.dash)for(var Ge=0;Ge<a.positions.length/6;Ge++)a.positions[Ge*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(t,r){var a=this.complex;if(t.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=t.length,l=a.startIndex,d=1;d<s;d++){var m,y,C,w=t[d-1];w.push((m=r[d-1][2])!==null&&m!==void 0?m:0);var I=r[d-1],L=t[d];L.push((y=r[d][2])!==null&&y!==void 0?y:0);var U=r[d],K=d<t.length-1?[].concat((0,le.Z)(t[d+1]),[(C=r[d+1][2])!==null&&C!==void 0?C:0]):null,ae=d<r.length-1?r[d+1]:null,Ae=this.simpleSegment(a,l,w,L,K,I,U,ae);l+=Ae}if(this.dash)for(var Ge=0;Ge<a.positions.length/6;Ge++)a.positions[Ge*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(t){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=r.startIndex,l=1;l<a;l++){var d=t[l-1],m=t[l],y=l<t.length-1?t[l+1]:null,C=this.segment(r,s,d,m,y);s+=C}if(this.dash)for(var w=0;w<r.positions.length/6;w++)r.positions[w*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude",value:function(t){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=r.startIndex,l=1;l<a;l++){var d=t[l-1],m=t[l],y=l<t.length-1?t[l+1]:null,C=this.simpleSegment(r,s,d,m,y);s+=C}if(this.dash)for(var w=0;w<r.positions.length/6;w++)r.positions[w*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"segment_gaode2",value:function(t,r,a,s,l,d,m,y){var C=0,w=t.indices,I=t.positions,L=t.normals,U=this.cap==="square",K=this.join==="bevel",ae=Ss([m[0],m[1]]),Ae=Ss([d[0],d[1]]);Sd(qs,s,a);var Ge=0;if(this.dash&&(Ge=this.lineSegmentDistance(ae,Ae),this.totalDistance+=Ge),this.normal||(this.normal=Fi.Ue(),ap(this.normal,qs)),!this.started)if(this.started=!0,U){var ot=Fi.Ue(),St=Fi.Ue();Fi.IH(ot,this.normal,qs),Fi.IH(St,this.normal,qs),L.push(St[0],St[1],0),L.push(ot[0],ot[1],0),I.push(a[0],a[1],a[2]|0,this.totalDistance-Ge,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),I.push(a[0],a[1],a[2]|0,this.totalDistance-Ge,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(I,L,a,this.normal,this.thickness,this.totalDistance-Ge);if(w.push(r+0,r+1,r+2),l){Wv(s,l)&&Fi.IH(l,s,Fi.Fv(l,Fi.$X(l,s,a))),Sd(ip,l,s);var er=Hv(Ed,Fi.Ue(),qs,ip,this.thickness),_r=(0,sn.Z)(er,2),kr=_r[0],Kr=_r[1],Pr=Fi.AK(Ed,this.normal)<0?-1:1,ln=K;if(!ln&&this.join==="miter"){var kn=kr;kn>this.miterLimit&&(ln=!0)}ln?(L.push(this.normal[0],this.normal[1],0),L.push(Kr[0],Kr[1],0),I.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Pr,s[2]|0),this.complex.indexes.push(this.currentIndex),I.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Pr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,w.push.apply(w,(0,le.Z)(this.lastFlip!==-Pr?[r,r+2,r+3]:[r+2,r+1,r+3])),w.push(r+2,r+3,r+4),ap(J0,ip),Fi.JG(this.normal,J0),L.push(this.normal[0],this.normal[1],0),I.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Pr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C+=3):(this.extrusions(I,L,s,Kr,kr,this.totalDistance),w.push.apply(w,(0,le.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),Pr=-1,Fi.JG(this.normal,Kr),C+=2),this.lastFlip=Pr}else{if(ap(this.normal,qs),U){var zt=Fi.Ue(),Ot=Fi.Ue();Fi.lu(Ot,qs,this.normal),Fi.IH(zt,qs,this.normal),L.push(Ot[0],Ot[1],0),L.push(zt[0],zt[1],0),I.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),I.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(I,L,s,this.normal,this.thickness,this.totalDistance);w.push.apply(w,(0,le.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),C+=2}return C}},{key:"simpleSegment",value:function(t,r,a,s,l){var d=0,m=t.indices,y=t.positions,C=t.normals,w=Ss([s[0],s[1]]),I=Ss([a[0],a[1]]);Sd(qs,w,I);var L=0;if(this.dash&&(L=this.lineSegmentDistance(w,I),this.totalDistance+=L),this.normal||(this.normal=Fi.Ue(),ap(this.normal,qs)),this.started||(this.started=!0,this.extrusions(y,C,a,this.normal,this.thickness,this.totalDistance-L)),m.push(r+0,r+1,r+2),!l)ap(this.normal,qs),this.extrusions(y,C,s,this.normal,this.thickness,this.totalDistance),m.push.apply(m,(0,le.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),d+=2;else{var U=Ss([l[0],l[1]]);Wv(w,U)&&Fi.IH(U,w,Fi.Fv(U,Fi.$X(U,w,I))),Sd(ip,U,w);var K=Hv(Ed,Fi.Ue(),qs,ip,this.thickness),ae=(0,sn.Z)(K,2),Ae=ae[0],Ge=ae[1],ot=Fi.AK(Ed,this.normal)<0?-1:1;this.extrusions(y,C,s,Ge,Ae,this.totalDistance),m.push.apply(m,(0,le.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),ot=-1,Fi.JG(this.normal,Ge),d+=2,this.lastFlip=ot}return d}},{key:"segment",value:function(t,r,a,s,l){var d=0,m=t.indices,y=t.positions,C=t.normals,w=this.cap==="square",I=this.join==="bevel",L=Ss([s[0],s[1]]),U=Ss([a[0],a[1]]);Sd(qs,L,U);var K=0;if(this.dash&&(K=this.lineSegmentDistance(L,U),this.totalDistance+=K),this.normal||(this.normal=Fi.Ue(),ap(this.normal,qs)),!this.started)if(this.started=!0,w){var ae=Fi.Ue(),Ae=Fi.Ue();Fi.IH(ae,this.normal,qs),Fi.IH(Ae,this.normal,qs),C.push(Ae[0],Ae[1],0),C.push(ae[0],ae[1],0),y.push(a[0],a[1],a[2]|0,this.totalDistance-K,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),y.push(a[0],a[1],a[2]|0,this.totalDistance-K,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(y,C,a,this.normal,this.thickness,this.totalDistance-K);if(m.push(r+0,r+1,r+2),l){var St=Ss([l[0],l[1]]);Wv(L,St)&&Fi.IH(St,L,Fi.Fv(St,Fi.$X(St,L,U))),Sd(ip,St,L);var zt=Hv(Ed,Fi.Ue(),qs,ip,this.thickness),Ot=(0,sn.Z)(zt,2),er=Ot[0],_r=Ot[1],kr=Fi.AK(Ed,this.normal)<0?-1:1,Kr=I;if(!Kr&&this.join==="miter"){var Pr=er;Pr>this.miterLimit&&(Kr=!0)}Kr?(C.push(this.normal[0],this.normal[1],0),C.push(_r[0],_r[1],0),y.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*kr,s[2]|0),this.complex.indexes.push(this.currentIndex),y.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*kr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,m.push.apply(m,(0,le.Z)(this.lastFlip!==-kr?[r,r+2,r+3]:[r+2,r+1,r+3])),m.push(r+2,r+3,r+4),ap(J0,ip),Fi.JG(this.normal,J0),C.push(this.normal[0],this.normal[1],0),y.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*kr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,d+=3):(this.extrusions(y,C,s,_r,er,this.totalDistance),m.push.apply(m,(0,le.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),kr=-1,Fi.JG(this.normal,_r),d+=2),this.lastFlip=kr}else{if(ap(this.normal,qs),w){var Ge=Fi.Ue(),ot=Fi.Ue();Fi.lu(ot,qs,this.normal),Fi.IH(Ge,qs,this.normal),C.push(ot[0],ot[1],0),C.push(Ge[0],Ge[1],0),y.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),y.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(y,C,s,this.normal,this.thickness,this.totalDistance);m.push.apply(m,(0,le.Z)(this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3])),d+=2}return d}},{key:"extrusions",value:function(t,r,a,s,l,d){r.push(s[0],s[1],0),r.push(s[0],s[1],0),t.push(a[0],a[1],a[2]|0,d,-l,a[2]|0),this.complex.indexes.push(this.currentIndex),t.push(a[0],a[1],a[2]|0,d,l,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,r){var a=r[0]-t[0],s=r[1]-t[1];return Math.sqrt(a*a+s*s)}}]),e}();function Up(e){if(pa()(e[0]))return e;if(pa()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(pa()(e[0][0][0])){var i=e,t=0,r=0,a=0;return i.forEach(function(s){s.forEach(function(l){t+=l[0],r+=l[1],a++})}),[t/a,r/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function AS(e){for(var i=e[0],t=e[1],r=e[0],a=e[1],s=0,l=0,d=0,m=0;m<e.length;m+=2){var y=e[m],C=e[m+1];y&&C&&(i=Math.max(y,i),t=Math.max(C,t),r=Math.min(y,r),a=Math.min(C,a),s+=y,l+=C,d++)}return{center:[s/d,l/d],radius:Math.sqrt(Math.pow(i-r,2)+Math.pow(t-a,2))/2}}var Xa=F(77160);function wS(e){var i=e[0][0],t=e[0][e[0].length-1];i[0]===t[0]&&i[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,a=Hf().flatten(e),s=a.vertices,l=a.dimensions,d=[],m=[],y=0;y<s.length/l;y++)l===2?d.push(s[y*2],s[y*2+1],1):d.push(s[y*3],s[y*3+1],1);var C=Hf()(a.vertices,a.holes,a.dimensions);m.push.apply(m,(0,le.Z)(C));for(var w=function(U){var K=a.vertices.slice(U*l,(U+1)*l),ae=a.vertices.slice((U+1)*l,(U+2)*l);ae.length===0&&(ae=a.vertices.slice(0,l));var Ae=d.length/3;d.push(K[0],K[1],1,ae[0],ae[1],1,K[0],K[1],0,ae[0],ae[1],0),m.push.apply(m,(0,le.Z)([0,2,1,2,3,1].map(function(Ge){return Ge+Ae})))},I=0;I<r;I++)w(I);return{positions:d,index:m}}function TS(e){var i=Hf().flatten(e),t=Hf()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:t}}function Cy(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],r=e[0][e[0].length-1];t[0]===r[0]&&t[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Hf().flatten(e),l=s.vertices,d=s.dimensions,m=[],y=[],C=[],w=0;w<l.length/d;w++)d===2?m.push(l[w*2],l[w*2+1],1,-1,-1):m.push(l[w*3],l[w*3+1],1,-1,-1),C.push(0,0,1);var I=Hf()(s.vertices,s.holes,s.dimensions);y.push.apply(y,(0,le.Z)(I));for(var L=function(ae){var Ae=s.vertices.slice(ae*d,(ae+1)*d),Ge=s.vertices.slice((ae+1)*d,(ae+2)*d);Ge.length===0&&(Ge=s.vertices.slice(0,d));var ot=m.length/5;m.push(Ae[0],Ae[1],1,0,0,Ge[0],Ge[1],1,.1,0,Ae[0],Ae[1],0,0,.8,Ge[0],Ge[1],0,.1,.8);var St=MS([Ge[0],Ge[1],1],[Ae[0],Ae[1],0],[Ae[0],Ae[1],1],i);C.push.apply(C,(0,le.Z)(St).concat((0,le.Z)(St),(0,le.Z)(St),(0,le.Z)(St))),y.push.apply(y,(0,le.Z)([1,2,0,3,2,1].map(function(zt){return zt+ot})))},U=0;U<a;U++)L(U);return{positions:m,index:y,normals:C}}function MS(e,i,t){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Xa.create(),s=Xa.create(),l=Xa.create();r&&(e=Zl(e),i=Zl(i),t=Zl(t));var d=Xa.fromValues.apply(Xa,(0,le.Z)(e)),m=Xa.fromValues.apply(Xa,(0,le.Z)(i)),y=Xa.fromValues.apply(Xa,(0,le.Z)(t));Xa.sub(a,y,m),Xa.sub(s,d,m),Xa.cross(l,a,s);var C=Xa.create();return Xa.normalize(C,l),C}var Mc,jp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(jp||(jp={}));var Vp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Vp||(Vp={}));function l0(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,r=[],a=0;a<e;a++)r.push(t*a+i*Math.PI/12);var s=r.map(function(l){var d=Math.sin(l+Math.PI/4),m=Math.cos(l+Math.PI/4);return[d,m,0]});return s}function Ay(){return l0(30)}function wy(){return l0(4)}function Ty(){return l0(3)}function My(){return l0(6,1)}function Py(){return l0(5)}var Cd=(Mc={},(0,b.Z)(Mc,Vp.CIRCLE,Ay),(0,b.Z)(Mc,Vp.HEXAGON,My),(0,b.Z)(Mc,Vp.TRIANGLE,Ty),(0,b.Z)(Mc,Vp.SQUARE,wy),(0,b.Z)(Mc,Vp.PENTAGON,Py),(0,b.Z)(Mc,jp.CYLINDER,Ay),(0,b.Z)(Mc,jp.HEXAGONCOLUMN,My),(0,b.Z)(Mc,jp.TRIANGLECOLUMN,Ty),(0,b.Z)(Mc,jp.SQUARECOLUMN,wy),(0,b.Z)(Mc,jp.PENTAGONCOLUMN,Py),Mc),ev={};function Wf(e){var i=Up(e.coordinates);return{vertices:[].concat((0,le.Z)(i),(0,le.Z)(i),(0,le.Z)(i),(0,le.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function Oy(e){var i=Up(e.coordinates),t=Ey(i);return{vertices:[].concat((0,le.Z)(t),(0,le.Z)(t),(0,le.Z)(t),(0,le.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function Iy(e){var i=e.shape,t=RS(i,!1),r=t.positions,a=t.index,s=t.normals;return{vertices:r,indices:a,normals:s,size:5}}function Ry(e){var i=Up(e.coordinates);return{vertices:(0,le.Z)(i),indices:[0],size:i.length}}function Gp(e){var i=e.coordinates,t=e.originCoordinates,r=e.version,a=new Sy({dash:!0,join:"bevel"});if(r==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var l=t;Array.isArray(l[0][0])||(l=[t]);for(var d=0;d<s.length;d++){var m=s[d],y=l[d];a.extrude_gaode2(m,y)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(I){a.extrude(I)})}var w=a.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,indexes:w.indexes,size:6}}function PS(e){var i=e.coordinates,t=e.originCoordinates,r=e.version,a=new Sy({dash:!0,join:"bevel"});if(r==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var l=t;Array.isArray(l[0][0])||(l=[t]);for(var d=0;d<s.length;d++){var m=s[d],y=l[d];a.simpleExtrude_gaode2(m,y)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(I){a.simpleExtrude(I)})}var w=a.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,size:6}}function c0(e){var i=e.coordinates,t=Hf().flatten(i),r=t.vertices,a=t.dimensions,s=t.holes;return{indices:Hf()(r,s,a),vertices:r,size:a}}function OS(e){var i=e.coordinates,t=Hf().flatten(i),r=t.vertices,a=t.dimensions,s=t.holes;return{indices:Hf()(r,s,a),vertices:IS(r),size:a+4}}function IS(e){for(var i=[],t=AS(e),r=t.center,a=t.radius,s=0;s<e.length;s+=2){var l=e[s],d=e[s+1];i.push.apply(i,[l,d,0].concat((0,le.Z)(r),[a]))}return i}function Ly(e){var i=e.coordinates,t=Cy(i,!0),r=t.positions,a=t.index,s=t.normals;return{vertices:r,indices:a,normals:s,size:5}}function ky(e){var i=e.shape,t=kS(i),r=t.positions,a=t.index;return{vertices:r,indices:a,size:3}}function Dy(e){var i=e.coordinates,t=[].concat((0,le.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,le.Z)(i[1]),[0,1,0],(0,le.Z)(i[0]),[0,0,1],(0,le.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),r=[0,1,2,3,4,5];return{vertices:t,indices:r,size:5}}function tv(e,i){for(var t=i||30,r=e.coordinates,a=[],s=[],l=function(y){a.push(y,1,y,r[0][0],r[0][1],r[1][0],r[1][1],y,-1,y,r[0][0],r[0][1],r[1][0],r[1][1]),y!==t-1&&s.push.apply(s,(0,le.Z)([0,1,2,1,3,2].map(function(C){return y*2+C})))},d=0;d<t;d++)l(d);return{vertices:a,indices:s,size:7}}function Fy(e){var i=e.coordinates;i.length===2&&i.push(0);var t=e.size,r=rv(-1,1),a=rv(1,1),s=rv(-1,-1),l=rv(1,-1),d=[].concat((0,le.Z)(i),(0,le.Z)(r),(0,le.Z)(i),(0,le.Z)(s),(0,le.Z)(i),(0,le.Z)(l),(0,le.Z)(i),(0,le.Z)(a)),m=[0,1,2,3,0,2];return{vertices:d,indices:m,size:5}}function RS(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(ev&&ev[e])return ev[e];var t=Cd[e]?Cd[e]():Cd.cylinder(),r=Cy([t],i);return ev[e]=r,r}function DO(e,i){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/t*3),s,l,d,m=vec3.create(),y=vec3.create(),C=vec3.create(),w=0,I=i.length;w<I;w+=3){s=i[w+0]*3,l=i[w+1]*3,d=i[w+2]*3;var L=[e[s],e[s+1]],U=[e[l],e[l+1]],K=[e[d],e[d+1]];r&&(L=lngLatToMeters(L),U=lngLatToMeters(U),K=lngLatToMeters(K));var ae=L,Ae=_slicedToArray(ae,2),Ge=Ae[0],ot=Ae[1],St=vec3.fromValues(Ge,ot,e[s+2]),zt=U,Ot=_slicedToArray(zt,2),er=Ot[0],_r=Ot[1],kr=vec3.fromValues(er,_r,e[l+2]),Kr=K,Pr=_slicedToArray(Kr,2),ln=Pr[0],kn=Pr[1],Hn=vec3.fromValues(ln,kn,e[d+2]);vec3.sub(m,Hn,kr),vec3.sub(y,St,kr),vec3.cross(C,m,y),a[s]+=m[0],a[s+1]+=m[1],a[s+2]+=m[2],a[l]+=m[0],a[l+1]+=m[1],a[l+2]+=m[2],a[d]+=m[0],a[d+1]+=m[1],a[d+2]+=m[2]}return LS(a),a}function LS(e){for(var i=0,t=e.length;i<t;i+=3){var r=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,r),e.set(a,i)}}function FO(e){var i=e[0][0],t=e[0][e[0].length-1];return i[0]===t[0]&&i[1]===t[1]}function kS(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=Cd[e]?Cd[e]():Cd.circle(),r=i.indexOf(e)===-1?TS([t]):wS([t]);return r}function rv(e,i){var t=(e+1)/2,r=(i+1)/2;return[t,r]}function BO(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,t=e.indicesArr,r=e.normalArr;return{vertices:i,indices:t,size:5,normals:r}}function NO(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,t=e.indicesArr,r=e.normalArr;return{vertices:i,indices:t,size:5,normals:r}}function DS(e){var i=FS();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function FS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,NS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,zS=function(e){(0,Wr.Z)(t,e);var i=DS(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"cityCenter",void 0),(0,b.Z)((0,he.Z)(r),"cityMinSize",void 0),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.baseColor,m=d===void 0?"rgb(16,16,16)":d,y=a.brightColor,C=y===void 0?"rgb(255,176,38)":y,w=a.windowColor,I=w===void 0?"rgb(30,60,89)":w,L=a.time,U=L===void 0?0:L,K=a.sweep,ae=K===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:K;return{u_cityCenter:ae.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*ae.sweepRadius,u_circleSweep:ae.enable?1:0,u_circleSweepColor:Q(ae.sweepColor).slice(0,3),u_circleSweepSpeed:ae.sweepSpeed,u_opacity:l,u_baseColor:Q(m),u_brightColor:Q(C),u_windowColor:Q(I),u_time:this.layer.getLayerAnimateTime()||U}}},{key:"calCityGeo",value:function(){var a=(0,sn.Z)(this.layer.getSource().extent,4),s=a[0],l=a[1],d=a[2],m=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(d+s)/2,(m+l)/2]);var y=this.mapService.lngLatToCoord([d,m]),C=this.mapService.lngLatToCoord([s,l]);this.cityMinSize=Math.sqrt(Math.pow(y[0]-C[0],2)+Math.pow(y[1]-C[1],2))/4}else{var w=d-s,I=m-l;this.cityCenter=[(d+s)/2,(m+l)/2],this.cityMinSize=Math.sqrt(Math.pow(w,2)+Math.pow(I,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:NS,fragmentShader:BS,triangulation:Ly,cull:{enable:!0,face:W.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,l,d,m,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){var y=s.size,C=y===void 0?10:y;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,l,d,m){var y=s.size;return[d[3],d[4]]}}})}}]),t}(Wa);function ZS(e){var i=US();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function US(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jS=function(e){(0,Wr.Z)(t,e);var i=ZS(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"type","PolygonLayer"),r}return(0,Gt.Z)(t,[{key:"buildModels",value:function(){this.layerModel=new zS(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(Gf);function VS(e){var i=GS();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function GS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HS=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,WS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,XS=function(e){(0,Wr.Z)(t,e);var i=VS(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=a.coverage,d=a.angle;return{u_opacity:s||1,u_coverage:l||.9,u_angle:d||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:HS,fragmentShader:WS,triangulation:ky,depth:{enable:!1},primitive:W.TRIANGLES,blend:this.getBlend(),stencil:Re(l,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ln.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,l){var d=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[d[0],d[1],0]}}})}}]),t}(Wa);function YS(e){var i=qS();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function qS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,$S=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,QS=function(e){(0,Wr.Z)(t,e);var i=YS(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=a.coverage,d=a.angle;return{u_opacity:s||1,u_coverage:l||1,u_angle:d||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:KS,fragmentShader:$S,triangulation:Iy,depth:{enable:!0},blend:this.getBlend(),stencil:Re(l,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){var y=s.size;return Array.isArray(y)?[y[0]]:[y]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,l,d,m,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ln.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,l){var d=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[d[0],d[1],0]}}})}}]),t}(Wa);function JS(e,i){for(var t=[],r=[],a=[],s=e+1,l=i+1,d=e/2,m=i/2,y=0;y<l;y++)for(var C=y-m,w=0;w<s;w++){var I=w-d;r.push(I/d,-C/m,0),a.push(w/e),a.push(1-y/i)}for(var L=0;L<i;L++)for(var U=0;U<e;U++){var K=U+s*L,ae=U+s*(L+1),Ae=U+1+s*(L+1),Ge=U+1+s*L;t.push(K,ae,Ge),t.push(ae,Ae,Ge)}return{vertices:r,indices:t,uvs:a}}var By,Ny;function zy(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Zy(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?zy(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):zy(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function eC(e){var i=tC();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function tC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rC=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,nC=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,iC=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,aC=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,oC=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,sC=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Uy=(By=(0,wt.b2)(),By(Ny=function(e){(0,Wr.Z)(t,e);var i=eC(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),(0,b.Z)((0,he.Z)(r),"colorTexture",void 0),(0,b.Z)((0,he.Z)(r),"heatmapFramerBuffer",void 0),(0,b.Z)((0,he.Z)(r),"intensityModel",void 0),(0,b.Z)((0,he.Z)(r),"colorModel",void 0),(0,b.Z)((0,he.Z)(r),"shapeType",void 0),r}return(0,Gt.Z)(t,[{key:"render",value:function(){var a=this,s=this.rendererService,l=s.clear,d=s.useFramebuffer;d(this.heatmapFramerBuffer,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,l=s.createFramebuffer,d=s.clear,m=s.getViewportSize,y=s.createTexture2D,C=s.useFramebuffer,w=this.styleAttributeService.getLayerStyleAttribute("shape"),I=(w==null||(a=w.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=I,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=I==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var L=m(),U=L.width,K=L.height;return this.heatmapFramerBuffer=l({color:y({width:Math.floor(U/4),height:Math.floor(K/4),wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.LINEAR,mag:W.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Ln.Attribute,descriptor:{name:"a_Dir",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,l,d,m){return[d[3],d[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){var y=s.size,C=y===void 0?1:y;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.triangulation=Fy,this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:sC,fragmentShader:oC,triangulation:Fy,depth:{enable:!1},cull:{enable:!0,face:mt(this.mapService.version)},blend:{enable:!0,func:{srcRGB:W.ONE,srcAlpha:1,dstRGB:W.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d;this.shaderModuleService.registerModule("heatmapColor",{vs:aC,fs:iC});var y=this.shaderModuleService.getModule("heatmapColor"),C=y.vs,w=y.fs,I=y.uniforms,L=this.rendererService,U=L.createAttribute,K=L.createElements,ae=L.createBuffer,Ae=L.createModel;return Ae({vs:C,fs:w,attributes:{a_Position:U({buffer:ae({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:W.FLOAT}),size:3}),a_Uv:U({buffer:ae({data:[0,1,1,1,0,0,1,0],type:W.FLOAT}),size:2})},uniforms:Zy({},I),depth:{enable:!1},blend:this.getBlend(),count:6,elements:K({data:[0,2,1,2,3,1],type:W.UNSIGNED_INT,count:6}),stencil:Re(l,m)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=a.intensity,d=l===void 0?10:l,m=a.radius,y=m===void 0?5:m;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:y,u_intensity:d}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=Ls();ye(l,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,le.Z)(l)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d,y=this.rendererService.getViewportSize,C=y(),w=C.width,I=C.height,L=JS(w/4,I/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:nC,fs:rC});var U=this.shaderModuleService.getModule("heatmap3dColor"),K=U.vs,ae=U.fs,Ae=U.uniforms,Ge=this.rendererService,ot=Ge.createAttribute,St=Ge.createElements,zt=Ge.createBuffer,Ot=Ge.createModel;return Ot({vs:K,fs:ae,attributes:{a_Position:ot({buffer:zt({data:L.vertices,type:W.FLOAT}),size:3}),a_Uv:ot({buffer:zt({data:L.uvs,type:W.FLOAT}),size:2})},primitive:W.TRIANGLES,uniforms:Zy({},Ae),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:W.SRC_ALPHA,srcAlpha:1,dstRGB:W.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:St({data:L.indices,type:W.UNSIGNED_INT,count:L.indices.length}),stencil:Re(l,m)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),l=s.rampColors,d=Se(l);this.colorTexture=a({data:new Uint8Array(d.data),width:d.width,height:d.height,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.NEAREST,mag:W.NEAREST,flipY:!1})}}]),t}(Wa))||Ny);function uC(e){var i=lC();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function lC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cC=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,fC=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,hC=function(e){(0,Wr.Z)(t,e);var i=uC(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=a.coverage,d=a.angle;return{u_opacity:s||1,u_coverage:l||.9,u_angle:d||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:fC,fragmentShader:cC,triangulation:ky,depth:{enable:!1},primitive:W.TRIANGLES,blend:this.getBlend(),stencil:Re(l,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ln.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,l){var d=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[d[0],d[1],0]}}})}}]),t}(Wa),pC={heatmap:Uy,heatmap3d:Uy,grid:XS,grid3d:QS,hexagon:hC},dC=pC;function vC(e){var i=mC();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function mC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gC=function(e){(0,Wr.Z)(t,e);var i=vC(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"type","HeatMapLayer"),r}return(0,Gt.Z)(t,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new dC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(l){return l.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models[0].updateAttributesAndElements(a.attributes,a.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),l=this.getLayerConfig(),d=l.shape3d,m=this.getSource(),y=m.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":y==="hexagon"?(d==null?void 0:d.indexOf(C))===-1?"hexagon":"grid3d":y==="grid"?(d==null?void 0:d.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),t}(Gf);function yC(e){var i=_C();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function _C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xC=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,bC=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,EC=function(e){(0,Wr.Z)(t,e);var i=yC(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),l=s.mask,d=l===void 0?!1:l,m=s.maskInside,y=m===void 0?!0:m,C=this.layer.getSource(),w=this.rendererService.createTexture2D;if(this.texture=w({height:0,width:0}),Ci){var I=this.layerService.sceneService.getSceneConfig().canvas,L=I.createImage();L.crossOrigin="anonymous",L.src=C.data.originData,L.onload=function(){a.texture=w({data:L,width:L.width,height:L.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(U){a.texture=w({data:U[0],width:U[0].width,height:U[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:bC,fragmentShader:xC,triangulation:Dy,primitive:W.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Re(d,y)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,l,d,m){return[d[3],d[4]]}}})}}]),t}(Wa),SC={image:EC},CC=SC;function AC(e){var i=wC();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function wC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jy=function(e){(0,Wr.Z)(t,e);var i=AC(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"type","ImageLayer"),r}return(0,Gt.Z)(t,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new CC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),t}(Gf);function TC(e){var i=MC();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function MC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PC=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,OC=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,IC=function(e){(0,Wr.Z)(t,e);var i=TC(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?0:s;return{u_opacity:pa()(l)?l:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:OC,fragmentShader:PC,triangulation:c0,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:W.ALWAYS,ref:1,mask:255},opFront:{fail:W.REPLACE,zfail:W.REPLACE,zpass:W.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(Wa),RC={fill:IC},LC=RC;function kC(e){var i=DC();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function DC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vy=function(e){(0,Wr.Z)(t,e);var i=kC(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"type","MaskLayer"),r}return(0,Gt.Z)(t,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new LC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),t}(Gf);function Gy(e,i){i.map(function(t){var r=Uv(e.sceneContainer);t.setContainer(r,e.sceneContainer),t.init()})}function Hy(e,i){var t,r=i.getAttribute("shape");if(r&&(t=r.scale)!==null&&t!==void 0&&t.field){var a;return((a=r.scale)===null||a===void 0?void 0:a.values)==="text"?[r.scale.field,r.scale.values]:r.scale.field}switch(e){case"PolygonLayer":return"fill";case"LineLayer":return"tileline";case"PointLayer":return"circle";case"RasterLayer":return"image";default:return""}}function FC(e,i){switch(e){case"PolygonLayer":return!0;case"LineLayer":return!0;case"PointLayer":return!1;case"RasterLayer":return i;default:return i}}function BC(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}function NC(e,i,t,r){var a,s,l,d,m=(e==null||(a=e.bboxPolygon)===null||a===void 0?void 0:a.bbox)||[0,0,10,-10],y=(0,sn.Z)(m,4),C=y[0],w=C===void 0?0:C,I=y[1],L=I===void 0?0:I,U=y[2],K=U===void 0?10:U,ae=y[3],Ae=ae===void 0?-10:ae,Ge=i.lngLatToContainer([w,L]),ot=i.lngLatToContainer([K,Ae]),St=ot.x-Ge.x,zt=Ge.y-ot.y,Ot=[(t-Ge.x)/St,(r-ot.y)/zt],er=(e==null||(s=e.data)===null||s===void 0?void 0:s.width)||1,_r=(e==null||(l=e.data)===null||l===void 0?void 0:l.height)||1,kr=Math.floor(Ot[0]*er),Kr=Math.floor(Ot[1]*_r),Pr=Math.max(0,Kr-1)*er+kr,ln=e==null||(d=e.data)===null||d===void 0?void 0:d.data[Pr];return ln}function zO(e,i,t){var r=t.readPixels,a=t.getContainer,s=e*DOM.DPR,l=i*DOM.DPR,d=BC(a()),m=d.width,y=d.height;if(m*=DOM.DPR,y*=DOM.DPR,s>m-1*DOM.DPR||s<0||l>y-1*DOM.DPR||l<0)return!1;var C=r({x:Math.floor(s),y:Math.floor(y-(i+1)*DOM.DPR),width:1,height:1,data:new Uint8Array(1*1*4)});return C}function zC(e){var i=ZC();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function ZC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UC=`#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6


  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,jC=`
attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform vec2 u_tileOrigin;
uniform float u_coord;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

if(u_coord > 0.0) {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }
} else {
  vec2 pointPos = a_Position.xy;
  vec4 tileWorld = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  tileWorld.xy += pointOffset;

  tileWorld.xy += offset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    tileWorld.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * tileWorld + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);


}
`,Wy=function(e){(0,Wr.Z)(t,e);var i=zC(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),(0,b.Z)((0,he.Z)(r),"updateTexture",function(){var d=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas()}),r.layer.render();return}r.texture=d({data:r.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128})}),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.textureBlend,m=d===void 0?"normal":d,y=a.lineTexture,C=y===void 0?!1:y,w=a.iconStep,I=w===void 0?100:w,L=a.vertexHeightScale,U=L===void 0?20:L,K=a.borderWidth,ae=K===void 0?0:K,Ae=a.borderColor,Ge=Ae===void 0?"#ccc":Ae,ot=a.heightfixed,St=ot===void 0?!1:ot,zt=a.arrow,Ot=zt===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:zt,er=a.coord,_r=er===void 0?"lnglat":er,kr=a.tileOrigin;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var Kr=this.layer.getEncodedData(),Pr=this.calDataFrame(this.cellLength,Kr,this.cellProperties),ln=Pr.data,kn=Pr.width,Hn=Pr.height;this.rowCount=Hn,this.dataTexture=this.cellLength>0&&ln.length>0?this.createTexture2D({flipY:!0,data:ln,format:W.LUMINANCE,type:W.FLOAT,width:kn,height:Hn}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_tileOrigin:kr||[0,0],u_coord:_r==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(l),u_textureBlend:m==="normal"?0:1,u_texture:this.texture,u_line_texture:C?1:0,u_icon_step:I,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:ae,u_borderColor:Q(Ge),u_heightfixed:Number(St),u_vertexScale:U,u_arrow:Number(Ot.enable),u_arrowHeight:Ot.arrowHeight||3,u_arrowWidth:Ot.arrowWidth||2,u_tailWidth:Ot.tailWidth===void 0?1:Ot.tailWidth}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d,y=a.depth,C=y===void 0?!1:y,w=this.getShaders(),I=w.frag,L=w.vert,U=w.type;return this.layer.triangulation=Gp,[this.layer.buildLayerModel({moduleName:U,vertexShader:L,fragmentShader:I,triangulation:Gp,primitive:W.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Re(l,m)})]}},{key:"getShaders",value:function(){return{frag:UC,vert:jC,type:"line_tile"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Ln.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y,C,w){return w===void 0?[m[3],10]:[m[3],w]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ln.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y){var C=l.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0],w[1]]:[w,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(l,d,m,y,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ln.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){return[m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ln.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y){var C=a.iconService.getIconMap(),w=l.texture,I=C[w]||{x:0,y:0},L=I.x,U=I.y;return[L,U]}}})}}]),t}(Wa);function VC(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=GC(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function GC(e,i){if(!!e){if(typeof e=="string")return Xy(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Xy(e,i)}}function Xy(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}var HC=function(){function e(i,t,r){(0,qt.Z)(this,e),(0,b.Z)(this,"boxCells",[]),(0,b.Z)(this,"xCellCount",void 0),(0,b.Z)(this,"yCellCount",void 0),(0,b.Z)(this,"boxKeys",void 0),(0,b.Z)(this,"bboxes",void 0),(0,b.Z)(this,"width",void 0),(0,b.Z)(this,"height",void 0),(0,b.Z)(this,"xScale",void 0),(0,b.Z)(this,"yScale",void 0),(0,b.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/r),this.yCellCount=Math.ceil(t/r);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=t,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,Gt.Z)(e,[{key:"insert",value:function(t,r,a,s,l){this.forEachCell(r,a,s,l,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(l)}},{key:"query",value:function(t,r,a,s,l){return this.queryHitTest(t,r,a,s,!1,l)}},{key:"hitTest",value:function(t,r,a,s,l){return this.queryHitTest(t,r,a,s,!0,l)}},{key:"insertBoxCell",value:function(t,r,a,s,l,d){this.boxCells[l].push(d)}},{key:"queryHitTest",value:function(t,r,a,s,l,d){if(a<0||t>this.width||s<0||r>this.height)return l?!1:[];var m=[];if(t<=0&&r<=0&&this.width<=a&&this.height<=s){if(l)return!0;for(var y=0;y<this.boxKeys.length;y++)m.push({key:this.boxKeys[y],x1:this.bboxes[y*4],y1:this.bboxes[y*4+1],x2:this.bboxes[y*4+2],y2:this.bboxes[y*4+3]});return d?m.filter(d):m}var C={hitTest:l,seenUids:{box:{},circle:{}}};return this.forEachCell(t,r,a,s,this.queryCell,m,C,d),l?m.length>0:m}},{key:"queryCell",value:function(t,r,a,s,l,d,m,y){var C=m.seenUids,w=this.boxCells[l];if(w!==null){var I=this.bboxes,L=VC(w),U;try{for(L.s();!(U=L.n()).done;){var K=U.value;if(!C.box[K]){C.box[K]=!0;var ae=K*4;if(t<=I[ae+2]&&r<=I[ae+3]&&a>=I[ae+0]&&s>=I[ae+1]&&(!y||y(this.boxKeys[K]))){if(m.hitTest)return d.push(!0),!0;d.push({key:this.boxKeys[K],x1:I[ae],y1:I[ae+1],x2:I[ae+2],y2:I[ae+3]})}}}}catch(Ae){L.e(Ae)}finally{L.f()}}return!1}},{key:"forEachCell",value:function(t,r,a,s,l,d,m,y){for(var C=this.convertToXCellCoord(t),w=this.convertToYCellCoord(r),I=this.convertToXCellCoord(a),L=this.convertToYCellCoord(s),U=C;U<=I;U++)for(var K=w;K<=L;K++){var ae=this.xCellCount*K+U;if(l.call(this,t,r,a,s,ae,d,m,y))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),WC=HC,XC=function(){function e(i,t){(0,qt.Z)(this,e),(0,b.Z)(this,"width",void 0),(0,b.Z)(this,"height",void 0),(0,b.Z)(this,"grid",void 0),(0,b.Z)(this,"viewportPadding",100),(0,b.Z)(this,"screenRightBoundary",void 0),(0,b.Z)(this,"screenBottomBoundary",void 0),(0,b.Z)(this,"gridRightBoundary",void 0),(0,b.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=t,this.viewportPadding=Math.max(i,t),this.grid=new WC(i+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,Gt.Z)(e,[{key:"placeCollisionBox",value:function(t){var r=t.x1+t.anchorPointX+this.viewportPadding,a=t.y1+t.anchorPointY+this.viewportPadding,s=t.x2+t.anchorPointX+this.viewportPadding,l=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(r,a,s,l)||this.grid.hitTest(r,a,s,l)?{box:[]}:{box:[r,a,s,l]}}},{key:"insertCollisionBox",value:function(t,r){var a={featureIndex:r};this.grid.insert(a,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,r,a){var s=pn(r,a,0,1),l=Cr(),d=Xt.apply(J,(0,le.Z)(t));return Qi(l,s,d),{x:(l[0]/l[3]+1)/2*this.width+this.viewportPadding,y:(-l[1]/l[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,r,a,s){return a>=0&&t<this.gridRightBoundary&&s>=0&&r<this.gridBottomBoundary}}]),e}();function Yy(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=YC(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function YC(e,i){if(!!e){if(typeof e=="string")return qy(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return qy(e,i)}}function qy(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function Ky(e){var i=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:i,verticalAlign:t}}function $y(e,i,t,r,a){if(!!a){var s=e[r],l=s.glyph;if(l)for(var d=i[l].advance*s.scale,m=(e[r].x+d)*a,y=t;y<=r;y++)e[y].x-=m}}function Qy(e,i,t,r,a,s,l){var d=(i-t)*a,m=(-r*l+.5)*s,y=Yy(e),C;try{for(y.s();!(C=y.n()).done;){var w=C.value;w.x+=d,w.y+=m}}catch(I){y.e(I)}finally{y.f()}}function qC(e,i,t,r,a,s,l){var d=-8,m=0,y=d,C=0,w=e.positionedGlyphs,I=s==="right"?1:s==="left"?0:.5,L=w.length;t.forEach(function(Ge){if(Ge.split("").forEach(function(St){var zt=i[St],Ot=0;zt&&(w.push({glyph:St,x:m,y:y+Ot,vertical:!1,scale:1,metrics:zt}),m+=zt.advance+l)}),w.length!==L){var ot=m-l;C=Math.max(ot,C),$y(w,i,L,w.length-1,I)}m=0,y-=r+5});var U=Ky(a),K=U.horizontalAlign,ae=U.verticalAlign;Qy(w,I,K,ae,C,r,t.length);var Ae=y-d;e.top+=-ae*Ae,e.bottom=e.top-Ae,e.left+=-K*C,e.right=e.left+C}function KC(e,i,t,r,a,s,l){var d=-8,m=0,y=d,C=0,w=e.positionedGlyphs,I=s==="right"?1:s==="left"?0:.5,L=w.length;t.forEach(function(Ge){var ot=i[Ge],St=0;if(ot&&(w.push({glyph:Ge,x:ot.advance/2,y:y+St,vertical:!1,scale:1,metrics:ot}),m+=ot.advance+l),w.length!==L){var zt=m-l;C=Math.max(zt,C),$y(w,i,L,w.length-1,I)}m=0,y-=r+5});var U=Ky(a),K=U.horizontalAlign,ae=U.verticalAlign;Qy(w,I,K,ae,C,r,t.length);var Ae=y-d;e.top+=-ae*Ae,e.bottom=e.top-Ae,e.left+=-K*C,e.right=e.left+C}function $C(e,i,t,r,a,s){var l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],d=arguments.length>7?arguments[7]:void 0,m=e.split(`
`),y=[],C={positionedGlyphs:y,top:l[1],bottom:l[1],left:l[0],right:l[0],lineCount:m.length,text:e};return d?KC(C,i,m,t,r,a,s):qC(C,i,m,t,r,a,s),y.length?C:!1}function QC(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,r=e.positionedGlyphs,a=r===void 0?[]:r,s=[],l=Yy(a),d;try{for(l.s();!(d=l.n()).done;){var m=d.value,y=m.metrics,C=4,w=y.advance*m.scale/2,I=t?[m.x+w,m.y]:[0,0],L=t?[0,0]:[m.x+w+i[0],m.y+i[1]],U=(0-C)*m.scale-w+L[0],K=(0-C)*m.scale+L[1],ae=U+y.width*m.scale,Ae=K+y.height*m.scale,Ge={x:U,y:K},ot={x:ae,y:K},St={x:U,y:Ae},zt={x:ae,y:Ae};s.push({tl:Ge,tr:ot,bl:St,br:zt,tex:y,glyphOffset:I})}}catch(Ot){l.e(Ot)}finally{l.f()}return s}function JC(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=eA(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function eA(e,i){if(!!e){if(typeof e=="string")return Jy(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Jy(e,i)}}function Jy(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function tA(e){var i=rA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function rA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e_=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,t_=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function r_(e){var i=this,t=e.id,r=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[t].centroid,l=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[t].glyphQuads.forEach(function(d,m){r.push.apply(r,(0,le.Z)(l).concat([d.tex.x,d.tex.y+d.tex.height,d.tl.x,d.tl.y],(0,le.Z)(l),[d.tex.x+d.tex.width,d.tex.y+d.tex.height,d.tr.x,d.tr.y],(0,le.Z)(l),[d.tex.x+d.tex.width,d.tex.y,d.br.x,d.br.y],(0,le.Z)(l),[d.tex.x,d.tex.y,d.bl.x,d.bl.y])),a.push(0+m*4,1+m*4,2+m*4,2+m*4,3+m*4,0+m*4)}),{vertices:r,indices:a,size:7}}var Xv=function(e){(0,Wr.Z)(t,e);var i=tA(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"glyphInfo",void 0),(0,b.Z)((0,he.Z)(r),"glyphInfoMap",{}),(0,b.Z)((0,he.Z)(r),"texture",void 0),(0,b.Z)((0,he.Z)(r),"currentZoom",-1),(0,b.Z)((0,he.Z)(r),"extent",void 0),(0,b.Z)((0,he.Z)(r),"textureHeight",0),(0,b.Z)((0,he.Z)(r),"textCount",0),(0,b.Z)((0,he.Z)(r),"preTextStyle",{}),(0,b.Z)((0,he.Z)(r),"buildModels",function(){var d=r.layer.getLayerConfig(),m=d.mask,y=m===void 0?!1:m,C=d.maskInside,w=C===void 0?!0:C;return r.initGlyph(),r.updateTexture(),r.filterGlyphs(),r.reBuildModel(),[r.layer.buildLayerModel({moduleName:"pointText",vertexShader:t_,fragmentShader:e_,triangulation:r_.bind((0,he.Z)(r)),depth:{enable:!1},blend:r.getBlend(),stencil:Re(y,w)})]}),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.stroke,m=d===void 0?"#fff":d,y=a.strokeWidth,C=y===void 0?0:y,w=a.textAnchor,I=w===void 0?"center":w,L=a.textAllowOverlap,U=L===void 0?!1:L,K=a.halo,ae=K===void 0?.5:K,Ae=a.gamma,Ge=Ae===void 0?2:Ae,ot=a.raisingHeight,St=ot===void 0?0:ot,zt=this.fontService,Ot=zt.canvas,er=zt.mapping;if(Object.keys(er).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(er).length),this.preTextStyle={textAnchor:I,textAllowOverlap:U},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,strokeWidth:C,stroke:m})){this.judgeStyleAttributes({opacity:l,strokeWidth:C,stroke:m});var _r=this.layer.getEncodedData(),kr=this.calDataFrame(this.cellLength,_r,this.cellProperties),Kr=kr.data,Pr=kr.width,ln=kr.height;this.rowCount=ln,this.dataTexture=this.cellLength>0&&Kr.length>0?this.createTexture2D({flipY:!0,data:Kr,format:W.LUMINANCE,type:W.FLOAT,width:Pr,height:ln}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(St),u_opacity:pa()(l)?l:1,u_stroke_width:pa()(C)?C:1,u_stroke_color:this.getStrokeColor(m),u_sdf_map:this.texture,u_halo_blur:ae,u_gamma_scale:Ge,u_sdf_map_size:[Ot.width,Ot.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,l=s===void 0?"center":s,d=a.textAllowOverlap,m=d===void 0?!0:d;return this.preTextStyle={textAnchor:l,textAllowOverlap:m},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,l=s===void 0?!1:s,d=this.mapService.getZoom(),m=this.mapService.getBounds(),y=Is(this.extent,m);return!l&&(Math.abs(this.currentZoom-d)>1||!y)||l!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Ln.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){var y=s.rotate,C=y===void 0?0:y;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Ln.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,l,d,m){return[d[5],d[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){var y=s.size,C=y===void 0?12:y;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Ln.Attribute,descriptor:{name:"a_tex",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,l,d,m){return[d[3],d[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return pu(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,l=s===void 0?"400":s,d=a.fontFamily,m=d===void 0?"sans-serif":d,y=this.layer.getEncodedData(),C=[];y.forEach(function(w){var I=w.shape,L=I===void 0?"":I;L=L.toString();var U=JC(L),K;try{for(U.s();!(K=U.n()).done;){var ae=K.value;C.indexOf(ae)===-1&&C.push(ae)}}catch(Ae){U.e(Ae)}finally{U.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:l,fontFamily:m,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,l=s===void 0?"400":s,d=a.fontFamily,m=d===void 0?"sans-serif":d,y=this.layer.getEncodedData(),C=[];y.forEach(function(w){var I=w.shape,L=I===void 0?"":I;L="".concat(L),C.indexOf(L)===-1&&C.push(L)}),this.fontService.setFontOptions({characterSet:C,fontWeight:l,fontFamily:m,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,l=this.fontService.mapping,d=this.layer.getLayerConfig(),m=d.spacing,y=m===void 0?2:m,C=d.textAnchor,w=C===void 0?"center":C,I=this.layer.getEncodedData();this.glyphInfo=I.map(function(L){var U=L.shape,K=U===void 0?"":U,ae=L.id,Ae=L.size,Ge=Ae===void 0?1:Ae,ot=L.textOffset,St=ot===void 0?[0,0]:ot,zt=$C(K.toString(),l,Ge,w,"left",y,St,a),Ot=QC(zt,St,!1);return L.shaping=zt,L.glyphQuads=Ot,L.centroid=Up(L.coordinates),L.originCentroid=L.version==="GAODE2.x"?Up(L.originCoordinates):L.originCentroid=L.centroid,s.glyphInfoMap[ae]={shaping:zt,glyphQuads:Ot,centroid:Up(L.coordinates)},L})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),l=s.padding,d=l===void 0?[4,4]:l,m=s.textAllowOverlap,y=m===void 0?!1:m;if(!y){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),w=C.width,I=C.height,L=new XC(w,I),U=this.glyphInfo.filter(function(K){var ae=K.shaping,Ae=K.id,Ge=Ae===void 0?0:Ae,ot=K.version==="GAODE2.x"?K.originCentroid:K.centroid,St=K.size,zt=St/24,Ot=a.mapService.lngLatToContainer(ot),er=L.placeCollisionBox({x1:ae.left*zt-d[0],x2:ae.right*zt+d[0],y1:ae.top*zt-d[1],y2:ae.bottom*zt+d[1],anchorPointX:Ot.x,anchorPointY:Ot.y}),_r=er.box;return _r&&_r.length?(L.insertCollisionBox(_r,Ge),!0):!1});U.forEach(function(K){a.glyphInfoMap[K.id]=K})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,l=s===void 0?!1:s;l?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(l)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:W.LINEAR,min:W.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:t_,fragmentShader:e_,triangulation:r_.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Re(l,m)})]}}]),t}(Wa);function nA(e){var i=iA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function iA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aA=`uniform float u_additive;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,oA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  v_color = a_Color;
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
  }
} else {
  gl_PointSize = 24.0;
  vec2 pointPos = a_Position.xy;
  vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

  vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
  
  world.xy += offset;
  world.xy += pointOffset;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    world.w *= u_PixelsPerMeter.z;
  }

  gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}

 
  setPickingColor(a_PickingColor);


}
`,nv=function(e){(0,Wr.Z)(t,e);var i=nA(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"meter2coord",1),(0,b.Z)((0,he.Z)(r),"isMeter",!1),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.strokeOpacity,m=d===void 0?1:d,y=a.strokeWidth,C=y===void 0?0:y,w=a.stroke,I=w===void 0?"rgba(0,0,0,0)":w,L=a.offsets,U=L===void 0?[0,0]:L,K=a.blend,ae=a.blur,Ae=ae===void 0?0:ae,Ge=a.coord,ot=Ge===void 0?"lnglat":Ge,St=a.tileOrigin;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,strokeOpacity:m,strokeWidth:C,stroke:I,offsets:U})){this.judgeStyleAttributes({opacity:l,strokeOpacity:m,strokeWidth:C,stroke:I,offsets:U});var zt=this.layer.getEncodedData(),Ot=this.calDataFrame(this.cellLength,zt,this.cellProperties),er=Ot.data,_r=Ot.width,kr=Ot.height;this.rowCount=kr,this.dataTexture=this.cellLength>0&&er.length>0?this.createTexture2D({flipY:!0,data:er,format:W.LUMINANCE,type:W.FLOAT,width:_r,height:kr}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_tileOrigin:St||[0,0],u_coord:ot==="lnglat"?1:0,u_isMeter:Number(this.isMeter),u_blur:Ae,u_additive:K==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Number(l),u_stroke_opacity:Number(m),u_stroke_width:Number(C),u_stroke_color:this.getStrokeColor(I),u_offsets:this.isOffsetStatic(U)?U:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Wf)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,l=s===void 0?"l7size":s,d=this.mapService.version;return l==="meter"&&d!==ss.L7MAP&&d!==ss.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,sn.Z)(this.layer.getSource().extent,4),s=a[0],l=a[1],d=a[2],m=a[3],y=[(s+d)/2,(l+m)/2],C=this.mapService.version;if(C===ss.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:y[0],lat:y[1]},0),I=1,L=I*w.meterInMercatorCoordinateUnits(),U=new window.mapboxgl.MercatorCoordinate(w.x-L,w.y,w.z),K=U.toLngLat();this.meter2coord=y[0]-K.lng;return}var ae=this.mapService.meterToCoord(y,[s,l]),Ae=this.mapService.meterToCoord(y,[d===s?d+.1:d,m===l?l+.1:m]);this.meter2coord=(ae+Ae)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d,y=this.getShaders(),C=y.frag,w=y.vert,I=y.type;return this.layer.triangulation=Wf,[this.layer.buildLayerModel({moduleName:I,vertexShader:w,fragmentShader:C,triangulation:Wf,depth:{enable:!1},blend:this.getBlend(),stencil:Re(l,m),cull:{enable:!0,face:mt(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:aA,vert:oA,type:"point_fill_tile"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ln.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(l,d,m,y){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],w=y%4*3;return[C[w],C[w+1],C[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){var C=l.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]*a.meter2coord]:[w*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Ln.Attribute,descriptor:{name:"a_Shape",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){var C=l.shape,w=C===void 0?2:C,I=a.layer.getLayerConfig().shape2d,L=I.indexOf(w);return[L]}}})}}]),t}(Wa);function sA(e){var i=uA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function uA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,cA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;

uniform vec2 u_tileOrigin;
uniform float u_coord;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
  }

if(u_coord > 0.0) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
} else {
    vec2 pointPos = a_Position.xy;
    vec4 world = vec4(project_mvt_offset_position(vec4(u_tileOrigin, 0.0, 1.0)).xyz, 1.0); // \u74E6\u7247\u8D77\u59CB\u70B9\u7684\u4E16\u754C\u5750\u6807

    vec2 pointOffset =  pointPos *  pow(2.0, u_Zoom); // \u74E6\u7247\u5185\u7684\u70B9\u7684\u504F\u79FB\u5750\u6807
    
    world.xy += pointOffset;

    if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // Needs to be divided with project_uCommonUnitsPerMeter
      world.w *= u_PixelsPerMeter.z;
    }

    gl_Position = u_ViewProjectionMatrix * world + u_ViewportCenterProjection;
}


  setPickingColor(a_PickingColor);
}

`,n_=function(e){(0,Wr.Z)(t,e);var i=sA(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.tileOrigin,m=a.coord,y=m===void 0?"lnglat":m;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var C=this.layer.getEncodedData(),w=this.calDataFrame(this.cellLength,C,this.cellProperties),I=w.data,L=w.width,U=w.height;this.rowCount=U,this.dataTexture=this.cellLength>0&&I.length>0?this.createTexture2D({flipY:!0,data:I,format:W.LUMINANCE,type:W.FLOAT,width:L,height:U}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_tileOrigin:d||[0,0],u_coord:y==="lnglat"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:l}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.getModelParams(),s=a.frag,l=a.vert,d=a.triangulation,m=a.type,y=this.layer.getLayerConfig(),C=y.mask,w=C===void 0?!1:C,I=y.maskInside,L=I===void 0?!0:I;return this.layer.triangulation=d,[this.layer.buildLayerModel({moduleName:m,vertexShader:l,fragmentShader:s,triangulation:d,blend:this.getBlend(),depth:{enable:!1},stencil:Re(w,L)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){}},{key:"getModelParams",value:function(){return{frag:lA,vert:cA,type:"polygon_tile",triangulation:c0}}}]),t}(Wa);function fA(e){var i=hA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function hA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pA=function(e){(0,Wr.Z)(t,e);var i=fA(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"isVector",!0),(0,b.Z)((0,he.Z)(r),"type",r.layerType),(0,b.Z)((0,he.Z)(r),"pickedID",null),r}return(0,Gt.Z)(t,[{key:"getPickID",value:function(){return this.pickedID}},{key:"setPickID",value:function(){return this.pickedID}},{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new a(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelType",value:function(){switch(this.layerType){case"PolygonLayer":return n_;case"LineLayer":return Wy;case"PointLayer":return this.getPointModel();default:return nv}}},{key:"getPointModel",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),l=s.shape2d,d=a.find(function(y){return y.hasOwnProperty("shape")});if(d){var m=d.shape;return(l==null?void 0:l.indexOf(m))!==-1?nv:Xv}else return nv}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(Gf),dA=F(32676);function vA(e,i,t){t===void 0&&(t={});var r=ia(e),a=ia(i),s=dA.union(r.coordinates,a.coordinates);return s.length===0?null:s.length===1?ai(s[0],t.properties):de(s,t.properties)}var mA=vA;function i_(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Yv(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?i_(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i_(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var f0=function(){function e(i){(0,qt.Z)(this,e),(0,b.Z)(this,"type",void 0),(0,b.Z)(this,"parentLayer",void 0),(0,b.Z)(this,"mapService",void 0),(0,b.Z)(this,"rendererService",void 0),(0,b.Z)(this,"outSideEventTimer",null),(0,b.Z)(this,"zoomOffset",void 0),(0,b.Z)(this,"tilesetManager",void 0),(0,b.Z)(this,"layers",void 0),(0,b.Z)(this,"eventCache",{click:0,mousemove:0,mouseup:0,mousedown:0,contextmenu:0}),this.parentLayer=i.parent,this.mapService=i.mapService,this.rendererService=i.rendererService;var t=this.parentLayer.getSource();this.zoomOffset=t.parser.zoomOffset||0,this.tilesetManager=t.tileset}return(0,Gt.Z)(e,[{key:"createTile",value:function(t,r){return{layers:[],layerIDList:[]}}},{key:"getFeatureData",value:function(t,r){var a={features:[],featureId:null,vectorTileLayer:null,source:null},s=r.sourceLayer,l=r.featureId;if(!s)return a;var d=t.data.layers[s],m=d==null?void 0:d.features;if(Array.isArray(m)&&m.length>0){var y=new Tr({type:"FeatureCollection",features:m},{parser:{type:"geojson",featureId:l}});return{features:m,featureId:l,vectorTileLayer:d,source:y}}else return a}},{key:"createLayer",value:function(t){var r=t.L7Layer,a=t.tile,s=t.initOptions,l=t.vectorTileLayer,d=t.source,m=s.mask,y=s.color,C=s.layerType,w=s.size,I=s.shape,L=r||pA,U=new L(Yv({visible:a.isVisible,tileOrigin:l==null?void 0:l.l7TileOrigin,coord:l==null?void 0:l.l7TileCoord},this.getLayerInitOption(s)));U.isVector&&(this.emitEvent([U]),U.type=C,U.select(!0)),U.source(d),this.setScale(U),this.setStyleAttributeField(U,"shape",I),this.setStyleAttributeField(U,"color",y),this.setStyleAttributeField(U,"size",w);var K=[U];if(m&&U.isVector){var ae=new Vy().source({type:"FeatureCollection",features:[a.bboxPolygon]}).shape("fill");K.push(ae),U.addMaskLayer(ae)}return Gy(this.parentLayer,K),this.layers=[U],U}},{key:"updateStyle",value:function(t){return""}},{key:"getDefautStyleAttributeField",value:function(t,r){switch(r){case"size":return 2;case"color":return"#fff";case"shape":return Hy(this.parentLayer.type,t);default:return""}}},{key:"setStyleAttributeField",value:function(t,r,a){if(Array.isArray(a)){t[r].apply(t,(0,le.Z)(a));return}if(typeof a=="string"){t[r](a);return}var s=this.getDefautStyleAttributeField(t,r);if(!a)return t[r](s),t;var l=this.parseScaleValue(a,r);l.length===0?t[r](s):t[r].apply(t,(0,le.Z)(l))}},{key:"parseScaleValue",value:function(t,r){if(r==="shape")return typeof t=="string"?[t]:t!=null&&t.field?[t==null?void 0:t.field]:[];var a=t,s=a.field,l=a.values,d=a.callback;return s&&l&&Array.isArray(l)?[s,l]:s&&d?[s,d]:s?[s]:[]}},{key:"getTile",value:function(t,r){var a=this.mapService.getZoom(),s=Math.ceil(a)+this.zoomOffset,l=ho(t,r,s),d=this.tilesetManager.tiles.filter(function(y){return y.key==="".concat(l[0],",").concat(l[1],",").concat(s)}),m=d[0];return m}},{key:"emitEvent",value:function(t,r){var a=this;t.map(function(s){s.once("inited",function(){s.on("click",function(l){if(a.eventCache.click=1,a.parentLayer.type==="RasterLayer"){var d=l.lngLat,m=d.lng,y=d.lat,C=a.getTile(m,y);a.getFeatureAndEmitEvent(s,"subLayerClick",l,r,C)}else a.getFeatureAndEmitEvent(s,"subLayerClick",l)}),s.on("mousemove",function(l){if(a.eventCache.mousemove=1,a.parentLayer.type==="RasterLayer"){var d=l.lngLat,m=d.lng,y=d.lat,C=a.getTile(m,y);a.getFeatureAndEmitEvent(s,"subLayerMouseMove",l,r,C)}else a.getFeatureAndEmitEvent(s,"subLayerMouseMove",l)}),s.on("mouseup",function(l){a.eventCache.mouseup=1,a.getFeatureAndEmitEvent(s,"subLayerMouseUp",l)}),s.on("mouseenter",function(l){if(a.parentLayer.type==="RasterLayer"){var d=l.lngLat,m=d.lng,y=d.lat,C=a.getTile(m,y);a.getFeatureAndEmitEvent(s,"subLayerMouseMove",l,r,C)}else a.getFeatureAndEmitEvent(s,"subLayerMouseEnter",l)}),s.on("mouseout",function(l){a.getFeatureAndEmitEvent(s,"subLayerMouseOut",l)}),s.on("mousedown",function(l){a.eventCache.mousedown=1,a.getFeatureAndEmitEvent(s,"subLayerMouseDown",l)}),s.on("contextmenu",function(l){a.eventCache.contextmenu=1,a.getFeatureAndEmitEvent(s,"subLayerContextmenu",l)}),s.on("unclick",function(l){return a.handleOutsideEvent("click","subLayerUnClick",s,l)}),s.on("unmouseup",function(l){return a.handleOutsideEvent("mouseup","subLayerUnMouseUp",s,l)}),s.on("unmousedown",function(l){return a.handleOutsideEvent("mousedown","subLayerUnMouseDown",s,l)}),s.on("uncontextmenu",function(l){return a.handleOutsideEvent("contextmenu","subLayerUnContextmenu",s,l)})})})}},{key:"getCombineFeature",value:function(t){var r=null,a=t[0];return t.map(function(s){var l=ai(s.coordinates);r===null&&(r=l),r=mA(r,l)}),a&&(r.properties=Yv({},a)),r}},{key:"getFeatureAndEmitEvent",value:function(t,r,a,s,l){if(s===!1)a.value=NC(l,this.mapService,a.x,a.y);else{var d=a.featureId,m=this.getAllFeatures(d);try{a.feature=this.getCombineFeature(m)}catch(y){console.warn("Combine Featuer Err! Return First Feature!"),a.feature=m[0]}}this.parentLayer.emit(r,a)}},{key:"setScale",value:function(t){var r=this.parentLayer.tileLayer.scaleField,a=Object.keys(r);a.map(function(s){t.scale(s,r[s])})}},{key:"getAllFeatures",value:function(t){var r=this.parentLayer.tileLayer.children,a=[];return r.map(function(s){var l=s.getSource();l.data.dataArray.map(function(d){d._id===t&&a.push(d)})}),a}},{key:"getLayerInitOption",value:function(t){var r=Yv({},t);return delete r.color,delete r.shape,delete r.size,delete r.coords,delete r.sourceLayer,delete r.coords,r}},{key:"handleOutsideEvent",value:function(t,r,a,s){var l=this;this.outSideEventTimer&&(clearTimeout(this.outSideEventTimer),this.outSideEventTimer=null),this.outSideEventTimer=setTimeout(function(){l.eventCache[t]>0?l.eventCache[t]=0:l.getFeatureAndEmitEvent(a,r,s)},64)}}]),e}();function gA(e){var i=yA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function yA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _A=function(e){(0,Wr.Z)(t,e);var i=gA(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this,r),(0,b.Z)((0,he.Z)(a),"parentLayer",void 0),a.parentLayer=r.parent,a}return(0,Gt.Z)(t,[{key:"createTile",value:function(a,s){var l=this.getFeatureData(a,s),d=l.features,m=l.vectorTileLayer,y=l.source;if(d.length===0)return{layers:[],layerIDList:[]};var C=this.createLayer({tile:a,initOptions:s,vectorTileLayer:m,source:y});return{layers:[C],layerIDList:[C.id]}}}]),t}(f0);function xA(e){var i=bA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function bA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EA=function(e){(0,Wr.Z)(t,e);var i=xA(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this,r),(0,b.Z)((0,he.Z)(a),"parentLayer",void 0),a.parentLayer=r.parent,a}return(0,Gt.Z)(t,[{key:"createTile",value:function(a,s){var l=this.getFeatureData(a,s),d=l.features,m=l.vectorTileLayer,y=l.source;if(d.length===0)return{layers:[],layerIDList:[]};var C=this.createLayer({tile:a,initOptions:s,vectorTileLayer:m,source:y});return{layers:[C],layerIDList:[C.id]}}}]),t}(f0);function SA(e){var i=CA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function CA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AA=function(e){(0,Wr.Z)(t,e);var i=SA(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this,r),(0,b.Z)((0,he.Z)(a),"parentLayer",void 0),a.parentLayer=r.parent,a}return(0,Gt.Z)(t,[{key:"createTile",value:function(a,s){var l=this.getFeatureData(a,s),d=l.features,m=l.vectorTileLayer,y=l.source;if(d.length===0)return{layers:[],layerIDList:[]};var C=this.createLayer({tile:a,initOptions:s,vectorTileLayer:m,source:y});return{layers:[C],layerIDList:[C.id]}}}]),t}(f0);function wA(e){var i=TA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function TA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a_=function(e){(0,Wr.Z)(t,e);var i=wA(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this,r),(0,b.Z)((0,he.Z)(a),"parentLayer",void 0),a.parentLayer=r.parent,a}return(0,Gt.Z)(t,[{key:"createTile",value:function(a,s){var l=new Tr(a.data,{parser:{type:"image",extent:a.bounds}}),d=this.createLayer({L7Layer:jy,tile:a,initOptions:s,source:l});return{layers:[d],layerIDList:[d.id]}}}]),t}(f0);function MA(e){var i=PA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function PA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OA=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,IA=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,qv=function(e){(0,Wr.Z)(t,e);var i=MA(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),(0,b.Z)((0,he.Z)(r),"colorTexture",void 0),(0,b.Z)((0,he.Z)(r),"rampColors",void 0),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.clampLow,m=d===void 0?!0:d,y=a.clampHigh,C=y===void 0?!0:y,w=a.noDataValue,I=w===void 0?-9999999:w,L=a.domain,U=L===void 0?[0,1]:L,K=a.rampColors;return np()(this.rampColors,K)||(this.updateColorTexure(),this.rampColors=K),{u_opacity:l||1,u_texture:this.texture,u_domain:U,u_clampLow:m,u_clampHigh:typeof C!="undefined"?C:m,u_noDataValue:I,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d,y=a.rampColorsData,C=a.rampColors,w=this.layer.getSource(),I=this.rendererService.createTexture2D,L=w.data.dataArray[0];this.texture=I({data:L.data,width:L.width,height:L.height,format:W.LUMINANCE,type:W.FLOAT});var U=y||Se(C);return this.colorTexture=I({data:U.data,width:U.width,height:U.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:IA,fragmentShader:OA,triangulation:Dy,primitive:W.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Re(l,m)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.colorTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,l,d,m){return[d[3],d[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),l=s.rampColors,d=Se(l);this.colorTexture=a({data:d.data,width:d.width,height:d.height,flipY:!1})}}]),t}(Wa);function RA(e){var i=LA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function LA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kA=function(e){(0,Wr.Z)(t,e);var i=RA(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"type",r.layerType),r}return(0,Gt.Z)(t,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new a(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelType",value:function(){return qv}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){return{}}}]),t}(Gf);function DA(e){var i=FA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function FA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BA=function(e){(0,Wr.Z)(t,e);var i=DA(t);function t(r){var a;return(0,qt.Z)(this,t),a=i.call(this,r),(0,b.Z)((0,he.Z)(a),"parentLayer",void 0),a.parentLayer=r.parent,a}return(0,Gt.Z)(t,[{key:"createTile",value:function(a,s){var l=s.opacity,d=s.domain,m=s.clampHigh,y=s.clampLow,C=s.rampColors,w=s.rampColorsData,I=s.mask,L=a.data;if(!L.data)return console.warn("raster data not exist!"),{layers:[],layerIDList:[]};var U=new kA({visible:a.isVisible,mask:I}).source(L.data,{parser:{type:"raster",width:L.width,height:L.height,extent:a.bboxPolygon.bbox}}).style({opacity:l,domain:d,clampHigh:m,clampLow:y,rampColors:C,rampColorsData:w});return this.emitEvent([U],!1),Gy(this.parentLayer,[U]),{layers:[U],layerIDList:[U.id]}}}]),t}(f0);function NA(e,i){switch(e){case"PolygonLayer":return AA;case"LineLayer":return _A;case"PointLayer":return EA;case"RasterLayer":return i.dataType==="arraybuffer"?BA:a_;default:return console.warn("Current Tile Not Exist!"),a_}}function zA(e){var i=ZA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function ZA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UA=function(e){(0,Wr.Z)(t,e);var i=zA(t);function t(){var r;return(0,qt.Z)(this,t),r=i.call(this),(0,b.Z)((0,he.Z)(r),"cacheConfig",void 0),(0,b.Z)((0,he.Z)(r),"checkConfigList",[]),r.cacheConfig=new Map,r}return(0,Gt.Z)(t,[{key:"setConfig",value:function(a,s){this.checkConfigList.includes(a)||this.checkConfigList.push(a),this.cacheConfig.set(a,s)}},{key:"removeConfig",value:function(a){var s=this.checkConfigList.indexOf(a);s>-1&&(this.cacheConfig.delete(a),this.checkConfigList.splice(s,1))}},{key:"checkConfig",value:function(a){var s=this;if(!!a.inited){var l=a.getLayerConfig(),d=[];this.checkConfigList.map(function(m){var y=s.cacheConfig.get(m),C;if(["color","size","shape"].includes(m)){var w;C=(w=a.getAttribute(m))===null||w===void 0?void 0:w.scale}else{if(!(m in l))return;C=l[m]}np()(y,C)||(d.push(m),s.setConfig(m,C))}),d.length>0&&(console.warn("tile config cache update!",d),this.emit("updateConfig",d))}}},{key:"getAttributeScale",value:function(a,s){var l=a.getAttribute(s),d={field:void 0,values:void 0,callback:void 0};if(l&&l.scale){var m=l.scale,y=m.field,C=m.values,w=m.callback;d.field=y,d.values=C,d.callback=w}return d}}]),t}(Wo());function jA(e){var i=VA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function VA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GA=function(e){(0,Wr.Z)(t,e);var i=jA(t);function t(r,a,s,l,d){var m;return(0,qt.Z)(this,t),m=i.call(this),(0,b.Z)((0,he.Z)(m),"isLastPicked",!1),(0,b.Z)((0,he.Z)(m),"rendererService",void 0),(0,b.Z)((0,he.Z)(m),"pickingService",void 0),(0,b.Z)((0,he.Z)(m),"layerService",void 0),(0,b.Z)((0,he.Z)(m),"children",void 0),(0,b.Z)((0,he.Z)(m),"parent",void 0),m.parent=r,m.rendererService=a,m.pickingService=s,m.layerService=d,m.children=l,m}return(0,Gt.Z)(t,[{key:"normalRender",value:function(a){var s=this;a.filter(function(l){return l.inited}).filter(function(l){return l.isVisible()}).map(function(l){l.hooks.beforeRenderData.call(),l.hooks.beforeRender.call(),l.masks.length>0&&(s.rendererService.clear({stencil:0,depth:1,framebuffer:null}),l.masks.map(function(d){d.hooks.beforeRender.call(),d.render(),d.hooks.afterRender.call()})),l.render(),l.hooks.afterRender.call()})}},{key:"pickRender",value:function(a,s){var l=this;this.parent.type==="RasterLayer"&&this.renderMask(this.parent);var d=a.filter(function(m){return l.parent.needPick(s.type)&&m.inited&&m.isVisible()}).some(function(m){m.hooks.beforePickingEncode.call(),m.masks.length>0&&(l.rendererService.clear({stencil:0,depth:1,framebuffer:null}),m.masks.map(function(C){C.hooks.beforeRender.call(),C.render(),C.hooks.afterRender.call()})),m.renderModels(!0),m.hooks.afterPickingEncode.call();var y=l.pickingService.pickFromPickingFBO(m,s);return y&&l.parent.type!=="RasterLayer"&&(l.emit("pick",{type:s.type,pickedColors:l.pickingService.pickedColors,layer:m}),l.pickingService.pickedTileLayers=[l.parent]),y});return this.parent.type!=="RasterLayer"&&!d&&this.isLastPicked&&s.type!=="click"&&(this.pickingService.pickedTileLayers=[],this.emit("unpick",{}),this.beforeHighlight([0,0,0])),this.isLastPicked=d,d}},{key:"clearPick",value:function(){this.children.filter(function(a){return a.inited&&a.isVisible()}).map(function(a){a.hooks.beforeSelect.call([0,0,0])}),this.pickingService.pickedTileLayers=[]}},{key:"beforeHighlight",value:function(a){this.children.filter(function(s){return s.inited&&s.isVisible()}).map(function(s){s.hooks.beforeHighlight.call(a)})}},{key:"beforeSelect",value:function(a){this.children.filter(function(s){return s.inited&&s.isVisible()}).map(function(s){s.hooks.beforeSelect.call(a)})}},{key:"renderMask",value:function(a){a.inited&&a.isVisible()&&(a.hooks.beforeRender.call(),a.masks.length>0&&(this.rendererService.clear({stencil:0,depth:1,framebuffer:null}),a.masks.map(function(s){s.hooks.beforeRender.call(),s.render(),s.hooks.afterRender.call()})),a.hooks.afterRender.call())}}]),t}(Ja.EventEmitter),HA=function(){function e(i,t,r,a,s){(0,qt.Z)(this,e),(0,b.Z)(this,"sourceLayer",void 0),(0,b.Z)(this,"parent",void 0),(0,b.Z)(this,"children",void 0),(0,b.Z)(this,"mapService",void 0),(0,b.Z)(this,"rendererService",void 0),(0,b.Z)(this,"tilePickManager",void 0),(0,b.Z)(this,"tileConfigManager",void 0),(0,b.Z)(this,"tileFactory",void 0),(0,b.Z)(this,"initOptions",void 0),(0,b.Z)(this,"rampColorsData",void 0),this.parent=i,this.children=i.layerChildren,this.mapService=t,this.rendererService=r,this.tilePickManager=new GA(i,r,a,this.children,s),this.tileConfigManager=new UA,this.setSubLayerInitOptipn(),this.setConfigListener(),this.initTileFactory()}return(0,Gt.Z)(e,[{key:"createTile",value:function(t){return this.tileFactory.createTile(t,this.initOptions)}},{key:"updateLayersConfig",value:function(t,r,a){t.map(function(s){r==="mask"?s.style({mask:a}):s.updateLayerConfig((0,b.Z)({},r,a))})}},{key:"addChild",value:function(t){this.children.push(t)}},{key:"addChilds",value:function(t){var r;(r=this.children).push.apply(r,(0,le.Z)(t))}},{key:"removeChilds",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,a=[],s=[];this.children.filter(function(l){t.includes(l.id)?a.push(l):s.push(l)}),a.map(function(l){return l.destroy(r)}),this.children=s}},{key:"removeChild",value:function(t){var r=this.children.indexOf(t);r>-1&&this.children.splice(r,1),t.destroy()}},{key:"getChilds",value:function(t){return this.children.filter(function(r){return t.includes(r.id)})}},{key:"getChild",value:function(t){return this.children.filter(function(r){return r.id===t})[0]}},{key:"clearChild",value:function(){this.children.forEach(function(t){t.destroy()}),this.children.slice(0,this.children.length)}},{key:"hasChild",value:function(t){return this.children.includes(t)}},{key:"render",value:function(){var t,r;(t=this.tileConfigManager)===null||t===void 0||t.checkConfig(this.parent),(r=this.tilePickManager)===null||r===void 0||r.normalRender(this.children)}},{key:"pickLayers",value:function(t){var r;return(r=this.tilePickManager)===null||r===void 0?void 0:r.pickRender(this.children,t)}},{key:"setSubLayerInitOptipn",value:function(){var t,r=this.parent.getLayerConfig(),a=r.zIndex,s=a===void 0?0:a,l=r.opacity,d=l===void 0?1:l,m=r.mask,y=m===void 0?!1:m,C=r.stroke,w=C===void 0?"#fff":C,I=r.strokeWidth,L=I===void 0?0:I,U=r.strokeOpacity,K=U===void 0?1:U,ae=r.clampLow,Ae=ae===void 0?!0:ae,Ge=r.clampHigh,ot=Ge===void 0?!0:Ge,St=r.domain,zt=St===void 0?[0,1]:St,Ot=r.rampColors,er=Ot===void 0?{colors:["rgb(166,97,26)","rgb(223,194,125)","rgb(245,245,245)","rgb(128,205,193)","rgb(1,133,113)"],positions:[0,.25,.5,.75,1]}:Ot,_r=r.featureId,kr=_r===void 0?"id":_r,Kr=r.sourceLayer,Pr=this.tileConfigManager.getAttributeScale(this.parent,"color"),ln=this.tileConfigManager.getAttributeScale(this.parent,"size"),kn=this.parent.getSource(),Hn=(kn==null||(t=kn.data)===null||t===void 0?void 0:t.tilesetOptions)||{},xa=Hn.coords,Ua=Hy(this.parent.type,this.parent);er&&(this.rampColorsData=Se(er)),this.initOptions={layerType:this.parent.type,shape:Ua,zIndex:s,opacity:d,sourceLayer:Kr,coords:xa,featureId:kr,color:Pr,size:ln,mask:FC(this.parent.type,y),stroke:w,strokeWidth:L,strokeOpacity:K,clampLow:Ae,clampHigh:ot,domain:zt,rampColors:er,rampColorsData:this.rampColorsData}}},{key:"setConfigListener",value:function(){var t=this;if(this.tileConfigManager.setConfig("opacity",this.initOptions.opacity),this.tileConfigManager.setConfig("zIndex",this.initOptions.zIndex),this.tileConfigManager.setConfig("mask",this.initOptions.mask),this.parent.type==="RasterLayer")this.tileConfigManager.setConfig("rampColors",this.initOptions.rampColors),this.tileConfigManager.setConfig("domain",this.initOptions.domain),this.tileConfigManager.setConfig("clampHigh",this.initOptions.clampHigh),this.tileConfigManager.setConfig("clampLow",this.initOptions.clampLow);else{var r,a,s;this.tileConfigManager.setConfig("stroke",this.initOptions.stroke),this.tileConfigManager.setConfig("strokeWidth",this.initOptions.strokeWidth),this.tileConfigManager.setConfig("strokeOpacity",this.initOptions.strokeOpacity),this.tileConfigManager.setConfig("color",(r=this.parent.getAttribute("color"))===null||r===void 0?void 0:r.scale),this.tileConfigManager.setConfig("shape",(a=this.parent.getAttribute("shape"))===null||a===void 0?void 0:a.scale),this.tileConfigManager.setConfig("size",(s=this.parent.getAttribute("size"))===null||s===void 0?void 0:s.scale)}this.tileConfigManager.on("updateConfig",function(l){l.map(function(d){return t.updateStyle(d),""})})}},{key:"updateStyle",value:function(t){var r=this,a=null;if(["size","color","shape"].includes(t)){var s,l=(s=this.parent.getAttribute(t))===null||s===void 0?void 0:s.scale;if(!l)return;a=l,this.children.map(function(y){return r.tileFactory.setStyleAttributeField(y,t,l),""})}else{var d=this.parent.getLayerConfig();if(!(t in d))return;var m=d[t];a=m,this.updateLayersConfig(this.children,t,m),t==="rampColors"&&m&&(this.rampColorsData=Se(m))}this.initOptions[t]=a}},{key:"initTileFactory",value:function(){var t=this.parent.getSource(),r=NA(this.parent.type,t.parser);this.tileFactory=new r({parent:this.parent,mapService:this.mapService,rendererService:this.rendererService})}}]),e}();function o_(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Pc(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?o_(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o_(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var WA=function(){function e(i){var t,r=i.parent,a=i.rendererService,s=i.mapService,l=i.layerService,d=i.pickingService;(0,qt.Z)(this,e),(0,b.Z)(this,"type","baseTile"),(0,b.Z)(this,"sourceLayer",void 0),(0,b.Z)(this,"parent",void 0),(0,b.Z)(this,"initedTileset",!1),(0,b.Z)(this,"tilesetManager",void 0),(0,b.Z)(this,"tileLayerManager",void 0),(0,b.Z)(this,"scaleField",void 0),(0,b.Z)(this,"lastViewStates",void 0),(0,b.Z)(this,"timer",void 0),(0,b.Z)(this,"mapService",void 0),(0,b.Z)(this,"layerService",void 0),(0,b.Z)(this,"pickColors",{select:null,active:null});var m=r.getSource(),y=(m==null||(t=m.data)===null||t===void 0?void 0:t.tilesetOptions)||{},C=y.sourceLayer,w=y.coords,I=y.featureId;this.sourceLayer=C,this.parent=r,this.mapService=s,this.layerService=l,this.tileLayerManager=new HA(r,s,a,d,l),this.initTileSetManager(),this.bindSubLayerEvent(),this.bindSubLayerPick(),this.scaleField=this.parent.getScaleOptions()}return(0,Gt.Z)(e,[{key:"children",get:function(){return this.tileLayerManager.children}},{key:"render",value:function(){this.tileLayerManager&&this.tileLayerManager.render()}},{key:"clearPick",value:function(t){t==="mousemove"&&this.tileLayerManager.tilePickManager.clearPick()}},{key:"clearPickState",value:function(){var t=this;this.children.filter(function(r){return r.inited&&r.isVisible()}).filter(function(r){return r.getCurrentSelectedId()!==null}).map(function(r){t.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null)})}},{key:"pickLayers",value:function(t){return this.tileLayerManager.pickLayers(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"tileUnLoad",value:function(t){this.tileLayerManager.removeChilds(t.layerIDList,!1)}},{key:"tileUpdate",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(r){return r.isLoaded}).map(function(r){if(r.layerIDList.length===0){var a=t.tileLayerManager.createTile(r),s=a.layers,l=a.layerIDList;r.layerIDList=l,t.tileLayerManager.addChilds(s)}else{if(!r.isVisibleChange)return;var d=t.tileLayerManager.getChilds(r.layerIDList);t.tileLayerManager.updateLayersConfig(d,"visible",r.isVisible)}}),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}},{key:"setPickState",value:function(t){var r=this;if(this.pickColors.select){var a=ge(this.pickColors.select);t.map(function(l){r.selectFeature(l,r.pickColors.select),l.setCurrentSelectedId(a)})}if(this.pickColors.active){var s=ge(this.pickColors.active);t.filter(function(l){return l.inited&&l.isVisible()}).map(function(l){l.hooks.beforeHighlight.call(r.pickColors.active),l.setCurrentPickId(s)})}}},{key:"bindSubLayerPick",value:function(){var t=this;this.tileLayerManager.tilePickManager.on("pick",function(r){var a=(0,sn.Z)(r.pickedColors,3),s=a[0],l=a[1],d=a[2];if(r.type==="click"){var m=t.children.filter(function(y){return y.inited&&y.isVisible()&&y.isVector}).filter(function(y){return y!==r.layer});t.setSelect(m,[s,l,d])}else t.setHighlight([s,l,d])}),this.tileLayerManager.tilePickManager.on("unpick",function(){t.pickColors.active=null})}},{key:"setHighlight",value:function(t){var r=ge(t);this.pickColors.active=t,this.children.filter(function(a){return a.inited&&a.isVisible()&&a.isVector}).filter(function(a){return a.getPickID()!==r}).map(function(a){a.setPickID(r),a.hooks.beforeHighlight.call(t)})}},{key:"setSelect",value:function(t,r){var a=this,s=ge(r);t.map(function(d){d.getCurrentSelectedId()===null||s!==d.getCurrentSelectedId()?(a.selectFeature(d,r),d.setCurrentSelectedId(s),a.pickColors.select=r):(a.selectFeature(d,new Uint8Array([0,0,0,0])),d.setCurrentSelectedId(null),a.pickColors.select=null)});var l=this.layerService.getRenderList();l.filter(function(d){return d.inited&&!d.isVector&&d.isVisible()&&d.needPick("click")}).filter(function(d){return d.getCurrentSelectedId()!==null}).map(function(d){a.selectFeature(d,new Uint8Array([0,0,0,0])),d.setCurrentSelectedId(null)})}},{key:"selectFeature",value:function(t,r){var a=(0,sn.Z)(r,3),s=a[0],l=a[1],d=a[2];t.hooks.beforeSelect.call([s,l,d])}},{key:"bindSubLayerEvent",value:function(){var t=this;this.parent.on("subLayerClick",function(r){t.parent.emit("click",Pc({},r))}),this.parent.on("subLayerMouseMove",function(r){return t.parent.emit("mousemove",Pc({},r))}),this.parent.on("subLayerMouseUp",function(r){return t.parent.emit("mouseup",Pc({},r))}),this.parent.on("subLayerMouseEnter",function(r){return t.parent.emit("mouseenter",Pc({},r))}),this.parent.on("subLayerMouseOut",function(r){return t.parent.emit("mouseout",Pc({},r))}),this.parent.on("subLayerMouseDown",function(r){return t.parent.emit("mousedown",Pc({},r))}),this.parent.on("subLayerContextmenu",function(r){return t.parent.emit("contextmenu",Pc({},r))}),this.parent.on("subLayerUnClick",function(r){return t.parent.emit("unclick",Pc({},r))}),this.parent.on("subLayerUnMouseMove",function(r){return t.parent.emit("unmousemove",Pc({},r))}),this.parent.on("subLayerUnMouseUp",function(r){return t.parent.emit("unmouseup",Pc({},r))}),this.parent.on("subLayerUnMouseDown",function(r){return t.parent.emit("unmousedown",Pc({},r))}),this.parent.on("subLayerUnContextmenu",function(r){return t.parent.emit("uncontextmenu",Pc({},r))})}},{key:"initTileSetManager",value:function(){var t,r=this.parent.getSource();this.tilesetManager=r.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var a=this.getCurrentView(),s=a.latLonBounds,l=a.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(l,s)}},{key:"mapchange",value:function(){var t,r=this.getCurrentView(),a=r.latLonBounds,s=r.zoom;if(this.mapService.version==="GAODE1.x"){var l=this.parent.getLayerConfig(),d=l.visible;s<3&&d?(this.parent.updateLayerConfig({visible:!1}),this.layerService.updateLayerRenderList()):s>=3&&!d&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.updateLayerRenderList())}this.lastViewStates&&this.lastViewStates.zoom===s&&this.lastViewStates.latLonBounds.toString()===a.toString()||(this.lastViewStates={zoom:s,latLonBounds:a},this.timer&&(clearTimeout(this.timer),this.timer=null),(t=this.tilesetManager)===null||t===void 0||t.update(s,a))}},{key:"bindTilesetEvent",value:function(){var t=this;!this.tilesetManager||(this.tilesetManager.on("tile-loaded",function(r){}),this.tilesetManager.on("tile-unload",function(r){t.tileUnLoad(r)}),this.tilesetManager.on("tile-error",function(r,a){t.tileError(r)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",function(){return t.mapchange()}),this.mapService.on("moveend",function(){return t.mapchange()}))}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),r=[t[0][0],t[0][1],t[1][0],t[1][1]],a=this.mapService.getZoom();return{latLonBounds:r,zoom:a}}}]),e}();function XA(e){var i=YA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function YA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qA=function(e){(0,Wr.Z)(t,e);var i=XA(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"type","TMS"),r}return(0,Gt.Z)(t,[{key:"tileUnLoad",value:function(a){this.tileLayerManager.removeChilds(a.layerIDList,!1)}},{key:"tileUpdate",value:function(){var a=this;!this.tilesetManager||(this.tilesetManager.tiles.filter(function(s){return s.isLoaded}).map(function(s){var l;if((l=s.data)!==null&&l!==void 0&&l.layers&&a.sourceLayer){var d=s.data.layers[a.sourceLayer],m=d==null?void 0:d.features;if(!(Array.isArray(m)&&m.length>0))return}if(s.parentLayerIDList.includes(a.parent.id)){if(!s.isVisibleChange)return;var L=a.tileLayerManager.getChilds(s.layerIDList);a.tileLayerManager.updateLayersConfig(L,"visible",s.isVisible),a.setPickState(L)}else{var y,C=a.tileLayerManager.createTile(s),w=C.layers,I=C.layerIDList;s.parentLayerIDList.push(a.parent.id),(y=s.layerIDList).push.apply(y,(0,le.Z)(I)),a.tileLayerManager.addChilds(w),a.setPickState(w)}}),this.parent.renderLayers(),this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles))}}]),t}(WA);function KA(e){var i=$A();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function $A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iv=function(e){(0,Wr.Z)(t,e);var i=KA(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){return{}}},{key:"initModels",value:function(){var a;return(a=this.layer.getSource())!==null&&a!==void 0&&a.data.isTile&&(this.layer.tileLayer=new qA({parent:this.layer,rendererService:this.rendererService,mapService:this.mapService,layerService:this.layerService,pickingService:this.pickingService})),this.buildModels()}},{key:"buildModels",value:function(){return[]}},{key:"registerBuiltinAttributes",value:function(){}}]),t}(Wa);function QA(e){var i=JA();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function JA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ew=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,tw=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,rw=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,nw=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,iw=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,aw=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,ow={solid:0,dash:1},sw=function(e){(0,Wr.Z)(t,e);var i=QA(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),(0,b.Z)((0,he.Z)(r),"updateTexture",function(){var d=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas()}),r.layer.render();return}r.texture=d({data:r.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128})}),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.sourceColor,m=a.targetColor,y=a.textureBlend,C=y===void 0?"normal":y,w=a.lineType,I=w===void 0?"solid":w,L=a.dashArray,U=L===void 0?[10,5]:L,K=a.forward,ae=K===void 0?!0:K,Ae=a.lineTexture,Ge=Ae===void 0?!1:Ae,ot=a.iconStep,St=ot===void 0?100:ot,zt=a.segmentNumber,Ot=zt===void 0?30:zt,er=a.thetaOffset,_r=er===void 0?.314:er;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,thetaOffset:_r})){this.judgeStyleAttributes({opacity:l,thetaOffset:_r});var kr=this.layer.getEncodedData(),Kr=this.calDataFrame(this.cellLength,kr,this.cellProperties),Pr=Kr.data,ln=Kr.width,kn=Kr.height;this.rowCount=kn,this.dataTexture=this.cellLength>0&&Pr.length>0?this.createTexture2D({flipY:!0,data:Pr,format:W.LUMINANCE,type:W.FLOAT,width:ln,height:kn}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}U.length===2&&U.push(0,0);var Hn=0,xa=[0,0,0,0],Ua=[0,0,0,0];return d&&m&&(xa=Q(d),Ua=Q(m),Hn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:pa()(_r)?_r:0,u_opacity:pa()(l)?l:1,u_textureBlend:C==="normal"?0:1,segmentNumber:Ot,u_line_type:ow[I||"solid"],u_dash_array:U,u_blur:.9,u_lineDir:ae?1:-1,u_texture:this.texture,u_line_texture:Ge?1:0,u_icon_step:St,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Hn,u_sourceColor:xa,u_targetColor:Ua}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,l=a.targetColor,d=a.lineType;return d==="dash"?{frag:ew,vert:tw,type:"dash"}:s&&l?{frag:iw,vert:aw,type:"linear"}:{frag:rw,vert:nw,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,l=s===void 0?30:s,d=a.mask,m=d===void 0?!1:d,y=a.maskInside,C=y===void 0?!0:y,w=this.getShaders(),I=w.frag,L=w.vert,U=w.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+U,vertexShader:L,fragmentShader:I,triangulation:tv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:l,stencil:Re(m,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){var C=l.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ln.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(l,d,m,y){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ln.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y){var C=a.iconService.getIconMap(),w=l.texture,I=C[w]||{x:0,y:0},L=I.x,U=I.y;return[L,U]}}})}}]),t}(Wa);function uw(e){var i=lw();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function lw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,fw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,hw=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,pw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,dw={solid:0,dash:1},vw=function(e){(0,Wr.Z)(t,e);var i=uw(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),(0,b.Z)((0,he.Z)(r),"updateTexture",function(){var d=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas()}),r.layer.render();return}r.texture=d({data:r.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128})}),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.sourceColor,m=a.targetColor,y=a.textureBlend,C=y===void 0?"normal":y,w=a.lineType,I=w===void 0?"solid":w,L=a.dashArray,U=L===void 0?[10,5]:L,K=a.lineTexture,ae=K===void 0?!1:K,Ae=a.iconStep,Ge=Ae===void 0?100:Ae,ot=a.segmentNumber,St=ot===void 0?30:ot,zt=a.globalArcHeight,Ot=zt===void 0?10:zt;U.length===2&&U.push(0,0);var er=0,_r=[0,0,0,0],kr=[0,0,0,0];if(d&&m&&(_r=Q(d),kr=Q(m),er=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var Kr=this.layer.getEncodedData(),Pr=this.calDataFrame(this.cellLength,Kr,this.cellProperties),ln=Pr.data,kn=Pr.width,Hn=Pr.height;this.rowCount=Hn,this.dataTexture=this.cellLength>0&&ln.length>0?this.createTexture2D({flipY:!0,data:ln,format:W.LUMINANCE,type:W.FLOAT,width:kn,height:Hn}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:xy,u_global_height:Ot,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(l)?l:1,u_textureBlend:C==="normal"?0:1,segmentNumber:St,u_line_type:dw[I]||0,u_dash_array:U,u_texture:this.texture,u_line_texture:ae?1:0,u_icon_step:Ge,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:er,u_sourceColor:_r,u_targetColor:kr}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,l=a.targetColor;return s&&l?{frag:hw,vert:pw,type:"linear"}:{frag:cw,vert:fw,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,l=s===void 0?30:s,d=a.mask,m=d===void 0?!1:d,y=a.maskInside,C=y===void 0?!0:y,w=this.getShaders(),I=w.frag,L=w.vert,U=w.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+U,vertexShader:L,fragmentShader:I,triangulation:tv,blend:this.getBlend(),segmentNumber:l,stencil:Re(m,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){var C=l.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ln.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(l,d,m,y){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ln.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y){var C=a.iconService.getIconMap(),w=l.texture,I=C[w]||{x:0,y:0},L=I.x,U=I.y;return[L,U]}}})}}]),t}(Wa);function mw(e){var i=gw();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function gw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yw=`#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,_w=`#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,xw=function(e){(0,Wr.Z)(t,e);var i=mw(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.sourceColor,m=a.targetColor,y=a.forward,C=y===void 0?!0:y,w=a.segmentNumber,I=w===void 0?30:w,L=a.thetaOffset,U=L===void 0?.314:L,K=0,ae=[0,0,0,0],Ae=[0,0,0,0];return d&&m&&(ae=Q(d),Ae=Q(m),K=1),{u_thetaOffset:U,u_opacity:pa()(l)?l:1,segmentNumber:I,u_blur:.9,u_lineDir:C?1:-1,u_linearColor:K,u_sourceColor:ae,u_targetColor:Ae}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,l=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:_w,fragmentShader:yw,triangulation:tv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:l})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){var y=s.size,C=y===void 0?1:y;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ln.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(s,l,d,m){return[d[3],d[4],d[5],d[6]]}}})}}]),t}(Wa);function bw(e){var i=Ew();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function Ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,Cw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,Aw={solid:0,dash:1},ww=function(e){(0,Wr.Z)(t,e);var i=bw(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),(0,b.Z)((0,he.Z)(r),"updateTexture",function(){var d=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas()}),r.layer.render();return}r.texture=d({data:r.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128})}),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.sourceColor,m=a.targetColor,y=a.textureBlend,C=y===void 0?"normal":y,w=a.lineType,I=w===void 0?"solid":w,L=a.dashArray,U=L===void 0?[10,5]:L,K=a.lineTexture,ae=K===void 0?!1:K,Ae=a.iconStep,Ge=Ae===void 0?100:Ae,ot=a.segmentNumber,St=ot===void 0?30:ot;U.length===2&&U.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var zt=0,Ot=[0,0,0,0],er=[0,0,0,0];if(d&&m&&(Ot=Q(d),er=Q(m),zt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var _r=this.layer.getEncodedData(),kr=this.calDataFrame(this.cellLength,_r,this.cellProperties),Kr=kr.data,Pr=kr.width,ln=kr.height;this.rowCount=ln,this.dataTexture=this.cellLength>0&&Kr.length>0?this.createTexture2D({flipY:!0,data:Kr,format:W.LUMINANCE,type:W.FLOAT,width:Pr,height:ln}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(l)?l:1,u_textureBlend:C==="normal"?0:1,segmentNumber:St,u_line_type:Aw[I]||0,u_dash_array:U,u_texture:this.texture,u_line_texture:ae?1:0,u_icon_step:Ge,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:zt,u_sourceColor:Ot,u_targetColor:er}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:Cw,fragmentShader:Sw,triangulation:tv,depth:{enable:!1},blend:this.getBlend(),stencil:Re(l,m)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){var C=l.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ln.Attribute,descriptor:{name:"a_Instance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(l,d,m,y){return[m[3],m[4],m[5],m[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ln.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y){var C=a.iconService.getIconMap(),w=l.texture,I=C[w]||{x:0,y:0},L=I.x,U=I.y;return[L,U]}}})}}]),t}(Wa);function Tw(e){var i=Mw();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function Mw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pw=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Ow=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Iw=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,s_=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Rw=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,Lw={solid:0,dash:1},u_=function(e){(0,Wr.Z)(t,e);var i=Tw(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),(0,b.Z)((0,he.Z)(r),"updateTexture",function(){var d=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas()}),r.layer.render();return}r.texture=d({data:r.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128})}),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.sourceColor,m=a.targetColor,y=a.textureBlend,C=y===void 0?"normal":y,w=a.lineType,I=w===void 0?"solid":w,L=a.dashArray,U=L===void 0?[10,5,0,0]:L,K=a.lineTexture,ae=K===void 0?!1:K,Ae=a.iconStep,Ge=Ae===void 0?100:Ae,ot=a.vertexHeightScale,St=ot===void 0?20:ot,zt=a.borderWidth,Ot=zt===void 0?0:zt,er=a.borderColor,_r=er===void 0?"#ccc":er,kr=a.raisingHeight,Kr=kr===void 0?0:kr,Pr=a.heightfixed,ln=Pr===void 0?!1:Pr,kn=a.arrow,Hn=kn===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:kn;U.length===2&&U.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var xa=0,Ua=[0,0,0,0],Io=[0,0,0,0];if(d&&m&&(Ua=Q(d),Io=Q(m),xa=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var Ds=this.layer.getEncodedData(),Fs=this.calDataFrame(this.cellLength,Ds,this.cellProperties),Lc=Fs.data,Tm=Fs.width,Lv=Fs.height;this.rowCount=Lv,this.dataTexture=this.cellLength>0&&Lc.length>0?this.createTexture2D({flipY:!0,data:Lc,format:W.LUMINANCE,type:W.FLOAT,width:Tm,height:Lv}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(l)?l:1,u_textureBlend:C==="normal"?0:1,u_line_type:Lw[I],u_dash_array:U,u_texture:this.texture,u_line_texture:ae?1:0,u_icon_step:Ge,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Ot,u_borderColor:Q(_r),u_linearColor:xa,u_sourceColor:Ua,u_targetColor:Io,u_heightfixed:Number(ln),u_vertexScale:St,u_raisingHeight:Number(Kr),u_arrow:Number(Hn.enable),u_arrowHeight:Hn.arrowHeight||3,u_arrowWidth:Hn.arrowWidth||2,u_tailWidth:Hn.tailWidth===void 0?1:Hn.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d,y=a.depth,C=y===void 0?!1:y,w=this.getShaders(),I=w.frag,L=w.vert,U=w.type;return this.layer.triangulation=Gp,[this.layer.buildLayerModel({moduleName:"line_"+U,vertexShader:L,fragmentShader:I,triangulation:Gp,primitive:W.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Re(l,m)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,l=a.targetColor,d=a.lineType;return d==="dash"?{frag:Pw,vert:Ow,type:"dash"}:s&&l?{frag:Rw,vert:s_,type:"linear"}:{frag:Iw,vert:s_,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Ln.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y,C,w){return w===void 0?[m[3],10]:[m[3],w]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ln.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y){var C=l.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0],w[1]]:[w,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(l,d,m,y,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ln.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){return[m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ln.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y){var C=a.iconService.getIconMap(),w=l.texture,I=C[w]||{x:0,y:0},L=I.x,U=I.y;return[L,U]}}})}}]),t}(Wa);function kw(e){var i=Dw();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function Dw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fw=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,Bw=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Nw=function(e){(0,Wr.Z)(t,e);var i=kw(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"colorTexture",void 0),(0,b.Z)((0,he.Z)(r),"updateTexture",function(){var d=r.rendererService.createTexture2D;r.colorTexture&&r.colorTexture.destroy();var m=r.layer.getLayerConfig(),y=m.rampColors,C=Se(y);r.colorTexture=d({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.NEAREST,mag:W.NEAREST,flipY:!1})}),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.vertexHeightScale,m=d===void 0?20:d,y=a.raisingHeight,C=y===void 0?0:y,w=a.heightfixed,I=w===void 0?!1:w;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var L=this.layer.getEncodedData(),U=this.calDataFrame(this.cellLength,L,this.cellProperties),K=U.data,ae=U.width,Ae=U.height;this.rowCount=Ae,this.dataTexture=this.cellLength>0&&K.length>0?this.createTexture2D({flipY:!0,data:K,format:W.LUMINANCE,type:W.FLOAT,width:ae,height:Ae}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(l)?l:1,u_texture:this.colorTexture,u_heightfixed:Number(I),u_vertexScale:m,u_raisingHeight:Number(C)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.colorTexture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d,y=a.depth,C=y===void 0?!1:y,w=this.getShaders(),I=w.frag,L=w.vert,U=w.type;return this.layer.triangulation=Gp,[this.layer.buildLayerModel({moduleName:"line_"+U,vertexShader:L,fragmentShader:I,triangulation:Gp,primitive:W.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Re(l,m)})]}},{key:"getShaders",value:function(){return{frag:Fw,vert:Bw,type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Ln.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,l,d,m,y,C){return C===void 0?[d[3],10]:[d[3],C]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ln.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){return[d[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,l,d,m){var y=s.size,C=y===void 0?1:y;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,l,d,m,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ln.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){return[d[4]]}}})}}]),t}(Wa);function zw(e){var i=Zw();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function Zw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uw=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,jw=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,l_=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,Vw=function(e){(0,Wr.Z)(t,e);var i=zw(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.sourceColor,m=a.targetColor,y=a.vertexHeightScale,C=y===void 0?20:y,w=0,I=[0,0,0,0],L=[0,0,0,0];if(d&&m&&(I=Q(d),L=Q(m),w=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var U=this.layer.getEncodedData(),K=this.calDataFrame(this.cellLength,U,this.cellProperties),ae=K.data,Ae=K.width,Ge=K.height;this.rowCount=Ge,this.dataTexture=this.cellLength>0&&ae.length>0?this.createTexture2D({flipY:!0,data:ae,format:W.LUMINANCE,type:W.FLOAT,width:Ae,height:Ge}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(l)?l:1,u_linearColor:w,u_sourceColor:I,u_targetColor:L,u_vertexScale:C}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,l=a.targetColor;return s&&l?{frag:Uw,vert:l_,type:"simple_linear"}:{frag:jw,vert:l_,type:"simple_normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d,y=this.getShaders(),C=y.frag,w=y.vert,I=y.type;return[this.layer.buildLayerModel({moduleName:I,vertexShader:w,fragmentShader:C,triangulation:PS,primitive:W.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:Re(l,m)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Ln.Attribute,descriptor:{name:"a_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){return[d[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ln.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){return[d[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(s,l,d,m){var y=s.size,C=y===void 0?1:y;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(s,l,d,m,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ln.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){return[d[4]]}}})}}]),t}(Wa);function Gw(e){var i=Hw();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function Hw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ww=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Xw=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Yw=function(e){(0,Wr.Z)(t,e);var i=Gw(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),(0,b.Z)((0,he.Z)(r),"updateTexture",function(){var d=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas()}),r.layer.render();return}r.texture=d({data:r.iconService.getCanvas(),mag:W.NEAREST,min:W.NEAREST,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128})}),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.sourceColor,m=a.targetColor,y=a.textureBlend,C=y===void 0?"normal":y,w=a.heightfixed,I=w===void 0?!1:w,L=a.lineTexture,U=L===void 0?!1:L,K=a.iconStep,ae=K===void 0?100:K,Ae=a.iconStepCount,Ge=Ae===void 0?1:Ae;this.rendererService.getDirty()&&this.texture.bind();var ot=0,St=[0,0,0,0],zt=[0,0,0,0];if(d&&m&&(St=Q(d),zt=Q(m),ot=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var Ot=this.layer.getEncodedData(),er=this.calDataFrame(this.cellLength,Ot,this.cellProperties),_r=er.data,kr=er.width,Kr=er.height;this.rowCount=Kr,this.dataTexture=this.cellLength>0&&_r.length>0?this.createTexture2D({flipY:!0,data:_r,format:W.LUMINANCE,type:W.FLOAT,width:kr,height:Kr}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_heightfixed:Number(I),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(l)?l:1,u_textureBlend:C==="normal"?0:1,u_texture:this.texture,u_line_texture:U?1:0,u_iconStepCount:Ge,u_icon_step:ae,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ot,u_sourceColor:St,u_targetColor:zt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:Xw,fragmentShader:Ww,triangulation:Gp,primitive:W.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Ln.Attribute,descriptor:{name:"a_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){return[m[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ln.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){return[m[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y){var C=l.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0],w[1]]:[w,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(l,d,m,y,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ln.Attribute,descriptor:{name:"a_Miter",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){return[m[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ln.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y){var C=a.iconService.getIconMap(),w=l.texture,I=C[w]||{x:0,y:0},L=I.x,U=I.y;return[L,U]}}})}}]),t}(Wa),qw={arc:sw,arcmini:xw,arc3d:vw,greatcircle:ww,wall:Yw,line:u_,simple:Vw,linearline:Nw,vectorline:iv,tileLine:Wy},Kw=qw;function $w(e){var i=Qw();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function Qw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jw=function(e){(0,Wr.Z)(t,e);var i=$w(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"type","LineLayer"),r}return(0,Gt.Z)(t,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Kw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"},vectorline:{},tileLine:{}};return s[a]}},{key:"getModelType",value:function(){var a;if(this.layerSource.parser.type==="mvt")return"vectorline";var s=this.styleAttributeService.getLayerStyleAttribute("shape"),l=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return l||"line"}}]),t}(Gf);function eT(e){var i=tT();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function tT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rT=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];
  float lightWeight = styleMappingMat[1][3];
  float barLinearZ = styleMappingMat[2][3];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, barLinearZ);
    gl_FragColor.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - barLinearZ): barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,nT=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA - lightWeight
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - linearZ(\u5782\u76F4\u65B9\u5411 0 - 1 \u7684\u503C)
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  styleMappingMat[2][3] =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  styleMappingMat[1][3] = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,c_=function(e){(0,Wr.Z)(t,e);var i=eT(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"raiseCount",0),(0,b.Z)((0,he.Z)(r),"raiserepeat",0),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,l=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,d=a.opacity,m=d===void 0?1:d,y=a.sourceColor,C=a.targetColor,w=a.pickLight,I=w===void 0?!1:w,L=a.heightfixed,U=L===void 0?!1:L,K=a.opacityLinear,ae=K===void 0?{enable:!1,dir:"up"}:K,Ae=a.lightEnable,Ge=Ae===void 0?!0:Ae;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:m})){this.judgeStyleAttributes({opacity:m});var ot=this.layer.getEncodedData(),St=this.calDataFrame(this.cellLength,ot,this.cellProperties),zt=St.data,Ot=St.width,er=St.height;this.rowCount=er,this.dataTexture=this.cellLength>0&&zt.length>0?this.createTexture2D({flipY:!0,data:zt,format:W.LUMINANCE,type:W.FLOAT,width:Ot,height:er}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}var _r=0,kr=[0,0,0,0],Kr=[0,0,0,0];if(y&&C&&(kr=Q(y),Kr=Q(C),_r=1),this.raiseCount<1&&this.raiserepeat>0&&l.enable){var Pr=l.speed,ln=Pr===void 0?.01:Pr,kn=l.repeat,Hn=kn===void 0?!1:kn;this.raiseCount+=ln,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(I),u_heightfixed:Number(U),u_r:l.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(m)?m:1,u_linearColor:_r,u_sourceColor:kr,u_targetColor:Kr,u_opacitylinear:Number(ae.enable),u_opacitylinear_dir:ae.dir==="up"?1:0,u_lightEnable:Number(Ge)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,l=s===void 0?!0:s,d=a.animateOption.repeat,m=d===void 0?1:d;return this.raiserepeat=m,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:nT,fragmentShader:rT,triangulation:Iy,blend:this.getBlend(),cull:{enable:!0,face:mt(this.mapService.version)},depth:{enable:l}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(l,d,m,y){var C=l.size;if(C){var w=[];return Array.isArray(C)&&(w=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(w=[C,C,C]),w}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(l,d,m,y,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ln.Attribute,descriptor:{name:"a_Pos",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(l,d){var m=Up(l.coordinates);return a?Ey([m[0],m[1]]):[m[0],m[1],0]}}})}}]),t}(Wa);function iT(e){var i=aT();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function aT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f_=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,oT=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Kv=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_meter2coord;
uniform float u_meteryScale;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size) * u_meter2coord;
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    if(newSize * pow(2.0, u_Zoom) < 48.0) {
      antialiasblur = max(antialiasblur, -0.05);
    } else if(newSize * pow(2.0, u_Zoom) < 128.0) {
      antialiasblur = max(antialiasblur, -0.6/pow(u_Zoom, 2.0));
    } else {
      antialiasblur = max(antialiasblur, -0.8/pow(u_Zoom, 2.0));
    }
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.x += offset.x / u_meteryScale;
      aPosition.y += offset.y;
      offset = vec2(0.0);
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,h_=function(e){(0,Wr.Z)(t,e);var i=iT(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"meter2coord",1),(0,b.Z)((0,he.Z)(r),"meteryScale",1),(0,b.Z)((0,he.Z)(r),"isMeter",!1),(0,b.Z)((0,he.Z)(r),"unit","l7size"),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.strokeOpacity,m=d===void 0?1:d,y=a.strokeWidth,C=y===void 0?0:y,w=a.stroke,I=w===void 0?"rgba(0,0,0,0)":w,L=a.offsets,U=L===void 0?[0,0]:L,K=a.blend,ae=a.blur,Ae=ae===void 0?0:ae,Ge=a.raisingHeight,ot=Ge===void 0?0:Ge,St=a.unit,zt=St===void 0?"l7size":St;if(this.updateUnit(zt),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,strokeOpacity:m,strokeWidth:C,stroke:I,offsets:U})){this.judgeStyleAttributes({opacity:l,strokeOpacity:m,strokeWidth:C,stroke:I,offsets:U});var Ot=this.layer.getEncodedData(),er=this.calDataFrame(this.cellLength,Ot,this.cellProperties),_r=er.data,kr=er.width,Kr=er.height;this.rowCount=Kr,this.dataTexture=this.cellLength>0&&_r.length>0?this.createTexture2D({flipY:!0,data:_r,format:W.LUMINANCE,type:W.FLOAT,width:kr,height:Kr}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(ot),u_meter2coord:this.meter2coord,u_meteryScale:this.meteryScale,u_isMeter:Number(this.isMeter),u_blur:Ae,u_additive:K==="additive"?1:0,u_globel:this.mapService.version===ss.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(l)?l:1,u_stroke_opacity:pa()(m)?m:1,u_stroke_width:pa()(C)?C:1,u_stroke_color:this.getStrokeColor(I),u_offsets:this.isOffsetStatic(U)?U:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,l=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(l),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Wf)}},{key:"initModels",value:function(){return this.updateUnit("l7size"),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,sn.Z)(this.layer.getSource().extent,4),s=a[0],l=a[1],d=a[2],m=a[3],y=[(s+d)/2,(l+m)/2],C=this.mapService.version,w=Gi==null?void 0:Gi.mapboxgl;if(C===ss.MAPBOX&&w!==null&&w!==void 0&&w.MercatorCoordinate){var I=w.MercatorCoordinate.fromLngLat({lng:y[0],lat:y[1]},0),L=I.meterInMercatorCoordinateUnits(),U=new w.MercatorCoordinate(I.x-L,I.y,I.z),K=U.toLngLat(),ae=new w.MercatorCoordinate(I.x,I.y-L,I.z),Ae=ae.toLngLat();this.meter2coord=y[0]-K.lng,this.meteryScale=(Ae.lat-y[1])/this.meter2coord;return}var Ge=this.mapService.meterToCoord(y,[s,l]),ot=this.mapService.meterToCoord(y,[d===s?d+.1:d,m===l?l+.1:m]);this.meter2coord=(Ge+ot)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d,y=a.animateOption,C=y===void 0?{enable:!1}:y,w=this.getShaders(C),I=w.frag,L=w.vert,U=w.type,K=this.mapService.version==="GLOBEL";return this.layer.triangulation=K?Oy:Wf,[this.layer.buildLayerModel({moduleName:"pointfill_"+U,vertexShader:L,fragmentShader:I,triangulation:K?Oy:Wf,depth:{enable:K},blend:this.getBlend(),stencil:Re(l,m)})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:f_,vert:Kv,type:"wave"};default:return{frag:f_,vert:Kv,type:"wave"}}else return{frag:oT,vert:Kv,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ln.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(d,m,y,C){var w;if(s){var I=(0,sn.Z)(y,3),L=I[0],U=I[1],K=I[2],ae=Xa.fromValues(0,0,1),Ae=Xa.fromValues(L,0,K),Ge=L>=0?Xa.angle(ae,Ae):Math.PI*2-Xa.angle(ae,Ae),ot=Math.PI*2-Math.asin(U/100),St=Ls();tt(St,St,Ge),Pe(St,St,ot);var zt=Xa.fromValues(1,1,0);Xa.transformMat4(zt,zt,St),Xa.normalize(zt,zt);var Ot=Xa.fromValues(-1,1,0);Xa.transformMat4(Ot,Ot,St),Xa.normalize(Ot,Ot);var er=Xa.fromValues(-1,-1,0);Xa.transformMat4(er,er,St),Xa.normalize(er,er);var _r=Xa.fromValues(1,-1,0);Xa.transformMat4(_r,_r,St),Xa.normalize(_r,_r),w=[].concat((0,le.Z)(zt),(0,le.Z)(Ot),(0,le.Z)(er),(0,le.Z)(_r))}else w=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var kr=C%4*3;return[w[kr],w[kr+1],w[kr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(d,m,y,C){var w=d.size,I=w===void 0?5:w;return Array.isArray(I)?[I[0]]:[I]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Ln.Attribute,descriptor:{name:"a_Shape",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(d,m,y,C){var w=d.shape,I=w===void 0?2:w,L=a.layer.getLayerConfig().shape2d,U=L.indexOf(I);return[U]}}})}},{key:"updateUnit",value:function(a){var s=this.mapService.version;this.unit!==a&&(this.unit!=="meter"&&a==="meter"&&s!==ss.L7MAP&&s!==ss.GLOBEL?(this.isMeter=!0,this.calMeter2Coord()):this.unit==="meter"&&a!=="meter"&&(this.isMeter=!1,this.meter2coord=1),this.unit=a)}}]),t}(Wa);function sT(e){var i=uT();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function uT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lT=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,cT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,fT=function(e){(0,Wr.Z)(t,e);var i=sT(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"meter2coord",1),(0,b.Z)((0,he.Z)(r),"texture",void 0),(0,b.Z)((0,he.Z)(r),"isMeter",!1),(0,b.Z)((0,he.Z)(r),"radian",0),(0,b.Z)((0,he.Z)(r),"updateTexture",function(){var d=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),r.layer.renderLayers();return}r.texture=d({data:r.iconService.getCanvas(),mag:W.LINEAR,min:W.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128,mipmap:!0})}),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.offsets,m=d===void 0?[0,0]:d,y=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var C=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(C=-1),this.radian=y!==void 0?C*Math.PI*y/180:C*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,offsets:m})){this.judgeStyleAttributes({opacity:l,offsets:m});var w=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,w,this.cellProperties),L=I.data,U=I.width,K=I.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:W.LUMINANCE,type:W.FLOAT,width:U,height:K}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:pa()(l)?l:1,u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Wf)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,l=s===void 0?"l7size":s,d=this.mapService.version;return l==="meter"&&d!==ss.L7MAP&&d!==ss.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,sn.Z)(this.layer.getSource().extent,4),s=a[0],l=a[1],d=a[2],m=a[3],y=[(s+d)/2,(l+m)/2],C=this.mapService.version;if(C===ss.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:y[0],lat:y[1]},0),I=1,L=I*w.meterInMercatorCoordinateUnits(),U=new window.mapboxgl.MercatorCoordinate(w.x-L,w.y,w.z),K=U.toLngLat();this.meter2coord=y[0]-K.lng;return}var ae=this.mapService.meterToCoord(y,[s,l]),Ae=this.mapService.meterToCoord(y,[d===s?d+.1:d,m===l?l+.1:m]);this.meter2coord=(ae+Ae)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d,y=this.getShaders(),C=y.frag,w=y.vert,I=y.type;return[this.layer.buildLayerModel({moduleName:I,vertexShader:w,fragmentShader:C,triangulation:Wf,depth:{enable:!1},blend:this.getBlend(),stencil:Re(l,m),cull:{enable:!0,face:mt(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:lT,vert:cT,type:"point_fillImage"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Ln.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){var C=l.rotate,w=C===void 0?0:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y){var C=a.iconService.getIconMap(),w=l.shape,I=C[w]||{x:0,y:0},L=I.x,U=I.y;return[L,U]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ln.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(l,d,m,y){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],w=y%4*3;return[C[w],C[w+1],C[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){var C=l.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]*a.meter2coord]:[w*a.meter2coord]}}})}}]),t}(Wa);function hT(e){var i=pT();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function pT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dT=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,vT=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,mT=function(e){(0,Wr.Z)(t,e);var i=hT(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:vT,fragmentShader:dT,triangulation:Ry,primitive:W.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){var C=l.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y){var C=a.fontService.mapping,w=l.shape,I=a.fontService.getGlyph(w),L=C[I],U=L.x,K=L.y;return[U,K]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:W.LINEAR,min:W.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),l=s.fontWeight,d=l===void 0?"normal":l,m=s.fontFamily,y=m===void 0?"sans-serif":m,C=this.layer.getEncodedData(),w=[];C.forEach(function(I){var L=I.shape,U=L===void 0?"":L;U=U.toString();var K=a.fontService.getGlyph(U);w.indexOf(K)===-1&&w.push(K)}),this.fontService.setFontOptions({characterSet:w,fontWeight:d,fontFamily:y,fontSize:48})}}]),t}(Wa);function gT(e){var i=yT();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function yT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _T=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,xT=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
  }
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);
}
`,p_=function(e){(0,Wr.Z)(t,e);var i=gT(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),(0,b.Z)((0,he.Z)(r),"updateTexture",function(){var d=r.rendererService.createTexture2D;if(r.texture){r.texture.update({data:r.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),r.layer.renderLayers();return}r.texture=d({data:r.iconService.getCanvas(),mag:W.LINEAR,min:W.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:r.iconService.canvasHeight||128,mipmap:!0})}),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.offsets,m=d===void 0?[0,0]:d;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,offsets:m})){this.judgeStyleAttributes({opacity:l,offsets:m});var y=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,y,this.cellProperties),w=C.data,I=C.width,L=C.height;this.rowCount=L,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:W.LUMINANCE,type:W.FLOAT,width:I,height:L}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:pa()(l)?l:1,u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:xT,fragmentShader:_T,triangulation:Ry,primitive:W.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:Re(l,m)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){var C=l.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ln.Attribute,descriptor:{name:"a_Uv",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(l,d,m,y){var C=a.iconService.getIconMap(),w=l.shape,I=C[w]||{x:0,y:0},L=I.x,U=I.y;return[L,U]}}})}}]),t}(Wa);function bT(e){var i=ET();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function ET(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ST=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,CT=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function d_(e){var i=e.coordinates;return{vertices:(0,le.Z)(i),indices:[0],size:i.length}}var v_=function(e){(0,Wr.Z)(t,e);var i=bT(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.offsets,m=d===void 0?[0,0]:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,offsets:m})){this.judgeStyleAttributes({opacity:l,offsets:m});var y=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,y,this.cellProperties),w=C.data,I=C.width,L=C.height;this.rowCount=L,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:W.LUMINANCE,type:W.FLOAT,width:I,height:L}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(l)?l:1,u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d;return this.layer.triangulation=d_,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:CT,fragmentShader:ST,triangulation:d_,depth:{enable:!1},primitive:W.POINTS,blend:this.getBlend(),stencil:Re(l,m)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){var y=s.size,C=y===void 0?1:y;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Tc.additive}}}]),t}(Wa);function AT(e){var i=wT();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function wT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TT=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,MT=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  vec2 offset = (extrude.xy * (newSize) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,PT=function(e){(0,Wr.Z)(t,e);var i=AT(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"meter2coord",1),(0,b.Z)((0,he.Z)(r),"isMeter",!1),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.offsets,m=d===void 0?[0,0]:d,y=a.blend,C=a.speed,w=C===void 0?1:C;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,offsets:m})){this.judgeStyleAttributes({opacity:l,offsets:m});var I=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,I,this.cellProperties),U=L.data,K=L.width,ae=L.height;this.rowCount=ae,this.dataTexture=this.cellLength>0&&U.length>0?this.createTexture2D({flipY:!0,data:U,format:W.LUMINANCE,type:W.FLOAT,width:K,height:ae}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:w,u_additive:y==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(l)?l:1,u_offsets:this.isOffsetStatic(m)?m:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,l=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(l),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Wf)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,l=s===void 0?"l7size":s,d=this.mapService.version;return l==="meter"&&d!==ss.L7MAP&&d!==ss.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,sn.Z)(this.layer.getSource().extent,4),s=a[0],l=a[1],d=a[2],m=a[3],y=[(s+d)/2,(l+m)/2],C=this.mapService.version;if(C===ss.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:y[0],lat:y[1]},0),I=1,L=I*w.meterInMercatorCoordinateUnits(),U=new window.mapboxgl.MercatorCoordinate(w.x-L,w.y,w.z),K=U.toLngLat();this.meter2coord=y[0]-K.lng;return}var ae=this.mapService.meterToCoord(y,[s,l]),Ae=this.mapService.meterToCoord(y,[d===s?d+.1:d,m===l?l+.1:m]);this.meter2coord=(ae+Ae)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d,y=this.getShaders(),C=y.frag,w=y.vert,I=y.type;return[this.layer.buildLayerModel({moduleName:I,vertexShader:w,fragmentShader:C,triangulation:Wf,depth:{enable:!1},blend:this.getBlend(),stencil:Re(l,m)})]}},{key:"getShaders",value:function(){return{frag:TT,vert:MT,type:"point_radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ln.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(l,d,m,y){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var w=y%4*3;return[C[w],C[w+1],C[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){var C=l.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]*a.meter2coord]:[w*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Ln.Attribute,descriptor:{name:"a_Shape",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(l,d,m,y){var C=l.shape,w=C===void 0?2:C,I=a.layer.getLayerConfig().shape2d,L=I.indexOf(w);return[L]}}})}}]),t}(Wa);function OT(e){var i=IT();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function IT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RT=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,LT=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  vec2 offset = project_pixel(textrueOffsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function m_(e){var i=e.coordinates;return{vertices:(0,le.Z)(i),indices:[0],size:i.length}}var kT=function(e){(0,Wr.Z)(t,e);var i=OT(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.offsets,m=d===void 0?[0,0]:d,y=a.blend,C=a.strokeOpacity,w=C===void 0?1:C,I=a.strokeWidth,L=I===void 0?0:I,U=a.stroke,K=U===void 0?"#fff":U;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,offsets:m})){this.judgeStyleAttributes({opacity:l,offsets:m});var ae=this.layer.getEncodedData(),Ae=this.calDataFrame(this.cellLength,ae,this.cellProperties),Ge=Ae.data,ot=Ae.width,St=Ae.height;this.rowCount=St,this.dataTexture=this.cellLength>0&&Ge.length>0?this.createTexture2D({flipY:!0,data:Ge,format:W.LUMINANCE,type:W.FLOAT,width:ot,height:St}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_additive:y==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(l)?l:1,u_offsets:this.isOffsetStatic(m)?m:[0,0],u_stroke_opacity:pa()(w)?w:1,u_stroke_width:pa()(L)?L:1,u_stroke_color:this.getStrokeColor(K)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d;return this.layer.triangulation=m_,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:LT,fragmentShader:RT,triangulation:m_,depth:{enable:!1},primitive:W.POINTS,blend:this.getBlend(),stencil:Re(l,m)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(s,l,d,m){var y=s.size,C=y===void 0?1:y;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Tc.additive}}}]),t}(Wa),DT={fillImage:fT,fill:h_,radar:PT,image:p_,normal:v_,simplePoint:kT,extrude:c_,text:Xv,icon:mT,vectorpoint:iv,tile:nv},FT=DT;function BT(e,i){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=NT(e))||i&&e&&typeof e.length=="number"){t&&(e=t);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(y){throw y},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,d;return{s:function(){t=t.call(e)},n:function(){var y=t.next();return s=y.done,y},e:function(y){l=!0,d=y},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw d}}}}function NT(e,i){if(!!e){if(typeof e=="string")return g_(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return g_(e,i)}}function g_(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function zT(e){var i=ZT();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function ZT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UT=function(e){(0,Wr.Z)(t,e);var i=zT(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"type","PointLayer"),r}return(0,Gt.Z)(t,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new FT[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,l=a.values,d=this.getLayerConfig(),m=d.shape2d,y=d.shape3d,C=this.iconService.getIconMap();if(s&&(m==null?void 0:m.indexOf(s))!==-1)return"fill";if(l&&l instanceof Array){var w=BT(l),I;try{for(w.s();!(I=w.n()).done;){var L=I.value;if(typeof L=="string"&&C.hasOwnProperty(L))return"image"}}catch(U){w.e(U)}finally{w.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"},vectorpoint:{},tile:{}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon","vectorpoint","tile"];if(this.layerSource.parser.type==="mvt")return"vectorpoint";if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),l=this.getLayerConfig(),d=l.shape2d,m=l.shape3d,y=this.iconService.getIconMap(),C=s.find(function(I){return I.hasOwnProperty("shape")});if(C){var w=C.shape;return w==="dot"?"normal":w==="simple"?"simplePoint":w==="radar"?"radar":w==="fillImage"?"fillImage":(d==null?void 0:d.indexOf(w))!==-1?"fill":(m==null?void 0:m.indexOf(w))!==-1?"extrude":y.hasOwnProperty(w)?"image":this.fontService.getGlyph(w)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Gf);function jT(e){var i=VT();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function VT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GT=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,HT=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,WT=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,XT=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,YT=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,qT=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,KT=function(e){(0,Wr.Z)(t,e);var i=jT(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.heightfixed,m=d===void 0?!1:d,y=a.raisingHeight,C=y===void 0?0:y,w=a.topsurface,I=w===void 0?!0:w,L=a.sidesurface,U=L===void 0?!0:L,K=a.sourceColor,ae=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var Ae=this.layer.getEncodedData(),Ge=this.calDataFrame(this.cellLength,Ae,this.cellProperties),ot=Ge.data,St=Ge.width,zt=Ge.height;this.rowCount=zt,this.dataTexture=this.cellLength>0&&ot.length>0?this.createTexture2D({flipY:!0,data:ot,format:W.LUMINANCE,type:W.FLOAT,width:St,height:zt}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}var Ot=0,er=[1,1,1,1],_r=[1,1,1,1];return K&&ae&&(er=Q(K),_r=Q(ae),Ot=1),{u_topsurface:Number(I),u_sidesurface:Number(U),u_heightfixed:Number(m),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:pa()(l)?l:1,u_linearColor:Ot,u_sourceColor:er,u_targetColor:_r,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d,y=this.getShaders(),C=y.frag,w=y.vert,I=y.type;return[this.layer.buildLayerModel({moduleName:I,vertexShader:w,fragmentShader:C,triangulation:Ly,stencil:Re(l,m)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,l=a.mapTexture;return l?{frag:WT,vert:XT,type:"polygonExtrudeTexture"}:s?{frag:YT,vert:qT,type:"polygonExtrudePickLight"}:{frag:GT,vert:HT,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,sn.Z)(a,4),l=s[0],d=s[1],m=s[2],y=s[3],C=m-l,w=y-d;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Ln.Attribute,descriptor:{name:"a_uvs",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(L,U,K,ae,Ae){var Ge=K[0],ot=K[1];return[(Ge-l)/C,(ot-d)/w,K[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ln.Attribute,descriptor:{name:"a_Normal",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(L,U,K,ae,Ae){return Ae}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ln.Attribute,descriptor:{name:"a_Size",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(L,U,K,ae){var Ae=L.size,Ge=Ae===void 0?10:Ae;return Array.isArray(Ge)?[Ge[0]]:[Ge]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),l=s.mapTexture,d=this.rendererService.createTexture2D;if(this.texture=d({height:0,width:0}),l){var m=new Image;m.crossOrigin="",m.src=l,m.onload=function(){a.texture=d({data:m,width:m.width,height:m.height,wrapS:W.CLAMP_TO_EDGE,wrapT:W.CLAMP_TO_EDGE,min:W.LINEAR,mag:W.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),t}(Wa);function $T(e){var i=QT();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function QT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JT=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,eM=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,tM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,rM=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,nM=function(e){(0,Wr.Z)(t,e);var i=$T(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,l=s===void 0?0:s,d=a.opacity,m=d===void 0?1:d,y=a.opacityLinear,C=y===void 0?{enable:!1,dir:"in"}:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:m})){this.judgeStyleAttributes({opacity:m});var w=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,w,this.cellProperties),L=I.data,U=I.width,K=I.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:W.LUMINANCE,type:W.FLOAT,width:U,height:K}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(l),u_opacity:pa()(m)?m:1,u_opacitylinear:Number(C.enable),u_dir:C.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.getModelParams(),s=a.frag,l=a.vert,d=a.triangulation,m=a.type,y=this.layer.getLayerConfig(),C=y.mask,w=C===void 0?!1:C,I=y.maskInside,L=I===void 0?!0:I;return this.layer.triangulation=d,[this.layer.buildLayerModel({moduleName:m,vertexShader:l,fragmentShader:s,triangulation:d,blend:this.getBlend(),depth:{enable:!1},stencil:Re(w,L)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,l=s===void 0?{enable:!1,dir:"in"}:s;l.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Ln.Attribute,descriptor:{name:"a_linear",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:3,update:function(m,y,C,w,I){return[C[3],C[4],C[5]]}}})}},{key:"getModelParams",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,l=s===void 0?{enable:!1}:s;return l.enable?{frag:eM,vert:tM,type:"polygon_linear",triangulation:OS}:{frag:JT,vert:rM,type:"polygon_fill",triangulation:c0}}}]),t}(Wa);function iM(e){var i=aM();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function aM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oM=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);  
}
`,sM=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,uM=function(e){(0,Wr.Z)(t,e);var i=iM(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture1",void 0),(0,b.Z)((0,he.Z)(r),"texture2",void 0),(0,b.Z)((0,he.Z)(r),"texture3",void 0),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.watercolor,m=d===void 0?"#6D99A8":d,y=a.watercolor2,C=y===void 0?"#0F121C":y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var w=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,w,this.cellProperties),L=I.data,U=I.width,K=I.height;this.rowCount=K,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:W.LUMINANCE,type:W.FLOAT,width:U,height:K}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Q(m),u_watercolor2:Q(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(l)?l:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:sM,fragmentShader:oM,triangulation:c0,depth:{enable:!1},stencil:Re(l,m)})]}},{key:"clearModels",value:function(){var a,s,l,d;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(l=this.texture3)===null||l===void 0||l.destroy(),(d=this.dataTexture)===null||d===void 0||d.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,sn.Z)(a,4),l=s[0],d=s[1],m=s[2],y=s[3],C=m-l,w=y-d;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Ln.Attribute,descriptor:{name:"a_uv",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(L,U,K,ae,Ae){var Ge=(0,sn.Z)(K,2),ot=Ge[0],St=Ge[1];return[(ot-l)/C,(St-d)/w]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,l={height:0,width:0};this.texture1=s(l),this.texture2=s(l),this.texture3=s(l),d(function(y){a.texture1=m(y[0]),a.texture2=m(y[1]),a.texture3=m(y[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function d(y){var C=0,w=[],I=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];I.map(function(L){var U=new Image;U.crossOrigin="",U.src=L,w.push(U),U.onload=function(){C++,C===3&&y(w)}})}function m(y){return s({data:y,width:y.width,height:y.height,wrapS:W.MIRRORED_REPEAT,wrapT:W.MIRRORED_REPEAT,min:W.LINEAR,mag:W.LINEAR})}}}]),t}(Wa);function lM(e){var i=cM();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function cM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fM=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E


float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,hM=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,pM=function(e){(0,Wr.Z)(t,e);var i=lM(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"texture",void 0),r}return(0,Gt.Z)(t,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,l=s===void 0?1:s,d=a.speed,m=d===void 0?.5:d;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var y=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,y,this.cellProperties),w=C.data,I=C.width,L=C.height;this.rowCount=L,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:W.LUMINANCE,type:W.FLOAT,width:I,height:L}):this.createTexture2D({flipY:!0,data:[1],format:W.LUMINANCE,type:W.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:m,u_opacity:pa()(l)?l:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,l=s===void 0?!1:s,d=a.maskInside,m=d===void 0?!0:d;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:hM,fragmentShader:fM,triangulation:c0,depth:{enable:!1},stencil:Re(l,m)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,sn.Z)(a,4),l=s[0],d=s[1],m=s[2],y=s[3],C=m-l,w=y-d;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Ln.Attribute,descriptor:{name:"a_uv",buffer:{usage:W.STATIC_DRAW,data:[],type:W.FLOAT},size:2,update:function(L,U,K,ae,Ae){var Ge=(0,sn.Z)(K,2),ot=Ge[0],St=Ge[1];return[(ot-l)/C,(St-d)/w]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),l=s.waterTexture,d=this.rendererService.createTexture2D;this.texture=d({height:0,width:0});var m=new Image;m.crossOrigin="",l?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),m.src=l):m.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",m.onload=function(){a.texture=d({data:m,width:m.width,height:m.height,wrapS:W.MIRRORED_REPEAT,wrapT:W.MIRRORED_REPEAT,min:W.LINEAR,mag:W.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),t}(Wa),dM={fill:nM,line:u_,extrude:KT,text:Xv,point_fill:h_,point_image:p_,point_normal:v_,point_extrude:c_,water:pM,ocean:uM,vectorpolygon:iv,tile:n_},vM=dM;function mM(e){var i=gM();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function gM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y_=function(e){(0,Wr.Z)(t,e);var i=mM(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"type","PolygonLayer"),r}return(0,Gt.Z)(t,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new vM[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a;if(this.layerSource.parser.type==="mvt")return"vectorpolygon";var s=this.styleAttributeService.getLayerStyleAttribute("shape"),l=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return l==="fill"?"fill":l==="extrude"?"extrude":l==="water"?"water":l==="ocean"?"ocean":l==="line"?"line":l==="tile"?"tile":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),l=s.shape2d,d=s.shape3d,m=this.iconService.getIconMap(),y=a.find(function(w){return w.hasOwnProperty("shape")});if(y){var C=y.shape;return C==="dot"?"point_normal":(l==null?void 0:l.indexOf(C))!==-1?"point_fill":(d==null?void 0:d.indexOf(C))!==-1?"point_extrude":m.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),t}(Gf),yM={raster:qv,raster3d:qv,rasterTile:iv},_M=yM;function xM(e){var i=bM();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function bM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EM=function(e){(0,Wr.Z)(t,e);var i=xM(t);function t(){var r;(0,qt.Z)(this,t);for(var a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];return r=i.call.apply(i,[this].concat(s)),(0,b.Z)((0,he.Z)(r),"type","RasterLayer"),r}return(0,Gt.Z)(t,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new _M[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{},rasterTile:{}};return s[a]}},{key:"getModelType",value:function(){switch(this.layerSource.parser.type){case"raster":return"raster";case"rasterTile":return"rasterTile";default:return"raster"}}}]),t}(Gf),__,x_,b_,E_,S_,h0,C_,A_,w_;function T_(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function SM(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?T_(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):T_(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var CM=(__=(0,wt.b2)(),x_=(0,wt.f3)(Ke.IGlobalConfigService),b_=(0,wt.f3)(Ke.IMapService),E_=(0,wt.f3)(Ke.IFontService),__(S_=(h0=function(){function e(){(0,qt.Z)(this,e),Mt(this,"configService",C_,this),Mt(this,"mapService",A_,this),Mt(this,"fontService",w_,this)}return(0,Gt.Z)(e,[{key:"apply",value:function(t,r){var a=this,s=r.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(t,{styleAttributeService:s})}),t.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return t.dataState.dataMappingNeedUpdate=!1,a.generateMaping(t,{styleAttributeService:s}),!0}),t.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!t.layerModelNeedUpdate){var l=t.getBottomColor(),d=s.getLayerStyleAttributes()||[],m=s.getLayerStyleAttribute("filter"),y=t.getSource().data.dataArray,C=d.filter(function(I){return I.needRemapping}),w=y;m!=null&&m.needRemapping&&m!==null&&m!==void 0&&m.scale&&(w=y.filter(function(I){return a.applyAttributeMapping(m,I,l)[0]})),C.length&&(m!=null&&m.needRemapping?(t.setEncodedData(a.mapping(t,d,w,void 0,l)),m.needRemapping=!1):t.setEncodedData(a.mapping(t,C,w,t.getEncodedData(),l)),t.emit("remapping",null))}})}},{key:"generateMaping",value:function(t,r){var a=this,s=r.styleAttributeService,l=t.getBottomColor(),d=s.getLayerStyleAttributes()||[],m=s.getLayerStyleAttribute("filter"),y=t.getSource().data.dataArray,C=y;m!=null&&m.scale&&(C=y.filter(function(w){return a.applyAttributeMapping(m,w,l)[0]})),t.setEncodedData(this.mapping(t,d,C,void 0,l)),t.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(t,r){var a=[r[0]-t[0],r[1]-t[1]],s=vc(a),l=[t[0]+s[0]*1e-4,t[1]+s[1]*1e-4];return l}},{key:"mapping",value:function(t,r,a,s,l){var d=this,m=t.getLayerConfig(),y=m.arrow,C=y===void 0?{enable:!1}:y,w=a.map(function(I,L){var U=s?s[L]:{},K=SM({id:I._id,coordinates:I.coordinates},U);if(r.filter(function(Ge){return Ge.scale!==void 0}).forEach(function(Ge){var ot=d.applyAttributeMapping(Ge,I,l);Ge.needRemapping=!1,Ge.name==="color"&&(ot=ot.map(function(St){return Q(St)})),K[Ge.name]=Array.isArray(ot)&&ot.length===1?ot[0]:ot,Ge.name==="shape"&&(K.shape=d.fontService.getIconFontKey(K[Ge.name]))}),K.shape==="line"&&C.enable){var ae=K.coordinates,Ae=d.getArrowPoints(ae[0],ae[1]);K.coordinates.splice(1,0,Ae,Ae)}return K});return this.adjustData2Amap2Coordinates(w,t),this.adjustData2SimpleCoordinates(w),w}},{key:"adjustData2Amap2Coordinates",value:function(t,r){var a=this;if(t.length>0&&this.mapService.version===ss["GAODE2.x"]){var s=this.getLayerCenter(r);typeof t[0].coordinates[0]=="number"?t.filter(function(l){return!l.originCoordinates}).map(function(l){l.version=ss["GAODE2.x"],l.originCoordinates=Xc()(l.coordinates),l.coordinates=a.mapService.lngLatToCoordByLayer(l.coordinates,s)}):t.filter(function(l){return!l.originCoordinates}).map(function(l){l.version=ss["GAODE2.x"],l.originCoordinates=Xc()(l.coordinates),l.coordinates=a.mapService.lngLatToCoordsByLayer(l.coordinates,s)})}}},{key:"getLayerCenter",value:function(t){var r=t.getSource();return r.center}},{key:"adjustData2SimpleCoordinates",value:function(t){var r=this;t.length>0&&this.mapService.version===ss.SIMPLE&&t.map(function(a){a.simpleCoordinate||(a.coordinates=r.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var r=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var a=[];return t.map(function(l){var d=[];l.map(function(m){d.push(r.mapService.simpleMapCoord.unproject(m))}),a.push(d)}),a}else{var s=[];return t.map(function(l){s.push(r.mapService.simpleMapCoord.unproject(l))}),s}}},{key:"applyAttributeMapping",value:function(t,r,a){var s;if(!t.scale)return[];var l=(t==null||(s=t.scale)===null||s===void 0?void 0:s.scalers)||[],d=[];l.forEach(function(y){var C,w=y.field;(r.hasOwnProperty(w)||((C=t.scale)===null||C===void 0?void 0:C.type)==="variable")&&d.push(r[w])});var m=t.mapping?t.mapping(d):[];return t.name==="color"&&!G(m[0])?[a]:m}}]),e}(),C_=Pt(h0.prototype,"configService",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A_=Pt(h0.prototype,"mapService",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w_=Pt(h0.prototype,"fontService",[E_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h0))||S_),M_,P_,AM=(M_=(0,wt.b2)(),M_(P_=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"mapService",void 0)}return(0,Gt.Z)(e,[{key:"apply",value:function(t){var r=this;this.mapService=t.getContainer().get(Ke.IMapService),t.hooks.init.tap("DataSourcePlugin",function(){var a=t.getSource();if(!a){var s=t.sourceOption||{data:ar,options:yr},l=s.data,d=s.options;t.setSource(new Tr(l,d))}r.updateClusterData(t)}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=r.updateClusterData(t),s=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(t){var r=t.getSource(),a=r.cluster,s=r.clusterOptions,l=s.zoom,d=l===void 0?0:l,m=s.maxZoom,y=m===void 0?16:m,C=this.mapService.getZoom()-1,w=t.dataState.dataSourceNeedUpdate;return a&&(w||Math.abs(t.clusterZoom-C)>=1)?(d!==Math.floor(C)&&r.updateClusterData(Math.floor(C)),t.clusterZoom=C,!0):!1}}]),e}())||P_);function $v(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function O_(e){return e.length===1&&(e=wM(e)),{left:function(i,t,r,a){for(r==null&&(r=0),a==null&&(a=i.length);r<a;){var s=r+a>>>1;e(i[s],t)<0?r=s+1:a=s}return r},right:function(i,t,r,a){for(r==null&&(r=0),a==null&&(a=i.length);r<a;){var s=r+a>>>1;e(i[s],t)>0?a=s:r=s+1}return r}}}function wM(e){return function(i,t){return $v(e(i),t)}}var I_=O_($v),TM=I_.right,ZO=I_.left,av=TM;function R_(e,i){var t=e.length,r=-1,a,s,l;if(i==null){for(;++r<t;)if((a=e[r])!=null&&a>=a)for(s=l=a;++r<t;)(a=e[r])!=null&&(s>a&&(s=a),l<a&&(l=a))}else for(;++r<t;)if((a=i(e[r],r,e))!=null&&a>=a)for(s=l=a;++r<t;)(a=i(e[r],r,e))!=null&&(s>a&&(s=a),l<a&&(l=a));return[s,l]}var L_=Array.prototype,UO=L_.slice,jO=L_.map,Qv=Math.sqrt(50),Jv=Math.sqrt(10),em=Math.sqrt(2);function k_(e,i,t){var r,a=-1,s,l,d;if(i=+i,e=+e,t=+t,e===i&&t>0)return[e];if((r=i<e)&&(s=e,e=i,i=s),(d=ov(e,i,t))===0||!isFinite(d))return[];if(d>0)for(e=Math.ceil(e/d),i=Math.floor(i/d),l=new Array(s=Math.ceil(i-e+1));++a<s;)l[a]=(e+a)*d;else for(e=Math.floor(e*d),i=Math.ceil(i*d),l=new Array(s=Math.ceil(e-i+1));++a<s;)l[a]=(e-a)/d;return r&&l.reverse(),l}function ov(e,i,t){var r=(i-e)/Math.max(0,t),a=Math.floor(Math.log(r)/Math.LN10),s=r/Math.pow(10,a);return a>=0?(s>=Qv?10:s>=Jv?5:s>=em?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=Qv?10:s>=Jv?5:s>=em?2:1)}function tm(e,i,t){var r=Math.abs(i-e)/Math.max(0,t),a=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),s=r/a;return s>=Qv?a*=10:s>=Jv?a*=5:s>=em&&(a*=2),i<e?-a:a}function VO(){var e=identity,i=extent,t=sturges;function r(a){var s,l=a.length,d,m=new Array(l);for(s=0;s<l;++s)m[s]=e(a[s],s,a);var y=i(m),C=y[0],w=y[1],I=t(m,C,w);Array.isArray(I)||(I=tickStep(C,w,I),I=range(Math.ceil(C/I)*I,w,I));for(var L=I.length;I[0]<=C;)I.shift(),--L;for(;I[L-1]>w;)I.pop(),--L;var U=new Array(L+1),K;for(s=0;s<=L;++s)K=U[s]=[],K.x0=s>0?I[s-1]:C,K.x1=s<L?I[s]:w;for(s=0;s<l;++s)d=m[s],C<=d&&d<=w&&U[bisect(I,d,0,L)].push(a[s]);return U}return r.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),r):e},r.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),r):i},r.thresholds=function(a){return arguments.length?(t=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),r):t},r}function GO(e,i,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function MM(e){return e===null?NaN:+e}function PM(e,i,t){if(t==null&&(t=MM),!!(r=e.length)){if((i=+i)<=0||r<2)return+t(e[0],0,e);if(i>=1)return+t(e[r-1],r-1,e);var r,a=(r-1)*i,s=Math.floor(a),l=+t(e[s],s,e),d=+t(e[s+1],s+1,e);return l+(d-l)*(a-s)}}var OM=F(46849),Oc="$";function sv(){}sv.prototype=D_.prototype={constructor:sv,has:function(e){return Oc+e in this},get:function(e){return this[Oc+e]},set:function(e,i){return this[Oc+e]=i,this},remove:function(e){var i=Oc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Oc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Oc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Oc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Oc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Oc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Oc)return!1;return!0},each:function(e){for(var i in this)i[0]===Oc&&e(this[i],i.slice(1),this)}};function D_(e,i){var t=new sv;if(e instanceof sv)e.each(function(d,m){t.set(m,d)});else if(Array.isArray(e)){var r=-1,a=e.length,s;if(i==null)for(;++r<a;)t.set(r,e[r]);else for(;++r<a;)t.set(i(s=e[r],r,e),s)}else if(e)for(var l in e)t.set(l,e[l]);return t}var rm=D_;function HO(){var e=[],i=[],t,r,a;function s(d,m,y,C){if(m>=e.length)return t!=null&&d.sort(t),r!=null?r(d):d;for(var w=-1,I=d.length,L=e[m++],U,K,ae=map(),Ae,Ge=y();++w<I;)(Ae=ae.get(U=L(K=d[w])+""))?Ae.push(K):ae.set(U,[K]);return ae.each(function(ot,St){C(Ge,St,s(ot,m,y,C))}),Ge}function l(d,m){if(++m>e.length)return d;var y,C=i[m-1];return r!=null&&m>=e.length?y=d.entries():(y=[],d.each(function(w,I){y.push({key:I,values:l(w,m)})})),C!=null?y.sort(function(w,I){return C(w.key,I.key)}):y}return a={object:function(d){return s(d,0,IM,RM)},map:function(d){return s(d,0,F_,B_)},entries:function(d){return l(s(d,0,F_,B_),0)},key:function(d){return e.push(d),a},sortKeys:function(d){return i[e.length-1]=d,a},sortValues:function(d){return t=d,a},rollup:function(d){return r=d,a}}}function IM(){return{}}function RM(e,i,t){e[i]=t}function F_(){return map()}function B_(e,i,t){e.set(i,t)}function uv(){}var Hp=rm.prototype;uv.prototype=LM.prototype={constructor:uv,has:Hp.has,add:function(e){return e+="",this[Oc+e]=e,this},remove:Hp.remove,clear:Hp.clear,values:Hp.keys,size:Hp.size,empty:Hp.empty,each:Hp.each};function LM(e,i){var t=new uv;if(e instanceof uv)e.each(function(s){t.add(s)});else if(e){var r=-1,a=e.length;if(i==null)for(;++r<a;)t.add(e[r]);else for(;++r<a;)t.add(i(e[r],r,e))}return t}var WO=null,N_=Array.prototype,lv=N_.map,Wp=N_.slice;function op(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function z_(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var Z_={name:"implicit"};function cv(){var e=rm(),i=[],t=[],r=Z_;function a(s){var l=s+"",d=e.get(l);if(!d){if(r!==Z_)return r;e.set(l,d=i.push(s))}return t[(d-1)%t.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=rm();for(var l=-1,d=s.length,m,y;++l<d;)e.has(y=(m=s[l])+"")||e.set(y,i.push(m));return a},a.range=function(s){return arguments.length?(t=Wp.call(s),a):t.slice()},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return cv(i,t).unknown(r)},op.apply(a,arguments),a}function U_(){var e=ordinal().unknown(void 0),i=e.domain,t=e.range,r=[0,1],a,s,l=!1,d=0,m=0,y=.5;delete e.unknown;function C(){var w=i().length,I=r[1]<r[0],L=r[I-0],U=r[1-I];a=(U-L)/Math.max(1,w-d+m*2),l&&(a=Math.floor(a)),L+=(U-L-a*(w-d))*y,s=a*(1-d),l&&(L=Math.round(L),s=Math.round(s));var K=sequence(w).map(function(ae){return L+a*ae});return t(I?K.reverse():K)}return e.domain=function(w){return arguments.length?(i(w),C()):i()},e.range=function(w){return arguments.length?(r=[+w[0],+w[1]],C()):r.slice()},e.rangeRound=function(w){return r=[+w[0],+w[1]],l=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(w){return arguments.length?(l=!!w,C()):l},e.padding=function(w){return arguments.length?(d=Math.min(1,m=+w),C()):d},e.paddingInner=function(w){return arguments.length?(d=Math.min(1,w),C()):d},e.paddingOuter=function(w){return arguments.length?(m=+w,C()):m},e.align=function(w){return arguments.length?(y=Math.max(0,Math.min(1,w)),C()):y},e.copy=function(){return U_(i(),r).round(l).paddingInner(d).paddingOuter(m).align(y)},initRange.apply(C(),arguments)}function j_(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return j_(i())},e}function XO(){return j_(U_.apply(null,arguments).paddingInner(1))}var kM=F(26257),DM=F(73626);function FM(e,i){return e=+e,i=+i,function(t){return Math.round(e*(1-t)+i*t)}}function BM(e){return function(){return e}}function nm(e){return+e}var V_=[0,1];function Xu(e){return e}function im(e,i){return(i-=e=+e)?function(t){return(t-e)/i}:BM(isNaN(i)?NaN:.5)}function G_(e){var i=e[0],t=e[e.length-1],r;return i>t&&(r=i,i=t,t=r),function(a){return Math.max(i,Math.min(t,a))}}function NM(e,i,t){var r=e[0],a=e[1],s=i[0],l=i[1];return a<r?(r=im(a,r),s=t(l,s)):(r=im(r,a),s=t(s,l)),function(d){return s(r(d))}}function zM(e,i,t){var r=Math.min(e.length,i.length)-1,a=new Array(r),s=new Array(r),l=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++l<r;)a[l]=im(e[l],e[l+1]),s[l]=t(i[l],i[l+1]);return function(d){var m=av(e,d,1,r)-1;return s[m](a[m](d))}}function fv(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function am(){var e=V_,i=V_,t=kM.Z,r,a,s,l=Xu,d,m,y;function C(){return d=Math.min(e.length,i.length)>2?zM:NM,m=y=null,w}function w(I){return isNaN(I=+I)?s:(m||(m=d(e.map(r),i,t)))(r(l(I)))}return w.invert=function(I){return l(a((y||(y=d(i,e.map(r),DM.Z)))(I)))},w.domain=function(I){return arguments.length?(e=lv.call(I,nm),l===Xu||(l=G_(e)),C()):e.slice()},w.range=function(I){return arguments.length?(i=Wp.call(I),C()):i.slice()},w.rangeRound=function(I){return i=Wp.call(I),t=FM,C()},w.clamp=function(I){return arguments.length?(l=I?G_(e):Xu,w):l!==Xu},w.interpolate=function(I){return arguments.length?(t=I,C()):t},w.unknown=function(I){return arguments.length?(s=I,w):s},function(I,L){return r=I,a=L,C()}}function H_(e,i){return am()(e,i)}var ZM=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function hv(e){if(!(i=ZM.exec(e)))throw new Error("invalid format: "+e);var i;return new om({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}hv.prototype=om.prototype;function om(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}om.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function UM(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function pv(e,i){if((t=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var t,r=e.slice(0,t);return[r.length>1?r[0]+r.slice(2):r,+e.slice(t+1)]}function Ad(e){return e=pv(Math.abs(e)),e?e[1]:NaN}function jM(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ad(i)/3)))*3-Ad(Math.abs(e)))}function VM(e,i){return function(t,r){for(var a=t.length,s=[],l=0,d=e[0],m=0;a>0&&d>0&&(m+d+1>r&&(d=Math.max(1,r-m)),s.push(t.substring(a-=d,a+d)),!((m+=d+1)>r));)d=e[l=(l+1)%e.length];return s.reverse().join(i)}}function GM(e){return function(i){return i.replace(/[0-9]/g,function(t){return e[+t]})}}function HM(e){e:for(var i=e.length,t=1,r=-1,a;t<i;++t)switch(e[t]){case".":r=a=t;break;case"0":r===0&&(r=t),a=t;break;default:if(!+e[t])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(a+1):e}var W_;function WM(e,i){var t=pv(e,i);if(!t)return e+"";var r=t[0],a=t[1],s=a-(W_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,l=r.length;return s===l?r:s>l?r+new Array(s-l+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+pv(e,Math.max(0,i+s-1))[0]}function X_(e,i){var t=pv(e,i);if(!t)return e+"";var r=t[0],a=t[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}var Y_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:UM,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return X_(e*100,i)},r:X_,s:WM,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function q_(e){return e}var K_=Array.prototype.map,$_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function XM(e){var i=e.grouping===void 0||e.thousands===void 0?q_:VM(K_.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?q_:GM(K_.call(e.numerals,String)),l=e.percent===void 0?"%":e.percent+"",d=e.minus===void 0?"-":e.minus+"",m=e.nan===void 0?"NaN":e.nan+"";function y(w){w=hv(w);var I=w.fill,L=w.align,U=w.sign,K=w.symbol,ae=w.zero,Ae=w.width,Ge=w.comma,ot=w.precision,St=w.trim,zt=w.type;zt==="n"?(Ge=!0,zt="g"):Y_[zt]||(ot===void 0&&(ot=12),St=!0,zt="g"),(ae||I==="0"&&L==="=")&&(ae=!0,I="0",L="=");var Ot=K==="$"?t:K==="#"&&/[boxX]/.test(zt)?"0"+zt.toLowerCase():"",er=K==="$"?r:/[%p]/.test(zt)?l:"",_r=Y_[zt],kr=/[defgprs%]/.test(zt);ot=ot===void 0?6:/[gprs]/.test(zt)?Math.max(1,Math.min(21,ot)):Math.max(0,Math.min(20,ot));function Kr(Pr){var ln=Ot,kn=er,Hn,xa,Ua;if(zt==="c")kn=_r(Pr)+kn,Pr="";else{Pr=+Pr;var Io=Pr<0||1/Pr<0;if(Pr=isNaN(Pr)?m:_r(Math.abs(Pr),ot),St&&(Pr=HM(Pr)),Io&&+Pr==0&&U!=="+"&&(Io=!1),ln=(Io?U==="("?U:d:U==="-"||U==="("?"":U)+ln,kn=(zt==="s"?$_[8+W_/3]:"")+kn+(Io&&U==="("?")":""),kr){for(Hn=-1,xa=Pr.length;++Hn<xa;)if(Ua=Pr.charCodeAt(Hn),48>Ua||Ua>57){kn=(Ua===46?a+Pr.slice(Hn+1):Pr.slice(Hn))+kn,Pr=Pr.slice(0,Hn);break}}}Ge&&!ae&&(Pr=i(Pr,Infinity));var Ds=ln.length+Pr.length+kn.length,Fs=Ds<Ae?new Array(Ae-Ds+1).join(I):"";switch(Ge&&ae&&(Pr=i(Fs+Pr,Fs.length?Ae-kn.length:Infinity),Fs=""),L){case"<":Pr=ln+Pr+kn+Fs;break;case"=":Pr=ln+Fs+Pr+kn;break;case"^":Pr=Fs.slice(0,Ds=Fs.length>>1)+ln+Pr+kn+Fs.slice(Ds);break;default:Pr=Fs+ln+Pr+kn;break}return s(Pr)}return Kr.toString=function(){return w+""},Kr}function C(w,I){var L=y((w=hv(w),w.type="f",w)),U=Math.max(-8,Math.min(8,Math.floor(Ad(I)/3)))*3,K=Math.pow(10,-U),ae=$_[8+U/3];return function(Ae){return L(K*Ae)+ae}}return{format:y,formatPrefix:C}}var dv,sm,Q_;YM({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function YM(e){return dv=XM(e),sm=dv.format,Q_=dv.formatPrefix,dv}function qM(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,Ad(i)-Ad(e))+1}function KM(e){return Math.max(0,-Ad(Math.abs(e)))}function $M(e,i,t,r){var a=tm(e,i,t),s;switch(r=hv(r==null?",f":r),r.type){case"s":{var l=Math.max(Math.abs(e),Math.abs(i));return r.precision==null&&!isNaN(s=jM(a,l))&&(r.precision=s),Q_(r,l)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=qM(a,Math.max(Math.abs(e),Math.abs(i))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=KM(a))&&(r.precision=s-(r.type==="%")*2);break}}return sm(r)}function wd(e){var i=e.domain;return e.ticks=function(t){var r=i();return k_(r[0],r[r.length-1],t==null?10:t)},e.tickFormat=function(t,r){var a=i();return $M(a[0],a[a.length-1],t==null?10:t,r)},e.nice=function(t){t==null&&(t=10);var r=i(),a=0,s=r.length-1,l=r[a],d=r[s],m;return d<l&&(m=l,l=d,d=m,m=a,a=s,s=m),m=ov(l,d,t),m>0?(l=Math.floor(l/m)*m,d=Math.ceil(d/m)*m,m=ov(l,d,t)):m<0&&(l=Math.ceil(l*m)/m,d=Math.floor(d*m)/m,m=ov(l,d,t)),m>0?(r[a]=Math.floor(l/m)*m,r[s]=Math.ceil(d/m)*m,i(r)):m<0&&(r[a]=Math.ceil(l*m)/m,r[s]=Math.floor(d*m)/m,i(r)),e},e}function J_(){var e=H_(Xu,Xu);return e.copy=function(){return fv(e,J_())},op.apply(e,arguments),wd(e)}function e1(e){var i;function t(r){return isNaN(r=+r)?i:r}return t.invert=t,t.domain=t.range=function(r){return arguments.length?(e=lv.call(r,nm),t):e.slice()},t.unknown=function(r){return arguments.length?(i=r,t):i},t.copy=function(){return e1(e).unknown(i)},e=arguments.length?lv.call(e,nm):[0,1],wd(t)}function t1(e,i){e=e.slice();var t=0,r=e.length-1,a=e[t],s=e[r],l;return s<a&&(l=t,t=r,r=l,l=a,a=s,s=l),e[t]=i.floor(a),e[r]=i.ceil(s),e}function r1(e){return Math.log(e)}function n1(e){return Math.exp(e)}function QM(e){return-Math.log(-e)}function JM(e){return-Math.exp(-e)}function e5(e){return isFinite(e)?+("1e"+e):e<0?0:e}function t5(e){return e===10?e5:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function r5(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function i1(e){return function(i){return-e(-i)}}function n5(e){var i=e(r1,n1),t=i.domain,r=10,a,s;function l(){return a=r5(r),s=t5(r),t()[0]<0?(a=i1(a),s=i1(s),e(QM,JM)):e(r1,n1),i}return i.base=function(d){return arguments.length?(r=+d,l()):r},i.domain=function(d){return arguments.length?(t(d),l()):t()},i.ticks=function(d){var m=t(),y=m[0],C=m[m.length-1],w;(w=C<y)&&(I=y,y=C,C=I);var I=a(y),L=a(C),U,K,ae,Ae=d==null?10:+d,Ge=[];if(!(r%1)&&L-I<Ae){if(I=Math.round(I)-1,L=Math.round(L)+1,y>0){for(;I<L;++I)for(K=1,U=s(I);K<r;++K)if(ae=U*K,!(ae<y)){if(ae>C)break;Ge.push(ae)}}else for(;I<L;++I)for(K=r-1,U=s(I);K>=1;--K)if(ae=U*K,!(ae<y)){if(ae>C)break;Ge.push(ae)}}else Ge=k_(I,L,Math.min(L-I,Ae)).map(s);return w?Ge.reverse():Ge},i.tickFormat=function(d,m){if(m==null&&(m=r===10?".0e":","),typeof m!="function"&&(m=sm(m)),d===Infinity)return m;d==null&&(d=10);var y=Math.max(1,r*d/i.ticks().length);return function(C){var w=C/s(Math.round(a(C)));return w*r<r-.5&&(w*=r),w<=y?m(C):""}},i.nice=function(){return t(t1(t(),{floor:function(d){return s(Math.floor(a(d)))},ceil:function(d){return s(Math.ceil(a(d)))}}))},i}function a1(){var e=n5(am()).domain([1,10]);return e.copy=function(){return fv(e,a1()).base(e.base())},op.apply(e,arguments),e}function o1(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function s1(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function i5(e){var i=1,t=e(o1(i),s1(i));return t.constant=function(r){return arguments.length?e(o1(i=+r),s1(i)):i},linearish(t)}function a5(){var e=i5(transformer());return e.copy=function(){return copy(e,a5()).constant(e.constant())},initRange.apply(e,arguments)}function u1(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function o5(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function s5(e){return e<0?-e*e:e*e}function u5(e){var i=e(Xu,Xu),t=1;function r(){return t===1?e(Xu,Xu):t===.5?e(o5,s5):e(u1(t),u1(1/t))}return i.exponent=function(a){return arguments.length?(t=+a,r()):t},wd(i)}function um(){var e=u5(am());return e.copy=function(){return fv(e,um()).exponent(e.exponent())},op.apply(e,arguments),e}function YO(){return um.apply(null,arguments).exponent(.5)}function l1(){var e=[],i=[],t=[],r;function a(){var l=0,d=Math.max(1,i.length);for(t=new Array(d-1);++l<d;)t[l-1]=PM(e,l/d);return s}function s(l){return isNaN(l=+l)?r:i[av(t,l)]}return s.invertExtent=function(l){var d=i.indexOf(l);return d<0?[NaN,NaN]:[d>0?t[d-1]:e[0],d<t.length?t[d]:e[e.length-1]]},s.domain=function(l){if(!arguments.length)return e.slice();e=[];for(var d=0,m=l.length,y;d<m;++d)y=l[d],y!=null&&!isNaN(y=+y)&&e.push(y);return e.sort($v),a()},s.range=function(l){return arguments.length?(i=Wp.call(l),a()):i.slice()},s.unknown=function(l){return arguments.length?(r=l,s):r},s.quantiles=function(){return t.slice()},s.copy=function(){return l1().domain(e).range(i).unknown(r)},op.apply(s,arguments)}function c1(){var e=0,i=1,t=1,r=[.5],a=[0,1],s;function l(m){return m<=m?a[av(r,m,0,t)]:s}function d(){var m=-1;for(r=new Array(t);++m<t;)r[m]=((m+1)*i-(m-t)*e)/(t+1);return l}return l.domain=function(m){return arguments.length?(e=+m[0],i=+m[1],d()):[e,i]},l.range=function(m){return arguments.length?(t=(a=Wp.call(m)).length-1,d()):a.slice()},l.invertExtent=function(m){var y=a.indexOf(m);return y<0?[NaN,NaN]:y<1?[e,r[0]]:y>=t?[r[t-1],i]:[r[y-1],r[y]]},l.unknown=function(m){return arguments.length&&(s=m),l},l.thresholds=function(){return r.slice()},l.copy=function(){return c1().domain([e,i]).range(a).unknown(s)},op.apply(wd(l),arguments)}function f1(){var e=[.5],i=[0,1],t,r=1;function a(s){return s<=s?i[av(e,s,0,r)]:t}return a.domain=function(s){return arguments.length?(e=Wp.call(s),r=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Wp.call(s),r=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var l=i.indexOf(s);return[e[l-1],e[l]]},a.unknown=function(s){return arguments.length?(t=s,a):t},a.copy=function(){return f1().domain(e).range(i).unknown(t)},op.apply(a,arguments)}var lm=new Date,cm=new Date;function sl(e,i,t,r){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var l=a(s),d=a.ceil(s);return s-l<d-s?l:d},a.offset=function(s,l){return i(s=new Date(+s),l==null?1:Math.floor(l)),s},a.range=function(s,l,d){var m=[],y;if(s=a.ceil(s),d=d==null?1:Math.floor(d),!(s<l)||!(d>0))return m;do m.push(y=new Date(+s)),i(s,d),e(s);while(y<s&&s<l);return m},a.filter=function(s){return sl(function(l){if(l>=l)for(;e(l),!s(l);)l.setTime(l-1)},function(l,d){if(l>=l)if(d<0)for(;++d<=0;)for(;i(l,-1),!s(l););else for(;--d>=0;)for(;i(l,1),!s(l););})},t&&(a.count=function(s,l){return lm.setTime(+s),cm.setTime(+l),e(lm),e(cm),Math.floor(t(lm,cm))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(r?function(l){return r(l)%s==0}:function(l){return a.count(0,l)%s==0}):a}),a}var fm=sl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});fm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:sl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,t){i.setFullYear(i.getFullYear()+t*e)})};var Td=fm,qO=fm.range,h1=sl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),l5=h1,KO=h1.range,vv=1e3,p0=6e4,p1=36e5,d1=864e5,v1=6048e5;function Xp(e){return sl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,t){i.setDate(i.getDate()+t*7)},function(i,t){return(t-i-(t.getTimezoneOffset()-i.getTimezoneOffset())*p0)/v1})}var hm=Xp(0),mv=Xp(1),c5=Xp(2),f5=Xp(3),Md=Xp(4),h5=Xp(5),p5=Xp(6),$O=hm.range,QO=mv.range,JO=c5.range,eI=f5.range,tI=Md.range,rI=h5.range,nI=p5.range,m1=sl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*p0)/d1},function(e){return e.getDate()-1}),pm=m1,iI=m1.range,g1=sl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*vv-e.getMinutes()*p0)},function(e,i){e.setTime(+e+i*p1)},function(e,i){return(i-e)/p1},function(e){return e.getHours()}),d5=g1,aI=g1.range,y1=sl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*vv)},function(e,i){e.setTime(+e+i*p0)},function(e,i){return(i-e)/p0},function(e){return e.getMinutes()}),v5=y1,oI=y1.range,_1=sl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*vv)},function(e,i){return(i-e)/vv},function(e){return e.getUTCSeconds()}),m5=_1,sI=_1.range,gv=sl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});gv.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?sl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,t){i.setTime(+i+t*e)},function(i,t){return(t-i)/e}):gv};var g5=gv,uI=gv.range;function Yp(e){return sl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,t){i.setUTCDate(i.getUTCDate()+t*7)},function(i,t){return(t-i)/v1})}var x1=Yp(0),yv=Yp(1),y5=Yp(2),_5=Yp(3),Pd=Yp(4),x5=Yp(5),b5=Yp(6),lI=x1.range,cI=yv.range,fI=y5.range,hI=_5.range,pI=Pd.range,dI=x5.range,vI=b5.range,b1=sl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/d1},function(e){return e.getUTCDate()-1}),E1=b1,mI=b1.range,dm=sl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});dm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:sl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,t){i.setUTCFullYear(i.getUTCFullYear()+t*e)})};var d0=dm,gI=dm.range;function vm(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function mm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function v0(e,i,t){return{y:e,m:i,d:t,H:0,M:0,S:0,L:0}}function E5(e){var i=e.dateTime,t=e.date,r=e.time,a=e.periods,s=e.days,l=e.shortDays,d=e.months,m=e.shortMonths,y=m0(a),C=g0(a),w=m0(s),I=g0(s),L=m0(l),U=g0(l),K=m0(d),ae=g0(d),Ae=m0(m),Ge=g0(m),ot={a:Io,A:Ds,b:Fs,B:Lc,c:null,d:M1,e:M1,f:H5,g:t3,G:n3,H:j5,I:V5,j:G5,L:P1,m:W5,M:X5,p:Tm,q:Lv,Q:D1,s:F1,S:Y5,u:q5,U:K5,V:$5,w:Q5,W:J5,x:null,X:null,y:e3,Y:r3,Z:i3,"%":k1},St={a:oO,A:sO,b:uO,B:lO,c:null,d:I1,e:I1,f:u3,g:y3,G:x3,H:a3,I:o3,j:s3,L:R1,m:l3,M:c3,p:cO,q:fO,Q:D1,s:F1,S:f3,u:h3,U:p3,V:d3,w:v3,W:m3,x:null,X:null,y:g3,Y:_3,Z:b3,"%":k1},zt={a:Kr,A:Pr,b:ln,B:kn,c:Hn,d:w1,e:w1,f:N5,g:A1,G:C1,H:T1,I:T1,j:k5,L:B5,m:L5,M:D5,p:kr,q:R5,Q:Z5,s:U5,S:F5,u:T5,U:M5,V:P5,w:w5,W:O5,x:xa,X:Ua,y:A1,Y:C1,Z:I5,"%":z5};ot.x=Ot(t,ot),ot.X=Ot(r,ot),ot.c=Ot(i,ot),St.x=Ot(t,St),St.X=Ot(r,St),St.c=Ot(i,St);function Ot(xi,Da){return function(ro){var Dn=[],Pl=-1,jo=0,Ql=xi.length,Jl,$p,Fb;for(ro instanceof Date||(ro=new Date(+ro));++Pl<Ql;)xi.charCodeAt(Pl)===37&&(Dn.push(xi.slice(jo,Pl)),($p=S1[Jl=xi.charAt(++Pl)])!=null?Jl=xi.charAt(++Pl):$p=Jl==="e"?" ":"0",(Fb=Da[Jl])&&(Jl=Fb(ro,$p)),Dn.push(Jl),jo=Pl+1);return Dn.push(xi.slice(jo,Pl)),Dn.join("")}}function er(xi,Da){return function(ro){var Dn=v0(1900,void 0,1),Pl=_r(Dn,xi,ro+="",0),jo,Ql;if(Pl!=ro.length)return null;if("Q"in Dn)return new Date(Dn.Q);if("s"in Dn)return new Date(Dn.s*1e3+("L"in Dn?Dn.L:0));if(Da&&!("Z"in Dn)&&(Dn.Z=0),"p"in Dn&&(Dn.H=Dn.H%12+Dn.p*12),Dn.m===void 0&&(Dn.m="q"in Dn?Dn.q:0),"V"in Dn){if(Dn.V<1||Dn.V>53)return null;"w"in Dn||(Dn.w=1),"Z"in Dn?(jo=mm(v0(Dn.y,0,1)),Ql=jo.getUTCDay(),jo=Ql>4||Ql===0?yv.ceil(jo):yv(jo),jo=E1.offset(jo,(Dn.V-1)*7),Dn.y=jo.getUTCFullYear(),Dn.m=jo.getUTCMonth(),Dn.d=jo.getUTCDate()+(Dn.w+6)%7):(jo=vm(v0(Dn.y,0,1)),Ql=jo.getDay(),jo=Ql>4||Ql===0?mv.ceil(jo):mv(jo),jo=pm.offset(jo,(Dn.V-1)*7),Dn.y=jo.getFullYear(),Dn.m=jo.getMonth(),Dn.d=jo.getDate()+(Dn.w+6)%7)}else("W"in Dn||"U"in Dn)&&("w"in Dn||(Dn.w="u"in Dn?Dn.u%7:"W"in Dn?1:0),Ql="Z"in Dn?mm(v0(Dn.y,0,1)).getUTCDay():vm(v0(Dn.y,0,1)).getDay(),Dn.m=0,Dn.d="W"in Dn?(Dn.w+6)%7+Dn.W*7-(Ql+5)%7:Dn.w+Dn.U*7-(Ql+6)%7);return"Z"in Dn?(Dn.H+=Dn.Z/100|0,Dn.M+=Dn.Z%100,mm(Dn)):vm(Dn)}}function _r(xi,Da,ro,Dn){for(var Pl=0,jo=Da.length,Ql=ro.length,Jl,$p;Pl<jo;){if(Dn>=Ql)return-1;if(Jl=Da.charCodeAt(Pl++),Jl===37){if(Jl=Da.charAt(Pl++),$p=zt[Jl in S1?Da.charAt(Pl++):Jl],!$p||(Dn=$p(xi,ro,Dn))<0)return-1}else if(Jl!=ro.charCodeAt(Dn++))return-1}return Dn}function kr(xi,Da,ro){var Dn=y.exec(Da.slice(ro));return Dn?(xi.p=C[Dn[0].toLowerCase()],ro+Dn[0].length):-1}function Kr(xi,Da,ro){var Dn=L.exec(Da.slice(ro));return Dn?(xi.w=U[Dn[0].toLowerCase()],ro+Dn[0].length):-1}function Pr(xi,Da,ro){var Dn=w.exec(Da.slice(ro));return Dn?(xi.w=I[Dn[0].toLowerCase()],ro+Dn[0].length):-1}function ln(xi,Da,ro){var Dn=Ae.exec(Da.slice(ro));return Dn?(xi.m=Ge[Dn[0].toLowerCase()],ro+Dn[0].length):-1}function kn(xi,Da,ro){var Dn=K.exec(Da.slice(ro));return Dn?(xi.m=ae[Dn[0].toLowerCase()],ro+Dn[0].length):-1}function Hn(xi,Da,ro){return _r(xi,i,Da,ro)}function xa(xi,Da,ro){return _r(xi,t,Da,ro)}function Ua(xi,Da,ro){return _r(xi,r,Da,ro)}function Io(xi){return l[xi.getDay()]}function Ds(xi){return s[xi.getDay()]}function Fs(xi){return m[xi.getMonth()]}function Lc(xi){return d[xi.getMonth()]}function Tm(xi){return a[+(xi.getHours()>=12)]}function Lv(xi){return 1+~~(xi.getMonth()/3)}function oO(xi){return l[xi.getUTCDay()]}function sO(xi){return s[xi.getUTCDay()]}function uO(xi){return m[xi.getUTCMonth()]}function lO(xi){return d[xi.getUTCMonth()]}function cO(xi){return a[+(xi.getUTCHours()>=12)]}function fO(xi){return 1+~~(xi.getUTCMonth()/3)}return{format:function(xi){var Da=Ot(xi+="",ot);return Da.toString=function(){return xi},Da},parse:function(xi){var Da=er(xi+="",!1);return Da.toString=function(){return xi},Da},utcFormat:function(xi){var Da=Ot(xi+="",St);return Da.toString=function(){return xi},Da},utcParse:function(xi){var Da=er(xi+="",!0);return Da.toString=function(){return xi},Da}}}var S1={"-":"",_:" ","0":"0"},xu=/^\s*\d+/,S5=/^%/,C5=/[\\^$*+?|[\]().{}]/g;function to(e,i,t){var r=e<0?"-":"",a=(r?-e:e)+"",s=a.length;return r+(s<t?new Array(t-s+1).join(i)+a:a)}function A5(e){return e.replace(C5,"\\$&")}function m0(e){return new RegExp("^(?:"+e.map(A5).join("|")+")","i")}function g0(e){for(var i={},t=-1,r=e.length;++t<r;)i[e[t].toLowerCase()]=t;return i}function w5(e,i,t){var r=xu.exec(i.slice(t,t+1));return r?(e.w=+r[0],t+r[0].length):-1}function T5(e,i,t){var r=xu.exec(i.slice(t,t+1));return r?(e.u=+r[0],t+r[0].length):-1}function M5(e,i,t){var r=xu.exec(i.slice(t,t+2));return r?(e.U=+r[0],t+r[0].length):-1}function P5(e,i,t){var r=xu.exec(i.slice(t,t+2));return r?(e.V=+r[0],t+r[0].length):-1}function O5(e,i,t){var r=xu.exec(i.slice(t,t+2));return r?(e.W=+r[0],t+r[0].length):-1}function C1(e,i,t){var r=xu.exec(i.slice(t,t+4));return r?(e.y=+r[0],t+r[0].length):-1}function A1(e,i,t){var r=xu.exec(i.slice(t,t+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),t+r[0].length):-1}function I5(e,i,t){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(t,t+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),t+r[0].length):-1}function R5(e,i,t){var r=xu.exec(i.slice(t,t+1));return r?(e.q=r[0]*3-3,t+r[0].length):-1}function L5(e,i,t){var r=xu.exec(i.slice(t,t+2));return r?(e.m=r[0]-1,t+r[0].length):-1}function w1(e,i,t){var r=xu.exec(i.slice(t,t+2));return r?(e.d=+r[0],t+r[0].length):-1}function k5(e,i,t){var r=xu.exec(i.slice(t,t+3));return r?(e.m=0,e.d=+r[0],t+r[0].length):-1}function T1(e,i,t){var r=xu.exec(i.slice(t,t+2));return r?(e.H=+r[0],t+r[0].length):-1}function D5(e,i,t){var r=xu.exec(i.slice(t,t+2));return r?(e.M=+r[0],t+r[0].length):-1}function F5(e,i,t){var r=xu.exec(i.slice(t,t+2));return r?(e.S=+r[0],t+r[0].length):-1}function B5(e,i,t){var r=xu.exec(i.slice(t,t+3));return r?(e.L=+r[0],t+r[0].length):-1}function N5(e,i,t){var r=xu.exec(i.slice(t,t+6));return r?(e.L=Math.floor(r[0]/1e3),t+r[0].length):-1}function z5(e,i,t){var r=S5.exec(i.slice(t,t+1));return r?t+r[0].length:-1}function Z5(e,i,t){var r=xu.exec(i.slice(t));return r?(e.Q=+r[0],t+r[0].length):-1}function U5(e,i,t){var r=xu.exec(i.slice(t));return r?(e.s=+r[0],t+r[0].length):-1}function M1(e,i){return to(e.getDate(),i,2)}function j5(e,i){return to(e.getHours(),i,2)}function V5(e,i){return to(e.getHours()%12||12,i,2)}function G5(e,i){return to(1+pm.count(Td(e),e),i,3)}function P1(e,i){return to(e.getMilliseconds(),i,3)}function H5(e,i){return P1(e,i)+"000"}function W5(e,i){return to(e.getMonth()+1,i,2)}function X5(e,i){return to(e.getMinutes(),i,2)}function Y5(e,i){return to(e.getSeconds(),i,2)}function q5(e){var i=e.getDay();return i===0?7:i}function K5(e,i){return to(hm.count(Td(e)-1,e),i,2)}function O1(e){var i=e.getDay();return i>=4||i===0?Md(e):Md.ceil(e)}function $5(e,i){return e=O1(e),to(Md.count(Td(e),e)+(Td(e).getDay()===4),i,2)}function Q5(e){return e.getDay()}function J5(e,i){return to(mv.count(Td(e)-1,e),i,2)}function e3(e,i){return to(e.getFullYear()%100,i,2)}function t3(e,i){return e=O1(e),to(e.getFullYear()%100,i,2)}function r3(e,i){return to(e.getFullYear()%1e4,i,4)}function n3(e,i){var t=e.getDay();return e=t>=4||t===0?Md(e):Md.ceil(e),to(e.getFullYear()%1e4,i,4)}function i3(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+to(i/60|0,"0",2)+to(i%60,"0",2)}function I1(e,i){return to(e.getUTCDate(),i,2)}function a3(e,i){return to(e.getUTCHours(),i,2)}function o3(e,i){return to(e.getUTCHours()%12||12,i,2)}function s3(e,i){return to(1+E1.count(d0(e),e),i,3)}function R1(e,i){return to(e.getUTCMilliseconds(),i,3)}function u3(e,i){return R1(e,i)+"000"}function l3(e,i){return to(e.getUTCMonth()+1,i,2)}function c3(e,i){return to(e.getUTCMinutes(),i,2)}function f3(e,i){return to(e.getUTCSeconds(),i,2)}function h3(e){var i=e.getUTCDay();return i===0?7:i}function p3(e,i){return to(x1.count(d0(e)-1,e),i,2)}function L1(e){var i=e.getUTCDay();return i>=4||i===0?Pd(e):Pd.ceil(e)}function d3(e,i){return e=L1(e),to(Pd.count(d0(e),e)+(d0(e).getUTCDay()===4),i,2)}function v3(e){return e.getUTCDay()}function m3(e,i){return to(yv.count(d0(e)-1,e),i,2)}function g3(e,i){return to(e.getUTCFullYear()%100,i,2)}function y3(e,i){return e=L1(e),to(e.getUTCFullYear()%100,i,2)}function _3(e,i){return to(e.getUTCFullYear()%1e4,i,4)}function x3(e,i){var t=e.getUTCDay();return e=t>=4||t===0?Pd(e):Pd.ceil(e),to(e.getUTCFullYear()%1e4,i,4)}function b3(){return"+0000"}function k1(){return"%"}function D1(e){return+e}function F1(e){return Math.floor(+e/1e3)}var Od,B1,E3,S3,C3;A3({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function A3(e){return Od=E5(e),B1=Od.format,E3=Od.parse,S3=Od.utcFormat,C3=Od.utcParse,Od}var y0=1e3,_0=y0*60,x0=_0*60,b0=x0*24,w3=b0*7,N1=b0*30,gm=b0*365;function T3(e){return new Date(e)}function M3(e){return e instanceof Date?+e:+new Date(+e)}function z1(e,i,t,r,a,s,l,d,m){var y=H_(Xu,Xu),C=y.invert,w=y.domain,I=m(".%L"),L=m(":%S"),U=m("%I:%M"),K=m("%I %p"),ae=m("%a %d"),Ae=m("%b %d"),Ge=m("%B"),ot=m("%Y"),St=[[l,1,y0],[l,5,5*y0],[l,15,15*y0],[l,30,30*y0],[s,1,_0],[s,5,5*_0],[s,15,15*_0],[s,30,30*_0],[a,1,x0],[a,3,3*x0],[a,6,6*x0],[a,12,12*x0],[r,1,b0],[r,2,2*b0],[t,1,w3],[i,1,N1],[i,3,3*N1],[e,1,gm]];function zt(er){return(l(er)<er?I:s(er)<er?L:a(er)<er?U:r(er)<er?K:i(er)<er?t(er)<er?ae:Ae:e(er)<er?Ge:ot)(er)}function Ot(er,_r,kr,Kr){if(er==null&&(er=10),typeof er=="number"){var Pr=Math.abs(kr-_r)/er,ln=O_(function(kn){return kn[2]}).right(St,Pr);ln===St.length?(Kr=tm(_r/gm,kr/gm,er),er=e):ln?(ln=St[Pr/St[ln-1][2]<St[ln][2]/Pr?ln-1:ln],Kr=ln[1],er=ln[0]):(Kr=Math.max(tm(_r,kr,er),1),er=d)}return Kr==null?er:er.every(Kr)}return y.invert=function(er){return new Date(C(er))},y.domain=function(er){return arguments.length?w(lv.call(er,M3)):w().map(T3)},y.ticks=function(er,_r){var kr=w(),Kr=kr[0],Pr=kr[kr.length-1],ln=Pr<Kr,kn;return ln&&(kn=Kr,Kr=Pr,Pr=kn),kn=Ot(er,Kr,Pr,_r),kn=kn?kn.range(Kr,Pr+1):[],ln?kn.reverse():kn},y.tickFormat=function(er,_r){return _r==null?zt:m(_r)},y.nice=function(er,_r){var kr=w();return(er=Ot(er,kr[0],kr[kr.length-1],_r))?w(t1(kr,er)):y},y.copy=function(){return fv(y,z1(e,i,t,r,a,s,l,d,m))},y}function P3(){return op.apply(z1(Td,l5,hm,pm,d5,v5,m5,g5,B1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function yI(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function _v(){var e=0,i=1,t,r,a,s,l=Xu,d=!1,m;function y(C){return isNaN(C=+C)?m:l(a===0?.5:(C=(s(C)-t)*a,d?Math.max(0,Math.min(1,C)):C))}return y.domain=function(C){return arguments.length?(t=s(e=+C[0]),r=s(i=+C[1]),a=t===r?0:1/(r-t),y):[e,i]},y.clamp=function(C){return arguments.length?(d=!!C,y):d},y.interpolator=function(C){return arguments.length?(l=C,y):l},y.unknown=function(C){return arguments.length?(m=C,y):m},function(C){return s=C,t=C(e),r=C(i),a=t===r?0:1/(r-t),y}}function E0(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Z1(){var e=wd(_v()(Xu));return e.copy=function(){return E0(e,Z1())},z_.apply(e,arguments)}function O3(){var e=loggish(_v()).domain([1,10]);return e.copy=function(){return E0(e,O3()).base(e.base())},initInterpolator.apply(e,arguments)}function I3(){var e=symlogish(_v());return e.copy=function(){return E0(e,I3()).constant(e.constant())},initInterpolator.apply(e,arguments)}function U1(){var e=powish(_v());return e.copy=function(){return E0(e,U1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function _I(){return U1.apply(null,arguments).exponent(.5)}function R3(){var e=[],i=identity;function t(r){if(!isNaN(r=+r))return i((bisect(e,r)-1)/(e.length-1))}return t.domain=function(r){if(!arguments.length)return e.slice();e=[];for(var a=0,s=r.length,l;a<s;++a)l=r[a],l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort(ascending),t},t.interpolator=function(r){return arguments.length?(i=r,t):i},t.copy=function(){return R3(i).domain(e)},initInterpolator.apply(t,arguments)}function xv(){var e=0,i=.5,t=1,r,a,s,l,d,m=Xu,y,C=!1,w;function I(L){return isNaN(L=+L)?w:(L=.5+((L=+y(L))-a)*(L<a?l:d),m(C?Math.max(0,Math.min(1,L)):L))}return I.domain=function(L){return arguments.length?(r=y(e=+L[0]),a=y(i=+L[1]),s=y(t=+L[2]),l=r===a?0:.5/(a-r),d=a===s?0:.5/(s-a),I):[e,i,t]},I.clamp=function(L){return arguments.length?(C=!!L,I):C},I.interpolator=function(L){return arguments.length?(m=L,I):m},I.unknown=function(L){return arguments.length?(w=L,I):w},function(L){return y=L,r=L(e),a=L(i),s=L(t),l=r===a?0:.5/(a-r),d=a===s?0:.5/(s-a),I}}function j1(){var e=wd(xv()(Xu));return e.copy=function(){return E0(e,j1())},z_.apply(e,arguments)}function L3(){var e=loggish(xv()).domain([.1,1,10]);return e.copy=function(){return copy(e,L3()).base(e.base())},initInterpolator.apply(e,arguments)}function k3(){var e=symlogish(xv());return e.copy=function(){return copy(e,k3()).constant(e.constant())},initInterpolator.apply(e,arguments)}function V1(){var e=powish(xv());return e.copy=function(){return copy(e,V1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function xI(){return V1.apply(null,arguments).exponent(.5)}var $l,G1,H1,W1,ym,X1;function Y1(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function q1(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Y1(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Y1(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var D3=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,F3=($l={},(0,b.Z)($l,eo.LINEAR,J_),(0,b.Z)($l,eo.POWER,um),(0,b.Z)($l,eo.LOG,a1),(0,b.Z)($l,eo.IDENTITY,e1),(0,b.Z)($l,eo.SEQUENTIAL,Z1),(0,b.Z)($l,eo.TIME,P3),(0,b.Z)($l,eo.QUANTILE,l1),(0,b.Z)($l,eo.QUANTIZE,c1),(0,b.Z)($l,eo.THRESHOLD,f1),(0,b.Z)($l,eo.CAT,cv),(0,b.Z)($l,eo.DIVERGING,j1),$l),B3=(G1=(0,wt.b2)(),H1=(0,wt.f3)(Ke.IGlobalConfigService),G1(W1=(ym=function(){function e(){(0,qt.Z)(this,e),Mt(this,"configService",X1,this),(0,b.Z)(this,"scaleCache",{}),(0,b.Z)(this,"scaleOptions",{})}return(0,Gt.Z)(e,[{key:"apply",value:function(t,r){var a=this,s=r.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=t.getScaleOptions();var l=s.getLayerStyleAttributes(),d=t.getSource().data.dataArray;d.length!==0&&a.caculateScalesForAttributes(l||[],d)}),t.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=t.getScaleOptions();var l=s.getLayerStyleAttributes(),d=t.getSource().data.dataArray;return a.caculateScalesForAttributes(l||[],d),t.layerModelNeedUpdate=!0,!0}),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){a.scaleOptions=t.getScaleOptions();var l=s.getLayerStyleAttributes();if(l){var d=t.getSource().data.dataArray;if(d.length===0)return;var m=l.filter(function(y){return y.needRescale});m.length&&a.caculateScalesForAttributes(m,d)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,r){var a=this;this.scaleCache={},t.forEach(function(s){if(s.scale){var l=s.scale,d=s.name;l.names=a.parseFields(s.scale.field||[]);var m=[];l.names.forEach(function(y){var C;m.push(a.createScale(y,s.name,(C=s.scale)===null||C===void 0?void 0:C.values,r))}),m.some(function(y){return y.type===ep.VARIABLE})?(l.type=ep.VARIABLE,m.forEach(function(y){var C;if(!l.callback&&l.values!=="text")switch((C=y.option)===null||C===void 0?void 0:C.type){case eo.LOG:case eo.LINEAR:case eo.POWER:if(l.values&&l.values.length>2){var w=y.scale.ticks(l.values.length);y.scale.domain(w)}l.values?y.scale.range(l.values):y.scale.range(y.option.domain);break;case eo.QUANTILE:case eo.QUANTIZE:case eo.THRESHOLD:y.scale.range(l.values);break;case eo.CAT:l.values?y.scale.range(l.values):y.scale.range(y.option.domain);break;case eo.DIVERGING:case eo.SEQUENTIAL:y.scale.interpolator(OM.interpolateRgbBasis(l.values));break}if(l.values==="text"){var I;y.scale.range((I=y.option)===null||I===void 0?void 0:I.domain)}})):(l.type=ep.CONSTANT,l.defaultValues=m.map(function(y,C){return y.scale(l.names[C])})),l.scalers=m.map(function(y){return{field:y.field,func:y.scale,option:y.option}}),s.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:gu()(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,r,a,s){var l,d,m=this.scaleOptions[r]&&((l=this.scaleOptions[r])===null||l===void 0?void 0:l.field)===t?this.scaleOptions[r]:this.scaleOptions[t],y={field:t,scale:void 0,type:ep.VARIABLE,option:m};if(!s||!s.length)return m&&m.type?y.scale=this.createDefaultScale(m):(y.scale=cv([t]),y.type=ep.CONSTANT),y;var C=(d=s.find(function(L){return!Ml()(L[t])}))===null||d===void 0?void 0:d[t];if(this.isNumber(t)||Ml()(C)&&!m)y.scale=cv([t]),y.type=ep.CONSTANT;else{var w=m&&m.type||this.getDefaultType(C);a==="text"&&(w=eo.CAT);var I=this.createScaleConfig(w,t,m,s);y.scale=this.createDefaultScale(I),y.option=I}return y}},{key:"getDefaultType",value:function(t){var r=eo.LINEAR;return typeof t=="string"&&(r=D3.test(t)?eo.TIME:eo.CAT),r}},{key:"createScaleConfig",value:function(t,r,a,s){var l={type:t},d=(s==null?void 0:s.map(function(C){return C[r]}))||[];if(a!=null&&a.domain)l.domain=a==null?void 0:a.domain;else if(t!==eo.CAT&&t!==eo.QUANTILE&&t!==eo.DIVERGING)l.domain=R_(d);else if(t===eo.CAT)l.domain=km()(d);else if(t===eo.QUANTILE)l.domain=d;else if(t===eo.DIVERGING){var m=R_(d),y=(a==null?void 0:a.neutral)!==void 0?a==null?void 0:a.neutral:(m[0]+m[1])/2;l.domain=[m[0],y,m[1]]}return q1(q1({},l),a)}},{key:"createDefaultScale",value:function(t){var r=t.type,a=t.domain,s=t.unknown,l=t.clamp,d=t.nice,m=F3[r]();return a&&m.domain&&m.domain(a),s&&m.unknown(s),l!==void 0&&m.clamp&&m.clamp(l),d!==void 0&&m.nice&&m.nice(d),m}}]),e}(),X1=Pt(ym.prototype,"configService",[H1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ym))||W1),K1,$1,Q1,J1,bv,ex,tx;function rx(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function N3(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?rx(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):rx(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var z3=(K1=(0,wt.b2)(),$1=(0,wt.f3)(Ke.ICameraService),Q1=(0,wt.f3)(Ke.IRendererService),K1(J1=(bv=function(){function e(){(0,qt.Z)(this,e),Mt(this,"cameraService",ex,this),Mt(this,"rendererService",tx,this)}return(0,Gt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){t.models.forEach(function(r){r.addUniforms(N3({},t.layerModel.getAnimateUniforms()))})})}}]),e}(),ex=Pt(bv.prototype,"cameraService",[$1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tx=Pt(bv.prototype,"rendererService",[Q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bv))||J1),nx,ix,Z3=(nx=(0,wt.b2)(),nx(ix=function(){function e(){(0,qt.Z)(this,e)}return(0,Gt.Z)(e,[{key:"apply",value:function(t){t.hooks.init.tap("LayerModelPlugin",function(){t.prepareBuildModel(),t.buildModels(),t.styleNeedUpdate=!1}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return t.prepareBuildModel(),t.clearModels(),t.buildModels(),t.layerModelNeedUpdate=!1,!1})}}]),e}())||ix),ax,ox,U3=(ax=(0,wt.b2)(),ax(ox=function(){function e(){(0,qt.Z)(this,e)}return(0,Gt.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){t.updateLayerConfig({});var r=t.getLayerConfig(),a=r.autoFit,s=r.fitBoundsOptions;a&&setTimeout(function(){t.fitBounds(s)},100)})}}]),e}())||ox),sx,ux,j3=["type"];function lx(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function S0(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?lx(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):lx(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var cx={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},V3={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},G3={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},H3={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},bI=null;function W3(e){var i={u_DirectionalLights:new Array(3).fill(S0({},G3)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(S0({},H3)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[V3]),e.forEach(function(t,r){var a=t.type,s=a===void 0?"directional":a,l=(0,Eh.Z)(t,j3),d=cx[s].lights,m=cx[s].num,y=i[m];i[d][y]=S0(S0({},i[d][y]),l),i[m]++}),i}var X3=(sx=(0,wt.b2)(),sx(ux=function(){function e(){(0,qt.Z)(this,e)}return(0,Gt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var r=t.getLayerConfig(),a=r.enableLighting;a&&t.models.forEach(function(s){return s.addUniforms(S0({},W3()))})})}}]),e}())||ux),fx,hx,px,_m,dx,Y3=(fx=(0,wt.b2)(),hx=(0,wt.f3)(Ke.IGlobalConfigService),fx(px=(_m=function(){function e(){(0,qt.Z)(this,e),Mt(this,"configService",dx,this),(0,b.Z)(this,"enabled",void 0)}return(0,Gt.Z)(e,[{key:"apply",value:function(t,r){var a=this,s=r.rendererService,l=r.postProcessingPassFactory,d=r.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",function(){var m=t.getLayerConfig(),y=m.enableMultiPassRenderer,C=m.passes,w=C===void 0?[]:C;a.enabled=!!y&&t.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(t.multiPassRenderer=cy(t,w,l,d),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var m=s.getViewportSize(),y=m.width,C=m.height;t.multiPassRenderer.resize(y,C)}})}}]),e}(),dx=Pt(_m.prototype,"configService",[hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_m))||px),vx,mx,Ev={NONE:0,ENCODE:1,HIGHLIGHT:2},q3=(vx=(0,wt.b2)(),vx(mx=function(){function e(){(0,qt.Z)(this,e)}return(0,Gt.Z)(e,[{key:"apply",value:function(t,r){var a=r.rendererService,s=r.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",function(){var l=!0;s.registerStyleAttribute({name:"pickingColor",type:Ln.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:W.FLOAT},size:3,update:function(m,y){var C=m.id;return l?Ee(C):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var l=t.getLayerConfig(),d=l.enablePicking;d&&t.isVisible()&&t.models.forEach(function(m){return m.addUniforms({u_PickingStage:Ev.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var l=t.getLayerConfig(),d=l.enablePicking;d&&t.isVisible()&&t.models.forEach(function(m){return m.addUniforms({u_PickingStage:Ev.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(l){var d=t.getLayerConfig(),m=d.highlightColor,y=d.activeMix,C=y===void 0?0:y,w=typeof m=="string"?Q(m):m||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:ge(new Uint8Array(l))}),t.models.forEach(function(I){return I.addUniforms({u_PickingStage:Ev.HIGHLIGHT,u_PickingColor:l,u_HighlightColor:w.map(function(L){return L*255}),u_activeMix:C})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(l){var d=t.getLayerConfig(),m=d.selectColor,y=d.selectMix,C=y===void 0?0:y,w=typeof m=="string"?Q(m):m||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:ge(new Uint8Array(l))}),t.models.forEach(function(I){return I.addUniforms({u_PickingStage:Ev.HIGHLIGHT,u_PickingColor:l,u_HighlightColor:w.map(function(L){return L*255}),u_activeMix:C,u_CurrentSelectedId:l,u_SelectColor:w.map(function(L){return L*255}),u_EnableSelect:1})})})}}]),e}())||mx),gx,yx,K3=(gx=(0,wt.b2)(),gx(yx=function(){function e(){(0,qt.Z)(this,e)}return(0,Gt.Z)(e,[{key:"apply",value:function(t,r){var a=this,s=r.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:Ln.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:W.FLOAT},size:3,update:function(a,s,l){return l.length===2?[l[0],l[1],0]:[l[0],l[1],l[2]]}}}),t.registerStyleAttribute({name:"filter",type:Ln.Attribute,descriptor:{name:"filter",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a,s){var l=a.filter;return l?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:Ln.Attribute,descriptor:{name:"a_Color",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:4,update:function(a,s){var l=a.color;return!l||!l.length?[1,1,1,1]:l}}}),t.registerStyleAttribute({name:"vertexId",type:Ln.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:W.DYNAMIC_DRAW,data:[],type:W.FLOAT},size:1,update:function(a,s,l,d){return[s]}}})}}]),e}())||yx),_x,xx,bx,Ex,Sx,Cx,Id,Ax,Tx,Mx,Px,$3=(_x=(0,wt.b2)(),xx=(0,wt.f3)(Ke.ICameraService),bx=(0,wt.f3)(Ke.ICoordinateSystemService),Ex=(0,wt.f3)(Ke.IRendererService),Sx=(0,wt.f3)(Ke.IMapService),_x(Cx=(Id=function(){function e(){(0,qt.Z)(this,e),Mt(this,"cameraService",Ax,this),Mt(this,"coordinateSystemService",Tx,this),Mt(this,"rendererService",Mx,this),Mt(this,"mapService",Px,this)}return(0,Gt.Z)(e,[{key:"apply",value:function(t){var r=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var d=t.getLayerConfig().tileOrigin;if(r.coordinateSystemService.refresh(d),a==="GAODE2.x"){var m=r.getLayerCenter(t);r.mapService.map.customCoords.setCenter(m),r.mapService.setCustomCoordCenter(m),s=r.mapService.map.customCoords.getMVPMatrix(),l=r.mapService.getCustomCoordCenter()}var y=r.rendererService.getViewportSize(),C=y.width,w=y.height;t.models.forEach(function(I){var L;I.addUniforms((L={},(0,b.Z)(L,Zp.ProjectionMatrix,r.cameraService.getProjectionMatrix()),(0,b.Z)(L,Zp.ViewMatrix,r.cameraService.getViewMatrix()),(0,b.Z)(L,Zp.ViewProjectionMatrix,r.cameraService.getViewProjectionMatrix()),(0,b.Z)(L,Zp.Zoom,r.cameraService.getZoom()),(0,b.Z)(L,Zp.ZoomScale,r.cameraService.getZoomScale()),(0,b.Z)(L,Zp.FocalDistance,r.cameraService.getFocalDistance()),(0,b.Z)(L,Zp.CameraPosition,r.cameraService.getCameraPosition()),(0,b.Z)(L,Ou.CoordinateSystem,r.coordinateSystemService.getCoordinateSystem()),(0,b.Z)(L,Ou.ViewportCenter,r.coordinateSystemService.getViewportCenter()),(0,b.Z)(L,Ou.ViewportCenterProjection,r.coordinateSystemService.getViewportCenterProjection()),(0,b.Z)(L,Ou.PixelsPerDegree,r.coordinateSystemService.getPixelsPerDegree()),(0,b.Z)(L,Ou.PixelsPerDegree2,r.coordinateSystemService.getPixelsPerDegree2()),(0,b.Z)(L,Ou.PixelsPerMeter,r.coordinateSystemService.getPixelsPerMeter()),(0,b.Z)(L,Ou.Mvp,s),(0,b.Z)(L,"u_SceneCenterMKT",l),(0,b.Z)(L,"u_ViewportSize",[C,w]),(0,b.Z)(L,"u_ModelMatrix",r.cameraService.getModelMatrix()),(0,b.Z)(L,"u_DevicePixelRatio",Gi.devicePixelRatio),(0,b.Z)(L,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,b.Z)(L,"u_shaderPick",Number(t.getShaderPickStat())),L))})})}},{key:"getLayerCenter",value:function(t){var r=t.getSource();return r.center}}]),e}(),Ax=Pt(Id.prototype,"cameraService",[xx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tx=Pt(Id.prototype,"coordinateSystemService",[bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mx=Pt(Id.prototype,"rendererService",[Ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Px=Pt(Id.prototype,"mapService",[Sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Id))||Cx),Ox,Ix,Q3=(Ox=(0,wt.b2)(),Ox(Ix=function(){function e(){(0,qt.Z)(this,e)}return(0,Gt.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate()})}}]),e}())||Ix),Rx,Lx,J3=(Rx=(0,wt.b2)(),Rx(Lx=function(){function e(){(0,qt.Z)(this,e)}return(0,Gt.Z)(e,[{key:"apply",value:function(t,r){var a=this,s=r.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(t,{styleAttributeService:s})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||a.updateStyleAtrribute(t,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(t,r){var a=r.styleAttributeService,s=a.getLayerStyleAttributes()||[],l=a.getLayerStyleAttribute("filter"),d=a.getLayerStyleAttribute("shape");if(l&&l.needRegenerateVertices){t.layerModelNeedUpdate=!0,s.forEach(function(m){return m.needRegenerateVertices=!1});return}s.filter(function(m){return m.needRegenerateVertices}).forEach(function(m){a.updateAttributeByFeatureRange(m.name,t.getEncodedData(),m.featureRange.startIndex,m.featureRange.endIndex),m.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,r){var a=r.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){a.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex),l.needRegenerateVertices=!1})}}]),e}())||Lx);Kl.bind(Ke.ILayerPlugin).to(AM).inRequestScope(),Kl.bind(Ke.ILayerPlugin).to(K3).inRequestScope(),Kl.bind(Ke.ILayerPlugin).to(B3).inRequestScope(),Kl.bind(Ke.ILayerPlugin).to(CM).inRequestScope(),Kl.bind(Ke.ILayerPlugin).to(U3).inRequestScope(),Kl.bind(Ke.ILayerPlugin).to(J3).inRequestScope(),Kl.bind(Ke.ILayerPlugin).to(Q3).inRequestScope(),Kl.bind(Ke.ILayerPlugin).to(Y3).inRequestScope(),Kl.bind(Ke.ILayerPlugin).to($3).inRequestScope(),Kl.bind(Ke.ILayerPlugin).to(z3).inRequestScope(),Kl.bind(Ke.ILayerPlugin).to(X3).inRequestScope(),Kl.bind(Ke.ILayerPlugin).to(q3).inRequestScope(),Kl.bind(Ke.ILayerPlugin).to(Z3).inRequestScope();var eP=F(88307),tP=F.n(eP),rP=function(){function e(i,t){(0,qt.Z)(this,e),(0,b.Z)(this,"attribute",void 0),(0,b.Z)(this,"buffer",void 0);var r=t.buffer,a=t.offset,s=t.stride,l=t.normalized,d=t.size,m=t.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:a||0,stride:s||0,normalized:l||!1,divisor:m||0},d&&(this.attribute.size=d)}return(0,Gt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Th,C0,Mh,Ic,A0,sp,w0,Sv,Xf,qp,Iu,Yf,qf,Cv,nP=(Th={},(0,b.Z)(Th,W.POINTS,"points"),(0,b.Z)(Th,W.LINES,"lines"),(0,b.Z)(Th,W.LINE_LOOP,"line loop"),(0,b.Z)(Th,W.LINE_STRIP,"line strip"),(0,b.Z)(Th,W.TRIANGLES,"triangles"),(0,b.Z)(Th,W.TRIANGLE_FAN,"triangle fan"),(0,b.Z)(Th,W.TRIANGLE_STRIP,"triangle strip"),Th),kx=(C0={},(0,b.Z)(C0,W.STATIC_DRAW,"static"),(0,b.Z)(C0,W.DYNAMIC_DRAW,"dynamic"),(0,b.Z)(C0,W.STREAM_DRAW,"stream"),C0),xm=(Mh={},(0,b.Z)(Mh,W.BYTE,"int8"),(0,b.Z)(Mh,W.UNSIGNED_INT,"int16"),(0,b.Z)(Mh,W.INT,"int32"),(0,b.Z)(Mh,W.UNSIGNED_BYTE,"uint8"),(0,b.Z)(Mh,W.UNSIGNED_SHORT,"uint16"),(0,b.Z)(Mh,W.UNSIGNED_INT,"uint32"),(0,b.Z)(Mh,W.FLOAT,"float"),Mh),iP=(Ic={},(0,b.Z)(Ic,W.ALPHA,"alpha"),(0,b.Z)(Ic,W.LUMINANCE,"luminance"),(0,b.Z)(Ic,W.LUMINANCE_ALPHA,"luminance alpha"),(0,b.Z)(Ic,W.RGB,"rgb"),(0,b.Z)(Ic,W.RGBA,"rgba"),(0,b.Z)(Ic,W.RGBA4,"rgba4"),(0,b.Z)(Ic,W.RGB5_A1,"rgb5 a1"),(0,b.Z)(Ic,W.RGB565,"rgb565"),(0,b.Z)(Ic,W.DEPTH_COMPONENT,"depth"),(0,b.Z)(Ic,W.DEPTH_STENCIL,"depth stencil"),Ic),aP=(A0={},(0,b.Z)(A0,W.DONT_CARE,"dont care"),(0,b.Z)(A0,W.NICEST,"nice"),(0,b.Z)(A0,W.FASTEST,"fast"),A0),Dx=(sp={},(0,b.Z)(sp,W.NEAREST,"nearest"),(0,b.Z)(sp,W.LINEAR,"linear"),(0,b.Z)(sp,W.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,b.Z)(sp,W.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,b.Z)(sp,W.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,b.Z)(sp,W.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),sp),Fx=(w0={},(0,b.Z)(w0,W.REPEAT,"repeat"),(0,b.Z)(w0,W.CLAMP_TO_EDGE,"clamp"),(0,b.Z)(w0,W.MIRRORED_REPEAT,"mirror"),w0),oP=(Sv={},(0,b.Z)(Sv,W.NONE,"none"),(0,b.Z)(Sv,W.BROWSER_DEFAULT_WEBGL,"browser"),Sv),sP=(Xf={},(0,b.Z)(Xf,W.NEVER,"never"),(0,b.Z)(Xf,W.ALWAYS,"always"),(0,b.Z)(Xf,W.LESS,"less"),(0,b.Z)(Xf,W.LEQUAL,"lequal"),(0,b.Z)(Xf,W.GREATER,"greater"),(0,b.Z)(Xf,W.GEQUAL,"gequal"),(0,b.Z)(Xf,W.EQUAL,"equal"),(0,b.Z)(Xf,W.NOTEQUAL,"notequal"),Xf),Bx=(qp={},(0,b.Z)(qp,W.FUNC_ADD,"add"),(0,b.Z)(qp,W.MIN_EXT,"min"),(0,b.Z)(qp,W.MAX_EXT,"max"),(0,b.Z)(qp,W.FUNC_SUBTRACT,"subtract"),(0,b.Z)(qp,W.FUNC_REVERSE_SUBTRACT,"reverse subtract"),qp),Av=(Iu={},(0,b.Z)(Iu,W.ZERO,"zero"),(0,b.Z)(Iu,W.ONE,"one"),(0,b.Z)(Iu,W.SRC_COLOR,"src color"),(0,b.Z)(Iu,W.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,b.Z)(Iu,W.SRC_ALPHA,"src alpha"),(0,b.Z)(Iu,W.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,b.Z)(Iu,W.DST_COLOR,"dst color"),(0,b.Z)(Iu,W.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,b.Z)(Iu,W.DST_ALPHA,"dst alpha"),(0,b.Z)(Iu,W.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,b.Z)(Iu,W.CONSTANT_COLOR,"constant color"),(0,b.Z)(Iu,W.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,b.Z)(Iu,W.CONSTANT_ALPHA,"constant alpha"),(0,b.Z)(Iu,W.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,b.Z)(Iu,W.SRC_ALPHA_SATURATE,"src alpha saturate"),Iu),uP=(Yf={},(0,b.Z)(Yf,W.NEVER,"never"),(0,b.Z)(Yf,W.ALWAYS,"always"),(0,b.Z)(Yf,W.LESS,"less"),(0,b.Z)(Yf,W.LEQUAL,"lequal"),(0,b.Z)(Yf,W.GREATER,"greater"),(0,b.Z)(Yf,W.GEQUAL,"gequal"),(0,b.Z)(Yf,W.EQUAL,"equal"),(0,b.Z)(Yf,W.NOTEQUAL,"notequal"),Yf),Rd=(qf={},(0,b.Z)(qf,W.ZERO,"zero"),(0,b.Z)(qf,W.KEEP,"keep"),(0,b.Z)(qf,W.REPLACE,"replace"),(0,b.Z)(qf,W.INVERT,"invert"),(0,b.Z)(qf,W.INCR,"increment"),(0,b.Z)(qf,W.DECR,"decrement"),(0,b.Z)(qf,W.INCR_WRAP,"increment wrap"),(0,b.Z)(qf,W.DECR_WRAP,"decrement wrap"),qf),lP=(Cv={},(0,b.Z)(Cv,W.FRONT,"front"),(0,b.Z)(Cv,W.BACK,"back"),Cv),cP=function(){function e(i,t){(0,qt.Z)(this,e),(0,b.Z)(this,"buffer",void 0);var r=t.data,a=t.usage,s=t.type;this.buffer=i.buffer({data:r,usage:kx[a||W.STATIC_DRAW],type:xm[s||W.UNSIGNED_BYTE]})}return(0,Gt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var r=t.data,a=t.offset;this.buffer.subdata(r,a)}}]),e}(),fP=function(){function e(i,t){(0,qt.Z)(this,e),(0,b.Z)(this,"elements",void 0);var r=t.data,a=t.usage,s=t.type,l=t.count;this.elements=i.elements({data:r,usage:kx[a||W.STATIC_DRAW],type:xm[s||W.UNSIGNED_BYTE],count:l})}return(0,Gt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var r=t.data;this.elements.subdata(r)}},{key:"destroy",value:function(){}}]),e}(),hP=function(){function e(i,t){(0,qt.Z)(this,e),(0,b.Z)(this,"framebuffer",void 0);var r=t.width,a=t.height,s=t.color,l=t.colors,d=t.depth,m=t.stencil,y={width:r,height:a};Array.isArray(l)&&(y.colors=l.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(y.color=s.get()),this.framebuffer=i.framebuffer(y)}return(0,Gt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var r=t.width,a=t.height;this.framebuffer.resize(r,a)}}]),e}(),pP=F(36719),dP=F.n(pP),vP=F(68630),mP=F.n(vP);function Nx(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Rc(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Nx(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Nx(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var gP=function(){function e(i,t){(0,qt.Z)(this,e),(0,b.Z)(this,"reGl",void 0),(0,b.Z)(this,"destroyed",!1),(0,b.Z)(this,"drawCommand",void 0),(0,b.Z)(this,"drawPickCommand",void 0),(0,b.Z)(this,"drawParams",void 0),(0,b.Z)(this,"options",void 0),(0,b.Z)(this,"uniforms",{}),this.reGl=i;var r=t.vs,a=t.fs,s=t.attributes,l=t.uniforms,d=t.primitive,m=t.count,y=t.elements,C=t.depth,w=t.blend,I=t.stencil,L=t.cull,U=t.instances,K={};this.options=t,l&&(this.uniforms=this.extractUniforms(l),Object.keys(l).forEach(function(ot){K[ot]=i.prop(ot)}));var ae={};Object.keys(s).forEach(function(ot){ae[ot]=s[ot].get()});var Ae={attributes:ae,frag:a,uniforms:K,vert:r,blend:{},primitive:nP[d===void 0?W.TRIANGLES:d]};U&&(Ae.instances=U),m&&(Ae.count=m),y&&(Ae.elements=y.get()),this.initDepthDrawParams({depth:C},Ae),this.initBlendDrawParams({blend:w},Ae),this.initStencilDrawParams({stencil:I},Ae),this.initCullDrawParams({cull:L},Ae),this.drawCommand=i(Ae);var Ge=Xc()(Ae);Ge.blend=Rc(Rc({},Ge.blend),{},{enable:!1}),this.drawPickCommand=i(Ge),this.drawParams=Ae}return(0,Gt.Z)(e,[{key:"updateAttributesAndElements",value:function(t,r){var a={};Object.keys(t).forEach(function(l){a[l]=t[l].get()}),this.drawParams.attributes=a,this.drawParams.elements=r.get(),this.drawCommand=this.reGl(this.drawParams);var s=Xc()(this.drawParams);s.blend=Rc(Rc({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(t){var r={};Object.keys(t).forEach(function(s){r[s]=t[s].get()}),this.drawParams.attributes=r,this.drawCommand=this.reGl(this.drawParams);var a=Xc()(this.drawParams);a.blend=Rc(Rc({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(t){this.uniforms=Rc(Rc({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,r){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=Rc(Rc({},this.uniforms),this.extractUniforms(t.uniforms||{})),s={};Object.keys(a).forEach(function(l){var d=(0,Br.Z)(a[l]);d==="boolean"||d==="number"||Array.isArray(a[l])||a[l].BYTES_PER_ELEMENT?s[l]=a[l]:s[l]=a[l].get()}),r?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,r){var a=t.depth;a&&(r.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:sP[a.func||W.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,r){var a=t.blend;if(a){var s=a.enable,l=a.func,d=a.equation,m=a.color,y=m===void 0?[0,0,0,0]:m;r.blend={enable:!!s,func:{srcRGB:Av[l&&l.srcRGB||W.SRC_ALPHA],srcAlpha:Av[l&&l.srcAlpha||W.SRC_ALPHA],dstRGB:Av[l&&l.dstRGB||W.ONE_MINUS_SRC_ALPHA],dstAlpha:Av[l&&l.dstAlpha||W.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Bx[d&&d.rgb||W.FUNC_ADD],alpha:Bx[d&&d.alpha||W.FUNC_ADD]},color:y}}}},{key:"initStencilDrawParams",value:function(t,r){var a=t.stencil;if(a){var s=a.enable,l=a.mask,d=l===void 0?-1:l,m=a.func,y=m===void 0?{cmp:W.ALWAYS,ref:0,mask:-1}:m,C=a.opFront,w=C===void 0?{fail:W.KEEP,zfail:W.KEEP,zpass:W.KEEP}:C,I=a.opBack,L=I===void 0?{fail:W.KEEP,zfail:W.KEEP,zpass:W.KEEP}:I;r.stencil={enable:!!s,mask:d,func:Rc(Rc({},y),{},{cmp:uP[y.cmp]}),opFront:{fail:Rd[w.fail],zfail:Rd[w.zfail],zpass:Rd[w.zpass]},opBack:{fail:Rd[L.fail],zfail:Rd[L.zfail],zpass:Rd[L.zpass]}}}}},{key:"initCullDrawParams",value:function(t,r){var a=t.cull;if(a){var s=a.enable,l=a.face,d=l===void 0?W.BACK:l;r.cull={enable:!!s,face:lP[d]}}}},{key:"extractUniforms",value:function(t){var r=this,a={};return Object.keys(t).forEach(function(s){r.extractUniformsRecursively(s,t[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(t,r,a,s){var l=this;if(r===null||typeof r=="number"||typeof r=="boolean"||Array.isArray(r)&&typeof r[0]=="number"||dP()(r)||r===""||"resize"in r){a["".concat(s&&s+".").concat(t)]=r;return}mP()(r)&&Object.keys(r).forEach(function(d){l.extractUniformsRecursively(d,r[d],a,"".concat(s&&s+".").concat(t))}),Array.isArray(r)&&r.forEach(function(d,m){Object.keys(d).forEach(function(y){l.extractUniformsRecursively(y,d[y],a,"".concat(s&&s+".").concat(t,"[").concat(m,"]"))})})}}]),e}(),yP=function(){function e(i,t){(0,qt.Z)(this,e),(0,b.Z)(this,"texture",void 0),(0,b.Z)(this,"width",void 0),(0,b.Z)(this,"height",void 0),(0,b.Z)(this,"isDistroy",!1);var r=t.data,a=t.type,s=a===void 0?W.UNSIGNED_BYTE:a,l=t.width,d=t.height,m=t.flipY,y=m===void 0?!1:m,C=t.format,w=C===void 0?W.RGBA:C,I=t.mipmap,L=I===void 0?!1:I,U=t.wrapS,K=U===void 0?W.CLAMP_TO_EDGE:U,ae=t.wrapT,Ae=ae===void 0?W.CLAMP_TO_EDGE:ae,Ge=t.aniso,ot=Ge===void 0?0:Ge,St=t.alignment,zt=St===void 0?1:St,Ot=t.premultiplyAlpha,er=Ot===void 0?!1:Ot,_r=t.mag,kr=_r===void 0?W.NEAREST:_r,Kr=t.min,Pr=Kr===void 0?W.NEAREST:Kr,ln=t.colorSpace,kn=ln===void 0?W.BROWSER_DEFAULT_WEBGL:ln,Hn=t.x,xa=Hn===void 0?0:Hn,Ua=t.y,Io=Ua===void 0?0:Ua,Ds=t.copy,Fs=Ds===void 0?!1:Ds;this.width=l,this.height=d;var Lc={width:l,height:d,type:xm[s],format:iP[w],wrapS:Fx[K],wrapT:Fx[Ae],mag:Dx[kr],min:Dx[Pr],alignment:zt,flipY:y,colorSpace:oP[kn],premultiplyAlpha:er,aniso:ot,x:xa,y:Io,copy:Fs};r&&(Lc.data=r),typeof L=="number"?Lc.mipmap=aP[L]:typeof L=="boolean"&&(Lc.mipmap=L),this.texture=i.texture(Lc)}return(0,Gt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var r=t.width,a=t.height;this.texture.resize(r,a),this.width=r,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDistroy=!0}}]),e}(),zx,Zx,_P=(zx=(0,wt.b2)(),zx(Zx=function(){function e(){var i=this;(0,qt.Z)(this,e),(0,b.Z)(this,"extensionObject",void 0),(0,b.Z)(this,"gl",void 0),(0,b.Z)(this,"$container",void 0),(0,b.Z)(this,"canvas",void 0),(0,b.Z)(this,"width",void 0),(0,b.Z)(this,"height",void 0),(0,b.Z)(this,"isDirty",void 0),(0,b.Z)(this,"createModel",function(t){return new gP(i.gl,t)}),(0,b.Z)(this,"createAttribute",function(t){return new rP(i.gl,t)}),(0,b.Z)(this,"createBuffer",function(t){return new cP(i.gl,t)}),(0,b.Z)(this,"createElements",function(t){return new fP(i.gl,t)}),(0,b.Z)(this,"createTexture2D",function(t){return new yP(i.gl,t)}),(0,b.Z)(this,"createFramebuffer",function(t){return new hP(i.gl,t)}),(0,b.Z)(this,"useFramebuffer",function(t,r){i.gl({framebuffer:t?t.get():null})(r)}),(0,b.Z)(this,"clear",function(t){var r,a=t.color,s=t.depth,l=t.stencil,d=t.framebuffer,m=d===void 0?null:d,y={color:a,depth:s,stencil:l};y.framebuffer=m===null?m:m.get(),(r=i.gl)===null||r===void 0||r.clear(y)}),(0,b.Z)(this,"viewport",function(t){var r=t.x,a=t.y,s=t.width,l=t.height;i.gl._gl.viewport(r,a,s,l),i.width=s,i.height=l,i.gl._refresh()}),(0,b.Z)(this,"readPixels",function(t){var r=t.framebuffer,a=t.x,s=t.y,l=t.width,d=t.height,m={x:a,y:s,width:l,height:d};return r&&(m.framebuffer=r.get()),i.gl.read(m)}),(0,b.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,b.Z)(this,"getContainer",function(){if(Ci)return i.canvas;var t;return(t=i.canvas)===null||t===void 0?void 0:t.parentElement}),(0,b.Z)(this,"getCanvas",function(){return i.canvas}),(0,b.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,b.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,Gt.Z)(e,[{key:"init",value:function(){var i=(0,Ta.Z)(Sn().mark(function r(a,s){var l=this;return Sn().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return this.canvas=a,m.next=3,new Promise(function(y,C){tP()({canvas:l.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(I,L){(I||!L)&&C(I),y(L)}})});case 3:this.gl=m.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return m.stop()}},r,this)}));function t(r,a){return i.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Zx);function Ux(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function jx(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Ux(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ux(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var xP=function(){function e(i){(0,qt.Z)(this,e),(0,b.Z)(this,"sceneService",void 0),(0,b.Z)(this,"mapService",void 0),(0,b.Z)(this,"controlService",void 0),(0,b.Z)(this,"layerService",void 0),(0,b.Z)(this,"iconService",void 0),(0,b.Z)(this,"markerService",void 0),(0,b.Z)(this,"popupService",void 0),(0,b.Z)(this,"fontService",void 0),(0,b.Z)(this,"interactionService",void 0),(0,b.Z)(this,"container",void 0);var t=i.id,r=i.map,a=i.canvas,s=i.hasBaseMap,l=EE();this.container=l,r.setContainer(l,t,a,s),l.bind(Ke.IRendererService).to(_P).inSingletonScope(),this.sceneService=l.get(Ke.ISceneService),this.mapService=l.get(Ke.IMapService),this.iconService=l.get(Ke.IIconService),this.fontService=l.get(Ke.IFontService),this.controlService=l.get(Ke.IControlService),this.layerService=l.get(Ke.ILayerService),this.markerService=l.get(Ke.IMarkerService),this.interactionService=l.get(Ke.IInteractionService),this.popupService=l.get(Ke.IPopupService),Ci?this.sceneService.initMiniScene(i):(this.initComponent(t),this.sceneService.init(i),this.initControl())}return(0,Gt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var r=this;if(this.sceneService.loaded){var a=new t(this);a.init()}else this.on("loaded",function(){var s=new t(r);s.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var r=Uv(this.container);t.setContainer(r,this.container),this.sceneService.addLayer(t);var a=t.getLayerConfig();if(a){var s=a.mask,l=a.maskfence,d=a.maskColor,m=d===void 0?"#000":d,y=a.maskOpacity,C=y===void 0?0:y;if(s&&l){var w=new Vy().source(l).shape("fill").color(m).style({opacity:C});this.addMask(w,t.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(t,r){var a=this.getLayer(r);if(a){var s=Uv(this.container);t.setContainer(s,this.container),a.addMaskLayer(t),this.sceneService.addLayer(t)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,r){this.layerService.remove(t,r)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,r){this.fontService.addIconFont(t,r)}},{key:"addIconFonts",value:function(t){var r=this;t.forEach(function(a){var s=(0,sn.Z)(a,2),l=s[0],d=s[1];r.fontService.addIconFont(l,d)})}},{key:"addFontFace",value:function(t,r){this.sceneService.addFontFace(t,r)}},{key:"addImage",value:function(t,r){Ci?this.iconService.addImageMini(t,r,this.sceneService):this.iconService.addImage(t,r)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,r){this.fontService.addIconGlyphs(r)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"on",value:function(t,r){jv.indexOf(t)===-1?this.mapService.on(t,r):this.sceneService.on(t,r)}},{key:"once",value:function(t,r){jv.indexOf(t)===-1?this.mapService.once(t,r):this.sceneService.once(t,r)}},{key:"off",value:function(t,r){jv.indexOf(t)===-1?this.mapService.off(t,r):this.sceneService.off(t,r)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,r){return this.mapService.setCenter(t,r)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,r){this.mapService.panBy(t,r)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,r){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,l=a.animate;this.mapService.fitBounds(t,r||jx(jx({},s),{},{animate:l}))}},{key:"setZoomAndCenter",value:function(t,r){this.mapService.setZoomAndCenter(t,r)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,r){this.container.bind(Ke.IPostProcessingPass).to(t).whenTargetNamed(r)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:zc(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),r=t.logoVisible,a=t.logoPosition;r&&this.addControl(new jE({position:a}))}}]),e}(),EI="2.9.11";function Vx(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function SI(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Vx(Object(t),!0).forEach(function(r){bP(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Vx(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function bP(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function CI(e,i){return AP(e)||CP(e,i)||SP(e,i)||EP()}function EP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SP(e,i){if(!!e){if(typeof e=="string")return Gx(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Gx(e,i)}}function Gx(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function CP(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r=[],a=!0,s=!1,l,d;try{for(t=t.call(e);!(a=(l=t.next()).done)&&(r.push(l.value),!(i&&r.length===i));a=!0);}catch(m){s=!0,d=m}finally{try{!a&&t.return!=null&&t.return()}finally{if(s)throw d}}return r}}function AP(e){if(Array.isArray(e))return e}var AI=null,wI=null,Hx,bm,Wx;function Xx(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Yx(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Xx(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Xx(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}var wP=(Hx=Zv(Ke.IGlobalConfigService),bm=function(){function e(i){(0,qt.Z)(this,e),Mt(this,"configService",Wx,this),(0,b.Z)(this,"config",void 0),this.config=i}return(0,Gt.Z)(e,[{key:"setContainer",value:function(t,r,a,s){t.bind(Ke.MapConfig).toConstantValue(Yx(Yx({},this.config),{},{id:r,canvas:a,hasBaseMap:s})),t.bind(Ke.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),Wx=Pt(bm.prototype,"configService",[Hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bm),TP=F(6158),T0=F.n(TP);function M0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function wv(e,i){var t=Qi([],i,e);return ga(t,t,1/t[3]),t}function TI(e,i){var t=e%i;return t<0?i+t:t}function MI(e,i,t){return t*i+(1-t)*e}function Kp(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var vf=Math.PI,qx=vf/4,Ph=vf/180,Kx=180/vf,Em=512,Sm=4003e4,MP=1.5;function $x(e){return Math.pow(2,e)}function PP(e){return Math.log2(e)}function Tv(e,i){var t=(0,sn.Z)(e,2),r=t[0],a=t[1];Kp(Number.isFinite(r)&&Number.isFinite(i)),Kp(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=Em;var s=r*Ph,l=a*Ph,d=i*(s+vf)/(2*vf),m=i*(vf-Math.log(Math.tan(qx+l*.5)))/(2*vf);return[d,m]}function Cm(e,i){var t=(0,sn.Z)(e,2),r=t[0],a=t[1];i*=Em;var s=r/i*(2*vf)-vf,l=2*(Math.atan(Math.exp(vf-a/i*(2*vf)))-qx);return[s*Kx,l*Kx]}function PI(e){var i=e.latitude;assert(Number.isFinite(i));var t=Math.cos(i*Ph);return PP(Sm*t)-9}function Qx(e){var i=e.latitude,t=e.longitude,r=e.zoom,a=e.scale,s=e.highPrecision,l=s===void 0?!1:s;a=a!==void 0?a:$x(r),Kp(Number.isFinite(i)&&Number.isFinite(t)&&Number.isFinite(a));var d={},m=Em*a,y=Math.cos(i*Ph),C=m/360,w=C/y,I=m/Sm/y;if(d.pixelsPerMeter=[I,-I,I],d.metersPerPixel=[1/I,-1/I,1/I],d.pixelsPerDegree=[C,-w,I],d.degreesPerPixel=[1/C,-1/w,1/I],l){var L=Ph*Math.tan(i*Ph)/y,U=C*L/2,K=m/Sm*L,ae=K/w*I;d.pixelsPerDegree2=[0,-U,K],d.pixelsPerMeter2=[ae,0,ae]}return d}function OI(e,i){var t=_slicedToArray(e,3),r=t[0],a=t[1],s=t[2],l=_slicedToArray(i,3),d=l[0],m=l[1],y=l[2],C=1,w=Qx({longitude:r,latitude:a,scale:C,highPrecision:!0}),I=w.pixelsPerMeter,L=w.pixelsPerMeter2,U=Tv(e,C);U[0]+=d*(I[0]+L[0]*m),U[1]+=m*(I[1]+L[1]*m);var K=Cm(U,C),ae=(s||0)+(y||0);return Number.isFinite(s)||Number.isFinite(y)?[K[0],K[1],ae]:K}function OP(e){var i=e.height,t=e.pitch,r=e.bearing,a=e.altitude,s=e.center,l=s===void 0?null:s,d=e.flipY,m=d===void 0?!1:d,y=M0();return ht(y,y,[0,0,-a]),Xe(y,y,[1,1,1/i]),Pe(y,y,-t*Ph),Be(y,y,r*Ph),m&&Xe(y,y,[1,-1,1]),l&&ht(y,y,Xa.negate([],l)),y}function IP(e){var i=e.width,t=e.height,r=e.altitude,a=r===void 0?MP:r,s=e.pitch,l=s===void 0?0:s,d=e.nearZMultiplier,m=d===void 0?1:d,y=e.farZMultiplier,C=y===void 0?1:y,w=l*Ph,I=Math.atan(.5/a),L=Math.sin(I)*a/Math.sin(Math.PI/2-w-I),U=Math.cos(Math.PI/2-w)*L+a;return{fov:2*Math.atan(t/2/a),aspect:i/t,focalDistance:a,near:m,far:U*C}}function RP(e){var i=e.width,t=e.height,r=e.pitch,a=e.altitude,s=e.nearZMultiplier,l=e.farZMultiplier,d=IP({width:i,height:t,altitude:a,pitch:r,nearZMultiplier:s,farZMultiplier:l}),m=d.fov,y=d.aspect,C=d.near,w=d.far,I=fa([],m,y,C,w);return I}function LP(e,i){var t=(0,sn.Z)(e,3),r=t[0],a=t[1],s=t[2],l=s===void 0?0:s;return Kp(Number.isFinite(r)&&Number.isFinite(a)&&Number.isFinite(l)),wv(i,[r,a,l,1])}function Jx(e,i){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=(0,sn.Z)(e,3),a=r[0],s=r[1],l=r[2];if(Kp(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(l)){var d=wv(i,[a,s,l,1]);return d}var m=wv(i,[a,s,0,1]),y=wv(i,[a,s,1,1]),C=m[2],w=y[2],I=C===w?0:((t||0)-C)/(w-C);return Fi.t7([],m,y,I)}var eb=M0(),kP=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=i.width,r=i.height,a=i.viewMatrix,s=a===void 0?eb:a,l=i.projectionMatrix,d=l===void 0?eb:l;(0,qt.Z)(this,e),this.width=t||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=d;var m=M0();Yt(m,m,this.projectionMatrix),Yt(m,m,this.viewMatrix),this.viewProjectionMatrix=m;var y=M0();Xe(y,y,[this.width/2,-this.height/2,1]),ht(y,y,[1,-1,0]),Yt(y,y,this.viewProjectionMatrix);var C=ye(M0(),y);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=y,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Gt.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&Ap(t.projectionMatrix,this.projectionMatrix)&&Ap(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=r.topLeft,s=a===void 0?!0:a,l=this.projectPosition(t),d=LP(l,this.pixelProjectionMatrix),m=(0,sn.Z)(d,2),y=m[0],C=m[1],w=s?C:this.height-C;return t.length===2?[y,w]:[y,w,d[2]]}},{key:"unproject",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=r.topLeft,s=a===void 0?!0:a,l=r.targetZ,d=(0,sn.Z)(t,3),m=d[0],y=d[1],C=d[2],w=s?y:this.height-y,I=l&&l*this.pixelsPerMeter,L=Jx([m,w,C],this.pixelUnprojectionMatrix,I),U=this.unprojectPosition(L),K=(0,sn.Z)(U,3),ae=K[0],Ae=K[1],Ge=K[2];return Number.isFinite(C)?[ae,Ae,Ge]:Number.isFinite(l)?[ae,Ae,l]:[ae,Ae]}},{key:"projectPosition",value:function(t){var r=this.projectFlat(t),a=(0,sn.Z)(r,2),s=a[0],l=a[1],d=(t[2]||0)*this.pixelsPerMeter;return[s,l,d]}},{key:"unprojectPosition",value:function(t){var r=this.unprojectFlat(t),a=(0,sn.Z)(r,2),s=a[0],l=a[1],d=(t[2]||0)/this.pixelsPerMeter;return[s,l,d]}},{key:"projectFlat",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function DP(e){var i=e.width,t=e.height,r=e.bounds,a=e.minExtent,s=a===void 0?0:a,l=e.maxZoom,d=l===void 0?24:l,m=e.padding,y=m===void 0?0:m,C=e.offset,w=C===void 0?[0,0]:C,I=(0,sn.Z)(r,2),L=(0,sn.Z)(I[0],2),U=L[0],K=L[1],ae=(0,sn.Z)(I[1],2),Ae=ae[0],Ge=ae[1];if(Number.isFinite(y)){var ot=y;y={top:ot,bottom:ot,left:ot,right:ot}}else Kp(Number.isFinite(y.top)&&Number.isFinite(y.bottom)&&Number.isFinite(y.left)&&Number.isFinite(y.right));var St=new tb({width:i,height:t,longitude:0,latitude:0,zoom:0}),zt=St.project([U,Ge]),Ot=St.project([Ae,K]),er=[Math.max(Math.abs(Ot[0]-zt[0]),s),Math.max(Math.abs(Ot[1]-zt[1]),s)],_r=[i-y.left-y.right-Math.abs(w[0])*2,t-y.top-y.bottom-Math.abs(w[1])*2];Kp(_r[0]>0&&_r[1]>0);var kr=_r[0]/er[0],Kr=_r[1]/er[1],Pr=(y.right-y.left)/2/kr,ln=(y.bottom-y.top)/2/Kr,kn=[(Ot[0]+zt[0])/2+Pr,(Ot[1]+zt[1])/2+ln],Hn=St.unproject(kn),xa=St.zoom+Math.log2(Math.abs(Math.min(kr,Kr)));return{longitude:Hn[0],latitude:Hn[1],zoom:Math.min(xa,d)}}var tb=function(e){(0,Wr.Z)(i,e);function i(){var t,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=r.width,s=r.height,l=r.latitude,d=l===void 0?0:l,m=r.longitude,y=m===void 0?0:m,C=r.zoom,w=C===void 0?0:C,I=r.pitch,L=I===void 0?0:I,U=r.bearing,K=U===void 0?0:U,ae=r.altitude,Ae=ae===void 0?1.5:ae,Ge=r.nearZMultiplier,ot=r.farZMultiplier;(0,qt.Z)(this,i),a=a||1,s=s||1;var St=$x(w);Ae=Math.max(.75,Ae);var zt=Tv([y,d],St);zt[2]=0;var Ot=RP({width:a,height:s,pitch:L,bearing:K,altitude:Ae,nearZMultiplier:Ge||1/s,farZMultiplier:ot||1.01}),er=OP({height:s,center:zt,pitch:L,bearing:K,altitude:Ae,flipY:!0});return t=(0,Hr.Z)(this,(0,yt.Z)(i).call(this,{width:a,height:s,viewMatrix:er,projectionMatrix:Ot})),t.latitude=d,t.longitude=y,t.zoom=w,t.pitch=L,t.bearing=K,t.altitude=Ae,t.scale=St,t.center=zt,t.pixelsPerMeter=Qx((0,he.Z)((0,he.Z)(t))).pixelsPerMeter[2],Object.freeze((0,he.Z)((0,he.Z)(t))),t}return(0,Gt.Z)(i,[{key:"projectFlat",value:function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Tv(r,a)}},{key:"unprojectFlat",value:function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Cm(r,a)}},{key:"getMapCenterByLngLatPosition",value:function(r){var a=r.lngLat,s=r.pos,l=Jx(s,this.pixelUnprojectionMatrix),d=Tv(a,this.scale),m=Fi.IH([],d,Fi.tk([],l)),y=Fi.IH([],this.center,m);return Cm(y,this.scale)}},{key:"getLocationAtPoint",value:function(r){var a=r.lngLat,s=r.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,l=this.height,d=DP(Object.assign({width:s,height:l,bounds:r},a)),m=d.longitude,y=d.latitude,C=d.zoom;return new i({width:s,height:l,longitude:m,latitude:y,zoom:C})}}]),i}(kP),FP=function(){function e(){(0,qt.Z)(this,e),(0,b.Z)(this,"viewport",void 0)}return(0,Gt.Z)(e,[{key:"syncWithMapCamera",value:function(t){var r=t.center,a=t.zoom,s=t.pitch,l=t.bearing,d=t.viewportHeight,m=t.viewportWidth;this.viewport=new tb({width:m,height:d,longitude:r&&r[0],latitude:r&&r[1],zoom:a,pitch:s,bearing:l})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,r){return this.viewport.projectFlat(t,r)}}]),e}(),BP=function(){function e(i){(0,qt.Z)(this,e),(0,b.Z)(this,"size",1e4),this.size=i||1e4}return(0,Gt.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var r=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90}},{key:"project",value:function(t){var r=this.mercatorXfromLng(t[0]),a=this.mercatorYfromLat(t[1]);return[r,a]}},{key:"unproject",value:function(t){var r=this.lngFromMercatorX(t[0]),a=this.latFromMercatorY(t[1]);return[r,a]}}]),e}(),rb={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},NP=["id","attributionControl","style","token","rotation","mapInstance"],nb,ib,ab,ob,sb,ub,Ld,lb,cb,fb,hb;function pb(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function zP(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?pb(Object(t),!0).forEach(function(r){(0,b.Z)(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):pb(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function ZP(e,i){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,r=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||r)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var l=i.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=e:l.appendChild(i.createTextNode(e)),a.appendChild(l),l}}ZP(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=T0();var db={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},UP=0,jP=12,vb="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",VP=(nb=(0,wt.b2)(),ib=(0,wt.f3)(Ke.MapConfig),ab=(0,wt.f3)(Ke.IGlobalConfigService),ob=(0,wt.f3)(Ke.ICoordinateSystemService),sb=(0,wt.f3)(Ke.IEventEmitter),nb(ub=(Ld=function(){function e(){var i=this;(0,qt.Z)(this,e),(0,b.Z)(this,"version",ss.MAPBOX),(0,b.Z)(this,"map",void 0),(0,b.Z)(this,"simpleMapCoord",new BP),(0,b.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Mt(this,"config",lb,this),Mt(this,"configService",cb,this),Mt(this,"coordinateSystemService",fb,this),Mt(this,"eventEmitter",hb,this),(0,b.Z)(this,"viewport",void 0),(0,b.Z)(this,"markerContainer",void 0),(0,b.Z)(this,"cameraChangedCallback",void 0),(0,b.Z)(this,"$mapContainer",void 0),(0,b.Z)(this,"handleCameraChanged",function(){var t=i.map.getCenter().wrap(),r=t.lat,a=t.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,r],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,l=s===void 0?jP:s;i.viewport.getZoom()>l?i.coordinateSystemService.setCoordinateSystem(al.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(al.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Gt.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=za("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,r){kE.indexOf(t)!==-1?this.eventEmitter.on(t,r):this.map.on(db[t]||t,r)}},{key:"off",value:function(t,r){this.map.off(db[t]||t,r),this.eventEmitter.off(t,r)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,r){this.map.zoomIn(t,r)}},{key:"zoomOut",value:function(t,r){this.map.zoomOut(t,r)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(t,r){this.panTo([t,r])}},{key:"fitBounds",value:function(t,r){this.map.fitBounds(t,r)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.rotateEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,r){this.map.flyTo({zoom:t,center:r})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToCoord",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(t,0),s=a.x,l=a.y;return[s-r.x,l-r.y]}},{key:"lngLatToMercator",value:function(t,r){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(t,r),s=a.x,l=s===void 0?0:s,d=a.y,m=d===void 0?0:d,y=a.z,C=y===void 0?0:y;return{x:l,y:m,z:C}}},{key:"getModelMatrix",value:function(t,r,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},d=window.mapboxgl.MercatorCoordinate.fromLngLat(t,r),m=d.meterInMercatorCoordinateUnits(),y=Ls();return ht(y,y,Xa.fromValues(d.x-l.x,d.y-l.y,d.z||0-l.z)),Xe(y,y,Xa.fromValues(m*s[0],-m*s[1],m*s[2])),Pe(y,y,a[0]),tt(y,y,a[1]),Be(y,y,a[2]),y}},{key:"init",value:function(){var i=(0,Ta.Z)(Sn().mark(function r(){var a,s,l,d,m,y,C,w,I,L,U,K,ae;return Sn().wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:a=this.config,s=a.id,l=s===void 0?"map":s,d=a.attributionControl,m=d===void 0?!1:d,y=a.style,C=y===void 0?"light":y,w=a.token,I=w===void 0?vb:w,L=a.rotation,U=L===void 0?0:L,K=a.mapInstance,ae=(0,Eh.Z)(a,NP),this.viewport=new FP,!K&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),I===vb&&C!=="blank"&&!window.mapboxgl.accessToken&&!K&&console.warn(this.configService.getSceneWarninfo("MapToken")),!K&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=I),K?(this.map=K,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(l),this.map=new window.mapboxgl.Map(zP({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:m,bearing:U},ae))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ge.stop()}},r,this)}));function t(){return i.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,r;(t=this.$mapContainer)===null||t===void 0||(r=t.parentNode)===null||r===void 0||r.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var r,a=arguments.length,s=new Array(a>1?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];(r=this.eventEmitter).emit.apply(r,[t].concat(s))}},{key:"once",value:function(t){for(var r,a=arguments.length,s=new Array(a>1?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];(r=this.eventEmitter).once.apply(r,[t].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,r){var a=new(T0()).LngLat(t[0],t[1]),s=new(T0()).LngLat(r[0],r[1]),l=a.distanceTo(s),d=T0().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),m=T0().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),y=d.x,C=d.y,w=m.x,I=m.y,L=Math.sqrt(Math.pow(y-w,2)+Math.pow(C-I,2))*4194304*2;return L/l}},{key:"exportMap",value:function(t){var r=this.map.getCanvas(),a=t==="jpg"?r==null?void 0:r.toDataURL("image/jpeg"):r==null?void 0:r.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var r=t;typeof t=="string"&&(r=document.getElementById(t));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+UP++,r.appendChild(a),a}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:rb[t]?rb[t]:t}}]),e}(),lb=Pt(Ld.prototype,"config",[ib],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cb=Pt(Ld.prototype,"configService",[ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fb=Pt(Ld.prototype,"coordinateSystemService",[ob],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hb=Pt(Ld.prototype,"eventEmitter",[sb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ld))||ub);function GP(e){var i=HP();return function(){var r=(0,yt.Z)(e),a;if(i){var s=(0,yt.Z)(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return(0,Hr.Z)(this,a)}}function HP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function WP(e,i){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,r=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||r)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var l=i.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=e:l.appendChild(i.createTextNode(e)),a.appendChild(l),l}}WP(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var XP=function(e){(0,Wr.Z)(t,e);var i=GP(t);function t(){return(0,qt.Z)(this,t),i.apply(this,arguments)}return(0,Gt.Z)(t,[{key:"getServiceConstructor",value:function(){return VP}}]),t}(wP);function mb(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function gb(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?mb(Object(t),!0).forEach(function(r){YP(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):mb(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function YP(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function qP(e,i){return JP(e)||QP(e,i)||$P(e,i)||KP()}function KP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $P(e,i){if(!!e){if(typeof e=="string")return yb(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return yb(e,i)}}function yb(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function QP(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r=[],a=!0,s=!1,l,d;try{for(t=t.call(e);!(a=(l=t.next()).done)&&(r.push(l.value),!(i&&r.length===i));a=!0);}catch(m){s=!0,d=m}finally{try{!a&&t.return!=null&&t.return()}finally{if(s)throw d}}return r}}function JP(e){if(Array.isArray(e))return e}var e4=Y.memo(function(e){var i=e.style,t=e.className,r=e.map,a=e.option,s=e.onSceneLoaded,l=(0,Y.createRef)(),d=(0,Y.useState)(),m=qP(d,2),y=m[0],C=m[1];return(0,Y.useEffect)(function(){var w=new xP(gb(gb({id:l.current},a),{},{map:new XP(r)}));return w.on("loaded",function(){C(w),s&&s(w)}),function(){w.destroy()}},[]),(0,Y.useEffect)(function(){y&&r.style&&y.setMapStyle(r.style)},[JSON.stringify(r.style)]),(0,Y.useEffect)(function(){y&&r.zoom&&y.setZoom(r.zoom)},[r.zoom]),(0,Y.useEffect)(function(){y&&r.center&&y.setCenter(r.center)},[JSON.stringify(r.center)]),(0,Y.useEffect)(function(){y&&r.pitch!==void 0&&y.setPitch(r.pitch||0)},[r.pitch]),(0,Y.useEffect)(function(){y&&r.rotation&&y.setRotation(r.rotation)},[r.rotation]),Y.createElement(g.Provider,{value:y},(0,Y.createElement)("div",{ref:l,style:i,className:t},y&&e.children))}),t4=e4;function _b(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function II(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?_b(Object(t),!0).forEach(function(r){r4(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_b(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function r4(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function RI(e,i){return o4(e)||a4(e,i)||i4(e,i)||n4()}function n4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i4(e,i){if(!!e){if(typeof e=="string")return xb(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xb(e,i)}}function xb(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function a4(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r=[],a=!0,s=!1,l,d;try{for(t=t.call(e);!(a=(l=t.next()).done)&&(r.push(l.value),!(i&&r.length===i));a=!0);}catch(m){s=!0,d=m}finally{try{!a&&t.return!=null&&t.return()}finally{if(s)throw d}}return r}}function o4(e){if(Array.isArray(e))return e}var LI=null,kI=null;function bb(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function DI(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?bb(Object(t),!0).forEach(function(r){s4(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):bb(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function s4(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function FI(e,i){return f4(e)||c4(e,i)||l4(e,i)||u4()}function u4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function l4(e,i){if(!!e){if(typeof e=="string")return Eb(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Eb(e,i)}}function Eb(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function c4(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r=[],a=!0,s=!1,l,d;try{for(t=t.call(e);!(a=(l=t.next()).done)&&(r.push(l.value),!(i&&r.length===i));a=!0);}catch(m){s=!0,d=m}finally{try{!a&&t.return!=null&&t.return()}finally{if(s)throw d}}return r}}function f4(e){if(Array.isArray(e))return e}var BI=null,NI=null;function zI(e,i){return v4(e)||d4(e,i)||p4(e,i)||h4()}function h4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function p4(e,i){if(!!e){if(typeof e=="string")return Sb(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Sb(e,i)}}function Sb(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function d4(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r=[],a=!0,s=!1,l,d;try{for(t=t.call(e);!(a=(l=t.next()).done)&&(r.push(l.value),!(i&&r.length===i));a=!0);}catch(m){s=!0,d=m}finally{try{!a&&t.return!=null&&t.return()}finally{if(s)throw d}}return r}}function v4(e){if(Array.isArray(e))return e}var ZI=null,UI=null;function Cb(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function jI(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Cb(Object(t),!0).forEach(function(r){m4(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Cb(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function m4(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function VI(e,i){if(e==null)return{};var t=g4(e,i),r,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],!(i.indexOf(r)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,r)||(t[r]=e[r]))}return t}function g4(e,i){if(e==null)return{};var t={},r=Object.keys(e),a,s;for(s=0;s<r.length;s++)a=r[s],!(i.indexOf(a)>=0)&&(t[a]=e[a]);return t}var GI=null,Ab=F(73935);function wb(e,i){return b4(e)||x4(e,i)||_4(e,i)||y4()}function y4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _4(e,i){if(!!e){if(typeof e=="string")return Tb(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Tb(e,i)}}function Tb(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function x4(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r=[],a=!0,s=!1,l,d;try{for(t=t.call(e);!(a=(l=t.next()).done)&&(r.push(l.value),!(i&&r.length===i));a=!0);}catch(m){s=!0,d=m}finally{try{!a&&t.return!=null&&t.return()}finally{if(s)throw d}}return r}}function b4(e){if(Array.isArray(e))return e}var Mb=Y.useEffect,Pb=Y.useState,E4=/\B([A-Z])/g,S4=function(i){return i.replace(E4,"-$1").toLowerCase()};function HI(e){var i=e.className,t=e.style,r=e.children,a=e.position,s=Pb(),l=wb(s,2),d=l[0],m=l[1],y=useSceneValue(),C=Pb(function(){return document.createElement("div")}),w=wb(C,1),I=w[0];return Mb(function(){var L=new Control({position:a});return L.onAdd=function(){if(i&&(I.className=i),t){var U=Object.keys(t).map(function(K){return"".concat(S4(K),":").concat(t[K])}).join(";");I.style.cssText=U}return I},L.onRemove=function(){},m(L),y.addControl(L),function(){y.removeControl(L)}},[]),Mb(function(){d&&d.setPosition(a||"bottomleft")},[a]),createPortal(r,I)}var Ob=(0,Y.createContext)({});function WI(){return useContext(Ob)}var Kf=F(96486),XI=Y.useEffect,C4=Y.memo(function(i){var t=i.layer,r=i.active;return t.active(r.option),null},Kf.isEqual),YI=Y.useEffect,A4=Y.memo(function(i){var t=i.layer,r=i.animate;return t.animate(r),null},Kf.isEqual),qI=Y.useEffect,w4=Y.memo(function(i){var t=i.layer,r=i.color;return r.field?t.color(r.field,r.values):t.color(r.values),null},Kf.isEqual),T4=Y.memo(function(i){var t=i.layer,r=i.filter;return r.field&&t.filter(r.field,r.values),null},Kf.isEqual),M4=Y.memo(function(i){var t=i.layer,r=i.scale;return t.scale(r.values),null},Kf.isEqual),KI=Y.useEffect,P4=Y.memo(function(i){var t=i.layer,r=i.select;return t.select(r.option),null},Kf.isEqual),O4=Y.memo(function(i){var t=i.layer,r=i.shape;return r.field?t.shape(r.field,r.values):t.shape(r.values),null},Kf.isEqual),I4=Y.memo(function(i){var t=i.layer,r=i.size;return r.field?t.size(r.field,r.values):t.size(r.values),null},Kf.isEqual),R4=["data"];function L4(e,i){if(e==null)return{};var t=k4(e,i),r,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)r=s[a],!(i.indexOf(r)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,r)||(t[r]=e[r]))}return t}function k4(e,i){if(e==null)return{};var t={},r=Object.keys(e),a,s;for(s=0;s<r.length;s++)a=r[s],!(i.indexOf(a)>=0)&&(t[a]=e[a]);return t}var D4=Y.memo(function(i){var t=i.layer,r=i.source,a=r.data,s=L4(r,R4);return t.inited?t.setData(a,s):t.source(a,s),s.autoFit&&t.fitBounds(s&&s.fitBoundsOptions),null},Kf.isEqual),$I=Y.useEffect,F4=Y.memo(function(i){var t=i.layer,r=i.style;return t.style(r),null},Kf.isEqual);function B4(e,i){return U4(e)||Z4(e,i)||z4(e,i)||N4()}function N4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function z4(e,i){if(!!e){if(typeof e=="string")return Ib(e,i);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ib(e,i)}}function Ib(e,i){(i==null||i>e.length)&&(i=e.length);for(var t=0,r=new Array(i);t<i;t++)r[t]=e[t];return r}function Z4(e,i){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r=[],a=!0,s=!1,l,d;try{for(t=t.call(e);!(a=(l=t.next()).done)&&(r.push(l.value),!(i&&r.length===i));a=!0);}catch(m){s=!0,d=m}finally{try{!a&&t.return!=null&&t.return()}finally{if(s)throw d}}return r}}function U4(e){if(Array.isArray(e))return e}var P0=Y.useEffect,j4=Y.useState;function Rb(e,i){var t=i.source,r=i.color,a=i.shape,s=i.style,l=i.size,d=i.scale,m=i.active,y=i.select,C=i.filter,w=i.animate,I=i.options,L=i.onLayerLoaded,U=fe(),K=j4(function(){var Ge;switch(e){case"polygonLayer":Ge=new y_(I);break;case"lineLayer":Ge=new Jw(I);break;case"pointLayer":Ge=new UT(I);break;case"heatmapLayer":Ge=new gC(I);break;case"rasterLayer":Ge=new EM(I);break;case"imageLayer":Ge=new jy(I);break;case"citybuildingLayer":Ge=new jS(I);break;default:Ge=new y_(I)}return Ge.on("inited",function(){L&&L(Ge,U)}),Ge}),ae=B4(K,1),Ae=ae[0];return P0(function(){return U.addLayer(Ae),function(){U.removeLayer(Ae)}},[]),P0(function(){Ae.inited&&I&&Ae.updateLayerConfig(I)},[I==null?void 0:I.minZoom,I==null?void 0:I.maxZoom,I==null?void 0:I.visible]),P0(function(){Ae.inited&&(I==null?void 0:I.zIndex)&&Ae.setIndex(I.zIndex)},[I==null?void 0:I.zIndex]),P0(function(){Ae.inited&&(I==null?void 0:I.blend)&&Ae.setBlend(I.blend)},[I==null?void 0:I.blend]),P0(function(){U.render()}),Y.createElement(Ob.Provider,{value:Ae},Y.createElement(D4,{layer:Ae,source:t}),d&&Y.createElement(M4,{layer:Ae,scale:d}),r&&Y.createElement(w4,{layer:Ae,color:r}),l&&Y.createElement(I4,{layer:Ae,size:l}),a&&Y.createElement(O4,{layer:Ae,shape:a}),s&&Y.createElement(F4,{layer:Ae,style:s}),m&&Y.createElement(C4,{layer:Ae,active:m}),y&&Y.createElement(P4,{layer:Ae,select:y}),C&&Y.createElement(T4,{layer:Ae,filter:C}),w&&Y.createElement(A4,{layer:Ae,animate:w}),i.children)}var QI=null,JI=null,V4=Y.memo(function(i){return Rb("pointLayer",i)}),G4=Y.memo(function(i){return Rb("heatmapLayer",i)}),eR=null,tR=null,rR=null,nR=Y.useEffect,iR=null,aR=null;function Mv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Mv=function(t){return typeof t}:Mv=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mv(e)}function Lb(e,i){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);i&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Pv(e){for(var i=1;i<arguments.length;i++){var t=arguments[i]!=null?arguments[i]:{};i%2?Lb(Object(t),!0).forEach(function(r){H4(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Lb(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function H4(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function W4(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function kb(e,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function X4(e,i,t){return i&&kb(e.prototype,i),t&&kb(e,t),e}function Y4(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&Am(e,i)}function Am(e,i){return Am=Object.setPrototypeOf||function(r,a){return r.__proto__=a,r},Am(e,i)}function q4(e){var i=Q4();return function(){var r=Ov(e),a;if(i){var s=Ov(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return K4(this,a)}}function K4(e,i){if(i&&(Mv(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $4(e)}function $4(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Ov(e){return Ov=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ov(e)}var oR=function(e){Y4(t,e);var i=q4(t);function t(r){var a;return W4(this,t),a=i.call(this,r),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return X4(t,[{key:"componentDidMount",value:function(){var a,s=this.props,l=s.lnglat,d=s.children,m=s.option,y=s.lngLat,C=new oy(Pv(Pv({},m),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));l&&C.setLnglat(l),y&&C.setLnglat(y),d&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,l,d,m,y,C,w=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(l=a.lnglat)===null||l===void 0?void 0:l.lat],I=Array.isArray(this.props.lnglat)?this.props.lnglat:[(d=this.props)===null||d===void 0||(m=d.lnglat)===null||m===void 0?void 0:m.lng,(y=this.props)===null||y===void 0||(C=y.lnglat)===null||C===void 0?void 0:C.lat],L=w.toString()!==I.toString();if(L){var U;this.popup.remove(),this.popup=new oy(Pv(Pv({},this.props.option),{},{stopPropagation:(U=this.props.option)===null||U===void 0?void 0:U.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return Y.createElement(g.Consumer,{},function(s){return s&&(a.scene=s),(0,Ab.createPortal)(a.props.children,a.el)})}}]),t}(Y.PureComponent);function Iv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Iv=function(t){return typeof t}:Iv=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Iv(e)}function J4(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Db(e,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function eO(e,i,t){return i&&Db(e.prototype,i),t&&Db(e,t),e}function tO(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&wm(e,i)}function wm(e,i){return wm=Object.setPrototypeOf||function(r,a){return r.__proto__=a,r},wm(e,i)}function rO(e){var i=aO();return function(){var r=Rv(e),a;if(i){var s=Rv(this).constructor;a=Reflect.construct(r,arguments,s)}else a=r.apply(this,arguments);return nO(this,a)}}function nO(e,i){if(i&&(Iv(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return iO(e)}function iO(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function aO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Rv(e){return Rv=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Rv(e)}var sR=function(e){tO(t,e);var i=rO(t);function t(r){var a;return J4(this,t),a=i.call(this,r),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return eO(t,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,l=a.children,d=a.option,m=a.onMarkerLoaded,y=new ty(d);s&&y.setLnglat(s),l&&y.setElement(this.el),this.marker=y,m&&m(y),this.scene.addMarker(y)}},{key:"componentDidUpdate",value:function(a){var s,l=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());l&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return Y.createElement(g.Consumer,{},function(s){return s&&(a.scene=s),(0,Ab.createPortal)(a.props.children,a.el)})}}]),t}(Y.PureComponent),uR=Y.useEffect,lR=null,cR=null,fR=Y.useEffect,hR=null},66213:function(It,ie,F){"use strict";F.d(ie,{Z:function(){return g}});var J=F(77608);function Y(fe,N){for(;!Object.prototype.hasOwnProperty.call(fe,N)&&(fe=(0,J.Z)(fe),fe!==null););return fe}function g(){return typeof Reflect!="undefined"&&Reflect.get?g=Reflect.get.bind():g=function(N,oe,ne){var we=Y(N,oe);if(!!we){var re=Object.getOwnPropertyDescriptor(we,oe);return re.get?re.get.call(arguments.length<3?N:ne):re.value}},g.apply(this,arguments)}},59591:function(It,ie,F){var J=F(50008).default;function Y(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */It.exports=Y=function(){return g},It.exports.__esModule=!0,It.exports.default=It.exports;var g={},fe=Object.prototype,N=fe.hasOwnProperty,oe=typeof Symbol=="function"?Symbol:{},ne=oe.iterator||"@@iterator",we=oe.asyncIterator||"@@asyncIterator",re=oe.toStringTag||"@@toStringTag";function ke(q,pe,b){return Object.defineProperty(q,pe,{value:b,enumerable:!0,configurable:!0,writable:!0}),q[pe]}try{ke({},"")}catch(q){ke=function(b,le,xe){return b[le]=xe}}function Ve(q,pe,b,le){var xe=pe&&pe.prototype instanceof Jt?pe:Jt,Qe=Object.create(xe.prototype),xt=new ut(le||[]);return Qe._invoke=function(Bt,Fe,bt){var br="suspendedStart";return function(mr,An){if(br==="executing")throw new Error("Generator is already running");if(br==="completed"){if(mr==="throw")throw An;return Mr()}for(bt.method=mr,bt.arg=An;;){var mn=bt.delegate;if(mn){var wn=At(mn,bt);if(wn){if(wn===Je)continue;return wn}}if(bt.method==="next")bt.sent=bt._sent=bt.arg;else if(bt.method==="throw"){if(br==="suspendedStart")throw br="completed",bt.arg;bt.dispatchException(bt.arg)}else bt.method==="return"&&bt.abrupt("return",bt.arg);br="executing";var Ri=Ne(Bt,Fe,bt);if(Ri.type==="normal"){if(br=bt.done?"completed":"suspendedYield",Ri.arg===Je)continue;return{value:Ri.arg,done:bt.done}}Ri.type==="throw"&&(br="completed",bt.method="throw",bt.arg=Ri.arg)}}}(q,b,xt),Qe}function Ne(q,pe,b){try{return{type:"normal",arg:q.call(pe,b)}}catch(le){return{type:"throw",arg:le}}}g.wrap=Ve;var Je={};function Jt(){}function _t(){}function Ut(){}var Tt={};ke(Tt,ne,function(){return this});var vt=Object.getPrototypeOf,pt=vt&&vt(vt(nr([])));pt&&pt!==fe&&N.call(pt,ne)&&(Tt=pt);var Vt=Ut.prototype=Jt.prototype=Object.create(Tt);function ee(q){["next","throw","return"].forEach(function(pe){ke(q,pe,function(b){return this._invoke(pe,b)})})}function rr(q,pe){function b(xe,Qe,xt,Bt){var Fe=Ne(q[xe],q,Qe);if(Fe.type!=="throw"){var bt=Fe.arg,br=bt.value;return br&&J(br)=="object"&&N.call(br,"__await")?pe.resolve(br.__await).then(function(mr){b("next",mr,xt,Bt)},function(mr){b("throw",mr,xt,Bt)}):pe.resolve(br).then(function(mr){bt.value=mr,xt(bt)},function(mr){return b("throw",mr,xt,Bt)})}Bt(Fe.arg)}var le;this._invoke=function(xe,Qe){function xt(){return new pe(function(Bt,Fe){b(xe,Qe,Bt,Fe)})}return le=le?le.then(xt,xt):xt()}}function At(q,pe){var b=q.iterator[pe.method];if(b===void 0){if(pe.delegate=null,pe.method==="throw"){if(q.iterator.return&&(pe.method="return",pe.arg=void 0,At(q,pe),pe.method==="throw"))return Je;pe.method="throw",pe.arg=new TypeError("The iterator does not provide a 'throw' method")}return Je}var le=Ne(b,q.iterator,pe.arg);if(le.type==="throw")return pe.method="throw",pe.arg=le.arg,pe.delegate=null,Je;var xe=le.arg;return xe?xe.done?(pe[q.resultName]=xe.value,pe.next=q.nextLoc,pe.method!=="return"&&(pe.method="next",pe.arg=void 0),pe.delegate=null,Je):xe:(pe.method="throw",pe.arg=new TypeError("iterator result is not an object"),pe.delegate=null,Je)}function nt(q){var pe={tryLoc:q[0]};1 in q&&(pe.catchLoc=q[1]),2 in q&&(pe.finallyLoc=q[2],pe.afterLoc=q[3]),this.tryEntries.push(pe)}function Zt(q){var pe=q.completion||{};pe.type="normal",delete pe.arg,q.completion=pe}function ut(q){this.tryEntries=[{tryLoc:"root"}],q.forEach(nt,this),this.reset(!0)}function nr(q){if(q){var pe=q[ne];if(pe)return pe.call(q);if(typeof q.next=="function")return q;if(!isNaN(q.length)){var b=-1,le=function xe(){for(;++b<q.length;)if(N.call(q,b))return xe.value=q[b],xe.done=!1,xe;return xe.value=void 0,xe.done=!0,xe};return le.next=le}}return{next:Mr}}function Mr(){return{value:void 0,done:!0}}return _t.prototype=Ut,ke(Vt,"constructor",Ut),ke(Ut,"constructor",_t),_t.displayName=ke(Ut,re,"GeneratorFunction"),g.isGeneratorFunction=function(q){var pe=typeof q=="function"&&q.constructor;return!!pe&&(pe===_t||(pe.displayName||pe.name)==="GeneratorFunction")},g.mark=function(q){return Object.setPrototypeOf?Object.setPrototypeOf(q,Ut):(q.__proto__=Ut,ke(q,re,"GeneratorFunction")),q.prototype=Object.create(Vt),q},g.awrap=function(q){return{__await:q}},ee(rr.prototype),ke(rr.prototype,we,function(){return this}),g.AsyncIterator=rr,g.async=function(q,pe,b,le,xe){xe===void 0&&(xe=Promise);var Qe=new rr(Ve(q,pe,b,le),xe);return g.isGeneratorFunction(pe)?Qe:Qe.next().then(function(xt){return xt.done?xt.value:Qe.next()})},ee(Vt),ke(Vt,re,"Generator"),ke(Vt,ne,function(){return this}),ke(Vt,"toString",function(){return"[object Generator]"}),g.keys=function(q){var pe=[];for(var b in q)pe.push(b);return pe.reverse(),function le(){for(;pe.length;){var xe=pe.pop();if(xe in q)return le.value=xe,le.done=!1,le}return le.done=!0,le}},g.values=nr,ut.prototype={constructor:ut,reset:function(pe){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(Zt),!pe)for(var b in this)b.charAt(0)==="t"&&N.call(this,b)&&!isNaN(+b.slice(1))&&(this[b]=void 0)},stop:function(){this.done=!0;var pe=this.tryEntries[0].completion;if(pe.type==="throw")throw pe.arg;return this.rval},dispatchException:function(pe){if(this.done)throw pe;var b=this;function le(bt,br){return xt.type="throw",xt.arg=pe,b.next=bt,br&&(b.method="next",b.arg=void 0),!!br}for(var xe=this.tryEntries.length-1;xe>=0;--xe){var Qe=this.tryEntries[xe],xt=Qe.completion;if(Qe.tryLoc==="root")return le("end");if(Qe.tryLoc<=this.prev){var Bt=N.call(Qe,"catchLoc"),Fe=N.call(Qe,"finallyLoc");if(Bt&&Fe){if(this.prev<Qe.catchLoc)return le(Qe.catchLoc,!0);if(this.prev<Qe.finallyLoc)return le(Qe.finallyLoc)}else if(Bt){if(this.prev<Qe.catchLoc)return le(Qe.catchLoc,!0)}else{if(!Fe)throw new Error("try statement without catch or finally");if(this.prev<Qe.finallyLoc)return le(Qe.finallyLoc)}}}},abrupt:function(pe,b){for(var le=this.tryEntries.length-1;le>=0;--le){var xe=this.tryEntries[le];if(xe.tryLoc<=this.prev&&N.call(xe,"finallyLoc")&&this.prev<xe.finallyLoc){var Qe=xe;break}}Qe&&(pe==="break"||pe==="continue")&&Qe.tryLoc<=b&&b<=Qe.finallyLoc&&(Qe=null);var xt=Qe?Qe.completion:{};return xt.type=pe,xt.arg=b,Qe?(this.method="next",this.next=Qe.finallyLoc,Je):this.complete(xt)},complete:function(pe,b){if(pe.type==="throw")throw pe.arg;return pe.type==="break"||pe.type==="continue"?this.next=pe.arg:pe.type==="return"?(this.rval=this.arg=pe.arg,this.method="return",this.next="end"):pe.type==="normal"&&b&&(this.next=b),Je},finish:function(pe){for(var b=this.tryEntries.length-1;b>=0;--b){var le=this.tryEntries[b];if(le.finallyLoc===pe)return this.complete(le.completion,le.afterLoc),Zt(le),Je}},catch:function(pe){for(var b=this.tryEntries.length-1;b>=0;--b){var le=this.tryEntries[b];if(le.tryLoc===pe){var xe=le.completion;if(xe.type==="throw"){var Qe=xe.arg;Zt(le)}return Qe}}throw new Error("illegal catch attempt")},delegateYield:function(pe,b,le){return this.delegate={iterator:nr(pe),resultName:b,nextLoc:le},this.method==="next"&&(this.arg=void 0),Je}},g}It.exports=Y,It.exports.__esModule=!0,It.exports.default=It.exports},87757:function(It,ie,F){var J=F(59591)();It.exports=J;try{regeneratorRuntime=J}catch(Y){typeof globalThis=="object"?globalThis.regeneratorRuntime=J:Function("r","regeneratorRuntime = r")(J)}},31795:function(It,ie,F){var J=F(75752);It.exports.geometry=Y,It.exports.ring=fe;function Y(oe){var ne=0,we;switch(oe.type){case"Polygon":return g(oe.coordinates);case"MultiPolygon":for(we=0;we<oe.coordinates.length;we++)ne+=g(oe.coordinates[we]);return ne;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(we=0;we<oe.geometries.length;we++)ne+=Y(oe.geometries[we]);return ne}}function g(oe){var ne=0;if(oe&&oe.length>0){ne+=Math.abs(fe(oe[0]));for(var we=1;we<oe.length;we++)ne-=Math.abs(fe(oe[we]))}return ne}function fe(oe){var ne,we,re,ke,Ve,Ne,Je,Jt=0,_t=oe.length;if(_t>2){for(Je=0;Je<_t;Je++)Je===_t-2?(ke=_t-2,Ve=_t-1,Ne=0):Je===_t-1?(ke=_t-1,Ve=0,Ne=1):(ke=Je,Ve=Je+1,Ne=Je+2),ne=oe[ke],we=oe[Ve],re=oe[Ne],Jt+=(N(re[0])-N(ne[0]))*Math.sin(N(we[1]));Jt=Jt*J.RADIUS*J.RADIUS/2}return Jt}function N(oe){return oe*Math.PI/180}},38163:function(It,ie,F){var J=F(31795);It.exports=Y;function Y(we,re){switch(we&&we.type||null){case"FeatureCollection":return we.features=we.features.map(g(Y,re)),we;case"GeometryCollection":return we.geometries=we.geometries.map(g(Y,re)),we;case"Feature":return we.geometry=Y(we.geometry,re),we;case"Polygon":case"MultiPolygon":return fe(we,re);default:return we}}function g(we,re){return function(ke){return we(ke,re)}}function fe(we,re){return we.type==="Polygon"?we.coordinates=N(we.coordinates,re):we.type==="MultiPolygon"&&(we.coordinates=we.coordinates.map(g(N,re))),we}function N(we,re){re=!!re,we[0]=oe(we[0],re);for(var ke=1;ke<we.length;ke++)we[ke]=oe(we[ke],!re);return we}function oe(we,re){return ne(we)===re?we:we.reverse()}function ne(we){return J.ring(we)>=0}},75550:function(It){"use strict";It.exports=ie;function ie(F,J){this.x=F,this.y=J}ie.prototype={clone:function(){return new ie(this.x,this.y)},add:function(F){return this.clone()._add(F)},sub:function(F){return this.clone()._sub(F)},multByPoint:function(F){return this.clone()._multByPoint(F)},divByPoint:function(F){return this.clone()._divByPoint(F)},mult:function(F){return this.clone()._mult(F)},div:function(F){return this.clone()._div(F)},rotate:function(F){return this.clone()._rotate(F)},rotateAround:function(F,J){return this.clone()._rotateAround(F,J)},matMult:function(F){return this.clone()._matMult(F)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(F){return this.x===F.x&&this.y===F.y},dist:function(F){return Math.sqrt(this.distSqr(F))},distSqr:function(F){var J=F.x-this.x,Y=F.y-this.y;return J*J+Y*Y},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(F){return Math.atan2(this.y-F.y,this.x-F.x)},angleWith:function(F){return this.angleWithSep(F.x,F.y)},angleWithSep:function(F,J){return Math.atan2(this.x*J-this.y*F,this.x*F+this.y*J)},_matMult:function(F){var J=F[0]*this.x+F[1]*this.y,Y=F[2]*this.x+F[3]*this.y;return this.x=J,this.y=Y,this},_add:function(F){return this.x+=F.x,this.y+=F.y,this},_sub:function(F){return this.x-=F.x,this.y-=F.y,this},_mult:function(F){return this.x*=F,this.y*=F,this},_div:function(F){return this.x/=F,this.y/=F,this},_multByPoint:function(F){return this.x*=F.x,this.y*=F.y,this},_divByPoint:function(F){return this.x/=F.x,this.y/=F.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var F=this.y;return this.y=this.x,this.x=-F,this},_rotate:function(F){var J=Math.cos(F),Y=Math.sin(F),g=J*this.x-Y*this.y,fe=Y*this.x+J*this.y;return this.x=g,this.y=fe,this},_rotateAround:function(F,J){var Y=Math.cos(F),g=Math.sin(F),fe=J.x+Y*(this.x-J.x)-g*(this.y-J.y),N=J.y+g*(this.x-J.x)+Y*(this.y-J.y);return this.x=fe,this.y=N,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ie.convert=function(F){return F instanceof ie?F:Array.isArray(F)?new ie(F[0],F[1]):F}},38929:function(It,ie,F){It.exports.VectorTile=F(22779),F(66024),F(59701)},22779:function(It,ie,F){"use strict";var J=F(59701);It.exports=Y;function Y(fe,N){this.layers=fe.readFields(g,{},N)}function g(fe,N,oe){if(fe===3){var ne=new J(oe,oe.readVarint()+oe.pos);ne.length&&(N[ne.name]=ne)}}},66024:function(It,ie,F){"use strict";var J=F(75550);It.exports=Y;function Y(ne,we,re,ke,Ve){this.properties={},this.extent=re,this.type=0,this._pbf=ne,this._geometry=-1,this._keys=ke,this._values=Ve,ne.readFields(g,this,we)}function g(ne,we,re){ne==1?we.id=re.readVarint():ne==2?fe(re,we):ne==3?we.type=re.readVarint():ne==4&&(we._geometry=re.pos)}function fe(ne,we){for(var re=ne.readVarint()+ne.pos;ne.pos<re;){var ke=we._keys[ne.readVarint()],Ve=we._values[ne.readVarint()];we.properties[ke]=Ve}}Y.types=["Unknown","Point","LineString","Polygon"],Y.prototype.loadGeometry=function(){var ne=this._pbf;ne.pos=this._geometry;for(var we=ne.readVarint()+ne.pos,re=1,ke=0,Ve=0,Ne=0,Je=[],Jt;ne.pos<we;){if(ke<=0){var _t=ne.readVarint();re=_t&7,ke=_t>>3}if(ke--,re===1||re===2)Ve+=ne.readSVarint(),Ne+=ne.readSVarint(),re===1&&(Jt&&Je.push(Jt),Jt=[]),Jt.push(new J(Ve,Ne));else if(re===7)Jt&&Jt.push(Jt[0].clone());else throw new Error("unknown command "+re)}return Jt&&Je.push(Jt),Je},Y.prototype.bbox=function(){var ne=this._pbf;ne.pos=this._geometry;for(var we=ne.readVarint()+ne.pos,re=1,ke=0,Ve=0,Ne=0,Je=Infinity,Jt=-Infinity,_t=Infinity,Ut=-Infinity;ne.pos<we;){if(ke<=0){var Tt=ne.readVarint();re=Tt&7,ke=Tt>>3}if(ke--,re===1||re===2)Ve+=ne.readSVarint(),Ne+=ne.readSVarint(),Ve<Je&&(Je=Ve),Ve>Jt&&(Jt=Ve),Ne<_t&&(_t=Ne),Ne>Ut&&(Ut=Ne);else if(re!==7)throw new Error("unknown command "+re)}return[Je,_t,Jt,Ut]},Y.prototype.toGeoJSON=function(ne,we,re){var ke=this.extent*Math.pow(2,re),Ve=this.extent*ne,Ne=this.extent*we,Je=this.loadGeometry(),Jt=Y.types[this.type],_t,Ut;function Tt(Vt){for(var ee=0;ee<Vt.length;ee++){var rr=Vt[ee],At=180-(rr.y+Ne)*360/ke;Vt[ee]=[(rr.x+Ve)*360/ke-180,360/Math.PI*Math.atan(Math.exp(At*Math.PI/180))-90]}}switch(this.type){case 1:var vt=[];for(_t=0;_t<Je.length;_t++)vt[_t]=Je[_t][0];Je=vt,Tt(Je);break;case 2:for(_t=0;_t<Je.length;_t++)Tt(Je[_t]);break;case 3:for(Je=N(Je),_t=0;_t<Je.length;_t++)for(Ut=0;Ut<Je[_t].length;Ut++)Tt(Je[_t][Ut]);break}Je.length===1?Je=Je[0]:Jt="Multi"+Jt;var pt={type:"Feature",geometry:{type:Jt,coordinates:Je},properties:this.properties};return"id"in this&&(pt.id=this.id),pt};function N(ne){var we=ne.length;if(we<=1)return[ne];for(var re=[],ke,Ve,Ne=0;Ne<we;Ne++){var Je=oe(ne[Ne]);Je!==0&&(Ve===void 0&&(Ve=Je<0),Ve===Je<0?(ke&&re.push(ke),ke=[ne[Ne]]):ke.push(ne[Ne]))}return ke&&re.push(ke),re}function oe(ne){for(var we=0,re=0,ke=ne.length,Ve=ke-1,Ne,Je;re<ke;Ve=re++)Ne=ne[re],Je=ne[Ve],we+=(Je.x-Ne.x)*(Ne.y+Je.y);return we}},59701:function(It,ie,F){"use strict";var J=F(66024);It.exports=Y;function Y(N,oe){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=N,this._keys=[],this._values=[],this._features=[],N.readFields(g,this,oe),this.length=this._features.length}function g(N,oe,ne){N===15?oe.version=ne.readVarint():N===1?oe.name=ne.readString():N===5?oe.extent=ne.readVarint():N===2?oe._features.push(ne.pos):N===3?oe._keys.push(ne.readString()):N===4&&oe._values.push(fe(ne))}function fe(N){for(var oe=null,ne=N.readVarint()+N.pos;N.pos<ne;){var we=N.readVarint()>>3;oe=we===1?N.readString():we===2?N.readFloat():we===3?N.readDouble():we===4?N.readVarint64():we===5?N.readVarint():we===6?N.readSVarint():we===7?N.readBoolean():null}return oe}Y.prototype.feature=function(N){if(N<0||N>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[N];var oe=this._pbf.readVarint()+this._pbf.pos;return new J(this._pbf,oe,this.extent,this._keys,this._values)}},53645:function(){},3054:function(It,ie,F){"use strict";F.r(ie),F.d(ie,{color:function(){return J.ZP},cubehelix:function(){return xt},gray:function(){return Jt},hcl:function(){return At},hsl:function(){return J.Ym},lab:function(){return _t},lch:function(){return rr},rgb:function(){return J.B8}});var J=F(16372),Y=F(44087),g=Math.PI/180,fe=180/Math.PI,N=18,oe=.96422,ne=1,we=.82521,re=4/29,ke=6/29,Ve=3*ke*ke,Ne=ke*ke*ke;function Je(Fe){if(Fe instanceof Ut)return new Ut(Fe.l,Fe.a,Fe.b,Fe.opacity);if(Fe instanceof nt)return Zt(Fe);Fe instanceof J.Ss||(Fe=(0,J.SU)(Fe));var bt=Vt(Fe.r),br=Vt(Fe.g),mr=Vt(Fe.b),An=Tt((.2225045*bt+.7168786*br+.0606169*mr)/ne),mn,wn;return bt===br&&br===mr?mn=wn=An:(mn=Tt((.4360747*bt+.3850649*br+.1430804*mr)/oe),wn=Tt((.0139322*bt+.0971045*br+.7141733*mr)/we)),new Ut(116*An-16,500*(mn-An),200*(An-wn),Fe.opacity)}function Jt(Fe,bt){return new Ut(Fe,0,0,bt==null?1:bt)}function _t(Fe,bt,br,mr){return arguments.length===1?Je(Fe):new Ut(Fe,bt,br,mr==null?1:mr)}function Ut(Fe,bt,br,mr){this.l=+Fe,this.a=+bt,this.b=+br,this.opacity=+mr}(0,Y.Z)(Ut,_t,(0,Y.l)(J.Il,{brighter:function(Fe){return new Ut(this.l+N*(Fe==null?1:Fe),this.a,this.b,this.opacity)},darker:function(Fe){return new Ut(this.l-N*(Fe==null?1:Fe),this.a,this.b,this.opacity)},rgb:function(){var Fe=(this.l+16)/116,bt=isNaN(this.a)?Fe:Fe+this.a/500,br=isNaN(this.b)?Fe:Fe-this.b/200;return bt=oe*vt(bt),Fe=ne*vt(Fe),br=we*vt(br),new J.Ss(pt(3.1338561*bt-1.6168667*Fe-.4906146*br),pt(-.9787684*bt+1.9161415*Fe+.033454*br),pt(.0719453*bt-.2289914*Fe+1.4052427*br),this.opacity)}}));function Tt(Fe){return Fe>Ne?Math.pow(Fe,1/3):Fe/Ve+re}function vt(Fe){return Fe>ke?Fe*Fe*Fe:Ve*(Fe-re)}function pt(Fe){return 255*(Fe<=.0031308?12.92*Fe:1.055*Math.pow(Fe,1/2.4)-.055)}function Vt(Fe){return(Fe/=255)<=.04045?Fe/12.92:Math.pow((Fe+.055)/1.055,2.4)}function ee(Fe){if(Fe instanceof nt)return new nt(Fe.h,Fe.c,Fe.l,Fe.opacity);if(Fe instanceof Ut||(Fe=Je(Fe)),Fe.a===0&&Fe.b===0)return new nt(NaN,0<Fe.l&&Fe.l<100?0:NaN,Fe.l,Fe.opacity);var bt=Math.atan2(Fe.b,Fe.a)*fe;return new nt(bt<0?bt+360:bt,Math.sqrt(Fe.a*Fe.a+Fe.b*Fe.b),Fe.l,Fe.opacity)}function rr(Fe,bt,br,mr){return arguments.length===1?ee(Fe):new nt(br,bt,Fe,mr==null?1:mr)}function At(Fe,bt,br,mr){return arguments.length===1?ee(Fe):new nt(Fe,bt,br,mr==null?1:mr)}function nt(Fe,bt,br,mr){this.h=+Fe,this.c=+bt,this.l=+br,this.opacity=+mr}function Zt(Fe){if(isNaN(Fe.h))return new Ut(Fe.l,0,0,Fe.opacity);var bt=Fe.h*g;return new Ut(Fe.l,Math.cos(bt)*Fe.c,Math.sin(bt)*Fe.c,Fe.opacity)}(0,Y.Z)(nt,At,(0,Y.l)(J.Il,{brighter:function(Fe){return new nt(this.h,this.c,this.l+N*(Fe==null?1:Fe),this.opacity)},darker:function(Fe){return new nt(this.h,this.c,this.l-N*(Fe==null?1:Fe),this.opacity)},rgb:function(){return Zt(this).rgb()}}));var ut=-.14861,nr=1.78277,Mr=-.29227,q=-.90649,pe=1.97294,b=pe*q,le=pe*nr,xe=nr*Mr-q*ut;function Qe(Fe){if(Fe instanceof Bt)return new Bt(Fe.h,Fe.s,Fe.l,Fe.opacity);Fe instanceof J.Ss||(Fe=(0,J.SU)(Fe));var bt=Fe.r/255,br=Fe.g/255,mr=Fe.b/255,An=(xe*mr+b*bt-le*br)/(xe+b-le),mn=mr-An,wn=(pe*(br-An)-Mr*mn)/q,Ri=Math.sqrt(wn*wn+mn*mn)/(pe*An*(1-An)),Qn=Ri?Math.atan2(wn,mn)*fe-120:NaN;return new Bt(Qn<0?Qn+360:Qn,Ri,An,Fe.opacity)}function xt(Fe,bt,br,mr){return arguments.length===1?Qe(Fe):new Bt(Fe,bt,br,mr==null?1:mr)}function Bt(Fe,bt,br,mr){this.h=+Fe,this.s=+bt,this.l=+br,this.opacity=+mr}(0,Y.Z)(Bt,xt,(0,Y.l)(J.Il,{brighter:function(Fe){return Fe=Fe==null?J.J5:Math.pow(J.J5,Fe),new Bt(this.h,this.s,this.l*Fe,this.opacity)},darker:function(Fe){return Fe=Fe==null?J.xV:Math.pow(J.xV,Fe),new Bt(this.h,this.s,this.l*Fe,this.opacity)},rgb:function(){var Fe=isNaN(this.h)?0:(this.h+120)*g,bt=+this.l,br=isNaN(this.s)?0:this.s*bt*(1-bt),mr=Math.cos(Fe),An=Math.sin(Fe);return new J.Ss(255*(bt+br*(ut*mr+nr*An)),255*(bt+br*(Mr*mr+q*An)),255*(bt+br*(pe*mr)),this.opacity)}}))},9187:function(It){"use strict";It.exports=ie,It.exports.default=ie;function ie(b,le,xe){xe=xe||2;var Qe=le&&le.length,xt=Qe?le[0]*xe:b.length,Bt=F(b,0,xt,xe,!0),Fe=[];if(!Bt||Bt.next===Bt.prev)return Fe;var bt,br,mr,An,mn,wn,Ri;if(Qe&&(Bt=ne(b,le,Bt,xe)),b.length>80*xe){bt=mr=b[0],br=An=b[1];for(var Qn=xe;Qn<xt;Qn+=xe)mn=b[Qn],wn=b[Qn+1],mn<bt&&(bt=mn),wn<br&&(br=wn),mn>mr&&(mr=mn),wn>An&&(An=wn);Ri=Math.max(mr-bt,An-br),Ri=Ri!==0?32767/Ri:0}return Y(Bt,Fe,xe,bt,br,Ri,0),Fe}function F(b,le,xe,Qe,xt){var Bt,Fe;if(xt===pe(b,le,xe,Qe)>0)for(Bt=le;Bt<xe;Bt+=Qe)Fe=nr(Bt,b[Bt],b[Bt+1],Fe);else for(Bt=xe-Qe;Bt>=le;Bt-=Qe)Fe=nr(Bt,b[Bt],b[Bt+1],Fe);return Fe&&pt(Fe,Fe.next)&&(Mr(Fe),Fe=Fe.next),Fe}function J(b,le){if(!b)return b;le||(le=b);var xe=b,Qe;do if(Qe=!1,!xe.steiner&&(pt(xe,xe.next)||vt(xe.prev,xe,xe.next)===0)){if(Mr(xe),xe=le=xe.prev,xe===xe.next)break;Qe=!0}else xe=xe.next;while(Qe||xe!==le);return le}function Y(b,le,xe,Qe,xt,Bt,Fe){if(!!b){!Fe&&Bt&&Ne(b,Qe,xt,Bt);for(var bt=b,br,mr;b.prev!==b.next;){if(br=b.prev,mr=b.next,Bt?fe(b,Qe,xt,Bt):g(b)){le.push(br.i/xe|0),le.push(b.i/xe|0),le.push(mr.i/xe|0),Mr(b),b=mr.next,bt=mr.next;continue}if(b=mr,b===bt){Fe?Fe===1?(b=N(J(b),le,xe),Y(b,le,xe,Qe,xt,Bt,2)):Fe===2&&oe(b,le,xe,Qe,xt,Bt):Y(J(b),le,xe,Qe,xt,Bt,1);break}}}}function g(b){var le=b.prev,xe=b,Qe=b.next;if(vt(le,xe,Qe)>=0)return!1;for(var xt=le.x,Bt=xe.x,Fe=Qe.x,bt=le.y,br=xe.y,mr=Qe.y,An=xt<Bt?xt<Fe?xt:Fe:Bt<Fe?Bt:Fe,mn=bt<br?bt<mr?bt:mr:br<mr?br:mr,wn=xt>Bt?xt>Fe?xt:Fe:Bt>Fe?Bt:Fe,Ri=bt>br?bt>mr?bt:mr:br>mr?br:mr,Qn=Qe.next;Qn!==le;){if(Qn.x>=An&&Qn.x<=wn&&Qn.y>=mn&&Qn.y<=Ri&&Ut(xt,bt,Bt,br,Fe,mr,Qn.x,Qn.y)&&vt(Qn.prev,Qn,Qn.next)>=0)return!1;Qn=Qn.next}return!0}function fe(b,le,xe,Qe){var xt=b.prev,Bt=b,Fe=b.next;if(vt(xt,Bt,Fe)>=0)return!1;for(var bt=xt.x,br=Bt.x,mr=Fe.x,An=xt.y,mn=Bt.y,wn=Fe.y,Ri=bt<br?bt<mr?bt:mr:br<mr?br:mr,Qn=An<mn?An<wn?An:wn:mn<wn?mn:wn,ii=bt>br?bt>mr?bt:mr:br>mr?br:mr,Vi=An>mn?An>wn?An:wn:mn>wn?mn:wn,Ni=Jt(Ri,Qn,le,xe,Qe),ai=Jt(ii,Vi,le,xe,Qe),Vn=b.prevZ,Yn=b.nextZ;Vn&&Vn.z>=Ni&&Yn&&Yn.z<=ai;){if(Vn.x>=Ri&&Vn.x<=ii&&Vn.y>=Qn&&Vn.y<=Vi&&Vn!==xt&&Vn!==Fe&&Ut(bt,An,br,mn,mr,wn,Vn.x,Vn.y)&&vt(Vn.prev,Vn,Vn.next)>=0||(Vn=Vn.prevZ,Yn.x>=Ri&&Yn.x<=ii&&Yn.y>=Qn&&Yn.y<=Vi&&Yn!==xt&&Yn!==Fe&&Ut(bt,An,br,mn,mr,wn,Yn.x,Yn.y)&&vt(Yn.prev,Yn,Yn.next)>=0))return!1;Yn=Yn.nextZ}for(;Vn&&Vn.z>=Ni;){if(Vn.x>=Ri&&Vn.x<=ii&&Vn.y>=Qn&&Vn.y<=Vi&&Vn!==xt&&Vn!==Fe&&Ut(bt,An,br,mn,mr,wn,Vn.x,Vn.y)&&vt(Vn.prev,Vn,Vn.next)>=0)return!1;Vn=Vn.prevZ}for(;Yn&&Yn.z<=ai;){if(Yn.x>=Ri&&Yn.x<=ii&&Yn.y>=Qn&&Yn.y<=Vi&&Yn!==xt&&Yn!==Fe&&Ut(bt,An,br,mn,mr,wn,Yn.x,Yn.y)&&vt(Yn.prev,Yn,Yn.next)>=0)return!1;Yn=Yn.nextZ}return!0}function N(b,le,xe){var Qe=b;do{var xt=Qe.prev,Bt=Qe.next.next;!pt(xt,Bt)&&Vt(xt,Qe,Qe.next,Bt)&&nt(xt,Bt)&&nt(Bt,xt)&&(le.push(xt.i/xe|0),le.push(Qe.i/xe|0),le.push(Bt.i/xe|0),Mr(Qe),Mr(Qe.next),Qe=b=Bt),Qe=Qe.next}while(Qe!==b);return J(Qe)}function oe(b,le,xe,Qe,xt,Bt){var Fe=b;do{for(var bt=Fe.next.next;bt!==Fe.prev;){if(Fe.i!==bt.i&&Tt(Fe,bt)){var br=ut(Fe,bt);Fe=J(Fe,Fe.next),br=J(br,br.next),Y(Fe,le,xe,Qe,xt,Bt,0),Y(br,le,xe,Qe,xt,Bt,0);return}bt=bt.next}Fe=Fe.next}while(Fe!==b)}function ne(b,le,xe,Qe){var xt=[],Bt,Fe,bt,br,mr;for(Bt=0,Fe=le.length;Bt<Fe;Bt++)bt=le[Bt]*Qe,br=Bt<Fe-1?le[Bt+1]*Qe:b.length,mr=F(b,bt,br,Qe,!1),mr===mr.next&&(mr.steiner=!0),xt.push(_t(mr));for(xt.sort(we),Bt=0;Bt<xt.length;Bt++)xe=re(xt[Bt],xe);return xe}function we(b,le){return b.x-le.x}function re(b,le){var xe=ke(b,le);if(!xe)return le;var Qe=ut(xe,b);return J(Qe,Qe.next),J(xe,xe.next)}function ke(b,le){var xe=le,Qe=b.x,xt=b.y,Bt=-Infinity,Fe;do{if(xt<=xe.y&&xt>=xe.next.y&&xe.next.y!==xe.y){var bt=xe.x+(xt-xe.y)*(xe.next.x-xe.x)/(xe.next.y-xe.y);if(bt<=Qe&&bt>Bt&&(Bt=bt,Fe=xe.x<xe.next.x?xe:xe.next,bt===Qe))return Fe}xe=xe.next}while(xe!==le);if(!Fe)return null;var br=Fe,mr=Fe.x,An=Fe.y,mn=Infinity,wn;xe=Fe;do Qe>=xe.x&&xe.x>=mr&&Qe!==xe.x&&Ut(xt<An?Qe:Bt,xt,mr,An,xt<An?Bt:Qe,xt,xe.x,xe.y)&&(wn=Math.abs(xt-xe.y)/(Qe-xe.x),nt(xe,b)&&(wn<mn||wn===mn&&(xe.x>Fe.x||xe.x===Fe.x&&Ve(Fe,xe)))&&(Fe=xe,mn=wn)),xe=xe.next;while(xe!==br);return Fe}function Ve(b,le){return vt(b.prev,b,le.prev)<0&&vt(le.next,b,b.next)<0}function Ne(b,le,xe,Qe){var xt=b;do xt.z===0&&(xt.z=Jt(xt.x,xt.y,le,xe,Qe)),xt.prevZ=xt.prev,xt.nextZ=xt.next,xt=xt.next;while(xt!==b);xt.prevZ.nextZ=null,xt.prevZ=null,Je(xt)}function Je(b){var le,xe,Qe,xt,Bt,Fe,bt,br,mr=1;do{for(xe=b,b=null,Bt=null,Fe=0;xe;){for(Fe++,Qe=xe,bt=0,le=0;le<mr&&(bt++,Qe=Qe.nextZ,!!Qe);le++);for(br=mr;bt>0||br>0&&Qe;)bt!==0&&(br===0||!Qe||xe.z<=Qe.z)?(xt=xe,xe=xe.nextZ,bt--):(xt=Qe,Qe=Qe.nextZ,br--),Bt?Bt.nextZ=xt:b=xt,xt.prevZ=Bt,Bt=xt;xe=Qe}Bt.nextZ=null,mr*=2}while(Fe>1);return b}function Jt(b,le,xe,Qe,xt){return b=(b-xe)*xt|0,le=(le-Qe)*xt|0,b=(b|b<<8)&16711935,b=(b|b<<4)&252645135,b=(b|b<<2)&858993459,b=(b|b<<1)&1431655765,le=(le|le<<8)&16711935,le=(le|le<<4)&252645135,le=(le|le<<2)&858993459,le=(le|le<<1)&1431655765,b|le<<1}function _t(b){var le=b,xe=b;do(le.x<xe.x||le.x===xe.x&&le.y<xe.y)&&(xe=le),le=le.next;while(le!==b);return xe}function Ut(b,le,xe,Qe,xt,Bt,Fe,bt){return(xt-Fe)*(le-bt)>=(b-Fe)*(Bt-bt)&&(b-Fe)*(Qe-bt)>=(xe-Fe)*(le-bt)&&(xe-Fe)*(Bt-bt)>=(xt-Fe)*(Qe-bt)}function Tt(b,le){return b.next.i!==le.i&&b.prev.i!==le.i&&!At(b,le)&&(nt(b,le)&&nt(le,b)&&Zt(b,le)&&(vt(b.prev,b,le.prev)||vt(b,le.prev,le))||pt(b,le)&&vt(b.prev,b,b.next)>0&&vt(le.prev,le,le.next)>0)}function vt(b,le,xe){return(le.y-b.y)*(xe.x-le.x)-(le.x-b.x)*(xe.y-le.y)}function pt(b,le){return b.x===le.x&&b.y===le.y}function Vt(b,le,xe,Qe){var xt=rr(vt(b,le,xe)),Bt=rr(vt(b,le,Qe)),Fe=rr(vt(xe,Qe,b)),bt=rr(vt(xe,Qe,le));return!!(xt!==Bt&&Fe!==bt||xt===0&&ee(b,xe,le)||Bt===0&&ee(b,Qe,le)||Fe===0&&ee(xe,b,Qe)||bt===0&&ee(xe,le,Qe))}function ee(b,le,xe){return le.x<=Math.max(b.x,xe.x)&&le.x>=Math.min(b.x,xe.x)&&le.y<=Math.max(b.y,xe.y)&&le.y>=Math.min(b.y,xe.y)}function rr(b){return b>0?1:b<0?-1:0}function At(b,le){var xe=b;do{if(xe.i!==b.i&&xe.next.i!==b.i&&xe.i!==le.i&&xe.next.i!==le.i&&Vt(xe,xe.next,b,le))return!0;xe=xe.next}while(xe!==b);return!1}function nt(b,le){return vt(b.prev,b,b.next)<0?vt(b,le,b.next)>=0&&vt(b,b.prev,le)>=0:vt(b,le,b.prev)<0||vt(b,b.next,le)<0}function Zt(b,le){var xe=b,Qe=!1,xt=(b.x+le.x)/2,Bt=(b.y+le.y)/2;do xe.y>Bt!=xe.next.y>Bt&&xe.next.y!==xe.y&&xt<(xe.next.x-xe.x)*(Bt-xe.y)/(xe.next.y-xe.y)+xe.x&&(Qe=!Qe),xe=xe.next;while(xe!==b);return Qe}function ut(b,le){var xe=new q(b.i,b.x,b.y),Qe=new q(le.i,le.x,le.y),xt=b.next,Bt=le.prev;return b.next=le,le.prev=b,xe.next=xt,xt.prev=xe,Qe.next=xe,xe.prev=Qe,Bt.next=Qe,Qe.prev=Bt,Qe}function nr(b,le,xe,Qe){var xt=new q(b,le,xe);return Qe?(xt.next=Qe.next,xt.prev=Qe,Qe.next.prev=xt,Qe.next=xt):(xt.prev=xt,xt.next=xt),xt}function Mr(b){b.next.prev=b.prev,b.prev.next=b.next,b.prevZ&&(b.prevZ.nextZ=b.nextZ),b.nextZ&&(b.nextZ.prevZ=b.prevZ)}function q(b,le,xe){this.i=b,this.x=le,this.y=xe,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ie.deviation=function(b,le,xe,Qe){var xt=le&&le.length,Bt=xt?le[0]*xe:b.length,Fe=Math.abs(pe(b,0,Bt,xe));if(xt)for(var bt=0,br=le.length;bt<br;bt++){var mr=le[bt]*xe,An=bt<br-1?le[bt+1]*xe:b.length;Fe-=Math.abs(pe(b,mr,An,xe))}var mn=0;for(bt=0;bt<Qe.length;bt+=3){var wn=Qe[bt]*xe,Ri=Qe[bt+1]*xe,Qn=Qe[bt+2]*xe;mn+=Math.abs((b[wn]-b[Qn])*(b[Ri+1]-b[wn+1])-(b[wn]-b[Ri])*(b[Qn+1]-b[wn+1]))}return Fe===0&&mn===0?0:Math.abs((mn-Fe)/Fe)};function pe(b,le,xe,Qe){for(var xt=0,Bt=le,Fe=xe-Qe;Bt<xe;Bt+=Qe)xt+=(b[Fe]-b[Bt])*(b[Bt+1]+b[Fe+1]),Fe=Bt;return xt}ie.flatten=function(b){for(var le=b[0][0].length,xe={vertices:[],holes:[],dimensions:le},Qe=0,xt=0;xt<b.length;xt++){for(var Bt=0;Bt<b[xt].length;Bt++)for(var Fe=0;Fe<le;Fe++)xe.vertices.push(b[xt][Bt][Fe]);xt>0&&(Qe+=b[xt-1].length,xe.holes.push(Qe))}return xe}},67709:function(It){function ie(J){var Y=J.target||J.srcElement;Y.__resizeRAF__&&cancelAnimationFrame(Y.__resizeRAF__),Y.__resizeRAF__=requestAnimationFrame(function(){var g=Y.__resizeTrigger__,fe=g&&g.__resizeListeners__;fe&&fe.forEach(function(N){N.call(g,J)})})}var F=function(Y,g){var fe=this,N=fe.document,oe,ne=N.attachEvent;typeof navigator!="undefined"&&(oe=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function we(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",ie)}if(!Y.__resizeListeners__)if(Y.__resizeListeners__=[],ne)Y.__resizeTrigger__=Y,Y.attachEvent("onresize",ie);else{getComputedStyle(Y).position==="static"&&(Y.style.position="relative");var re=Y.__resizeTrigger__=N.createElement("object");re.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),re.setAttribute("class","resize-sensor"),re.setAttribute("tabindex","-1"),re.setAttribute("title",""),re.__resizeElement__=Y,re.onload=we,re.type="text/html",oe&&Y.appendChild(re),re.data="about:blank",oe||Y.appendChild(re)}Y.__resizeListeners__.push(g)};It.exports=typeof window=="undefined"?F:F.bind(window),It.exports.unbind=function(J,Y){var g=document.attachEvent,fe=J.__resizeListeners__||[];if(Y){var N=fe.indexOf(Y);N!==-1&&fe.splice(N,1)}else fe=J.__resizeListeners__=[];if(!fe.length){if(g)J.detachEvent("onresize",ie);else if(J.__resizeTrigger__){var oe=J.__resizeTrigger__.contentDocument,ne=oe&&oe.defaultView;ne&&(ne.removeEventListener("resize",ie),delete ne.__resizeTrigger__),J.__resizeTrigger__=!J.removeChild(J.__resizeTrigger__)}delete J.__resizeListeners__}}},26729:function(It){"use strict";var ie=Object.prototype.hasOwnProperty,F="~";function J(){}Object.create&&(J.prototype=Object.create(null),new J().__proto__||(F=!1));function Y(oe,ne,we){this.fn=oe,this.context=ne,this.once=we||!1}function g(oe,ne,we,re,ke){if(typeof we!="function")throw new TypeError("The listener must be a function");var Ve=new Y(we,re||oe,ke),Ne=F?F+ne:ne;return oe._events[Ne]?oe._events[Ne].fn?oe._events[Ne]=[oe._events[Ne],Ve]:oe._events[Ne].push(Ve):(oe._events[Ne]=Ve,oe._eventsCount++),oe}function fe(oe,ne){--oe._eventsCount==0?oe._events=new J:delete oe._events[ne]}function N(){this._events=new J,this._eventsCount=0}N.prototype.eventNames=function(){var ne=[],we,re;if(this._eventsCount===0)return ne;for(re in we=this._events)ie.call(we,re)&&ne.push(F?re.slice(1):re);return Object.getOwnPropertySymbols?ne.concat(Object.getOwnPropertySymbols(we)):ne},N.prototype.listeners=function(ne){var we=F?F+ne:ne,re=this._events[we];if(!re)return[];if(re.fn)return[re.fn];for(var ke=0,Ve=re.length,Ne=new Array(Ve);ke<Ve;ke++)Ne[ke]=re[ke].fn;return Ne},N.prototype.listenerCount=function(ne){var we=F?F+ne:ne,re=this._events[we];return re?re.fn?1:re.length:0},N.prototype.emit=function(ne,we,re,ke,Ve,Ne){var Je=F?F+ne:ne;if(!this._events[Je])return!1;var Jt=this._events[Je],_t=arguments.length,Ut,Tt;if(Jt.fn){switch(Jt.once&&this.removeListener(ne,Jt.fn,void 0,!0),_t){case 1:return Jt.fn.call(Jt.context),!0;case 2:return Jt.fn.call(Jt.context,we),!0;case 3:return Jt.fn.call(Jt.context,we,re),!0;case 4:return Jt.fn.call(Jt.context,we,re,ke),!0;case 5:return Jt.fn.call(Jt.context,we,re,ke,Ve),!0;case 6:return Jt.fn.call(Jt.context,we,re,ke,Ve,Ne),!0}for(Tt=1,Ut=new Array(_t-1);Tt<_t;Tt++)Ut[Tt-1]=arguments[Tt];Jt.fn.apply(Jt.context,Ut)}else{var vt=Jt.length,pt;for(Tt=0;Tt<vt;Tt++)switch(Jt[Tt].once&&this.removeListener(ne,Jt[Tt].fn,void 0,!0),_t){case 1:Jt[Tt].fn.call(Jt[Tt].context);break;case 2:Jt[Tt].fn.call(Jt[Tt].context,we);break;case 3:Jt[Tt].fn.call(Jt[Tt].context,we,re);break;case 4:Jt[Tt].fn.call(Jt[Tt].context,we,re,ke);break;default:if(!Ut)for(pt=1,Ut=new Array(_t-1);pt<_t;pt++)Ut[pt-1]=arguments[pt];Jt[Tt].fn.apply(Jt[Tt].context,Ut)}}return!0},N.prototype.on=function(ne,we,re){return g(this,ne,we,re,!1)},N.prototype.once=function(ne,we,re){return g(this,ne,we,re,!0)},N.prototype.removeListener=function(ne,we,re,ke){var Ve=F?F+ne:ne;if(!this._events[Ve])return this;if(!we)return fe(this,Ve),this;var Ne=this._events[Ve];if(Ne.fn)Ne.fn===we&&(!ke||Ne.once)&&(!re||Ne.context===re)&&fe(this,Ve);else{for(var Je=0,Jt=[],_t=Ne.length;Je<_t;Je++)(Ne[Je].fn!==we||ke&&!Ne[Je].once||re&&Ne[Je].context!==re)&&Jt.push(Ne[Je]);Jt.length?this._events[Ve]=Jt.length===1?Jt[0]:Jt:fe(this,Ve)}return this},N.prototype.removeAllListeners=function(ne){var we;return ne?(we=F?F+ne:ne,this._events[we]&&fe(this,we)):(this._events=new J,this._eventsCount=0),this},N.prototype.off=N.prototype.removeListener,N.prototype.addListener=N.prototype.on,N.prefixed=F,N.EventEmitter=N,It.exports=N},80645:function(It,ie){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */ie.read=function(F,J,Y,g,fe){var N,oe,ne=fe*8-g-1,we=(1<<ne)-1,re=we>>1,ke=-7,Ve=Y?fe-1:0,Ne=Y?-1:1,Je=F[J+Ve];for(Ve+=Ne,N=Je&(1<<-ke)-1,Je>>=-ke,ke+=ne;ke>0;N=N*256+F[J+Ve],Ve+=Ne,ke-=8);for(oe=N&(1<<-ke)-1,N>>=-ke,ke+=g;ke>0;oe=oe*256+F[J+Ve],Ve+=Ne,ke-=8);if(N===0)N=1-re;else{if(N===we)return oe?NaN:(Je?-1:1)*Infinity;oe=oe+Math.pow(2,g),N=N-re}return(Je?-1:1)*oe*Math.pow(2,N-g)},ie.write=function(F,J,Y,g,fe,N){var oe,ne,we,re=N*8-fe-1,ke=(1<<re)-1,Ve=ke>>1,Ne=fe===23?Math.pow(2,-24)-Math.pow(2,-77):0,Je=g?0:N-1,Jt=g?1:-1,_t=J<0||J===0&&1/J<0?1:0;for(J=Math.abs(J),isNaN(J)||J===Infinity?(ne=isNaN(J)?1:0,oe=ke):(oe=Math.floor(Math.log(J)/Math.LN2),J*(we=Math.pow(2,-oe))<1&&(oe--,we*=2),oe+Ve>=1?J+=Ne/we:J+=Ne*Math.pow(2,1-Ve),J*we>=2&&(oe++,we/=2),oe+Ve>=ke?(ne=0,oe=ke):oe+Ve>=1?(ne=(J*we-1)*Math.pow(2,fe),oe=oe+Ve):(ne=J*Math.pow(2,Ve-1)*Math.pow(2,fe),oe=0));fe>=8;F[Y+Je]=ne&255,Je+=Jt,ne/=256,fe-=8);for(oe=oe<<fe|ne,re+=fe;re>0;F[Y+Je]=oe&255,Je+=Jt,oe/=256,re-=8);F[Y+Je-Jt]|=_t*128}},7375:function(It,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0});var F=Symbol.for("INJECTION");function J(oe,ne,we,re){function ke(){return re&&!Reflect.hasMetadata(F,this,ne)&&Reflect.defineMetadata(F,we(),this,ne),Reflect.hasMetadata(F,this,ne)?Reflect.getMetadata(F,this,ne):we()}function Ve(Ne){Reflect.defineMetadata(F,Ne,this,ne)}Object.defineProperty(oe,ne,{configurable:!0,enumerable:!0,get:ke,set:Ve})}function Y(oe,ne){return function(we){return function(re,ke){var Ve=function(){return oe.get(we)};J(re,ke,Ve,ne)}}}ie.makePropertyInjectDecorator=Y;function g(oe,ne){return function(we,re){return function(ke,Ve){var Ne=function(){return oe.getNamed(we,re)};J(ke,Ve,Ne,ne)}}}ie.makePropertyInjectNamedDecorator=g;function fe(oe,ne){return function(we,re,ke){return function(Ve,Ne){var Je=function(){return oe.getTagged(we,re,ke)};J(Ve,Ne,Je,ne)}}}ie.makePropertyInjectTaggedDecorator=fe;function N(oe,ne){return function(we){return function(re,ke){var Ve=function(){return oe.getAll(we)};J(re,ke,Ve,ne)}}}ie.makePropertyMultiInjectDecorator=N},84879:function(It,ie,F){"use strict";var J;J={value:!0};var Y=F(7375);function g(fe,N){N===void 0&&(N=!0);var oe=Y.makePropertyInjectDecorator(fe,N),ne=Y.makePropertyInjectNamedDecorator(fe,N),we=Y.makePropertyInjectTaggedDecorator(fe,N),re=Y.makePropertyMultiInjectDecorator(fe,N);return{lazyInject:oe,lazyInjectNamed:ne,lazyInjectTagged:we,lazyMultiInject:re}}ie.Z=g},99934:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.tagProperty=ie.tagParameter=ie.decorate=void 0;var J=F(16674),Y=F(6867);function g(re,ke,Ve,Ne){var Je=Y.TAGGED;N(Je,re,ke,Ne,Ve)}ie.tagParameter=g;function fe(re,ke,Ve){var Ne=Y.TAGGED_PROP;N(Ne,re.constructor,ke,Ve)}ie.tagProperty=fe;function N(re,ke,Ve,Ne,Je){var Jt={},_t=typeof Je=="number",Ut=Je!==void 0&&_t?Je.toString():Ve;if(_t&&Ve!==void 0)throw new Error(J.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(re,ke)&&(Jt=Reflect.getMetadata(re,ke));var Tt=Jt[Ut];if(!Array.isArray(Tt))Tt=[];else for(var vt=0,pt=Tt;vt<pt.length;vt++){var Vt=pt[vt];if(Vt.key===Ne.key)throw new Error(J.DUPLICATED_METADATA+" "+Vt.key.toString())}Tt.push(Ne),Jt[Ut]=Tt,Reflect.defineMetadata(re,Jt,ke)}function oe(re,ke){Reflect.decorate(re,ke)}function ne(re,ke){return function(Ve,Ne){ke(Ve,Ne,re)}}function we(re,ke,Ve){typeof Ve=="number"?oe([ne(Ve,re)],ke):typeof Ve=="string"?Reflect.decorate([re],ke,Ve):oe([re],ke)}ie.decorate=we},5744:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.inject=ie.LazyServiceIdentifer=void 0;var J=F(16674),Y=F(6867),g=F(47738),fe=F(99934),N=function(){function ne(we){this._cb=we}return ne.prototype.unwrap=function(){return this._cb()},ne}();ie.LazyServiceIdentifer=N;function oe(ne){return function(we,re,ke){if(ne===void 0)throw new Error(J.UNDEFINED_INJECT_ANNOTATION(we.name));var Ve=new g.Metadata(Y.INJECT_TAG,ne);typeof ke=="number"?fe.tagParameter(we,re,ke,Ve):fe.tagProperty(we,re,Ve)}}ie.inject=oe},64315:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.injectable=void 0;var J=F(16674),Y=F(6867);function g(){return function(fe){if(Reflect.hasOwnMetadata(Y.PARAM_TYPES,fe))throw new Error(J.DUPLICATED_INJECTABLE_DECORATOR);var N=Reflect.getMetadata(Y.DESIGN_PARAM_TYPES,fe)||[];return Reflect.defineMetadata(Y.PARAM_TYPES,N,fe),fe}}ie.injectable=g},71693:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.multiInject=void 0;var J=F(6867),Y=F(47738),g=F(99934);function fe(N){return function(oe,ne,we){var re=new Y.Metadata(J.MULTI_INJECT_TAG,N);typeof we=="number"?g.tagParameter(oe,ne,we,re):g.tagProperty(oe,ne,re)}}ie.multiInject=fe},38085:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.named=void 0;var J=F(6867),Y=F(47738),g=F(99934);function fe(N){return function(oe,ne,we){var re=new Y.Metadata(J.NAMED_TAG,N);typeof we=="number"?g.tagParameter(oe,ne,we,re):g.tagProperty(oe,ne,re)}}ie.named=fe},6515:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.optional=void 0;var J=F(6867),Y=F(47738),g=F(99934);function fe(){return function(N,oe,ne){var we=new Y.Metadata(J.OPTIONAL_TAG,!0);typeof ne=="number"?g.tagParameter(N,oe,ne,we):g.tagProperty(N,oe,we)}}ie.optional=fe},7014:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.postConstruct=void 0;var J=F(16674),Y=F(6867),g=F(47738);function fe(){return function(N,oe,ne){var we=new g.Metadata(Y.POST_CONSTRUCT,oe);if(Reflect.hasOwnMetadata(Y.POST_CONSTRUCT,N.constructor))throw new Error(J.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(Y.POST_CONSTRUCT,we,N.constructor)}}ie.postConstruct=fe},32052:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.tagged=void 0;var J=F(47738),Y=F(99934);function g(fe,N){return function(oe,ne,we){var re=new J.Metadata(fe,N);typeof we=="number"?Y.tagParameter(oe,ne,we,re):Y.tagProperty(oe,ne,re)}}ie.tagged=g},55638:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.targetName=void 0;var J=F(6867),Y=F(47738),g=F(99934);function fe(N){return function(oe,ne,we){var re=new Y.Metadata(J.NAME_TAG,N);g.tagParameter(oe,ne,we,re)}}ie.targetName=fe},86757:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.unmanaged=void 0;var J=F(6867),Y=F(47738),g=F(99934);function fe(){return function(N,oe,ne){var we=new Y.Metadata(J.UNMANAGED_TAG,!0);g.tagParameter(N,oe,ne,we)}}ie.unmanaged=fe},44290:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Binding=void 0;var J=F(28421),Y=F(37791),g=function(){function fe(N,oe){this.id=Y.id(),this.activated=!1,this.serviceIdentifier=N,this.scope=oe,this.type=J.BindingTypeEnum.Invalid,this.constraint=function(ne){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return fe.prototype.clone=function(){var N=new fe(this.serviceIdentifier,this.scope);return N.activated=N.scope===J.BindingScopeEnum.Singleton?this.activated:!1,N.implementationType=this.implementationType,N.dynamicValue=this.dynamicValue,N.scope=this.scope,N.type=this.type,N.factory=this.factory,N.provider=this.provider,N.constraint=this.constraint,N.onActivation=this.onActivation,N.cache=this.cache,N},fe}();ie.Binding=g},23184:function(It,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingCount=void 0;var F={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};ie.BindingCount=F},16674:function(It,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.STACK_OVERFLOW=ie.CIRCULAR_DEPENDENCY_IN_FACTORY=ie.POST_CONSTRUCT_ERROR=ie.MULTIPLE_POST_CONSTRUCT_METHODS=ie.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=ie.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=ie.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=ie.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=ie.ARGUMENTS_LENGTH_MISMATCH=ie.INVALID_DECORATOR_OPERATION=ie.INVALID_TO_SELF_VALUE=ie.INVALID_FUNCTION_BINDING=ie.INVALID_MIDDLEWARE_RETURN=ie.NO_MORE_SNAPSHOTS_AVAILABLE=ie.INVALID_BINDING_TYPE=ie.NOT_IMPLEMENTED=ie.CIRCULAR_DEPENDENCY=ie.UNDEFINED_INJECT_ANNOTATION=ie.MISSING_INJECT_ANNOTATION=ie.MISSING_INJECTABLE_ANNOTATION=ie.NOT_REGISTERED=ie.CANNOT_UNBIND=ie.AMBIGUOUS_MATCH=ie.KEY_NOT_FOUND=ie.NULL_ARGUMENT=ie.DUPLICATED_METADATA=ie.DUPLICATED_INJECTABLE_DECORATOR=void 0,ie.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",ie.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",ie.NULL_ARGUMENT="NULL argument",ie.KEY_NOT_FOUND="Key Not Found",ie.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",ie.CANNOT_UNBIND="Could not unbind serviceIdentifier:",ie.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",ie.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",ie.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var F=function(fe){return"@inject called with undefined this could mean that the class "+fe+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};ie.UNDEFINED_INJECT_ANNOTATION=F,ie.CIRCULAR_DEPENDENCY="Circular dependency found:",ie.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",ie.INVALID_BINDING_TYPE="Invalid binding type:",ie.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",ie.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",ie.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",ie.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",ie.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var J=function(){for(var fe=[],N=0;N<arguments.length;N++)fe[N]=arguments[N];return"The number of constructor arguments in the derived class "+(fe[0]+" must be >= than the number of constructor arguments of its base class.")};ie.ARGUMENTS_LENGTH_MISMATCH=J,ie.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",ie.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",ie.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",ie.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",ie.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var Y=function(){for(var fe=[],N=0;N<arguments.length;N++)fe[N]=arguments[N];return"@postConstruct error in class "+fe[0]+": "+fe[1]};ie.POST_CONSTRUCT_ERROR=Y;var g=function(){for(var fe=[],N=0;N<arguments.length;N++)fe[N]=arguments[N];return"It looks like there is a circular dependency "+("in one of the '"+fe[0]+"' bindings. Please investigate bindings with")+("service identifier '"+fe[1]+"'.")};ie.CIRCULAR_DEPENDENCY_IN_FACTORY=g,ie.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(It,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.TargetTypeEnum=ie.BindingTypeEnum=ie.BindingScopeEnum=void 0;var F={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ie.BindingScopeEnum=F;var J={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ie.BindingTypeEnum=J;var Y={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ie.TargetTypeEnum=Y},6867:function(It,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.NON_CUSTOM_TAG_KEYS=ie.POST_CONSTRUCT=ie.DESIGN_PARAM_TYPES=ie.PARAM_TYPES=ie.TAGGED_PROP=ie.TAGGED=ie.MULTI_INJECT_TAG=ie.INJECT_TAG=ie.OPTIONAL_TAG=ie.UNMANAGED_TAG=ie.NAME_TAG=ie.NAMED_TAG=void 0,ie.NAMED_TAG="named",ie.NAME_TAG="name",ie.UNMANAGED_TAG="unmanaged",ie.OPTIONAL_TAG="optional",ie.INJECT_TAG="inject",ie.MULTI_INJECT_TAG="multi_inject",ie.TAGGED="inversify:tagged",ie.TAGGED_PROP="inversify:tagged_props",ie.PARAM_TYPES="inversify:paramtypes",ie.DESIGN_PARAM_TYPES="design:paramtypes",ie.POST_CONSTRUCT="post_construct";function F(){return[ie.INJECT_TAG,ie.MULTI_INJECT_TAG,ie.NAME_TAG,ie.UNMANAGED_TAG,ie.NAMED_TAG,ie.OPTIONAL_TAG]}ie.NON_CUSTOM_TAG_KEYS=F()},51389:function(It,ie,F){"use strict";var J=this&&this.__awaiter||function(Tt,vt,pt,Vt){function ee(rr){return rr instanceof pt?rr:new pt(function(At){At(rr)})}return new(pt||(pt=Promise))(function(rr,At){function nt(nr){try{ut(Vt.next(nr))}catch(Mr){At(Mr)}}function Zt(nr){try{ut(Vt.throw(nr))}catch(Mr){At(Mr)}}function ut(nr){nr.done?rr(nr.value):ee(nr.value).then(nt,Zt)}ut((Vt=Vt.apply(Tt,vt||[])).next())})},Y=this&&this.__generator||function(Tt,vt){var pt={label:0,sent:function(){if(rr[0]&1)throw rr[1];return rr[1]},trys:[],ops:[]},Vt,ee,rr,At;return At={next:nt(0),throw:nt(1),return:nt(2)},typeof Symbol=="function"&&(At[Symbol.iterator]=function(){return this}),At;function nt(ut){return function(nr){return Zt([ut,nr])}}function Zt(ut){if(Vt)throw new TypeError("Generator is already executing.");for(;pt;)try{if(Vt=1,ee&&(rr=ut[0]&2?ee.return:ut[0]?ee.throw||((rr=ee.return)&&rr.call(ee),0):ee.next)&&!(rr=rr.call(ee,ut[1])).done)return rr;switch(ee=0,rr&&(ut=[ut[0]&2,rr.value]),ut[0]){case 0:case 1:rr=ut;break;case 4:return pt.label++,{value:ut[1],done:!1};case 5:pt.label++,ee=ut[1],ut=[0];continue;case 7:ut=pt.ops.pop(),pt.trys.pop();continue;default:if(rr=pt.trys,!(rr=rr.length>0&&rr[rr.length-1])&&(ut[0]===6||ut[0]===2)){pt=0;continue}if(ut[0]===3&&(!rr||ut[1]>rr[0]&&ut[1]<rr[3])){pt.label=ut[1];break}if(ut[0]===6&&pt.label<rr[1]){pt.label=rr[1],rr=ut;break}if(rr&&pt.label<rr[2]){pt.label=rr[2],pt.ops.push(ut);break}rr[2]&&pt.ops.pop(),pt.trys.pop();continue}ut=vt.call(Tt,pt)}catch(nr){ut=[6,nr],ee=0}finally{Vt=rr=0}if(ut[0]&5)throw ut[1];return{value:ut[0]?ut[1]:void 0,done:!0}}},g=this&&this.__spreadArray||function(Tt,vt){for(var pt=0,Vt=vt.length,ee=Tt.length;pt<Vt;pt++,ee++)Tt[ee]=vt[pt];return Tt};Object.defineProperty(ie,"__esModule",{value:!0}),ie.Container=void 0;var fe=F(44290),N=F(16674),oe=F(28421),ne=F(6867),we=F(51377),re=F(86311),ke=F(31927),Ve=F(15451),Ne=F(37791),Je=F(55800),Jt=F(85700),_t=F(80175),Ut=function(){function Tt(vt){this._appliedMiddleware=[];var pt=vt||{};if(typeof pt!="object")throw new Error(""+N.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(pt.defaultScope===void 0)pt.defaultScope=oe.BindingScopeEnum.Transient;else if(pt.defaultScope!==oe.BindingScopeEnum.Singleton&&pt.defaultScope!==oe.BindingScopeEnum.Transient&&pt.defaultScope!==oe.BindingScopeEnum.Request)throw new Error(""+N.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(pt.autoBindInjectable===void 0)pt.autoBindInjectable=!1;else if(typeof pt.autoBindInjectable!="boolean")throw new Error(""+N.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(pt.skipBaseClassChecks===void 0)pt.skipBaseClassChecks=!1;else if(typeof pt.skipBaseClassChecks!="boolean")throw new Error(""+N.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:pt.autoBindInjectable,defaultScope:pt.defaultScope,skipBaseClassChecks:pt.skipBaseClassChecks},this.id=Ne.id(),this._bindingDictionary=new _t.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new we.MetadataReader}return Tt.merge=function(vt,pt){for(var Vt=[],ee=2;ee<arguments.length;ee++)Vt[ee-2]=arguments[ee];var rr=new Tt,At=g([vt,pt],Vt).map(function(ut){return re.getBindingDictionary(ut)}),nt=re.getBindingDictionary(rr);function Zt(ut,nr){ut.traverse(function(Mr,q){q.forEach(function(pe){nr.add(pe.serviceIdentifier,pe.clone())})})}return At.forEach(function(ut){Zt(ut,nt)}),rr},Tt.prototype.load=function(){for(var vt=[],pt=0;pt<arguments.length;pt++)vt[pt]=arguments[pt];for(var Vt=this._getContainerModuleHelpersFactory(),ee=0,rr=vt;ee<rr.length;ee++){var At=rr[ee],nt=Vt(At.id);At.registry(nt.bindFunction,nt.unbindFunction,nt.isboundFunction,nt.rebindFunction)}},Tt.prototype.loadAsync=function(){for(var vt=[],pt=0;pt<arguments.length;pt++)vt[pt]=arguments[pt];return J(this,void 0,void 0,function(){var Vt,ee,rr,At,nt;return Y(this,function(Zt){switch(Zt.label){case 0:Vt=this._getContainerModuleHelpersFactory(),ee=0,rr=vt,Zt.label=1;case 1:return ee<rr.length?(At=rr[ee],nt=Vt(At.id),[4,At.registry(nt.bindFunction,nt.unbindFunction,nt.isboundFunction,nt.rebindFunction)]):[3,4];case 2:Zt.sent(),Zt.label=3;case 3:return ee++,[3,1];case 4:return[2]}})})},Tt.prototype.unload=function(){for(var vt=this,pt=[],Vt=0;Vt<arguments.length;Vt++)pt[Vt]=arguments[Vt];var ee=function(rr){return function(At){return At.moduleId===rr}};pt.forEach(function(rr){var At=ee(rr.id);vt._bindingDictionary.removeByCondition(At)})},Tt.prototype.bind=function(vt){var pt=this.options.defaultScope||oe.BindingScopeEnum.Transient,Vt=new fe.Binding(vt,pt);return this._bindingDictionary.add(vt,Vt),new Ve.BindingToSyntax(Vt)},Tt.prototype.rebind=function(vt){return this.unbind(vt),this.bind(vt)},Tt.prototype.unbind=function(vt){try{this._bindingDictionary.remove(vt)}catch(pt){throw new Error(N.CANNOT_UNBIND+" "+Je.getServiceIdentifierAsString(vt))}},Tt.prototype.unbindAll=function(){this._bindingDictionary=new _t.Lookup},Tt.prototype.isBound=function(vt){var pt=this._bindingDictionary.hasKey(vt);return!pt&&this.parent&&(pt=this.parent.isBound(vt)),pt},Tt.prototype.isBoundNamed=function(vt,pt){return this.isBoundTagged(vt,ne.NAMED_TAG,pt)},Tt.prototype.isBoundTagged=function(vt,pt,Vt){var ee=!1;if(this._bindingDictionary.hasKey(vt)){var rr=this._bindingDictionary.get(vt),At=re.createMockRequest(this,vt,pt,Vt);ee=rr.some(function(nt){return nt.constraint(At)})}return!ee&&this.parent&&(ee=this.parent.isBoundTagged(vt,pt,Vt)),ee},Tt.prototype.snapshot=function(){this._snapshots.push(Jt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Tt.prototype.restore=function(){var vt=this._snapshots.pop();if(vt===void 0)throw new Error(N.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=vt.bindings,this._middleware=vt.middleware},Tt.prototype.createChild=function(vt){var pt=new Tt(vt||this.options);return pt.parent=this,pt},Tt.prototype.applyMiddleware=function(){for(var vt=[],pt=0;pt<arguments.length;pt++)vt[pt]=arguments[pt];this._appliedMiddleware=this._appliedMiddleware.concat(vt);var Vt=this._middleware?this._middleware:this._planAndResolve();this._middleware=vt.reduce(function(ee,rr){return rr(ee)},Vt)},Tt.prototype.applyCustomMetadataReader=function(vt){this._metadataReader=vt},Tt.prototype.get=function(vt){return this._get(!1,!1,oe.TargetTypeEnum.Variable,vt)},Tt.prototype.getTagged=function(vt,pt,Vt){return this._get(!1,!1,oe.TargetTypeEnum.Variable,vt,pt,Vt)},Tt.prototype.getNamed=function(vt,pt){return this.getTagged(vt,ne.NAMED_TAG,pt)},Tt.prototype.getAll=function(vt){return this._get(!0,!0,oe.TargetTypeEnum.Variable,vt)},Tt.prototype.getAllTagged=function(vt,pt,Vt){return this._get(!1,!0,oe.TargetTypeEnum.Variable,vt,pt,Vt)},Tt.prototype.getAllNamed=function(vt,pt){return this.getAllTagged(vt,ne.NAMED_TAG,pt)},Tt.prototype.resolve=function(vt){var pt=this.createChild();return pt.bind(vt).toSelf(),this._appliedMiddleware.forEach(function(Vt){pt.applyMiddleware(Vt)}),pt.get(vt)},Tt.prototype._getContainerModuleHelpersFactory=function(){var vt=this,pt=function(nt,Zt){nt._binding.moduleId=Zt},Vt=function(nt){return function(Zt){var ut=vt.bind.bind(vt),nr=ut(Zt);return pt(nr,nt),nr}},ee=function(nt){return function(Zt){var ut=vt.unbind.bind(vt);ut(Zt)}},rr=function(nt){return function(Zt){var ut=vt.isBound.bind(vt);return ut(Zt)}},At=function(nt){return function(Zt){var ut=vt.rebind.bind(vt),nr=ut(Zt);return pt(nr,nt),nr}};return function(nt){return{bindFunction:Vt(nt),isboundFunction:rr(nt),rebindFunction:At(nt),unbindFunction:ee(nt)}}},Tt.prototype._get=function(vt,pt,Vt,ee,rr,At){var nt=null,Zt={avoidConstraints:vt,contextInterceptor:function(ut){return ut},isMultiInject:pt,key:rr,serviceIdentifier:ee,targetType:Vt,value:At};if(this._middleware){if(nt=this._middleware(Zt),nt==null)throw new Error(N.INVALID_MIDDLEWARE_RETURN)}else nt=this._planAndResolve()(Zt);return nt},Tt.prototype._planAndResolve=function(){var vt=this;return function(pt){var Vt=re.plan(vt._metadataReader,vt,pt.isMultiInject,pt.targetType,pt.serviceIdentifier,pt.key,pt.value,pt.avoidConstraints);Vt=pt.contextInterceptor(Vt);var ee=ke.resolve(Vt);return ee}},Tt}();ie.Container=Ut},33244:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.AsyncContainerModule=ie.ContainerModule=void 0;var J=F(37791),Y=function(){function fe(N){this.id=J.id(),this.registry=N}return fe}();ie.ContainerModule=Y;var g=function(){function fe(N){this.id=J.id(),this.registry=N}return fe}();ie.AsyncContainerModule=g},85700:function(It,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.ContainerSnapshot=void 0;var F=function(){function J(){}return J.of=function(Y,g){var fe=new J;return fe.bindings=Y,fe.middleware=g,fe},J}();ie.ContainerSnapshot=F},80175:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Lookup=void 0;var J=F(16674),Y=function(){function g(){this._map=new Map}return g.prototype.getMap=function(){return this._map},g.prototype.add=function(fe,N){if(fe==null)throw new Error(J.NULL_ARGUMENT);if(N==null)throw new Error(J.NULL_ARGUMENT);var oe=this._map.get(fe);oe!==void 0?(oe.push(N),this._map.set(fe,oe)):this._map.set(fe,[N])},g.prototype.get=function(fe){if(fe==null)throw new Error(J.NULL_ARGUMENT);var N=this._map.get(fe);if(N!==void 0)return N;throw new Error(J.KEY_NOT_FOUND)},g.prototype.remove=function(fe){if(fe==null)throw new Error(J.NULL_ARGUMENT);if(!this._map.delete(fe))throw new Error(J.KEY_NOT_FOUND)},g.prototype.removeByCondition=function(fe){var N=this;this._map.forEach(function(oe,ne){var we=oe.filter(function(re){return!fe(re)});we.length>0?N._map.set(ne,we):N._map.delete(ne)})},g.prototype.hasKey=function(fe){if(fe==null)throw new Error(J.NULL_ARGUMENT);return this._map.has(fe)},g.prototype.clone=function(){var fe=new g;return this._map.forEach(function(N,oe){N.forEach(function(ne){return fe.add(oe,ne.clone())})}),fe},g.prototype.traverse=function(fe){this._map.forEach(function(N,oe){fe(oe,N)})},g}();ie.Lookup=Y},86700:function(It,ie,F){"use strict";var J;J={value:!0},J=J=J=J=J=J=ie.GW=J=J=ie.zY=J=J=J=J=J=ie.f3=J=J=ie.b2=J=J=J=J=J=ie.W2=J=void 0;var Y=F(6867);J=Y;var g=F(51389);Object.defineProperty(ie,"W2",{enumerable:!0,get:function(){return g.Container}});var fe=F(28421);J={enumerable:!0,get:function(){return fe.BindingScopeEnum}},J={enumerable:!0,get:function(){return fe.BindingTypeEnum}},J={enumerable:!0,get:function(){return fe.TargetTypeEnum}};var N=F(33244);J={enumerable:!0,get:function(){return N.AsyncContainerModule}},J={enumerable:!0,get:function(){return N.ContainerModule}};var oe=F(64315);Object.defineProperty(ie,"b2",{enumerable:!0,get:function(){return oe.injectable}});var ne=F(32052);J={enumerable:!0,get:function(){return ne.tagged}};var we=F(38085);J={enumerable:!0,get:function(){return we.named}};var re=F(5744);Object.defineProperty(ie,"f3",{enumerable:!0,get:function(){return re.inject}}),J={enumerable:!0,get:function(){return re.LazyServiceIdentifer}};var ke=F(6515);J={enumerable:!0,get:function(){return ke.optional}};var Ve=F(86757);J={enumerable:!0,get:function(){return Ve.unmanaged}};var Ne=F(71693);J={enumerable:!0,get:function(){return Ne.multiInject}};var Je=F(55638);J={enumerable:!0,get:function(){return Je.targetName}};var Jt=F(7014);Object.defineProperty(ie,"zY",{enumerable:!0,get:function(){return Jt.postConstruct}});var _t=F(51377);J={enumerable:!0,get:function(){return _t.MetadataReader}};var Ut=F(37791);J={enumerable:!0,get:function(){return Ut.id}};var Tt=F(99934);Object.defineProperty(ie,"GW",{enumerable:!0,get:function(){return Tt.decorate}});var vt=F(80758);J={enumerable:!0,get:function(){return vt.traverseAncerstors}},J={enumerable:!0,get:function(){return vt.taggedConstraint}},J={enumerable:!0,get:function(){return vt.namedConstraint}},J={enumerable:!0,get:function(){return vt.typeConstraint}};var pt=F(55800);J={enumerable:!0,get:function(){return pt.getServiceIdentifierAsString}};var Vt=F(70600);J={enumerable:!0,get:function(){return Vt.multiBindToService}}},95228:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Context=void 0;var J=F(37791),Y=function(){function g(fe){this.id=J.id(),this.container=fe}return g.prototype.addPlan=function(fe){this.plan=fe},g.prototype.setCurrentRequest=function(fe){this.currentRequest=fe},g}();ie.Context=Y},47738:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Metadata=void 0;var J=F(6867),Y=function(){function g(fe,N){this.key=fe,this.value=N}return g.prototype.toString=function(){return this.key===J.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},g}();ie.Metadata=Y},51377:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.MetadataReader=void 0;var J=F(6867),Y=function(){function g(){}return g.prototype.getConstructorMetadata=function(fe){var N=Reflect.getMetadata(J.PARAM_TYPES,fe),oe=Reflect.getMetadata(J.TAGGED,fe);return{compilerGeneratedMetadata:N,userGeneratedMetadata:oe||{}}},g.prototype.getPropertiesMetadata=function(fe){var N=Reflect.getMetadata(J.TAGGED_PROP,fe)||[];return N},g}();ie.MetadataReader=Y},55314:function(It,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Plan=void 0;var F=function(){function J(Y,g){this.parentContext=Y,this.rootRequest=g}return J}();ie.Plan=F},86311:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.getBindingDictionary=ie.createMockRequest=ie.plan=void 0;var J=F(23184),Y=F(16674),g=F(28421),fe=F(6867),N=F(85265),oe=F(55800),ne=F(95228),we=F(47738),re=F(55314),ke=F(6e3),Ve=F(6748),Ne=F(18924);function Je(ee){return ee._bindingDictionary}ie.getBindingDictionary=Je;function Jt(ee,rr,At,nt,Zt,ut){var nr=ee?fe.MULTI_INJECT_TAG:fe.INJECT_TAG,Mr=new we.Metadata(nr,At),q=new Ne.Target(rr,nt,At,Mr);if(Zt!==void 0){var pe=new we.Metadata(Zt,ut);q.metadata.push(pe)}return q}function _t(ee,rr,At,nt,Zt){var ut=vt(At.container,Zt.serviceIdentifier),nr=[];return ut.length===J.BindingCount.NoBindingsAvailable&&At.container.options.autoBindInjectable&&typeof Zt.serviceIdentifier=="function"&&ee.getConstructorMetadata(Zt.serviceIdentifier).compilerGeneratedMetadata&&(At.container.bind(Zt.serviceIdentifier).toSelf(),ut=vt(At.container,Zt.serviceIdentifier)),rr?nr=ut:nr=ut.filter(function(Mr){var q=new Ve.Request(Mr.serviceIdentifier,At,nt,Mr,Zt);return Mr.constraint(q)}),Ut(Zt.serviceIdentifier,nr,Zt,At.container),nr}function Ut(ee,rr,At,nt){switch(rr.length){case J.BindingCount.NoBindingsAvailable:if(At.isOptional())return rr;var Zt=oe.getServiceIdentifierAsString(ee),ut=Y.NOT_REGISTERED;throw ut+=oe.listMetadataForTarget(Zt,At),ut+=oe.listRegisteredBindingsForServiceIdentifier(nt,Zt,vt),new Error(ut);case J.BindingCount.OnlyOneBindingAvailable:if(!At.isArray())return rr;case J.BindingCount.MultipleBindingsAvailable:default:if(At.isArray())return rr;var Zt=oe.getServiceIdentifierAsString(ee),ut=Y.AMBIGUOUS_MATCH+" "+Zt;throw ut+=oe.listRegisteredBindingsForServiceIdentifier(nt,Zt,vt),new Error(ut)}}function Tt(ee,rr,At,nt,Zt,ut){var nr,Mr;if(Zt===null){nr=_t(ee,rr,nt,null,ut),Mr=new Ve.Request(At,nt,null,nr,ut);var q=new re.Plan(nt,Mr);nt.addPlan(q)}else nr=_t(ee,rr,nt,Zt,ut),Mr=Zt.addChildRequest(ut.serviceIdentifier,nr,ut);nr.forEach(function(pe){var b=null;if(ut.isArray())b=Mr.addChildRequest(pe.serviceIdentifier,pe,ut);else{if(pe.cache)return;b=Mr}if(pe.type===g.BindingTypeEnum.Instance&&pe.implementationType!==null){var le=ke.getDependencies(ee,pe.implementationType);if(!nt.container.options.skipBaseClassChecks){var xe=ke.getBaseClassDependencyCount(ee,pe.implementationType);if(le.length<xe){var Qe=Y.ARGUMENTS_LENGTH_MISMATCH(ke.getFunctionName(pe.implementationType));throw new Error(Qe)}}le.forEach(function(xt){Tt(ee,!1,xt.serviceIdentifier,nt,b,xt)})}})}function vt(ee,rr){var At=[],nt=Je(ee);return nt.hasKey(rr)?At=nt.get(rr):ee.parent!==null&&(At=vt(ee.parent,rr)),At}function pt(ee,rr,At,nt,Zt,ut,nr,Mr){Mr===void 0&&(Mr=!1);var q=new ne.Context(rr),pe=Jt(At,nt,Zt,"",ut,nr);try{return Tt(ee,Mr,Zt,q,null,pe),q}catch(b){throw N.isStackOverflowExeption(b)&&q.plan&&oe.circularDependencyToException(q.plan.rootRequest),b}}ie.plan=pt;function Vt(ee,rr,At,nt){var Zt=new Ne.Target(g.TargetTypeEnum.Variable,"",rr,new we.Metadata(At,nt)),ut=new ne.Context(ee),nr=new Ve.Request(rr,ut,null,[],Zt);return nr}ie.createMockRequest=Vt},88460:function(It,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.QueryableString=void 0;var F=function(){function J(Y){this.str=Y}return J.prototype.startsWith=function(Y){return this.str.indexOf(Y)===0},J.prototype.endsWith=function(Y){var g="",fe=Y.split("").reverse().join("");return g=this.str.split("").reverse().join(""),this.startsWith.call({str:g},fe)},J.prototype.contains=function(Y){return this.str.indexOf(Y)!==-1},J.prototype.equals=function(Y){return this.str===Y},J.prototype.value=function(){return this.str},J}();ie.QueryableString=F},6e3:function(It,ie,F){"use strict";var J=this&&this.__spreadArray||function(_t,Ut){for(var Tt=0,vt=Ut.length,pt=_t.length;Tt<vt;Tt++,pt++)_t[pt]=Ut[Tt];return _t};Object.defineProperty(ie,"__esModule",{value:!0}),ie.getFunctionName=ie.getBaseClassDependencyCount=ie.getDependencies=void 0;var Y=F(5744),g=F(16674),fe=F(28421),N=F(6867),oe=F(55800);Object.defineProperty(ie,"getFunctionName",{enumerable:!0,get:function(){return oe.getFunctionName}});var ne=F(18924);function we(_t,Ut){var Tt=oe.getFunctionName(Ut),vt=re(_t,Tt,Ut,!1);return vt}ie.getDependencies=we;function re(_t,Ut,Tt,vt){var pt=_t.getConstructorMetadata(Tt),Vt=pt.compilerGeneratedMetadata;if(Vt===void 0){var ee=g.MISSING_INJECTABLE_ANNOTATION+" "+Ut+".";throw new Error(ee)}var rr=pt.userGeneratedMetadata,At=Object.keys(rr),nt=Tt.length===0&&At.length>0,Zt=At.length>Tt.length,ut=nt||Zt?At.length:Tt.length,nr=Ve(vt,Ut,Vt,rr,ut),Mr=Ne(_t,Tt),q=J(J([],nr),Mr);return q}function ke(_t,Ut,Tt,vt,pt){var Vt=pt[_t.toString()]||[],ee=Jt(Vt),rr=ee.unmanaged!==!0,At=vt[_t],nt=ee.inject||ee.multiInject;if(At=nt||At,At instanceof Y.LazyServiceIdentifer&&(At=At.unwrap()),rr){var Zt=At===Object,ut=At===Function,nr=At===void 0,Mr=Zt||ut||nr;if(!Ut&&Mr){var q=g.MISSING_INJECT_ANNOTATION+" argument "+_t+" in class "+Tt+".";throw new Error(q)}var pe=new ne.Target(fe.TargetTypeEnum.ConstructorArgument,ee.targetName,At);return pe.metadata=Vt,pe}return null}function Ve(_t,Ut,Tt,vt,pt){for(var Vt=[],ee=0;ee<pt;ee++){var rr=ee,At=ke(rr,_t,Ut,Tt,vt);At!==null&&Vt.push(At)}return Vt}function Ne(_t,Ut){for(var Tt=_t.getPropertiesMetadata(Ut),vt=[],pt=Object.keys(Tt),Vt=0,ee=pt;Vt<ee.length;Vt++){var rr=ee[Vt],At=Tt[rr],nt=Jt(Tt[rr]),Zt=nt.targetName||rr,ut=nt.inject||nt.multiInject,nr=new ne.Target(fe.TargetTypeEnum.ClassProperty,Zt,ut);nr.metadata=At,vt.push(nr)}var Mr=Object.getPrototypeOf(Ut.prototype).constructor;if(Mr!==Object){var q=Ne(_t,Mr);vt=J(J([],vt),q)}return vt}function Je(_t,Ut){var Tt=Object.getPrototypeOf(Ut.prototype).constructor;if(Tt!==Object){var vt=oe.getFunctionName(Tt),pt=re(_t,vt,Tt,!0),Vt=pt.map(function(At){return At.metadata.filter(function(nt){return nt.key===N.UNMANAGED_TAG})}),ee=[].concat.apply([],Vt).length,rr=pt.length-ee;return rr>0?rr:Je(_t,Tt)}else return 0}ie.getBaseClassDependencyCount=Je;function Jt(_t){var Ut={};return _t.forEach(function(Tt){Ut[Tt.key.toString()]=Tt.value}),{inject:Ut[N.INJECT_TAG],multiInject:Ut[N.MULTI_INJECT_TAG],targetName:Ut[N.NAME_TAG],unmanaged:Ut[N.UNMANAGED_TAG]}}},6748:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Request=void 0;var J=F(37791),Y=function(){function g(fe,N,oe,ne,we){this.id=J.id(),this.serviceIdentifier=fe,this.parentContext=N,this.parentRequest=oe,this.target=we,this.childRequests=[],this.bindings=Array.isArray(ne)?ne:[ne],this.requestScope=oe===null?new Map:null}return g.prototype.addChildRequest=function(fe,N,oe){var ne=new g(fe,this.parentContext,this,N,oe);return this.childRequests.push(ne),ne},g}();ie.Request=Y},18924:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.Target=void 0;var J=F(6867),Y=F(37791),g=F(47738),fe=F(88460),N=function(){function oe(ne,we,re,ke){this.id=Y.id(),this.type=ne,this.serviceIdentifier=re,this.name=new fe.QueryableString(we||""),this.metadata=new Array;var Ve=null;typeof ke=="string"?Ve=new g.Metadata(J.NAMED_TAG,ke):ke instanceof g.Metadata&&(Ve=ke),Ve!==null&&this.metadata.push(Ve)}return oe.prototype.hasTag=function(ne){for(var we=0,re=this.metadata;we<re.length;we++){var ke=re[we];if(ke.key===ne)return!0}return!1},oe.prototype.isArray=function(){return this.hasTag(J.MULTI_INJECT_TAG)},oe.prototype.matchesArray=function(ne){return this.matchesTag(J.MULTI_INJECT_TAG)(ne)},oe.prototype.isNamed=function(){return this.hasTag(J.NAMED_TAG)},oe.prototype.isTagged=function(){return this.metadata.some(function(ne){return J.NON_CUSTOM_TAG_KEYS.every(function(we){return ne.key!==we})})},oe.prototype.isOptional=function(){return this.matchesTag(J.OPTIONAL_TAG)(!0)},oe.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ne){return ne.key===J.NAMED_TAG})[0]:null},oe.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ne){return J.NON_CUSTOM_TAG_KEYS.every(function(we){return ne.key!==we})}):null},oe.prototype.matchesNamedTag=function(ne){return this.matchesTag(J.NAMED_TAG)(ne)},oe.prototype.matchesTag=function(ne){var we=this;return function(re){for(var ke=0,Ve=we.metadata;ke<Ve.length;ke++){var Ne=Ve[ke];if(Ne.key===ne&&Ne.value===re)return!0}return!1}},oe}();ie.Target=N},52279:function(It,ie,F){"use strict";var J=this&&this.__spreadArray||function(re,ke){for(var Ve=0,Ne=ke.length,Je=re.length;Ve<Ne;Ve++,Je++)re[Je]=ke[Ve];return re};Object.defineProperty(ie,"__esModule",{value:!0}),ie.resolveInstance=void 0;var Y=F(16674),g=F(28421),fe=F(6867);function N(re,ke,Ve){var Ne=ke.filter(function(Jt){return Jt.target!==null&&Jt.target.type===g.TargetTypeEnum.ClassProperty}),Je=Ne.map(Ve);return Ne.forEach(function(Jt,_t){var Ut="";Ut=Jt.target.name.value();var Tt=Je[_t];re[Ut]=Tt}),re}function oe(re,ke){return new(re.bind.apply(re,J([void 0],ke)))}function ne(re,ke){if(Reflect.hasMetadata(fe.POST_CONSTRUCT,re)){var Ve=Reflect.getMetadata(fe.POST_CONSTRUCT,re);try{ke[Ve.value]()}catch(Ne){throw new Error(Y.POST_CONSTRUCT_ERROR(re.name,Ne.message))}}}function we(re,ke,Ve){var Ne=null;if(ke.length>0){var Je=ke.filter(function(_t){return _t.target!==null&&_t.target.type===g.TargetTypeEnum.ConstructorArgument}),Jt=Je.map(Ve);Ne=oe(re,Jt),Ne=N(Ne,ke,Ve)}else Ne=new re;return ne(re,Ne),Ne}ie.resolveInstance=we},31927:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.resolve=void 0;var J=F(16674),Y=F(28421),g=F(85265),fe=F(55800),N=F(52279),oe=function(re,ke,Ve){try{return Ve()}catch(Ne){throw g.isStackOverflowExeption(Ne)?new Error(J.CIRCULAR_DEPENDENCY_IN_FACTORY(re,ke.toString())):Ne}},ne=function(re){return function(ke){ke.parentContext.setCurrentRequest(ke);var Ve=ke.bindings,Ne=ke.childRequests,Je=ke.target&&ke.target.isArray(),Jt=!ke.parentRequest||!ke.parentRequest.target||!ke.target||!ke.parentRequest.target.matchesArray(ke.target.serviceIdentifier);if(Je&&Jt)return Ne.map(function(Vt){var ee=ne(re);return ee(Vt)});var _t=null;if(ke.target.isOptional()&&Ve.length===0)return;var Ut=Ve[0],Tt=Ut.scope===Y.BindingScopeEnum.Singleton,vt=Ut.scope===Y.BindingScopeEnum.Request;if(Tt&&Ut.activated)return Ut.cache;if(vt&&re!==null&&re.has(Ut.id))return re.get(Ut.id);if(Ut.type===Y.BindingTypeEnum.ConstantValue)_t=Ut.cache,Ut.activated=!0;else if(Ut.type===Y.BindingTypeEnum.Function)_t=Ut.cache,Ut.activated=!0;else if(Ut.type===Y.BindingTypeEnum.Constructor)_t=Ut.implementationType;else if(Ut.type===Y.BindingTypeEnum.DynamicValue&&Ut.dynamicValue!==null)_t=oe("toDynamicValue",Ut.serviceIdentifier,function(){return Ut.dynamicValue(ke.parentContext)});else if(Ut.type===Y.BindingTypeEnum.Factory&&Ut.factory!==null)_t=oe("toFactory",Ut.serviceIdentifier,function(){return Ut.factory(ke.parentContext)});else if(Ut.type===Y.BindingTypeEnum.Provider&&Ut.provider!==null)_t=oe("toProvider",Ut.serviceIdentifier,function(){return Ut.provider(ke.parentContext)});else if(Ut.type===Y.BindingTypeEnum.Instance&&Ut.implementationType!==null)_t=N.resolveInstance(Ut.implementationType,Ne,ne(re));else{var pt=fe.getServiceIdentifierAsString(ke.serviceIdentifier);throw new Error(J.INVALID_BINDING_TYPE+" "+pt)}return typeof Ut.onActivation=="function"&&(_t=Ut.onActivation(ke.parentContext,_t)),Tt&&(Ut.cache=_t,Ut.activated=!0),vt&&re!==null&&!re.has(Ut.id)&&re.set(Ut.id,_t),_t}};function we(re){var ke=ne(re.plan.rootRequest.requestScope);return ke(re.plan.rootRequest)}ie.resolve=we},83366:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingInSyntax=void 0;var J=F(28421),Y=F(71325),g=function(){function fe(N){this._binding=N}return fe.prototype.inRequestScope=function(){return this._binding.scope=J.BindingScopeEnum.Request,new Y.BindingWhenOnSyntax(this._binding)},fe.prototype.inSingletonScope=function(){return this._binding.scope=J.BindingScopeEnum.Singleton,new Y.BindingWhenOnSyntax(this._binding)},fe.prototype.inTransientScope=function(){return this._binding.scope=J.BindingScopeEnum.Transient,new Y.BindingWhenOnSyntax(this._binding)},fe}();ie.BindingInSyntax=g},74889:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingInWhenOnSyntax=void 0;var J=F(83366),Y=F(51811),g=F(98370),fe=function(){function N(oe){this._binding=oe,this._bindingWhenSyntax=new g.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Y.BindingOnSyntax(this._binding),this._bindingInSyntax=new J.BindingInSyntax(oe)}return N.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},N.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},N.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},N.prototype.when=function(oe){return this._bindingWhenSyntax.when(oe)},N.prototype.whenTargetNamed=function(oe){return this._bindingWhenSyntax.whenTargetNamed(oe)},N.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},N.prototype.whenTargetTagged=function(oe,ne){return this._bindingWhenSyntax.whenTargetTagged(oe,ne)},N.prototype.whenInjectedInto=function(oe){return this._bindingWhenSyntax.whenInjectedInto(oe)},N.prototype.whenParentNamed=function(oe){return this._bindingWhenSyntax.whenParentNamed(oe)},N.prototype.whenParentTagged=function(oe,ne){return this._bindingWhenSyntax.whenParentTagged(oe,ne)},N.prototype.whenAnyAncestorIs=function(oe){return this._bindingWhenSyntax.whenAnyAncestorIs(oe)},N.prototype.whenNoAncestorIs=function(oe){return this._bindingWhenSyntax.whenNoAncestorIs(oe)},N.prototype.whenAnyAncestorNamed=function(oe){return this._bindingWhenSyntax.whenAnyAncestorNamed(oe)},N.prototype.whenAnyAncestorTagged=function(oe,ne){return this._bindingWhenSyntax.whenAnyAncestorTagged(oe,ne)},N.prototype.whenNoAncestorNamed=function(oe){return this._bindingWhenSyntax.whenNoAncestorNamed(oe)},N.prototype.whenNoAncestorTagged=function(oe,ne){return this._bindingWhenSyntax.whenNoAncestorTagged(oe,ne)},N.prototype.whenAnyAncestorMatches=function(oe){return this._bindingWhenSyntax.whenAnyAncestorMatches(oe)},N.prototype.whenNoAncestorMatches=function(oe){return this._bindingWhenSyntax.whenNoAncestorMatches(oe)},N.prototype.onActivation=function(oe){return this._bindingOnSyntax.onActivation(oe)},N}();ie.BindingInWhenOnSyntax=fe},51811:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingOnSyntax=void 0;var J=F(98370),Y=function(){function g(fe){this._binding=fe}return g.prototype.onActivation=function(fe){return this._binding.onActivation=fe,new J.BindingWhenSyntax(this._binding)},g}();ie.BindingOnSyntax=Y},15451:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingToSyntax=void 0;var J=F(16674),Y=F(28421),g=F(74889),fe=F(71325),N=function(){function oe(ne){this._binding=ne}return oe.prototype.to=function(ne){return this._binding.type=Y.BindingTypeEnum.Instance,this._binding.implementationType=ne,new g.BindingInWhenOnSyntax(this._binding)},oe.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+J.INVALID_TO_SELF_VALUE);var ne=this._binding.serviceIdentifier;return this.to(ne)},oe.prototype.toConstantValue=function(ne){return this._binding.type=Y.BindingTypeEnum.ConstantValue,this._binding.cache=ne,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Y.BindingScopeEnum.Singleton,new fe.BindingWhenOnSyntax(this._binding)},oe.prototype.toDynamicValue=function(ne){return this._binding.type=Y.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ne,this._binding.implementationType=null,new g.BindingInWhenOnSyntax(this._binding)},oe.prototype.toConstructor=function(ne){return this._binding.type=Y.BindingTypeEnum.Constructor,this._binding.implementationType=ne,this._binding.scope=Y.BindingScopeEnum.Singleton,new fe.BindingWhenOnSyntax(this._binding)},oe.prototype.toFactory=function(ne){return this._binding.type=Y.BindingTypeEnum.Factory,this._binding.factory=ne,this._binding.scope=Y.BindingScopeEnum.Singleton,new fe.BindingWhenOnSyntax(this._binding)},oe.prototype.toFunction=function(ne){if(typeof ne!="function")throw new Error(J.INVALID_FUNCTION_BINDING);var we=this.toConstantValue(ne);return this._binding.type=Y.BindingTypeEnum.Function,this._binding.scope=Y.BindingScopeEnum.Singleton,we},oe.prototype.toAutoFactory=function(ne){return this._binding.type=Y.BindingTypeEnum.Factory,this._binding.factory=function(we){var re=function(){return we.container.get(ne)};return re},this._binding.scope=Y.BindingScopeEnum.Singleton,new fe.BindingWhenOnSyntax(this._binding)},oe.prototype.toProvider=function(ne){return this._binding.type=Y.BindingTypeEnum.Provider,this._binding.provider=ne,this._binding.scope=Y.BindingScopeEnum.Singleton,new fe.BindingWhenOnSyntax(this._binding)},oe.prototype.toService=function(ne){this.toDynamicValue(function(we){return we.container.get(ne)})},oe}();ie.BindingToSyntax=N},71325:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingWhenOnSyntax=void 0;var J=F(51811),Y=F(98370),g=function(){function fe(N){this._binding=N,this._bindingWhenSyntax=new Y.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new J.BindingOnSyntax(this._binding)}return fe.prototype.when=function(N){return this._bindingWhenSyntax.when(N)},fe.prototype.whenTargetNamed=function(N){return this._bindingWhenSyntax.whenTargetNamed(N)},fe.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},fe.prototype.whenTargetTagged=function(N,oe){return this._bindingWhenSyntax.whenTargetTagged(N,oe)},fe.prototype.whenInjectedInto=function(N){return this._bindingWhenSyntax.whenInjectedInto(N)},fe.prototype.whenParentNamed=function(N){return this._bindingWhenSyntax.whenParentNamed(N)},fe.prototype.whenParentTagged=function(N,oe){return this._bindingWhenSyntax.whenParentTagged(N,oe)},fe.prototype.whenAnyAncestorIs=function(N){return this._bindingWhenSyntax.whenAnyAncestorIs(N)},fe.prototype.whenNoAncestorIs=function(N){return this._bindingWhenSyntax.whenNoAncestorIs(N)},fe.prototype.whenAnyAncestorNamed=function(N){return this._bindingWhenSyntax.whenAnyAncestorNamed(N)},fe.prototype.whenAnyAncestorTagged=function(N,oe){return this._bindingWhenSyntax.whenAnyAncestorTagged(N,oe)},fe.prototype.whenNoAncestorNamed=function(N){return this._bindingWhenSyntax.whenNoAncestorNamed(N)},fe.prototype.whenNoAncestorTagged=function(N,oe){return this._bindingWhenSyntax.whenNoAncestorTagged(N,oe)},fe.prototype.whenAnyAncestorMatches=function(N){return this._bindingWhenSyntax.whenAnyAncestorMatches(N)},fe.prototype.whenNoAncestorMatches=function(N){return this._bindingWhenSyntax.whenNoAncestorMatches(N)},fe.prototype.onActivation=function(N){return this._bindingOnSyntax.onActivation(N)},fe}();ie.BindingWhenOnSyntax=g},98370:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.BindingWhenSyntax=void 0;var J=F(51811),Y=F(80758),g=function(){function fe(N){this._binding=N}return fe.prototype.when=function(N){return this._binding.constraint=N,new J.BindingOnSyntax(this._binding)},fe.prototype.whenTargetNamed=function(N){return this._binding.constraint=Y.namedConstraint(N),new J.BindingOnSyntax(this._binding)},fe.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(N){var oe=N.target!==null&&!N.target.isNamed()&&!N.target.isTagged();return oe},new J.BindingOnSyntax(this._binding)},fe.prototype.whenTargetTagged=function(N,oe){return this._binding.constraint=Y.taggedConstraint(N)(oe),new J.BindingOnSyntax(this._binding)},fe.prototype.whenInjectedInto=function(N){return this._binding.constraint=function(oe){return Y.typeConstraint(N)(oe.parentRequest)},new J.BindingOnSyntax(this._binding)},fe.prototype.whenParentNamed=function(N){return this._binding.constraint=function(oe){return Y.namedConstraint(N)(oe.parentRequest)},new J.BindingOnSyntax(this._binding)},fe.prototype.whenParentTagged=function(N,oe){return this._binding.constraint=function(ne){return Y.taggedConstraint(N)(oe)(ne.parentRequest)},new J.BindingOnSyntax(this._binding)},fe.prototype.whenAnyAncestorIs=function(N){return this._binding.constraint=function(oe){return Y.traverseAncerstors(oe,Y.typeConstraint(N))},new J.BindingOnSyntax(this._binding)},fe.prototype.whenNoAncestorIs=function(N){return this._binding.constraint=function(oe){return!Y.traverseAncerstors(oe,Y.typeConstraint(N))},new J.BindingOnSyntax(this._binding)},fe.prototype.whenAnyAncestorNamed=function(N){return this._binding.constraint=function(oe){return Y.traverseAncerstors(oe,Y.namedConstraint(N))},new J.BindingOnSyntax(this._binding)},fe.prototype.whenNoAncestorNamed=function(N){return this._binding.constraint=function(oe){return!Y.traverseAncerstors(oe,Y.namedConstraint(N))},new J.BindingOnSyntax(this._binding)},fe.prototype.whenAnyAncestorTagged=function(N,oe){return this._binding.constraint=function(ne){return Y.traverseAncerstors(ne,Y.taggedConstraint(N)(oe))},new J.BindingOnSyntax(this._binding)},fe.prototype.whenNoAncestorTagged=function(N,oe){return this._binding.constraint=function(ne){return!Y.traverseAncerstors(ne,Y.taggedConstraint(N)(oe))},new J.BindingOnSyntax(this._binding)},fe.prototype.whenAnyAncestorMatches=function(N){return this._binding.constraint=function(oe){return Y.traverseAncerstors(oe,N)},new J.BindingOnSyntax(this._binding)},fe.prototype.whenNoAncestorMatches=function(N){return this._binding.constraint=function(oe){return!Y.traverseAncerstors(oe,N)},new J.BindingOnSyntax(this._binding)},fe}();ie.BindingWhenSyntax=g},80758:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.typeConstraint=ie.namedConstraint=ie.taggedConstraint=ie.traverseAncerstors=void 0;var J=F(6867),Y=F(47738),g=function(ne,we){var re=ne.parentRequest;return re!==null?we(re)?!0:g(re,we):!1};ie.traverseAncerstors=g;var fe=function(ne){return function(we){var re=function(ke){return ke!==null&&ke.target!==null&&ke.target.matchesTag(ne)(we)};return re.metaData=new Y.Metadata(ne,we),re}};ie.taggedConstraint=fe;var N=fe(J.NAMED_TAG);ie.namedConstraint=N;var oe=function(ne){return function(we){var re=null;if(we!==null)if(re=we.bindings[0],typeof ne=="string"){var ke=re.serviceIdentifier;return ke===ne}else{var Ve=we.bindings[0].implementationType;return ne===Ve}return!1}};ie.typeConstraint=oe},70600:function(It,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.multiBindToService=void 0;var F=function(J){return function(Y){return function(){for(var g=[],fe=0;fe<arguments.length;fe++)g[fe]=arguments[fe];return g.forEach(function(N){return J.bind(N).toService(Y)})}}};ie.multiBindToService=F},85265:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.isStackOverflowExeption=void 0;var J=F(16674);function Y(g){return g instanceof RangeError||g.message===J.STACK_OVERFLOW}ie.isStackOverflowExeption=Y},37791:function(It,ie){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.id=void 0;var F=0;function J(){return F++}ie.id=J},55800:function(It,ie,F){"use strict";Object.defineProperty(ie,"__esModule",{value:!0}),ie.circularDependencyToException=ie.listMetadataForTarget=ie.listRegisteredBindingsForServiceIdentifier=ie.getServiceIdentifierAsString=ie.getFunctionName=void 0;var J=F(16674);function Y(re){if(typeof re=="function"){var ke=re;return ke.name}else{if(typeof re=="symbol")return re.toString();var ke=re;return ke}}ie.getServiceIdentifierAsString=Y;function g(re,ke,Ve){var Ne="",Je=Ve(re,ke);return Je.length!==0&&(Ne=`
Registered bindings:`,Je.forEach(function(Jt){var _t="Object";Jt.implementationType!==null&&(_t=we(Jt.implementationType)),Ne=Ne+`
 `+_t,Jt.constraint.metaData&&(Ne=Ne+" - "+Jt.constraint.metaData)})),Ne}ie.listRegisteredBindingsForServiceIdentifier=g;function fe(re,ke){return re.parentRequest===null?!1:re.parentRequest.serviceIdentifier===ke?!0:fe(re.parentRequest,ke)}function N(re){function ke(Ne,Je){Je===void 0&&(Je=[]);var Jt=Y(Ne.serviceIdentifier);return Je.push(Jt),Ne.parentRequest!==null?ke(Ne.parentRequest,Je):Je}var Ve=ke(re);return Ve.reverse().join(" --> ")}function oe(re){re.childRequests.forEach(function(ke){if(fe(ke,ke.serviceIdentifier)){var Ve=N(ke);throw new Error(J.CIRCULAR_DEPENDENCY+" "+Ve)}else oe(ke)})}ie.circularDependencyToException=oe;function ne(re,ke){if(ke.isTagged()||ke.isNamed()){var Ve="",Ne=ke.getNamedTag(),Je=ke.getCustomTags();return Ne!==null&&(Ve+=Ne.toString()+`
`),Je!==null&&Je.forEach(function(Jt){Ve+=Jt.toString()+`
`})," "+re+`
 `+re+" - "+Ve}else return" "+re}ie.listMetadataForTarget=ne;function we(re){if(re.name)return re.name;var ke=re.toString(),Ve=ke.match(/^function\s*([^\s(]+)/);return Ve?Ve[1]:"Anonymous function: "+ke}ie.getFunctionName=we},31745:function(It){"use strict";It.exports=F,It.exports.default=F;var ie=1e20;function F(N,oe,ne,we,re,ke){this.fontSize=N||24,this.buffer=oe===void 0?3:oe,this.cutoff=we||.25,this.fontFamily=re||"sans-serif",this.fontWeight=ke||"normal",this.radius=ne||8;var Ve=this.size=this.fontSize+this.buffer*2,Ne=Ve+this.buffer*2,Je=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Je?this.canvas=my.createOffscreenCanvas(Ve,Ve,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ve),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Ne*Ne),this.gridInner=new Float64Array(Ne*Ne),this.f=new Float64Array(Ne),this.z=new Float64Array(Ne+1),this.v=new Uint16Array(Ne),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Je?this.middle=Math.round(Ve/2*1):this.middle=Math.round(Ve/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function J(N,oe,ne,we,re,ke,Ve){ke.fill(ie,0,oe*ne),Ve.fill(0,0,oe*ne);for(var Ne=(oe-we)/2,Je=0;Je<re;Je++)for(var Jt=0;Jt<we;Jt++){var _t=(Je+Ne)*oe+Jt+Ne,Ut=N.data[4*(Je*we+Jt)+3]/255;if(Ut===1)ke[_t]=0,Ve[_t]=ie;else if(Ut===0)ke[_t]=ie,Ve[_t]=0;else{var Tt=Math.max(0,.5-Ut),vt=Math.max(0,Ut-.5);ke[_t]=Tt*Tt,Ve[_t]=vt*vt}}}function Y(N,oe,ne,we,re,ke,Ve){for(var Ne=0;Ne<oe*ne;Ne++){var Je=Math.sqrt(we[Ne])-Math.sqrt(re[Ne]);N[Ne]=Math.round(255-255*(Je/ke+Ve))}}F.prototype._draw=function(N,oe){var ne=this.ctx.measureText(N),we=ne.width,re=2*this.buffer,ke,Ve,Ne,Je,Jt,_t,Ut,Tt;oe&&this.useMetrics?(Jt=Math.floor(ne.actualBoundingBoxAscent),Tt=this.buffer+Math.ceil(ne.actualBoundingBoxAscent),_t=this.buffer,Ut=this.buffer,Ve=Math.min(this.size,Math.ceil(ne.actualBoundingBoxRight-ne.actualBoundingBoxLeft)),Je=Math.min(this.size-_t,Math.ceil(ne.actualBoundingBoxAscent+ne.actualBoundingBoxDescent)),ke=Ve+re,Ne=Je+re,this.ctx.textBaseline="alphabetic"):(ke=Ve=this.size,Ne=Je=this.size,Jt=19*this.fontSize/24,_t=Ut=0,Tt=this.middle,this.ctx.textBaseline="middle");var vt;Ve&&Je&&(this.ctx.clearRect(Ut,_t,Ve,Je),this.ctx.fillText(N,this.buffer,Tt),vt=this.ctx.getImageData(Ut,_t,Ve,Je));var pt=new Uint8ClampedArray(ke*Ne);return J(vt,ke,Ne,Ve,Je,this.gridOuter,this.gridInner),g(this.gridOuter,ke,Ne,this.f,this.v,this.z),g(this.gridInner,ke,Ne,this.f,this.v,this.z),Y(pt,ke,Ne,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:pt,metrics:{width:Ve,height:Je,sdfWidth:ke,sdfHeight:Ne,top:Jt,left:0,advance:we}}},F.prototype.draw=function(N){return this._draw(N,!1).data},F.prototype.drawWithMetrics=function(N){return this._draw(N,!0)};function g(N,oe,ne,we,re,ke){for(var Ve=0;Ve<oe;Ve++)fe(N,Ve,oe,ne,we,re,ke);for(var Ne=0;Ne<ne;Ne++)fe(N,Ne*oe,1,oe,we,re,ke)}function fe(N,oe,ne,we,re,ke,Ve){var Ne,Je,Jt,_t;for(ke[0]=0,Ve[0]=-ie,Ve[1]=ie,Ne=0;Ne<we;Ne++)re[Ne]=N[oe+Ne*ne];for(Ne=1,Je=0,Jt=0;Ne<we;Ne++){do _t=ke[Je],Jt=(re[Ne]-re[_t]+Ne*Ne-_t*_t)/(Ne-_t)/2;while(Jt<=Ve[Je]&&--Je>-1);Je++,ke[Je]=Ne,Ve[Je]=Jt,Ve[Je+1]=ie}for(Ne=0,Je=0;Ne<we;Ne++){for(;Ve[Je+1]<Ne;)Je++;_t=ke[Je],N[oe+Ne*ne]=re[_t]+(Ne-_t)*(Ne-_t)}}},18857:function(It,ie,F){"use strict";F.r(ie),F.d(ie,{Function:function(){return bu},Interpreter:function(){return _o},default:function(){return Ts},evaluate:function(){return Ol},vm:function(){return J}});var J={};F.r(J),F.d(J,{Script:function(){return Jo},compileFunction:function(){return kc},createContext:function(){return ec},runInContext:function(){return Yu},runInNewContext:function(){return fs}});var Y={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},g="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",fe={5:g,"5module":g+" export import",6:g+" const class extends export import super"},N=/^in(stanceof)?$/,oe="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ne="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",we=new RegExp("["+oe+"]"),re=new RegExp("["+oe+ne+"]");oe=ne=null;var ke=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Ve=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Ne(x,M){for(var z=65536,R=0;R<M.length;R+=2){if(z+=M[R],z>x)return!1;if(z+=M[R+1],z>=x)return!0}}function Je(x,M){return x<65?x===36:x<91?!0:x<97?x===95:x<123?!0:x<=65535?x>=170&&we.test(String.fromCharCode(x)):M===!1?!1:Ne(x,ke)}function Jt(x,M){return x<48?x===36:x<58?!0:x<65?!1:x<91?!0:x<97?x===95:x<123?!0:x<=65535?x>=170&&re.test(String.fromCharCode(x)):M===!1?!1:Ne(x,ke)||Ne(x,Ve)}var _t=function(M,z){z===void 0&&(z={}),this.label=M,this.keyword=z.keyword,this.beforeExpr=!!z.beforeExpr,this.startsExpr=!!z.startsExpr,this.isLoop=!!z.isLoop,this.isAssign=!!z.isAssign,this.prefix=!!z.prefix,this.postfix=!!z.postfix,this.binop=z.binop||null,this.updateContext=null};function Ut(x,M){return new _t(x,{beforeExpr:!0,binop:M})}var Tt={beforeExpr:!0},vt={startsExpr:!0},pt={};function Vt(x,M){return M===void 0&&(M={}),M.keyword=x,pt[x]=new _t(x,M)}var ee={num:new _t("num",vt),regexp:new _t("regexp",vt),string:new _t("string",vt),name:new _t("name",vt),eof:new _t("eof"),bracketL:new _t("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new _t("]"),braceL:new _t("{",{beforeExpr:!0,startsExpr:!0}),braceR:new _t("}"),parenL:new _t("(",{beforeExpr:!0,startsExpr:!0}),parenR:new _t(")"),comma:new _t(",",Tt),semi:new _t(";",Tt),colon:new _t(":",Tt),dot:new _t("."),question:new _t("?",Tt),questionDot:new _t("?."),arrow:new _t("=>",Tt),template:new _t("template"),invalidTemplate:new _t("invalidTemplate"),ellipsis:new _t("...",Tt),backQuote:new _t("`",vt),dollarBraceL:new _t("${",{beforeExpr:!0,startsExpr:!0}),eq:new _t("=",{beforeExpr:!0,isAssign:!0}),assign:new _t("_=",{beforeExpr:!0,isAssign:!0}),incDec:new _t("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new _t("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Ut("||",1),logicalAND:Ut("&&",2),bitwiseOR:Ut("|",3),bitwiseXOR:Ut("^",4),bitwiseAND:Ut("&",5),equality:Ut("==/!=/===/!==",6),relational:Ut("</>/<=/>=",7),bitShift:Ut("<</>>/>>>",8),plusMin:new _t("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Ut("%",10),star:Ut("*",10),slash:Ut("/",10),starstar:new _t("**",{beforeExpr:!0}),coalesce:Ut("??",1),_break:Vt("break"),_case:Vt("case",Tt),_catch:Vt("catch"),_continue:Vt("continue"),_debugger:Vt("debugger"),_default:Vt("default",Tt),_do:Vt("do",{isLoop:!0,beforeExpr:!0}),_else:Vt("else",Tt),_finally:Vt("finally"),_for:Vt("for",{isLoop:!0}),_function:Vt("function",vt),_if:Vt("if"),_return:Vt("return",Tt),_switch:Vt("switch"),_throw:Vt("throw",Tt),_try:Vt("try"),_var:Vt("var"),_const:Vt("const"),_while:Vt("while",{isLoop:!0}),_with:Vt("with"),_new:Vt("new",{beforeExpr:!0,startsExpr:!0}),_this:Vt("this",vt),_super:Vt("super",vt),_class:Vt("class",vt),_extends:Vt("extends",Tt),_export:Vt("export"),_import:Vt("import",vt),_null:Vt("null",vt),_true:Vt("true",vt),_false:Vt("false",vt),_in:Vt("in",{beforeExpr:!0,binop:7}),_instanceof:Vt("instanceof",{beforeExpr:!0,binop:7}),_typeof:Vt("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Vt("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Vt("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},rr=/\r\n?|\n|\u2028|\u2029/,At=new RegExp(rr.source,"g");function nt(x,M){return x===10||x===13||!M&&(x===8232||x===8233)}var Zt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,ut=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,nr=Object.prototype,Mr=nr.hasOwnProperty,q=nr.toString;function pe(x,M){return Mr.call(x,M)}var b=Array.isArray||function(x){return q.call(x)==="[object Array]"};function le(x){return new RegExp("^(?:"+x.replace(/ /g,"|")+")$")}var xe=function(M,z){this.line=M,this.column=z};xe.prototype.offset=function(M){return new xe(this.line,this.column+M)};var Qe=function(M,z,R){this.start=z,this.end=R,M.sourceFile!==null&&(this.source=M.sourceFile)};function xt(x,M){for(var z=1,R=0;;){At.lastIndex=R;var se=At.exec(x);if(se&&se.index<M)++z,R=se.index+se[0].length;else return new xe(z,M-R)}}var Bt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Fe(x){var M={};for(var z in Bt)M[z]=x&&pe(x,z)?x[z]:Bt[z];if(M.ecmaVersion>=2015&&(M.ecmaVersion-=2009),M.allowReserved==null&&(M.allowReserved=M.ecmaVersion<5),b(M.onToken)){var R=M.onToken;M.onToken=function(se){return R.push(se)}}return b(M.onComment)&&(M.onComment=bt(M,M.onComment)),M}function bt(x,M){return function(z,R,se,Ie,ct,Dt){var Rt={type:z?"Block":"Line",value:R,start:se,end:Ie};x.locations&&(Rt.loc=new Qe(this,ct,Dt)),x.ranges&&(Rt.range=[se,Ie]),M.push(Rt)}}var br=1,mr=2,An=br|mr,mn=4,wn=8,Ri=16,Qn=32,ii=64,Vi=128;function Ni(x,M){return mr|(x?mn:0)|(M?wn:0)}var ai=0,Vn=1,Yn=2,Li=3,ra=4,ri=5,Et=function(M,z,R){this.options=M=Fe(M),this.sourceFile=M.sourceFile,this.keywords=le(fe[M.ecmaVersion>=6?6:M.sourceType==="module"?"5module":5]);var se="";if(M.allowReserved!==!0){for(var Ie=M.ecmaVersion;!(se=Y[Ie]);Ie--);M.sourceType==="module"&&(se+=" await")}this.reservedWords=le(se);var ct=(se?se+" ":"")+Y.strict;this.reservedWordsStrict=le(ct),this.reservedWordsStrictBind=le(ct+" "+Y.strictBind),this.input=String(z),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(rr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=ee.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=M.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&M.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(br),this.regexpState=null},de={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Et.prototype.parse=function(){var M=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(M)},de.inFunction.get=function(){return(this.currentVarScope().flags&mr)>0},de.inGenerator.get=function(){return(this.currentVarScope().flags&wn)>0},de.inAsync.get=function(){return(this.currentVarScope().flags&mn)>0},de.allowSuper.get=function(){return(this.currentThisScope().flags&ii)>0},de.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Vi)>0},de.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Et.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&mr)>0},Et.extend=function(){for(var M=[],z=arguments.length;z--;)M[z]=arguments[z];for(var R=this,se=0;se<M.length;se++)R=M[se](R);return R},Et.parse=function(M,z){return new this(z,M).parse()},Et.parseExpressionAt=function(M,z,R){var se=new this(R,M,z);return se.nextToken(),se.parseExpression()},Et.tokenizer=function(M,z){return new this(z,M)},Object.defineProperties(Et.prototype,de);var V=Et.prototype,X=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;V.strictDirective=function(x){for(;;){ut.lastIndex=x,x+=ut.exec(this.input)[0].length;var M=X.exec(this.input.slice(x));if(!M)return!1;if((M[1]||M[2])==="use strict"){ut.lastIndex=x+M[0].length;var z=ut.exec(this.input),R=z.index+z[0].length,se=this.input.charAt(R);return se===";"||se==="}"||rr.test(z[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(se)||se==="!"&&this.input.charAt(R+1)==="=")}x+=M[0].length,ut.lastIndex=x,x+=ut.exec(this.input)[0].length,this.input[x]===";"&&x++}},V.eat=function(x){return this.type===x?(this.next(),!0):!1},V.isContextual=function(x){return this.type===ee.name&&this.value===x&&!this.containsEsc},V.eatContextual=function(x){return this.isContextual(x)?(this.next(),!0):!1},V.expectContextual=function(x){this.eatContextual(x)||this.unexpected()},V.canInsertSemicolon=function(){return this.type===ee.eof||this.type===ee.braceR||rr.test(this.input.slice(this.lastTokEnd,this.start))},V.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},V.semicolon=function(){!this.eat(ee.semi)&&!this.insertSemicolon()&&this.unexpected()},V.afterTrailingComma=function(x,M){if(this.type===x)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),M||this.next(),!0},V.expect=function(x){this.eat(x)||this.unexpected()},V.unexpected=function(x){this.raise(x!=null?x:this.start,"Unexpected token")};function k(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}V.checkPatternErrors=function(x,M){if(!!x){x.trailingComma>-1&&this.raiseRecoverable(x.trailingComma,"Comma is not permitted after the rest element");var z=M?x.parenthesizedAssign:x.parenthesizedBind;z>-1&&this.raiseRecoverable(z,"Parenthesized pattern")}},V.checkExpressionErrors=function(x,M){if(!x)return!1;var z=x.shorthandAssign,R=x.doubleProto;if(!M)return z>=0||R>=0;z>=0&&this.raise(z,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},V.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},V.isSimpleAssignTarget=function(x){return x.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(x.expression):x.type==="Identifier"||x.type==="MemberExpression"};var Ce=Et.prototype;Ce.parseTopLevel=function(x){var M={};for(x.body||(x.body=[]);this.type!==ee.eof;){var z=this.parseStatement(null,!0,M);x.body.push(z)}if(this.inModule)for(var R=0,se=Object.keys(this.undefinedExports);R<se.length;R+=1){var Ie=se[R];this.raiseRecoverable(this.undefinedExports[Ie].start,"Export '"+Ie+"' is not defined")}return this.adaptDirectivePrologue(x.body),this.next(),x.sourceType=this.options.sourceType,this.finishNode(x,"Program")};var et={kind:"loop"},Qt={kind:"switch"};Ce.isLet=function(x){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;ut.lastIndex=this.pos;var M=ut.exec(this.input),z=this.pos+M[0].length,R=this.input.charCodeAt(z);if(R===91)return!0;if(x)return!1;if(R===123)return!0;if(Je(R,!0)){for(var se=z+1;Jt(this.input.charCodeAt(se),!0);)++se;var Ie=this.input.slice(z,se);if(!N.test(Ie))return!0}return!1},Ce.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;ut.lastIndex=this.pos;var x=ut.exec(this.input),M=this.pos+x[0].length;return!rr.test(this.input.slice(this.pos,M))&&this.input.slice(M,M+8)==="function"&&(M+8===this.input.length||!Jt(this.input.charAt(M+8)))},Ce.parseStatement=function(x,M,z){var R=this.type,se=this.startNode(),Ie;switch(this.isLet(x)&&(R=ee._var,Ie="let"),R){case ee._break:case ee._continue:return this.parseBreakContinueStatement(se,R.keyword);case ee._debugger:return this.parseDebuggerStatement(se);case ee._do:return this.parseDoStatement(se);case ee._for:return this.parseForStatement(se);case ee._function:return x&&(this.strict||x!=="if"&&x!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(se,!1,!x);case ee._class:return x&&this.unexpected(),this.parseClass(se,!0);case ee._if:return this.parseIfStatement(se);case ee._return:return this.parseReturnStatement(se);case ee._switch:return this.parseSwitchStatement(se);case ee._throw:return this.parseThrowStatement(se);case ee._try:return this.parseTryStatement(se);case ee._const:case ee._var:return Ie=Ie||this.value,x&&Ie!=="var"&&this.unexpected(),this.parseVarStatement(se,Ie);case ee._while:return this.parseWhileStatement(se);case ee._with:return this.parseWithStatement(se);case ee.braceL:return this.parseBlock(!0,se);case ee.semi:return this.parseEmptyStatement(se);case ee._export:case ee._import:if(this.options.ecmaVersion>10&&R===ee._import){ut.lastIndex=this.pos;var ct=ut.exec(this.input),Dt=this.pos+ct[0].length,Rt=this.input.charCodeAt(Dt);if(Rt===40||Rt===46)return this.parseExpressionStatement(se,this.parseExpression())}return this.options.allowImportExportEverywhere||(M||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===ee._import?this.parseImport(se):this.parseExport(se,z);default:if(this.isAsyncFunction())return x&&this.unexpected(),this.next(),this.parseFunctionStatement(se,!0,!x);var wr=this.value,Br=this.parseExpression();return R===ee.name&&Br.type==="Identifier"&&this.eat(ee.colon)?this.parseLabeledStatement(se,wr,Br,x):this.parseExpressionStatement(se,Br)}},Ce.parseBreakContinueStatement=function(x,M){var z=M==="break";this.next(),this.eat(ee.semi)||this.insertSemicolon()?x.label=null:this.type!==ee.name?this.unexpected():(x.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var se=this.labels[R];if((x.label==null||se.name===x.label.name)&&(se.kind!=null&&(z||se.kind==="loop")||x.label&&z))break}return R===this.labels.length&&this.raise(x.start,"Unsyntactic "+M),this.finishNode(x,z?"BreakStatement":"ContinueStatement")},Ce.parseDebuggerStatement=function(x){return this.next(),this.semicolon(),this.finishNode(x,"DebuggerStatement")},Ce.parseDoStatement=function(x){return this.next(),this.labels.push(et),x.body=this.parseStatement("do"),this.labels.pop(),this.expect(ee._while),x.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(ee.semi):this.semicolon(),this.finishNode(x,"DoWhileStatement")},Ce.parseForStatement=function(x){this.next();var M=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(et),this.enterScope(0),this.expect(ee.parenL),this.type===ee.semi)return M>-1&&this.unexpected(M),this.parseFor(x,null);var z=this.isLet();if(this.type===ee._var||this.type===ee._const||z){var R=this.startNode(),se=z?"let":this.value;return this.next(),this.parseVar(R,!0,se),this.finishNode(R,"VariableDeclaration"),(this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===ee._in?M>-1&&this.unexpected(M):x.await=M>-1),this.parseForIn(x,R)):(M>-1&&this.unexpected(M),this.parseFor(x,R))}var Ie=new k,ct=this.parseExpression(!0,Ie);return this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===ee._in?M>-1&&this.unexpected(M):x.await=M>-1),this.toAssignable(ct,!1,Ie),this.checkLVal(ct),this.parseForIn(x,ct)):(this.checkExpressionErrors(Ie,!0),M>-1&&this.unexpected(M),this.parseFor(x,ct))},Ce.parseFunctionStatement=function(x,M,z){return this.next(),this.parseFunction(x,$e|(z?0:Ht),!1,M)},Ce.parseIfStatement=function(x){return this.next(),x.test=this.parseParenExpression(),x.consequent=this.parseStatement("if"),x.alternate=this.eat(ee._else)?this.parseStatement("if"):null,this.finishNode(x,"IfStatement")},Ce.parseReturnStatement=function(x){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(ee.semi)||this.insertSemicolon()?x.argument=null:(x.argument=this.parseExpression(),this.semicolon()),this.finishNode(x,"ReturnStatement")},Ce.parseSwitchStatement=function(x){this.next(),x.discriminant=this.parseParenExpression(),x.cases=[],this.expect(ee.braceL),this.labels.push(Qt),this.enterScope(0);for(var M,z=!1;this.type!==ee.braceR;)if(this.type===ee._case||this.type===ee._default){var R=this.type===ee._case;M&&this.finishNode(M,"SwitchCase"),x.cases.push(M=this.startNode()),M.consequent=[],this.next(),R?M.test=this.parseExpression():(z&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),z=!0,M.test=null),this.expect(ee.colon)}else M||this.unexpected(),M.consequent.push(this.parseStatement(null));return this.exitScope(),M&&this.finishNode(M,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(x,"SwitchStatement")},Ce.parseThrowStatement=function(x){return this.next(),rr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),x.argument=this.parseExpression(),this.semicolon(),this.finishNode(x,"ThrowStatement")};var Oe=[];Ce.parseTryStatement=function(x){if(this.next(),x.block=this.parseBlock(),x.handler=null,this.type===ee._catch){var M=this.startNode();if(this.next(),this.eat(ee.parenL)){M.param=this.parseBindingAtom();var z=M.param.type==="Identifier";this.enterScope(z?Qn:0),this.checkLVal(M.param,z?ra:Yn),this.expect(ee.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),M.param=null,this.enterScope(0);M.body=this.parseBlock(!1),this.exitScope(),x.handler=this.finishNode(M,"CatchClause")}return x.finalizer=this.eat(ee._finally)?this.parseBlock():null,!x.handler&&!x.finalizer&&this.raise(x.start,"Missing catch or finally clause"),this.finishNode(x,"TryStatement")},Ce.parseVarStatement=function(x,M){return this.next(),this.parseVar(x,!1,M),this.semicolon(),this.finishNode(x,"VariableDeclaration")},Ce.parseWhileStatement=function(x){return this.next(),x.test=this.parseParenExpression(),this.labels.push(et),x.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(x,"WhileStatement")},Ce.parseWithStatement=function(x){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),x.object=this.parseParenExpression(),x.body=this.parseStatement("with"),this.finishNode(x,"WithStatement")},Ce.parseEmptyStatement=function(x){return this.next(),this.finishNode(x,"EmptyStatement")},Ce.parseLabeledStatement=function(x,M,z,R){for(var se=0,Ie=this.labels;se<Ie.length;se+=1){var ct=Ie[se];ct.name===M&&this.raise(z.start,"Label '"+M+"' is already declared")}for(var Dt=this.type.isLoop?"loop":this.type===ee._switch?"switch":null,Rt=this.labels.length-1;Rt>=0;Rt--){var wr=this.labels[Rt];if(wr.statementStart===x.start)wr.statementStart=this.start,wr.kind=Dt;else break}return this.labels.push({name:M,kind:Dt,statementStart:this.start}),x.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),x.label=z,this.finishNode(x,"LabeledStatement")},Ce.parseExpressionStatement=function(x,M){return x.expression=M,this.semicolon(),this.finishNode(x,"ExpressionStatement")},Ce.parseBlock=function(x,M,z){for(x===void 0&&(x=!0),M===void 0&&(M=this.startNode()),M.body=[],this.expect(ee.braceL),x&&this.enterScope(0);this.type!==ee.braceR;){var R=this.parseStatement(null);M.body.push(R)}return z&&(this.strict=!1),this.next(),x&&this.exitScope(),this.finishNode(M,"BlockStatement")},Ce.parseFor=function(x,M){return x.init=M,this.expect(ee.semi),x.test=this.type===ee.semi?null:this.parseExpression(),this.expect(ee.semi),x.update=this.type===ee.parenR?null:this.parseExpression(),this.expect(ee.parenR),x.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(x,"ForStatement")},Ce.parseForIn=function(x,M){var z=this.type===ee._in;return this.next(),M.type==="VariableDeclaration"&&M.declarations[0].init!=null&&(!z||this.options.ecmaVersion<8||this.strict||M.kind!=="var"||M.declarations[0].id.type!=="Identifier")?this.raise(M.start,(z?"for-in":"for-of")+" loop variable declaration may not have an initializer"):M.type==="AssignmentPattern"&&this.raise(M.start,"Invalid left-hand side in for-loop"),x.left=M,x.right=z?this.parseExpression():this.parseMaybeAssign(),this.expect(ee.parenR),x.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(x,z?"ForInStatement":"ForOfStatement")},Ce.parseVar=function(x,M,z){for(x.declarations=[],x.kind=z;;){var R=this.startNode();if(this.parseVarId(R,z),this.eat(ee.eq)?R.init=this.parseMaybeAssign(M):z==="const"&&!(this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(M&&(this.type===ee._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,x.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(ee.comma))break}return x},Ce.parseVarId=function(x,M){x.id=this.parseBindingAtom(),this.checkLVal(x.id,M==="var"?Vn:Yn,!1)};var $e=1,Ht=2,or=4;Ce.parseFunction=function(x,M,z,R){this.initFunction(x),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===ee.star&&M&Ht&&this.unexpected(),x.generator=this.eat(ee.star)),this.options.ecmaVersion>=8&&(x.async=!!R),M&$e&&(x.id=M&or&&this.type!==ee.name?null:this.parseIdent(),x.id&&!(M&Ht)&&this.checkLVal(x.id,this.strict||x.generator||x.async?this.treatFunctionsAsVar?Vn:Yn:Li));var se=this.yieldPos,Ie=this.awaitPos,ct=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ni(x.async,x.generator)),M&$e||(x.id=this.type===ee.name?this.parseIdent():null),this.parseFunctionParams(x),this.parseFunctionBody(x,z,!1),this.yieldPos=se,this.awaitPos=Ie,this.awaitIdentPos=ct,this.finishNode(x,M&$e?"FunctionDeclaration":"FunctionExpression")},Ce.parseFunctionParams=function(x){this.expect(ee.parenL),x.params=this.parseBindingList(ee.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Ce.parseClass=function(x,M){this.next();var z=this.strict;this.strict=!0,this.parseClassId(x,M),this.parseClassSuper(x);var R=this.startNode(),se=!1;for(R.body=[],this.expect(ee.braceL);this.type!==ee.braceR;){var Ie=this.parseClassElement(x.superClass!==null);Ie&&(R.body.push(Ie),Ie.type==="MethodDefinition"&&Ie.kind==="constructor"&&(se&&this.raise(Ie.start,"Duplicate constructor in the same class"),se=!0))}return this.strict=z,this.next(),x.body=this.finishNode(R,"ClassBody"),this.finishNode(x,M?"ClassDeclaration":"ClassExpression")},Ce.parseClassElement=function(x){var M=this;if(this.eat(ee.semi))return null;var z=this.startNode(),R=function(Rt,wr){wr===void 0&&(wr=!1);var Br=M.start,Xn=M.startLoc;return M.eatContextual(Rt)?M.type!==ee.parenL&&(!wr||!M.canInsertSemicolon())?!0:(z.key&&M.unexpected(),z.computed=!1,z.key=M.startNodeAt(Br,Xn),z.key.name=Rt,M.finishNode(z.key,"Identifier"),!1):!1};z.kind="method",z.static=R("static");var se=this.eat(ee.star),Ie=!1;se||(this.options.ecmaVersion>=8&&R("async",!0)?(Ie=!0,se=this.options.ecmaVersion>=9&&this.eat(ee.star)):R("get")?z.kind="get":R("set")&&(z.kind="set")),z.key||this.parsePropertyName(z);var ct=z.key,Dt=!1;return!z.computed&&!z.static&&(ct.type==="Identifier"&&ct.name==="constructor"||ct.type==="Literal"&&ct.value==="constructor")?(z.kind!=="method"&&this.raise(ct.start,"Constructor can't have get/set modifier"),se&&this.raise(ct.start,"Constructor can't be a generator"),Ie&&this.raise(ct.start,"Constructor can't be an async method"),z.kind="constructor",Dt=x):z.static&&ct.type==="Identifier"&&ct.name==="prototype"&&this.raise(ct.start,"Classes may not have a static property named prototype"),this.parseClassMethod(z,se,Ie,Dt),z.kind==="get"&&z.value.params.length!==0&&this.raiseRecoverable(z.value.start,"getter should have no params"),z.kind==="set"&&z.value.params.length!==1&&this.raiseRecoverable(z.value.start,"setter should have exactly one param"),z.kind==="set"&&z.value.params[0].type==="RestElement"&&this.raiseRecoverable(z.value.params[0].start,"Setter cannot use rest params"),z},Ce.parseClassMethod=function(x,M,z,R){return x.value=this.parseMethod(M,z,R),this.finishNode(x,"MethodDefinition")},Ce.parseClassId=function(x,M){this.type===ee.name?(x.id=this.parseIdent(),M&&this.checkLVal(x.id,Yn,!1)):(M===!0&&this.unexpected(),x.id=null)},Ce.parseClassSuper=function(x){x.superClass=this.eat(ee._extends)?this.parseExprSubscripts():null},Ce.parseExport=function(x,M){if(this.next(),this.eat(ee.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(x.exported=this.parseIdent(!0),this.checkExport(M,x.exported.name,this.lastTokStart)):x.exported=null),this.expectContextual("from"),this.type!==ee.string&&this.unexpected(),x.source=this.parseExprAtom(),this.semicolon(),this.finishNode(x,"ExportAllDeclaration");if(this.eat(ee._default)){this.checkExport(M,"default",this.lastTokStart);var z;if(this.type===ee._function||(z=this.isAsyncFunction())){var R=this.startNode();this.next(),z&&this.next(),x.declaration=this.parseFunction(R,$e|or,!1,z)}else if(this.type===ee._class){var se=this.startNode();x.declaration=this.parseClass(se,"nullableID")}else x.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(x,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())x.declaration=this.parseStatement(null),x.declaration.type==="VariableDeclaration"?this.checkVariableExport(M,x.declaration.declarations):this.checkExport(M,x.declaration.id.name,x.declaration.id.start),x.specifiers=[],x.source=null;else{if(x.declaration=null,x.specifiers=this.parseExportSpecifiers(M),this.eatContextual("from"))this.type!==ee.string&&this.unexpected(),x.source=this.parseExprAtom();else{for(var Ie=0,ct=x.specifiers;Ie<ct.length;Ie+=1){var Dt=ct[Ie];this.checkUnreserved(Dt.local),this.checkLocalExport(Dt.local)}x.source=null}this.semicolon()}return this.finishNode(x,"ExportNamedDeclaration")},Ce.checkExport=function(x,M,z){!x||(pe(x,M)&&this.raiseRecoverable(z,"Duplicate export '"+M+"'"),x[M]=!0)},Ce.checkPatternExport=function(x,M){var z=M.type;if(z==="Identifier")this.checkExport(x,M.name,M.start);else if(z==="ObjectPattern")for(var R=0,se=M.properties;R<se.length;R+=1){var Ie=se[R];this.checkPatternExport(x,Ie)}else if(z==="ArrayPattern")for(var ct=0,Dt=M.elements;ct<Dt.length;ct+=1){var Rt=Dt[ct];Rt&&this.checkPatternExport(x,Rt)}else z==="Property"?this.checkPatternExport(x,M.value):z==="AssignmentPattern"?this.checkPatternExport(x,M.left):z==="RestElement"?this.checkPatternExport(x,M.argument):z==="ParenthesizedExpression"&&this.checkPatternExport(x,M.expression)},Ce.checkVariableExport=function(x,M){if(!!x)for(var z=0,R=M;z<R.length;z+=1){var se=R[z];this.checkPatternExport(x,se.id)}},Ce.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Ce.parseExportSpecifiers=function(x){var M=[],z=!0;for(this.expect(ee.braceL);!this.eat(ee.braceR);){if(z)z=!1;else if(this.expect(ee.comma),this.afterTrailingComma(ee.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(x,R.exported.name,R.exported.start),M.push(this.finishNode(R,"ExportSpecifier"))}return M},Ce.parseImport=function(x){return this.next(),this.type===ee.string?(x.specifiers=Oe,x.source=this.parseExprAtom()):(x.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),x.source=this.type===ee.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(x,"ImportDeclaration")},Ce.parseImportSpecifiers=function(){var x=[],M=!0;if(this.type===ee.name){var z=this.startNode();if(z.local=this.parseIdent(),this.checkLVal(z.local,Yn),x.push(this.finishNode(z,"ImportDefaultSpecifier")),!this.eat(ee.comma))return x}if(this.type===ee.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,Yn),x.push(this.finishNode(R,"ImportNamespaceSpecifier")),x}for(this.expect(ee.braceL);!this.eat(ee.braceR);){if(M)M=!1;else if(this.expect(ee.comma),this.afterTrailingComma(ee.braceR))break;var se=this.startNode();se.imported=this.parseIdent(!0),this.eatContextual("as")?se.local=this.parseIdent():(this.checkUnreserved(se.imported),se.local=se.imported),this.checkLVal(se.local,Yn),x.push(this.finishNode(se,"ImportSpecifier"))}return x},Ce.adaptDirectivePrologue=function(x){for(var M=0;M<x.length&&this.isDirectiveCandidate(x[M]);++M)x[M].directive=x[M].expression.raw.slice(1,-1)},Ce.isDirectiveCandidate=function(x){return x.type==="ExpressionStatement"&&x.expression.type==="Literal"&&typeof x.expression.value=="string"&&(this.input[x.start]==='"'||this.input[x.start]==="'")};var pr=Et.prototype;pr.toAssignable=function(x,M,z){if(this.options.ecmaVersion>=6&&x)switch(x.type){case"Identifier":this.inAsync&&x.name==="await"&&this.raise(x.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":x.type="ObjectPattern",z&&this.checkPatternErrors(z,!0);for(var R=0,se=x.properties;R<se.length;R+=1){var Ie=se[R];this.toAssignable(Ie,M),Ie.type==="RestElement"&&(Ie.argument.type==="ArrayPattern"||Ie.argument.type==="ObjectPattern")&&this.raise(Ie.argument.start,"Unexpected token")}break;case"Property":x.kind!=="init"&&this.raise(x.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(x.value,M);break;case"ArrayExpression":x.type="ArrayPattern",z&&this.checkPatternErrors(z,!0),this.toAssignableList(x.elements,M);break;case"SpreadElement":x.type="RestElement",this.toAssignable(x.argument,M),x.argument.type==="AssignmentPattern"&&this.raise(x.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":x.operator!=="="&&this.raise(x.left.end,"Only '=' operator can be used for specifying default value."),x.type="AssignmentPattern",delete x.operator,this.toAssignable(x.left,M);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(x.expression,M,z);break;case"ChainExpression":this.raiseRecoverable(x.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!M)break;default:this.raise(x.start,"Assigning to rvalue")}else z&&this.checkPatternErrors(z,!0);return x},pr.toAssignableList=function(x,M){for(var z=x.length,R=0;R<z;R++){var se=x[R];se&&this.toAssignable(se,M)}if(z){var Ie=x[z-1];this.options.ecmaVersion===6&&M&&Ie&&Ie.type==="RestElement"&&Ie.argument.type!=="Identifier"&&this.unexpected(Ie.argument.start)}return x},pr.parseSpread=function(x){var M=this.startNode();return this.next(),M.argument=this.parseMaybeAssign(!1,x),this.finishNode(M,"SpreadElement")},pr.parseRestBinding=function(){var x=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==ee.name&&this.unexpected(),x.argument=this.parseBindingAtom(),this.finishNode(x,"RestElement")},pr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case ee.bracketL:var x=this.startNode();return this.next(),x.elements=this.parseBindingList(ee.bracketR,!0,!0),this.finishNode(x,"ArrayPattern");case ee.braceL:return this.parseObj(!0)}return this.parseIdent()},pr.parseBindingList=function(x,M,z){for(var R=[],se=!0;!this.eat(x);)if(se?se=!1:this.expect(ee.comma),M&&this.type===ee.comma)R.push(null);else{if(z&&this.afterTrailingComma(x))break;if(this.type===ee.ellipsis){var Ie=this.parseRestBinding();this.parseBindingListItem(Ie),R.push(Ie),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(x);break}else{var ct=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(ct),R.push(ct)}}return R},pr.parseBindingListItem=function(x){return x},pr.parseMaybeDefault=function(x,M,z){if(z=z||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(ee.eq))return z;var R=this.startNodeAt(x,M);return R.left=z,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},pr.checkLVal=function(x,M,z){switch(M===void 0&&(M=ai),x.type){case"Identifier":M===Yn&&x.name==="let"&&this.raiseRecoverable(x.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(x.name)&&this.raiseRecoverable(x.start,(M?"Binding ":"Assigning to ")+x.name+" in strict mode"),z&&(pe(z,x.name)&&this.raiseRecoverable(x.start,"Argument name clash"),z[x.name]=!0),M!==ai&&M!==ri&&this.declareName(x.name,M,x.start);break;case"ChainExpression":this.raiseRecoverable(x.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":M&&this.raiseRecoverable(x.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,se=x.properties;R<se.length;R+=1){var Ie=se[R];this.checkLVal(Ie,M,z)}break;case"Property":this.checkLVal(x.value,M,z);break;case"ArrayPattern":for(var ct=0,Dt=x.elements;ct<Dt.length;ct+=1){var Rt=Dt[ct];Rt&&this.checkLVal(Rt,M,z)}break;case"AssignmentPattern":this.checkLVal(x.left,M,z);break;case"RestElement":this.checkLVal(x.argument,M,z);break;case"ParenthesizedExpression":this.checkLVal(x.expression,M,z);break;default:this.raise(x.start,(M?"Binding":"Assigning to")+" rvalue")}};var xr=Et.prototype;xr.checkPropClash=function(x,M,z){if(!(this.options.ecmaVersion>=9&&x.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(x.computed||x.method||x.shorthand))){var R=x.key,se;switch(R.type){case"Identifier":se=R.name;break;case"Literal":se=String(R.value);break;default:return}var Ie=x.kind;if(this.options.ecmaVersion>=6){se==="__proto__"&&Ie==="init"&&(M.proto&&(z?z.doubleProto<0&&(z.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),M.proto=!0);return}se="$"+se;var ct=M[se];if(ct){var Dt;Ie==="init"?Dt=this.strict&&ct.init||ct.get||ct.set:Dt=ct.init||ct[Ie],Dt&&this.raiseRecoverable(R.start,"Redefinition of property")}else ct=M[se]={init:!1,get:!1,set:!1};ct[Ie]=!0}},xr.parseExpression=function(x,M){var z=this.start,R=this.startLoc,se=this.parseMaybeAssign(x,M);if(this.type===ee.comma){var Ie=this.startNodeAt(z,R);for(Ie.expressions=[se];this.eat(ee.comma);)Ie.expressions.push(this.parseMaybeAssign(x,M));return this.finishNode(Ie,"SequenceExpression")}return se},xr.parseMaybeAssign=function(x,M,z){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(x);this.exprAllowed=!1}var R=!1,se=-1,Ie=-1;M?(se=M.parenthesizedAssign,Ie=M.trailingComma,M.parenthesizedAssign=M.trailingComma=-1):(M=new k,R=!0);var ct=this.start,Dt=this.startLoc;(this.type===ee.parenL||this.type===ee.name)&&(this.potentialArrowAt=this.start);var Rt=this.parseMaybeConditional(x,M);if(z&&(Rt=z.call(this,Rt,ct,Dt)),this.type.isAssign){var wr=this.startNodeAt(ct,Dt);return wr.operator=this.value,wr.left=this.type===ee.eq?this.toAssignable(Rt,!1,M):Rt,R||(M.parenthesizedAssign=M.trailingComma=M.doubleProto=-1),M.shorthandAssign>=wr.left.start&&(M.shorthandAssign=-1),this.checkLVal(Rt),this.next(),wr.right=this.parseMaybeAssign(x),this.finishNode(wr,"AssignmentExpression")}else R&&this.checkExpressionErrors(M,!0);return se>-1&&(M.parenthesizedAssign=se),Ie>-1&&(M.trailingComma=Ie),Rt},xr.parseMaybeConditional=function(x,M){var z=this.start,R=this.startLoc,se=this.parseExprOps(x,M);if(this.checkExpressionErrors(M))return se;if(this.eat(ee.question)){var Ie=this.startNodeAt(z,R);return Ie.test=se,Ie.consequent=this.parseMaybeAssign(),this.expect(ee.colon),Ie.alternate=this.parseMaybeAssign(x),this.finishNode(Ie,"ConditionalExpression")}return se},xr.parseExprOps=function(x,M){var z=this.start,R=this.startLoc,se=this.parseMaybeUnary(M,!1);return this.checkExpressionErrors(M)||se.start===z&&se.type==="ArrowFunctionExpression"?se:this.parseExprOp(se,z,R,-1,x)},xr.parseExprOp=function(x,M,z,R,se){var Ie=this.type.binop;if(Ie!=null&&(!se||this.type!==ee._in)&&Ie>R){var ct=this.type===ee.logicalOR||this.type===ee.logicalAND,Dt=this.type===ee.coalesce;Dt&&(Ie=ee.logicalAND.binop);var Rt=this.value;this.next();var wr=this.start,Br=this.startLoc,Xn=this.parseExprOp(this.parseMaybeUnary(null,!1),wr,Br,Ie,se),bi=this.buildBinary(M,z,x,Xn,Rt,ct||Dt);return(ct&&this.type===ee.coalesce||Dt&&(this.type===ee.logicalOR||this.type===ee.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(bi,M,z,R,se)}return x},xr.buildBinary=function(x,M,z,R,se,Ie){var ct=this.startNodeAt(x,M);return ct.left=z,ct.operator=se,ct.right=R,this.finishNode(ct,Ie?"LogicalExpression":"BinaryExpression")},xr.parseMaybeUnary=function(x,M){var z=this.start,R=this.startLoc,se;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))se=this.parseAwait(),M=!0;else if(this.type.prefix){var Ie=this.startNode(),ct=this.type===ee.incDec;Ie.operator=this.value,Ie.prefix=!0,this.next(),Ie.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(x,!0),ct?this.checkLVal(Ie.argument):this.strict&&Ie.operator==="delete"&&Ie.argument.type==="Identifier"?this.raiseRecoverable(Ie.start,"Deleting local variable in strict mode"):M=!0,se=this.finishNode(Ie,ct?"UpdateExpression":"UnaryExpression")}else{if(se=this.parseExprSubscripts(x),this.checkExpressionErrors(x))return se;for(;this.type.postfix&&!this.canInsertSemicolon();){var Dt=this.startNodeAt(z,R);Dt.operator=this.value,Dt.prefix=!1,Dt.argument=se,this.checkLVal(se),this.next(),se=this.finishNode(Dt,"UpdateExpression")}}return!M&&this.eat(ee.starstar)?this.buildBinary(z,R,se,this.parseMaybeUnary(null,!1),"**",!1):se},xr.parseExprSubscripts=function(x){var M=this.start,z=this.startLoc,R=this.parseExprAtom(x);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var se=this.parseSubscripts(R,M,z);return x&&se.type==="MemberExpression"&&(x.parenthesizedAssign>=se.start&&(x.parenthesizedAssign=-1),x.parenthesizedBind>=se.start&&(x.parenthesizedBind=-1)),se},xr.parseSubscripts=function(x,M,z,R){for(var se=this.options.ecmaVersion>=8&&x.type==="Identifier"&&x.name==="async"&&this.lastTokEnd===x.end&&!this.canInsertSemicolon()&&x.end-x.start==5&&this.potentialArrowAt===x.start,Ie=!1;;){var ct=this.parseSubscript(x,M,z,R,se,Ie);if(ct.optional&&(Ie=!0),ct===x||ct.type==="ArrowFunctionExpression"){if(Ie){var Dt=this.startNodeAt(M,z);Dt.expression=ct,ct=this.finishNode(Dt,"ChainExpression")}return ct}x=ct}},xr.parseSubscript=function(x,M,z,R,se,Ie){var ct=this.options.ecmaVersion>=11,Dt=ct&&this.eat(ee.questionDot);R&&Dt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Rt=this.eat(ee.bracketL);if(Rt||Dt&&this.type!==ee.parenL&&this.type!==ee.backQuote||this.eat(ee.dot)){var wr=this.startNodeAt(M,z);wr.object=x,wr.property=Rt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),wr.computed=!!Rt,Rt&&this.expect(ee.bracketR),ct&&(wr.optional=Dt),x=this.finishNode(wr,"MemberExpression")}else if(!R&&this.eat(ee.parenL)){var Br=new k,Xn=this.yieldPos,bi=this.awaitPos,ci=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Ei=this.parseExprList(ee.parenR,this.options.ecmaVersion>=8,!1,Br);if(se&&!Dt&&!this.canInsertSemicolon()&&this.eat(ee.arrow))return this.checkPatternErrors(Br,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Xn,this.awaitPos=bi,this.awaitIdentPos=ci,this.parseArrowExpression(this.startNodeAt(M,z),Ei,!0);this.checkExpressionErrors(Br,!0),this.yieldPos=Xn||this.yieldPos,this.awaitPos=bi||this.awaitPos,this.awaitIdentPos=ci||this.awaitIdentPos;var ua=this.startNodeAt(M,z);ua.callee=x,ua.arguments=Ei,ct&&(ua.optional=Dt),x=this.finishNode(ua,"CallExpression")}else if(this.type===ee.backQuote){(Dt||Ie)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ca=this.startNodeAt(M,z);Ca.tag=x,Ca.quasi=this.parseTemplate({isTagged:!0}),x=this.finishNode(Ca,"TaggedTemplateExpression")}return x},xr.parseExprAtom=function(x){this.type===ee.slash&&this.readRegexp();var M,z=this.potentialArrowAt===this.start;switch(this.type){case ee._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),M=this.startNode(),this.next(),this.type===ee.parenL&&!this.allowDirectSuper&&this.raise(M.start,"super() call outside constructor of a subclass"),this.type!==ee.dot&&this.type!==ee.bracketL&&this.type!==ee.parenL&&this.unexpected(),this.finishNode(M,"Super");case ee._this:return M=this.startNode(),this.next(),this.finishNode(M,"ThisExpression");case ee.name:var R=this.start,se=this.startLoc,Ie=this.containsEsc,ct=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Ie&&ct.name==="async"&&!this.canInsertSemicolon()&&this.eat(ee._function))return this.parseFunction(this.startNodeAt(R,se),0,!1,!0);if(z&&!this.canInsertSemicolon()){if(this.eat(ee.arrow))return this.parseArrowExpression(this.startNodeAt(R,se),[ct],!1);if(this.options.ecmaVersion>=8&&ct.name==="async"&&this.type===ee.name&&!Ie)return ct=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(ee.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,se),[ct],!0)}return ct;case ee.regexp:var Dt=this.value;return M=this.parseLiteral(Dt.value),M.regex={pattern:Dt.pattern,flags:Dt.flags},M;case ee.num:case ee.string:return this.parseLiteral(this.value);case ee._null:case ee._true:case ee._false:return M=this.startNode(),M.value=this.type===ee._null?null:this.type===ee._true,M.raw=this.type.keyword,this.next(),this.finishNode(M,"Literal");case ee.parenL:var Rt=this.start,wr=this.parseParenAndDistinguishExpression(z);return x&&(x.parenthesizedAssign<0&&!this.isSimpleAssignTarget(wr)&&(x.parenthesizedAssign=Rt),x.parenthesizedBind<0&&(x.parenthesizedBind=Rt)),wr;case ee.bracketL:return M=this.startNode(),this.next(),M.elements=this.parseExprList(ee.bracketR,!0,!0,x),this.finishNode(M,"ArrayExpression");case ee.braceL:return this.parseObj(!1,x);case ee._function:return M=this.startNode(),this.next(),this.parseFunction(M,0);case ee._class:return this.parseClass(this.startNode(),!1);case ee._new:return this.parseNew();case ee.backQuote:return this.parseTemplate();case ee._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},xr.parseExprImport=function(){var x=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var M=this.parseIdent(!0);switch(this.type){case ee.parenL:return this.parseDynamicImport(x);case ee.dot:return x.meta=M,this.parseImportMeta(x);default:this.unexpected()}},xr.parseDynamicImport=function(x){if(this.next(),x.source=this.parseMaybeAssign(),!this.eat(ee.parenR)){var M=this.start;this.eat(ee.comma)&&this.eat(ee.parenR)?this.raiseRecoverable(M,"Trailing comma is not allowed in import()"):this.unexpected(M)}return this.finishNode(x,"ImportExpression")},xr.parseImportMeta=function(x){this.next();var M=this.containsEsc;return x.property=this.parseIdent(!0),x.property.name!=="meta"&&this.raiseRecoverable(x.property.start,"The only valid meta property for import is 'import.meta'"),M&&this.raiseRecoverable(x.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(x.start,"Cannot use 'import.meta' outside a module"),this.finishNode(x,"MetaProperty")},xr.parseLiteral=function(x){var M=this.startNode();return M.value=x,M.raw=this.input.slice(this.start,this.end),M.raw.charCodeAt(M.raw.length-1)===110&&(M.bigint=M.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(M,"Literal")},xr.parseParenExpression=function(){this.expect(ee.parenL);var x=this.parseExpression();return this.expect(ee.parenR),x},xr.parseParenAndDistinguishExpression=function(x){var M=this.start,z=this.startLoc,R,se=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Ie=this.start,ct=this.startLoc,Dt=[],Rt=!0,wr=!1,Br=new k,Xn=this.yieldPos,bi=this.awaitPos,ci;for(this.yieldPos=0,this.awaitPos=0;this.type!==ee.parenR;)if(Rt?Rt=!1:this.expect(ee.comma),se&&this.afterTrailingComma(ee.parenR,!0)){wr=!0;break}else if(this.type===ee.ellipsis){ci=this.start,Dt.push(this.parseParenItem(this.parseRestBinding())),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Dt.push(this.parseMaybeAssign(!1,Br,this.parseParenItem));var Ei=this.start,ua=this.startLoc;if(this.expect(ee.parenR),x&&!this.canInsertSemicolon()&&this.eat(ee.arrow))return this.checkPatternErrors(Br,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Xn,this.awaitPos=bi,this.parseParenArrowList(M,z,Dt);(!Dt.length||wr)&&this.unexpected(this.lastTokStart),ci&&this.unexpected(ci),this.checkExpressionErrors(Br,!0),this.yieldPos=Xn||this.yieldPos,this.awaitPos=bi||this.awaitPos,Dt.length>1?(R=this.startNodeAt(Ie,ct),R.expressions=Dt,this.finishNodeAt(R,"SequenceExpression",Ei,ua)):R=Dt[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var Ca=this.startNodeAt(M,z);return Ca.expression=R,this.finishNode(Ca,"ParenthesizedExpression")}else return R},xr.parseParenItem=function(x){return x},xr.parseParenArrowList=function(x,M,z){return this.parseArrowExpression(this.startNodeAt(x,M),z)};var Qr=[];xr.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var x=this.startNode(),M=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(ee.dot)){x.meta=M;var z=this.containsEsc;return x.property=this.parseIdent(!0),x.property.name!=="target"&&this.raiseRecoverable(x.property.start,"The only valid meta property for new is 'new.target'"),z&&this.raiseRecoverable(x.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(x.start,"'new.target' can only be used in functions"),this.finishNode(x,"MetaProperty")}var R=this.start,se=this.startLoc,Ie=this.type===ee._import;return x.callee=this.parseSubscripts(this.parseExprAtom(),R,se,!0),Ie&&x.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(ee.parenL)?x.arguments=this.parseExprList(ee.parenR,this.options.ecmaVersion>=8,!1):x.arguments=Qr,this.finishNode(x,"NewExpression")},xr.parseTemplateElement=function(x){var M=x.isTagged,z=this.startNode();return this.type===ee.invalidTemplate?(M||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),z.value={raw:this.value,cooked:null}):z.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),z.tail=this.type===ee.backQuote,this.finishNode(z,"TemplateElement")},xr.parseTemplate=function(x){x===void 0&&(x={});var M=x.isTagged;M===void 0&&(M=!1);var z=this.startNode();this.next(),z.expressions=[];var R=this.parseTemplateElement({isTagged:M});for(z.quasis=[R];!R.tail;)this.type===ee.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(ee.dollarBraceL),z.expressions.push(this.parseExpression()),this.expect(ee.braceR),z.quasis.push(R=this.parseTemplateElement({isTagged:M}));return this.next(),this.finishNode(z,"TemplateLiteral")},xr.isAsyncProp=function(x){return!x.computed&&x.key.type==="Identifier"&&x.key.name==="async"&&(this.type===ee.name||this.type===ee.num||this.type===ee.string||this.type===ee.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===ee.star)&&!rr.test(this.input.slice(this.lastTokEnd,this.start))},xr.parseObj=function(x,M){var z=this.startNode(),R=!0,se={};for(z.properties=[],this.next();!this.eat(ee.braceR);){if(R)R=!1;else if(this.expect(ee.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(ee.braceR))break;var Ie=this.parseProperty(x,M);x||this.checkPropClash(Ie,se,M),z.properties.push(Ie)}return this.finishNode(z,x?"ObjectPattern":"ObjectExpression")},xr.parseProperty=function(x,M){var z=this.startNode(),R,se,Ie,ct;if(this.options.ecmaVersion>=9&&this.eat(ee.ellipsis))return x?(z.argument=this.parseIdent(!1),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(z,"RestElement")):(this.type===ee.parenL&&M&&(M.parenthesizedAssign<0&&(M.parenthesizedAssign=this.start),M.parenthesizedBind<0&&(M.parenthesizedBind=this.start)),z.argument=this.parseMaybeAssign(!1,M),this.type===ee.comma&&M&&M.trailingComma<0&&(M.trailingComma=this.start),this.finishNode(z,"SpreadElement"));this.options.ecmaVersion>=6&&(z.method=!1,z.shorthand=!1,(x||M)&&(Ie=this.start,ct=this.startLoc),x||(R=this.eat(ee.star)));var Dt=this.containsEsc;return this.parsePropertyName(z),!x&&!Dt&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(z)?(se=!0,R=this.options.ecmaVersion>=9&&this.eat(ee.star),this.parsePropertyName(z,M)):se=!1,this.parsePropertyValue(z,x,R,se,Ie,ct,M,Dt),this.finishNode(z,"Property")},xr.parsePropertyValue=function(x,M,z,R,se,Ie,ct,Dt){if((z||R)&&this.type===ee.colon&&this.unexpected(),this.eat(ee.colon))x.value=M?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,ct),x.kind="init";else if(this.options.ecmaVersion>=6&&this.type===ee.parenL)M&&this.unexpected(),x.kind="init",x.method=!0,x.value=this.parseMethod(z,R);else if(!M&&!Dt&&this.options.ecmaVersion>=5&&!x.computed&&x.key.type==="Identifier"&&(x.key.name==="get"||x.key.name==="set")&&this.type!==ee.comma&&this.type!==ee.braceR&&this.type!==ee.eq){(z||R)&&this.unexpected(),x.kind=x.key.name,this.parsePropertyName(x),x.value=this.parseMethod(!1);var Rt=x.kind==="get"?0:1;if(x.value.params.length!==Rt){var wr=x.value.start;x.kind==="get"?this.raiseRecoverable(wr,"getter should have no params"):this.raiseRecoverable(wr,"setter should have exactly one param")}else x.kind==="set"&&x.value.params[0].type==="RestElement"&&this.raiseRecoverable(x.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!x.computed&&x.key.type==="Identifier"?((z||R)&&this.unexpected(),this.checkUnreserved(x.key),x.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=se),x.kind="init",M?x.value=this.parseMaybeDefault(se,Ie,x.key):this.type===ee.eq&&ct?(ct.shorthandAssign<0&&(ct.shorthandAssign=this.start),x.value=this.parseMaybeDefault(se,Ie,x.key)):x.value=x.key,x.shorthand=!0):this.unexpected()},xr.parsePropertyName=function(x){if(this.options.ecmaVersion>=6){if(this.eat(ee.bracketL))return x.computed=!0,x.key=this.parseMaybeAssign(),this.expect(ee.bracketR),x.key;x.computed=!1}return x.key=this.type===ee.num||this.type===ee.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},xr.initFunction=function(x){x.id=null,this.options.ecmaVersion>=6&&(x.generator=x.expression=!1),this.options.ecmaVersion>=8&&(x.async=!1)},xr.parseMethod=function(x,M,z){var R=this.startNode(),se=this.yieldPos,Ie=this.awaitPos,ct=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=x),this.options.ecmaVersion>=8&&(R.async=!!M),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ni(M,R.generator)|ii|(z?Vi:0)),this.expect(ee.parenL),R.params=this.parseBindingList(ee.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=se,this.awaitPos=Ie,this.awaitIdentPos=ct,this.finishNode(R,"FunctionExpression")},xr.parseArrowExpression=function(x,M,z){var R=this.yieldPos,se=this.awaitPos,Ie=this.awaitIdentPos;return this.enterScope(Ni(z,!1)|Ri),this.initFunction(x),this.options.ecmaVersion>=8&&(x.async=!!z),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,x.params=this.toAssignableList(M,!0),this.parseFunctionBody(x,!0,!1),this.yieldPos=R,this.awaitPos=se,this.awaitIdentPos=Ie,this.finishNode(x,"ArrowFunctionExpression")},xr.parseFunctionBody=function(x,M,z){var R=M&&this.type!==ee.braceL,se=this.strict,Ie=!1;if(R)x.body=this.parseMaybeAssign(),x.expression=!0,this.checkParams(x,!1);else{var ct=this.options.ecmaVersion>=7&&!this.isSimpleParamList(x.params);(!se||ct)&&(Ie=this.strictDirective(this.end),Ie&&ct&&this.raiseRecoverable(x.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Dt=this.labels;this.labels=[],Ie&&(this.strict=!0),this.checkParams(x,!se&&!Ie&&!M&&!z&&this.isSimpleParamList(x.params)),this.strict&&x.id&&this.checkLVal(x.id,ri),x.body=this.parseBlock(!1,void 0,Ie&&!se),x.expression=!1,this.adaptDirectivePrologue(x.body.body),this.labels=Dt}this.exitScope()},xr.isSimpleParamList=function(x){for(var M=0,z=x;M<z.length;M+=1){var R=z[M];if(R.type!=="Identifier")return!1}return!0},xr.checkParams=function(x,M){for(var z={},R=0,se=x.params;R<se.length;R+=1){var Ie=se[R];this.checkLVal(Ie,Vn,M?null:z)}},xr.parseExprList=function(x,M,z,R){for(var se=[],Ie=!0;!this.eat(x);){if(Ie)Ie=!1;else if(this.expect(ee.comma),M&&this.afterTrailingComma(x))break;var ct=void 0;z&&this.type===ee.comma?ct=null:this.type===ee.ellipsis?(ct=this.parseSpread(R),R&&this.type===ee.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):ct=this.parseMaybeAssign(!1,R),se.push(ct)}return se},xr.checkUnreserved=function(x){var M=x.start,z=x.end,R=x.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(M,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(M,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(M,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(M,z).indexOf("\\")!==-1)){var se=this.strict?this.reservedWordsStrict:this.reservedWords;se.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(M,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(M,"The keyword '"+R+"' is reserved"))}},xr.parseIdent=function(x,M){var z=this.startNode();return this.type===ee.name?z.name=this.value:this.type.keyword?(z.name=this.type.keyword,(z.name==="class"||z.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!x),this.finishNode(z,"Identifier"),x||(this.checkUnreserved(z),z.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=z.start)),z},xr.parseYield=function(x){this.yieldPos||(this.yieldPos=this.start);var M=this.startNode();return this.next(),this.type===ee.semi||this.canInsertSemicolon()||this.type!==ee.star&&!this.type.startsExpr?(M.delegate=!1,M.argument=null):(M.delegate=this.eat(ee.star),M.argument=this.parseMaybeAssign(x)),this.finishNode(M,"YieldExpression")},xr.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var x=this.startNode();return this.next(),x.argument=this.parseMaybeUnary(null,!1),this.finishNode(x,"AwaitExpression")};var en=Et.prototype;en.raise=function(x,M){var z=xt(this.input,x);M+=" ("+z.line+":"+z.column+")";var R=new SyntaxError(M);throw R.pos=x,R.loc=z,R.raisedAt=this.pos,R},en.raiseRecoverable=en.raise,en.curPosition=function(){if(this.options.locations)return new xe(this.curLine,this.pos-this.lineStart)};var Dr=Et.prototype,Wn=function(M){this.flags=M,this.var=[],this.lexical=[],this.functions=[]};Dr.enterScope=function(x){this.scopeStack.push(new Wn(x))},Dr.exitScope=function(){this.scopeStack.pop()},Dr.treatFunctionsAsVarInScope=function(x){return x.flags&mr||!this.inModule&&x.flags&br},Dr.declareName=function(x,M,z){var R=!1;if(M===Yn){var se=this.currentScope();R=se.lexical.indexOf(x)>-1||se.functions.indexOf(x)>-1||se.var.indexOf(x)>-1,se.lexical.push(x),this.inModule&&se.flags&br&&delete this.undefinedExports[x]}else if(M===ra){var Ie=this.currentScope();Ie.lexical.push(x)}else if(M===Li){var ct=this.currentScope();this.treatFunctionsAsVar?R=ct.lexical.indexOf(x)>-1:R=ct.lexical.indexOf(x)>-1||ct.var.indexOf(x)>-1,ct.functions.push(x)}else for(var Dt=this.scopeStack.length-1;Dt>=0;--Dt){var Rt=this.scopeStack[Dt];if(Rt.lexical.indexOf(x)>-1&&!(Rt.flags&Qn&&Rt.lexical[0]===x)||!this.treatFunctionsAsVarInScope(Rt)&&Rt.functions.indexOf(x)>-1){R=!0;break}if(Rt.var.push(x),this.inModule&&Rt.flags&br&&delete this.undefinedExports[x],Rt.flags&An)break}R&&this.raiseRecoverable(z,"Identifier '"+x+"' has already been declared")},Dr.checkLocalExport=function(x){this.scopeStack[0].lexical.indexOf(x.name)===-1&&this.scopeStack[0].var.indexOf(x.name)===-1&&(this.undefinedExports[x.name]=x)},Dr.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Dr.currentVarScope=function(){for(var x=this.scopeStack.length-1;;x--){var M=this.scopeStack[x];if(M.flags&An)return M}},Dr.currentThisScope=function(){for(var x=this.scopeStack.length-1;;x--){var M=this.scopeStack[x];if(M.flags&An&&!(M.flags&Ri))return M}};var qn=function(M,z,R){this.type="",this.start=z,this.end=0,M.options.locations&&(this.loc=new Qe(M,R)),M.options.directSourceFile&&(this.sourceFile=M.options.directSourceFile),M.options.ranges&&(this.range=[z,0])},ta=Et.prototype;ta.startNode=function(){return new qn(this,this.start,this.startLoc)},ta.startNodeAt=function(x,M){return new qn(this,x,M)};function na(x,M,z,R){return x.type=M,x.end=z,this.options.locations&&(x.loc.end=R),this.options.ranges&&(x.range[1]=z),x}ta.finishNode=function(x,M){return na.call(this,x,M,this.lastTokEnd,this.lastTokEndLoc)},ta.finishNodeAt=function(x,M,z,R){return na.call(this,x,M,z,R)};var ba=function(M,z,R,se,Ie){this.token=M,this.isExpr=!!z,this.preserveSpace=!!R,this.override=se,this.generator=!!Ie},ia={b_stat:new ba("{",!1),b_expr:new ba("{",!0),b_tmpl:new ba("${",!1),p_stat:new ba("(",!1),p_expr:new ba("(",!0),q_tmpl:new ba("`",!0,!0,function(x){return x.tryReadTemplateToken()}),f_stat:new ba("function",!1),f_expr:new ba("function",!0),f_expr_gen:new ba("function",!0,!1,null,!0),f_gen:new ba("function",!1,!1,null,!0)},Ki=Et.prototype;Ki.initialContext=function(){return[ia.b_stat]},Ki.braceIsBlock=function(x){var M=this.curContext();return M===ia.f_expr||M===ia.f_stat?!0:x===ee.colon&&(M===ia.b_stat||M===ia.b_expr)?!M.isExpr:x===ee._return||x===ee.name&&this.exprAllowed?rr.test(this.input.slice(this.lastTokEnd,this.start)):x===ee._else||x===ee.semi||x===ee.eof||x===ee.parenR||x===ee.arrow?!0:x===ee.braceL?M===ia.b_stat:x===ee._var||x===ee._const||x===ee.name?!1:!this.exprAllowed},Ki.inGeneratorContext=function(){for(var x=this.context.length-1;x>=1;x--){var M=this.context[x];if(M.token==="function")return M.generator}return!1},Ki.updateContext=function(x){var M,z=this.type;z.keyword&&x===ee.dot?this.exprAllowed=!1:(M=z.updateContext)?M.call(this,x):this.exprAllowed=z.beforeExpr},ee.parenR.updateContext=ee.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var x=this.context.pop();x===ia.b_stat&&this.curContext().token==="function"&&(x=this.context.pop()),this.exprAllowed=!x.isExpr},ee.braceL.updateContext=function(x){this.context.push(this.braceIsBlock(x)?ia.b_stat:ia.b_expr),this.exprAllowed=!0},ee.dollarBraceL.updateContext=function(){this.context.push(ia.b_tmpl),this.exprAllowed=!0},ee.parenL.updateContext=function(x){var M=x===ee._if||x===ee._for||x===ee._with||x===ee._while;this.context.push(M?ia.p_stat:ia.p_expr),this.exprAllowed=!0},ee.incDec.updateContext=function(){},ee._function.updateContext=ee._class.updateContext=function(x){x.beforeExpr&&x!==ee.semi&&x!==ee._else&&!(x===ee._return&&rr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((x===ee.colon||x===ee.braceL)&&this.curContext()===ia.b_stat)?this.context.push(ia.f_expr):this.context.push(ia.f_stat),this.exprAllowed=!1},ee.backQuote.updateContext=function(){this.curContext()===ia.q_tmpl?this.context.pop():this.context.push(ia.q_tmpl),this.exprAllowed=!1},ee.star.updateContext=function(x){if(x===ee._function){var M=this.context.length-1;this.context[M]===ia.f_expr?this.context[M]=ia.f_expr_gen:this.context[M]=ia.f_gen}this.exprAllowed=!0},ee.name.updateContext=function(x){var M=!1;this.options.ecmaVersion>=6&&x!==ee.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(M=!0),this.exprAllowed=M};var $="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ue=$+" Extended_Pictographic",ve=ue,Te={9:$,10:ue,11:ve},Ze="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",it="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",gt=it+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",be=gt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Ye={9:it,10:gt,11:be},jt={};function Ir(x){var M=jt[x]={binary:le(Te[x]+" "+Ze),nonBinary:{General_Category:le(Ze),Script:le(Ye[x])}};M.nonBinary.Script_Extensions=M.nonBinary.Script,M.nonBinary.gc=M.nonBinary.General_Category,M.nonBinary.sc=M.nonBinary.Script,M.nonBinary.scx=M.nonBinary.Script_Extensions}Ir(9),Ir(10),Ir(11);var sr=Et.prototype,cr=function(M){this.parser=M,this.validFlags="gim"+(M.options.ecmaVersion>=6?"uy":"")+(M.options.ecmaVersion>=9?"s":""),this.unicodeProperties=jt[M.options.ecmaVersion>=11?11:M.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};cr.prototype.reset=function(M,z,R){var se=R.indexOf("u")!==-1;this.start=M|0,this.source=z+"",this.flags=R,this.switchU=se&&this.parser.options.ecmaVersion>=6,this.switchN=se&&this.parser.options.ecmaVersion>=9},cr.prototype.raise=function(M){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+M)},cr.prototype.at=function(M,z){z===void 0&&(z=!1);var R=this.source,se=R.length;if(M>=se)return-1;var Ie=R.charCodeAt(M);if(!(z||this.switchU)||Ie<=55295||Ie>=57344||M+1>=se)return Ie;var ct=R.charCodeAt(M+1);return ct>=56320&&ct<=57343?(Ie<<10)+ct-56613888:Ie},cr.prototype.nextIndex=function(M,z){z===void 0&&(z=!1);var R=this.source,se=R.length;if(M>=se)return se;var Ie=R.charCodeAt(M),ct;return!(z||this.switchU)||Ie<=55295||Ie>=57344||M+1>=se||(ct=R.charCodeAt(M+1))<56320||ct>57343?M+1:M+2},cr.prototype.current=function(M){return M===void 0&&(M=!1),this.at(this.pos,M)},cr.prototype.lookahead=function(M){return M===void 0&&(M=!1),this.at(this.nextIndex(this.pos,M),M)},cr.prototype.advance=function(M){M===void 0&&(M=!1),this.pos=this.nextIndex(this.pos,M)},cr.prototype.eat=function(M,z){return z===void 0&&(z=!1),this.current(z)===M?(this.advance(z),!0):!1};function Rr(x){return x<=65535?String.fromCharCode(x):(x-=65536,String.fromCharCode((x>>10)+55296,(x&1023)+56320))}sr.validateRegExpFlags=function(x){for(var M=x.validFlags,z=x.flags,R=0;R<z.length;R++){var se=z.charAt(R);M.indexOf(se)===-1&&this.raise(x.start,"Invalid regular expression flag"),z.indexOf(se,R+1)>-1&&this.raise(x.start,"Duplicate regular expression flag")}},sr.validateRegExpPattern=function(x){this.regexp_pattern(x),!x.switchN&&this.options.ecmaVersion>=9&&x.groupNames.length>0&&(x.switchN=!0,this.regexp_pattern(x))},sr.regexp_pattern=function(x){x.pos=0,x.lastIntValue=0,x.lastStringValue="",x.lastAssertionIsQuantifiable=!1,x.numCapturingParens=0,x.maxBackReference=0,x.groupNames.length=0,x.backReferenceNames.length=0,this.regexp_disjunction(x),x.pos!==x.source.length&&(x.eat(41)&&x.raise("Unmatched ')'"),(x.eat(93)||x.eat(125))&&x.raise("Lone quantifier brackets")),x.maxBackReference>x.numCapturingParens&&x.raise("Invalid escape");for(var M=0,z=x.backReferenceNames;M<z.length;M+=1){var R=z[M];x.groupNames.indexOf(R)===-1&&x.raise("Invalid named capture referenced")}},sr.regexp_disjunction=function(x){for(this.regexp_alternative(x);x.eat(124);)this.regexp_alternative(x);this.regexp_eatQuantifier(x,!0)&&x.raise("Nothing to repeat"),x.eat(123)&&x.raise("Lone quantifier brackets")},sr.regexp_alternative=function(x){for(;x.pos<x.source.length&&this.regexp_eatTerm(x););},sr.regexp_eatTerm=function(x){return this.regexp_eatAssertion(x)?(x.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(x)&&x.switchU&&x.raise("Invalid quantifier"),!0):(x.switchU?this.regexp_eatAtom(x):this.regexp_eatExtendedAtom(x))?(this.regexp_eatQuantifier(x),!0):!1},sr.regexp_eatAssertion=function(x){var M=x.pos;if(x.lastAssertionIsQuantifiable=!1,x.eat(94)||x.eat(36))return!0;if(x.eat(92)){if(x.eat(66)||x.eat(98))return!0;x.pos=M}if(x.eat(40)&&x.eat(63)){var z=!1;if(this.options.ecmaVersion>=9&&(z=x.eat(60)),x.eat(61)||x.eat(33))return this.regexp_disjunction(x),x.eat(41)||x.raise("Unterminated group"),x.lastAssertionIsQuantifiable=!z,!0}return x.pos=M,!1},sr.regexp_eatQuantifier=function(x,M){return M===void 0&&(M=!1),this.regexp_eatQuantifierPrefix(x,M)?(x.eat(63),!0):!1},sr.regexp_eatQuantifierPrefix=function(x,M){return x.eat(42)||x.eat(43)||x.eat(63)||this.regexp_eatBracedQuantifier(x,M)},sr.regexp_eatBracedQuantifier=function(x,M){var z=x.pos;if(x.eat(123)){var R=0,se=-1;if(this.regexp_eatDecimalDigits(x)&&(R=x.lastIntValue,x.eat(44)&&this.regexp_eatDecimalDigits(x)&&(se=x.lastIntValue),x.eat(125)))return se!==-1&&se<R&&!M&&x.raise("numbers out of order in {} quantifier"),!0;x.switchU&&!M&&x.raise("Incomplete quantifier"),x.pos=z}return!1},sr.regexp_eatAtom=function(x){return this.regexp_eatPatternCharacters(x)||x.eat(46)||this.regexp_eatReverseSolidusAtomEscape(x)||this.regexp_eatCharacterClass(x)||this.regexp_eatUncapturingGroup(x)||this.regexp_eatCapturingGroup(x)},sr.regexp_eatReverseSolidusAtomEscape=function(x){var M=x.pos;if(x.eat(92)){if(this.regexp_eatAtomEscape(x))return!0;x.pos=M}return!1},sr.regexp_eatUncapturingGroup=function(x){var M=x.pos;if(x.eat(40)){if(x.eat(63)&&x.eat(58)){if(this.regexp_disjunction(x),x.eat(41))return!0;x.raise("Unterminated group")}x.pos=M}return!1},sr.regexp_eatCapturingGroup=function(x){if(x.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(x):x.current()===63&&x.raise("Invalid group"),this.regexp_disjunction(x),x.eat(41))return x.numCapturingParens+=1,!0;x.raise("Unterminated group")}return!1},sr.regexp_eatExtendedAtom=function(x){return x.eat(46)||this.regexp_eatReverseSolidusAtomEscape(x)||this.regexp_eatCharacterClass(x)||this.regexp_eatUncapturingGroup(x)||this.regexp_eatCapturingGroup(x)||this.regexp_eatInvalidBracedQuantifier(x)||this.regexp_eatExtendedPatternCharacter(x)},sr.regexp_eatInvalidBracedQuantifier=function(x){return this.regexp_eatBracedQuantifier(x,!0)&&x.raise("Nothing to repeat"),!1},sr.regexp_eatSyntaxCharacter=function(x){var M=x.current();return zn(M)?(x.lastIntValue=M,x.advance(),!0):!1};function zn(x){return x===36||x>=40&&x<=43||x===46||x===63||x>=91&&x<=94||x>=123&&x<=125}sr.regexp_eatPatternCharacters=function(x){for(var M=x.pos,z=0;(z=x.current())!==-1&&!zn(z);)x.advance();return x.pos!==M},sr.regexp_eatExtendedPatternCharacter=function(x){var M=x.current();return M!==-1&&M!==36&&!(M>=40&&M<=43)&&M!==46&&M!==63&&M!==91&&M!==94&&M!==124?(x.advance(),!0):!1},sr.regexp_groupSpecifier=function(x){if(x.eat(63)){if(this.regexp_eatGroupName(x)){x.groupNames.indexOf(x.lastStringValue)!==-1&&x.raise("Duplicate capture group name"),x.groupNames.push(x.lastStringValue);return}x.raise("Invalid group")}},sr.regexp_eatGroupName=function(x){if(x.lastStringValue="",x.eat(60)){if(this.regexp_eatRegExpIdentifierName(x)&&x.eat(62))return!0;x.raise("Invalid capture group name")}return!1},sr.regexp_eatRegExpIdentifierName=function(x){if(x.lastStringValue="",this.regexp_eatRegExpIdentifierStart(x)){for(x.lastStringValue+=Rr(x.lastIntValue);this.regexp_eatRegExpIdentifierPart(x);)x.lastStringValue+=Rr(x.lastIntValue);return!0}return!1},sr.regexp_eatRegExpIdentifierStart=function(x){var M=x.pos,z=this.options.ecmaVersion>=11,R=x.current(z);return x.advance(z),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(x,z)&&(R=x.lastIntValue),Tn(R)?(x.lastIntValue=R,!0):(x.pos=M,!1)};function Tn(x){return Je(x,!0)||x===36||x===95}sr.regexp_eatRegExpIdentifierPart=function(x){var M=x.pos,z=this.options.ecmaVersion>=11,R=x.current(z);return x.advance(z),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(x,z)&&(R=x.lastIntValue),tr(R)?(x.lastIntValue=R,!0):(x.pos=M,!1)};function tr(x){return Jt(x,!0)||x===36||x===95||x===8204||x===8205}sr.regexp_eatAtomEscape=function(x){return this.regexp_eatBackReference(x)||this.regexp_eatCharacterClassEscape(x)||this.regexp_eatCharacterEscape(x)||x.switchN&&this.regexp_eatKGroupName(x)?!0:(x.switchU&&(x.current()===99&&x.raise("Invalid unicode escape"),x.raise("Invalid escape")),!1)},sr.regexp_eatBackReference=function(x){var M=x.pos;if(this.regexp_eatDecimalEscape(x)){var z=x.lastIntValue;if(x.switchU)return z>x.maxBackReference&&(x.maxBackReference=z),!0;if(z<=x.numCapturingParens)return!0;x.pos=M}return!1},sr.regexp_eatKGroupName=function(x){if(x.eat(107)){if(this.regexp_eatGroupName(x))return x.backReferenceNames.push(x.lastStringValue),!0;x.raise("Invalid named reference")}return!1},sr.regexp_eatCharacterEscape=function(x){return this.regexp_eatControlEscape(x)||this.regexp_eatCControlLetter(x)||this.regexp_eatZero(x)||this.regexp_eatHexEscapeSequence(x)||this.regexp_eatRegExpUnicodeEscapeSequence(x,!1)||!x.switchU&&this.regexp_eatLegacyOctalEscapeSequence(x)||this.regexp_eatIdentityEscape(x)},sr.regexp_eatCControlLetter=function(x){var M=x.pos;if(x.eat(99)){if(this.regexp_eatControlLetter(x))return!0;x.pos=M}return!1},sr.regexp_eatZero=function(x){return x.current()===48&&!zi(x.lookahead())?(x.lastIntValue=0,x.advance(),!0):!1},sr.regexp_eatControlEscape=function(x){var M=x.current();return M===116?(x.lastIntValue=9,x.advance(),!0):M===110?(x.lastIntValue=10,x.advance(),!0):M===118?(x.lastIntValue=11,x.advance(),!0):M===102?(x.lastIntValue=12,x.advance(),!0):M===114?(x.lastIntValue=13,x.advance(),!0):!1},sr.regexp_eatControlLetter=function(x){var M=x.current();return _n(M)?(x.lastIntValue=M%32,x.advance(),!0):!1};function _n(x){return x>=65&&x<=90||x>=97&&x<=122}sr.regexp_eatRegExpUnicodeEscapeSequence=function(x,M){M===void 0&&(M=!1);var z=x.pos,R=M||x.switchU;if(x.eat(117)){if(this.regexp_eatFixedHexDigits(x,4)){var se=x.lastIntValue;if(R&&se>=55296&&se<=56319){var Ie=x.pos;if(x.eat(92)&&x.eat(117)&&this.regexp_eatFixedHexDigits(x,4)){var ct=x.lastIntValue;if(ct>=56320&&ct<=57343)return x.lastIntValue=(se-55296)*1024+(ct-56320)+65536,!0}x.pos=Ie,x.lastIntValue=se}return!0}if(R&&x.eat(123)&&this.regexp_eatHexDigits(x)&&x.eat(125)&&rn(x.lastIntValue))return!0;R&&x.raise("Invalid unicode escape"),x.pos=z}return!1};function rn(x){return x>=0&&x<=1114111}sr.regexp_eatIdentityEscape=function(x){if(x.switchU)return this.regexp_eatSyntaxCharacter(x)?!0:x.eat(47)?(x.lastIntValue=47,!0):!1;var M=x.current();return M!==99&&(!x.switchN||M!==107)?(x.lastIntValue=M,x.advance(),!0):!1},sr.regexp_eatDecimalEscape=function(x){x.lastIntValue=0;var M=x.current();if(M>=49&&M<=57){do x.lastIntValue=10*x.lastIntValue+(M-48),x.advance();while((M=x.current())>=48&&M<=57);return!0}return!1},sr.regexp_eatCharacterClassEscape=function(x){var M=x.current();if(cn(M))return x.lastIntValue=-1,x.advance(),!0;if(x.switchU&&this.options.ecmaVersion>=9&&(M===80||M===112)){if(x.lastIntValue=-1,x.advance(),x.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(x)&&x.eat(125))return!0;x.raise("Invalid property name")}return!1};function cn(x){return x===100||x===68||x===115||x===83||x===119||x===87}sr.regexp_eatUnicodePropertyValueExpression=function(x){var M=x.pos;if(this.regexp_eatUnicodePropertyName(x)&&x.eat(61)){var z=x.lastStringValue;if(this.regexp_eatUnicodePropertyValue(x)){var R=x.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(x,z,R),!0}}if(x.pos=M,this.regexp_eatLoneUnicodePropertyNameOrValue(x)){var se=x.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(x,se),!0}return!1},sr.regexp_validateUnicodePropertyNameAndValue=function(x,M,z){pe(x.unicodeProperties.nonBinary,M)||x.raise("Invalid property name"),x.unicodeProperties.nonBinary[M].test(z)||x.raise("Invalid property value")},sr.regexp_validateUnicodePropertyNameOrValue=function(x,M){x.unicodeProperties.binary.test(M)||x.raise("Invalid property name")},sr.regexp_eatUnicodePropertyName=function(x){var M=0;for(x.lastStringValue="";wi(M=x.current());)x.lastStringValue+=Rr(M),x.advance();return x.lastStringValue!==""};function wi(x){return _n(x)||x===95}sr.regexp_eatUnicodePropertyValue=function(x){var M=0;for(x.lastStringValue="";gn(M=x.current());)x.lastStringValue+=Rr(M),x.advance();return x.lastStringValue!==""};function gn(x){return wi(x)||zi(x)}sr.regexp_eatLoneUnicodePropertyNameOrValue=function(x){return this.regexp_eatUnicodePropertyValue(x)},sr.regexp_eatCharacterClass=function(x){if(x.eat(91)){if(x.eat(94),this.regexp_classRanges(x),x.eat(93))return!0;x.raise("Unterminated character class")}return!1},sr.regexp_classRanges=function(x){for(;this.regexp_eatClassAtom(x);){var M=x.lastIntValue;if(x.eat(45)&&this.regexp_eatClassAtom(x)){var z=x.lastIntValue;x.switchU&&(M===-1||z===-1)&&x.raise("Invalid character class"),M!==-1&&z!==-1&&M>z&&x.raise("Range out of order in character class")}}},sr.regexp_eatClassAtom=function(x){var M=x.pos;if(x.eat(92)){if(this.regexp_eatClassEscape(x))return!0;if(x.switchU){var z=x.current();(z===99||ki(z))&&x.raise("Invalid class escape"),x.raise("Invalid escape")}x.pos=M}var R=x.current();return R!==93?(x.lastIntValue=R,x.advance(),!0):!1},sr.regexp_eatClassEscape=function(x){var M=x.pos;if(x.eat(98))return x.lastIntValue=8,!0;if(x.switchU&&x.eat(45))return x.lastIntValue=45,!0;if(!x.switchU&&x.eat(99)){if(this.regexp_eatClassControlLetter(x))return!0;x.pos=M}return this.regexp_eatCharacterClassEscape(x)||this.regexp_eatCharacterEscape(x)},sr.regexp_eatClassControlLetter=function(x){var M=x.current();return zi(M)||M===95?(x.lastIntValue=M%32,x.advance(),!0):!1},sr.regexp_eatHexEscapeSequence=function(x){var M=x.pos;if(x.eat(120)){if(this.regexp_eatFixedHexDigits(x,2))return!0;x.switchU&&x.raise("Invalid escape"),x.pos=M}return!1},sr.regexp_eatDecimalDigits=function(x){var M=x.pos,z=0;for(x.lastIntValue=0;zi(z=x.current());)x.lastIntValue=10*x.lastIntValue+(z-48),x.advance();return x.pos!==M};function zi(x){return x>=48&&x<=57}sr.regexp_eatHexDigits=function(x){var M=x.pos,z=0;for(x.lastIntValue=0;ca(z=x.current());)x.lastIntValue=16*x.lastIntValue+sn(z),x.advance();return x.pos!==M};function ca(x){return x>=48&&x<=57||x>=65&&x<=70||x>=97&&x<=102}function sn(x){return x>=65&&x<=70?10+(x-65):x>=97&&x<=102?10+(x-97):x-48}sr.regexp_eatLegacyOctalEscapeSequence=function(x){if(this.regexp_eatOctalDigit(x)){var M=x.lastIntValue;if(this.regexp_eatOctalDigit(x)){var z=x.lastIntValue;M<=3&&this.regexp_eatOctalDigit(x)?x.lastIntValue=M*64+z*8+x.lastIntValue:x.lastIntValue=M*8+z}else x.lastIntValue=M;return!0}return!1},sr.regexp_eatOctalDigit=function(x){var M=x.current();return ki(M)?(x.lastIntValue=M-48,x.advance(),!0):(x.lastIntValue=0,!1)};function ki(x){return x>=48&&x<=55}sr.regexp_eatFixedHexDigits=function(x,M){var z=x.pos;x.lastIntValue=0;for(var R=0;R<M;++R){var se=x.current();if(!ca(se))return x.pos=z,!1;x.lastIntValue=16*x.lastIntValue+sn(se),x.advance()}return!0};var Pi=function(M){this.type=M.type,this.value=M.value,this.start=M.start,this.end=M.end,M.options.locations&&(this.loc=new Qe(M,M.startLoc,M.endLoc)),M.options.ranges&&(this.range=[M.start,M.end])},vi=Et.prototype;vi.next=function(x){!x&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Pi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},vi.getToken=function(){return this.next(),new Pi(this)},typeof Symbol!="undefined"&&(vi[Symbol.iterator]=function(){var x=this;return{next:function(){var M=x.getToken();return{done:M.type===ee.eof,value:M}}}}),vi.curContext=function(){return this.context[this.context.length-1]},vi.nextToken=function(){var x=this.curContext();if((!x||!x.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(ee.eof);if(x.override)return x.override(this);this.readToken(this.fullCharCodeAtPos())},vi.readToken=function(x){return Je(x,this.options.ecmaVersion>=6)||x===92?this.readWord():this.getTokenFromCode(x)},vi.fullCharCodeAtPos=function(){var x=this.input.charCodeAt(this.pos);if(x<=55295||x>=57344)return x;var M=this.input.charCodeAt(this.pos+1);return(x<<10)+M-56613888},vi.skipBlockComment=function(){var x=this.options.onComment&&this.curPosition(),M=this.pos,z=this.input.indexOf("*/",this.pos+=2);if(z===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=z+2,this.options.locations){At.lastIndex=M;for(var R;(R=At.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(M+2,z),M,this.pos,x,this.curPosition())},vi.skipLineComment=function(x){for(var M=this.pos,z=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=x);this.pos<this.input.length&&!nt(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(M+x,this.pos),M,this.pos,z,this.curPosition())},vi.skipSpace=function(){e:for(;this.pos<this.input.length;){var x=this.input.charCodeAt(this.pos);switch(x){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(x>8&&x<14||x>=5760&&Zt.test(String.fromCharCode(x)))++this.pos;else break e}}},vi.finishToken=function(x,M){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var z=this.type;this.type=x,this.value=M,this.updateContext(z)},vi.readToken_dot=function(){var x=this.input.charCodeAt(this.pos+1);if(x>=48&&x<=57)return this.readNumber(!0);var M=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&x===46&&M===46?(this.pos+=3,this.finishToken(ee.ellipsis)):(++this.pos,this.finishToken(ee.dot))},vi.readToken_slash=function(){var x=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):x===61?this.finishOp(ee.assign,2):this.finishOp(ee.slash,1)},vi.readToken_mult_modulo_exp=function(x){var M=this.input.charCodeAt(this.pos+1),z=1,R=x===42?ee.star:ee.modulo;return this.options.ecmaVersion>=7&&x===42&&M===42&&(++z,R=ee.starstar,M=this.input.charCodeAt(this.pos+2)),M===61?this.finishOp(ee.assign,z+1):this.finishOp(R,z)},vi.readToken_pipe_amp=function(x){var M=this.input.charCodeAt(this.pos+1);if(M===x){if(this.options.ecmaVersion>=12){var z=this.input.charCodeAt(this.pos+2);if(z===61)return this.finishOp(ee.assign,3)}return this.finishOp(x===124?ee.logicalOR:ee.logicalAND,2)}return M===61?this.finishOp(ee.assign,2):this.finishOp(x===124?ee.bitwiseOR:ee.bitwiseAND,1)},vi.readToken_caret=function(){var x=this.input.charCodeAt(this.pos+1);return x===61?this.finishOp(ee.assign,2):this.finishOp(ee.bitwiseXOR,1)},vi.readToken_plus_min=function(x){var M=this.input.charCodeAt(this.pos+1);return M===x?M===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||rr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(ee.incDec,2):M===61?this.finishOp(ee.assign,2):this.finishOp(ee.plusMin,1)},vi.readToken_lt_gt=function(x){var M=this.input.charCodeAt(this.pos+1),z=1;return M===x?(z=x===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+z)===61?this.finishOp(ee.assign,z+1):this.finishOp(ee.bitShift,z)):M===33&&x===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(M===61&&(z=2),this.finishOp(ee.relational,z))},vi.readToken_eq_excl=function(x){var M=this.input.charCodeAt(this.pos+1);return M===61?this.finishOp(ee.equality,this.input.charCodeAt(this.pos+2)===61?3:2):x===61&&M===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(ee.arrow)):this.finishOp(x===61?ee.eq:ee.prefix,1)},vi.readToken_question=function(){var x=this.options.ecmaVersion;if(x>=11){var M=this.input.charCodeAt(this.pos+1);if(M===46){var z=this.input.charCodeAt(this.pos+2);if(z<48||z>57)return this.finishOp(ee.questionDot,2)}if(M===63){if(x>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(ee.assign,3)}return this.finishOp(ee.coalesce,2)}}return this.finishOp(ee.question,1)},vi.getTokenFromCode=function(x){switch(x){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(ee.parenL);case 41:return++this.pos,this.finishToken(ee.parenR);case 59:return++this.pos,this.finishToken(ee.semi);case 44:return++this.pos,this.finishToken(ee.comma);case 91:return++this.pos,this.finishToken(ee.bracketL);case 93:return++this.pos,this.finishToken(ee.bracketR);case 123:return++this.pos,this.finishToken(ee.braceL);case 125:return++this.pos,this.finishToken(ee.braceR);case 58:return++this.pos,this.finishToken(ee.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(ee.backQuote);case 48:var M=this.input.charCodeAt(this.pos+1);if(M===120||M===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(M===111||M===79)return this.readRadixNumber(8);if(M===98||M===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(x);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(x);case 124:case 38:return this.readToken_pipe_amp(x);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(x);case 60:case 62:return this.readToken_lt_gt(x);case 61:case 33:return this.readToken_eq_excl(x);case 63:return this.readToken_question();case 126:return this.finishOp(ee.prefix,1)}this.raise(this.pos,"Unexpected character '"+Gt(x)+"'")},vi.finishOp=function(x,M){var z=this.input.slice(this.pos,this.pos+M);return this.pos+=M,this.finishToken(x,z)},vi.readRegexp=function(){for(var x,M,z=this.pos;;){this.pos>=this.input.length&&this.raise(z,"Unterminated regular expression");var R=this.input.charAt(this.pos);if(rr.test(R)&&this.raise(z,"Unterminated regular expression"),x)x=!1;else{if(R==="[")M=!0;else if(R==="]"&&M)M=!1;else if(R==="/"&&!M)break;x=R==="\\"}++this.pos}var se=this.input.slice(z,this.pos);++this.pos;var Ie=this.pos,ct=this.readWord1();this.containsEsc&&this.unexpected(Ie);var Dt=this.regexpState||(this.regexpState=new cr(this));Dt.reset(z,se,ct),this.validateRegExpFlags(Dt),this.validateRegExpPattern(Dt);var Rt=null;try{Rt=new RegExp(se,ct)}catch(wr){}return this.finishToken(ee.regexp,{pattern:se,flags:ct,value:Rt})},vi.readInt=function(x,M,z){for(var R=this.options.ecmaVersion>=12&&M===void 0,se=z&&this.input.charCodeAt(this.pos)===48,Ie=this.pos,ct=0,Dt=0,Rt=0,wr=M==null?Infinity:M;Rt<wr;++Rt,++this.pos){var Br=this.input.charCodeAt(this.pos),Xn=void 0;if(R&&Br===95){se&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Dt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Rt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Dt=Br;continue}if(Br>=97?Xn=Br-97+10:Br>=65?Xn=Br-65+10:Br>=48&&Br<=57?Xn=Br-48:Xn=Infinity,Xn>=x)break;Dt=Br,ct=ct*x+Xn}return R&&Dt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Ie||M!=null&&this.pos-Ie!==M?null:ct};function Ji(x,M){return M?parseInt(x,8):parseFloat(x.replace(/_/g,""))}function qt(x){return typeof BigInt!="function"?null:BigInt(x.replace(/_/g,""))}vi.readRadixNumber=function(x){var M=this.pos;this.pos+=2;var z=this.readInt(x);return z==null&&this.raise(this.start+2,"Expected number in radix "+x),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(z=qt(this.input.slice(M,this.pos)),++this.pos):Je(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ee.num,z)},vi.readNumber=function(x){var M=this.pos;!x&&this.readInt(10,void 0,!0)===null&&this.raise(M,"Invalid number");var z=this.pos-M>=2&&this.input.charCodeAt(M)===48;z&&this.strict&&this.raise(M,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!z&&!x&&this.options.ecmaVersion>=11&&R===110){var se=qt(this.input.slice(M,this.pos));return++this.pos,Je(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ee.num,se)}z&&/[89]/.test(this.input.slice(M,this.pos))&&(z=!1),R===46&&!z&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!z&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(M,"Invalid number")),Je(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Ie=Ji(this.input.slice(M,this.pos),z);return this.finishToken(ee.num,Ie)},vi.readCodePoint=function(){var x=this.input.charCodeAt(this.pos),M;if(x===123){this.options.ecmaVersion<6&&this.unexpected();var z=++this.pos;M=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,M>1114111&&this.invalidStringToken(z,"Code point out of bounds")}else M=this.readHexChar(4);return M};function Gt(x){return x<=65535?String.fromCharCode(x):(x-=65536,String.fromCharCode((x>>10)+55296,(x&1023)+56320))}vi.readString=function(x){for(var M="",z=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===x)break;R===92?(M+=this.input.slice(z,this.pos),M+=this.readEscapedChar(!1),z=this.pos):(nt(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return M+=this.input.slice(z,this.pos++),this.finishToken(ee.string,M)};var ji={};vi.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(x){if(x===ji)this.readInvalidTemplateToken();else throw x}this.inTemplateElement=!1},vi.invalidStringToken=function(x,M){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw ji;this.raise(x,M)},vi.readTmplToken=function(){for(var x="",M=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var z=this.input.charCodeAt(this.pos);if(z===96||z===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===ee.template||this.type===ee.invalidTemplate)?z===36?(this.pos+=2,this.finishToken(ee.dollarBraceL)):(++this.pos,this.finishToken(ee.backQuote)):(x+=this.input.slice(M,this.pos),this.finishToken(ee.template,x));if(z===92)x+=this.input.slice(M,this.pos),x+=this.readEscapedChar(!0),M=this.pos;else if(nt(z)){switch(x+=this.input.slice(M,this.pos),++this.pos,z){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:x+=`
`;break;default:x+=String.fromCharCode(z);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),M=this.pos}else++this.pos}},vi.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(ee.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},vi.readEscapedChar=function(x){var M=this.input.charCodeAt(++this.pos);switch(++this.pos,M){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Gt(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(x){var z=this.pos-1;return this.invalidStringToken(z,"Invalid escape sequence in template string"),null}default:if(M>=48&&M<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],se=parseInt(R,8);return se>255&&(R=R.slice(0,-1),se=parseInt(R,8)),this.pos+=R.length-1,M=this.input.charCodeAt(this.pos),(R!=="0"||M===56||M===57)&&(this.strict||x)&&this.invalidStringToken(this.pos-1-R.length,x?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(se)}return nt(M)?"":String.fromCharCode(M)}},vi.readHexChar=function(x){var M=this.pos,z=this.readInt(16,x);return z===null&&this.invalidStringToken(M,"Bad character escape sequence"),z},vi.readWord1=function(){this.containsEsc=!1;for(var x="",M=!0,z=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var se=this.fullCharCodeAtPos();if(Jt(se,R))this.pos+=se<=65535?1:2;else if(se===92){this.containsEsc=!0,x+=this.input.slice(z,this.pos);var Ie=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var ct=this.readCodePoint();(M?Je:Jt)(ct,R)||this.invalidStringToken(Ie,"Invalid Unicode escape"),x+=Gt(ct),z=this.pos}else break;M=!1}return x+this.input.slice(z,this.pos)},vi.readWord=function(){var x=this.readWord1(),M=ee.name;return this.keywords.test(x)&&(M=pt[x]),this.finishToken(M,x)};var Hi="7.4.1";Et.acorn={Parser:Et,version:Hi,defaultOptions:Bt,Position:xe,SourceLocation:Qe,getLineInfo:xt,Node:qn,TokenType:_t,tokTypes:ee,keywordTypes:pt,TokContext:ba,tokContexts:ia,isIdentifierChar:Jt,isIdentifierStart:Je,Token:Pi,isNewLine:nt,lineBreak:rr,lineBreakG:At,nonASCIIwhitespace:Zt};function Pa(x,M){return Et.parse(x,M)}function so(x,M,z){return Et.parseExpressionAt(x,M,z)}function Fa(x,M){return Et.tokenizer(x,M)}function Ea(x,M){x.prototype=Object.create(M.prototype),x.prototype.constructor=x,x.__proto__=M}function Wr(x){var M=typeof Map=="function"?new Map:void 0;return Wr=function(R){if(R===null||!Bs(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof M!="undefined"){if(M.has(R))return M.get(R);M.set(R,se)}function se(){return yt(R,arguments,Na(this).constructor)}return se.prototype=Object.create(R.prototype,{constructor:{value:se,enumerable:!1,writable:!0,configurable:!0}}),he(se,R)},Wr(x)}function Hr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(x){return!1}}function yt(x,M,z){return Hr()?yt=Reflect.construct:yt=function(se,Ie,ct){var Dt=[null];Dt.push.apply(Dt,Ie);var Rt=Function.bind.apply(se,Dt),wr=new Rt;return ct&&he(wr,ct.prototype),wr},yt.apply(null,arguments)}function Bs(x){return Function.toString.call(x).indexOf("[native code]")!==-1}function he(x,M){return he=Object.setPrototypeOf||function(R,se){return R.__proto__=se,R},he(x,M)}function Na(x){return Na=Object.setPrototypeOf?Object.getPrototypeOf:function(z){return z.__proto__||Object.getPrototypeOf(z)},Na(x)}var Ya=function(x){Ea(M,x);function M(){return x.apply(this,arguments)||this}return M}(Wr(Error)),oa=function(x){Ea(M,x);function M(){return x.apply(this,arguments)||this}return M}(Wr(SyntaxError)),uo=function(x){Ea(M,x);function M(){return x.apply(this,arguments)||this}return M}(Wr(ReferenceError)),Co=function(x){Ea(M,x);function M(){return x.apply(this,arguments)||this}return M}(Wr(TypeError)),Ru=function(x){Ea(M,x);function M(){return x.apply(this,arguments)||this}return M}(Ya),yo=function(x){Ea(M,x);function M(){return x.apply(this,arguments)||this}return M}(oa),Ao=function(x){Ea(M,x);function M(){return x.apply(this,arguments)||this}return M}(uo),da={UnknownError:[3001,"%0",Ru],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Ru],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Ao],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Ao],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Ao],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Ao],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Ao],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Ao],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Ao],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Ao],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Ao],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Ao],FunctionUndefinedReferenceError:[2001,"%0 is not a function",uo],VariableUndefinedReferenceError:[2002,"%0 is not defined",uo],IsNotConstructor:[2003,"%0 is not a constructor",Co]};function lo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(x){return!1}}function Vo(x,M,z){return lo()?Vo=Reflect.construct:Vo=function(se,Ie,ct){var Dt=[null];Dt.push.apply(Dt,Ie);var Rt=Function.bind.apply(se,Dt),wr=new Rt;return ct&&co(wr,ct.prototype),wr},Vo.apply(null,arguments)}function co(x,M){return co=Object.setPrototypeOf||function(R,se){return R.__proto__=se,R},co(x,M)}var Ns="0.0.3";function ul(x,M){Object.defineProperty(x,"name",{value:M,writable:!1,enumerable:!1,configurable:!0})}var us=Object.prototype.hasOwnProperty,me=Symbol("Break"),Le=Symbol("Continue"),dt=Symbol("DefaultCase"),ir=Symbol("EmptyStatementReturn"),Vr=Symbol("WithScopeName"),Un=Symbol("SuperScopeName"),Bi=Symbol("RootScopeName"),qa=Symbol("GlobalScopeName");function Oa(x){return typeof x=="function"}var ja=function(){function x(z){this.interpreter=z}var M=x.prototype;return M.generator=function(){var R=this.interpreter;function se(){return this.getCurrentScope()}function Ie(){return this.getGlobalScope()}function ct(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:se.bind(R),getGlobalScope:Ie.bind(R),getCurrentContext:ct.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},x}();function Go(x,M,z){if(z===void 0&&(z=!0),!(x instanceof ja))throw new Error("Illegal call");if(typeof M!="string")return M;if(!!M){var R=x.generator(),se=R.getOptions(),Ie={timeout:se.timeout,_initEnv:function(){z||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},ct=z?R.getGlobalScope():R.getCurrentScope(),Dt=new _o(ct,Ie);return Dt.evaluate(M)}}Object.defineProperty(Go,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function ms(x){if(!(x instanceof ja))throw new Error("Illegal call");for(var M=x.generator(),z=arguments.length,R=new Array(z>1?z-1:0),se=1;se<z;se++)R[se-1]=arguments[se];var Ie=R.pop(),ct=new _o(M.getGlobalScope(),M.getOptions()),Dt=`
		    (function anonymous(`+R.join(",")+`){
		        `+Ie+`
		    });
		    `;return ct.evaluate(Dt)}Object.defineProperty(ms,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Ho=function(M){this.value=M},ls=function(M){this.value=M},gs=function(M){this.value=M},ws=function(M,z,R){z===void 0&&(z=null),this.name=R,this.parent=z,this.data=M,this.labelStack=[]};function Qo(){}function cs(x,M){return x===void 0&&(x=null),new ws(Object.create(null),x,M)}function ys(x){return Object.create(x)}var Sa={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Go,Function:ms};typeof JSON!="undefined"&&(Sa.JSON=JSON),typeof Promise!="undefined"&&(Sa.Promise=Promise),typeof Set!="undefined"&&(Sa.Set=Set),typeof Map!="undefined"&&(Sa.Map=Map),typeof Symbol!="undefined"&&(Sa.Symbol=Symbol),typeof Proxy!="undefined"&&(Sa.Proxy=Proxy),typeof WeakMap!="undefined"&&(Sa.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Sa.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Sa.Reflect=Reflect);var _o=function(){function x(z,R){z===void 0&&(z=x.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||x.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?x.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=z||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var M=x.prototype;return M.initEnvironment=function(R){var se;if(R instanceof ws)se=R;else{var Ie=null,ct=this.createSuperScope(R);this.options.rootContext&&(Ie=new ws(ys(this.options.rootContext),ct,Bi)),se=new ws(R,Ie||ct,qa)}this.globalScope=se,this.currentScope=this.globalScope,this.globalContext=se.data,this.currentContext=se.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Dt=this.options._initEnv;Dt&&Dt.call(this)},M.getExecStartTime=function(){return this.execStartTime},M.getExecutionTime=function(){return this.execEndTime-this.execStartTime},M.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},M.getOptions=function(){return this.options},M.getGlobalScope=function(){return this.globalScope},M.getCurrentScope=function(){return this.currentScope},M.getCurrentContext=function(){return this.currentContext},M.isInterruptThrow=function(R){return R instanceof Ru||R instanceof Ao||R instanceof yo},M.createSuperScope=function(R){var se=Object.assign({},Sa),Ie=Object.keys(se);return Ie.forEach(function(ct){ct in R&&delete se[ct]}),new ws(se,null,Un)},M.setCurrentContext=function(R){this.currentContext=R},M.setCurrentScope=function(R){this.currentScope=R},M.evaluate=function(R){R===void 0&&(R="");var se;if(!!R)return se=Pa(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||x.ecmaVersion}),this.evaluateNode(se,R)},M.appendCode=function(R){return this.evaluate(R)},M.evaluateNode=function(R,se){var Ie=this;se===void 0&&(se=""),this.value=void 0,this.source=se,this.sourceList.push(se),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var ct=this.getCurrentScope(),Dt=this.getCurrentContext(),Rt=ct.labelStack.concat([]),wr=this.callStack.concat([]),Br=function(){Ie.setCurrentScope(ct),Ie.setCurrentContext(Dt),ct.labelStack=Rt,Ie.callStack=wr};try{var Xn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Xn()}catch(bi){throw bi}finally{Br(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},M.createErrorMessage=function(R,se,Ie){var ct=R[1].replace("%0",String(se));return Ie!==null&&(ct+=this.getNodePosition(Ie||this.lastExecNode)),ct},M.createError=function(R,se){return new se(R)},M.createThrowError=function(R,se){return this.createError(R,se)},M.createInternalThrowError=function(R,se,Ie){return this.createError(this.createErrorMessage(R,se,Ie),R[2])},M.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,se=Date.now();return se-this.execStartTime>R},M.getNodePosition=function(R){if(R){var se="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+se:""}return""},M.createClosure=function(R){var se=this,Ie;switch(R.type){case"BinaryExpression":Ie=this.binaryExpressionHandler(R);break;case"LogicalExpression":Ie=this.logicalExpressionHandler(R);break;case"UnaryExpression":Ie=this.unaryExpressionHandler(R);break;case"UpdateExpression":Ie=this.updateExpressionHandler(R);break;case"ObjectExpression":Ie=this.objectExpressionHandler(R);break;case"ArrayExpression":Ie=this.arrayExpressionHandler(R);break;case"CallExpression":Ie=this.callExpressionHandler(R);break;case"NewExpression":Ie=this.newExpressionHandler(R);break;case"MemberExpression":Ie=this.memberExpressionHandler(R);break;case"ThisExpression":Ie=this.thisExpressionHandler(R);break;case"SequenceExpression":Ie=this.sequenceExpressionHandler(R);break;case"Literal":Ie=this.literalHandler(R);break;case"Identifier":Ie=this.identifierHandler(R);break;case"AssignmentExpression":Ie=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":Ie=this.functionDeclarationHandler(R);break;case"VariableDeclaration":Ie=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":Ie=this.programHandler(R);break;case"ExpressionStatement":Ie=this.expressionStatementHandler(R);break;case"EmptyStatement":Ie=this.emptyStatementHandler(R);break;case"ReturnStatement":Ie=this.returnStatementHandler(R);break;case"FunctionExpression":Ie=this.functionExpressionHandler(R);break;case"IfStatement":Ie=this.ifStatementHandler(R);break;case"ConditionalExpression":Ie=this.conditionalExpressionHandler(R);break;case"ForStatement":Ie=this.forStatementHandler(R);break;case"WhileStatement":Ie=this.whileStatementHandler(R);break;case"DoWhileStatement":Ie=this.doWhileStatementHandler(R);break;case"ForInStatement":Ie=this.forInStatementHandler(R);break;case"WithStatement":Ie=this.withStatementHandler(R);break;case"ThrowStatement":Ie=this.throwStatementHandler(R);break;case"TryStatement":Ie=this.tryStatementHandler(R);break;case"ContinueStatement":Ie=this.continueStatementHandler(R);break;case"BreakStatement":Ie=this.breakStatementHandler(R);break;case"SwitchStatement":Ie=this.switchStatementHandler(R);break;case"LabeledStatement":Ie=this.labeledStatementHandler(R);break;case"DebuggerStatement":Ie=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(da.NodeTypeSyntaxError,R.type,R)}return function(){var ct=se.options.timeout;if(ct&&ct>0&&se.checkTimeout())throw se.createInternalThrowError(da.ExecutionTimeOutError,ct,null);return se.lastExecNode=R,Ie.apply(void 0,arguments)}},M.binaryExpressionHandler=function(R){var se=this,Ie=this.createClosure(R.left),ct=this.createClosure(R.right);return function(){var Dt=Ie(),Rt=ct();switch(R.operator){case"==":return Dt==Rt;case"!=":return Dt!=Rt;case"===":return Dt===Rt;case"!==":return Dt!==Rt;case"<":return Dt<Rt;case"<=":return Dt<=Rt;case">":return Dt>Rt;case">=":return Dt>=Rt;case"<<":return Dt<<Rt;case">>":return Dt>>Rt;case">>>":return Dt>>>Rt;case"+":return Dt+Rt;case"-":return Dt-Rt;case"*":return Dt*Rt;case"**":return Math.pow(Dt,Rt);case"/":return Dt/Rt;case"%":return Dt%Rt;case"|":return Dt|Rt;case"^":return Dt^Rt;case"&":return Dt&Rt;case"in":return Dt in Rt;case"instanceof":return Dt instanceof Rt;default:throw se.createInternalThrowError(da.BinaryOperatorSyntaxError,R.operator,R)}}},M.logicalExpressionHandler=function(R){var se=this,Ie=this.createClosure(R.left),ct=this.createClosure(R.right);return function(){switch(R.operator){case"||":return Ie()||ct();case"&&":return Ie()&&ct();default:throw se.createInternalThrowError(da.LogicalOperatorSyntaxError,R.operator,R)}}},M.unaryExpressionHandler=function(R){var se=this;switch(R.operator){case"delete":var Ie=this.createObjectGetter(R.argument),ct=this.createNameGetter(R.argument);return function(){var Br=Ie(),Xn=ct();return delete Br[Xn]};default:var Dt;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var Rt=this.createObjectGetter(R.argument),wr=this.createNameGetter(R.argument);Dt=function(){return Rt()[wr()]}}else Dt=this.createClosure(R.argument);return function(){var Br=Dt();switch(R.operator){case"-":return-Br;case"+":return+Br;case"!":return!Br;case"~":return~Br;case"void":return;case"typeof":return typeof Br;default:throw se.createInternalThrowError(da.UnaryOperatorSyntaxError,R.operator,R)}}}},M.updateExpressionHandler=function(R){var se=this,Ie=this.createObjectGetter(R.argument),ct=this.createNameGetter(R.argument);return function(){var Dt=Ie(),Rt=ct();switch(se.assertVariable(Dt,Rt,R),R.operator){case"++":return R.prefix?++Dt[Rt]:Dt[Rt]++;case"--":return R.prefix?--Dt[Rt]:Dt[Rt]--;default:throw se.createInternalThrowError(da.UpdateOperatorSyntaxError,R.operator,R)}}},M.objectExpressionHandler=function(R){var se=this,Ie=[];function ct(Rt){return Rt.type==="Identifier"?Rt.name:Rt.type==="Literal"?Rt.value:this.throwError(da.ObjectStructureSyntaxError,Rt.type,Rt)}var Dt=Object.create(null);return R.properties.forEach(function(Rt){var wr=Rt.kind,Br=ct(Rt.key);(!Dt[Br]||wr==="init")&&(Dt[Br]={}),Dt[Br][wr]=se.createClosure(Rt.value),Ie.push({key:Br,property:Rt})}),function(){for(var Rt={},wr=Ie.length,Br=0;Br<wr;Br++){var Xn=Ie[Br],bi=Xn.key,ci=Dt[bi],Ei=ci.init?ci.init():void 0,ua=ci.get?ci.get():function(){},Ca=ci.set?ci.set():function(ll){};if("set"in ci||"get"in ci){var Si={configurable:!0,enumerable:!0,get:ua,set:Ca};Object.defineProperty(Rt,bi,Si)}else{var _s=Xn.property,uu=_s.kind;_s.key.type==="Identifier"&&_s.value.type==="FunctionExpression"&&uu==="init"&&!_s.value.id&&ul(Ei,_s.key.name),Rt[bi]=Ei}}return Rt}},M.arrayExpressionHandler=function(R){var se=this,Ie=R.elements.map(function(ct){return ct&&se.createClosure(ct)});return function(){for(var ct=Ie.length,Dt=Array(ct),Rt=0;Rt<ct;Rt++){var wr=Ie[Rt];wr&&(Dt[Rt]=wr())}return Dt}},M.safeObjectGet=function(R,se,Ie){return R[se]},M.createCallFunctionGetter=function(R){var se=this;switch(R.type){case"MemberExpression":var Ie=this.createClosure(R.object),ct=this.createMemberKeyGetter(R),Dt=this.source;return function(){var wr=Ie(),Br=ct(),Xn=se.safeObjectGet(wr,Br,R);if(!Xn||!Oa(Xn)){var bi=Dt.slice(R.start,R.end);throw se.createInternalThrowError(da.FunctionUndefinedReferenceError,bi,R)}return Xn.__IS_EVAL_FUNC?function(ci){return Xn(new ja(se),ci,!0)}:Xn.__IS_FUNCTION_FUNC?function(){for(var ci=arguments.length,Ei=new Array(ci),ua=0;ua<ci;ua++)Ei[ua]=arguments[ua];return Xn.apply(void 0,[new ja(se)].concat(Ei))}:Xn.bind(wr)};default:var Rt=this.createClosure(R);return function(){var wr="";R.type==="Identifier"&&(wr=R.name);var Br=Rt();if(!Br||!Oa(Br))throw se.createInternalThrowError(da.FunctionUndefinedReferenceError,wr,R);if(R.type==="Identifier"&&Br.__IS_EVAL_FUNC&&wr==="eval")return function(ci){var Ei=se.getScopeFromName(wr,se.getCurrentScope()),ua=Ei.name===Un||Ei.name===qa||Ei.name===Bi;return Br(new ja(se),ci,!ua)};if(Br.__IS_EVAL_FUNC)return function(ci){return Br(new ja(se),ci,!0)};if(Br.__IS_FUNCTION_FUNC)return function(){for(var ci=arguments.length,Ei=new Array(ci),ua=0;ua<ci;ua++)Ei[ua]=arguments[ua];return Br.apply(void 0,[new ja(se)].concat(Ei))};var Xn=se.options.globalContextInFunction;if(R.type==="Identifier"){var bi=se.getIdentifierScope(R);bi.name===Vr&&(Xn=bi.data)}return Br.bind(Xn)}}},M.callExpressionHandler=function(R){var se=this,Ie=this.createCallFunctionGetter(R.callee),ct=R.arguments.map(function(Dt){return se.createClosure(Dt)});return function(){return Ie().apply(void 0,ct.map(function(Dt){return Dt()}))}},M.functionExpressionHandler=function(R){var se=this,Ie=this,ct=this.source,Dt=this.collectDeclVars,Rt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var wr=R.id?R.id.name:"",Br=R.params.length,Xn=R.params.map(function(ua){return se.createParamNameGetter(ua)}),bi=this.createClosure(R.body),ci=this.collectDeclVars,Ei=this.collectDeclFuncs;return this.collectDeclVars=Dt,this.collectDeclFuncs=Rt,function(){var ua=Ie.getCurrentScope(),Ca=function Si(){for(var _s=arguments.length,uu=new Array(_s),ll=0;ll<_s;ll++)uu[ll]=arguments[ll];Ie.callStack.push(""+wr);var mf=Ie.getCurrentScope(),cl=cs(ua,"FunctionScope("+wr+")");Ie.setCurrentScope(cl),Ie.addDeclarationsToScope(ci,Ei,cl),wr&&(cl.data[wr]=Si),cl.data.arguments=arguments,Xn.forEach(function(Lu,ku){cl.data[Lu()]=uu[ku]});var tc=Ie.getCurrentContext();Ie.setCurrentContext(this);var Eu=bi();if(Ie.setCurrentContext(tc),Ie.setCurrentScope(mf),Ie.callStack.pop(),Eu instanceof Ho)return Eu.value};return ul(Ca,wr),Object.defineProperty(Ca,"length",{value:Br,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ca,"toString",{value:function(){return ct.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ca,"valueOf",{value:function(){return ct.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Ca}},M.newExpressionHandler=function(R){var se=this,Ie=this.source,ct=this.createClosure(R.callee),Dt=R.arguments.map(function(Rt){return se.createClosure(Rt)});return function(){var Rt=ct();if(!Oa(Rt)||Rt.__IS_EVAL_FUNC){var wr=R.callee,Br=Ie.slice(wr.start,wr.end);throw se.createInternalThrowError(da.IsNotConstructor,Br,R)}return Rt.__IS_FUNCTION_FUNC?Rt.apply(void 0,[new ja(se)].concat(Dt.map(function(Xn){return Xn()}))):Vo(Rt,Dt.map(function(Xn){return Xn()}))}},M.memberExpressionHandler=function(R){var se=this.createClosure(R.object),Ie=this.createMemberKeyGetter(R);return function(){var ct=se(),Dt=Ie();return ct[Dt]}},M.thisExpressionHandler=function(R){var se=this;return function(){return se.getCurrentContext()}},M.sequenceExpressionHandler=function(R){var se=this,Ie=R.expressions.map(function(ct){return se.createClosure(ct)});return function(){for(var ct,Dt=Ie.length,Rt=0;Rt<Dt;Rt++){var wr=Ie[Rt];ct=wr()}return ct}},M.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},M.identifierHandler=function(R){var se=this;return function(){var Ie=se.getCurrentScope(),ct=se.getScopeDataFromName(R.name,Ie);return se.assertVariable(ct,R.name,R),ct[R.name]}},M.getIdentifierScope=function(R){var se=this.getCurrentScope(),Ie=this.getScopeFromName(R.name,se);return Ie},M.assignmentExpressionHandler=function(R){var se=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var Ie=this.createObjectGetter(R.left),ct=this.createNameGetter(R.left),Dt=this.createClosure(R.right);return function(){var Rt=Ie(),wr=ct(),Br=Dt();switch(R.operator!=="="&&se.assertVariable(Rt,wr,R),R.operator){case"=":return Rt[wr]=Br;case"+=":return Rt[wr]+=Br;case"-=":return Rt[wr]-=Br;case"*=":return Rt[wr]*=Br;case"**=":return Rt[wr]=Math.pow(Rt[wr],Br);case"/=":return Rt[wr]/=Br;case"%=":return Rt[wr]%=Br;case"<<=":return Rt[wr]<<=Br;case">>=":return Rt[wr]>>=Br;case">>>=":return Rt[wr]>>>=Br;case"&=":return Rt[wr]&=Br;case"^=":return Rt[wr]^=Br;case"|=":return Rt[wr]|=Br;default:throw se.createInternalThrowError(da.AssignmentExpressionSyntaxError,R.type,R)}}},M.functionDeclarationHandler=function(R){if(R.id){var se=this.functionExpressionHandler(R);Object.defineProperty(se,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,se)}return function(){return ir}},M.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(da.VariableTypeSyntaxError,R.type,R)},M.variableDeclarationHandler=function(R){for(var se=this,Ie,ct=[],Dt=0;Dt<R.declarations.length;Dt++){var Rt=R.declarations[Dt];this.varDeclaration(this.getVariableName(Rt.id)),Rt.init&&ct.push({type:"AssignmentExpression",operator:"=",left:Rt.id,right:Rt.init})}return ct.length&&(Ie=this.createClosure({type:"BlockStatement",body:ct})),function(){if(Ie){var wr=se.isVarDeclMode;se.isVarDeclMode=!0,Ie(),se.isVarDeclMode=wr}return ir}},M.assertVariable=function(R,se,Ie){if(R===this.globalScope.data&&!(se in R))throw this.createInternalThrowError(da.VariableUndefinedReferenceError,se,Ie)},M.programHandler=function(R){var se=this,Ie=R.body.map(function(ct){return se.createClosure(ct)});return function(){for(var ct=ir,Dt=0;Dt<Ie.length;Dt++){var Rt=Ie[Dt],wr=se.setValue(Rt());if(wr!==ir&&(ct=wr,ct instanceof Ho||ct instanceof ls||ct instanceof gs||ct===me||ct===Le))break}return ct}},M.expressionStatementHandler=function(R){return this.createClosure(R.expression)},M.emptyStatementHandler=function(R){return function(){return ir}},M.returnStatementHandler=function(R){var se=R.argument?this.createClosure(R.argument):Qo;return function(){return new Ho(se())}},M.ifStatementHandler=function(R){var se=this.createClosure(R.test),Ie=this.createClosure(R.consequent),ct=R.alternate?this.createClosure(R.alternate):function(){return ir};return function(){return se()?Ie():ct()}},M.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},M.forStatementHandler=function(R){var se=this,Ie=Qo,ct=R.test?this.createClosure(R.test):function(){return!0},Dt=Qo,Rt=this.createClosure(R.body);return R.type==="ForStatement"&&(Ie=R.init?this.createClosure(R.init):Ie,Dt=R.update?this.createClosure(R.update):Qo),function(wr){var Br,Xn=ir,bi=R.type==="DoWhileStatement";for(wr&&wr.type==="LabeledStatement"&&(Br=wr.label.name),Ie();bi||ct();Dt()){bi=!1;var ci=se.setValue(Rt());if(!(ci===ir||ci===Le)){if(ci===me)break;if(Xn=ci,Xn instanceof gs&&Xn.value===Br){Xn=ir;continue}if(Xn instanceof Ho||Xn instanceof ls||Xn instanceof gs)break}}return Xn}},M.whileStatementHandler=function(R){return this.forStatementHandler(R)},M.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},M.forInStatementHandler=function(R){var se=this,Ie=R.left,ct=this.createClosure(R.right),Dt=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),Ie=R.left.declarations[0].id),function(Rt){var wr,Br=ir,Xn;Rt&&Rt.type==="LabeledStatement"&&(wr=Rt.label.name);var bi=ct();for(Xn in bi){se.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Ie,right:{type:"Literal",value:Xn}})();var ci=se.setValue(Dt());if(!(ci===ir||ci===Le)){if(ci===me)break;if(Br=ci,Br instanceof gs&&Br.value===wr){Br=ir;continue}if(Br instanceof Ho||Br instanceof ls||Br instanceof gs)break}}return Br}},M.withStatementHandler=function(R){var se=this,Ie=this.createClosure(R.object),ct=this.createClosure(R.body);return function(){var Dt=Ie(),Rt=se.getCurrentScope(),wr=new ws(Dt,Rt,Vr);se.setCurrentScope(wr);var Br=se.setValue(ct());return se.setCurrentScope(Rt),Br}},M.throwStatementHandler=function(R){var se=this,Ie=this.createClosure(R.argument);return function(){throw se.setValue(void 0),Ie()}},M.tryStatementHandler=function(R){var se=this,Ie=this.createClosure(R.block),ct=R.handler?this.catchClauseHandler(R.handler):null,Dt=R.finalizer?this.createClosure(R.finalizer):null;return function(){var Rt=se.getCurrentScope(),wr=se.getCurrentContext(),Br=Rt.labelStack.concat([]),Xn=se.callStack.concat([]),bi=ir,ci,Ei,ua=function(){se.setCurrentScope(Rt),se.setCurrentContext(wr),Rt.labelStack=Br,se.callStack=Xn};try{bi=se.setValue(Ie()),bi instanceof Ho&&(ci=bi)}catch(Ca){if(ua(),se.isInterruptThrow(Ca))throw Ca;if(ct)try{bi=se.setValue(ct(Ca)),bi instanceof Ho&&(ci=bi)}catch(Si){if(ua(),se.isInterruptThrow(Si))throw Si;Ei=Si}}if(Dt)try{bi=Dt(),bi instanceof Ho&&(ci=bi)}catch(Ca){if(ua(),se.isInterruptThrow(Ca))throw Ca;Ei=Ca}if(Ei)throw Ei;return ci||bi}},M.catchClauseHandler=function(R){var se=this,Ie=this.createParamNameGetter(R.param),ct=this.createClosure(R.body);return function(Dt){var Rt,wr=se.getCurrentScope(),Br=wr.data,Xn=Ie(),bi=us.call(Br,Xn),ci=Br[Xn];return Br[Xn]=Dt,Rt=ct(),bi?Br[Xn]=ci:delete Br[Xn],Rt}},M.continueStatementHandler=function(R){return function(){return R.label?new gs(R.label.name):Le}},M.breakStatementHandler=function(R){return function(){return R.label?new ls(R.label.name):me}},M.switchStatementHandler=function(R){var se=this,Ie=this.createClosure(R.discriminant),ct=R.cases.map(function(Dt){return se.switchCaseHandler(Dt)});return function(){for(var Dt=Ie(),Rt=!1,wr,Br,Xn,bi=0;bi<ct.length;bi++){var ci=ct[bi](),Ei=ci.testClosure();if(Ei===dt){Xn=ci;continue}if(Rt||Ei===Dt){if(Rt=!0,Br=se.setValue(ci.bodyClosure()),Br===ir)continue;if(Br===me||(wr=Br,wr instanceof Ho||wr instanceof ls||wr instanceof gs||wr===Le))break}}if(!Rt&&Xn){Br=se.setValue(Xn.bodyClosure());var ua=Br===ir||Br===me||Br===Le;ua||(wr=Br)}return wr}},M.switchCaseHandler=function(R){var se=R.test?this.createClosure(R.test):function(){return dt},Ie=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:se,bodyClosure:Ie}}},M.labeledStatementHandler=function(R){var se=this,Ie=R.label.name,ct=this.createClosure(R.body);return function(){var Dt,Rt=se.getCurrentScope();return Rt.labelStack.push(Ie),Dt=ct(R),Dt instanceof ls&&Dt.value===Ie&&(Dt=ir),Rt.labelStack.pop(),Dt}},M.debuggerStatementHandler=function(R){return function(){debugger;return ir}},M.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(da.ParamTypeSyntaxError,R.type,R)},M.createObjectKeyGetter=function(R){var se;return R.type==="Identifier"?se=function(){return R.name}:se=this.createClosure(R),function(){return se()}},M.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},M.createObjectGetter=function(R){var se=this;switch(R.type){case"Identifier":return function(){return se.getScopeDataFromName(R.name,se.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(da.AssignmentTypeSyntaxError,R.type,R)}},M.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(da.AssignmentTypeSyntaxError,R.type,R)}},M.varDeclaration=function(R){var se=this.collectDeclVars;se[R]=void 0},M.funcDeclaration=function(R,se){var Ie=this.collectDeclFuncs;Ie[R]=se},M.addDeclarationsToScope=function(R,se,Ie){var ct=Ie.data;for(var Dt in se){var Rt=se[Dt];ct[Dt]=Rt&&Rt()}for(var wr in R)wr in ct||(ct[wr]=void 0)},M.getScopeValue=function(R,se){var Ie=this.getScopeFromName(R,se);return Ie.data[R]},M.getScopeDataFromName=function(R,se){return this.getScopeFromName(R,se).data},M.getScopeFromName=function(R,se){var Ie=se;do if(R in Ie.data)return Ie;while(Ie=Ie.parent);return this.globalScope},M.setValue=function(R){var se=this.callStack.length;return this.isVarDeclMode||se||R===ir||R===me||R===Le||R instanceof ls||R instanceof gs||(this.value=R instanceof Ho?R.value:R),R},M.getValue=function(){return this.value},x}();_o.version=Ns,_o.eval=Go,_o.Function=ms,_o.ecmaVersion=5,_o.globalContextInFunction=void 0,_o.global=Object.create(null);function ec(x){return x===void 0&&(x=Object.create(null)),x}function kc(x,M,z){M===void 0&&(M=[]),z===void 0&&(z={});var R=z.parsingContext,se=z.timeout===void 0?0:z.timeout,Ie=`
    (function anonymous(`+M.join(",")+`){
         `+x+`
    });
    `,ct=new _o(R,{ecmaVersion:z.ecmaVersion,timeout:se,rootContext:z.rootContext,globalContextInFunction:z.globalContextInFunction});return ct.evaluate(Ie)}function Yu(x,M,z){var R=new _o(M,z);return R.evaluate(x)}var fs=Yu,Jo=function(){function x(z){this._code=z}var M=x.prototype;return M.runInContext=function(R){return Yu(this._code,R)},M.runInNewContext=function(R){return Yu(this._code,R)},x}(),Ol=function(x,M,z){return Yu(x,M,z)};function bu(){for(var x=arguments.length,M=new Array(x),z=0;z<x;z++)M[z]=arguments[z];var R=M.pop();return kc(R||"",M)}var Ts=Ol},20396:function(It,ie,F){var J;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(Y,g,fe,N){"use strict";var oe=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ne=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),we=oe||ne,re=["","webkit","Moz","MS","ms","o"],ke=we?"":g.createElement("div"),Ve="function",Ne=Math.round,Je=Math.abs,Jt=Date.now;function _t(me,Le,dt){return setTimeout(At(me,dt),Le)}function Ut(me,Le,dt){return Array.isArray(me)?(Tt(me,dt[Le],dt),!0):!1}function Tt(me,Le,dt){var ir;if(!!me)if(me.forEach)me.forEach(Le,dt);else if(me.length!==N)for(ir=0;ir<me.length;)Le.call(dt,me[ir],ir,me),ir++;else for(ir in me)me.hasOwnProperty(ir)&&Le.call(dt,me[ir],ir,me)}function vt(me,Le,dt){var ir="DEPRECATED METHOD: "+Le+`
`+dt+` AT 
`;return function(){var Vr=new Error("get-stack-trace"),Un=Vr&&Vr.stack?Vr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Bi=Y.console&&(Y.console.warn||Y.console.log);return Bi&&Bi.call(Y.console,ir,Un),me.apply(this,arguments)}}var pt;typeof Object.assign!="function"?pt=function(Le){if(Le===N||Le===null)throw new TypeError("Cannot convert undefined or null to object");for(var dt=Object(Le),ir=1;ir<arguments.length;ir++){var Vr=arguments[ir];if(Vr!==N&&Vr!==null)for(var Un in Vr)Vr.hasOwnProperty(Un)&&(dt[Un]=Vr[Un])}return dt}:pt=Object.assign;var Vt=vt(function(Le,dt,ir){for(var Vr=Object.keys(dt),Un=0;Un<Vr.length;)(!ir||ir&&Le[Vr[Un]]===N)&&(Le[Vr[Un]]=dt[Vr[Un]]),Un++;return Le},"extend","Use `assign`."),ee=vt(function(Le,dt){return Vt(Le,dt,!0)},"merge","Use `assign`.");function rr(me,Le,dt){var ir=Le.prototype,Vr;Vr=me.prototype=Object.create(ir),Vr.constructor=me,Vr._super=ir,dt&&pt(Vr,dt)}function At(me,Le){return function(){return me.apply(Le,arguments)}}function nt(me,Le){return typeof me==Ve?me.apply(Le&&Le[0]||N,Le):me}function Zt(me,Le){return me===N?Le:me}function ut(me,Le,dt){Tt(pe(Le),function(ir){me.addEventListener(ir,dt,!1)})}function nr(me,Le,dt){Tt(pe(Le),function(ir){me.removeEventListener(ir,dt,!1)})}function Mr(me,Le){for(;me;){if(me==Le)return!0;me=me.parentNode}return!1}function q(me,Le){return me.indexOf(Le)>-1}function pe(me){return me.trim().split(/\s+/g)}function b(me,Le,dt){if(me.indexOf&&!dt)return me.indexOf(Le);for(var ir=0;ir<me.length;){if(dt&&me[ir][dt]==Le||!dt&&me[ir]===Le)return ir;ir++}return-1}function le(me){return Array.prototype.slice.call(me,0)}function xe(me,Le,dt){for(var ir=[],Vr=[],Un=0;Un<me.length;){var Bi=Le?me[Un][Le]:me[Un];b(Vr,Bi)<0&&ir.push(me[Un]),Vr[Un]=Bi,Un++}return dt&&(Le?ir=ir.sort(function(Oa,ja){return Oa[Le]>ja[Le]}):ir=ir.sort()),ir}function Qe(me,Le){for(var dt,ir,Vr=Le[0].toUpperCase()+Le.slice(1),Un=0;Un<re.length;){if(dt=re[Un],ir=dt?dt+Vr:Le,ir in me)return ir;Un++}return N}var xt=1;function Bt(){return xt++}function Fe(me){var Le=me.ownerDocument||me;return Le.defaultView||Le.parentWindow||Y}var bt=/mobile|tablet|ip(ad|hone|od)|android/i,br="ontouchstart"in Y,mr=Qe(Y,"PointerEvent")!==N,An=br&&bt.test(navigator.userAgent),mn="touch",wn="pen",Ri="mouse",Qn="kinect",ii=25,Vi=1,Ni=2,ai=4,Vn=8,Yn=1,Li=2,ra=4,ri=8,Et=16,de=Li|ra,V=ri|Et,X=de|V,k=["x","y"],Ce=["clientX","clientY"];function et(me,Le){var dt=this;this.manager=me,this.callback=Le,this.element=me.element,this.target=me.options.inputTarget,this.domHandler=function(ir){nt(me.options.enable,[me])&&dt.handler(ir)},this.init()}et.prototype={handler:function(){},init:function(){this.evEl&&ut(this.element,this.evEl,this.domHandler),this.evTarget&&ut(this.target,this.evTarget,this.domHandler),this.evWin&&ut(Fe(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&nr(this.element,this.evEl,this.domHandler),this.evTarget&&nr(this.target,this.evTarget,this.domHandler),this.evWin&&nr(Fe(this.element),this.evWin,this.domHandler)}};function Qt(me){var Le,dt=me.options.inputClass;return dt?Le=dt:mr?Le=Ze:An?Le=cr:br?Le=tr:Le=Ki,new Le(me,Oe)}function Oe(me,Le,dt){var ir=dt.pointers.length,Vr=dt.changedPointers.length,Un=Le&Vi&&ir-Vr==0,Bi=Le&(ai|Vn)&&ir-Vr==0;dt.isFirst=!!Un,dt.isFinal=!!Bi,Un&&(me.session={}),dt.eventType=Le,$e(me,dt),me.emit("hammer.input",dt),me.recognize(dt),me.session.prevInput=dt}function $e(me,Le){var dt=me.session,ir=Le.pointers,Vr=ir.length;dt.firstInput||(dt.firstInput=pr(Le)),Vr>1&&!dt.firstMultiple?dt.firstMultiple=pr(Le):Vr===1&&(dt.firstMultiple=!1);var Un=dt.firstInput,Bi=dt.firstMultiple,qa=Bi?Bi.center:Un.center,Oa=Le.center=xr(ir);Le.timeStamp=Jt(),Le.deltaTime=Le.timeStamp-Un.timeStamp,Le.angle=Wn(qa,Oa),Le.distance=Dr(qa,Oa),Ht(dt,Le),Le.offsetDirection=en(Le.deltaX,Le.deltaY);var ja=Qr(Le.deltaTime,Le.deltaX,Le.deltaY);Le.overallVelocityX=ja.x,Le.overallVelocityY=ja.y,Le.overallVelocity=Je(ja.x)>Je(ja.y)?ja.x:ja.y,Le.scale=Bi?ta(Bi.pointers,ir):1,Le.rotation=Bi?qn(Bi.pointers,ir):0,Le.maxPointers=dt.prevInput?Le.pointers.length>dt.prevInput.maxPointers?Le.pointers.length:dt.prevInput.maxPointers:Le.pointers.length,or(dt,Le);var Go=me.element;Mr(Le.srcEvent.target,Go)&&(Go=Le.srcEvent.target),Le.target=Go}function Ht(me,Le){var dt=Le.center,ir=me.offsetDelta||{},Vr=me.prevDelta||{},Un=me.prevInput||{};(Le.eventType===Vi||Un.eventType===ai)&&(Vr=me.prevDelta={x:Un.deltaX||0,y:Un.deltaY||0},ir=me.offsetDelta={x:dt.x,y:dt.y}),Le.deltaX=Vr.x+(dt.x-ir.x),Le.deltaY=Vr.y+(dt.y-ir.y)}function or(me,Le){var dt=me.lastInterval||Le,ir=Le.timeStamp-dt.timeStamp,Vr,Un,Bi,qa;if(Le.eventType!=Vn&&(ir>ii||dt.velocity===N)){var Oa=Le.deltaX-dt.deltaX,ja=Le.deltaY-dt.deltaY,Go=Qr(ir,Oa,ja);Un=Go.x,Bi=Go.y,Vr=Je(Go.x)>Je(Go.y)?Go.x:Go.y,qa=en(Oa,ja),me.lastInterval=Le}else Vr=dt.velocity,Un=dt.velocityX,Bi=dt.velocityY,qa=dt.direction;Le.velocity=Vr,Le.velocityX=Un,Le.velocityY=Bi,Le.direction=qa}function pr(me){for(var Le=[],dt=0;dt<me.pointers.length;)Le[dt]={clientX:Ne(me.pointers[dt].clientX),clientY:Ne(me.pointers[dt].clientY)},dt++;return{timeStamp:Jt(),pointers:Le,center:xr(Le),deltaX:me.deltaX,deltaY:me.deltaY}}function xr(me){var Le=me.length;if(Le===1)return{x:Ne(me[0].clientX),y:Ne(me[0].clientY)};for(var dt=0,ir=0,Vr=0;Vr<Le;)dt+=me[Vr].clientX,ir+=me[Vr].clientY,Vr++;return{x:Ne(dt/Le),y:Ne(ir/Le)}}function Qr(me,Le,dt){return{x:Le/me||0,y:dt/me||0}}function en(me,Le){return me===Le?Yn:Je(me)>=Je(Le)?me<0?Li:ra:Le<0?ri:Et}function Dr(me,Le,dt){dt||(dt=k);var ir=Le[dt[0]]-me[dt[0]],Vr=Le[dt[1]]-me[dt[1]];return Math.sqrt(ir*ir+Vr*Vr)}function Wn(me,Le,dt){dt||(dt=k);var ir=Le[dt[0]]-me[dt[0]],Vr=Le[dt[1]]-me[dt[1]];return Math.atan2(Vr,ir)*180/Math.PI}function qn(me,Le){return Wn(Le[1],Le[0],Ce)+Wn(me[1],me[0],Ce)}function ta(me,Le){return Dr(Le[0],Le[1],Ce)/Dr(me[0],me[1],Ce)}var na={mousedown:Vi,mousemove:Ni,mouseup:ai},ba="mousedown",ia="mousemove mouseup";function Ki(){this.evEl=ba,this.evWin=ia,this.pressed=!1,et.apply(this,arguments)}rr(Ki,et,{handler:function(Le){var dt=na[Le.type];dt&Vi&&Le.button===0&&(this.pressed=!0),dt&Ni&&Le.which!==1&&(dt=ai),!!this.pressed&&(dt&ai&&(this.pressed=!1),this.callback(this.manager,dt,{pointers:[Le],changedPointers:[Le],pointerType:Ri,srcEvent:Le}))}});var $={pointerdown:Vi,pointermove:Ni,pointerup:ai,pointercancel:Vn,pointerout:Vn},ue={2:mn,3:wn,4:Ri,5:Qn},ve="pointerdown",Te="pointermove pointerup pointercancel";!we&&Y.MSPointerEvent&&!Y.PointerEvent&&(ve="MSPointerDown",Te="MSPointerMove MSPointerUp MSPointerCancel");function Ze(){this.evEl=ve,this.evWin=Te,et.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}rr(Ze,et,{handler:function(Le){var dt=this.store,ir=!1,Vr=Le.type.toLowerCase().replace("ms",""),Un=$[Vr],Bi=ue[Le.pointerType]||Le.pointerType,qa=Bi==mn,Oa=b(dt,Le.pointerId,"pointerId");Un&Vi&&(Le.button===0||qa)?Oa<0&&(dt.push(Le),Oa=dt.length-1):Un&(ai|Vn)&&(ir=!0),!(Oa<0)&&(dt[Oa]=Le,this.callback(this.manager,Un,{pointers:dt,changedPointers:[Le],pointerType:Bi,srcEvent:Le}),ir&&dt.splice(Oa,1))}});var it={touchstart:Vi,touchmove:Ni,touchend:ai,touchcancel:Vn},gt="touchstart",be="touchstart touchmove touchend touchcancel";function Ye(){this.evTarget=gt,this.evWin=be,this.started=!1,et.apply(this,arguments)}rr(Ye,et,{handler:function(Le){var dt=it[Le.type];if(dt===Vi&&(this.started=!0),!!this.started){var ir=jt.call(this,Le,dt);dt&(ai|Vn)&&ir[0].length-ir[1].length==0&&(this.started=!1),this.callback(this.manager,dt,{pointers:ir[0],changedPointers:ir[1],pointerType:mn,srcEvent:Le})}}});function jt(me,Le){var dt=le(me.touches),ir=le(me.changedTouches);return Le&(ai|Vn)&&(dt=xe(dt.concat(ir),"identifier",!0)),[dt,ir]}var Ir={touchstart:Vi,touchmove:Ni,touchend:ai,touchcancel:Vn},sr="touchstart touchmove touchend touchcancel";function cr(){this.evTarget=sr,this.targetIds={},et.apply(this,arguments)}rr(cr,et,{handler:function(Le){var dt=Ir[Le.type],ir=Rr.call(this,Le,dt);!ir||this.callback(this.manager,dt,{pointers:ir[0],changedPointers:ir[1],pointerType:mn,srcEvent:Le})}});function Rr(me,Le){var dt=le(me.touches),ir=this.targetIds;if(Le&(Vi|Ni)&&dt.length===1)return ir[dt[0].identifier]=!0,[dt,dt];var Vr,Un,Bi=le(me.changedTouches),qa=[],Oa=this.target;if(Un=dt.filter(function(ja){return Mr(ja.target,Oa)}),Le===Vi)for(Vr=0;Vr<Un.length;)ir[Un[Vr].identifier]=!0,Vr++;for(Vr=0;Vr<Bi.length;)ir[Bi[Vr].identifier]&&qa.push(Bi[Vr]),Le&(ai|Vn)&&delete ir[Bi[Vr].identifier],Vr++;if(!!qa.length)return[xe(Un.concat(qa),"identifier",!0),qa]}var zn=2500,Tn=25;function tr(){et.apply(this,arguments);var me=At(this.handler,this);this.touch=new cr(this.manager,me),this.mouse=new Ki(this.manager,me),this.primaryTouch=null,this.lastTouches=[]}rr(tr,et,{handler:function(Le,dt,ir){var Vr=ir.pointerType==mn,Un=ir.pointerType==Ri;if(!(Un&&ir.sourceCapabilities&&ir.sourceCapabilities.firesTouchEvents)){if(Vr)_n.call(this,dt,ir);else if(Un&&cn.call(this,ir))return;this.callback(Le,dt,ir)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function _n(me,Le){me&Vi?(this.primaryTouch=Le.changedPointers[0].identifier,rn.call(this,Le)):me&(ai|Vn)&&rn.call(this,Le)}function rn(me){var Le=me.changedPointers[0];if(Le.identifier===this.primaryTouch){var dt={x:Le.clientX,y:Le.clientY};this.lastTouches.push(dt);var ir=this.lastTouches,Vr=function(){var Un=ir.indexOf(dt);Un>-1&&ir.splice(Un,1)};setTimeout(Vr,zn)}}function cn(me){for(var Le=me.srcEvent.clientX,dt=me.srcEvent.clientY,ir=0;ir<this.lastTouches.length;ir++){var Vr=this.lastTouches[ir],Un=Math.abs(Le-Vr.x),Bi=Math.abs(dt-Vr.y);if(Un<=Tn&&Bi<=Tn)return!0}return!1}var wi=we?N:Qe(ke.style,"touchAction"),gn=wi!==N,zi="compute",ca="auto",sn="manipulation",ki="none",Pi="pan-x",vi="pan-y",Ji=ji();function qt(me,Le){this.manager=me,this.set(Le)}qt.prototype={set:function(me){me==zi&&(me=this.compute()),gn&&this.manager.element.style&&Ji[me]&&(this.manager.element.style[wi]=me),this.actions=me.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var me=[];return Tt(this.manager.recognizers,function(Le){nt(Le.options.enable,[Le])&&(me=me.concat(Le.getTouchAction()))}),Gt(me.join(" "))},preventDefaults:function(me){var Le=me.srcEvent,dt=me.offsetDirection;if(this.manager.session.prevented){Le.preventDefault();return}var ir=this.actions,Vr=q(ir,ki)&&!Ji[ki],Un=q(ir,vi)&&!Ji[vi],Bi=q(ir,Pi)&&!Ji[Pi];if(Vr){var qa=me.pointers.length===1,Oa=me.distance<2,ja=me.deltaTime<250;if(qa&&Oa&&ja)return}if(!(Bi&&Un)&&(Vr||Un&&dt&de||Bi&&dt&V))return this.preventSrc(Le)},preventSrc:function(me){this.manager.session.prevented=!0,me.preventDefault()}};function Gt(me){if(q(me,ki))return ki;var Le=q(me,Pi),dt=q(me,vi);return Le&&dt?ki:Le||dt?Le?Pi:vi:q(me,sn)?sn:ca}function ji(){if(!gn)return!1;var me={};if(we)return me;var Le=Y.CSS&&Y.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(dt){me[dt]=Le?Y.CSS.supports("touch-action",dt):!0}),me}var Hi=1,Pa=2,so=4,Fa=8,Ea=Fa,Wr=16,Hr=32;function yt(me){this.options=pt({},this.defaults,me||{}),this.id=Bt(),this.manager=null,this.options.enable=Zt(this.options.enable,!0),this.state=Hi,this.simultaneous={},this.requireFail=[]}yt.prototype={defaults:{},set:function(me){return pt(this.options,me),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(me){if(Ut(me,"recognizeWith",this))return this;var Le=this.simultaneous;return me=Na(me,this),Le[me.id]||(Le[me.id]=me,me.recognizeWith(this)),this},dropRecognizeWith:function(me){return Ut(me,"dropRecognizeWith",this)?this:(me=Na(me,this),delete this.simultaneous[me.id],this)},requireFailure:function(me){if(Ut(me,"requireFailure",this))return this;var Le=this.requireFail;return me=Na(me,this),b(Le,me)===-1&&(Le.push(me),me.requireFailure(this)),this},dropRequireFailure:function(me){if(Ut(me,"dropRequireFailure",this))return this;me=Na(me,this);var Le=b(this.requireFail,me);return Le>-1&&this.requireFail.splice(Le,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(me){return!!this.simultaneous[me.id]},emit:function(me){var Le=this,dt=this.state;function ir(Vr){Le.manager.emit(Vr,me)}dt<Fa&&ir(Le.options.event+Bs(dt)),ir(Le.options.event),me.additionalEvent&&ir(me.additionalEvent),dt>=Fa&&ir(Le.options.event+Bs(dt))},tryEmit:function(me){if(this.canEmit())return this.emit(me);this.state=Hr},canEmit:function(){for(var me=0;me<this.requireFail.length;){if(!(this.requireFail[me].state&(Hr|Hi)))return!1;me++}return!0},recognize:function(me){var Le=pt({},me);if(!nt(this.options.enable,[this,Le])){this.reset(),this.state=Hr;return}this.state&(Ea|Wr|Hr)&&(this.state=Hi),this.state=this.process(Le),this.state&(Pa|so|Fa|Wr)&&this.tryEmit(Le)},process:function(me){},getTouchAction:function(){},reset:function(){}};function Bs(me){return me&Wr?"cancel":me&Fa?"end":me&so?"move":me&Pa?"start":""}function he(me){return me==Et?"down":me==ri?"up":me==Li?"left":me==ra?"right":""}function Na(me,Le){var dt=Le.manager;return dt?dt.get(me):me}function Ya(){yt.apply(this,arguments)}rr(Ya,yt,{defaults:{pointers:1},attrTest:function(me){var Le=this.options.pointers;return Le===0||me.pointers.length===Le},process:function(me){var Le=this.state,dt=me.eventType,ir=Le&(Pa|so),Vr=this.attrTest(me);return ir&&(dt&Vn||!Vr)?Le|Wr:ir||Vr?dt&ai?Le|Fa:Le&Pa?Le|so:Pa:Hr}});function oa(){Ya.apply(this,arguments),this.pX=null,this.pY=null}rr(oa,Ya,{defaults:{event:"pan",threshold:10,pointers:1,direction:X},getTouchAction:function(){var me=this.options.direction,Le=[];return me&de&&Le.push(vi),me&V&&Le.push(Pi),Le},directionTest:function(me){var Le=this.options,dt=!0,ir=me.distance,Vr=me.direction,Un=me.deltaX,Bi=me.deltaY;return Vr&Le.direction||(Le.direction&de?(Vr=Un===0?Yn:Un<0?Li:ra,dt=Un!=this.pX,ir=Math.abs(me.deltaX)):(Vr=Bi===0?Yn:Bi<0?ri:Et,dt=Bi!=this.pY,ir=Math.abs(me.deltaY))),me.direction=Vr,dt&&ir>Le.threshold&&Vr&Le.direction},attrTest:function(me){return Ya.prototype.attrTest.call(this,me)&&(this.state&Pa||!(this.state&Pa)&&this.directionTest(me))},emit:function(me){this.pX=me.deltaX,this.pY=me.deltaY;var Le=he(me.direction);Le&&(me.additionalEvent=this.options.event+Le),this._super.emit.call(this,me)}});function uo(){Ya.apply(this,arguments)}rr(uo,Ya,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ki]},attrTest:function(me){return this._super.attrTest.call(this,me)&&(Math.abs(me.scale-1)>this.options.threshold||this.state&Pa)},emit:function(me){if(me.scale!==1){var Le=me.scale<1?"in":"out";me.additionalEvent=this.options.event+Le}this._super.emit.call(this,me)}});function Co(){yt.apply(this,arguments),this._timer=null,this._input=null}rr(Co,yt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ca]},process:function(me){var Le=this.options,dt=me.pointers.length===Le.pointers,ir=me.distance<Le.threshold,Vr=me.deltaTime>Le.time;if(this._input=me,!ir||!dt||me.eventType&(ai|Vn)&&!Vr)this.reset();else if(me.eventType&Vi)this.reset(),this._timer=_t(function(){this.state=Ea,this.tryEmit()},Le.time,this);else if(me.eventType&ai)return Ea;return Hr},reset:function(){clearTimeout(this._timer)},emit:function(me){this.state===Ea&&(me&&me.eventType&ai?this.manager.emit(this.options.event+"up",me):(this._input.timeStamp=Jt(),this.manager.emit(this.options.event,this._input)))}});function Ru(){Ya.apply(this,arguments)}rr(Ru,Ya,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ki]},attrTest:function(me){return this._super.attrTest.call(this,me)&&(Math.abs(me.rotation)>this.options.threshold||this.state&Pa)}});function yo(){Ya.apply(this,arguments)}rr(yo,Ya,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:de|V,pointers:1},getTouchAction:function(){return oa.prototype.getTouchAction.call(this)},attrTest:function(me){var Le=this.options.direction,dt;return Le&(de|V)?dt=me.overallVelocity:Le&de?dt=me.overallVelocityX:Le&V&&(dt=me.overallVelocityY),this._super.attrTest.call(this,me)&&Le&me.offsetDirection&&me.distance>this.options.threshold&&me.maxPointers==this.options.pointers&&Je(dt)>this.options.velocity&&me.eventType&ai},emit:function(me){var Le=he(me.offsetDirection);Le&&this.manager.emit(this.options.event+Le,me),this.manager.emit(this.options.event,me)}});function Ao(){yt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}rr(Ao,yt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[sn]},process:function(me){var Le=this.options,dt=me.pointers.length===Le.pointers,ir=me.distance<Le.threshold,Vr=me.deltaTime<Le.time;if(this.reset(),me.eventType&Vi&&this.count===0)return this.failTimeout();if(ir&&Vr&&dt){if(me.eventType!=ai)return this.failTimeout();var Un=this.pTime?me.timeStamp-this.pTime<Le.interval:!0,Bi=!this.pCenter||Dr(this.pCenter,me.center)<Le.posThreshold;this.pTime=me.timeStamp,this.pCenter=me.center,!Bi||!Un?this.count=1:this.count+=1,this._input=me;var qa=this.count%Le.taps;if(qa===0)return this.hasRequireFailures()?(this._timer=_t(function(){this.state=Ea,this.tryEmit()},Le.interval,this),Pa):Ea}return Hr},failTimeout:function(){return this._timer=_t(function(){this.state=Hr},this.options.interval,this),Hr},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ea&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function da(me,Le){return Le=Le||{},Le.recognizers=Zt(Le.recognizers,da.defaults.preset),new co(me,Le)}da.VERSION="2.0.7",da.defaults={domEvents:!1,touchAction:zi,enable:!0,inputTarget:null,inputClass:null,preset:[[Ru,{enable:!1}],[uo,{enable:!1},["rotate"]],[yo,{direction:de}],[oa,{direction:de},["swipe"]],[Ao],[Ao,{event:"doubletap",taps:2},["tap"]],[Co]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var lo=1,Vo=2;function co(me,Le){this.options=pt({},da.defaults,Le||{}),this.options.inputTarget=this.options.inputTarget||me,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=me,this.input=Qt(this),this.touchAction=new qt(this,this.options.touchAction),Ns(this,!0),Tt(this.options.recognizers,function(dt){var ir=this.add(new dt[0](dt[1]));dt[2]&&ir.recognizeWith(dt[2]),dt[3]&&ir.requireFailure(dt[3])},this)}co.prototype={set:function(me){return pt(this.options,me),me.touchAction&&this.touchAction.update(),me.inputTarget&&(this.input.destroy(),this.input.target=me.inputTarget,this.input.init()),this},stop:function(me){this.session.stopped=me?Vo:lo},recognize:function(me){var Le=this.session;if(!Le.stopped){this.touchAction.preventDefaults(me);var dt,ir=this.recognizers,Vr=Le.curRecognizer;(!Vr||Vr&&Vr.state&Ea)&&(Vr=Le.curRecognizer=null);for(var Un=0;Un<ir.length;)dt=ir[Un],Le.stopped!==Vo&&(!Vr||dt==Vr||dt.canRecognizeWith(Vr))?dt.recognize(me):dt.reset(),!Vr&&dt.state&(Pa|so|Fa)&&(Vr=Le.curRecognizer=dt),Un++}},get:function(me){if(me instanceof yt)return me;for(var Le=this.recognizers,dt=0;dt<Le.length;dt++)if(Le[dt].options.event==me)return Le[dt];return null},add:function(me){if(Ut(me,"add",this))return this;var Le=this.get(me.options.event);return Le&&this.remove(Le),this.recognizers.push(me),me.manager=this,this.touchAction.update(),me},remove:function(me){if(Ut(me,"remove",this))return this;if(me=this.get(me),me){var Le=this.recognizers,dt=b(Le,me);dt!==-1&&(Le.splice(dt,1),this.touchAction.update())}return this},on:function(me,Le){if(me!==N&&Le!==N){var dt=this.handlers;return Tt(pe(me),function(ir){dt[ir]=dt[ir]||[],dt[ir].push(Le)}),this}},off:function(me,Le){if(me!==N){var dt=this.handlers;return Tt(pe(me),function(ir){Le?dt[ir]&&dt[ir].splice(b(dt[ir],Le),1):delete dt[ir]}),this}},emit:function(me,Le){this.options.domEvents&&ul(me,Le);var dt=this.handlers[me]&&this.handlers[me].slice();if(!(!dt||!dt.length)){Le.type=me,Le.preventDefault=function(){Le.srcEvent.preventDefault()};for(var ir=0;ir<dt.length;)dt[ir](Le),ir++}},destroy:function(){this.element&&Ns(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ns(me,Le){var dt=me.element;if(!!dt.style){var ir;Tt(me.options.cssProps,function(Vr,Un){ir=Qe(dt.style,Un),Le?(me.oldCssProps[ir]=dt.style[ir],dt.style[ir]=Vr):dt.style[ir]=me.oldCssProps[ir]||""}),Le||(me.oldCssProps={})}}function ul(me,Le){if(!we){var dt=g.createEvent("Event");dt.initEvent(me,!0,!0),dt.gesture=Le,Le.target.dispatchEvent(dt)}}if(!we){pt(da,{INPUT_START:Vi,INPUT_MOVE:Ni,INPUT_END:ai,INPUT_CANCEL:Vn,STATE_POSSIBLE:Hi,STATE_BEGAN:Pa,STATE_CHANGED:so,STATE_ENDED:Fa,STATE_RECOGNIZED:Ea,STATE_CANCELLED:Wr,STATE_FAILED:Hr,DIRECTION_NONE:Yn,DIRECTION_LEFT:Li,DIRECTION_RIGHT:ra,DIRECTION_UP:ri,DIRECTION_DOWN:Et,DIRECTION_HORIZONTAL:de,DIRECTION_VERTICAL:V,DIRECTION_ALL:X,Manager:co,Input:et,TouchAction:qt,TouchInput:cr,MouseInput:Ki,PointerEventInput:Ze,TouchMouseInput:tr,SingleTouchInput:Ye,Recognizer:yt,AttrRecognizer:Ya,Tap:Ao,Pan:oa,Swipe:yo,Pinch:uo,Rotate:Ru,Press:Co,on:ut,off:nr,each:Tt,merge:ee,extend:Vt,assign:pt,inherit:rr,bindFn:At,prefixed:Qe});var us=typeof window!="undefined"?window:typeof self!="undefined"?self:{};us.Hammer=da,J=function(){return da}.call(ie,F,ie,It),J!==N&&(It.exports=J)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(It,ie,F){(function(J,Y){It.exports=Y(F(18857))})(this,function(J){"use strict";var Y=function(Z){return Z instanceof Uint8Array||Z instanceof Uint16Array||Z instanceof Uint32Array||Z instanceof Int8Array||Z instanceof Int16Array||Z instanceof Int32Array||Z instanceof Float32Array||Z instanceof Float64Array||Z instanceof Uint8ClampedArray},g=function(Z,Me){for(var qe=Object.keys(Me),lr=0;lr<qe.length;++lr)Z[qe[lr]]=Me[qe[lr]];return Z},fe=`
`;function N(Z){return typeof atob!="undefined"?atob(Z):"base64:"+Z}function oe(Z){var Me=new Error("(regl) "+Z);throw console.error(Me),Me}function ne(Z,Me){Z||oe(Me)}function we(Z){return Z?": "+Z:""}function re(Z,Me,qe){Z in Me||oe("unknown parameter ("+Z+")"+we(qe)+". possible values: "+Object.keys(Me).join())}function ke(Z,Me){Y(Z)||oe("invalid parameter type"+we(Me)+". must be a typed array")}function Ve(Z,Me){switch(Me){case"number":return typeof Z=="number";case"object":return typeof Z=="object";case"string":return typeof Z=="string";case"boolean":return typeof Z=="boolean";case"function":return typeof Z=="function";case"undefined":return typeof Z=="undefined";case"symbol":return typeof Z=="symbol"}}function Ne(Z,Me,qe){Ve(Z,Me)||oe("invalid parameter type"+we(qe)+". expected "+Me+", got "+typeof Z)}function Je(Z,Me){Z>=0&&(Z|0)===Z||oe("invalid parameter type, ("+Z+")"+we(Me)+". must be a nonnegative integer")}function Jt(Z,Me,qe){Me.indexOf(Z)<0&&oe("invalid value"+we(qe)+". must be one of: "+Me)}var _t=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Ut(Z){Object.keys(Z).forEach(function(Me){_t.indexOf(Me)<0&&oe('invalid regl constructor argument "'+Me+'". must be one of '+_t)})}function Tt(Z,Me){for(Z=Z+"";Z.length<Me;)Z=" "+Z;return Z}function vt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function pt(Z,Me){this.number=Z,this.line=Me,this.errors=[]}function Vt(Z,Me,qe){this.file=Z,this.line=Me,this.message=qe}function ee(){var Z=new Error,Me=(Z.stack||Z).toString(),qe=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Me);if(qe)return qe[1];var lr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Me);return lr?lr[1]:"unknown"}function rr(){var Z=new Error,Me=(Z.stack||Z).toString(),qe=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Me);if(qe)return qe[1];var lr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Me);return lr?lr[1]:"unknown"}function At(Z,Me){var qe=Z.split(`
`),lr=1,Sr=0,ar={unknown:new vt,0:new vt};ar.unknown.name=ar[0].name=Me||ee(),ar.unknown.lines.push(new pt(0,""));for(var yr=0;yr<qe.length;++yr){var Tr=qe[yr],Fr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Tr);if(Fr)switch(Fr[1]){case"line":var wt=/(\d+)(\s+\d+)?/.exec(Fr[2]);wt&&(lr=wt[1]|0,wt[2]&&(Sr=wt[2]|0,Sr in ar||(ar[Sr]=new vt)));break;case"define":var Gr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Fr[2]);Gr&&(ar[Sr].name=Gr[1]?N(Gr[2]):Gr[2]);break}ar[Sr].lines.push(new pt(lr++,Tr))}return Object.keys(ar).forEach(function(Ke){var on=ar[Ke];on.lines.forEach(function(zr){on.index[zr.number]=zr})}),ar}function nt(Z){var Me=[];return Z.split(`
`).forEach(function(qe){if(!(qe.length<5)){var lr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(qe);lr?Me.push(new Vt(lr[1]|0,lr[2]|0,lr[3].trim())):qe.length>0&&Me.push(new Vt("unknown",0,qe))}}),Me}function Zt(Z,Me){Me.forEach(function(qe){var lr=Z[qe.file];if(lr){var Sr=lr.index[qe.line];if(Sr){Sr.errors.push(qe),lr.hasErrors=!0;return}}Z.unknown.hasErrors=!0,Z.unknown.lines[0].errors.push(qe)})}function ut(Z,Me,qe,lr,Sr){if(!Z.getShaderParameter(Me,Z.COMPILE_STATUS)){var ar=Z.getShaderInfoLog(Me),yr=lr===Z.FRAGMENT_SHADER?"fragment":"vertex";xe(qe,"string",yr+" shader source must be a string",Sr);var Tr=At(qe,Sr),Fr=nt(ar);Zt(Tr,Fr),Object.keys(Tr).forEach(function(wt){var Gr=Tr[wt];if(!Gr.hasErrors)return;var Ke=[""],on=[""];function zr(jr,kt){Ke.push(jr),on.push(kt||"")}zr("file number "+wt+": "+Gr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Gr.lines.forEach(function(jr){if(jr.errors.length>0){zr(Tt(jr.number,4)+"|  ","background-color:yellow; font-weight:bold"),zr(jr.line+fe,"color:red; background-color:yellow; font-weight:bold");var kt=0;jr.errors.forEach(function(dr){var Zr=dr.message,tn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Zr);if(tn){var Ar=tn[1];switch(Zr=tn[2],Ar){case"assign":Ar="=";break}kt=Math.max(jr.line.indexOf(Ar,kt),0)}else kt=0;zr(Tt("| ",6)),zr(Tt("^^^",kt+3)+fe,"font-weight:bold"),zr(Tt("| ",6)),zr(Zr+fe,"font-weight:bold")}),zr(Tt("| ",6)+fe)}else zr(Tt(jr.number,4)+"|  "),zr(jr.line+fe,"color:red")}),typeof document!="undefined"&&!window.chrome?(on[0]=Ke.join("%c"),console.log.apply(console,on)):console.log(Ke.join(""))}),ne.raise("Error compiling "+yr+" shader, "+Tr[0].name)}}function nr(Z,Me,qe,lr,Sr){if(!Z.getProgramParameter(Me,Z.LINK_STATUS)){var ar=Z.getProgramInfoLog(Me),yr=At(qe,Sr),Tr=At(lr,Sr),Fr='Error linking program with vertex shader, "'+Tr[0].name+'", and fragment shader "'+yr[0].name+'"';typeof document!="undefined"?console.log("%c"+Fr+fe+"%c"+ar,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Fr+fe+ar),ne.raise(Fr)}}function Mr(Z){Z._commandRef=ee()}function q(Z,Me,qe,lr){Mr(Z);function Sr(Fr){return Fr?lr.id(Fr):0}Z._fragId=Sr(Z.static.frag),Z._vertId=Sr(Z.static.vert);function ar(Fr,wt){Object.keys(wt).forEach(function(Gr){Fr[lr.id(Gr)]=!0})}var yr=Z._uniformSet={};ar(yr,Me.static),ar(yr,Me.dynamic);var Tr=Z._attributeSet={};ar(Tr,qe.static),ar(Tr,qe.dynamic),Z._hasCount="count"in Z.static||"count"in Z.dynamic||"elements"in Z.static||"elements"in Z.dynamic}function pe(Z,Me){var qe=rr();oe(Z+" in command "+(Me||ee())+(qe==="unknown"?"":" called from "+qe))}function b(Z,Me,qe){Z||pe(Me,qe||ee())}function le(Z,Me,qe,lr){Z in Me||pe("unknown parameter ("+Z+")"+we(qe)+". possible values: "+Object.keys(Me).join(),lr||ee())}function xe(Z,Me,qe,lr){Ve(Z,Me)||pe("invalid parameter type"+we(qe)+". expected "+Me+", got "+typeof Z,lr||ee())}function Qe(Z){Z()}function xt(Z,Me,qe){Z.texture?Jt(Z.texture._texture.internalformat,Me,"unsupported texture format for attachment"):Jt(Z.renderbuffer._renderbuffer.format,qe,"unsupported renderbuffer format for attachment")}var Bt=33071,Fe=9728,bt=9984,br=9985,mr=9986,An=9987,mn=5120,wn=5121,Ri=5122,Qn=5123,ii=5124,Vi=5125,Ni=5126,ai=32819,Vn=32820,Yn=33635,Li=34042,ra=36193,ri={};ri[mn]=ri[wn]=1,ri[Ri]=ri[Qn]=ri[ra]=ri[Yn]=ri[ai]=ri[Vn]=2,ri[ii]=ri[Vi]=ri[Ni]=ri[Li]=4;function Et(Z,Me){return Z===Vn||Z===ai||Z===Yn?2:Z===Li?4:ri[Z]*Me}function de(Z){return!(Z&Z-1)&&!!Z}function V(Z,Me,qe){var lr,Sr=Me.width,ar=Me.height,yr=Me.channels;ne(Sr>0&&Sr<=qe.maxTextureSize&&ar>0&&ar<=qe.maxTextureSize,"invalid texture shape"),(Z.wrapS!==Bt||Z.wrapT!==Bt)&&ne(de(Sr)&&de(ar),"incompatible wrap mode for texture, both width and height must be power of 2"),Me.mipmask===1?Sr!==1&&ar!==1&&ne(Z.minFilter!==bt&&Z.minFilter!==mr&&Z.minFilter!==br&&Z.minFilter!==An,"min filter requires mipmap"):(ne(de(Sr)&&de(ar),"texture must be a square power of 2 to support mipmapping"),ne(Me.mipmask===(Sr<<1)-1,"missing or incomplete mipmap data")),Me.type===Ni&&(qe.extensions.indexOf("oes_texture_float_linear")<0&&ne(Z.minFilter===Fe&&Z.magFilter===Fe,"filter not supported, must enable oes_texture_float_linear"),ne(!Z.genMipmaps,"mipmap generation not supported with float textures"));var Tr=Me.images;for(lr=0;lr<16;++lr)if(Tr[lr]){var Fr=Sr>>lr,wt=ar>>lr;ne(Me.mipmask&1<<lr,"missing mipmap data");var Gr=Tr[lr];if(ne(Gr.width===Fr&&Gr.height===wt,"invalid shape for mip images"),ne(Gr.format===Me.format&&Gr.internalformat===Me.internalformat&&Gr.type===Me.type,"incompatible type for mip image"),!Gr.compressed)if(Gr.data){var Ke=Math.ceil(Et(Gr.type,yr)*Fr/Gr.unpackAlignment)*Gr.unpackAlignment;ne(Gr.data.byteLength===Ke*wt,"invalid data for image, buffer size is inconsistent with image format")}else Gr.element||Gr.copy}else Z.genMipmaps||ne((Me.mipmask&1<<lr)==0,"extra mipmap data");Me.compressed&&ne(!Z.genMipmaps,"mipmap generation for compressed images not supported")}function X(Z,Me,qe,lr){var Sr=Z.width,ar=Z.height,yr=Z.channels;ne(Sr>0&&Sr<=lr.maxTextureSize&&ar>0&&ar<=lr.maxTextureSize,"invalid texture shape"),ne(Sr===ar,"cube map must be square"),ne(Me.wrapS===Bt&&Me.wrapT===Bt,"wrap mode not supported by cube map");for(var Tr=0;Tr<qe.length;++Tr){var Fr=qe[Tr];ne(Fr.width===Sr&&Fr.height===ar,"inconsistent cube map face shape"),Me.genMipmaps&&(ne(!Fr.compressed,"can not generate mipmap for compressed textures"),ne(Fr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var wt=Fr.images,Gr=0;Gr<16;++Gr){var Ke=wt[Gr];if(Ke){var on=Sr>>Gr,zr=ar>>Gr;ne(Fr.mipmask&1<<Gr,"missing mipmap data"),ne(Ke.width===on&&Ke.height===zr,"invalid shape for mip images"),ne(Ke.format===Z.format&&Ke.internalformat===Z.internalformat&&Ke.type===Z.type,"incompatible type for mip image"),Ke.compressed||(Ke.data?ne(Ke.data.byteLength===on*zr*Math.max(Et(Ke.type,yr),Ke.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Ke.element||Ke.copy)}}}}var k=g(ne,{optional:Qe,raise:oe,commandRaise:pe,command:b,parameter:re,commandParameter:le,constructor:Ut,type:Ne,commandType:xe,isTypedArray:ke,nni:Je,oneOf:Jt,shaderError:ut,linkError:nr,callSite:rr,saveCommandRef:Mr,saveDrawInfo:q,framebufferFormat:xt,guessCommand:ee,texture2D:V,textureCube:X}),Ce=0,et=0,Qt=5,Oe=6;function $e(Z,Me){this.id=Ce++,this.type=Z,this.data=Me}function Ht(Z){return Z.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function or(Z){if(Z.length===0)return[];var Me=Z.charAt(0),qe=Z.charAt(Z.length-1);if(Z.length>1&&Me===qe&&(Me==='"'||Me==="'"))return['"'+Ht(Z.substr(1,Z.length-2))+'"'];var lr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(Z);if(lr)return or(Z.substr(0,lr.index)).concat(or(lr[1])).concat(or(Z.substr(lr.index+lr[0].length)));var Sr=Z.split(".");if(Sr.length===1)return['"'+Ht(Z)+'"'];for(var ar=[],yr=0;yr<Sr.length;++yr)ar=ar.concat(or(Sr[yr]));return ar}function pr(Z){return"["+or(Z).join("][")+"]"}function xr(Z,Me){return new $e(Z,pr(Me+""))}function Qr(Z){return typeof Z=="function"&&!Z._reglType||Z instanceof $e}function en(Z,Me){if(typeof Z=="function")return new $e(et,Z);if(typeof Z=="number"||typeof Z=="boolean")return new $e(Qt,Z);if(Array.isArray(Z))return new $e(Oe,Z.map(function(qe,lr){return en(qe,Me+"["+lr+"]")}));if(Z instanceof $e)return Z;k(!1,"invalid option type in uniform "+Me)}var Dr={DynamicVariable:$e,define:xr,isDynamic:Qr,unbox:en,accessor:pr},Wn={next:typeof requestAnimationFrame=="function"?function(Z){return requestAnimationFrame(Z)}:function(Z){return setTimeout(Z,16)},cancel:typeof cancelAnimationFrame=="function"?function(Z){return cancelAnimationFrame(Z)}:clearTimeout},qn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ta=qn?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function na(){var Z={"":0},Me=[""];return{id:function(qe){var lr=Z[qe];return lr||(lr=Z[qe]=Me.length,Me.push(qe),lr)},str:function(qe){return Me[qe]}}}function ba(Z,Me,qe){var lr=document.createElement("canvas");g(lr.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),Z.appendChild(lr),Z===document.body&&(lr.style.position="absolute",g(Z.style,{margin:0,padding:0}));function Sr(){var Tr=window.innerWidth,Fr=window.innerHeight;if(Z!==document.body){var wt=lr.getBoundingClientRect();Tr=wt.right-wt.left,Fr=wt.bottom-wt.top}lr.width=qe*Tr,lr.height=qe*Fr}var ar;Z!==document.body&&typeof ResizeObserver=="function"?(ar=new ResizeObserver(function(){setTimeout(Sr)}),ar.observe(Z)):window.addEventListener("resize",Sr,!1);function yr(){ar?ar.disconnect():window.removeEventListener("resize",Sr),Z.removeChild(lr)}return Sr(),{canvas:lr,onDestroy:yr}}function ia(Z,Me){function qe(lr){try{return Z.getContext(lr,Me)}catch(Sr){return null}}return qe("webgl")||qe("experimental-webgl")||qe("webgl-experimental")}function Ki(Z){return typeof Z.nodeName=="string"&&typeof Z.appendChild=="function"&&typeof Z.getBoundingClientRect=="function"}function $(Z){return typeof Z.drawArrays=="function"||typeof Z.drawElements=="function"}function ue(Z){return typeof Z=="string"?Z.split():(k(Array.isArray(Z),"invalid extension array"),Z)}function ve(Z){return typeof Z=="string"?(k(typeof document!="undefined","not supported outside of DOM"),document.querySelector(Z)):Z}function Te(Z){var Me=Z||{},qe,lr,Sr,ar,yr={},Tr=[],Fr=[],wt=typeof window=="undefined"?1:window.devicePixelRatio,Gr=!1,Ke=function(jr){jr&&k.raise(jr)},on=function(){};if(typeof Me=="string"?(k(typeof document!="undefined","selector queries only supported in DOM environments"),qe=document.querySelector(Me),k(qe,"invalid query string for element")):typeof Me=="object"?Ki(Me)?qe=Me:$(Me)?(ar=Me,Sr=ar.canvas):(k.constructor(Me),"gl"in Me?ar=Me.gl:"canvas"in Me?Sr=ve(Me.canvas):"container"in Me&&(lr=ve(Me.container)),"attributes"in Me&&(yr=Me.attributes,k.type(yr,"object","invalid context attributes")),"extensions"in Me&&(Tr=ue(Me.extensions)),"optionalExtensions"in Me&&(Fr=ue(Me.optionalExtensions)),"onDone"in Me&&(k.type(Me.onDone,"function","invalid or missing onDone callback"),Ke=Me.onDone),"profile"in Me&&(Gr=!!Me.profile),"pixelRatio"in Me&&(wt=+Me.pixelRatio,k(wt>0,"invalid pixel ratio"))):k.raise("invalid arguments to regl"),qe&&(qe.nodeName.toLowerCase()==="canvas"?Sr=qe:lr=qe),!ar){if(!Sr){k(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var zr=ba(lr||document.body,Ke,wt);if(!zr)return null;Sr=zr.canvas,on=zr.onDestroy}yr.premultipliedAlpha===void 0&&(yr.premultipliedAlpha=!0),ar=ia(Sr,yr)}return ar?{gl:ar,canvas:Sr,container:lr,extensions:Tr,optionalExtensions:Fr,pixelRatio:wt,profile:Gr,onDone:Ke,onDestroy:on}:(on(),Ke("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ze(Z,Me){var qe={};function lr(Tr){k.type(Tr,"string","extension name must be string");var Fr=Tr.toLowerCase(),wt;try{wt=qe[Fr]=Sr(Tr)}catch(Gr){}return!!wt}function Sr(Tr){return Z.getExtension(Tr)?Z.getExtension(Tr):Z.getExtension(Tr.toLowerCase())?Z.getExtension(Tr.toLowerCase()):null}for(var ar=0;ar<Me.extensions.length;++ar){var yr=Me.extensions[ar];if(!lr(yr))return Me.onDestroy(),Me.onDone('"'+yr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Me.optionalExtensions.forEach(lr),{extensions:qe,restore:function(){Object.keys(qe).forEach(function(Tr){if(qe[Tr]&&!lr(Tr))throw new Error("(regl): error restoring extension "+Tr)})}}}function it(Z,Me){for(var qe=Array(Z),lr=0;lr<Z;++lr)qe[lr]=Me(lr);return qe}var gt=5120,be=5121,Ye=5122,jt=5123,Ir=5124,sr=5125,cr=5126;function Rr(Z){for(var Me=16;Me<=1<<28;Me*=16)if(Z<=Me)return Me;return 0}function zn(Z){var Me,qe;return Me=(Z>65535)<<4,Z>>>=Me,qe=(Z>255)<<3,Z>>>=qe,Me|=qe,qe=(Z>15)<<2,Z>>>=qe,Me|=qe,qe=(Z>3)<<1,Z>>>=qe,Me|=qe,Me|Z>>1}function Tn(){var Z=it(8,function(){return[]});function Me(ar){var yr=Rr(ar),Tr=Z[zn(yr)>>2];return Tr.length>0?Tr.pop():new ArrayBuffer(yr)}function qe(ar){Z[zn(ar.byteLength)>>2].push(ar)}function lr(ar,yr){var Tr=null;switch(ar){case gt:Tr=new Int8Array(Me(yr),0,yr);break;case be:Tr=new Uint8Array(Me(yr),0,yr);break;case Ye:Tr=new Int16Array(Me(2*yr),0,yr);break;case jt:Tr=new Uint16Array(Me(2*yr),0,yr);break;case Ir:Tr=new Int32Array(Me(4*yr),0,yr);break;case sr:Tr=new Uint32Array(Me(4*yr),0,yr);break;case cr:Tr=new Float32Array(Me(4*yr),0,yr);break;default:return null}return Tr.length!==yr?Tr.subarray(0,yr):Tr}function Sr(ar){qe(ar.buffer)}return{alloc:Me,free:qe,allocType:lr,freeType:Sr}}var tr=Tn();tr.zero=Tn();var _n=3408,rn=3410,cn=3411,wi=3412,gn=3413,zi=3414,ca=3415,sn=33901,ki=33902,Pi=3379,vi=3386,Ji=34921,qt=36347,Gt=36348,ji=35661,Hi=35660,Pa=34930,so=36349,Fa=34076,Ea=34024,Wr=7936,Hr=7937,yt=7938,Bs=35724,he=34047,Na=36063,Ya=34852,oa=3553,uo=34067,Co=34069,Ru=33984,yo=6408,Ao=5126,da=5121,lo=36160,Vo=36053,co=36064,Ns=16384,ul=function(Z,Me){var qe=1;Me.ext_texture_filter_anisotropic&&(qe=Z.getParameter(he));var lr=1,Sr=1;Me.webgl_draw_buffers&&(lr=Z.getParameter(Ya),Sr=Z.getParameter(Na));var ar=!!Me.oes_texture_float;if(ar){var yr=Z.createTexture();Z.bindTexture(oa,yr),Z.texImage2D(oa,0,yo,1,1,0,yo,Ao,null);var Tr=Z.createFramebuffer();if(Z.bindFramebuffer(lo,Tr),Z.framebufferTexture2D(lo,co,oa,yr,0),Z.bindTexture(oa,null),Z.checkFramebufferStatus(lo)!==Vo)ar=!1;else{Z.viewport(0,0,1,1),Z.clearColor(1,0,0,1),Z.clear(Ns);var Fr=tr.allocType(Ao,4);Z.readPixels(0,0,1,1,yo,Ao,Fr),Z.getError()?ar=!1:(Z.deleteFramebuffer(Tr),Z.deleteTexture(yr),ar=Fr[0]===1),tr.freeType(Fr)}}var wt=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Gr=!0;if(!wt){var Ke=Z.createTexture(),on=tr.allocType(da,36);Z.activeTexture(Ru),Z.bindTexture(uo,Ke),Z.texImage2D(Co,0,yo,3,3,0,yo,da,on),tr.freeType(on),Z.bindTexture(uo,null),Z.deleteTexture(Ke),Gr=!Z.getError()}return{colorBits:[Z.getParameter(rn),Z.getParameter(cn),Z.getParameter(wi),Z.getParameter(gn)],depthBits:Z.getParameter(zi),stencilBits:Z.getParameter(ca),subpixelBits:Z.getParameter(_n),extensions:Object.keys(Me).filter(function(zr){return!!Me[zr]}),maxAnisotropic:qe,maxDrawbuffers:lr,maxColorAttachments:Sr,pointSizeDims:Z.getParameter(sn),lineWidthDims:Z.getParameter(ki),maxViewportDims:Z.getParameter(vi),maxCombinedTextureUnits:Z.getParameter(ji),maxCubeMapSize:Z.getParameter(Fa),maxRenderbufferSize:Z.getParameter(Ea),maxTextureUnits:Z.getParameter(Pa),maxTextureSize:Z.getParameter(Pi),maxAttributes:Z.getParameter(Ji),maxVertexUniforms:Z.getParameter(qt),maxVertexTextureUnits:Z.getParameter(Hi),maxVaryingVectors:Z.getParameter(Gt),maxFragmentUniforms:Z.getParameter(so),glsl:Z.getParameter(Bs),renderer:Z.getParameter(Hr),vendor:Z.getParameter(Wr),version:Z.getParameter(yt),readFloat:ar,npotTextureCube:Gr}};function us(Z){return!!Z&&typeof Z=="object"&&Array.isArray(Z.shape)&&Array.isArray(Z.stride)&&typeof Z.offset=="number"&&Z.shape.length===Z.stride.length&&(Array.isArray(Z.data)||Y(Z.data))}var me=function(Z){return Object.keys(Z).map(function(Me){return Z[Me]})},Le={shape:qa,flatten:Bi};function dt(Z,Me,qe){for(var lr=0;lr<Me;++lr)qe[lr]=Z[lr]}function ir(Z,Me,qe,lr){for(var Sr=0,ar=0;ar<Me;++ar)for(var yr=Z[ar],Tr=0;Tr<qe;++Tr)lr[Sr++]=yr[Tr]}function Vr(Z,Me,qe,lr,Sr,ar){for(var yr=ar,Tr=0;Tr<Me;++Tr)for(var Fr=Z[Tr],wt=0;wt<qe;++wt)for(var Gr=Fr[wt],Ke=0;Ke<lr;++Ke)Sr[yr++]=Gr[Ke]}function Un(Z,Me,qe,lr,Sr){for(var ar=1,yr=qe+1;yr<Me.length;++yr)ar*=Me[yr];var Tr=Me[qe];if(Me.length-qe==4){var Fr=Me[qe+1],wt=Me[qe+2],Gr=Me[qe+3];for(yr=0;yr<Tr;++yr)Vr(Z[yr],Fr,wt,Gr,lr,Sr),Sr+=ar}else for(yr=0;yr<Tr;++yr)Un(Z[yr],Me,qe+1,lr,Sr),Sr+=ar}function Bi(Z,Me,qe,lr){var Sr=1;if(Me.length)for(var ar=0;ar<Me.length;++ar)Sr*=Me[ar];else Sr=0;var yr=lr||tr.allocType(qe,Sr);switch(Me.length){case 0:break;case 1:dt(Z,Me[0],yr);break;case 2:ir(Z,Me[0],Me[1],yr);break;case 3:Vr(Z,Me[0],Me[1],Me[2],yr,0);break;default:Un(Z,Me,0,yr,0)}return yr}function qa(Z){for(var Me=[],qe=Z;qe.length;qe=qe[0])Me.push(qe.length);return Me}var Oa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ja=5120,Go=5122,ms=5124,Ho=5121,ls=5123,gs=5125,ws=5126,Qo=5126,cs={int8:ja,int16:Go,int32:ms,uint8:Ho,uint16:ls,uint32:gs,float:ws,float32:Qo},ys=35048,Sa=35040,_o={dynamic:ys,stream:Sa,static:35044},ec=Le.flatten,kc=Le.shape,Yu=35044,fs=35040,Jo=5121,Ol=5126,bu=[];bu[5120]=1,bu[5122]=2,bu[5124]=4,bu[5121]=1,bu[5123]=2,bu[5125]=4,bu[5126]=4;function Ts(Z){return Oa[Object.prototype.toString.call(Z)]|0}function x(Z,Me){for(var qe=0;qe<Me.length;++qe)Z[qe]=Me[qe]}function M(Z,Me,qe,lr,Sr,ar,yr){for(var Tr=0,Fr=0;Fr<qe;++Fr)for(var wt=0;wt<lr;++wt)Z[Tr++]=Me[Sr*Fr+ar*wt+yr]}function z(Z,Me,qe,lr){var Sr=0,ar={};function yr(kt){this.id=Sr++,this.buffer=Z.createBuffer(),this.type=kt,this.usage=Yu,this.byteLength=0,this.dimension=1,this.dtype=Jo,this.persistentData=null,qe.profile&&(this.stats={size:0})}yr.prototype.bind=function(){Z.bindBuffer(this.type,this.buffer)},yr.prototype.destroy=function(){on(this)};var Tr=[];function Fr(kt,dr){var Zr=Tr.pop();return Zr||(Zr=new yr(kt)),Zr.bind(),Ke(Zr,dr,fs,0,1,!1),Zr}function wt(kt){Tr.push(kt)}function Gr(kt,dr,Zr){kt.byteLength=dr.byteLength,Z.bufferData(kt.type,dr,Zr)}function Ke(kt,dr,Zr,tn,Ar,qr){var vn;if(kt.usage=Zr,Array.isArray(dr)){if(kt.dtype=tn||Ol,dr.length>0){var $n;if(Array.isArray(dr[0])){vn=kc(dr);for(var gr=1,Er=1;Er<vn.length;++Er)gr*=vn[Er];kt.dimension=gr,$n=ec(dr,vn,kt.dtype),Gr(kt,$n,Zr),qr?kt.persistentData=$n:tr.freeType($n)}else if(typeof dr[0]=="number"){kt.dimension=Ar;var Fn=tr.allocType(kt.dtype,dr.length);x(Fn,dr),Gr(kt,Fn,Zr),qr?kt.persistentData=Fn:tr.freeType(Fn)}else Y(dr[0])?(kt.dimension=dr[0].length,kt.dtype=tn||Ts(dr[0])||Ol,$n=ec(dr,[dr.length,dr[0].length],kt.dtype),Gr(kt,$n,Zr),qr?kt.persistentData=$n:tr.freeType($n)):k.raise("invalid buffer data")}}else if(Y(dr))kt.dtype=tn||Ts(dr),kt.dimension=Ar,Gr(kt,dr,Zr),qr&&(kt.persistentData=new Uint8Array(new Uint8Array(dr.buffer)));else if(us(dr)){vn=dr.shape;var un=dr.stride,Ur=dr.offset,fn=0,dn=0,Mi=0,yi=0;vn.length===1?(fn=vn[0],dn=1,Mi=un[0],yi=0):vn.length===2?(fn=vn[0],dn=vn[1],Mi=un[0],yi=un[1]):k.raise("invalid shape"),kt.dtype=tn||Ts(dr.data)||Ol,kt.dimension=dn;var hn=tr.allocType(kt.dtype,fn*dn);M(hn,dr.data,fn,dn,Mi,yi,Ur),Gr(kt,hn,Zr),qr?kt.persistentData=hn:tr.freeType(hn)}else dr instanceof ArrayBuffer?(kt.dtype=Jo,kt.dimension=Ar,Gr(kt,dr,Zr),qr&&(kt.persistentData=new Uint8Array(new Uint8Array(dr)))):k.raise("invalid buffer data")}function on(kt){Me.bufferCount--,lr(kt);var dr=kt.buffer;k(dr,"buffer must not be deleted already"),Z.deleteBuffer(dr),kt.buffer=null,delete ar[kt.id]}function zr(kt,dr,Zr,tn){Me.bufferCount++;var Ar=new yr(dr);ar[Ar.id]=Ar;function qr(gr){var Er=Yu,Fn=null,un=0,Ur=0,fn=1;return Array.isArray(gr)||Y(gr)||us(gr)||gr instanceof ArrayBuffer?Fn=gr:typeof gr=="number"?un=gr|0:gr&&(k.type(gr,"object","buffer arguments must be an object, a number or an array"),"data"in gr&&(k(Fn===null||Array.isArray(Fn)||Y(Fn)||us(Fn),"invalid data for buffer"),Fn=gr.data),"usage"in gr&&(k.parameter(gr.usage,_o,"invalid buffer usage"),Er=_o[gr.usage]),"type"in gr&&(k.parameter(gr.type,cs,"invalid buffer type"),Ur=cs[gr.type]),"dimension"in gr&&(k.type(gr.dimension,"number","invalid dimension"),fn=gr.dimension|0),"length"in gr&&(k.nni(un,"buffer length must be a nonnegative integer"),un=gr.length|0)),Ar.bind(),Fn?Ke(Ar,Fn,Er,Ur,fn,tn):(un&&Z.bufferData(Ar.type,un,Er),Ar.dtype=Ur||Jo,Ar.usage=Er,Ar.dimension=fn,Ar.byteLength=un),qe.profile&&(Ar.stats.size=Ar.byteLength*bu[Ar.dtype]),qr}function vn(gr,Er){k(Er+gr.byteLength<=Ar.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+gr.byteLength+" starting from offset "+Er+" to a buffer of size "+Ar.byteLength),Z.bufferSubData(Ar.type,Er,gr)}function $n(gr,Er){var Fn=(Er||0)|0,un;if(Ar.bind(),Y(gr)||gr instanceof ArrayBuffer)vn(gr,Fn);else if(Array.isArray(gr)){if(gr.length>0)if(typeof gr[0]=="number"){var Ur=tr.allocType(Ar.dtype,gr.length);x(Ur,gr),vn(Ur,Fn),tr.freeType(Ur)}else if(Array.isArray(gr[0])||Y(gr[0])){un=kc(gr);var fn=ec(gr,un,Ar.dtype);vn(fn,Fn),tr.freeType(fn)}else k.raise("invalid buffer data")}else if(us(gr)){un=gr.shape;var dn=gr.stride,Mi=0,yi=0,hn=0,En=0;un.length===1?(Mi=un[0],yi=1,hn=dn[0],En=0):un.length===2?(Mi=un[0],yi=un[1],hn=dn[0],En=dn[1]):k.raise("invalid shape");var di=Array.isArray(gr.data)?Ar.dtype:Ts(gr.data),Ai=tr.allocType(di,Mi*yi);M(Ai,gr.data,Mi,yi,hn,En,gr.offset),vn(Ai,Fn),tr.freeType(Ai)}else k.raise("invalid data for buffer subdata");return qr}return Zr||qr(kt),qr._reglType="buffer",qr._buffer=Ar,qr.subdata=$n,qe.profile&&(qr.stats=Ar.stats),qr.destroy=function(){on(Ar)},qr}function jr(){me(ar).forEach(function(kt){kt.buffer=Z.createBuffer(),Z.bindBuffer(kt.type,kt.buffer),Z.bufferData(kt.type,kt.persistentData||kt.byteLength,kt.usage)})}return qe.profile&&(Me.getTotalBufferSize=function(){var kt=0;return Object.keys(ar).forEach(function(dr){kt+=ar[dr].stats.size}),kt}),{create:zr,createStream:Fr,destroyStream:wt,clear:function(){me(ar).forEach(on),Tr.forEach(on)},getBuffer:function(kt){return kt&&kt._buffer instanceof yr?kt._buffer:null},restore:jr,_initBuffer:Ke}}var R=0,se=0,Ie=1,ct=1,Dt=4,Rt=4,wr={points:R,point:se,lines:Ie,line:ct,triangles:Dt,triangle:Rt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Br=0,Xn=1,bi=4,ci=5120,Ei=5121,ua=5122,Ca=5123,Si=5124,_s=5125,uu=34963,ll=35040,mf=35044;function cl(Z,Me,qe,lr){var Sr={},ar=0,yr={uint8:Ei,uint16:Ca};Me.oes_element_index_uint&&(yr.uint32=_s);function Tr(jr){this.id=ar++,Sr[this.id]=this,this.buffer=jr,this.primType=bi,this.vertCount=0,this.type=0}Tr.prototype.bind=function(){this.buffer.bind()};var Fr=[];function wt(jr){var kt=Fr.pop();return kt||(kt=new Tr(qe.create(null,uu,!0,!1)._buffer)),Ke(kt,jr,ll,-1,-1,0,0),kt}function Gr(jr){Fr.push(jr)}function Ke(jr,kt,dr,Zr,tn,Ar,qr){jr.buffer.bind();var vn;if(kt){var $n=qr;!qr&&(!Y(kt)||us(kt)&&!Y(kt.data))&&($n=Me.oes_element_index_uint?_s:Ca),qe._initBuffer(jr.buffer,kt,dr,$n,3)}else Z.bufferData(uu,Ar,dr),jr.buffer.dtype=vn||Ei,jr.buffer.usage=dr,jr.buffer.dimension=3,jr.buffer.byteLength=Ar;if(vn=qr,!qr){switch(jr.buffer.dtype){case Ei:case ci:vn=Ei;break;case Ca:case ua:vn=Ca;break;case _s:case Si:vn=_s;break;default:k.raise("unsupported type for element array")}jr.buffer.dtype=vn}jr.type=vn,k(vn!==_s||!!Me.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var gr=tn;gr<0&&(gr=jr.buffer.byteLength,vn===Ca?gr>>=1:vn===_s&&(gr>>=2)),jr.vertCount=gr;var Er=Zr;if(Zr<0){Er=bi;var Fn=jr.buffer.dimension;Fn===1&&(Er=Br),Fn===2&&(Er=Xn),Fn===3&&(Er=bi)}jr.primType=Er}function on(jr){lr.elementsCount--,k(jr.buffer!==null,"must not double destroy elements"),delete Sr[jr.id],jr.buffer.destroy(),jr.buffer=null}function zr(jr,kt){var dr=qe.create(null,uu,!0),Zr=new Tr(dr._buffer);lr.elementsCount++;function tn(Ar){if(!Ar)dr(),Zr.primType=bi,Zr.vertCount=0,Zr.type=Ei;else if(typeof Ar=="number")dr(Ar),Zr.primType=bi,Zr.vertCount=Ar|0,Zr.type=Ei;else{var qr=null,vn=mf,$n=-1,gr=-1,Er=0,Fn=0;Array.isArray(Ar)||Y(Ar)||us(Ar)?qr=Ar:(k.type(Ar,"object","invalid arguments for elements"),"data"in Ar&&(qr=Ar.data,k(Array.isArray(qr)||Y(qr)||us(qr),"invalid data for element buffer")),"usage"in Ar&&(k.parameter(Ar.usage,_o,"invalid element buffer usage"),vn=_o[Ar.usage]),"primitive"in Ar&&(k.parameter(Ar.primitive,wr,"invalid element buffer primitive"),$n=wr[Ar.primitive]),"count"in Ar&&(k(typeof Ar.count=="number"&&Ar.count>=0,"invalid vertex count for elements"),gr=Ar.count|0),"type"in Ar&&(k.parameter(Ar.type,yr,"invalid buffer type"),Fn=yr[Ar.type]),"length"in Ar?Er=Ar.length|0:(Er=gr,Fn===Ca||Fn===ua?Er*=2:(Fn===_s||Fn===Si)&&(Er*=4))),Ke(Zr,qr,vn,$n,gr,Er,Fn)}return tn}return tn(jr),tn._reglType="elements",tn._elements=Zr,tn.subdata=function(Ar,qr){return dr.subdata(Ar,qr),tn},tn.destroy=function(){on(Zr)},tn}return{create:zr,createStream:wt,destroyStream:Gr,getElements:function(jr){return typeof jr=="function"&&jr._elements instanceof Tr?jr._elements:null},clear:function(){me(Sr).forEach(on)}}}var tc=new Float32Array(1),Eu=new Uint32Array(tc.buffer),Lu=5123;function ku(Z){for(var Me=tr.allocType(Lu,Z.length),qe=0;qe<Z.length;++qe)if(isNaN(Z[qe]))Me[qe]=65535;else if(Z[qe]===Infinity)Me[qe]=31744;else if(Z[qe]===-Infinity)Me[qe]=64512;else{tc[0]=Z[qe];var lr=Eu[0],Sr=lr>>>31<<15,ar=(lr<<1>>>24)-127,yr=lr>>13&(1<<10)-1;if(ar<-24)Me[qe]=Sr;else if(ar<-14){var Tr=-14-ar;Me[qe]=Sr+(yr+(1<<10)>>Tr)}else ar>15?Me[qe]=Sr+31744:Me[qe]=Sr+(ar+15<<10)+yr}return Me}function fo(Z){return Array.isArray(Z)||Y(Z)}var $f=function(Z){return!(Z&Z-1)&&!!Z},Qf=34467,xs=3553,gf=34067,Du=34069,Ks=6408,rc=6406,qu=6407,Aa=6409,nc=6410,Oh=32854,Il=32855,zs=36194,up=32819,Ih=32820,yf=33635,fl=34042,Ku=6402,Rl=34041,ic=35904,Ll=35906,ac=36193,kl=33776,$s=33777,_f=33778,xf=33779,bf=35986,hl=35987,oc=34798,Dc=35840,Ef=35841,$u=35842,Rh=35843,Fc=36196,pl=5121,sc=5123,Jf=5125,Dl=5126,Lh=10242,eh=10243,th=10497,uc=33071,Sf=33648,lc=10240,Ka=10241,Bc=9728,Fl=9729,Fu=9984,Ci=9985,Ia=9986,Gi=9987,Nc=33170,dl=4352,zc=4353,kh=4354,lp=34046,Zc=3317,za=37440,Zs=37441,Va=37443,Bu=37444,cc=33984,go=[Fu,Ia,Ci,Gi],Mn=[0,Aa,nc,qu,Ks],$a={};$a[Aa]=$a[rc]=$a[Ku]=1,$a[Rl]=$a[nc]=2,$a[qu]=$a[ic]=3,$a[Ks]=$a[Ll]=4;function Qu(Z){return"[object "+Z+"]"}var vl=Qu("HTMLCanvasElement"),lu=Qu("OffscreenCanvas"),Us=Qu("CanvasRenderingContext2D"),Cf=Qu("ImageBitmap"),Nr=Qu("HTMLImageElement"),Af=Qu("HTMLVideoElement"),wf=Object.keys(Oa).concat([vl,lu,Us,Cf,Nr,Af]),Ju=[];Ju[pl]=1,Ju[Dl]=4,Ju[ac]=2,Ju[sc]=2,Ju[Jf]=4;var Ba=[];Ba[Oh]=2,Ba[Il]=2,Ba[zs]=2,Ba[Rl]=4,Ba[kl]=.5,Ba[$s]=.5,Ba[_f]=1,Ba[xf]=1,Ba[bf]=.5,Ba[hl]=1,Ba[oc]=1,Ba[Dc]=.5,Ba[Ef]=.25,Ba[$u]=.5,Ba[Rh]=.25,Ba[Fc]=.5;function Ms(Z){return Array.isArray(Z)&&(Z.length===0||typeof Z[0]=="number")}function Bl(Z){if(!Array.isArray(Z))return!1;var Me=Z.length;return!(Me===0||!fo(Z[0]))}function cu(Z){return Object.prototype.toString.call(Z)}function Ps(Z){return cu(Z)===vl}function Ta(Z){return cu(Z)===lu}function rh(Z){return cu(Z)===Us}function Uc(Z){return cu(Z)===Cf}function nh(Z){return cu(Z)===Nr}function fc(Z){return cu(Z)===Af}function Os(Z){var Me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Me&&Z&&Z.getContext)}function js(Z){var Me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(Me&&Z&&"src"in Z&&"crossOrigin"in Z)}function Sn(Z){if(!Z)return!1;if(Os(Z)||js(Z))return!0;var Me=cu(Z);return wf.indexOf(Me)>=0?!0:Ms(Z)||Bl(Z)||us(Z)}function Su(Z){return Oa[Object.prototype.toString.call(Z)]|0}function fu(Z,Me){var qe=Me.length;switch(Z.type){case pl:case sc:case Jf:case Dl:var lr=tr.allocType(Z.type,qe);lr.set(Me),Z.data=lr;break;case ac:Z.data=ku(Me);break;default:k.raise("unsupported texture type, must specify a typed array")}}function es(Z,Me){return tr.allocType(Z.type===ac?Dl:Z.type,Me)}function el(Z,Me){Z.type===ac?(Z.data=ku(Me),tr.freeType(Me)):Z.data=Me}function Qs(Z,Me,qe,lr,Sr,ar){for(var yr=Z.width,Tr=Z.height,Fr=Z.channels,wt=yr*Tr*Fr,Gr=es(Z,wt),Ke=0,on=0;on<Tr;++on)for(var zr=0;zr<yr;++zr)for(var jr=0;jr<Fr;++jr)Gr[Ke++]=Me[qe*zr+lr*on+Sr*jr+ar];el(Z,Gr)}function Vs(Z,Me,qe,lr,Sr,ar){var yr;if(typeof Ba[Z]!="undefined"?yr=Ba[Z]:yr=$a[Z]*Ju[Me],ar&&(yr*=6),Sr){for(var Tr=0,Fr=qe;Fr>=1;)Tr+=yr*Fr*Fr,Fr/=2;return Tr}else return yr*qe*lr}function bs(Z,Me,qe,lr,Sr,ar,yr){var Tr={"don't care":dl,"dont care":dl,nice:kh,fast:zc},Fr={repeat:th,clamp:uc,mirror:Sf},wt={nearest:Bc,linear:Fl},Gr=g({mipmap:Gi,"nearest mipmap nearest":Fu,"linear mipmap nearest":Ci,"nearest mipmap linear":Ia,"linear mipmap linear":Gi},wt),Ke={none:0,browser:Bu},on={uint8:pl,rgba4:up,rgb565:yf,"rgb5 a1":Ih},zr={alpha:rc,luminance:Aa,"luminance alpha":nc,rgb:qu,rgba:Ks,rgba4:Oh,"rgb5 a1":Il,rgb565:zs},jr={};Me.ext_srgb&&(zr.srgb=ic,zr.srgba=Ll),Me.oes_texture_float&&(on.float32=on.float=Dl),Me.oes_texture_half_float&&(on.float16=on["half float"]=ac),Me.webgl_depth_texture&&(g(zr,{depth:Ku,"depth stencil":Rl}),g(on,{uint16:sc,uint32:Jf,"depth stencil":fl})),Me.webgl_compressed_texture_s3tc&&g(jr,{"rgb s3tc dxt1":kl,"rgba s3tc dxt1":$s,"rgba s3tc dxt3":_f,"rgba s3tc dxt5":xf}),Me.webgl_compressed_texture_atc&&g(jr,{"rgb atc":bf,"rgba atc explicit alpha":hl,"rgba atc interpolated alpha":oc}),Me.webgl_compressed_texture_pvrtc&&g(jr,{"rgb pvrtc 4bppv1":Dc,"rgb pvrtc 2bppv1":Ef,"rgba pvrtc 4bppv1":$u,"rgba pvrtc 2bppv1":Rh}),Me.webgl_compressed_texture_etc1&&(jr["rgb etc1"]=Fc);var kt=Array.prototype.slice.call(Z.getParameter(Qf)||new Uint32Array(0));Object.keys(jr).forEach(function(ze){var fr=jr[ze];kt.indexOf(fr)>=0&&(zr[ze]=fr)});var dr=Object.keys(zr);qe.textureFormats=dr;var Zr=[];Object.keys(zr).forEach(function(ze){var fr=zr[ze];Zr[fr]=ze});var tn=[];Object.keys(on).forEach(function(ze){var fr=on[ze];tn[fr]=ze});var Ar=[];Object.keys(wt).forEach(function(ze){var fr=wt[ze];Ar[fr]=ze});var qr=[];Object.keys(Gr).forEach(function(ze){var fr=Gr[ze];qr[fr]=ze});var vn=[];Object.keys(Fr).forEach(function(ze){var fr=Fr[ze];vn[fr]=ze});var $n=dr.reduce(function(ze,fr){var Xt=zr[fr];return Xt===Aa||Xt===rc||Xt===Aa||Xt===nc||Xt===Ku||Xt===Rl||Me.ext_srgb&&(Xt===ic||Xt===Ll)?ze[Xt]=Xt:Xt===Il||fr.indexOf("rgba")>=0?ze[Xt]=Ks:ze[Xt]=qu,ze},{});function gr(){this.internalformat=Ks,this.format=Ks,this.type=pl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Bu,this.width=0,this.height=0,this.channels=0}function Er(ze,fr){ze.internalformat=fr.internalformat,ze.format=fr.format,ze.type=fr.type,ze.compressed=fr.compressed,ze.premultiplyAlpha=fr.premultiplyAlpha,ze.flipY=fr.flipY,ze.unpackAlignment=fr.unpackAlignment,ze.colorSpace=fr.colorSpace,ze.width=fr.width,ze.height=fr.height,ze.channels=fr.channels}function Fn(ze,fr){if(!(typeof fr!="object"||!fr)){if("premultiplyAlpha"in fr&&(k.type(fr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),ze.premultiplyAlpha=fr.premultiplyAlpha),"flipY"in fr&&(k.type(fr.flipY,"boolean","invalid texture flip"),ze.flipY=fr.flipY),"alignment"in fr&&(k.oneOf(fr.alignment,[1,2,4,8],"invalid texture unpack alignment"),ze.unpackAlignment=fr.alignment),"colorSpace"in fr&&(k.parameter(fr.colorSpace,Ke,"invalid colorSpace"),ze.colorSpace=Ke[fr.colorSpace]),"type"in fr){var Xt=fr.type;k(Me.oes_texture_float||!(Xt==="float"||Xt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),k(Me.oes_texture_half_float||!(Xt==="half float"||Xt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),k(Me.webgl_depth_texture||!(Xt==="uint16"||Xt==="uint32"||Xt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),k.parameter(Xt,on,"invalid texture type"),ze.type=on[Xt]}var Pn=ze.width,qi=ze.height,De=ze.channels,ye=!1;"shape"in fr?(k(Array.isArray(fr.shape)&&fr.shape.length>=2,"shape must be an array"),Pn=fr.shape[0],qi=fr.shape[1],fr.shape.length===3&&(De=fr.shape[2],k(De>0&&De<=4,"invalid number of channels"),ye=!0),k(Pn>=0&&Pn<=qe.maxTextureSize,"invalid width"),k(qi>=0&&qi<=qe.maxTextureSize,"invalid height")):("radius"in fr&&(Pn=qi=fr.radius,k(Pn>=0&&Pn<=qe.maxTextureSize,"invalid radius")),"width"in fr&&(Pn=fr.width,k(Pn>=0&&Pn<=qe.maxTextureSize,"invalid width")),"height"in fr&&(qi=fr.height,k(qi>=0&&qi<=qe.maxTextureSize,"invalid height")),"channels"in fr&&(De=fr.channels,k(De>0&&De<=4,"invalid number of channels"),ye=!0)),ze.width=Pn|0,ze.height=qi|0,ze.channels=De|0;var st=!1;if("format"in fr){var Nt=fr.format;k(Me.webgl_depth_texture||!(Nt==="depth"||Nt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),k.parameter(Nt,zr,"invalid texture format");var Yt=ze.internalformat=zr[Nt];ze.format=$n[Yt],Nt in on&&("type"in fr||(ze.type=on[Nt])),Nt in jr&&(ze.compressed=!0),st=!0}!ye&&st?ze.channels=$a[ze.format]:ye&&!st?ze.channels!==Mn[ze.format]&&(ze.format=ze.internalformat=Mn[ze.channels]):st&&ye&&k(ze.channels===$a[ze.format],"number of channels inconsistent with specified format")}}function un(ze){Z.pixelStorei(za,ze.flipY),Z.pixelStorei(Zs,ze.premultiplyAlpha),Z.pixelStorei(Va,ze.colorSpace),Z.pixelStorei(Zc,ze.unpackAlignment)}function Ur(){gr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function fn(ze,fr){var Xt=null;if(Sn(fr)?Xt=fr:fr&&(k.type(fr,"object","invalid pixel data type"),Fn(ze,fr),"x"in fr&&(ze.xOffset=fr.x|0),"y"in fr&&(ze.yOffset=fr.y|0),Sn(fr.data)&&(Xt=fr.data)),k(!ze.compressed||Xt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),fr.copy){k(!Xt,"can not specify copy and data field for the same texture");var Pn=Sr.viewportWidth,qi=Sr.viewportHeight;ze.width=ze.width||Pn-ze.xOffset,ze.height=ze.height||qi-ze.yOffset,ze.needsCopy=!0,k(ze.xOffset>=0&&ze.xOffset<Pn&&ze.yOffset>=0&&ze.yOffset<qi&&ze.width>0&&ze.width<=Pn&&ze.height>0&&ze.height<=qi,"copy texture read out of bounds")}else if(!Xt)ze.width=ze.width||1,ze.height=ze.height||1,ze.channels=ze.channels||4;else if(Y(Xt))ze.channels=ze.channels||4,ze.data=Xt,!("type"in fr)&&ze.type===pl&&(ze.type=Su(Xt));else if(Ms(Xt))ze.channels=ze.channels||4,fu(ze,Xt),ze.alignment=1,ze.needsFree=!0;else if(us(Xt)){var De=Xt.data;!Array.isArray(De)&&ze.type===pl&&(ze.type=Su(De));var ye=Xt.shape,st=Xt.stride,Nt,Yt,ht,Xe,Ct,Pe;ye.length===3?(ht=ye[2],Pe=st[2]):(k(ye.length===2,"invalid ndarray pixel data, must be 2 or 3D"),ht=1,Pe=1),Nt=ye[0],Yt=ye[1],Xe=st[0],Ct=st[1],ze.alignment=1,ze.width=Nt,ze.height=Yt,ze.channels=ht,ze.format=ze.internalformat=Mn[ht],ze.needsFree=!0,Qs(ze,De,Xe,Ct,Pe,Xt.offset)}else if(Os(Xt)||Ps(Xt)||Ta(Xt)||rh(Xt))Os(Xt)||Ps(Xt)||Ta(Xt)?ze.element=Xt:ze.element=Xt.canvas,ze.width=ze.element.width,ze.height=ze.element.height,ze.channels=4;else if(Uc(Xt))ze.element=Xt,ze.width=Xt.width,ze.height=Xt.height,ze.channels=4;else if(nh(Xt))ze.element=Xt,ze.width=Xt.naturalWidth,ze.height=Xt.naturalHeight,ze.channels=4;else if(js(Xt))ze.element=Xt,ze.width=Xt.width,ze.height=Xt.height,ze.channels=4;else if(fc(Xt))ze.element=Xt,ze.width=Xt.videoWidth,ze.height=Xt.videoHeight,ze.channels=4;else if(Bl(Xt)){var tt=ze.width||Xt[0].length,Be=ze.height||Xt.length,Ft=ze.channels;fo(Xt[0][0])?Ft=Ft||Xt[0][0].length:Ft=Ft||1;for(var Kt=Le.shape(Xt),Or=1,nn=0;nn<Kt.length;++nn)Or*=Kt[nn];var an=es(ze,Or);Le.flatten(Xt,Kt,"",an),el(ze,an),ze.alignment=1,ze.width=tt,ze.height=Be,ze.channels=Ft,ze.format=ze.internalformat=Mn[Ft],ze.needsFree=!0}ze.type===Dl?k(qe.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):ze.type===ac&&k(qe.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function dn(ze,fr,Xt){var Pn=ze.element,qi=ze.data,De=ze.internalformat,ye=ze.format,st=ze.type,Nt=ze.width,Yt=ze.height;un(ze),Pn?Z.texImage2D(fr,Xt,ye,ye,st,Pn):ze.compressed?Z.compressedTexImage2D(fr,Xt,De,Nt,Yt,0,qi):ze.needsCopy?(lr(),Z.copyTexImage2D(fr,Xt,ye,ze.xOffset,ze.yOffset,Nt,Yt,0)):Z.texImage2D(fr,Xt,ye,Nt,Yt,0,ye,st,qi||null)}function Mi(ze,fr,Xt,Pn,qi){var De=ze.element,ye=ze.data,st=ze.internalformat,Nt=ze.format,Yt=ze.type,ht=ze.width,Xe=ze.height;un(ze),De?Z.texSubImage2D(fr,qi,Xt,Pn,Nt,Yt,De):ze.compressed?Z.compressedTexSubImage2D(fr,qi,Xt,Pn,st,ht,Xe,ye):ze.needsCopy?(lr(),Z.copyTexSubImage2D(fr,qi,Xt,Pn,ze.xOffset,ze.yOffset,ht,Xe)):Z.texSubImage2D(fr,qi,Xt,Pn,ht,Xe,Nt,Yt,ye)}var yi=[];function hn(){return yi.pop()||new Ur}function En(ze){ze.needsFree&&tr.freeType(ze.data),Ur.call(ze),yi.push(ze)}function di(){gr.call(this),this.genMipmaps=!1,this.mipmapHint=dl,this.mipmask=0,this.images=Array(16)}function Ai(ze,fr,Xt){var Pn=ze.images[0]=hn();ze.mipmask=1,Pn.width=ze.width=fr,Pn.height=ze.height=Xt,Pn.channels=ze.channels=4}function $i(ze,fr){var Xt=null;if(Sn(fr))Xt=ze.images[0]=hn(),Er(Xt,ze),fn(Xt,fr),ze.mipmask=1;else if(Fn(ze,fr),Array.isArray(fr.mipmap))for(var Pn=fr.mipmap,qi=0;qi<Pn.length;++qi)Xt=ze.images[qi]=hn(),Er(Xt,ze),Xt.width>>=qi,Xt.height>>=qi,fn(Xt,Pn[qi]),ze.mipmask|=1<<qi;else Xt=ze.images[0]=hn(),Er(Xt,ze),fn(Xt,fr),ze.mipmask=1;Er(ze,ze.images[0]),ze.compressed&&(ze.internalformat===kl||ze.internalformat===$s||ze.internalformat===_f||ze.internalformat===xf)&&k(ze.width%4==0&&ze.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function no(ze,fr){for(var Xt=ze.images,Pn=0;Pn<Xt.length;++Pn){if(!Xt[Pn])return;dn(Xt[Pn],fr,Pn)}}var io=[];function Yi(){var ze=io.pop()||new di;gr.call(ze),ze.mipmask=0;for(var fr=0;fr<16;++fr)ze.images[fr]=null;return ze}function qo(ze){for(var fr=ze.images,Xt=0;Xt<fr.length;++Xt)fr[Xt]&&En(fr[Xt]),fr[Xt]=null;io.push(ze)}function Ha(){this.minFilter=Bc,this.magFilter=Bc,this.wrapS=uc,this.wrapT=uc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=dl}function ns(ze,fr){if("min"in fr){var Xt=fr.min;k.parameter(Xt,Gr),ze.minFilter=Gr[Xt],go.indexOf(ze.minFilter)>=0&&!("faces"in fr)&&(ze.genMipmaps=!0)}if("mag"in fr){var Pn=fr.mag;k.parameter(Pn,wt),ze.magFilter=wt[Pn]}var qi=ze.wrapS,De=ze.wrapT;if("wrap"in fr){var ye=fr.wrap;typeof ye=="string"?(k.parameter(ye,Fr),qi=De=Fr[ye]):Array.isArray(ye)&&(k.parameter(ye[0],Fr),k.parameter(ye[1],Fr),qi=Fr[ye[0]],De=Fr[ye[1]])}else{if("wrapS"in fr){var st=fr.wrapS;k.parameter(st,Fr),qi=Fr[st]}if("wrapT"in fr){var Nt=fr.wrapT;k.parameter(Nt,Fr),De=Fr[Nt]}}if(ze.wrapS=qi,ze.wrapT=De,"anisotropic"in fr){var Yt=fr.anisotropic;k(typeof Yt=="number"&&Yt>=1&&Yt<=qe.maxAnisotropic,"aniso samples must be between 1 and "),ze.anisotropic=fr.anisotropic}if("mipmap"in fr){var ht=!1;switch(typeof fr.mipmap){case"string":k.parameter(fr.mipmap,Tr,"invalid mipmap hint"),ze.mipmapHint=Tr[fr.mipmap],ze.genMipmaps=!0,ht=!0;break;case"boolean":ht=ze.genMipmaps=fr.mipmap;break;case"object":k(Array.isArray(fr.mipmap),"invalid mipmap type"),ze.genMipmaps=!1,ht=!0;break;default:k.raise("invalid mipmap type")}ht&&!("min"in fr)&&(ze.minFilter=Fu)}}function bo(ze,fr){Z.texParameteri(fr,Ka,ze.minFilter),Z.texParameteri(fr,lc,ze.magFilter),Z.texParameteri(fr,Lh,ze.wrapS),Z.texParameteri(fr,eh,ze.wrapT),Me.ext_texture_filter_anisotropic&&Z.texParameteri(fr,lp,ze.anisotropic),ze.genMipmaps&&(Z.hint(Nc,ze.mipmapHint),Z.generateMipmap(fr))}var Bo=0,Mo={},ps=qe.maxTextureUnits,ao=Array(ps).map(function(){return null});function Ii(ze){gr.call(this),this.mipmask=0,this.internalformat=Ks,this.id=Bo++,this.refCount=1,this.target=ze,this.texture=Z.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ha,yr.profile&&(this.stats={size:0})}function No(ze){Z.activeTexture(cc),Z.bindTexture(ze.target,ze.texture)}function sa(){var ze=ao[0];ze?Z.bindTexture(ze.target,ze.texture):Z.bindTexture(xs,null)}function is(ze){var fr=ze.texture;k(fr,"must not double destroy texture");var Xt=ze.unit,Pn=ze.target;Xt>=0&&(Z.activeTexture(cc+Xt),Z.bindTexture(Pn,null),ao[Xt]=null),Z.deleteTexture(fr),ze.texture=null,ze.params=null,ze.pixels=null,ze.refCount=0,delete Mo[ze.id],ar.textureCount--}g(Ii.prototype,{bind:function(){var ze=this;ze.bindCount+=1;var fr=ze.unit;if(fr<0){for(var Xt=0;Xt<ps;++Xt){var Pn=ao[Xt];if(Pn){if(Pn.bindCount>0)continue;Pn.unit=-1}ao[Xt]=ze,fr=Xt;break}fr>=ps&&k.raise("insufficient number of texture units"),yr.profile&&ar.maxTextureUnits<fr+1&&(ar.maxTextureUnits=fr+1),ze.unit=fr,Z.activeTexture(cc+fr),Z.bindTexture(ze.target,ze.texture)}return fr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&is(this)}});function gi(ze,fr){var Xt=new Ii(xs);Mo[Xt.id]=Xt,ar.textureCount++;function Pn(ye,st){var Nt=Xt.texInfo;Ha.call(Nt);var Yt=Yi();return typeof ye=="number"?typeof st=="number"?Ai(Yt,ye|0,st|0):Ai(Yt,ye|0,ye|0):ye?(k.type(ye,"object","invalid arguments to regl.texture"),ns(Nt,ye),$i(Yt,ye)):Ai(Yt,1,1),Nt.genMipmaps&&(Yt.mipmask=(Yt.width<<1)-1),Xt.mipmask=Yt.mipmask,Er(Xt,Yt),k.texture2D(Nt,Yt,qe),Xt.internalformat=Yt.internalformat,Pn.width=Yt.width,Pn.height=Yt.height,No(Xt),no(Yt,xs),bo(Nt,xs),sa(),qo(Yt),yr.profile&&(Xt.stats.size=Vs(Xt.internalformat,Xt.type,Yt.width,Yt.height,Nt.genMipmaps,!1)),Pn.format=Zr[Xt.internalformat],Pn.type=tn[Xt.type],Pn.mag=Ar[Nt.magFilter],Pn.min=qr[Nt.minFilter],Pn.wrapS=vn[Nt.wrapS],Pn.wrapT=vn[Nt.wrapT],Pn}function qi(ye,st,Nt,Yt){k(!!ye,"must specify image data");var ht=st|0,Xe=Nt|0,Ct=Yt|0,Pe=hn();return Er(Pe,Xt),Pe.width=0,Pe.height=0,fn(Pe,ye),Pe.width=Pe.width||(Xt.width>>Ct)-ht,Pe.height=Pe.height||(Xt.height>>Ct)-Xe,k(Xt.type===Pe.type&&Xt.format===Pe.format&&Xt.internalformat===Pe.internalformat,"incompatible format for texture.subimage"),k(ht>=0&&Xe>=0&&ht+Pe.width<=Xt.width&&Xe+Pe.height<=Xt.height,"texture.subimage write out of bounds"),k(Xt.mipmask&1<<Ct,"missing mipmap data"),k(Pe.data||Pe.element||Pe.needsCopy,"missing image data"),No(Xt),Mi(Pe,xs,ht,Xe,Ct),sa(),En(Pe),Pn}function De(ye,st){var Nt=ye|0,Yt=st|0||Nt;if(Nt===Xt.width&&Yt===Xt.height)return Pn;Pn.width=Xt.width=Nt,Pn.height=Xt.height=Yt,No(Xt);for(var ht=0;Xt.mipmask>>ht;++ht){var Xe=Nt>>ht,Ct=Yt>>ht;if(!Xe||!Ct)break;Z.texImage2D(xs,ht,Xt.format,Xe,Ct,0,Xt.format,Xt.type,null)}return sa(),yr.profile&&(Xt.stats.size=Vs(Xt.internalformat,Xt.type,Nt,Yt,!1,!1)),Pn}return Pn(ze,fr),Pn.subimage=qi,Pn.resize=De,Pn._reglType="texture2d",Pn._texture=Xt,yr.profile&&(Pn.stats=Xt.stats),Pn.destroy=function(){Xt.decRef()},Pn}function Zi(ze,fr,Xt,Pn,qi,De){var ye=new Ii(gf);Mo[ye.id]=ye,ar.cubeCount++;var st=new Array(6);function Nt(Xe,Ct,Pe,tt,Be,Ft){var Kt,Or=ye.texInfo;for(Ha.call(Or),Kt=0;Kt<6;++Kt)st[Kt]=Yi();if(typeof Xe=="number"||!Xe){var nn=Xe|0||1;for(Kt=0;Kt<6;++Kt)Ai(st[Kt],nn,nn)}else if(typeof Xe=="object")if(Ct)$i(st[0],Xe),$i(st[1],Ct),$i(st[2],Pe),$i(st[3],tt),$i(st[4],Be),$i(st[5],Ft);else if(ns(Or,Xe),Fn(ye,Xe),"faces"in Xe){var an=Xe.faces;for(k(Array.isArray(an)&&an.length===6,"cube faces must be a length 6 array"),Kt=0;Kt<6;++Kt)k(typeof an[Kt]=="object"&&!!an[Kt],"invalid input for cube map face"),Er(st[Kt],ye),$i(st[Kt],an[Kt])}else for(Kt=0;Kt<6;++Kt)$i(st[Kt],Xe);else k.raise("invalid arguments to cube map");for(Er(ye,st[0]),k.optional(function(){qe.npotTextureCube||k($f(ye.width)&&$f(ye.height),"your browser does not support non power or two texture dimensions")}),Or.genMipmaps?ye.mipmask=(st[0].width<<1)-1:ye.mipmask=st[0].mipmask,k.textureCube(ye,Or,st,qe),ye.internalformat=st[0].internalformat,Nt.width=st[0].width,Nt.height=st[0].height,No(ye),Kt=0;Kt<6;++Kt)no(st[Kt],Du+Kt);for(bo(Or,gf),sa(),yr.profile&&(ye.stats.size=Vs(ye.internalformat,ye.type,Nt.width,Nt.height,Or.genMipmaps,!0)),Nt.format=Zr[ye.internalformat],Nt.type=tn[ye.type],Nt.mag=Ar[Or.magFilter],Nt.min=qr[Or.minFilter],Nt.wrapS=vn[Or.wrapS],Nt.wrapT=vn[Or.wrapT],Kt=0;Kt<6;++Kt)qo(st[Kt]);return Nt}function Yt(Xe,Ct,Pe,tt,Be){k(!!Ct,"must specify image data"),k(typeof Xe=="number"&&Xe===(Xe|0)&&Xe>=0&&Xe<6,"invalid face");var Ft=Pe|0,Kt=tt|0,Or=Be|0,nn=hn();return Er(nn,ye),nn.width=0,nn.height=0,fn(nn,Ct),nn.width=nn.width||(ye.width>>Or)-Ft,nn.height=nn.height||(ye.height>>Or)-Kt,k(ye.type===nn.type&&ye.format===nn.format&&ye.internalformat===nn.internalformat,"incompatible format for texture.subimage"),k(Ft>=0&&Kt>=0&&Ft+nn.width<=ye.width&&Kt+nn.height<=ye.height,"texture.subimage write out of bounds"),k(ye.mipmask&1<<Or,"missing mipmap data"),k(nn.data||nn.element||nn.needsCopy,"missing image data"),No(ye),Mi(nn,Du+Xe,Ft,Kt,Or),sa(),En(nn),Nt}function ht(Xe){var Ct=Xe|0;if(Ct!==ye.width){Nt.width=ye.width=Ct,Nt.height=ye.height=Ct,No(ye);for(var Pe=0;Pe<6;++Pe)for(var tt=0;ye.mipmask>>tt;++tt)Z.texImage2D(Du+Pe,tt,ye.format,Ct>>tt,Ct>>tt,0,ye.format,ye.type,null);return sa(),yr.profile&&(ye.stats.size=Vs(ye.internalformat,ye.type,Nt.width,Nt.height,!1,!0)),Nt}}return Nt(ze,fr,Xt,Pn,qi,De),Nt.subimage=Yt,Nt.resize=ht,Nt._reglType="textureCube",Nt._texture=ye,yr.profile&&(Nt.stats=ye.stats),Nt.destroy=function(){ye.decRef()},Nt}function ma(){for(var ze=0;ze<ps;++ze)Z.activeTexture(cc+ze),Z.bindTexture(xs,null),ao[ze]=null;me(Mo).forEach(is),ar.cubeCount=0,ar.textureCount=0}yr.profile&&(ar.getTotalTextureSize=function(){var ze=0;return Object.keys(Mo).forEach(function(fr){ze+=Mo[fr].stats.size}),ze});function Di(){for(var ze=0;ze<ps;++ze){var fr=ao[ze];fr&&(fr.bindCount=0,fr.unit=-1,ao[ze]=null)}me(Mo).forEach(function(Xt){Xt.texture=Z.createTexture(),Z.bindTexture(Xt.target,Xt.texture);for(var Pn=0;Pn<32;++Pn)if((Xt.mipmask&1<<Pn)!=0)if(Xt.target===xs)Z.texImage2D(xs,Pn,Xt.internalformat,Xt.width>>Pn,Xt.height>>Pn,0,Xt.internalformat,Xt.type,null);else for(var qi=0;qi<6;++qi)Z.texImage2D(Du+qi,Pn,Xt.internalformat,Xt.width>>Pn,Xt.height>>Pn,0,Xt.internalformat,Xt.type,null);bo(Xt.texInfo,Xt.target)})}function Ls(){for(var ze=0;ze<ps;++ze){var fr=ao[ze];fr&&(fr.bindCount=0,fr.unit=-1,ao[ze]=null),Z.activeTexture(cc+ze),Z.bindTexture(xs,null),Z.bindTexture(gf,null)}}return{create2D:gi,createCube:Zi,clear:ma,getTexture:function(ze){return null},restore:Di,refresh:Ls}}var Js=36161,Kn=32854,jn=32855,Nl=36194,Es=33189,Gs=36168,ts=34041,Nu=35907,jc=34836,Vc=34842,va=34843,Ma=[];Ma[Kn]=2,Ma[jn]=2,Ma[Nl]=2,Ma[Es]=2,Ma[Gs]=1,Ma[ts]=4,Ma[Nu]=4,Ma[jc]=16,Ma[Vc]=8,Ma[va]=6;function ih(Z,Me,qe){return Ma[Z]*Me*qe}var zl=function(Z,Me,qe,lr,Sr){var ar={rgba4:Kn,rgb565:Nl,"rgb5 a1":jn,depth:Es,stencil:Gs,"depth stencil":ts};Me.ext_srgb&&(ar.srgba=Nu),Me.ext_color_buffer_half_float&&(ar.rgba16f=Vc,ar.rgb16f=va),Me.webgl_color_buffer_float&&(ar.rgba32f=jc);var yr=[];Object.keys(ar).forEach(function(zr){var jr=ar[zr];yr[jr]=zr});var Tr=0,Fr={};function wt(zr){this.id=Tr++,this.refCount=1,this.renderbuffer=zr,this.format=Kn,this.width=0,this.height=0,Sr.profile&&(this.stats={size:0})}wt.prototype.decRef=function(){--this.refCount<=0&&Gr(this)};function Gr(zr){var jr=zr.renderbuffer;k(jr,"must not double destroy renderbuffer"),Z.bindRenderbuffer(Js,null),Z.deleteRenderbuffer(jr),zr.renderbuffer=null,zr.refCount=0,delete Fr[zr.id],lr.renderbufferCount--}function Ke(zr,jr){var kt=new wt(Z.createRenderbuffer());Fr[kt.id]=kt,lr.renderbufferCount++;function dr(tn,Ar){var qr=0,vn=0,$n=Kn;if(typeof tn=="object"&&tn){var gr=tn;if("shape"in gr){var Er=gr.shape;k(Array.isArray(Er)&&Er.length>=2,"invalid renderbuffer shape"),qr=Er[0]|0,vn=Er[1]|0}else"radius"in gr&&(qr=vn=gr.radius|0),"width"in gr&&(qr=gr.width|0),"height"in gr&&(vn=gr.height|0);"format"in gr&&(k.parameter(gr.format,ar,"invalid renderbuffer format"),$n=ar[gr.format])}else typeof tn=="number"?(qr=tn|0,typeof Ar=="number"?vn=Ar|0:vn=qr):tn?k.raise("invalid arguments to renderbuffer constructor"):qr=vn=1;if(k(qr>0&&vn>0&&qr<=qe.maxRenderbufferSize&&vn<=qe.maxRenderbufferSize,"invalid renderbuffer size"),!(qr===kt.width&&vn===kt.height&&$n===kt.format))return dr.width=kt.width=qr,dr.height=kt.height=vn,kt.format=$n,Z.bindRenderbuffer(Js,kt.renderbuffer),Z.renderbufferStorage(Js,$n,qr,vn),k(Z.getError()===0,"invalid render buffer format"),Sr.profile&&(kt.stats.size=ih(kt.format,kt.width,kt.height)),dr.format=yr[kt.format],dr}function Zr(tn,Ar){var qr=tn|0,vn=Ar|0||qr;return qr===kt.width&&vn===kt.height||(k(qr>0&&vn>0&&qr<=qe.maxRenderbufferSize&&vn<=qe.maxRenderbufferSize,"invalid renderbuffer size"),dr.width=kt.width=qr,dr.height=kt.height=vn,Z.bindRenderbuffer(Js,kt.renderbuffer),Z.renderbufferStorage(Js,kt.format,qr,vn),k(Z.getError()===0,"invalid render buffer format"),Sr.profile&&(kt.stats.size=ih(kt.format,kt.width,kt.height))),dr}return dr(zr,jr),dr.resize=Zr,dr._reglType="renderbuffer",dr._renderbuffer=kt,Sr.profile&&(dr.stats=kt.stats),dr.destroy=function(){kt.decRef()},dr}Sr.profile&&(lr.getTotalRenderbufferSize=function(){var zr=0;return Object.keys(Fr).forEach(function(jr){zr+=Fr[jr].stats.size}),zr});function on(){me(Fr).forEach(function(zr){zr.renderbuffer=Z.createRenderbuffer(),Z.bindRenderbuffer(Js,zr.renderbuffer),Z.renderbufferStorage(Js,zr.format,zr.width,zr.height)}),Z.bindRenderbuffer(Js,null)}return{create:Ke,clear:function(){me(Fr).forEach(Gr)},restore:on}},Hs=36160,Cu=36161,wo=3553,ml=34069,hu=36064,Zl=36096,hc=36128,pc=33306,Tf=36053,dc=36054,Ss=36055,Dh=36057,Ul=36061,gl=36193,ah=5121,pu=5126,Is=6407,jl=6408,vc=6402,Mf=[Is,jl],mc=[];mc[jl]=4,mc[Is]=3;var c=[];c[ah]=1,c[pu]=4,c[gl]=2;var h=32854,f=32855,v=36194,S=33189,T=36168,P=34041,D=35907,G=34836,Q=34842,ge=34843,Ee=[h,f,v,D,Q,ge,G],Se={};Se[Tf]="complete",Se[dc]="incomplete attachment",Se[Dh]="incomplete dimensions",Se[Ss]="incomplete, missing attachment",Se[Ul]="unsupported";function We(Z,Me,qe,lr,Sr,ar){var yr={cur:null,next:null,dirty:!1,setFBO:null},Tr=["rgba"],Fr=["rgba4","rgb565","rgb5 a1"];Me.ext_srgb&&Fr.push("srgba"),Me.ext_color_buffer_half_float&&Fr.push("rgba16f","rgb16f"),Me.webgl_color_buffer_float&&Fr.push("rgba32f");var wt=["uint8"];Me.oes_texture_half_float&&wt.push("half float","float16"),Me.oes_texture_float&&wt.push("float","float32");function Gr(Ur,fn,dn){this.target=Ur,this.texture=fn,this.renderbuffer=dn;var Mi=0,yi=0;fn?(Mi=fn.width,yi=fn.height):dn&&(Mi=dn.width,yi=dn.height),this.width=Mi,this.height=yi}function Ke(Ur){Ur&&(Ur.texture&&Ur.texture._texture.decRef(),Ur.renderbuffer&&Ur.renderbuffer._renderbuffer.decRef())}function on(Ur,fn,dn){if(!!Ur)if(Ur.texture){var Mi=Ur.texture._texture,yi=Math.max(1,Mi.width),hn=Math.max(1,Mi.height);k(yi===fn&&hn===dn,"inconsistent width/height for supplied texture"),Mi.refCount+=1}else{var En=Ur.renderbuffer._renderbuffer;k(En.width===fn&&En.height===dn,"inconsistent width/height for renderbuffer"),En.refCount+=1}}function zr(Ur,fn){fn&&(fn.texture?Z.framebufferTexture2D(Hs,Ur,fn.target,fn.texture._texture.texture,0):Z.framebufferRenderbuffer(Hs,Ur,Cu,fn.renderbuffer._renderbuffer.renderbuffer))}function jr(Ur){var fn=wo,dn=null,Mi=null,yi=Ur;typeof Ur=="object"&&(yi=Ur.data,"target"in Ur&&(fn=Ur.target|0)),k.type(yi,"function","invalid attachment data");var hn=yi._reglType;return hn==="texture2d"?(dn=yi,k(fn===wo)):hn==="textureCube"?(dn=yi,k(fn>=ml&&fn<ml+6,"invalid cube map target")):hn==="renderbuffer"?(Mi=yi,fn=Cu):k.raise("invalid regl object for attachment"),new Gr(fn,dn,Mi)}function kt(Ur,fn,dn,Mi,yi){if(dn){var hn=lr.create2D({width:Ur,height:fn,format:Mi,type:yi});return hn._texture.refCount=0,new Gr(wo,hn,null)}else{var En=Sr.create({width:Ur,height:fn,format:Mi});return En._renderbuffer.refCount=0,new Gr(Cu,null,En)}}function dr(Ur){return Ur&&(Ur.texture||Ur.renderbuffer)}function Zr(Ur,fn,dn){Ur&&(Ur.texture?Ur.texture.resize(fn,dn):Ur.renderbuffer&&Ur.renderbuffer.resize(fn,dn),Ur.width=fn,Ur.height=dn)}var tn=0,Ar={};function qr(){this.id=tn++,Ar[this.id]=this,this.framebuffer=Z.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function vn(Ur){Ur.colorAttachments.forEach(Ke),Ke(Ur.depthAttachment),Ke(Ur.stencilAttachment),Ke(Ur.depthStencilAttachment)}function $n(Ur){var fn=Ur.framebuffer;k(fn,"must not double destroy framebuffer"),Z.deleteFramebuffer(fn),Ur.framebuffer=null,ar.framebufferCount--,delete Ar[Ur.id]}function gr(Ur){var fn;Z.bindFramebuffer(Hs,Ur.framebuffer);var dn=Ur.colorAttachments;for(fn=0;fn<dn.length;++fn)zr(hu+fn,dn[fn]);for(fn=dn.length;fn<qe.maxColorAttachments;++fn)Z.framebufferTexture2D(Hs,hu+fn,wo,null,0);Z.framebufferTexture2D(Hs,pc,wo,null,0),Z.framebufferTexture2D(Hs,Zl,wo,null,0),Z.framebufferTexture2D(Hs,hc,wo,null,0),zr(Zl,Ur.depthAttachment),zr(hc,Ur.stencilAttachment),zr(pc,Ur.depthStencilAttachment);var Mi=Z.checkFramebufferStatus(Hs);!Z.isContextLost()&&Mi!==Tf&&k.raise("framebuffer configuration not supported, status = "+Se[Mi]),Z.bindFramebuffer(Hs,yr.next?yr.next.framebuffer:null),yr.cur=yr.next,Z.getError()}function Er(Ur,fn){var dn=new qr;ar.framebufferCount++;function Mi(hn,En){var di;k(yr.next!==dn,"can not update framebuffer which is currently in use");var Ai=0,$i=0,no=!0,io=!0,Yi=null,qo=!0,Ha="rgba",ns="uint8",bo=1,Bo=null,Mo=null,ps=null,ao=!1;if(typeof hn=="number")Ai=hn|0,$i=En|0||Ai;else if(!hn)Ai=$i=1;else{k.type(hn,"object","invalid arguments for framebuffer");var Ii=hn;if("shape"in Ii){var No=Ii.shape;k(Array.isArray(No)&&No.length>=2,"invalid shape for framebuffer"),Ai=No[0],$i=No[1]}else"radius"in Ii&&(Ai=$i=Ii.radius),"width"in Ii&&(Ai=Ii.width),"height"in Ii&&($i=Ii.height);("color"in Ii||"colors"in Ii)&&(Yi=Ii.color||Ii.colors,Array.isArray(Yi)&&k(Yi.length===1||Me.webgl_draw_buffers,"multiple render targets not supported")),Yi||("colorCount"in Ii&&(bo=Ii.colorCount|0,k(bo>0,"invalid color buffer count")),"colorTexture"in Ii&&(qo=!!Ii.colorTexture,Ha="rgba4"),"colorType"in Ii&&(ns=Ii.colorType,qo?(k(Me.oes_texture_float||!(ns==="float"||ns==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),k(Me.oes_texture_half_float||!(ns==="half float"||ns==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ns==="half float"||ns==="float16"?(k(Me.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ha="rgba16f"):(ns==="float"||ns==="float32")&&(k(Me.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ha="rgba32f"),k.oneOf(ns,wt,"invalid color type")),"colorFormat"in Ii&&(Ha=Ii.colorFormat,Tr.indexOf(Ha)>=0?qo=!0:Fr.indexOf(Ha)>=0?qo=!1:k.optional(function(){qo?k.oneOf(Ii.colorFormat,Tr,"invalid color format for texture"):k.oneOf(Ii.colorFormat,Fr,"invalid color format for renderbuffer")}))),("depthTexture"in Ii||"depthStencilTexture"in Ii)&&(ao=!!(Ii.depthTexture||Ii.depthStencilTexture),k(!ao||Me.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Ii&&(typeof Ii.depth=="boolean"?no=Ii.depth:(Bo=Ii.depth,io=!1)),"stencil"in Ii&&(typeof Ii.stencil=="boolean"?io=Ii.stencil:(Mo=Ii.stencil,no=!1)),"depthStencil"in Ii&&(typeof Ii.depthStencil=="boolean"?no=io=Ii.depthStencil:(ps=Ii.depthStencil,no=!1,io=!1))}var sa=null,is=null,gi=null,Zi=null;if(Array.isArray(Yi))sa=Yi.map(jr);else if(Yi)sa=[jr(Yi)];else for(sa=new Array(bo),di=0;di<bo;++di)sa[di]=kt(Ai,$i,qo,Ha,ns);k(Me.webgl_draw_buffers||sa.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),k(sa.length<=qe.maxColorAttachments,"too many color attachments, not supported"),Ai=Ai||sa[0].width,$i=$i||sa[0].height,Bo?is=jr(Bo):no&&!io&&(is=kt(Ai,$i,ao,"depth","uint32")),Mo?gi=jr(Mo):io&&!no&&(gi=kt(Ai,$i,!1,"stencil","uint8")),ps?Zi=jr(ps):!Bo&&!Mo&&io&&no&&(Zi=kt(Ai,$i,ao,"depth stencil","depth stencil")),k(!!Bo+!!Mo+!!ps<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ma=null;for(di=0;di<sa.length;++di)if(on(sa[di],Ai,$i),k(!sa[di]||sa[di].texture&&Mf.indexOf(sa[di].texture._texture.format)>=0||sa[di].renderbuffer&&Ee.indexOf(sa[di].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+di+" is invalid"),sa[di]&&sa[di].texture){var Di=mc[sa[di].texture._texture.format]*c[sa[di].texture._texture.type];ma===null?ma=Di:k(ma===Di,"all color attachments much have the same number of bits per pixel.")}return on(is,Ai,$i),k(!is||is.texture&&is.texture._texture.format===vc||is.renderbuffer&&is.renderbuffer._renderbuffer.format===S,"invalid depth attachment for framebuffer object"),on(gi,Ai,$i),k(!gi||gi.renderbuffer&&gi.renderbuffer._renderbuffer.format===T,"invalid stencil attachment for framebuffer object"),on(Zi,Ai,$i),k(!Zi||Zi.texture&&Zi.texture._texture.format===P||Zi.renderbuffer&&Zi.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),vn(dn),dn.width=Ai,dn.height=$i,dn.colorAttachments=sa,dn.depthAttachment=is,dn.stencilAttachment=gi,dn.depthStencilAttachment=Zi,Mi.color=sa.map(dr),Mi.depth=dr(is),Mi.stencil=dr(gi),Mi.depthStencil=dr(Zi),Mi.width=dn.width,Mi.height=dn.height,gr(dn),Mi}function yi(hn,En){k(yr.next!==dn,"can not resize a framebuffer which is currently in use");var di=Math.max(hn|0,1),Ai=Math.max(En|0||di,1);if(di===dn.width&&Ai===dn.height)return Mi;for(var $i=dn.colorAttachments,no=0;no<$i.length;++no)Zr($i[no],di,Ai);return Zr(dn.depthAttachment,di,Ai),Zr(dn.stencilAttachment,di,Ai),Zr(dn.depthStencilAttachment,di,Ai),dn.width=Mi.width=di,dn.height=Mi.height=Ai,gr(dn),Mi}return Mi(Ur,fn),g(Mi,{resize:yi,_reglType:"framebuffer",_framebuffer:dn,destroy:function(){$n(dn),vn(dn)},use:function(hn){yr.setFBO({framebuffer:Mi},hn)}})}function Fn(Ur){var fn=Array(6);function dn(yi){var hn;k(fn.indexOf(yr.next)<0,"can not update framebuffer which is currently in use");var En={color:null},di=0,Ai=null,$i="rgba",no="uint8",io=1;if(typeof yi=="number")di=yi|0;else if(!yi)di=1;else{k.type(yi,"object","invalid arguments for framebuffer");var Yi=yi;if("shape"in Yi){var qo=Yi.shape;k(Array.isArray(qo)&&qo.length>=2,"invalid shape for framebuffer"),k(qo[0]===qo[1],"cube framebuffer must be square"),di=qo[0]}else"radius"in Yi&&(di=Yi.radius|0),"width"in Yi?(di=Yi.width|0,"height"in Yi&&k(Yi.height===di,"must be square")):"height"in Yi&&(di=Yi.height|0);("color"in Yi||"colors"in Yi)&&(Ai=Yi.color||Yi.colors,Array.isArray(Ai)&&k(Ai.length===1||Me.webgl_draw_buffers,"multiple render targets not supported")),Ai||("colorCount"in Yi&&(io=Yi.colorCount|0,k(io>0,"invalid color buffer count")),"colorType"in Yi&&(k.oneOf(Yi.colorType,wt,"invalid color type"),no=Yi.colorType),"colorFormat"in Yi&&($i=Yi.colorFormat,k.oneOf(Yi.colorFormat,Tr,"invalid color format for texture"))),"depth"in Yi&&(En.depth=Yi.depth),"stencil"in Yi&&(En.stencil=Yi.stencil),"depthStencil"in Yi&&(En.depthStencil=Yi.depthStencil)}var Ha;if(Ai)if(Array.isArray(Ai))for(Ha=[],hn=0;hn<Ai.length;++hn)Ha[hn]=Ai[hn];else Ha=[Ai];else{Ha=Array(io);var ns={radius:di,format:$i,type:no};for(hn=0;hn<io;++hn)Ha[hn]=lr.createCube(ns)}for(En.color=Array(Ha.length),hn=0;hn<Ha.length;++hn){var bo=Ha[hn];k(typeof bo=="function"&&bo._reglType==="textureCube","invalid cube map"),di=di||bo.width,k(bo.width===di&&bo.height===di,"invalid cube map shape"),En.color[hn]={target:ml,data:Ha[hn]}}for(hn=0;hn<6;++hn){for(var Bo=0;Bo<Ha.length;++Bo)En.color[Bo].target=ml+hn;hn>0&&(En.depth=fn[0].depth,En.stencil=fn[0].stencil,En.depthStencil=fn[0].depthStencil),fn[hn]?fn[hn](En):fn[hn]=Er(En)}return g(dn,{width:di,height:di,color:Ha})}function Mi(yi){var hn,En=yi|0;if(k(En>0&&En<=qe.maxCubeMapSize,"invalid radius for cube fbo"),En===dn.width)return dn;var di=dn.color;for(hn=0;hn<di.length;++hn)di[hn].resize(En);for(hn=0;hn<6;++hn)fn[hn].resize(En);return dn.width=dn.height=En,dn}return dn(Ur),g(dn,{faces:fn,resize:Mi,_reglType:"framebufferCube",destroy:function(){fn.forEach(function(yi){yi.destroy()})}})}function un(){yr.cur=null,yr.next=null,yr.dirty=!0,me(Ar).forEach(function(Ur){Ur.framebuffer=Z.createFramebuffer(),gr(Ur)})}return g(yr,{getFramebuffer:function(Ur){if(typeof Ur=="function"&&Ur._reglType==="framebuffer"){var fn=Ur._framebuffer;if(fn instanceof qr)return fn}return null},create:Er,createCube:Fn,clear:function(){me(Ar).forEach($n)},restore:un})}var je=5126,lt=34962,Re=34963,at=["attributes","elements","offset","count","primitive","instances"];function mt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=je,this.offset=0,this.stride=0,this.divisor=0}function Wt(Z,Me,qe,lr,Sr,ar,yr){for(var Tr=qe.maxAttributes,Fr=new Array(Tr),wt=0;wt<Tr;++wt)Fr[wt]=new mt;var Gr=0,Ke={},on={Record:mt,scope:{},state:Fr,currentVAO:null,targetVAO:null,restore:jr()?vn:function(){},createVAO:$n,getVAO:dr,destroyBuffer:zr,setVAO:jr()?Zr:tn,clear:jr()?Ar:function(){}};function zr(gr){for(var Er=0;Er<Fr.length;++Er){var Fn=Fr[Er];Fn.buffer===gr&&(Z.disableVertexAttribArray(Er),Fn.buffer=null)}}function jr(){return Me.oes_vertex_array_object}function kt(){return Me.angle_instanced_arrays}function dr(gr){return typeof gr=="function"&&gr._vao?gr._vao:null}function Zr(gr){if(gr!==on.currentVAO){var Er=jr();gr?Er.bindVertexArrayOES(gr.vao):Er.bindVertexArrayOES(null),on.currentVAO=gr}}function tn(gr){if(gr!==on.currentVAO){if(gr)gr.bindAttrs();else{for(var Er=kt(),Fn=0;Fn<Fr.length;++Fn){var un=Fr[Fn];un.buffer?(Z.enableVertexAttribArray(Fn),un.buffer.bind(),Z.vertexAttribPointer(Fn,un.size,un.type,un.normalized,un.stride,un.offfset),Er&&un.divisor&&Er.vertexAttribDivisorANGLE(Fn,un.divisor)):(Z.disableVertexAttribArray(Fn),Z.vertexAttrib4f(Fn,un.x,un.y,un.z,un.w))}yr.elements?Z.bindBuffer(Re,yr.elements.buffer.buffer):Z.bindBuffer(Re,null)}on.currentVAO=gr}}function Ar(){me(Ke).forEach(function(gr){gr.destroy()})}function qr(){this.id=++Gr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var gr=jr();gr?this.vao=gr.createVertexArrayOES():this.vao=null,Ke[this.id]=this,this.buffers=[]}qr.prototype.bindAttrs=function(){for(var gr=kt(),Er=this.attributes,Fn=0;Fn<Er.length;++Fn){var un=Er[Fn];un.buffer?(Z.enableVertexAttribArray(Fn),Z.bindBuffer(lt,un.buffer.buffer),Z.vertexAttribPointer(Fn,un.size,un.type,un.normalized,un.stride,un.offset),gr&&un.divisor&&gr.vertexAttribDivisorANGLE(Fn,un.divisor)):(Z.disableVertexAttribArray(Fn),Z.vertexAttrib4f(Fn,un.x,un.y,un.z,un.w))}for(var Ur=Er.length;Ur<Tr;++Ur)Z.disableVertexAttribArray(Ur);var fn=ar.getElements(this.elements);fn?Z.bindBuffer(Re,fn.buffer.buffer):Z.bindBuffer(Re,null)},qr.prototype.refresh=function(){var gr=jr();gr&&(gr.bindVertexArrayOES(this.vao),this.bindAttrs(),on.currentVAO=null,gr.bindVertexArrayOES(null))},qr.prototype.destroy=function(){if(this.vao){var gr=jr();this===on.currentVAO&&(on.currentVAO=null,gr.bindVertexArrayOES(null)),gr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Ke[this.id]&&(delete Ke[this.id],lr.vaoCount-=1)};function vn(){var gr=jr();gr&&me(Ke).forEach(function(Er){Er.refresh()})}function $n(gr){var Er=new qr;lr.vaoCount+=1;function Fn(un){var Ur;if(Array.isArray(un))Ur=un,Er.elements&&Er.ownsElements&&Er.elements.destroy(),Er.elements=null,Er.ownsElements=!1,Er.offset=0,Er.count=0,Er.instances=-1,Er.primitive=4;else{if(k(typeof un=="object","invalid arguments for create vao"),k("attributes"in un,"must specify attributes for vao"),un.elements){var fn=un.elements;Er.ownsElements?typeof fn=="function"&&fn._reglType==="elements"?(Er.elements.destroy(),Er.ownsElements=!1):(Er.elements(fn),Er.ownsElements=!1):ar.getElements(un.elements)?(Er.elements=un.elements,Er.ownsElements=!1):(Er.elements=ar.create(un.elements),Er.ownsElements=!0)}else Er.elements=null,Er.ownsElements=!1;Ur=un.attributes,Er.offset=0,Er.count=-1,Er.instances=-1,Er.primitive=4,Er.elements&&(Er.count=Er.elements._elements.vertCount,Er.primitive=Er.elements._elements.primType),"offset"in un&&(Er.offset=un.offset|0),"count"in un&&(Er.count=un.count|0),"instances"in un&&(Er.instances=un.instances|0),"primitive"in un&&(k(un.primitive in wr,"bad primitive type: "+un.primitive),Er.primitive=wr[un.primitive]),k.optional(function(){for(var no=Object.keys(un),io=0;io<no.length;++io)k(at.indexOf(no[io])>=0,'invalid option for vao: "'+no[io]+'" valid options are '+at)}),k(Array.isArray(Ur),"attributes must be an array")}k(Ur.length<Tr,"too many attributes"),k(Ur.length>0,"must specify at least one attribute");var dn={},Mi=Er.attributes;Mi.length=Ur.length;for(var yi=0;yi<Ur.length;++yi){var hn=Ur[yi],En=Mi[yi]=new mt,di=hn.data||hn;if(Array.isArray(di)||Y(di)||us(di)){var Ai;Er.buffers[yi]&&(Ai=Er.buffers[yi],Y(di)&&Ai._buffer.byteLength>=di.byteLength?Ai.subdata(di):(Ai.destroy(),Er.buffers[yi]=null)),Er.buffers[yi]||(Ai=Er.buffers[yi]=Sr.create(hn,lt,!1,!0)),En.buffer=Sr.getBuffer(Ai),En.size=En.buffer.dimension|0,En.normalized=!1,En.type=En.buffer.dtype,En.offset=0,En.stride=0,En.divisor=0,En.state=1,dn[yi]=1}else Sr.getBuffer(hn)?(En.buffer=Sr.getBuffer(hn),En.size=En.buffer.dimension|0,En.normalized=!1,En.type=En.buffer.dtype,En.offset=0,En.stride=0,En.divisor=0,En.state=1):Sr.getBuffer(hn.buffer)?(En.buffer=Sr.getBuffer(hn.buffer),En.size=(+hn.size||En.buffer.dimension)|0,En.normalized=!!hn.normalized||!1,"type"in hn?(k.parameter(hn.type,cs,"invalid buffer type"),En.type=cs[hn.type]):En.type=En.buffer.dtype,En.offset=(hn.offset||0)|0,En.stride=(hn.stride||0)|0,En.divisor=(hn.divisor||0)|0,En.state=1,k(En.size>=1&&En.size<=4,"size must be between 1 and 4"),k(En.offset>=0,"invalid offset"),k(En.stride>=0&&En.stride<=255,"stride must be between 0 and 255"),k(En.divisor>=0,"divisor must be positive"),k(!En.divisor||!!Me.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in hn?(k(yi>0,"first attribute must not be a constant"),En.x=+hn.x||0,En.y=+hn.y||0,En.z=+hn.z||0,En.w=+hn.w||0,En.state=2):k(!1,"invalid attribute spec for location "+yi)}for(var $i=0;$i<Er.buffers.length;++$i)!dn[$i]&&Er.buffers[$i]&&(Er.buffers[$i].destroy(),Er.buffers[$i]=null);return Er.refresh(),Fn}return Fn.destroy=function(){for(var un=0;un<Er.buffers.length;++un)Er.buffers[un]&&Er.buffers[un].destroy();Er.buffers.length=0,Er.ownsElements&&(Er.elements.destroy(),Er.elements=null,Er.ownsElements=!1),Er.destroy()},Fn._vao=Er,Fn._reglType="vao",Fn(gr)}return on}var vr=35632,ur=35633,hr=35718,Lr=35721;function Jr(Z,Me,qe,lr){var Sr={},ar={};function yr(kt,dr,Zr,tn){this.name=kt,this.id=dr,this.location=Zr,this.info=tn}function Tr(kt,dr){for(var Zr=0;Zr<kt.length;++Zr)if(kt[Zr].id===dr.id){kt[Zr].location=dr.location;return}kt.push(dr)}function Fr(kt,dr,Zr){var tn=kt===vr?Sr:ar,Ar=tn[dr];if(!Ar){var qr=Me.str(dr);Ar=Z.createShader(kt),Z.shaderSource(Ar,qr),Z.compileShader(Ar),k.shaderError(Z,Ar,qr,kt,Zr),tn[dr]=Ar}return Ar}var wt={},Gr=[],Ke=0;function on(kt,dr){this.id=Ke++,this.fragId=kt,this.vertId=dr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,lr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function zr(kt,dr,Zr){var tn,Ar,qr=Fr(vr,kt.fragId),vn=Fr(ur,kt.vertId),$n=kt.program=Z.createProgram();if(Z.attachShader($n,qr),Z.attachShader($n,vn),Zr)for(tn=0;tn<Zr.length;++tn){var gr=Zr[tn];Z.bindAttribLocation($n,gr[0],gr[1])}Z.linkProgram($n),k.linkError(Z,$n,Me.str(kt.fragId),Me.str(kt.vertId),dr);var Er=Z.getProgramParameter($n,hr);lr.profile&&(kt.stats.uniformsCount=Er);var Fn=kt.uniforms;for(tn=0;tn<Er;++tn)if(Ar=Z.getActiveUniform($n,tn),Ar)if(Ar.size>1)for(var un=0;un<Ar.size;++un){var Ur=Ar.name.replace("[0]","["+un+"]");Tr(Fn,new yr(Ur,Me.id(Ur),Z.getUniformLocation($n,Ur),Ar))}else Tr(Fn,new yr(Ar.name,Me.id(Ar.name),Z.getUniformLocation($n,Ar.name),Ar));var fn=Z.getProgramParameter($n,Lr);lr.profile&&(kt.stats.attributesCount=fn);var dn=kt.attributes;for(tn=0;tn<fn;++tn)Ar=Z.getActiveAttrib($n,tn),Ar&&Tr(dn,new yr(Ar.name,Me.id(Ar.name),Z.getAttribLocation($n,Ar.name),Ar))}lr.profile&&(qe.getMaxUniformsCount=function(){var kt=0;return Gr.forEach(function(dr){dr.stats.uniformsCount>kt&&(kt=dr.stats.uniformsCount)}),kt},qe.getMaxAttributesCount=function(){var kt=0;return Gr.forEach(function(dr){dr.stats.attributesCount>kt&&(kt=dr.stats.attributesCount)}),kt});function jr(){Sr={},ar={};for(var kt=0;kt<Gr.length;++kt)zr(Gr[kt],null,Gr[kt].attributes.map(function(dr){return[dr.location,dr.name]}))}return{clear:function(){var kt=Z.deleteShader.bind(Z);me(Sr).forEach(kt),Sr={},me(ar).forEach(kt),ar={},Gr.forEach(function(dr){Z.deleteProgram(dr.program)}),Gr.length=0,wt={},qe.shaderCount=0},program:function(kt,dr,Zr,tn){k.command(kt>=0,"missing vertex shader",Zr),k.command(dr>=0,"missing fragment shader",Zr);var Ar=wt[dr];Ar||(Ar=wt[dr]={});var qr=Ar[kt];if(qr&&(qr.refCount++,!tn))return qr;var vn=new on(dr,kt);return qe.shaderCount++,zr(vn,Zr,tn),qr||(Ar[kt]=vn),Gr.push(vn),g(vn,{destroy:function(){if(vn.refCount--,vn.refCount<=0){Z.deleteProgram(vn.program);var $n=Gr.indexOf(vn);Gr.splice($n,1),qe.shaderCount--}Ar[vn.vertId].refCount<=0&&(Z.deleteShader(ar[vn.vertId]),delete ar[vn.vertId],delete wt[vn.fragId][vn.vertId]),Object.keys(wt[vn.fragId]).length||(Z.deleteShader(Sr[vn.fragId]),delete Sr[vn.fragId],delete wt[vn.fragId])}})},restore:jr,shader:Fr,frag:-1,vert:-1}}var Yr=6408,yn=5121,Jn=3333,ei=5126;function ni(Z,Me,qe,lr,Sr,ar,yr){function Tr(Gr){var Ke;Me.next===null?(k(Sr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Ke=yn):(k(Me.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Ke=Me.next.colorAttachments[0].texture._texture.type,k.optional(function(){ar.oes_texture_float?(k(Ke===yn||Ke===ei,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Ke===ei&&k(yr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):k(Ke===yn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var on=0,zr=0,jr=lr.framebufferWidth,kt=lr.framebufferHeight,dr=null;Y(Gr)?dr=Gr:Gr&&(k.type(Gr,"object","invalid arguments to regl.read()"),on=Gr.x|0,zr=Gr.y|0,k(on>=0&&on<lr.framebufferWidth,"invalid x offset for regl.read"),k(zr>=0&&zr<lr.framebufferHeight,"invalid y offset for regl.read"),jr=(Gr.width||lr.framebufferWidth-on)|0,kt=(Gr.height||lr.framebufferHeight-zr)|0,dr=Gr.data||null),dr&&(Ke===yn?k(dr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Ke===ei&&k(dr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),k(jr>0&&jr+on<=lr.framebufferWidth,"invalid width for read pixels"),k(kt>0&&kt+zr<=lr.framebufferHeight,"invalid height for read pixels"),qe();var Zr=jr*kt*4;return dr||(Ke===yn?dr=new Uint8Array(Zr):Ke===ei&&(dr=dr||new Float32Array(Zr))),k.isTypedArray(dr,"data buffer for regl.read() must be a typedarray"),k(dr.byteLength>=Zr,"data buffer for regl.read() too small"),Z.pixelStorei(Jn,4),Z.readPixels(on,zr,jr,kt,Yr,Ke,dr),dr}function Fr(Gr){var Ke;return Me.setFBO({framebuffer:Gr.framebuffer},function(){Ke=Tr(Gr)}),Ke}function wt(Gr){return!Gr||!("framebuffer"in Gr)?Tr(Gr):Fr(Gr)}return wt}function Wi(Z){return Array.prototype.slice.call(Z)}function bn(Z){return Wi(Z).join("")}function pi(){var Z=0,Me=[],qe=[];function lr(Ke){for(var on=0;on<qe.length;++on)if(qe[on]===Ke)return Me[on];var zr="g"+Z++;return Me.push(zr),qe.push(Ke),zr}function Sr(){var Ke=[];function on(){Ke.push.apply(Ke,Wi(arguments))}var zr=[];function jr(){var kt="v"+Z++;return zr.push(kt),arguments.length>0&&(Ke.push(kt,"="),Ke.push.apply(Ke,Wi(arguments)),Ke.push(";")),kt}return g(on,{def:jr,toString:function(){return bn([zr.length>0?"var "+zr.join(",")+";":"",bn(Ke)])}})}function ar(){var Ke=Sr(),on=Sr(),zr=Ke.toString,jr=on.toString;function kt(dr,Zr){on(dr,Zr,"=",Ke.def(dr,Zr),";")}return g(function(){Ke.apply(Ke,Wi(arguments))},{def:Ke.def,entry:Ke,exit:on,save:kt,set:function(dr,Zr,tn){kt(dr,Zr),Ke(dr,Zr,"=",tn,";")},toString:function(){return zr()+jr()}})}function yr(){var Ke=bn(arguments),on=ar(),zr=ar(),jr=on.toString,kt=zr.toString;return g(on,{then:function(){return on.apply(on,Wi(arguments)),this},else:function(){return zr.apply(zr,Wi(arguments)),this},toString:function(){var dr=kt();return dr&&(dr="else{"+dr+"}"),bn(["if(",Ke,"){",jr(),"}",dr])}})}var Tr=Sr(),Fr={};function wt(Ke,on){var zr=[];function jr(){var Ar="a"+zr.length;return zr.push(Ar),Ar}on=on||0;for(var kt=0;kt<on;++kt)jr();var dr=ar(),Zr=dr.toString,tn=Fr[Ke]=g(dr,{arg:jr,toString:function(){return bn(["function(",zr.join(),"){",Zr(),"}"])}});return tn}function Gr(){var Ke=['"use strict";',Tr,"return {"];Object.keys(Fr).forEach(function(kt){Ke.push('"',kt,'":',Fr[kt].toString(),",")}),Ke.push("}");var on=bn(Ke).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),zr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,jr=zr?J.Function.apply(null,Me.concat(on)):Function.apply(null,Me.concat(on));return jr.apply(null,qe)}return{global:Tr,link:lr,block:Sr,proc:wt,scope:ar,cond:yr,compile:Gr}}var Ti="xyzw".split(""),mi=5121,ui=1,Oi=2,fi=0,li=1,ho=2,Ga=3,Ro=4,Lo=5,Qa=6,po="dither",Ja="blend.enable",Wo="blend.color",zu="blend.equation",hs="blend.func",Xo="depth.enable",eu="depth.func",Vl="depth.range",yl="depth.mask",du="colorMask",Gl="cull.enable",gc="cull.face",vu="frontFace",_l="lineWidth",Au="polygonOffset.enable",xo="polygonOffset.offset",Zu="sample.alpha",tl="sample.enable",Uu="sample.coverage",aa="stencil.enable",Ws="stencil.mask",rs="stencil.func",rl="stencil.opFront",Gc="stencil.opBack",Hc="scissor.enable",Pf="scissor.box",tu="viewport",yc="profile",mu="framebuffer",xl="vert",bl="frag",wu="elements",ko="primitive",Wc="count",Of="offset",If="instances",oh="vao",cp="Width",fp="Height",_c=mu+cp,Rf=mu+fp,gu=tu+cp,Qp=tu+fp,ru="drawingBuffer",Lf=ru+cp,Xc=ru+fp,hp=[hs,zu,rs,rl,Gc,Uu,tu,Pf,xo],kf=34962,pp=34963,kd=35632,Dd=35633,Yo=3553,Do=34067,Fh=2884,Yc=3042,Df=3024,Fo=2960,dp=2929,Fd=3089,vp=32823,sh=32926,nu=32928,mp=5126,Bh=35664,qc=35665,nl=35666,Kc=5124,$c=35667,Hl=35668,uh=35669,xc=35670,Qc=35671,Jc=35672,ef=35673,Rs=35674,Ff=35675,lh=35676,Bf=35678,yu=35680,ch=4,El=1028,tf=1029,Jp=2304,Nh=2305,ed=32775,Bd=32776,gp=519,Tu=7680,yp=0,fh=1,rf=32774,ju=513,td=36160,Nd=36064,Sl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},nf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],af={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},bc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},rd={frag:kd,vert:Dd},zh={cw:Jp,ccw:Nh};function Ec(Z){return Array.isArray(Z)||Y(Z)||us(Z)}function _p(Z){return Z.sort(function(Me,qe){return Me===tu?-1:qe===tu?1:Me<qe?-1:1})}function ya(Z,Me,qe,lr){this.thisDep=Z,this.contextDep=Me,this.propDep=qe,this.append=lr}function Sc(Z){return Z&&!(Z.thisDep||Z.contextDep||Z.propDep)}function To(Z){return new ya(!1,!1,!1,Z)}function iu(Z,Me){var qe=Z.type;if(qe===fi){var lr=Z.data.length;return new ya(!0,lr>=1,lr>=2,Me)}else if(qe===Ro){var Sr=Z.data;return new ya(Sr.thisDep,Sr.contextDep,Sr.propDep,Me)}else{if(qe===Lo)return new ya(!1,!1,!1,Me);if(qe===Qa){for(var ar=!1,yr=!1,Tr=!1,Fr=0;Fr<Z.data.length;++Fr){var wt=Z.data[Fr];if(wt.type===li)Tr=!0;else if(wt.type===ho)yr=!0;else if(wt.type===Ga)ar=!0;else if(wt.type===fi){ar=!0;var Gr=wt.data;Gr>=1&&(yr=!0),Gr>=2&&(Tr=!0)}else wt.type===Ro&&(ar=ar||wt.data.thisDep,yr=yr||wt.data.contextDep,Tr=Tr||wt.data.propDep)}return new ya(ar,yr,Tr,Me)}else return new ya(qe===Ga,qe===ho,qe===li,Me)}}var xp=new ya(!1,!1,!1,function(){});function nd(Z,Me,qe,lr,Sr,ar,yr,Tr,Fr,wt,Gr,Ke,on,zr,jr){var kt=wt.Record,dr={add:32774,subtract:32778,"reverse subtract":32779};qe.ext_blend_minmax&&(dr.min=ed,dr.max=Bd);var Zr=qe.angle_instanced_arrays,tn=qe.webgl_draw_buffers,Ar=qe.oes_vertex_array_object,qr={dirty:!0,profile:jr.profile},vn={},$n=[],gr={},Er={};function Fn(De){return De.replace(".","_")}function un(De,ye,st){var Nt=Fn(De);$n.push(De),vn[Nt]=qr[Nt]=!!st,gr[Nt]=ye}function Ur(De,ye,st){var Nt=Fn(De);$n.push(De),Array.isArray(st)?(qr[Nt]=st.slice(),vn[Nt]=st.slice()):qr[Nt]=vn[Nt]=st,Er[Nt]=ye}un(po,Df),un(Ja,Yc),Ur(Wo,"blendColor",[0,0,0,0]),Ur(zu,"blendEquationSeparate",[rf,rf]),Ur(hs,"blendFuncSeparate",[fh,yp,fh,yp]),un(Xo,dp,!0),Ur(eu,"depthFunc",ju),Ur(Vl,"depthRange",[0,1]),Ur(yl,"depthMask",!0),Ur(du,du,[!0,!0,!0,!0]),un(Gl,Fh),Ur(gc,"cullFace",tf),Ur(vu,vu,Nh),Ur(_l,_l,1),un(Au,vp),Ur(xo,"polygonOffset",[0,0]),un(Zu,sh),un(tl,nu),Ur(Uu,"sampleCoverage",[1,!1]),un(aa,Fo),Ur(Ws,"stencilMask",-1),Ur(rs,"stencilFunc",[gp,0,-1]),Ur(rl,"stencilOpSeparate",[El,Tu,Tu,Tu]),Ur(Gc,"stencilOpSeparate",[tf,Tu,Tu,Tu]),un(Hc,Fd),Ur(Pf,"scissor",[0,0,Z.drawingBufferWidth,Z.drawingBufferHeight]),Ur(tu,tu,[0,0,Z.drawingBufferWidth,Z.drawingBufferHeight]);var fn={gl:Z,context:on,strings:Me,next:vn,current:qr,draw:Ke,elements:ar,buffer:Sr,shader:Gr,attributes:wt.state,vao:wt,uniforms:Fr,framebuffer:Tr,extensions:qe,timer:zr,isBufferArgs:Ec},dn={primTypes:wr,compareFuncs:af,blendFuncs:Sl,blendEquations:dr,stencilOps:bc,glTypes:cs,orientationType:zh};k.optional(function(){fn.isArrayLike=fo}),tn&&(dn.backBuffer=[tf],dn.drawBuffer=it(lr.maxDrawbuffers,function(De){return De===0?[0]:it(De,function(ye){return Nd+ye})}));var Mi=0;function yi(){var De=pi(),ye=De.link,st=De.global;De.id=Mi++,De.batchId="0";var Nt=ye(fn),Yt=De.shared={props:"a0"};Object.keys(fn).forEach(function(tt){Yt[tt]=st.def(Nt,".",tt)}),k.optional(function(){De.CHECK=ye(k),De.commandStr=k.guessCommand(),De.command=ye(De.commandStr),De.assert=function(tt,Be,Ft){tt("if(!(",Be,"))",this.CHECK,".commandRaise(",ye(Ft),",",this.command,");")},dn.invalidBlendCombinations=nf});var ht=De.next={},Xe=De.current={};Object.keys(Er).forEach(function(tt){Array.isArray(qr[tt])&&(ht[tt]=st.def(Yt.next,".",tt),Xe[tt]=st.def(Yt.current,".",tt))});var Ct=De.constants={};Object.keys(dn).forEach(function(tt){Ct[tt]=st.def(JSON.stringify(dn[tt]))}),De.invoke=function(tt,Be){switch(Be.type){case fi:var Ft=["this",Yt.context,Yt.props,De.batchId];return tt.def(ye(Be.data),".call(",Ft.slice(0,Math.max(Be.data.length+1,4)),")");case li:return tt.def(Yt.props,Be.data);case ho:return tt.def(Yt.context,Be.data);case Ga:return tt.def("this",Be.data);case Ro:return Be.data.append(De,tt),Be.data.ref;case Lo:return Be.data.toString();case Qa:return Be.data.map(function(Kt){return De.invoke(tt,Kt)})}},De.attribCache={};var Pe={};return De.scopeAttrib=function(tt){var Be=Me.id(tt);if(Be in Pe)return Pe[Be];var Ft=wt.scope[Be];Ft||(Ft=wt.scope[Be]=new kt);var Kt=Pe[Be]=ye(Ft);return Kt},De}function hn(De){var ye=De.static,st=De.dynamic,Nt;if(yc in ye){var Yt=!!ye[yc];Nt=To(function(Xe,Ct){return Yt}),Nt.enable=Yt}else if(yc in st){var ht=st[yc];Nt=iu(ht,function(Xe,Ct){return Xe.invoke(Ct,ht)})}return Nt}function En(De,ye){var st=De.static,Nt=De.dynamic;if(mu in st){var Yt=st[mu];return Yt?(Yt=Tr.getFramebuffer(Yt),k.command(Yt,"invalid framebuffer object"),To(function(Xe,Ct){var Pe=Xe.link(Yt),tt=Xe.shared;Ct.set(tt.framebuffer,".next",Pe);var Be=tt.context;return Ct.set(Be,"."+_c,Pe+".width"),Ct.set(Be,"."+Rf,Pe+".height"),Pe})):To(function(Xe,Ct){var Pe=Xe.shared;Ct.set(Pe.framebuffer,".next","null");var tt=Pe.context;return Ct.set(tt,"."+_c,tt+"."+Lf),Ct.set(tt,"."+Rf,tt+"."+Xc),"null"})}else if(mu in Nt){var ht=Nt[mu];return iu(ht,function(Xe,Ct){var Pe=Xe.invoke(Ct,ht),tt=Xe.shared,Be=tt.framebuffer,Ft=Ct.def(Be,".getFramebuffer(",Pe,")");k.optional(function(){Xe.assert(Ct,"!"+Pe+"||"+Ft,"invalid framebuffer object")}),Ct.set(Be,".next",Ft);var Kt=tt.context;return Ct.set(Kt,"."+_c,Ft+"?"+Ft+".width:"+Kt+"."+Lf),Ct.set(Kt,"."+Rf,Ft+"?"+Ft+".height:"+Kt+"."+Xc),Ft})}else return null}function di(De,ye,st){var Nt=De.static,Yt=De.dynamic;function ht(Pe){if(Pe in Nt){var tt=Nt[Pe];k.commandType(tt,"object","invalid "+Pe,st.commandStr);var Be=!0,Ft=tt.x|0,Kt=tt.y|0,Or,nn;return"width"in tt?(Or=tt.width|0,k.command(Or>=0,"invalid "+Pe,st.commandStr)):Be=!1,"height"in tt?(nn=tt.height|0,k.command(nn>=0,"invalid "+Pe,st.commandStr)):Be=!1,new ya(!Be&&ye&&ye.thisDep,!Be&&ye&&ye.contextDep,!Be&&ye&&ye.propDep,function($r,Zn){var Cn=$r.shared.context,Bn=Or;"width"in tt||(Bn=Zn.def(Cn,".",_c,"-",Ft));var Nn=nn;return"height"in tt||(Nn=Zn.def(Cn,".",Rf,"-",Kt)),[Ft,Kt,Bn,Nn]})}else if(Pe in Yt){var an=Yt[Pe],xn=iu(an,function($r,Zn){var Cn=$r.invoke(Zn,an);k.optional(function(){$r.assert(Zn,Cn+"&&typeof "+Cn+'==="object"',"invalid "+Pe)});var Bn=$r.shared.context,Nn=Zn.def(Cn,".x|0"),On=Zn.def(Cn,".y|0"),hi=Zn.def('"width" in ',Cn,"?",Cn,".width|0:","(",Bn,".",_c,"-",Nn,")"),wa=Zn.def('"height" in ',Cn,"?",Cn,".height|0:","(",Bn,".",Rf,"-",On,")");return k.optional(function(){$r.assert(Zn,hi+">=0&&"+wa+">=0","invalid "+Pe)}),[Nn,On,hi,wa]});return ye&&(xn.thisDep=xn.thisDep||ye.thisDep,xn.contextDep=xn.contextDep||ye.contextDep,xn.propDep=xn.propDep||ye.propDep),xn}else return ye?new ya(ye.thisDep,ye.contextDep,ye.propDep,function($r,Zn){var Cn=$r.shared.context;return[0,0,Zn.def(Cn,".",_c),Zn.def(Cn,".",Rf)]}):null}var Xe=ht(tu);if(Xe){var Ct=Xe;Xe=new ya(Xe.thisDep,Xe.contextDep,Xe.propDep,function(Pe,tt){var Be=Ct.append(Pe,tt),Ft=Pe.shared.context;return tt.set(Ft,"."+gu,Be[2]),tt.set(Ft,"."+Qp,Be[3]),Be})}return{viewport:Xe,scissor_box:ht(Pf)}}function Ai(De,ye){var st=De.static,Nt=typeof st[bl]=="string"&&typeof st[xl]=="string";if(Nt){if(Object.keys(ye.dynamic).length>0)return null;var Yt=ye.static,ht=Object.keys(Yt);if(ht.length>0&&typeof Yt[ht[0]]=="number"){for(var Xe=[],Ct=0;Ct<ht.length;++Ct)k(typeof Yt[ht[Ct]]=="number","must specify all vertex attribute locations when using vaos"),Xe.push([Yt[ht[Ct]]|0,ht[Ct]]);return Xe}}return null}function $i(De,ye,st){var Nt=De.static,Yt=De.dynamic;function ht(Be){if(Be in Nt){var Ft=Me.id(Nt[Be]);k.optional(function(){Gr.shader(rd[Be],Ft,k.guessCommand())});var Kt=To(function(){return Ft});return Kt.id=Ft,Kt}else if(Be in Yt){var Or=Yt[Be];return iu(Or,function(nn,an){var xn=nn.invoke(an,Or),$r=an.def(nn.shared.strings,".id(",xn,")");return k.optional(function(){an(nn.shared.shader,".shader(",rd[Be],",",$r,",",nn.command,");")}),$r})}return null}var Xe=ht(bl),Ct=ht(xl),Pe=null,tt;return Sc(Xe)&&Sc(Ct)?(Pe=Gr.program(Ct.id,Xe.id,null,st),tt=To(function(Be,Ft){return Be.link(Pe)})):tt=new ya(Xe&&Xe.thisDep||Ct&&Ct.thisDep,Xe&&Xe.contextDep||Ct&&Ct.contextDep,Xe&&Xe.propDep||Ct&&Ct.propDep,function(Be,Ft){var Kt=Be.shared.shader,Or;Xe?Or=Xe.append(Be,Ft):Or=Ft.def(Kt,".",bl);var nn;Ct?nn=Ct.append(Be,Ft):nn=Ft.def(Kt,".",xl);var an=Kt+".program("+nn+","+Or;return k.optional(function(){an+=","+Be.command}),Ft.def(an+")")}),{frag:Xe,vert:Ct,progVar:tt,program:Pe}}function no(De,ye){var st=De.static,Nt=De.dynamic,Yt={},ht=!1;function Xe(){if(oh in st){var Zn=st[oh];return Zn!==null&&wt.getVAO(Zn)===null&&(Zn=wt.createVAO(Zn)),ht=!0,Yt.vao=Zn,To(function(Bn){var Nn=wt.getVAO(Zn);return Nn?Bn.link(Nn):"null"})}else if(oh in Nt){ht=!0;var Cn=Nt[oh];return iu(Cn,function(Bn,Nn){var On=Bn.invoke(Nn,Cn);return Nn.def(Bn.shared.vao+".getVAO("+On+")")})}return null}var Ct=Xe(),Pe=!1;function tt(){if(wu in st){var Zn=st[wu];if(Yt.elements=Zn,Ec(Zn)){var Cn=Yt.elements=ar.create(Zn,!0);Zn=ar.getElements(Cn),Pe=!0}else Zn&&(Zn=ar.getElements(Zn),Pe=!0,k.command(Zn,"invalid elements",ye.commandStr));var Bn=To(function(On,hi){if(Zn){var wa=On.link(Zn);return On.ELEMENTS=wa,wa}return On.ELEMENTS=null,null});return Bn.value=Zn,Bn}else if(wu in Nt){Pe=!0;var Nn=Nt[wu];return iu(Nn,function(On,hi){var wa=On.shared,as=wa.isBufferArgs,La=wa.elements,fa=On.invoke(hi,Nn),Cl=hi.def("null"),ks=hi.def(as,"(",fa,")"),Vu=On.cond(ks).then(Cl,"=",La,".createStream(",fa,");").else(Cl,"=",La,".getElements(",fa,");");return k.optional(function(){On.assert(Vu.else,"!"+fa+"||"+Cl,"invalid elements")}),hi.entry(Vu),hi.exit(On.cond(ks).then(La,".destroyStream(",Cl,");")),On.ELEMENTS=Cl,Cl})}else if(ht)return new ya(Ct.thisDep,Ct.contextDep,Ct.propDep,function(On,hi){return hi.def(On.shared.vao+".currentVAO?"+On.shared.elements+".getElements("+On.shared.vao+".currentVAO.elements):null")});return null}var Be=tt();function Ft(){if(ko in st){var Zn=st[ko];return Yt.primitive=Zn,k.commandParameter(Zn,wr,"invalid primitve",ye.commandStr),To(function(Bn,Nn){return wr[Zn]})}else if(ko in Nt){var Cn=Nt[ko];return iu(Cn,function(Bn,Nn){var On=Bn.constants.primTypes,hi=Bn.invoke(Nn,Cn);return k.optional(function(){Bn.assert(Nn,hi+" in "+On,"invalid primitive, must be one of "+Object.keys(wr))}),Nn.def(On,"[",hi,"]")})}else{if(Pe)return Sc(Be)?Be.value?To(function(Bn,Nn){return Nn.def(Bn.ELEMENTS,".primType")}):To(function(){return ch}):new ya(Be.thisDep,Be.contextDep,Be.propDep,function(Bn,Nn){var On=Bn.ELEMENTS;return Nn.def(On,"?",On,".primType:",ch)});if(ht)return new ya(Ct.thisDep,Ct.contextDep,Ct.propDep,function(Bn,Nn){return Nn.def(Bn.shared.vao+".currentVAO?"+Bn.shared.vao+".currentVAO.primitive:"+ch)})}return null}function Kt(Zn,Cn){if(Zn in st){var Bn=st[Zn]|0;return Cn?Yt.offset=Bn:Yt.instances=Bn,k.command(!Cn||Bn>=0,"invalid "+Zn,ye.commandStr),To(function(On,hi){return Cn&&(On.OFFSET=Bn),Bn})}else if(Zn in Nt){var Nn=Nt[Zn];return iu(Nn,function(On,hi){var wa=On.invoke(hi,Nn);return Cn&&(On.OFFSET=wa,k.optional(function(){On.assert(hi,wa+">=0","invalid "+Zn)})),wa})}else if(Cn){if(Pe)return To(function(On,hi){return On.OFFSET=0,0});if(ht)return new ya(Ct.thisDep,Ct.contextDep,Ct.propDep,function(On,hi){return hi.def(On.shared.vao+".currentVAO?"+On.shared.vao+".currentVAO.offset:0")})}else if(ht)return new ya(Ct.thisDep,Ct.contextDep,Ct.propDep,function(On,hi){return hi.def(On.shared.vao+".currentVAO?"+On.shared.vao+".currentVAO.instances:-1")});return null}var Or=Kt(Of,!0);function nn(){if(Wc in st){var Zn=st[Wc]|0;return Yt.count=Zn,k.command(typeof Zn=="number"&&Zn>=0,"invalid vertex count",ye.commandStr),To(function(){return Zn})}else if(Wc in Nt){var Cn=Nt[Wc];return iu(Cn,function(hi,wa){var as=hi.invoke(wa,Cn);return k.optional(function(){hi.assert(wa,"typeof "+as+'==="number"&&'+as+">=0&&"+as+"===("+as+"|0)","invalid vertex count")}),as})}else if(Pe)if(Sc(Be)){if(Be)return Or?new ya(Or.thisDep,Or.contextDep,Or.propDep,function(hi,wa){var as=wa.def(hi.ELEMENTS,".vertCount-",hi.OFFSET);return k.optional(function(){hi.assert(wa,as+">=0","invalid vertex offset/element buffer too small")}),as}):To(function(hi,wa){return wa.def(hi.ELEMENTS,".vertCount")});var Bn=To(function(){return-1});return k.optional(function(){Bn.MISSING=!0}),Bn}else{var Nn=new ya(Be.thisDep||Or.thisDep,Be.contextDep||Or.contextDep,Be.propDep||Or.propDep,function(hi,wa){var as=hi.ELEMENTS;return hi.OFFSET?wa.def(as,"?",as,".vertCount-",hi.OFFSET,":-1"):wa.def(as,"?",as,".vertCount:-1")});return k.optional(function(){Nn.DYNAMIC=!0}),Nn}else if(ht){var On=new ya(Ct.thisDep,Ct.contextDep,Ct.propDep,function(hi,wa){return wa.def(hi.shared.vao,".currentVAO?",hi.shared.vao,".currentVAO.count:-1")});return On}return null}var an=Ft(),xn=nn(),$r=Kt(If,!1);return{elements:Be,primitive:an,count:xn,instances:$r,offset:Or,vao:Ct,vaoActive:ht,elementsActive:Pe,static:Yt}}function io(De,ye){var st=De.static,Nt=De.dynamic,Yt={};return $n.forEach(function(ht){var Xe=Fn(ht);function Ct(Pe,tt){if(ht in st){var Be=Pe(st[ht]);Yt[Xe]=To(function(){return Be})}else if(ht in Nt){var Ft=Nt[ht];Yt[Xe]=iu(Ft,function(Kt,Or){return tt(Kt,Or,Kt.invoke(Or,Ft))})}}switch(ht){case Gl:case Ja:case po:case aa:case Xo:case Hc:case Au:case Zu:case tl:case yl:return Ct(function(Pe){return k.commandType(Pe,"boolean",ht,ye.commandStr),Pe},function(Pe,tt,Be){return k.optional(function(){Pe.assert(tt,"typeof "+Be+'==="boolean"',"invalid flag "+ht,Pe.commandStr)}),Be});case eu:return Ct(function(Pe){return k.commandParameter(Pe,af,"invalid "+ht,ye.commandStr),af[Pe]},function(Pe,tt,Be){var Ft=Pe.constants.compareFuncs;return k.optional(function(){Pe.assert(tt,Be+" in "+Ft,"invalid "+ht+", must be one of "+Object.keys(af))}),tt.def(Ft,"[",Be,"]")});case Vl:return Ct(function(Pe){return k.command(fo(Pe)&&Pe.length===2&&typeof Pe[0]=="number"&&typeof Pe[1]=="number"&&Pe[0]<=Pe[1],"depth range is 2d array",ye.commandStr),Pe},function(Pe,tt,Be){k.optional(function(){Pe.assert(tt,Pe.shared.isArrayLike+"("+Be+")&&"+Be+".length===2&&typeof "+Be+'[0]==="number"&&typeof '+Be+'[1]==="number"&&'+Be+"[0]<="+Be+"[1]","depth range must be a 2d array")});var Ft=tt.def("+",Be,"[0]"),Kt=tt.def("+",Be,"[1]");return[Ft,Kt]});case hs:return Ct(function(Pe){k.commandType(Pe,"object","blend.func",ye.commandStr);var tt="srcRGB"in Pe?Pe.srcRGB:Pe.src,Be="srcAlpha"in Pe?Pe.srcAlpha:Pe.src,Ft="dstRGB"in Pe?Pe.dstRGB:Pe.dst,Kt="dstAlpha"in Pe?Pe.dstAlpha:Pe.dst;return k.commandParameter(tt,Sl,Xe+".srcRGB",ye.commandStr),k.commandParameter(Be,Sl,Xe+".srcAlpha",ye.commandStr),k.commandParameter(Ft,Sl,Xe+".dstRGB",ye.commandStr),k.commandParameter(Kt,Sl,Xe+".dstAlpha",ye.commandStr),k.command(nf.indexOf(tt+", "+Ft)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+tt+", "+Ft+")",ye.commandStr),[Sl[tt],Sl[Ft],Sl[Be],Sl[Kt]]},function(Pe,tt,Be){var Ft=Pe.constants.blendFuncs;k.optional(function(){Pe.assert(tt,Be+"&&typeof "+Be+'==="object"',"invalid blend func, must be an object")});function Kt(Cn,Bn){var Nn=tt.def('"',Cn,Bn,'" in ',Be,"?",Be,".",Cn,Bn,":",Be,".",Cn);return k.optional(function(){Pe.assert(tt,Nn+" in "+Ft,"invalid "+ht+"."+Cn+Bn+", must be one of "+Object.keys(Sl))}),Nn}var Or=Kt("src","RGB"),nn=Kt("dst","RGB");k.optional(function(){var Cn=Pe.constants.invalidBlendCombinations;Pe.assert(tt,Cn+".indexOf("+Or+'+", "+'+nn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var an=tt.def(Ft,"[",Or,"]"),xn=tt.def(Ft,"[",Kt("src","Alpha"),"]"),$r=tt.def(Ft,"[",nn,"]"),Zn=tt.def(Ft,"[",Kt("dst","Alpha"),"]");return[an,$r,xn,Zn]});case zu:return Ct(function(Pe){if(typeof Pe=="string")return k.commandParameter(Pe,dr,"invalid "+ht,ye.commandStr),[dr[Pe],dr[Pe]];if(typeof Pe=="object")return k.commandParameter(Pe.rgb,dr,ht+".rgb",ye.commandStr),k.commandParameter(Pe.alpha,dr,ht+".alpha",ye.commandStr),[dr[Pe.rgb],dr[Pe.alpha]];k.commandRaise("invalid blend.equation",ye.commandStr)},function(Pe,tt,Be){var Ft=Pe.constants.blendEquations,Kt=tt.def(),Or=tt.def(),nn=Pe.cond("typeof ",Be,'==="string"');return k.optional(function(){function an(xn,$r,Zn){Pe.assert(xn,Zn+" in "+Ft,"invalid "+$r+", must be one of "+Object.keys(dr))}an(nn.then,ht,Be),Pe.assert(nn.else,Be+"&&typeof "+Be+'==="object"',"invalid "+ht),an(nn.else,ht+".rgb",Be+".rgb"),an(nn.else,ht+".alpha",Be+".alpha")}),nn.then(Kt,"=",Or,"=",Ft,"[",Be,"];"),nn.else(Kt,"=",Ft,"[",Be,".rgb];",Or,"=",Ft,"[",Be,".alpha];"),tt(nn),[Kt,Or]});case Wo:return Ct(function(Pe){return k.command(fo(Pe)&&Pe.length===4,"blend.color must be a 4d array",ye.commandStr),it(4,function(tt){return+Pe[tt]})},function(Pe,tt,Be){return k.optional(function(){Pe.assert(tt,Pe.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","blend.color must be a 4d array")}),it(4,function(Ft){return tt.def("+",Be,"[",Ft,"]")})});case Ws:return Ct(function(Pe){return k.commandType(Pe,"number",Xe,ye.commandStr),Pe|0},function(Pe,tt,Be){return k.optional(function(){Pe.assert(tt,"typeof "+Be+'==="number"',"invalid stencil.mask")}),tt.def(Be,"|0")});case rs:return Ct(function(Pe){k.commandType(Pe,"object",Xe,ye.commandStr);var tt=Pe.cmp||"keep",Be=Pe.ref||0,Ft="mask"in Pe?Pe.mask:-1;return k.commandParameter(tt,af,ht+".cmp",ye.commandStr),k.commandType(Be,"number",ht+".ref",ye.commandStr),k.commandType(Ft,"number",ht+".mask",ye.commandStr),[af[tt],Be,Ft]},function(Pe,tt,Be){var Ft=Pe.constants.compareFuncs;k.optional(function(){function an(){Pe.assert(tt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}an(Be+"&&typeof ",Be,'==="object"'),an('!("cmp" in ',Be,")||(",Be,".cmp in ",Ft,")")});var Kt=tt.def('"cmp" in ',Be,"?",Ft,"[",Be,".cmp]",":",Tu),Or=tt.def(Be,".ref|0"),nn=tt.def('"mask" in ',Be,"?",Be,".mask|0:-1");return[Kt,Or,nn]});case rl:case Gc:return Ct(function(Pe){k.commandType(Pe,"object",Xe,ye.commandStr);var tt=Pe.fail||"keep",Be=Pe.zfail||"keep",Ft=Pe.zpass||"keep";return k.commandParameter(tt,bc,ht+".fail",ye.commandStr),k.commandParameter(Be,bc,ht+".zfail",ye.commandStr),k.commandParameter(Ft,bc,ht+".zpass",ye.commandStr),[ht===Gc?tf:El,bc[tt],bc[Be],bc[Ft]]},function(Pe,tt,Be){var Ft=Pe.constants.stencilOps;k.optional(function(){Pe.assert(tt,Be+"&&typeof "+Be+'==="object"',"invalid "+ht)});function Kt(Or){return k.optional(function(){Pe.assert(tt,'!("'+Or+'" in '+Be+")||("+Be+"."+Or+" in "+Ft+")","invalid "+ht+"."+Or+", must be one of "+Object.keys(bc))}),tt.def('"',Or,'" in ',Be,"?",Ft,"[",Be,".",Or,"]:",Tu)}return[ht===Gc?tf:El,Kt("fail"),Kt("zfail"),Kt("zpass")]});case xo:return Ct(function(Pe){k.commandType(Pe,"object",Xe,ye.commandStr);var tt=Pe.factor|0,Be=Pe.units|0;return k.commandType(tt,"number",Xe+".factor",ye.commandStr),k.commandType(Be,"number",Xe+".units",ye.commandStr),[tt,Be]},function(Pe,tt,Be){k.optional(function(){Pe.assert(tt,Be+"&&typeof "+Be+'==="object"',"invalid "+ht)});var Ft=tt.def(Be,".factor|0"),Kt=tt.def(Be,".units|0");return[Ft,Kt]});case gc:return Ct(function(Pe){var tt=0;return Pe==="front"?tt=El:Pe==="back"&&(tt=tf),k.command(!!tt,Xe,ye.commandStr),tt},function(Pe,tt,Be){return k.optional(function(){Pe.assert(tt,Be+'==="front"||'+Be+'==="back"',"invalid cull.face")}),tt.def(Be,'==="front"?',El,":",tf)});case _l:return Ct(function(Pe){return k.command(typeof Pe=="number"&&Pe>=lr.lineWidthDims[0]&&Pe<=lr.lineWidthDims[1],"invalid line width, must be a positive number between "+lr.lineWidthDims[0]+" and "+lr.lineWidthDims[1],ye.commandStr),Pe},function(Pe,tt,Be){return k.optional(function(){Pe.assert(tt,"typeof "+Be+'==="number"&&'+Be+">="+lr.lineWidthDims[0]+"&&"+Be+"<="+lr.lineWidthDims[1],"invalid line width")}),Be});case vu:return Ct(function(Pe){return k.commandParameter(Pe,zh,Xe,ye.commandStr),zh[Pe]},function(Pe,tt,Be){return k.optional(function(){Pe.assert(tt,Be+'==="cw"||'+Be+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),tt.def(Be+'==="cw"?'+Jp+":"+Nh)});case du:return Ct(function(Pe){return k.command(fo(Pe)&&Pe.length===4,"color.mask must be length 4 array",ye.commandStr),Pe.map(function(tt){return!!tt})},function(Pe,tt,Be){return k.optional(function(){Pe.assert(tt,Pe.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","invalid color.mask")}),it(4,function(Ft){return"!!"+Be+"["+Ft+"]"})});case Uu:return Ct(function(Pe){k.command(typeof Pe=="object"&&Pe,Xe,ye.commandStr);var tt="value"in Pe?Pe.value:1,Be=!!Pe.invert;return k.command(typeof tt=="number"&&tt>=0&&tt<=1,"sample.coverage.value must be a number between 0 and 1",ye.commandStr),[tt,Be]},function(Pe,tt,Be){k.optional(function(){Pe.assert(tt,Be+"&&typeof "+Be+'==="object"',"invalid sample.coverage")});var Ft=tt.def('"value" in ',Be,"?+",Be,".value:1"),Kt=tt.def("!!",Be,".invert");return[Ft,Kt]})}}),Yt}function Yi(De,ye){var st=De.static,Nt=De.dynamic,Yt={};return Object.keys(st).forEach(function(ht){var Xe=st[ht],Ct;if(typeof Xe=="number"||typeof Xe=="boolean")Ct=To(function(){return Xe});else if(typeof Xe=="function"){var Pe=Xe._reglType;Pe==="texture2d"||Pe==="textureCube"?Ct=To(function(tt){return tt.link(Xe)}):Pe==="framebuffer"||Pe==="framebufferCube"?(k.command(Xe.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ht+'"',ye.commandStr),Ct=To(function(tt){return tt.link(Xe.color[0])})):k.commandRaise('invalid data for uniform "'+ht+'"',ye.commandStr)}else fo(Xe)?Ct=To(function(tt){var Be=tt.global.def("[",it(Xe.length,function(Ft){return k.command(typeof Xe[Ft]=="number"||typeof Xe[Ft]=="boolean","invalid uniform "+ht,tt.commandStr),Xe[Ft]}),"]");return Be}):k.commandRaise('invalid or missing data for uniform "'+ht+'"',ye.commandStr);Ct.value=Xe,Yt[ht]=Ct}),Object.keys(Nt).forEach(function(ht){var Xe=Nt[ht];Yt[ht]=iu(Xe,function(Ct,Pe){return Ct.invoke(Pe,Xe)})}),Yt}function qo(De,ye){var st=De.static,Nt=De.dynamic,Yt={};return Object.keys(st).forEach(function(ht){var Xe=st[ht],Ct=Me.id(ht),Pe=new kt;if(Ec(Xe))Pe.state=ui,Pe.buffer=Sr.getBuffer(Sr.create(Xe,kf,!1,!0)),Pe.type=0;else{var tt=Sr.getBuffer(Xe);if(tt)Pe.state=ui,Pe.buffer=tt,Pe.type=0;else if(k.command(typeof Xe=="object"&&Xe,"invalid data for attribute "+ht,ye.commandStr),"constant"in Xe){var Be=Xe.constant;Pe.buffer="null",Pe.state=Oi,typeof Be=="number"?Pe.x=Be:(k.command(fo(Be)&&Be.length>0&&Be.length<=4,"invalid constant for attribute "+ht,ye.commandStr),Ti.forEach(function($r,Zn){Zn<Be.length&&(Pe[$r]=Be[Zn])}))}else{Ec(Xe.buffer)?tt=Sr.getBuffer(Sr.create(Xe.buffer,kf,!1,!0)):tt=Sr.getBuffer(Xe.buffer),k.command(!!tt,'missing buffer for attribute "'+ht+'"',ye.commandStr);var Ft=Xe.offset|0;k.command(Ft>=0,'invalid offset for attribute "'+ht+'"',ye.commandStr);var Kt=Xe.stride|0;k.command(Kt>=0&&Kt<256,'invalid stride for attribute "'+ht+'", must be integer betweeen [0, 255]',ye.commandStr);var Or=Xe.size|0;k.command(!("size"in Xe)||Or>0&&Or<=4,'invalid size for attribute "'+ht+'", must be 1,2,3,4',ye.commandStr);var nn=!!Xe.normalized,an=0;"type"in Xe&&(k.commandParameter(Xe.type,cs,"invalid type for attribute "+ht,ye.commandStr),an=cs[Xe.type]);var xn=Xe.divisor|0;k.optional(function(){"divisor"in Xe&&(k.command(xn===0||Zr,'cannot specify divisor for attribute "'+ht+'", instancing not supported',ye.commandStr),k.command(xn>=0,'invalid divisor for attribute "'+ht+'"',ye.commandStr));var $r=ye.commandStr,Zn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Xe).forEach(function(Cn){k.command(Zn.indexOf(Cn)>=0,'unknown parameter "'+Cn+'" for attribute pointer "'+ht+'" (valid parameters are '+Zn+")",$r)})}),Pe.buffer=tt,Pe.state=ui,Pe.size=Or,Pe.normalized=nn,Pe.type=an||tt.dtype,Pe.offset=Ft,Pe.stride=Kt,Pe.divisor=xn}}Yt[ht]=To(function($r,Zn){var Cn=$r.attribCache;if(Ct in Cn)return Cn[Ct];var Bn={isStream:!1};return Object.keys(Pe).forEach(function(Nn){Bn[Nn]=Pe[Nn]}),Pe.buffer&&(Bn.buffer=$r.link(Pe.buffer),Bn.type=Bn.type||Bn.buffer+".dtype"),Cn[Ct]=Bn,Bn})}),Object.keys(Nt).forEach(function(ht){var Xe=Nt[ht];function Ct(Pe,tt){var Be=Pe.invoke(tt,Xe),Ft=Pe.shared,Kt=Pe.constants,Or=Ft.isBufferArgs,nn=Ft.buffer;k.optional(function(){Pe.assert(tt,Be+"&&(typeof "+Be+'==="object"||typeof '+Be+'==="function")&&('+Or+"("+Be+")||"+nn+".getBuffer("+Be+")||"+nn+".getBuffer("+Be+".buffer)||"+Or+"("+Be+'.buffer)||("constant" in '+Be+"&&(typeof "+Be+'.constant==="number"||'+Ft.isArrayLike+"("+Be+".constant))))",'invalid dynamic attribute "'+ht+'"')});var an={isStream:tt.def(!1)},xn=new kt;xn.state=ui,Object.keys(xn).forEach(function(Bn){an[Bn]=tt.def(""+xn[Bn])});var $r=an.buffer,Zn=an.type;tt("if(",Or,"(",Be,")){",an.isStream,"=true;",$r,"=",nn,".createStream(",kf,",",Be,");",Zn,"=",$r,".dtype;","}else{",$r,"=",nn,".getBuffer(",Be,");","if(",$r,"){",Zn,"=",$r,".dtype;",'}else if("constant" in ',Be,"){",an.state,"=",Oi,";","if(typeof "+Be+'.constant === "number"){',an[Ti[0]],"=",Be,".constant;",Ti.slice(1).map(function(Bn){return an[Bn]}).join("="),"=0;","}else{",Ti.map(function(Bn,Nn){return an[Bn]+"="+Be+".constant.length>"+Nn+"?"+Be+".constant["+Nn+"]:0;"}).join(""),"}}else{","if(",Or,"(",Be,".buffer)){",$r,"=",nn,".createStream(",kf,",",Be,".buffer);","}else{",$r,"=",nn,".getBuffer(",Be,".buffer);","}",Zn,'="type" in ',Be,"?",Kt.glTypes,"[",Be,".type]:",$r,".dtype;",an.normalized,"=!!",Be,".normalized;");function Cn(Bn){tt(an[Bn],"=",Be,".",Bn,"|0;")}return Cn("size"),Cn("offset"),Cn("stride"),Cn("divisor"),tt("}}"),tt.exit("if(",an.isStream,"){",nn,".destroyStream(",$r,");","}"),an}Yt[ht]=iu(Xe,Ct)}),Yt}function Ha(De){var ye=De.static,st=De.dynamic,Nt={};return Object.keys(ye).forEach(function(Yt){var ht=ye[Yt];Nt[Yt]=To(function(Xe,Ct){return typeof ht=="number"||typeof ht=="boolean"?""+ht:Xe.link(ht)})}),Object.keys(st).forEach(function(Yt){var ht=st[Yt];Nt[Yt]=iu(ht,function(Xe,Ct){return Xe.invoke(Ct,ht)})}),Nt}function ns(De,ye,st,Nt,Yt){var ht=De.static,Xe=De.dynamic;k.optional(function(){var Cn=[mu,xl,bl,wu,ko,Of,Wc,If,yc,oh].concat($n);function Bn(Nn){Object.keys(Nn).forEach(function(On){k.command(Cn.indexOf(On)>=0,'unknown parameter "'+On+'"',Yt.commandStr)})}Bn(ht),Bn(Xe)});var Ct=Ai(De,ye),Pe=En(De,Yt),tt=di(De,Pe,Yt),Be=no(De,Yt),Ft=io(De,Yt),Kt=$i(De,Yt,Ct);function Or(Cn){var Bn=tt[Cn];Bn&&(Ft[Cn]=Bn)}Or(tu),Or(Fn(Pf));var nn=Object.keys(Ft).length>0,an={framebuffer:Pe,draw:Be,shader:Kt,state:Ft,dirty:nn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(an.profile=hn(De,Yt),an.uniforms=Yi(st,Yt),an.drawVAO=an.scopeVAO=Be.vao,!an.drawVAO&&Kt.program&&!Ct&&qe.angle_instanced_arrays&&Be.static.elements){var xn=!0,$r=Kt.program.attributes.map(function(Cn){var Bn=ye.static[Cn];return xn=xn&&!!Bn,Bn});if(xn&&$r.length>0){var Zn=wt.getVAO(wt.createVAO({attributes:$r,elements:Be.static.elements}));an.drawVAO=new ya(null,null,null,function(Cn,Bn){return Cn.link(Zn)}),an.useVAO=!0}}return Ct?an.useVAO=!0:an.attributes=qo(ye,Yt),an.context=Ha(Nt,Yt),an}function bo(De,ye,st){var Nt=De.shared,Yt=Nt.context,ht=De.scope();Object.keys(st).forEach(function(Xe){ye.save(Yt,"."+Xe);var Ct=st[Xe],Pe=Ct.append(De,ye);Array.isArray(Pe)?ht(Yt,".",Xe,"=[",Pe.join(),"];"):ht(Yt,".",Xe,"=",Pe,";")}),ye(ht)}function Bo(De,ye,st,Nt){var Yt=De.shared,ht=Yt.gl,Xe=Yt.framebuffer,Ct;tn&&(Ct=ye.def(Yt.extensions,".webgl_draw_buffers"));var Pe=De.constants,tt=Pe.drawBuffer,Be=Pe.backBuffer,Ft;st?Ft=st.append(De,ye):Ft=ye.def(Xe,".next"),Nt||ye("if(",Ft,"!==",Xe,".cur){"),ye("if(",Ft,"){",ht,".bindFramebuffer(",td,",",Ft,".framebuffer);"),tn&&ye(Ct,".drawBuffersWEBGL(",tt,"[",Ft,".colorAttachments.length]);"),ye("}else{",ht,".bindFramebuffer(",td,",null);"),tn&&ye(Ct,".drawBuffersWEBGL(",Be,");"),ye("}",Xe,".cur=",Ft,";"),Nt||ye("}")}function Mo(De,ye,st){var Nt=De.shared,Yt=Nt.gl,ht=De.current,Xe=De.next,Ct=Nt.current,Pe=Nt.next,tt=De.cond(Ct,".dirty");$n.forEach(function(Be){var Ft=Fn(Be);if(!(Ft in st.state)){var Kt,Or;if(Ft in Xe){Kt=Xe[Ft],Or=ht[Ft];var nn=it(qr[Ft].length,function(xn){return tt.def(Kt,"[",xn,"]")});tt(De.cond(nn.map(function(xn,$r){return xn+"!=="+Or+"["+$r+"]"}).join("||")).then(Yt,".",Er[Ft],"(",nn,");",nn.map(function(xn,$r){return Or+"["+$r+"]="+xn}).join(";"),";"))}else{Kt=tt.def(Pe,".",Ft);var an=De.cond(Kt,"!==",Ct,".",Ft);tt(an),Ft in gr?an(De.cond(Kt).then(Yt,".enable(",gr[Ft],");").else(Yt,".disable(",gr[Ft],");"),Ct,".",Ft,"=",Kt,";"):an(Yt,".",Er[Ft],"(",Kt,");",Ct,".",Ft,"=",Kt,";")}}}),Object.keys(st.state).length===0&&tt(Ct,".dirty=false;"),ye(tt)}function ps(De,ye,st,Nt){var Yt=De.shared,ht=De.current,Xe=Yt.current,Ct=Yt.gl;_p(Object.keys(st)).forEach(function(Pe){var tt=st[Pe];if(!(Nt&&!Nt(tt))){var Be=tt.append(De,ye);if(gr[Pe]){var Ft=gr[Pe];Sc(tt)?Be?ye(Ct,".enable(",Ft,");"):ye(Ct,".disable(",Ft,");"):ye(De.cond(Be).then(Ct,".enable(",Ft,");").else(Ct,".disable(",Ft,");")),ye(Xe,".",Pe,"=",Be,";")}else if(fo(Be)){var Kt=ht[Pe];ye(Ct,".",Er[Pe],"(",Be,");",Be.map(function(Or,nn){return Kt+"["+nn+"]="+Or}).join(";"),";")}else ye(Ct,".",Er[Pe],"(",Be,");",Xe,".",Pe,"=",Be,";")}})}function ao(De,ye){Zr&&(De.instancing=ye.def(De.shared.extensions,".angle_instanced_arrays"))}function Ii(De,ye,st,Nt,Yt){var ht=De.shared,Xe=De.stats,Ct=ht.current,Pe=ht.timer,tt=st.profile;function Be(){var Cn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return Cn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Ft,Kt;function Or(Cn){Ft=ye.def(),Cn(Ft,"=",Be(),";"),typeof Yt=="string"?Cn(Xe,".count+=",Yt,";"):Cn(Xe,".count++;"),zr&&(Nt?(Kt=ye.def(),Cn(Kt,"=",Pe,".getNumPendingQueries();")):Cn(Pe,".beginQuery(",Xe,");"))}function nn(Cn){Cn(Xe,".cpuTime+=",Be(),"-",Ft,";"),zr&&(Nt?Cn(Pe,".pushScopeStats(",Kt,",",Pe,".getNumPendingQueries(),",Xe,");"):Cn(Pe,".endQuery();"))}function an(Cn){var Bn=ye.def(Ct,".profile");ye(Ct,".profile=",Cn,";"),ye.exit(Ct,".profile=",Bn,";")}var xn;if(tt){if(Sc(tt)){tt.enable?(Or(ye),nn(ye.exit),an("true")):an("false");return}xn=tt.append(De,ye),an(xn)}else xn=ye.def(Ct,".profile");var $r=De.block();Or($r),ye("if(",xn,"){",$r,"}");var Zn=De.block();nn(Zn),ye.exit("if(",xn,"){",Zn,"}")}function No(De,ye,st,Nt,Yt){var ht=De.shared;function Xe(Pe){switch(Pe){case Bh:case $c:case Qc:return 2;case qc:case Hl:case Jc:return 3;case nl:case uh:case ef:return 4;default:return 1}}function Ct(Pe,tt,Be){var Ft=ht.gl,Kt=ye.def(Pe,".location"),Or=ye.def(ht.attributes,"[",Kt,"]"),nn=Be.state,an=Be.buffer,xn=[Be.x,Be.y,Be.z,Be.w],$r=["buffer","normalized","offset","stride"];function Zn(){ye("if(!",Or,".buffer){",Ft,".enableVertexAttribArray(",Kt,");}");var Bn=Be.type,Nn;if(Be.size?Nn=ye.def(Be.size,"||",tt):Nn=tt,ye("if(",Or,".type!==",Bn,"||",Or,".size!==",Nn,"||",$r.map(function(hi){return Or+"."+hi+"!=="+Be[hi]}).join("||"),"){",Ft,".bindBuffer(",kf,",",an,".buffer);",Ft,".vertexAttribPointer(",[Kt,Nn,Bn,Be.normalized,Be.stride,Be.offset],");",Or,".type=",Bn,";",Or,".size=",Nn,";",$r.map(function(hi){return Or+"."+hi+"="+Be[hi]+";"}).join(""),"}"),Zr){var On=Be.divisor;ye("if(",Or,".divisor!==",On,"){",De.instancing,".vertexAttribDivisorANGLE(",[Kt,On],");",Or,".divisor=",On,";}")}}function Cn(){ye("if(",Or,".buffer){",Ft,".disableVertexAttribArray(",Kt,");",Or,".buffer=null;","}if(",Ti.map(function(Bn,Nn){return Or+"."+Bn+"!=="+xn[Nn]}).join("||"),"){",Ft,".vertexAttrib4f(",Kt,",",xn,");",Ti.map(function(Bn,Nn){return Or+"."+Bn+"="+xn[Nn]+";"}).join(""),"}")}nn===ui?Zn():nn===Oi?Cn():(ye("if(",nn,"===",ui,"){"),Zn(),ye("}else{"),Cn(),ye("}"))}Nt.forEach(function(Pe){var tt=Pe.name,Be=st.attributes[tt],Ft;if(Be){if(!Yt(Be))return;Ft=Be.append(De,ye)}else{if(!Yt(xp))return;var Kt=De.scopeAttrib(tt);k.optional(function(){De.assert(ye,Kt+".state","missing attribute "+tt)}),Ft={},Object.keys(new kt).forEach(function(Or){Ft[Or]=ye.def(Kt,".",Or)})}Ct(De.link(Pe),Xe(Pe.info.type),Ft)})}function sa(De,ye,st,Nt,Yt,ht){for(var Xe=De.shared,Ct=Xe.gl,Pe,tt=0;tt<Nt.length;++tt){var Be=Nt[tt],Ft=Be.name,Kt=Be.info.type,Or=st.uniforms[Ft],nn=De.link(Be),an=nn+".location",xn;if(Or){if(!Yt(Or))continue;if(Sc(Or)){var $r=Or.value;if(k.command($r!==null&&typeof $r!="undefined",'missing uniform "'+Ft+'"',De.commandStr),Kt===Bf||Kt===yu){k.command(typeof $r=="function"&&(Kt===Bf&&($r._reglType==="texture2d"||$r._reglType==="framebuffer")||Kt===yu&&($r._reglType==="textureCube"||$r._reglType==="framebufferCube")),"invalid texture for uniform "+Ft,De.commandStr);var Zn=De.link($r._texture||$r.color[0]._texture);ye(Ct,".uniform1i(",an,",",Zn+".bind());"),ye.exit(Zn,".unbind();")}else if(Kt===Rs||Kt===Ff||Kt===lh){k.optional(function(){k.command(fo($r),"invalid matrix for uniform "+Ft,De.commandStr),k.command(Kt===Rs&&$r.length===4||Kt===Ff&&$r.length===9||Kt===lh&&$r.length===16,"invalid length for matrix uniform "+Ft,De.commandStr)});var Cn=De.global.def("new Float32Array(["+Array.prototype.slice.call($r)+"])"),Bn=2;Kt===Ff?Bn=3:Kt===lh&&(Bn=4),ye(Ct,".uniformMatrix",Bn,"fv(",an,",false,",Cn,");")}else{switch(Kt){case mp:k.commandType($r,"number","uniform "+Ft,De.commandStr),Pe="1f";break;case Bh:k.command(fo($r)&&$r.length===2,"uniform "+Ft,De.commandStr),Pe="2f";break;case qc:k.command(fo($r)&&$r.length===3,"uniform "+Ft,De.commandStr),Pe="3f";break;case nl:k.command(fo($r)&&$r.length===4,"uniform "+Ft,De.commandStr),Pe="4f";break;case xc:k.commandType($r,"boolean","uniform "+Ft,De.commandStr),Pe="1i";break;case Kc:k.commandType($r,"number","uniform "+Ft,De.commandStr),Pe="1i";break;case Qc:k.command(fo($r)&&$r.length===2,"uniform "+Ft,De.commandStr),Pe="2i";break;case $c:k.command(fo($r)&&$r.length===2,"uniform "+Ft,De.commandStr),Pe="2i";break;case Jc:k.command(fo($r)&&$r.length===3,"uniform "+Ft,De.commandStr),Pe="3i";break;case Hl:k.command(fo($r)&&$r.length===3,"uniform "+Ft,De.commandStr),Pe="3i";break;case ef:k.command(fo($r)&&$r.length===4,"uniform "+Ft,De.commandStr),Pe="4i";break;case uh:k.command(fo($r)&&$r.length===4,"uniform "+Ft,De.commandStr),Pe="4i";break}ye(Ct,".uniform",Pe,"(",an,",",fo($r)?Array.prototype.slice.call($r):$r,");")}continue}else xn=Or.append(De,ye)}else{if(!Yt(xp))continue;xn=ye.def(Xe.uniforms,"[",Me.id(Ft),"]")}Kt===Bf?(k(!Array.isArray(xn),"must specify a scalar prop for textures"),ye("if(",xn,"&&",xn,'._reglType==="framebuffer"){',xn,"=",xn,".color[0];","}")):Kt===yu&&(k(!Array.isArray(xn),"must specify a scalar prop for cube maps"),ye("if(",xn,"&&",xn,'._reglType==="framebufferCube"){',xn,"=",xn,".color[0];","}")),k.optional(function(){function ks(Pu,Cc){De.assert(ye,Pu,'bad data or missing for uniform "'+Ft+'".  '+Cc)}function Vu(Pu){k(!Array.isArray(xn),"must not specify an array type for uniform"),ks("typeof "+xn+'==="'+Pu+'"',"invalid type, expected "+Pu)}function Mu(Pu,Cc){Array.isArray(xn)?k(xn.length===Pu,"must have length "+Pu):ks(Xe.isArrayLike+"("+xn+")&&"+xn+".length==="+Pu,"invalid vector, should have length "+Pu,De.commandStr)}function Cp(Pu){k(!Array.isArray(xn),"must not specify a value type"),ks("typeof "+xn+'==="function"&&'+xn+'._reglType==="texture'+(Pu===Yo?"2d":"Cube")+'"',"invalid texture type",De.commandStr)}switch(Kt){case Kc:Vu("number");break;case $c:Mu(2,"number");break;case Hl:Mu(3,"number");break;case uh:Mu(4,"number");break;case mp:Vu("number");break;case Bh:Mu(2,"number");break;case qc:Mu(3,"number");break;case nl:Mu(4,"number");break;case xc:Vu("boolean");break;case Qc:Mu(2,"boolean");break;case Jc:Mu(3,"boolean");break;case ef:Mu(4,"boolean");break;case Rs:Mu(4,"number");break;case Ff:Mu(9,"number");break;case lh:Mu(16,"number");break;case Bf:Cp(Yo);break;case yu:Cp(Do);break}});var Nn=1;switch(Kt){case Bf:case yu:var On=ye.def(xn,"._texture");ye(Ct,".uniform1i(",an,",",On,".bind());"),ye.exit(On,".unbind();");continue;case Kc:case xc:Pe="1i";break;case $c:case Qc:Pe="2i",Nn=2;break;case Hl:case Jc:Pe="3i",Nn=3;break;case uh:case ef:Pe="4i",Nn=4;break;case mp:Pe="1f";break;case Bh:Pe="2f",Nn=2;break;case qc:Pe="3f",Nn=3;break;case nl:Pe="4f",Nn=4;break;case Rs:Pe="Matrix2fv";break;case Ff:Pe="Matrix3fv";break;case lh:Pe="Matrix4fv";break}if(Pe.charAt(0)==="M"){ye(Ct,".uniform",Pe,"(",an,",");var hi=Math.pow(Kt-Rs+2,2),wa=De.global.def("new Float32Array(",hi,")");Array.isArray(xn)?ye("false,(",it(hi,function(ks){return wa+"["+ks+"]="+xn[ks]}),",",wa,")"):ye("false,(Array.isArray(",xn,")||",xn," instanceof Float32Array)?",xn,":(",it(hi,function(ks){return wa+"["+ks+"]="+xn+"["+ks+"]"}),",",wa,")"),ye(");")}else if(Nn>1){for(var as=[],La=[],fa=0;fa<Nn;++fa)Array.isArray(xn)?La.push(xn[fa]):La.push(ye.def(xn+"["+fa+"]")),ht&&as.push(ye.def());ht&&ye("if(!",De.batchId,"||",as.map(function(ks,Vu){return ks+"!=="+La[Vu]}).join("||"),"){",as.map(function(ks,Vu){return ks+"="+La[Vu]+";"}).join("")),ye(Ct,".uniform",Pe,"(",an,",",La.join(","),");"),ht&&ye("}")}else{if(k(!Array.isArray(xn),"uniform value must not be an array"),ht){var Cl=ye.def();ye("if(!",De.batchId,"||",Cl,"!==",xn,"){",Cl,"=",xn,";")}ye(Ct,".uniform",Pe,"(",an,",",xn,");"),ht&&ye("}")}}}function is(De,ye,st,Nt){var Yt=De.shared,ht=Yt.gl,Xe=Yt.draw,Ct=Nt.draw;function Pe(){var Nn=Ct.elements,On,hi=ye;return Nn?((Nn.contextDep&&Nt.contextDynamic||Nn.propDep)&&(hi=st),On=Nn.append(De,hi),Ct.elementsActive&&hi("if("+On+")"+ht+".bindBuffer("+pp+","+On+".buffer.buffer);")):(On=hi.def(),hi(On,"=",Xe,".",wu,";","if(",On,"){",ht,".bindBuffer(",pp,",",On,".buffer.buffer);}","else if(",Yt.vao,".currentVAO){",On,"=",De.shared.elements+".getElements("+Yt.vao,".currentVAO.elements);",Ar?"":"if("+On+")"+ht+".bindBuffer("+pp+","+On+".buffer.buffer);","}")),On}function tt(){var Nn=Ct.count,On,hi=ye;return Nn?((Nn.contextDep&&Nt.contextDynamic||Nn.propDep)&&(hi=st),On=Nn.append(De,hi),k.optional(function(){Nn.MISSING&&De.assert(ye,"false","missing vertex count"),Nn.DYNAMIC&&De.assert(hi,On+">=0","missing vertex count")})):(On=hi.def(Xe,".",Wc),k.optional(function(){De.assert(hi,On+">=0","missing vertex count")})),On}var Be=Pe();function Ft(Nn){var On=Ct[Nn];return On?On.contextDep&&Nt.contextDynamic||On.propDep?On.append(De,st):On.append(De,ye):ye.def(Xe,".",Nn)}var Kt=Ft(ko),Or=Ft(Of),nn=tt();if(typeof nn=="number"){if(nn===0)return}else st("if(",nn,"){"),st.exit("}");var an,xn;Zr&&(an=Ft(If),xn=De.instancing);var $r=Be+".type",Zn=Ct.elements&&Sc(Ct.elements)&&!Ct.vaoActive;function Cn(){function Nn(){st(xn,".drawElementsInstancedANGLE(",[Kt,nn,$r,Or+"<<(("+$r+"-"+mi+")>>1)",an],");")}function On(){st(xn,".drawArraysInstancedANGLE(",[Kt,Or,nn,an],");")}Be&&Be!=="null"?Zn?Nn():(st("if(",Be,"){"),Nn(),st("}else{"),On(),st("}")):On()}function Bn(){function Nn(){st(ht+".drawElements("+[Kt,nn,$r,Or+"<<(("+$r+"-"+mi+")>>1)"]+");")}function On(){st(ht+".drawArrays("+[Kt,Or,nn]+");")}Be&&Be!=="null"?Zn?Nn():(st("if(",Be,"){"),Nn(),st("}else{"),On(),st("}")):On()}Zr&&(typeof an!="number"||an>=0)?typeof an=="string"?(st("if(",an,">0){"),Cn(),st("}else if(",an,"<0){"),Bn(),st("}")):Cn():Bn()}function gi(De,ye,st,Nt,Yt){var ht=yi(),Xe=ht.proc("body",Yt);return k.optional(function(){ht.commandStr=ye.commandStr,ht.command=ht.link(ye.commandStr)}),Zr&&(ht.instancing=Xe.def(ht.shared.extensions,".angle_instanced_arrays")),De(ht,Xe,st,Nt),ht.compile().body}function Zi(De,ye,st,Nt){ao(De,ye),st.useVAO?st.drawVAO?ye(De.shared.vao,".setVAO(",st.drawVAO.append(De,ye),");"):ye(De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"):(ye(De.shared.vao,".setVAO(null);"),No(De,ye,st,Nt.attributes,function(){return!0})),sa(De,ye,st,Nt.uniforms,function(){return!0},!1),is(De,ye,ye,st)}function ma(De,ye){var st=De.proc("draw",1);ao(De,st),bo(De,st,ye.context),Bo(De,st,ye.framebuffer),Mo(De,st,ye),ps(De,st,ye.state),Ii(De,st,ye,!1,!0);var Nt=ye.shader.progVar.append(De,st);if(st(De.shared.gl,".useProgram(",Nt,".program);"),ye.shader.program)Zi(De,st,ye,ye.shader.program);else{st(De.shared.vao,".setVAO(null);");var Yt=De.global.def("{}"),ht=st.def(Nt,".id"),Xe=st.def(Yt,"[",ht,"]");st(De.cond(Xe).then(Xe,".call(this,a0);").else(Xe,"=",Yt,"[",ht,"]=",De.link(function(Ct){return gi(Zi,De,ye,Ct,1)}),"(",Nt,");",Xe,".call(this,a0);"))}Object.keys(ye.state).length>0&&st(De.shared.current,".dirty=true;"),De.shared.vao&&st(De.shared.vao,".setVAO(null);")}function Di(De,ye,st,Nt){De.batchId="a1",ao(De,ye);function Yt(){return!0}No(De,ye,st,Nt.attributes,Yt),sa(De,ye,st,Nt.uniforms,Yt,!1),is(De,ye,ye,st)}function Ls(De,ye,st,Nt){ao(De,ye);var Yt=st.contextDep,ht=ye.def(),Xe="a0",Ct="a1",Pe=ye.def();De.shared.props=Pe,De.batchId=ht;var tt=De.scope(),Be=De.scope();ye(tt.entry,"for(",ht,"=0;",ht,"<",Ct,";++",ht,"){",Pe,"=",Xe,"[",ht,"];",Be,"}",tt.exit);function Ft($r){return $r.contextDep&&Yt||$r.propDep}function Kt($r){return!Ft($r)}if(st.needsContext&&bo(De,Be,st.context),st.needsFramebuffer&&Bo(De,Be,st.framebuffer),ps(De,Be,st.state,Ft),st.profile&&Ft(st.profile)&&Ii(De,Be,st,!1,!0),Nt)st.useVAO?st.drawVAO?Ft(st.drawVAO)?Be(De.shared.vao,".setVAO(",st.drawVAO.append(De,Be),");"):tt(De.shared.vao,".setVAO(",st.drawVAO.append(De,tt),");"):tt(De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"):(tt(De.shared.vao,".setVAO(null);"),No(De,tt,st,Nt.attributes,Kt),No(De,Be,st,Nt.attributes,Ft)),sa(De,tt,st,Nt.uniforms,Kt,!1),sa(De,Be,st,Nt.uniforms,Ft,!0),is(De,tt,Be,st);else{var Or=De.global.def("{}"),nn=st.shader.progVar.append(De,Be),an=Be.def(nn,".id"),xn=Be.def(Or,"[",an,"]");Be(De.shared.gl,".useProgram(",nn,".program);","if(!",xn,"){",xn,"=",Or,"[",an,"]=",De.link(function($r){return gi(Di,De,st,$r,2)}),"(",nn,");}",xn,".call(this,a0[",ht,"],",ht,");")}}function ze(De,ye){var st=De.proc("batch",2);De.batchId="0",ao(De,st);var Nt=!1,Yt=!0;Object.keys(ye.context).forEach(function(Or){Nt=Nt||ye.context[Or].propDep}),Nt||(bo(De,st,ye.context),Yt=!1);var ht=ye.framebuffer,Xe=!1;ht?(ht.propDep?Nt=Xe=!0:ht.contextDep&&Nt&&(Xe=!0),Xe||Bo(De,st,ht)):Bo(De,st,null),ye.state.viewport&&ye.state.viewport.propDep&&(Nt=!0);function Ct(Or){return Or.contextDep&&Nt||Or.propDep}Mo(De,st,ye),ps(De,st,ye.state,function(Or){return!Ct(Or)}),(!ye.profile||!Ct(ye.profile))&&Ii(De,st,ye,!1,"a1"),ye.contextDep=Nt,ye.needsContext=Yt,ye.needsFramebuffer=Xe;var Pe=ye.shader.progVar;if(Pe.contextDep&&Nt||Pe.propDep)Ls(De,st,ye,null);else{var tt=Pe.append(De,st);if(st(De.shared.gl,".useProgram(",tt,".program);"),ye.shader.program)Ls(De,st,ye,ye.shader.program);else{st(De.shared.vao,".setVAO(null);");var Be=De.global.def("{}"),Ft=st.def(tt,".id"),Kt=st.def(Be,"[",Ft,"]");st(De.cond(Kt).then(Kt,".call(this,a0,a1);").else(Kt,"=",Be,"[",Ft,"]=",De.link(function(Or){return gi(Ls,De,ye,Or,2)}),"(",tt,");",Kt,".call(this,a0,a1);"))}}Object.keys(ye.state).length>0&&st(De.shared.current,".dirty=true;"),De.shared.vao&&st(De.shared.vao,".setVAO(null);")}function fr(De,ye){var st=De.proc("scope",3);De.batchId="a2";var Nt=De.shared,Yt=Nt.current;bo(De,st,ye.context),ye.framebuffer&&ye.framebuffer.append(De,st),_p(Object.keys(ye.state)).forEach(function(Xe){var Ct=ye.state[Xe],Pe=Ct.append(De,st);fo(Pe)?Pe.forEach(function(tt,Be){st.set(De.next[Xe],"["+Be+"]",tt)}):st.set(Nt.next,"."+Xe,Pe)}),Ii(De,st,ye,!0,!0),[wu,Of,Wc,If,ko].forEach(function(Xe){var Ct=ye.draw[Xe];!Ct||st.set(Nt.draw,"."+Xe,""+Ct.append(De,st))}),Object.keys(ye.uniforms).forEach(function(Xe){var Ct=ye.uniforms[Xe].append(De,st);Array.isArray(Ct)&&(Ct="["+Ct.join()+"]"),st.set(Nt.uniforms,"["+Me.id(Xe)+"]",Ct)}),Object.keys(ye.attributes).forEach(function(Xe){var Ct=ye.attributes[Xe].append(De,st),Pe=De.scopeAttrib(Xe);Object.keys(new kt).forEach(function(tt){st.set(Pe,"."+tt,Ct[tt])})}),ye.scopeVAO&&st.set(Nt.vao,".targetVAO",ye.scopeVAO.append(De,st));function ht(Xe){var Ct=ye.shader[Xe];Ct&&st.set(Nt.shader,"."+Xe,Ct.append(De,st))}ht(xl),ht(bl),Object.keys(ye.state).length>0&&(st(Yt,".dirty=true;"),st.exit(Yt,".dirty=true;")),st("a1(",De.shared.context,",a0,",De.batchId,");")}function Xt(De){if(!(typeof De!="object"||fo(De))){for(var ye=Object.keys(De),st=0;st<ye.length;++st)if(Dr.isDynamic(De[ye[st]]))return!0;return!1}}function Pn(De,ye,st){var Nt=ye.static[st];if(!Nt||!Xt(Nt))return;var Yt=De.global,ht=Object.keys(Nt),Xe=!1,Ct=!1,Pe=!1,tt=De.global.def("{}");ht.forEach(function(Ft){var Kt=Nt[Ft];if(Dr.isDynamic(Kt)){typeof Kt=="function"&&(Kt=Nt[Ft]=Dr.unbox(Kt));var Or=iu(Kt,null);Xe=Xe||Or.thisDep,Pe=Pe||Or.propDep,Ct=Ct||Or.contextDep}else{switch(Yt(tt,".",Ft,"="),typeof Kt){case"number":Yt(Kt);break;case"string":Yt('"',Kt,'"');break;case"object":Array.isArray(Kt)&&Yt("[",Kt.join(),"]");break;default:Yt(De.link(Kt));break}Yt(";")}});function Be(Ft,Kt){ht.forEach(function(Or){var nn=Nt[Or];if(!!Dr.isDynamic(nn)){var an=Ft.invoke(Kt,nn);Kt(tt,".",Or,"=",an,";")}})}ye.dynamic[st]=new Dr.DynamicVariable(Ro,{thisDep:Xe,contextDep:Ct,propDep:Pe,ref:tt,append:Be}),delete ye.static[st]}function qi(De,ye,st,Nt,Yt){var ht=yi();ht.stats=ht.link(Yt),Object.keys(ye.static).forEach(function(Ct){Pn(ht,ye,Ct)}),hp.forEach(function(Ct){Pn(ht,De,Ct)});var Xe=ns(De,ye,st,Nt,ht);return ma(ht,Xe),fr(ht,Xe),ze(ht,Xe),g(ht.compile(),{destroy:function(){Xe.shader.program.destroy()}})}return{next:vn,current:qr,procs:function(){var De=yi(),ye=De.proc("poll"),st=De.proc("refresh"),Nt=De.block();ye(Nt),st(Nt);var Yt=De.shared,ht=Yt.gl,Xe=Yt.next,Ct=Yt.current;Nt(Ct,".dirty=false;"),Bo(De,ye),Bo(De,st,null,!0);var Pe;Zr&&(Pe=De.link(Zr)),qe.oes_vertex_array_object&&st(De.link(qe.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var tt=0;tt<lr.maxAttributes;++tt){var Be=st.def(Yt.attributes,"[",tt,"]"),Ft=De.cond(Be,".buffer");Ft.then(ht,".enableVertexAttribArray(",tt,");",ht,".bindBuffer(",kf,",",Be,".buffer.buffer);",ht,".vertexAttribPointer(",tt,",",Be,".size,",Be,".type,",Be,".normalized,",Be,".stride,",Be,".offset);").else(ht,".disableVertexAttribArray(",tt,");",ht,".vertexAttrib4f(",tt,",",Be,".x,",Be,".y,",Be,".z,",Be,".w);",Be,".buffer=null;"),st(Ft),Zr&&st(Pe,".vertexAttribDivisorANGLE(",tt,",",Be,".divisor);")}return st(De.shared.vao,".currentVAO=null;",De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"),Object.keys(gr).forEach(function(Kt){var Or=gr[Kt],nn=Nt.def(Xe,".",Kt),an=De.block();an("if(",nn,"){",ht,".enable(",Or,")}else{",ht,".disable(",Or,")}",Ct,".",Kt,"=",nn,";"),st(an),ye("if(",nn,"!==",Ct,".",Kt,"){",an,"}")}),Object.keys(Er).forEach(function(Kt){var Or=Er[Kt],nn=qr[Kt],an,xn,$r=De.block();if($r(ht,".",Or,"("),fo(nn)){var Zn=nn.length;an=De.global.def(Xe,".",Kt),xn=De.global.def(Ct,".",Kt),$r(it(Zn,function(Cn){return an+"["+Cn+"]"}),");",it(Zn,function(Cn){return xn+"["+Cn+"]="+an+"["+Cn+"];"}).join("")),ye("if(",it(Zn,function(Cn){return an+"["+Cn+"]!=="+xn+"["+Cn+"]"}).join("||"),"){",$r,"}")}else an=Nt.def(Xe,".",Kt),xn=Nt.def(Ct,".",Kt),$r(an,");",Ct,".",Kt,"=",an,";"),ye("if(",an,"!==",xn,"){",$r,"}");st($r)}),De.compile()}(),compile:qi}}function id(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var bp=34918,zd=34919,Ep=35007,Zd=function(Z,Me){if(!Me.ext_disjoint_timer_query)return null;var qe=[];function lr(){return qe.pop()||Me.ext_disjoint_timer_query.createQueryEXT()}function Sr(Zr){qe.push(Zr)}var ar=[];function yr(Zr){var tn=lr();Me.ext_disjoint_timer_query.beginQueryEXT(Ep,tn),ar.push(tn),zr(ar.length-1,ar.length,Zr)}function Tr(){Me.ext_disjoint_timer_query.endQueryEXT(Ep)}function Fr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var wt=[];function Gr(){return wt.pop()||new Fr}function Ke(Zr){wt.push(Zr)}var on=[];function zr(Zr,tn,Ar){var qr=Gr();qr.startQueryIndex=Zr,qr.endQueryIndex=tn,qr.sum=0,qr.stats=Ar,on.push(qr)}var jr=[],kt=[];function dr(){var Zr,tn,Ar=ar.length;if(Ar!==0){kt.length=Math.max(kt.length,Ar+1),jr.length=Math.max(jr.length,Ar+1),jr[0]=0,kt[0]=0;var qr=0;for(Zr=0,tn=0;tn<ar.length;++tn){var vn=ar[tn];Me.ext_disjoint_timer_query.getQueryObjectEXT(vn,zd)?(qr+=Me.ext_disjoint_timer_query.getQueryObjectEXT(vn,bp),Sr(vn)):ar[Zr++]=vn,jr[tn+1]=qr,kt[tn+1]=Zr}for(ar.length=Zr,Zr=0,tn=0;tn<on.length;++tn){var $n=on[tn],gr=$n.startQueryIndex,Er=$n.endQueryIndex;$n.sum+=jr[Er]-jr[gr];var Fn=kt[gr],un=kt[Er];un===Fn?($n.stats.gpuTime+=$n.sum/1e6,Ke($n)):($n.startQueryIndex=Fn,$n.endQueryIndex=un,on[Zr++]=$n)}on.length=Zr}}return{beginQuery:yr,endQuery:Tr,pushScopeStats:zr,update:dr,getNumPendingQueries:function(){return ar.length},clear:function(){qe.push.apply(qe,ar);for(var Zr=0;Zr<qe.length;Zr++)Me.ext_disjoint_timer_query.deleteQueryEXT(qe[Zr]);ar.length=0,qe.length=0},restore:function(){ar.length=0,qe.length=0}}},Ud=16384,hh=256,ad=1024,of=34962,ph="webglcontextlost",Ra="webglcontextrestored",Sp=1,Wl=2,sf=3;function Zh(Z,Me){for(var qe=0;qe<Z.length;++qe)if(Z[qe]===Me)return qe;return-1}function jd(Z){var Me=Te(Z);if(!Me)return null;var qe=Me.gl,lr=qe.getContextAttributes(),Sr=qe.isContextLost(),ar=Ze(qe,Me);if(!ar)return null;var yr=na(),Tr=id(),Fr=ar.extensions,wt=Zd(qe,Fr),Gr=ta(),Ke=qe.drawingBufferWidth,on=qe.drawingBufferHeight,zr={tick:0,time:0,viewportWidth:Ke,viewportHeight:on,framebufferWidth:Ke,framebufferHeight:on,drawingBufferWidth:Ke,drawingBufferHeight:on,pixelRatio:Me.pixelRatio},jr={},kt={elements:null,primitive:4,count:-1,offset:0,instances:-1},dr=ul(qe,Fr),Zr=z(qe,Tr,Me,qr),tn=cl(qe,Fr,Zr,Tr),Ar=Wt(qe,Fr,dr,Tr,Zr,tn,kt);function qr(gi){return Ar.destroyBuffer(gi)}var vn=Jr(qe,yr,Tr,Me),$n=bs(qe,Fr,dr,function(){Fn.procs.poll()},zr,Tr,Me),gr=zl(qe,Fr,dr,Tr,Me),Er=We(qe,Fr,dr,$n,gr,Tr),Fn=nd(qe,yr,Fr,dr,Zr,tn,$n,Er,jr,Ar,vn,kt,zr,wt,Me),un=ni(qe,Er,Fn.procs.poll,zr,lr,Fr,dr),Ur=Fn.next,fn=qe.canvas,dn=[],Mi=[],yi=[],hn=[Me.onDestroy],En=null;function di(){if(dn.length===0){wt&&wt.update(),En=null;return}En=Wn.next(di),ao();for(var gi=dn.length-1;gi>=0;--gi){var Zi=dn[gi];Zi&&Zi(zr,null,0)}qe.flush(),wt&&wt.update()}function Ai(){!En&&dn.length>0&&(En=Wn.next(di))}function $i(){En&&(Wn.cancel(di),En=null)}function no(gi){gi.preventDefault(),Sr=!0,$i(),Mi.forEach(function(Zi){Zi()})}function io(gi){qe.getError(),Sr=!1,ar.restore(),vn.restore(),Zr.restore(),$n.restore(),gr.restore(),Er.restore(),Ar.restore(),wt&&wt.restore(),Fn.procs.refresh(),Ai(),yi.forEach(function(Zi){Zi()})}var Yi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Yi&&fn&&(fn.addEventListener(ph,no,!1),fn.addEventListener(Ra,io,!1));function qo(){dn.length=0,$i(),!Yi&&fn&&(fn.removeEventListener(ph,no),fn.removeEventListener(Ra,io)),vn.clear(),Er.clear(),gr.clear(),Ar.clear(),$n.clear(),tn.clear(),Zr.clear(),wt&&wt.clear(),hn.forEach(function(gi){gi()})}function Ha(gi){k(!!gi,"invalid args to regl({...})"),k.type(gi,"object","invalid args to regl({...})");function Zi(ht){var Xe=g({},ht);delete Xe.uniforms,delete Xe.attributes,delete Xe.context,delete Xe.vao,"stencil"in Xe&&Xe.stencil.op&&(Xe.stencil.opBack=Xe.stencil.opFront=Xe.stencil.op,delete Xe.stencil.op);function Ct(Pe){if(Pe in Xe){var tt=Xe[Pe];delete Xe[Pe],Object.keys(tt).forEach(function(Be){Xe[Pe+"."+Be]=tt[Be]})}}return Ct("blend"),Ct("depth"),Ct("cull"),Ct("stencil"),Ct("polygonOffset"),Ct("scissor"),Ct("sample"),"vao"in ht&&(Xe.vao=ht.vao),Xe}function ma(ht,Xe){var Ct={},Pe={};return Object.keys(ht).forEach(function(tt){var Be=ht[tt];if(Dr.isDynamic(Be)){Pe[tt]=Dr.unbox(Be,tt);return}else if(Xe&&Array.isArray(Be)){for(var Ft=0;Ft<Be.length;++Ft)if(Dr.isDynamic(Be[Ft])){Pe[tt]=Dr.unbox(Be,tt);return}}Ct[tt]=Be}),{dynamic:Pe,static:Ct}}var Di=ma(gi.context||{},!0),Ls=ma(gi.uniforms||{},!0),ze=ma(gi.attributes||{},!1),fr=ma(Zi(gi),!1),Xt={gpuTime:0,cpuTime:0,count:0},Pn=Fn.compile(fr,ze,Ls,Di,Xt),qi=Pn.draw,De=Pn.batch,ye=Pn.scope,st=[];function Nt(ht){for(;st.length<ht;)st.push(null);return st}function Yt(ht,Xe){var Ct;if(Sr&&k.raise("context lost"),typeof ht=="function")return ye.call(this,null,ht,0);if(typeof Xe=="function")if(typeof ht=="number")for(Ct=0;Ct<ht;++Ct)ye.call(this,null,Xe,Ct);else if(Array.isArray(ht))for(Ct=0;Ct<ht.length;++Ct)ye.call(this,ht[Ct],Xe,Ct);else return ye.call(this,ht,Xe,0);else if(typeof ht=="number"){if(ht>0)return De.call(this,Nt(ht|0),ht|0)}else if(Array.isArray(ht)){if(ht.length)return De.call(this,ht,ht.length)}else return qi.call(this,ht)}return g(Yt,{stats:Xt,destroy:function(){Pn.destroy()}})}var ns=Er.setFBO=Ha({framebuffer:Dr.define.call(null,Sp,"framebuffer")});function bo(gi,Zi){var ma=0;Fn.procs.poll();var Di=Zi.color;Di&&(qe.clearColor(+Di[0]||0,+Di[1]||0,+Di[2]||0,+Di[3]||0),ma|=Ud),"depth"in Zi&&(qe.clearDepth(+Zi.depth),ma|=hh),"stencil"in Zi&&(qe.clearStencil(Zi.stencil|0),ma|=ad),k(!!ma,"called regl.clear with no buffer specified"),qe.clear(ma)}function Bo(gi){if(k(typeof gi=="object"&&gi,"regl.clear() takes an object as input"),"framebuffer"in gi)if(gi.framebuffer&&gi.framebuffer_reglType==="framebufferCube")for(var Zi=0;Zi<6;++Zi)ns(g({framebuffer:gi.framebuffer.faces[Zi]},gi),bo);else ns(gi,bo);else bo(null,gi)}function Mo(gi){k.type(gi,"function","regl.frame() callback must be a function"),dn.push(gi);function Zi(){var ma=Zh(dn,gi);k(ma>=0,"cannot cancel a frame twice");function Di(){var Ls=Zh(dn,Di);dn[Ls]=dn[dn.length-1],dn.length-=1,dn.length<=0&&$i()}dn[ma]=Di}return Ai(),{cancel:Zi}}function ps(){var gi=Ur.viewport,Zi=Ur.scissor_box;gi[0]=gi[1]=Zi[0]=Zi[1]=0,zr.viewportWidth=zr.framebufferWidth=zr.drawingBufferWidth=gi[2]=Zi[2]=qe.drawingBufferWidth,zr.viewportHeight=zr.framebufferHeight=zr.drawingBufferHeight=gi[3]=Zi[3]=qe.drawingBufferHeight}function ao(){zr.tick+=1,zr.time=No(),ps(),Fn.procs.poll()}function Ii(){$n.refresh(),ps(),Fn.procs.refresh(),wt&&wt.update()}function No(){return(ta()-Gr)/1e3}Ii();function sa(gi,Zi){k.type(Zi,"function","listener callback must be a function");var ma;switch(gi){case"frame":return Mo(Zi);case"lost":ma=Mi;break;case"restore":ma=yi;break;case"destroy":ma=hn;break;default:k.raise("invalid event, must be one of frame,lost,restore,destroy")}return ma.push(Zi),{cancel:function(){for(var Di=0;Di<ma.length;++Di)if(ma[Di]===Zi){ma[Di]=ma[ma.length-1],ma.pop();return}}}}var is=g(Ha,{clear:Bo,prop:Dr.define.bind(null,Sp),context:Dr.define.bind(null,Wl),this:Dr.define.bind(null,sf),draw:Ha({}),buffer:function(gi){return Zr.create(gi,of,!1,!1)},elements:function(gi){return tn.create(gi,!1)},texture:$n.create2D,cube:$n.createCube,renderbuffer:gr.create,framebuffer:Er.create,framebufferCube:Er.createCube,vao:Ar.createVAO,attributes:lr,frame:Mo,on:sa,limits:dr,hasExtension:function(gi){return dr.extensions.indexOf(gi.toLowerCase())>=0},read:un,destroy:qo,_gl:qe,_refresh:Ii,poll:function(){ao(),wt&&wt.update()},now:No,stats:Tr});return Me.onDone(null,is),is}return jd})},77412:function(It){function ie(F,J){for(var Y=-1,g=F==null?0:F.length;++Y<g&&J(F[Y],Y,F)!==!1;);return F}It.exports=ie},47443:function(It,ie,F){var J=F(42118);function Y(g,fe){var N=g==null?0:g.length;return!!N&&J(g,fe,0)>-1}It.exports=Y},1196:function(It){function ie(F,J,Y){for(var g=-1,fe=F==null?0:F.length;++g<fe;)if(Y(J,F[g]))return!0;return!1}It.exports=ie},62663:function(It){function ie(F,J,Y,g){var fe=-1,N=F==null?0:F.length;for(g&&N&&(Y=F[++fe]);++fe<N;)Y=J(Y,F[fe],fe,F);return Y}It.exports=ie},49029:function(It){var ie=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function F(J){return J.match(ie)||[]}It.exports=F},44037:function(It,ie,F){var J=F(98363),Y=F(3674);function g(fe,N){return fe&&J(N,Y(N),fe)}It.exports=g},63886:function(It,ie,F){var J=F(98363),Y=F(81704);function g(fe,N){return fe&&J(N,Y(N),fe)}It.exports=g},29750:function(It){function ie(F,J,Y){return F===F&&(Y!==void 0&&(F=F<=Y?F:Y),J!==void 0&&(F=F>=J?F:J)),F}It.exports=ie},85990:function(It,ie,F){var J=F(46384),Y=F(77412),g=F(34865),fe=F(44037),N=F(63886),oe=F(64626),ne=F(278),we=F(18805),re=F(1911),ke=F(58234),Ve=F(46904),Ne=F(64160),Je=F(43824),Jt=F(29148),_t=F(38517),Ut=F(1469),Tt=F(44144),vt=F(56688),pt=F(13218),Vt=F(72928),ee=F(3674),rr=F(81704),At=1,nt=2,Zt=4,ut="[object Arguments]",nr="[object Array]",Mr="[object Boolean]",q="[object Date]",pe="[object Error]",b="[object Function]",le="[object GeneratorFunction]",xe="[object Map]",Qe="[object Number]",xt="[object Object]",Bt="[object RegExp]",Fe="[object Set]",bt="[object String]",br="[object Symbol]",mr="[object WeakMap]",An="[object ArrayBuffer]",mn="[object DataView]",wn="[object Float32Array]",Ri="[object Float64Array]",Qn="[object Int8Array]",ii="[object Int16Array]",Vi="[object Int32Array]",Ni="[object Uint8Array]",ai="[object Uint8ClampedArray]",Vn="[object Uint16Array]",Yn="[object Uint32Array]",Li={};Li[ut]=Li[nr]=Li[An]=Li[mn]=Li[Mr]=Li[q]=Li[wn]=Li[Ri]=Li[Qn]=Li[ii]=Li[Vi]=Li[xe]=Li[Qe]=Li[xt]=Li[Bt]=Li[Fe]=Li[bt]=Li[br]=Li[Ni]=Li[ai]=Li[Vn]=Li[Yn]=!0,Li[pe]=Li[b]=Li[mr]=!1;function ra(ri,Et,de,V,X,k){var Ce,et=Et&At,Qt=Et&nt,Oe=Et&Zt;if(de&&(Ce=X?de(ri,V,X,k):de(ri)),Ce!==void 0)return Ce;if(!pt(ri))return ri;var $e=Ut(ri);if($e){if(Ce=Je(ri),!et)return ne(ri,Ce)}else{var Ht=Ne(ri),or=Ht==b||Ht==le;if(Tt(ri))return oe(ri,et);if(Ht==xt||Ht==ut||or&&!X){if(Ce=Qt||or?{}:_t(ri),!et)return Qt?re(ri,N(Ce,ri)):we(ri,fe(Ce,ri))}else{if(!Li[Ht])return X?ri:{};Ce=Jt(ri,Ht,et)}}k||(k=new J);var pr=k.get(ri);if(pr)return pr;k.set(ri,Ce),Vt(ri)?ri.forEach(function(en){Ce.add(ra(en,Et,de,en,ri,k))}):vt(ri)&&ri.forEach(function(en,Dr){Ce.set(Dr,ra(en,Et,de,Dr,ri,k))});var xr=Oe?Qt?Ve:ke:Qt?rr:ee,Qr=$e?void 0:xr(ri);return Y(Qr||ri,function(en,Dr){Qr&&(Dr=en,en=ri[Dr]),g(Ce,Dr,ra(en,Et,de,Dr,ri,k))}),Ce}It.exports=ra},41848:function(It){function ie(F,J,Y,g){for(var fe=F.length,N=Y+(g?1:-1);g?N--:++N<fe;)if(J(F[N],N,F))return N;return-1}It.exports=ie},42118:function(It,ie,F){var J=F(41848),Y=F(62722),g=F(42351);function fe(N,oe,ne){return oe===oe?g(N,oe,ne):J(N,Y,ne)}It.exports=fe},25588:function(It,ie,F){var J=F(64160),Y=F(37005),g="[object Map]";function fe(N){return Y(N)&&J(N)==g}It.exports=fe},62722:function(It){function ie(F){return F!==F}It.exports=ie},29221:function(It,ie,F){var J=F(64160),Y=F(37005),g="[object Set]";function fe(N){return Y(N)&&J(N)==g}It.exports=fe},40371:function(It){function ie(F){return function(J){return J==null?void 0:J[F]}}It.exports=ie},18674:function(It){function ie(F){return function(J){return F==null?void 0:F[J]}}It.exports=ie},45652:function(It,ie,F){var J=F(88668),Y=F(47443),g=F(1196),fe=F(74757),N=F(23593),oe=F(21814),ne=200;function we(re,ke,Ve){var Ne=-1,Je=Y,Jt=re.length,_t=!0,Ut=[],Tt=Ut;if(Ve)_t=!1,Je=g;else if(Jt>=ne){var vt=ke?null:N(re);if(vt)return oe(vt);_t=!1,Je=fe,Tt=new J}else Tt=ke?[]:Ut;e:for(;++Ne<Jt;){var pt=re[Ne],Vt=ke?ke(pt):pt;if(pt=Ve||pt!==0?pt:0,_t&&Vt===Vt){for(var ee=Tt.length;ee--;)if(Tt[ee]===Vt)continue e;ke&&Tt.push(Vt),Ut.push(pt)}else Je(Tt,Vt,Ve)||(Tt!==Ut&&Tt.push(Vt),Ut.push(pt))}return Ut}It.exports=we},57157:function(It,ie,F){var J=F(74318);function Y(g,fe){var N=fe?J(g.buffer):g.buffer;return new g.constructor(N,g.byteOffset,g.byteLength)}It.exports=Y},93147:function(It){var ie=/\w*$/;function F(J){var Y=new J.constructor(J.source,ie.exec(J));return Y.lastIndex=J.lastIndex,Y}It.exports=F},40419:function(It,ie,F){var J=F(62705),Y=J?J.prototype:void 0,g=Y?Y.valueOf:void 0;function fe(N){return g?Object(g.call(N)):{}}It.exports=fe},18805:function(It,ie,F){var J=F(98363),Y=F(99551);function g(fe,N){return J(fe,Y(fe),N)}It.exports=g},1911:function(It,ie,F){var J=F(98363),Y=F(51442);function g(fe,N){return J(fe,Y(fe),N)}It.exports=g},98805:function(It,ie,F){var J=F(40180),Y=F(62689),g=F(83140),fe=F(79833);function N(oe){return function(ne){ne=fe(ne);var we=Y(ne)?g(ne):void 0,re=we?we[0]:ne.charAt(0),ke=we?J(we,1).join(""):ne.slice(1);return re[oe]()+ke}}It.exports=N},35393:function(It,ie,F){var J=F(62663),Y=F(53816),g=F(58748),fe="['\u2019]",N=RegExp(fe,"g");function oe(ne){return function(we){return J(g(Y(we).replace(N,"")),ne,"")}}It.exports=oe},23593:function(It,ie,F){var J=F(58525),Y=F(50308),g=F(21814),fe=1/0,N=J&&1/g(new J([,-0]))[1]==fe?function(oe){return new J(oe)}:Y;It.exports=N},69389:function(It,ie,F){var J=F(18674),Y={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},g=J(Y);It.exports=g},46904:function(It,ie,F){var J=F(68866),Y=F(51442),g=F(81704);function fe(N){return J(N,g,Y)}It.exports=fe},51442:function(It,ie,F){var J=F(62488),Y=F(85924),g=F(99551),fe=F(70479),N=Object.getOwnPropertySymbols,oe=N?function(ne){for(var we=[];ne;)J(we,g(ne)),ne=Y(ne);return we}:fe;It.exports=oe},93157:function(It){var ie=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function F(J){return ie.test(J)}It.exports=F},43824:function(It){var ie=Object.prototype,F=ie.hasOwnProperty;function J(Y){var g=Y.length,fe=new Y.constructor(g);return g&&typeof Y[0]=="string"&&F.call(Y,"index")&&(fe.index=Y.index,fe.input=Y.input),fe}It.exports=J},29148:function(It,ie,F){var J=F(74318),Y=F(57157),g=F(93147),fe=F(40419),N=F(77133),oe="[object Boolean]",ne="[object Date]",we="[object Map]",re="[object Number]",ke="[object RegExp]",Ve="[object Set]",Ne="[object String]",Je="[object Symbol]",Jt="[object ArrayBuffer]",_t="[object DataView]",Ut="[object Float32Array]",Tt="[object Float64Array]",vt="[object Int8Array]",pt="[object Int16Array]",Vt="[object Int32Array]",ee="[object Uint8Array]",rr="[object Uint8ClampedArray]",At="[object Uint16Array]",nt="[object Uint32Array]";function Zt(ut,nr,Mr){var q=ut.constructor;switch(nr){case Jt:return J(ut);case oe:case ne:return new q(+ut);case _t:return Y(ut,Mr);case Ut:case Tt:case vt:case pt:case Vt:case ee:case rr:case At:case nt:return N(ut,Mr);case we:return new q;case re:case Ne:return new q(ut);case ke:return g(ut);case Ve:return new q;case Je:return fe(ut)}}It.exports=Zt},42351:function(It){function ie(F,J,Y){for(var g=Y-1,fe=F.length;++g<fe;)if(F[g]===J)return g;return-1}It.exports=ie},2757:function(It){var ie="\\ud800-\\udfff",F="\\u0300-\\u036f",J="\\ufe20-\\ufe2f",Y="\\u20d0-\\u20ff",g=F+J+Y,fe="\\u2700-\\u27bf",N="a-z\\xdf-\\xf6\\xf8-\\xff",oe="\\xac\\xb1\\xd7\\xf7",ne="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",we="\\u2000-\\u206f",re=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ke="A-Z\\xc0-\\xd6\\xd8-\\xde",Ve="\\ufe0e\\ufe0f",Ne=oe+ne+we+re,Je="['\u2019]",Jt="["+Ne+"]",_t="["+g+"]",Ut="\\d+",Tt="["+fe+"]",vt="["+N+"]",pt="[^"+ie+Ne+Ut+fe+N+ke+"]",Vt="\\ud83c[\\udffb-\\udfff]",ee="(?:"+_t+"|"+Vt+")",rr="[^"+ie+"]",At="(?:\\ud83c[\\udde6-\\uddff]){2}",nt="[\\ud800-\\udbff][\\udc00-\\udfff]",Zt="["+ke+"]",ut="\\u200d",nr="(?:"+vt+"|"+pt+")",Mr="(?:"+Zt+"|"+pt+")",q="(?:"+Je+"(?:d|ll|m|re|s|t|ve))?",pe="(?:"+Je+"(?:D|LL|M|RE|S|T|VE))?",b=ee+"?",le="["+Ve+"]?",xe="(?:"+ut+"(?:"+[rr,At,nt].join("|")+")"+le+b+")*",Qe="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",xt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Bt=le+b+xe,Fe="(?:"+[Tt,At,nt].join("|")+")"+Bt,bt=RegExp([Zt+"?"+vt+"+"+q+"(?="+[Jt,Zt,"$"].join("|")+")",Mr+"+"+pe+"(?="+[Jt,Zt+nr,"$"].join("|")+")",Zt+"?"+nr+"+"+q,Zt+"+"+pe,xt,Qe,Ut,Fe].join("|"),"g");function br(mr){return mr.match(bt)||[]}It.exports=br},68929:function(It,ie,F){var J=F(48403),Y=F(35393),g=Y(function(fe,N,oe){return N=N.toLowerCase(),fe+(oe?J(N):N)});It.exports=g},48403:function(It,ie,F){var J=F(79833),Y=F(11700);function g(fe){return Y(J(fe).toLowerCase())}It.exports=g},74691:function(It,ie,F){var J=F(29750),Y=F(14841);function g(fe,N,oe){return oe===void 0&&(oe=N,N=void 0),oe!==void 0&&(oe=Y(oe),oe=oe===oe?oe:0),N!==void 0&&(N=Y(N),N=N===N?N:0),J(Y(fe),N,oe)}It.exports=g},50361:function(It,ie,F){var J=F(85990),Y=1,g=4;function fe(N){return J(N,Y|g)}It.exports=fe},53816:function(It,ie,F){var J=F(69389),Y=F(79833),g=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,fe="\\u0300-\\u036f",N="\\ufe20-\\ufe2f",oe="\\u20d0-\\u20ff",ne=fe+N+oe,we="["+ne+"]",re=RegExp(we,"g");function ke(Ve){return Ve=Y(Ve),Ve&&Ve.replace(g,J).replace(re,"")}It.exports=ke},56688:function(It,ie,F){var J=F(25588),Y=F(7518),g=F(31167),fe=g&&g.isMap,N=fe?Y(fe):J;It.exports=N},14293:function(It){function ie(F){return F==null}It.exports=ie},81763:function(It,ie,F){var J=F(44239),Y=F(37005),g="[object Number]";function fe(N){return typeof N=="number"||Y(N)&&J(N)==g}It.exports=fe},72928:function(It,ie,F){var J=F(29221),Y=F(7518),g=F(31167),fe=g&&g.isSet,N=fe?Y(fe):J;It.exports=N},47037:function(It,ie,F){var J=F(44239),Y=F(1469),g=F(37005),fe="[object String]";function N(oe){return typeof oe=="string"||!Y(oe)&&g(oe)&&J(oe)==fe}It.exports=N},52353:function(It){function ie(F){return F===void 0}It.exports=ie},30236:function(It,ie,F){var J=F(42980),Y=F(21463),g=Y(function(fe,N,oe,ne){J(fe,N,oe,ne)});It.exports=g},50308:function(It){function ie(){}It.exports=ie},44908:function(It,ie,F){var J=F(45652);function Y(g){return g&&g.length?J(g):[]}It.exports=Y},11700:function(It,ie,F){var J=F(98805),Y=J("toUpperCase");It.exports=Y},58748:function(It,ie,F){var J=F(49029),Y=F(93157),g=F(79833),fe=F(2757);function N(oe,ne,we){return oe=g(oe),ne=we?void 0:ne,ne===void 0?Y(oe)?fe(oe):J(oe):oe.match(ne)||[]}It.exports=N},6158:function(It){(function(ie,F){It.exports=F()})(this,function(){"use strict";var ie,F,J;function Y(g,fe){if(!ie)ie=fe;else if(!F)F=fe;else{var N="var sharedChunk = {}; ("+ie+")(sharedChunk); ("+F+")(sharedChunk);",oe={};ie(oe),J=fe(oe),typeof window!="undefined"&&(J.workerUrl=window.URL.createObjectURL(new Blob([N],{type:"text/javascript"})))}}return Y(["exports"],function(g){"use strict";function fe(n,o){return n(o={exports:{}},o.exports),o.exports}var N=oe;function oe(n,o,u,p){this.cx=3*n,this.bx=3*(u-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=p,this.p2x=u,this.p2y=p}oe.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n},oe.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n},oe.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},oe.prototype.solveCurveX=function(n,o){var u,p,_,E,A;for(o===void 0&&(o=1e-6),_=n,A=0;A<8;A++){if(E=this.sampleCurveX(_)-n,Math.abs(E)<o)return _;var O=this.sampleCurveDerivativeX(_);if(Math.abs(O)<1e-6)break;_-=E/O}if((_=n)<(u=0))return u;if(_>(p=1))return p;for(;u<p;){if(E=this.sampleCurveX(_),Math.abs(E-n)<o)return _;n>E?u=_:p=_,_=.5*(p-u)+u}return _},oe.prototype.solve=function(n,o){return this.sampleCurveY(this.solveCurveX(n,o))};var ne=we;function we(n,o){this.x=n,this.y=o}we.prototype={clone:function(){return new we(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,o){return this.clone()._rotateAround(n,o)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var o=n.x-this.x,u=n.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,o){return Math.atan2(this.x*o-this.y*n,this.x*n+this.y*o)},_matMult:function(n){var o=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=o,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var o=Math.cos(n),u=Math.sin(n),p=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=p,this},_rotateAround:function(n,o){var u=Math.cos(n),p=Math.sin(n),_=o.y+p*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-p*(this.y-o.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},we.convert=function(n){return n instanceof we?n:Array.isArray(n)?new we(n[0],n[1]):n};var re=typeof self!="undefined"?self:{},ke=Math.pow(2,53)-1;function Ve(n,o,u,p){var _=new N(n,o,u,p);return function(E){return _.solve(E)}}var Ne=Ve(.25,.1,.25,1);function Je(n,o,u){return Math.min(u,Math.max(o,n))}function Jt(n,o,u){var p=u-o,_=((n-o)%p+p)%p+o;return _===o?u:_}function _t(n){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,_=o;p<_.length;p+=1){var E=_[p];for(var A in E)n[A]=E[A]}return n}var Ut=1;function Tt(){return Ut++}function vt(){return function n(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()}function pt(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)}function Vt(n,o){n.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function ee(n,o){return n.indexOf(o,n.length-o.length)!==-1}function rr(n,o,u){var p={};for(var _ in n)p[_]=o.call(u||this,n[_],_,n);return p}function At(n,o,u){var p={};for(var _ in n)o.call(u||this,n[_],_,n)&&(p[_]=n[_]);return p}function nt(n){return Array.isArray(n)?n.map(nt):typeof n=="object"&&n?rr(n,nt):n}var Zt={};function ut(n){Zt[n]||(typeof console!="undefined"&&console.warn(n),Zt[n]=!0)}function nr(n,o,u){return(u.y-n.y)*(o.x-n.x)>(o.y-n.y)*(u.x-n.x)}function Mr(n){for(var o=0,u=0,p=n.length,_=p-1,E=void 0,A=void 0;u<p;_=u++)o+=((A=n[_]).x-(E=n[u]).x)*(E.y+A.y);return o}function q(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function pe(n){var o={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,_,E,A){var O=E||A;return o[_]=!O||O.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var b=null;function le(n){if(b==null){var o=n.navigator?n.navigator.userAgent:null;b=!!n.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return b}function xe(n){try{var o=re[n];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var Qe,xt,Bt,Fe,bt=re.performance&&re.performance.now?re.performance.now.bind(re.performance):Date.now.bind(Date),br=re.requestAnimationFrame||re.mozRequestAnimationFrame||re.webkitRequestAnimationFrame||re.msRequestAnimationFrame,mr=re.cancelAnimationFrame||re.mozCancelAnimationFrame||re.webkitCancelAnimationFrame||re.msCancelAnimationFrame,An={now:bt,frame:function(n){var o=br(n);return{cancel:function(){return mr(o)}}},getImageData:function(n,o){o===void 0&&(o=0);var u=re.document.createElement("canvas"),p=u.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return u.width=n.width,u.height=n.height,p.drawImage(n,0,0,n.width,n.height),p.getImageData(-o,-o,n.width+2*o,n.height+2*o)},resolveURL:function(n){return Qe||(Qe=re.document.createElement("a")),Qe.href=n,Qe.href},hardwareConcurrency:re.navigator&&re.navigator.hardwareConcurrency||4,get devicePixelRatio(){return re.devicePixelRatio},get prefersReducedMotion(){return!!re.matchMedia&&(xt==null&&(xt=re.matchMedia("(prefers-reduced-motion: reduce)")),xt.matches)}},mn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},wn={supported:!1,testSupport:function(n){!Ri&&Fe&&(Qn?ii(n):Bt=n)}},Ri=!1,Qn=!1;function ii(n){var o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,Fe),n.isContextLost())return;wn.supported=!0}catch(u){}n.deleteTexture(o),Ri=!0}re.document&&((Fe=re.document.createElement("img")).onload=function(){Bt&&ii(Bt),Bt=null,Qn=!0},Fe.onerror=function(){Ri=!0,Bt=null},Fe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Vi="01",Ni=function(n,o){this._transformRequestFn=n,this._customAccessToken=o,this._createSkuToken()};function ai(n){return n.indexOf("mapbox:")===0}Ni.prototype._createSkuToken=function(){var n=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Vi,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt},Ni.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ni.prototype.transformRequest=function(n,o){return this._transformRequestFn&&this._transformRequestFn(n,o)||{url:n}},Ni.prototype.normalizeStyleURL=function(n,o){if(!ai(n))return n;var u=ra(n);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Ni.prototype.normalizeGlyphsURL=function(n,o){if(!ai(n))return n;var u=ra(n);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Ni.prototype.normalizeSourceURL=function(n,o){if(!ai(n))return n;var u=ra(n);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Ni.prototype.normalizeSpriteURL=function(n,o,u,p){var _=ra(n);return ai(n)?(_.path="/styles/v1"+_.path+"/sprite"+o+u,this._makeAPIURL(_,this._customAccessToken||p)):(_.path+=""+o+u,ri(_))},Ni.prototype.normalizeTileURL=function(n,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!ai(n))return n;var u=ra(n);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(An.devicePixelRatio>=2||o===512?"@2x":"")+(wn.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var p=this._customAccessToken||function(_){for(var E=0,A=_;E<A.length;E+=1){var O=A[E].match(/^access_token=(.*)$/);if(O)return O[1]}return null}(u.params)||mn.ACCESS_TOKEN;return mn.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,p)},Ni.prototype.canonicalizeTileURL=function(n,o){var u=ra(n);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return n;var p="mapbox://tiles/";p+=u.path.replace("/v4/","");var _=u.params;return o&&(_=_.filter(function(E){return!E.match(/^access_token=/)})),_.length&&(p+="?"+_.join("&")),p},Ni.prototype.canonicalizeTileset=function(n,o){for(var u=!!o&&ai(o),p=[],_=0,E=n.tiles||[];_<E.length;_+=1){var A=E[_];Yn(A)?p.push(this.canonicalizeTileURL(A,u)):p.push(A)}return p},Ni.prototype._makeAPIURL=function(n,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=ra(mn.API_URL);if(n.protocol=p.protocol,n.authority=p.authority,n.protocol==="http"){var _=n.params.indexOf("secure");_>=0&&n.params.splice(_,1)}if(p.path!=="/"&&(n.path=""+p.path+n.path),!mn.REQUIRE_ACCESS_TOKEN)return ri(n);if(!(o=o||mn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return n.params=n.params.filter(function(E){return E.indexOf("access_token")===-1}),n.params.push("access_token="+o),ri(n)};var Vn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Yn(n){return Vn.test(n)}var Li=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ra(n){var o=n.match(Li);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function ri(n){var o=n.params.length?"?"+n.params.join("&"):"";return n.protocol+"://"+n.authority+n.path+o}function Et(n){if(!n)return null;var o=n.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(re.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var de=function(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};de.prototype.getStorageKey=function(n){var o,u=Et(mn.ACCESS_TOKEN);return o=u&&u.u?re.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(p,_){return String.fromCharCode(Number("0x"+_))})):mn.ACCESS_TOKEN||"",n?"mapbox.eventData."+n+":"+o:"mapbox.eventData:"+o},de.prototype.fetchEventData=function(){var n=xe("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(n)try{var p=re.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));var _=re.localStorage.getItem(u);_&&(this.anonId=_)}catch(E){ut("Unable to read from LocalStorage")}},de.prototype.saveEventData=function(){var n=xe("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(n)try{re.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&re.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){ut("Unable to write to LocalStorage")}},de.prototype.processRequests=function(n){},de.prototype.postEvent=function(n,o,u,p){var _=this;if(mn.EVENTS_URL){var E=ra(mn.EVENTS_URL);E.params.push("access_token="+(p||mn.ACCESS_TOKEN||""));var A={event:this.type,created:new Date(n).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Vi,userId:this.anonId},O=o?_t(A,o):A,B={url:ri(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([O])};this.pendingRequest=Ki(B,function(j){_.pendingRequest=null,u(j),_.saveEventData(),_.processRequests(p)})}},de.prototype.queueRequest=function(n,o){this.queue.push(n),this.processRequests(o)};var V,X,k=function(n){function o(){n.call(this,"map.load"),this.success={},this.skuToken=""}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,p,_,E){this.skuToken=_,(mn.EVENTS_URL&&E||mn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(A){return ai(A)||Yn(A)}))&&this.queueRequest({id:p,timestamp:Date.now()},E)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),E=_.id,A=_.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),pt(this.anonId)||(this.anonId=vt()),this.postEvent(A,{skuToken:this.skuToken},function(O){O||E&&(p.success[E]=!0)},u))}},o}(de),Ce=new(function(n){function o(u){n.call(this,"appUserTurnstile"),this._customAccessToken=u}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,p){mn.EVENTS_URL&&mn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(_){return ai(_)||Yn(_)})&&this.queueRequest(Date.now(),p)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=Et(mn.ACCESS_TOKEN),E=_?_.u:mn.ACCESS_TOKEN,A=E!==this.eventData.tokenU;pt(this.anonId)||(this.anonId=vt(),A=!0);var O=this.queue.shift();if(this.eventData.lastSuccess){var B=new Date(this.eventData.lastSuccess),j=new Date(O),H=(O-this.eventData.lastSuccess)/864e5;A=A||H>=1||H<-1||B.getDate()!==j.getDate()}else A=!0;if(!A)return this.processRequests();this.postEvent(O,{"enabled.telemetry":!1},function(te){te||(p.eventData.lastSuccess=O,p.eventData.tokenU=E)},u)}},o}(de)),et=Ce.postTurnstileEvent.bind(Ce),Qt=new k,Oe=Qt.postMapLoadEvent.bind(Qt),$e=500,Ht=50;function or(){re.caches&&!V&&(V=re.caches.open("mapbox-tiles"))}function pr(n){var o=n.indexOf("?");return o<0?n:n.slice(0,o)}var xr,Qr=1/0;function en(){return xr==null&&(xr=re.OffscreenCanvas&&new re.OffscreenCanvas(1,1).getContext("2d")&&typeof re.createImageBitmap=="function"),xr}var Dr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Dr);var Wn=function(n){function o(u,p,_){p===401&&Yn(_)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),n.call(this,u),this.status=p,this.url=_,this.name=this.constructor.name,this.message=u}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),qn=q()?function(){return self.worker&&self.worker.referrer}:function(){return(re.location.protocol==="blob:"?re.parent:re).location.href},ta,na,ba=function(n,o){if(!(/^file:/.test(u=n.url)||/^file:/.test(qn())&&!/^\w+:/.test(u))){if(re.fetch&&re.Request&&re.AbortController&&re.Request.prototype.hasOwnProperty("signal"))return function(p,_){var E,A=new re.AbortController,O=new re.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:qn(),signal:A.signal}),B=!1,j=!1,H=(E=O.url).indexOf("sku=")>0&&Yn(E);p.type==="json"&&O.headers.set("Accept","application/json");var te=function(_e,Ue,He){if(!j){if(_e&&_e.message!=="SecurityError"&&ut(_e),Ue&&He)return ce(Ue);var ft=Date.now();re.fetch(O).then(function(rt){if(rt.ok){var Lt=H?rt.clone():null;return ce(rt,Lt,ft)}return _(new Wn(rt.statusText,rt.status,p.url))}).catch(function(rt){rt.code!==20&&_(new Error(rt.message))})}},ce=function(_e,Ue,He){(p.type==="arrayBuffer"?_e.arrayBuffer():p.type==="json"?_e.json():_e.text()).then(function(ft){j||(Ue&&He&&function(rt,Lt,$t){if(or(),V){var Mt={status:Lt.status,statusText:Lt.statusText,headers:new re.Headers};Lt.headers.forEach(function(Cr,Xr){return Mt.headers.set(Xr,Cr)});var Pt=pe(Lt.headers.get("Cache-Control")||"");Pt["no-store"]||(Pt["max-age"]&&Mt.headers.set("Expires",new Date($t+1e3*Pt["max-age"]).toUTCString()),new Date(Mt.headers.get("Expires")).getTime()-$t<42e4||function(Cr,Xr){if(X===void 0)try{new Response(new ReadableStream),X=!0}catch(pn){X=!1}X?Xr(Cr.body):Cr.blob().then(Xr)}(Lt,function(Cr){var Xr=new re.Response(Cr,Mt);or(),V&&V.then(function(pn){return pn.put(pr(rt.url),Xr)}).catch(function(pn){return ut(pn.message)})}))}}(O,Ue,He),B=!0,_(null,ft,_e.headers.get("Cache-Control"),_e.headers.get("Expires")))}).catch(function(ft){j||_(new Error(ft.message))})};return H?function(_e,Ue){if(or(),!V)return Ue(null);var He=pr(_e.url);V.then(function(ft){ft.match(He).then(function(rt){var Lt=function($t){if(!$t)return!1;var Mt=new Date($t.headers.get("Expires")||0),Pt=pe($t.headers.get("Cache-Control")||"");return Mt>Date.now()&&!Pt["no-cache"]}(rt);ft.delete(He),Lt&&ft.put(He,rt.clone()),Ue(null,rt,Lt)}).catch(Ue)}).catch(Ue)}(O,te):te(null,null),{cancel:function(){j=!0,B||A.abort()}}}(n,o);if(q()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,o,void 0,!0)}var u;return function(p,_){var E=new re.XMLHttpRequest;for(var A in E.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(E.responseType="arraybuffer"),p.headers)E.setRequestHeader(A,p.headers[A]);return p.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=p.credentials==="include",E.onerror=function(){_(new Error(E.statusText))},E.onload=function(){if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){var O=E.response;if(p.type==="json")try{O=JSON.parse(E.response)}catch(B){return _(B)}_(null,O,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else _(new Wn(E.statusText,E.status,p.url))},E.send(p.body),{cancel:function(){return E.abort()}}}(n,o)},ia=function(n,o){return ba(_t(n,{type:"arrayBuffer"}),o)},Ki=function(n,o){return ba(_t(n,{method:"POST"}),o)},$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ta=[],na=0;var ue=function(n,o){if(wn.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),na>=mn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:n,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return ta.push(u),u}na++;var p=!1,_=function(){if(!p)for(p=!0,na--;ta.length&&na<mn.MAX_PARALLEL_IMAGE_REQUESTS;){var A=ta.shift();A.cancelled||(A.cancel=ue(A.requestParameters,A.callback).cancel)}},E=ia(n,function(A,O,B,j){_(),A?o(A):O&&(en()?function(H,te){var ce=new re.Blob([new Uint8Array(H)],{type:"image/png"});re.createImageBitmap(ce).then(function(_e){te(null,_e)}).catch(function(_e){te(new Error("Could not load image because of "+_e.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(O,o):function(H,te,ce,_e){var Ue=new re.Image,He=re.URL;Ue.onload=function(){te(null,Ue),He.revokeObjectURL(Ue.src),Ue.onload=null,re.requestAnimationFrame(function(){Ue.src=$})},Ue.onerror=function(){return te(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ft=new re.Blob([new Uint8Array(H)],{type:"image/png"});Ue.cacheControl=ce,Ue.expires=_e,Ue.src=H.byteLength?He.createObjectURL(ft):$}(O,o,B,j))});return{cancel:function(){E.cancel(),_()}}};function ve(n,o,u){u[n]&&u[n].indexOf(o)!==-1||(u[n]=u[n]||[],u[n].push(o))}function Te(n,o,u){if(u&&u[n]){var p=u[n].indexOf(o);p!==-1&&u[n].splice(p,1)}}var Ze=function(n,o){o===void 0&&(o={}),_t(this,o),this.type=n},it=function(n){function o(u,p){p===void 0&&(p={}),n.call(this,"error",_t({error:u},p))}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(Ze),gt=function(){};gt.prototype.on=function(n,o){return this._listeners=this._listeners||{},ve(n,o,this._listeners),this},gt.prototype.off=function(n,o){return Te(n,o,this._listeners),Te(n,o,this._oneTimeListeners),this},gt.prototype.once=function(n,o){return this._oneTimeListeners=this._oneTimeListeners||{},ve(n,o,this._oneTimeListeners),this},gt.prototype.fire=function(n,o){typeof n=="string"&&(n=new Ze(n,o||{}));var u=n.type;if(this.listens(u)){n.target=this;for(var p=0,_=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];p<_.length;p+=1)_[p].call(this,n);for(var E=0,A=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];E<A.length;E+=1){var O=A[E];Te(u,O,this._oneTimeListeners),O.call(this,n)}var B=this._eventedParent;B&&(_t(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),B.fire(n))}else n instanceof it&&console.error(n.error);return this},gt.prototype.listens=function(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)},gt.prototype.setEventedParent=function(n,o){return this._eventedParent=n,this._eventedParentData=o,this};var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ye=function(n,o,u,p){this.message=(n?n+": ":"")+u,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)};function jt(n){var o=n.value;return o?[new Ye(n.key,o,"constants have been deprecated as of v8")]:[]}function Ir(n){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,_=o;p<_.length;p+=1){var E=_[p];for(var A in E)n[A]=E[A]}return n}function sr(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function cr(n){if(Array.isArray(n))return n.map(cr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){var o={};for(var u in n)o[u]=cr(n[u]);return o}return sr(n)}var Rr=function(n){function o(u,p){n.call(this,p),this.message=p,this.key=u}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(Error),zn=function(n,o){o===void 0&&(o=[]),this.parent=n,this.bindings={};for(var u=0,p=o;u<p.length;u+=1){var _=p[u];this.bindings[_[0]]=_[1]}};zn.prototype.concat=function(n){return new zn(this,n)},zn.prototype.get=function(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(n+" not found in scope.")},zn.prototype.has=function(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)};var Tn={kind:"null"},tr={kind:"number"},_n={kind:"string"},rn={kind:"boolean"},cn={kind:"color"},wi={kind:"object"},gn={kind:"value"},zi={kind:"collator"},ca={kind:"formatted"},sn={kind:"resolvedImage"};function ki(n,o){return{kind:"array",itemType:n,N:o}}function Pi(n){if(n.kind==="array"){var o=Pi(n.itemType);return typeof n.N=="number"?"array<"+o+", "+n.N+">":n.itemType.kind==="value"?"array":"array<"+o+">"}return n.kind}var vi=[Tn,tr,_n,rn,cn,ca,wi,ki(gn),sn];function Ji(n,o){if(o.kind==="error")return null;if(n.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Ji(n.itemType,o.itemType))&&(typeof n.N!="number"||n.N===o.N))return null}else{if(n.kind===o.kind)return null;if(n.kind==="value"){for(var u=0,p=vi;u<p.length;u+=1)if(!Ji(p[u],o))return null}}return"Expected "+Pi(n)+" but found "+Pi(o)+" instead."}function qt(n,o){return o.some(function(u){return u.kind===n.kind})}function Gt(n,o){return o.some(function(u){return u==="null"?n===null:u==="array"?Array.isArray(n):u==="object"?n&&!Array.isArray(n)&&typeof n=="object":u===typeof n})}var ji=fe(function(n,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(O){return(O=Math.round(O))<0?0:O>255?255:O}function _(O){return p(O[O.length-1]==="%"?parseFloat(O)/100*255:parseInt(O))}function E(O){return(B=O[O.length-1]==="%"?parseFloat(O)/100:parseFloat(O))<0?0:B>1?1:B;var B}function A(O,B,j){return j<0?j+=1:j>1&&(j-=1),6*j<1?O+(B-O)*j*6:2*j<1?B:3*j<2?O+(B-O)*(2/3-j)*6:O}try{o.parseCSSColor=function(O){var B,j=O.replace(/ /g,"").toLowerCase();if(j in u)return u[j].slice();if(j[0]==="#")return j.length===4?(B=parseInt(j.substr(1),16))>=0&&B<=4095?[(3840&B)>>4|(3840&B)>>8,240&B|(240&B)>>4,15&B|(15&B)<<4,1]:null:j.length===7&&(B=parseInt(j.substr(1),16))>=0&&B<=16777215?[(16711680&B)>>16,(65280&B)>>8,255&B,1]:null;var H=j.indexOf("("),te=j.indexOf(")");if(H!==-1&&te+1===j.length){var ce=j.substr(0,H),_e=j.substr(H+1,te-(H+1)).split(","),Ue=1;switch(ce){case"rgba":if(_e.length!==4)return null;Ue=E(_e.pop());case"rgb":return _e.length!==3?null:[_(_e[0]),_(_e[1]),_(_e[2]),Ue];case"hsla":if(_e.length!==4)return null;Ue=E(_e.pop());case"hsl":if(_e.length!==3)return null;var He=(parseFloat(_e[0])%360+360)%360/360,ft=E(_e[1]),rt=E(_e[2]),Lt=rt<=.5?rt*(ft+1):rt+ft-rt*ft,$t=2*rt-Lt;return[p(255*A($t,Lt,He+1/3)),p(255*A($t,Lt,He)),p(255*A($t,Lt,He-1/3)),Ue];default:return null}}return null}}catch(O){}}).parseCSSColor,Hi=function(n,o,u,p){p===void 0&&(p=1),this.r=n,this.g=o,this.b=u,this.a=p};Hi.parse=function(n){if(n){if(n instanceof Hi)return n;if(typeof n=="string"){var o=ji(n);if(o)return new Hi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Hi.prototype.toString=function(){var n=this.toArray(),o=n[1],u=n[2],p=n[3];return"rgba("+Math.round(n[0])+","+Math.round(o)+","+Math.round(u)+","+p+")"},Hi.prototype.toArray=function(){var n=this.a;return n===0?[0,0,0,0]:[255*this.r/n,255*this.g/n,255*this.b/n,n]},Hi.black=new Hi(0,0,0,1),Hi.white=new Hi(1,1,1,1),Hi.transparent=new Hi(0,0,0,0),Hi.red=new Hi(1,0,0,1);var Pa=function(n,o,u){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Pa.prototype.compare=function(n,o){return this.collator.compare(n,o)},Pa.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var so=function(n,o,u,p,_){this.text=n,this.image=o,this.scale=u,this.fontStack=p,this.textColor=_},Fa=function(n){this.sections=n};Fa.fromString=function(n){return new Fa([new so(n,null,null,null,null)])},Fa.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(n){return n.text.length!==0||n.image&&n.image.name.length!==0})},Fa.factory=function(n){return n instanceof Fa?n:Fa.fromString(n)},Fa.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(n){return n.text}).join("")},Fa.prototype.serialize=function(){for(var n=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];if(p.image)n.push(["image",p.image.name]);else{n.push(p.text);var _={};p.fontStack&&(_["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(_["font-scale"]=p.scale),p.textColor&&(_["text-color"]=["rgba"].concat(p.textColor.toArray())),n.push(_)}}return n};var Ea=function(n){this.name=n.name,this.available=n.available};function Wr(n,o,u,p){return typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[n,o,u,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[n,o,u,p]:[n,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Hr(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Hi||n instanceof Pa||n instanceof Fa||n instanceof Ea)return!0;if(Array.isArray(n)){for(var o=0,u=n;o<u.length;o+=1)if(!Hr(u[o]))return!1;return!0}if(typeof n=="object"){for(var p in n)if(!Hr(n[p]))return!1;return!0}return!1}function yt(n){if(n===null)return Tn;if(typeof n=="string")return _n;if(typeof n=="boolean")return rn;if(typeof n=="number")return tr;if(n instanceof Hi)return cn;if(n instanceof Pa)return zi;if(n instanceof Fa)return ca;if(n instanceof Ea)return sn;if(Array.isArray(n)){for(var o,u=n.length,p=0,_=n;p<_.length;p+=1){var E=yt(_[p]);if(o){if(o===E)continue;o=gn;break}o=E}return ki(o||gn,u)}return wi}function Bs(n){var o=typeof n;return n===null?"":o==="string"||o==="number"||o==="boolean"?String(n):n instanceof Hi||n instanceof Fa||n instanceof Ea?n.toString():JSON.stringify(n)}Ea.prototype.toString=function(){return this.name},Ea.fromString=function(n){return n?new Ea({name:n,available:!1}):null},Ea.prototype.serialize=function(){return["image",this.name]};var he=function(n,o){this.type=n,this.value=o};he.parse=function(n,o){if(n.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(n.length-1)+" instead.");if(!Hr(n[1]))return o.error("invalid value");var u=n[1],p=yt(u),_=o.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new he(p,u)},he.prototype.evaluate=function(){return this.value},he.prototype.eachChild=function(){},he.prototype.outputDefined=function(){return!0},he.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Hi?["rgba"].concat(this.value.toArray()):this.value instanceof Fa?this.value.serialize():this.value};var Na=function(n){this.name="ExpressionEvaluationError",this.message=n};Na.prototype.toJSON=function(){return this.message};var Ya={string:_n,number:tr,boolean:rn,object:wi},oa=function(n,o){this.type=n,this.args=o};oa.parse=function(n,o){if(n.length<2)return o.error("Expected at least one argument.");var u,p=1,_=n[0];if(_==="array"){var E,A;if(n.length>2){var O=n[1];if(typeof O!="string"||!(O in Ya)||O==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);E=Ya[O],p++}else E=gn;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);A=n[2],p++}u=ki(E,A)}else u=Ya[_];for(var B=[];p<n.length;p++){var j=o.parse(n[p],p,gn);if(!j)return null;B.push(j)}return new oa(u,B)},oa.prototype.evaluate=function(n){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(n);if(!Ji(this.type,yt(u)))return u;if(o===this.args.length-1)throw new Na("Expected value to be of type "+Pi(this.type)+", but found "+Pi(yt(u))+" instead.")}return null},oa.prototype.eachChild=function(n){this.args.forEach(n)},oa.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},oa.prototype.serialize=function(){var n=this.type,o=[n.kind];if(n.kind==="array"){var u=n.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var p=n.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(function(_){return _.serialize()}))};var uo=function(n){this.type=ca,this.sections=n};uo.parse=function(n,o){if(n.length<2)return o.error("Expected at least one argument.");var u=n[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var p=[],_=!1,E=1;E<=n.length-1;++E){var A=n[E];if(_&&typeof A=="object"&&!Array.isArray(A)){_=!1;var O=null;if(A["font-scale"]&&!(O=o.parse(A["font-scale"],1,tr)))return null;var B=null;if(A["text-font"]&&!(B=o.parse(A["text-font"],1,ki(_n))))return null;var j=null;if(A["text-color"]&&!(j=o.parse(A["text-color"],1,cn)))return null;var H=p[p.length-1];H.scale=O,H.font=B,H.textColor=j}else{var te=o.parse(n[E],1,gn);if(!te)return null;var ce=te.type.kind;if(ce!=="string"&&ce!=="value"&&ce!=="null"&&ce!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:te,scale:null,font:null,textColor:null})}}return new uo(p)},uo.prototype.evaluate=function(n){return new Fa(this.sections.map(function(o){var u=o.content.evaluate(n);return yt(u)===sn?new so("",u,null,null,null):new so(Bs(u),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))},uo.prototype.eachChild=function(n){for(var o=0,u=this.sections;o<u.length;o+=1){var p=u[o];n(p.content),p.scale&&n(p.scale),p.font&&n(p.font),p.textColor&&n(p.textColor)}},uo.prototype.outputDefined=function(){return!1},uo.prototype.serialize=function(){for(var n=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];n.push(p.content.serialize());var _={};p.scale&&(_["font-scale"]=p.scale.serialize()),p.font&&(_["text-font"]=p.font.serialize()),p.textColor&&(_["text-color"]=p.textColor.serialize()),n.push(_)}return n};var Co=function(n){this.type=sn,this.input=n};Co.parse=function(n,o){if(n.length!==2)return o.error("Expected two arguments.");var u=o.parse(n[1],1,_n);return u?new Co(u):o.error("No image name provided.")},Co.prototype.evaluate=function(n){var o=this.input.evaluate(n),u=Ea.fromString(o);return u&&n.availableImages&&(u.available=n.availableImages.indexOf(o)>-1),u},Co.prototype.eachChild=function(n){n(this.input)},Co.prototype.outputDefined=function(){return!1},Co.prototype.serialize=function(){return["image",this.input.serialize()]};var Ru={"to-boolean":rn,"to-color":cn,"to-number":tr,"to-string":_n},yo=function(n,o){this.type=n,this.args=o};yo.parse=function(n,o){if(n.length<2)return o.error("Expected at least one argument.");var u=n[0];if((u==="to-boolean"||u==="to-string")&&n.length!==2)return o.error("Expected one argument.");for(var p=Ru[u],_=[],E=1;E<n.length;E++){var A=o.parse(n[E],E,gn);if(!A)return null;_.push(A)}return new yo(p,_)},yo.prototype.evaluate=function(n){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(n));if(this.type.kind==="color"){for(var o,u,p=0,_=this.args;p<_.length;p+=1){if(u=null,(o=_[p].evaluate(n))instanceof Hi)return o;if(typeof o=="string"){var E=n.parseColor(o);if(E)return E}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":Wr(o[0],o[1],o[2],o[3])))return new Hi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Na(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var A=null,O=0,B=this.args;O<B.length;O+=1){if((A=B[O].evaluate(n))===null)return 0;var j=Number(A);if(!isNaN(j))return j}throw new Na("Could not convert "+JSON.stringify(A)+" to number.")}return this.type.kind==="formatted"?Fa.fromString(Bs(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?Ea.fromString(Bs(this.args[0].evaluate(n))):Bs(this.args[0].evaluate(n))},yo.prototype.eachChild=function(n){this.args.forEach(n)},yo.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},yo.prototype.serialize=function(){if(this.type.kind==="formatted")return new uo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Co(this.args[0]).serialize();var n=["to-"+this.type.kind];return this.eachChild(function(o){n.push(o.serialize())}),n};var Ao=["Unknown","Point","LineString","Polygon"],da=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};da.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},da.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Ao[this.feature.type]:this.feature.type:null},da.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},da.prototype.canonicalID=function(){return this.canonical},da.prototype.properties=function(){return this.feature&&this.feature.properties||{}},da.prototype.parseColor=function(n){var o=this._parseColorCache[n];return o||(o=this._parseColorCache[n]=Hi.parse(n)),o};var lo=function(n,o,u,p){this.name=n,this.type=o,this._evaluate=u,this.args=p};lo.prototype.evaluate=function(n){return this._evaluate(n,this.args)},lo.prototype.eachChild=function(n){this.args.forEach(n)},lo.prototype.outputDefined=function(){return!1},lo.prototype.serialize=function(){return[this.name].concat(this.args.map(function(n){return n.serialize()}))},lo.parse=function(n,o){var u,p=n[0],_=lo.definitions[p];if(!_)return o.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(_)?_[0]:_.type,A=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,O=A.filter(function(oi){var Rn=oi[0];return!Array.isArray(Rn)||Rn.length===n.length-1}),B=null,j=0,H=O;j<H.length;j+=1){var te=H[j],ce=te[0],_e=te[1];B=new Qo(o.registry,o.path,null,o.scope);for(var Ue=[],He=!1,ft=1;ft<n.length;ft++){var rt=n[ft],Lt=Array.isArray(ce)?ce[ft-1]:ce.type,$t=B.parse(rt,1+Ue.length,Lt);if(!$t){He=!0;break}Ue.push($t)}if(!He)if(Array.isArray(ce)&&ce.length!==Ue.length)B.error("Expected "+ce.length+" arguments, but found "+Ue.length+" instead.");else{for(var Mt=0;Mt<Ue.length;Mt++){var Pt=Array.isArray(ce)?ce[Mt]:ce.type,Cr=Ue[Mt];B.concat(Mt+1).checkSubtype(Pt,Cr.type)}if(B.errors.length===0)return new lo(p,E,_e,Ue)}}if(O.length===1)(u=o.errors).push.apply(u,B.errors);else{for(var Xr=(O.length?O:A).map(function(oi){var Rn;return Rn=oi[0],Array.isArray(Rn)?"("+Rn.map(Pi).join(", ")+")":"("+Pi(Rn.type)+"...)"}).join(" | "),pn=[],ti=1;ti<n.length;ti++){var In=o.parse(n[ti],1+pn.length);if(!In)return null;pn.push(Pi(In.type))}o.error("Expected arguments of type "+Xr+", but found ("+pn.join(", ")+") instead.")}return null},lo.register=function(n,o){for(var u in lo.definitions=o,o)n[u]=lo};var Vo=function(n,o,u){this.type=zi,this.locale=u,this.caseSensitive=n,this.diacriticSensitive=o};function co(n,o){n[0]=Math.min(n[0],o[0]),n[1]=Math.min(n[1],o[1]),n[2]=Math.max(n[2],o[0]),n[3]=Math.max(n[3],o[1])}function Ns(n,o){return!(n[0]<=o[0]||n[2]>=o[2]||n[1]<=o[1]||n[3]>=o[3])}function ul(n,o){var u=(180+n[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,_=Math.pow(2,o.z);return[Math.round(u*_*8192),Math.round(p*_*8192)]}function us(n,o,u){return o[1]>n[1]!=u[1]>n[1]&&n[0]<(u[0]-o[0])*(n[1]-o[1])/(u[1]-o[1])+o[0]}function me(n,o){for(var u,p,_,E,A,O,B,j=!1,H=0,te=o.length;H<te;H++)for(var ce=o[H],_e=0,Ue=ce.length;_e<Ue-1;_e++){if((E=(u=n)[0]-(p=ce[_e])[0])*(B=u[1]-(_=ce[_e+1])[1])-(O=u[0]-_[0])*(A=u[1]-p[1])==0&&E*O<=0&&A*B<=0)return!1;us(n,ce[_e],ce[_e+1])&&(j=!j)}return j}function Le(n,o){for(var u=0;u<o.length;u++)if(me(n,o[u]))return!0;return!1}function dt(n,o,u,p){var _=p[0]-u[0],E=p[1]-u[1],A=(n[0]-u[0])*E-_*(n[1]-u[1]),O=(o[0]-u[0])*E-_*(o[1]-u[1]);return A>0&&O<0||A<0&&O>0}function ir(n,o,u){for(var p=0,_=u;p<_.length;p+=1)for(var E=_[p],A=0;A<E.length-1;++A)if((te=[(H=E[A+1])[0]-(j=E[A])[0],H[1]-j[1]])[0]*(ce=[(B=o)[0]-(O=n)[0],B[1]-O[1]])[1]-te[1]*ce[0]!=0&&dt(O,B,j,H)&&dt(j,H,O,B))return!0;var O,B,j,H,te,ce;return!1}function Vr(n,o){for(var u=0;u<n.length;++u)if(!me(n[u],o))return!1;for(var p=0;p<n.length-1;++p)if(ir(n[p],n[p+1],o))return!1;return!0}function Un(n,o){for(var u=0;u<o.length;u++)if(Vr(n,o[u]))return!0;return!1}function Bi(n,o,u){for(var p=[],_=0;_<n.length;_++){for(var E=[],A=0;A<n[_].length;A++){var O=ul(n[_][A],u);co(o,O),E.push(O)}p.push(E)}return p}function qa(n,o,u){for(var p=[],_=0;_<n.length;_++){var E=Bi(n[_],o,u);p.push(E)}return p}function Oa(n,o,u,p){if(n[0]<u[0]||n[0]>u[2]){var _=.5*p,E=n[0]-u[0]>_?-p:u[0]-n[0]>_?p:0;E===0&&(E=n[0]-u[2]>_?-p:u[2]-n[0]>_?p:0),n[0]+=E}co(o,n)}function ja(n,o,u,p){for(var _=8192*Math.pow(2,p.z),E=[8192*p.x,8192*p.y],A=[],O=0,B=n;O<B.length;O+=1)for(var j=0,H=B[O];j<H.length;j+=1){var te=H[j],ce=[te.x+E[0],te.y+E[1]];Oa(ce,o,u,_),A.push(ce)}return A}function Go(n,o,u,p){for(var _,E=8192*Math.pow(2,p.z),A=[8192*p.x,8192*p.y],O=[],B=0,j=n;B<j.length;B+=1){for(var H=[],te=0,ce=j[B];te<ce.length;te+=1){var _e=ce[te],Ue=[_e.x+A[0],_e.y+A[1]];co(o,Ue),H.push(Ue)}O.push(H)}if(o[2]-o[0]<=E/2){(_=o)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var He=0,ft=O;He<ft.length;He+=1)for(var rt=0,Lt=ft[He];rt<Lt.length;rt+=1)Oa(Lt[rt],o,u,E)}return O}Vo.parse=function(n,o){if(n.length!==2)return o.error("Expected one argument.");var u=n[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var p=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,rn);if(!p)return null;var _=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,rn);if(!_)return null;var E=null;return u.locale&&!(E=o.parse(u.locale,1,_n))?null:new Vo(p,_,E)},Vo.prototype.evaluate=function(n){return new Pa(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)},Vo.prototype.eachChild=function(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)},Vo.prototype.outputDefined=function(){return!1},Vo.prototype.serialize=function(){var n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]};var ms=function(n,o){this.type=rn,this.geojson=n,this.geometries=o};function Ho(n){if(n instanceof lo&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof ms)return!1;var o=!0;return n.eachChild(function(u){o&&!Ho(u)&&(o=!1)}),o}function ls(n){if(n instanceof lo&&n.name==="feature-state")return!1;var o=!0;return n.eachChild(function(u){o&&!ls(u)&&(o=!1)}),o}function gs(n,o){if(n instanceof lo&&o.indexOf(n.name)>=0)return!1;var u=!0;return n.eachChild(function(p){u&&!gs(p,o)&&(u=!1)}),u}ms.parse=function(n,o){if(n.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(n.length-1)+" instead.");if(Hr(n[1])){var u=n[1];if(u.type==="FeatureCollection")for(var p=0;p<u.features.length;++p){var _=u.features[p].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new ms(u,u.features[p].geometry)}else if(u.type==="Feature"){var E=u.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new ms(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new ms(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ms.prototype.evaluate=function(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],E=o.canonicalID();if(u.type==="Polygon"){var A=Bi(u.coordinates,_,E),O=ja(o.geometry(),p,_,E);if(!Ns(p,_))return!1;for(var B=0,j=O;B<j.length;B+=1)if(!me(j[B],A))return!1}if(u.type==="MultiPolygon"){var H=qa(u.coordinates,_,E),te=ja(o.geometry(),p,_,E);if(!Ns(p,_))return!1;for(var ce=0,_e=te;ce<_e.length;ce+=1)if(!Le(_e[ce],H))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],E=o.canonicalID();if(u.type==="Polygon"){var A=Bi(u.coordinates,_,E),O=Go(o.geometry(),p,_,E);if(!Ns(p,_))return!1;for(var B=0,j=O;B<j.length;B+=1)if(!Vr(j[B],A))return!1}if(u.type==="MultiPolygon"){var H=qa(u.coordinates,_,E),te=Go(o.geometry(),p,_,E);if(!Ns(p,_))return!1;for(var ce=0,_e=te;ce<_e.length;ce+=1)if(!Un(_e[ce],H))return!1}return!0}(n,this.geometries)}return!1},ms.prototype.eachChild=function(){},ms.prototype.outputDefined=function(){return!0},ms.prototype.serialize=function(){return["within",this.geojson]};var ws=function(n,o){this.type=o.type,this.name=n,this.boundExpression=o};ws.parse=function(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=n[1];return o.scope.has(u)?new ws(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},ws.prototype.evaluate=function(n){return this.boundExpression.evaluate(n)},ws.prototype.eachChild=function(){},ws.prototype.outputDefined=function(){return!1},ws.prototype.serialize=function(){return["var",this.name]};var Qo=function(n,o,u,p,_){o===void 0&&(o=[]),p===void 0&&(p=new zn),_===void 0&&(_=[]),this.registry=n,this.path=o,this.key=o.map(function(E){return"["+E+"]"}).join(""),this.scope=p,this.errors=_,this.expectedType=u};function cs(n,o){for(var u,p=n.length-1,_=0,E=p,A=0;_<=E;)if((u=n[A=Math.floor((_+E)/2)])<=o){if(A===p||o<n[A+1])return A;_=A+1}else{if(!(u>o))throw new Na("Input is not a number.");E=A-1}return 0}Qo.prototype.parse=function(n,o,u,p,_){return _===void 0&&(_={}),o?this.concat(o,u,p)._parse(n,_):this._parse(n,_)},Qo.prototype._parse=function(n,o){function u(j,H,te){return te==="assert"?new oa(H,[j]):te==="coerce"?new yo(H,[j]):j}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=n[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[p];if(_){var E=_.parse(n,this);if(!E)return null;if(this.expectedType){var A=this.expectedType,O=E.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||O.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||O.kind!=="value"&&O.kind!=="string"){if(this.checkSubtype(A,O))return null}else E=u(E,A,o.typeAnnotation||"coerce");else E=u(E,A,o.typeAnnotation||"assert")}if(!(E instanceof he)&&E.type.kind!=="resolvedImage"&&function j(H){if(H instanceof ws)return j(H.boundExpression);if(H instanceof lo&&H.name==="error"||H instanceof Vo||H instanceof ms)return!1;var te=H instanceof yo||H instanceof oa,ce=!0;return H.eachChild(function(_e){ce=te?ce&&j(_e):ce&&_e instanceof he}),!!ce&&Ho(H)&&gs(H,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(E)){var B=new da;try{E=new he(E.type,E.evaluate(B))}catch(j){return this.error(j.message),null}}return E}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof n+" instead.")},Qo.prototype.concat=function(n,o,u){var p=typeof n=="number"?this.path.concat(n):this.path,_=u?this.scope.concat(u):this.scope;return new Qo(this.registry,p,o||null,_,this.errors)},Qo.prototype.error=function(n){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var p=""+this.key+o.map(function(_){return"["+_+"]"}).join("");this.errors.push(new Rr(p,n))},Qo.prototype.checkSubtype=function(n,o){var u=Ji(n,o);return u&&this.error(u),u};var ys=function(n,o,u){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(var p=0,_=u;p<_.length;p+=1){var E=_[p],A=E[1];this.labels.push(E[0]),this.outputs.push(A)}};function Sa(n,o,u){return n*(1-u)+o*u}ys.parse=function(n,o){if(n.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(n[1],1,tr);if(!u)return null;var p=[],_=null;o.expectedType&&o.expectedType.kind!=="value"&&(_=o.expectedType);for(var E=1;E<n.length;E+=2){var A=E===1?-1/0:n[E],O=n[E+1],B=E,j=E+1;if(typeof A!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(p.length&&p[p.length-1][0]>=A)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);var H=o.parse(O,j,_);if(!H)return null;_=_||H.type,p.push([A,H])}return new ys(_,u,p)},ys.prototype.evaluate=function(n){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);var p=this.input.evaluate(n);if(p<=o[0])return u[0].evaluate(n);var _=o.length;return p>=o[_-1]?u[_-1].evaluate(n):u[cs(o,p)].evaluate(n)},ys.prototype.eachChild=function(n){n(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)n(u[o])},ys.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})},ys.prototype.serialize=function(){for(var n=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n};var _o=Object.freeze({__proto__:null,number:Sa,color:function(n,o,u){return new Hi(Sa(n.r,o.r,u),Sa(n.g,o.g,u),Sa(n.b,o.b,u),Sa(n.a,o.a,u))},array:function(n,o,u){return n.map(function(p,_){return Sa(p,o[_],u)})}}),ec=6/29*3*(6/29),kc=Math.PI/180,Yu=180/Math.PI;function fs(n){return n>.008856451679035631?Math.pow(n,1/3):n/ec+4/29}function Jo(n){return n>6/29?n*n*n:ec*(n-4/29)}function Ol(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function bu(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Ts(n){var o=bu(n.r),u=bu(n.g),p=bu(n.b),_=fs((.4124564*o+.3575761*u+.1804375*p)/.95047),E=fs((.2126729*o+.7151522*u+.072175*p)/1);return{l:116*E-16,a:500*(_-E),b:200*(E-fs((.0193339*o+.119192*u+.9503041*p)/1.08883)),alpha:n.a}}function x(n){var o=(n.l+16)/116,u=isNaN(n.a)?o:o+n.a/500,p=isNaN(n.b)?o:o-n.b/200;return o=1*Jo(o),u=.95047*Jo(u),p=1.08883*Jo(p),new Hi(Ol(3.2404542*u-1.5371385*o-.4985314*p),Ol(-.969266*u+1.8760108*o+.041556*p),Ol(.0556434*u-.2040259*o+1.0572252*p),n.alpha)}function M(n,o,u){var p=o-n;return n+u*(p>180||p<-180?p-360*Math.round(p/360):p)}var z={forward:Ts,reverse:x,interpolate:function(n,o,u){return{l:Sa(n.l,o.l,u),a:Sa(n.a,o.a,u),b:Sa(n.b,o.b,u),alpha:Sa(n.alpha,o.alpha,u)}}},R={forward:function(n){var o=Ts(n),u=o.l,p=o.a,_=o.b,E=Math.atan2(_,p)*Yu;return{h:E<0?E+360:E,c:Math.sqrt(p*p+_*_),l:u,alpha:n.a}},reverse:function(n){var o=n.h*kc,u=n.c;return x({l:n.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:n.alpha})},interpolate:function(n,o,u){return{h:M(n.h,o.h,u),c:Sa(n.c,o.c,u),l:Sa(n.l,o.l,u),alpha:Sa(n.alpha,o.alpha,u)}}},se=Object.freeze({__proto__:null,lab:z,hcl:R}),Ie=function(n,o,u,p,_){this.type=n,this.operator=o,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(var E=0,A=_;E<A.length;E+=1){var O=A[E],B=O[1];this.labels.push(O[0]),this.outputs.push(B)}};function ct(n,o,u,p){var _=p-u,E=n-u;return _===0?0:o===1?E/_:(Math.pow(o,E)-1)/(Math.pow(o,_)-1)}Ie.interpolationFactor=function(n,o,u,p){var _=0;if(n.name==="exponential")_=ct(o,n.base,u,p);else if(n.name==="linear")_=ct(o,1,u,p);else if(n.name==="cubic-bezier"){var E=n.controlPoints;_=new N(E[0],E[1],E[2],E[3]).solve(ct(o,1,u,p))}return _},Ie.parse=function(n,o){var u=n[0],p=n[1],_=n[2],E=n.slice(3);if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var A=p[1];if(typeof A!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:A}}else{if(p[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(p[0]),1,0);var O=p.slice(1);if(O.length!==4||O.some(function(ft){return typeof ft!="number"||ft<0||ft>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:O}}if(n.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(_=o.parse(_,2,tr)))return null;var B=[],j=null;u==="interpolate-hcl"||u==="interpolate-lab"?j=cn:o.expectedType&&o.expectedType.kind!=="value"&&(j=o.expectedType);for(var H=0;H<E.length;H+=2){var te=E[H],ce=E[H+1],_e=H+3,Ue=H+4;if(typeof te!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_e);if(B.length&&B[B.length-1][0]>=te)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',_e);var He=o.parse(ce,Ue,j);if(!He)return null;j=j||He.type,B.push([te,He])}return j.kind==="number"||j.kind==="color"||j.kind==="array"&&j.itemType.kind==="number"&&typeof j.N=="number"?new Ie(j,u,p,_,B):o.error("Type "+Pi(j)+" is not interpolatable.")},Ie.prototype.evaluate=function(n){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(n);var p=this.input.evaluate(n);if(p<=o[0])return u[0].evaluate(n);var _=o.length;if(p>=o[_-1])return u[_-1].evaluate(n);var E=cs(o,p),A=Ie.interpolationFactor(this.interpolation,p,o[E],o[E+1]),O=u[E].evaluate(n),B=u[E+1].evaluate(n);return this.operator==="interpolate"?_o[this.type.kind.toLowerCase()](O,B,A):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(O),R.forward(B),A)):z.reverse(z.interpolate(z.forward(O),z.forward(B),A))},Ie.prototype.eachChild=function(n){n(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)n(u[o])},Ie.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})},Ie.prototype.serialize=function(){var n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,n,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var Dt=function(n,o){this.type=n,this.args=o};Dt.parse=function(n,o){if(n.length<2)return o.error("Expectected at least one argument.");var u=null,p=o.expectedType;p&&p.kind!=="value"&&(u=p);for(var _=[],E=0,A=n.slice(1);E<A.length;E+=1){var O=o.parse(A[E],1+_.length,u,void 0,{typeAnnotation:"omit"});if(!O)return null;u=u||O.type,_.push(O)}var B=p&&_.some(function(j){return Ji(p,j.type)});return new Dt(B?gn:u,_)},Dt.prototype.evaluate=function(n){for(var o,u=null,p=0,_=0,E=this.args;_<E.length&&(p++,(u=E[_].evaluate(n))&&u instanceof Ea&&!u.available&&(o||(o=u.name),u=null,p===this.args.length&&(u=o)),u===null);_+=1);return u},Dt.prototype.eachChild=function(n){this.args.forEach(n)},Dt.prototype.outputDefined=function(){return this.args.every(function(n){return n.outputDefined()})},Dt.prototype.serialize=function(){var n=["coalesce"];return this.eachChild(function(o){n.push(o.serialize())}),n};var Rt=function(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o};Rt.prototype.evaluate=function(n){return this.result.evaluate(n)},Rt.prototype.eachChild=function(n){for(var o=0,u=this.bindings;o<u.length;o+=1)n(u[o][1]);n(this.result)},Rt.parse=function(n,o){if(n.length<4)return o.error("Expected at least 3 arguments, but found "+(n.length-1)+" instead.");for(var u=[],p=1;p<n.length-1;p+=2){var _=n[p];if(typeof _!="string")return o.error("Expected string, but found "+typeof _+" instead.",p);if(/[^a-zA-Z0-9_]/.test(_))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);var E=o.parse(n[p+1],p+1);if(!E)return null;u.push([_,E])}var A=o.parse(n[n.length-1],n.length-1,o.expectedType,u);return A?new Rt(u,A):null},Rt.prototype.outputDefined=function(){return this.result.outputDefined()},Rt.prototype.serialize=function(){for(var n=["let"],o=0,u=this.bindings;o<u.length;o+=1){var p=u[o];n.push(p[0],p[1].serialize())}return n.push(this.result.serialize()),n};var wr=function(n,o,u){this.type=n,this.index=o,this.input=u};wr.parse=function(n,o){if(n.length!==3)return o.error("Expected 2 arguments, but found "+(n.length-1)+" instead.");var u=o.parse(n[1],1,tr),p=o.parse(n[2],2,ki(o.expectedType||gn));return u&&p?new wr(p.type.itemType,u,p):null},wr.prototype.evaluate=function(n){var o=this.index.evaluate(n),u=this.input.evaluate(n);if(o<0)throw new Na("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Na("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Na("Array index must be an integer, but found "+o+" instead.");return u[o]},wr.prototype.eachChild=function(n){n(this.index),n(this.input)},wr.prototype.outputDefined=function(){return!1},wr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Br=function(n,o){this.type=rn,this.needle=n,this.haystack=o};Br.parse=function(n,o){if(n.length!==3)return o.error("Expected 2 arguments, but found "+(n.length-1)+" instead.");var u=o.parse(n[1],1,gn),p=o.parse(n[2],2,gn);return u&&p?qt(u.type,[rn,_n,tr,Tn,gn])?new Br(u,p):o.error("Expected first argument to be of type boolean, string, number or null, but found "+Pi(u.type)+" instead"):null},Br.prototype.evaluate=function(n){var o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!u)return!1;if(!Gt(o,["boolean","string","number","null"]))throw new Na("Expected first argument to be of type boolean, string, number or null, but found "+Pi(yt(o))+" instead.");if(!Gt(u,["string","array"]))throw new Na("Expected second argument to be of type array or string, but found "+Pi(yt(u))+" instead.");return u.indexOf(o)>=0},Br.prototype.eachChild=function(n){n(this.needle),n(this.haystack)},Br.prototype.outputDefined=function(){return!0},Br.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Xn=function(n,o,u){this.type=tr,this.needle=n,this.haystack=o,this.fromIndex=u};Xn.parse=function(n,o){if(n.length<=2||n.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(n.length-1)+" instead.");var u=o.parse(n[1],1,gn),p=o.parse(n[2],2,gn);if(!u||!p)return null;if(!qt(u.type,[rn,_n,tr,Tn,gn]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+Pi(u.type)+" instead");if(n.length===4){var _=o.parse(n[3],3,tr);return _?new Xn(u,p,_):null}return new Xn(u,p)},Xn.prototype.evaluate=function(n){var o=this.needle.evaluate(n),u=this.haystack.evaluate(n);if(!Gt(o,["boolean","string","number","null"]))throw new Na("Expected first argument to be of type boolean, string, number or null, but found "+Pi(yt(o))+" instead.");if(!Gt(u,["string","array"]))throw new Na("Expected second argument to be of type array or string, but found "+Pi(yt(u))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(n);return u.indexOf(o,p)}return u.indexOf(o)},Xn.prototype.eachChild=function(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)},Xn.prototype.outputDefined=function(){return!1},Xn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var bi=function(n,o,u,p,_,E){this.inputType=n,this.type=o,this.input=u,this.cases=p,this.outputs=_,this.otherwise=E};bi.parse=function(n,o){if(n.length<5)return o.error("Expected at least 4 arguments, but found only "+(n.length-1)+".");if(n.length%2!=1)return o.error("Expected an even number of arguments.");var u,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(var _={},E=[],A=2;A<n.length-1;A+=2){var O=n[A],B=n[A+1];Array.isArray(O)||(O=[O]);var j=o.concat(A);if(O.length===0)return j.error("Expected at least one branch label.");for(var H=0,te=O;H<te.length;H+=1){var ce=te[H];if(typeof ce!="number"&&typeof ce!="string")return j.error("Branch labels must be numbers or strings.");if(typeof ce=="number"&&Math.abs(ce)>Number.MAX_SAFE_INTEGER)return j.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ce=="number"&&Math.floor(ce)!==ce)return j.error("Numeric branch labels must be integer values.");if(u){if(j.checkSubtype(u,yt(ce)))return null}else u=yt(ce);if(_[String(ce)]!==void 0)return j.error("Branch labels must be unique.");_[String(ce)]=E.length}var _e=o.parse(B,A,p);if(!_e)return null;p=p||_e.type,E.push(_e)}var Ue=o.parse(n[1],1,gn);if(!Ue)return null;var He=o.parse(n[n.length-1],n.length-1,p);return He?Ue.type.kind!=="value"&&o.concat(1).checkSubtype(u,Ue.type)?null:new bi(u,p,Ue,_,E,He):null},bi.prototype.evaluate=function(n){var o=this.input.evaluate(n);return(yt(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)},bi.prototype.eachChild=function(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)},bi.prototype.outputDefined=function(){return this.outputs.every(function(n){return n.outputDefined()})&&this.otherwise.outputDefined()},bi.prototype.serialize=function(){for(var n=this,o=["match",this.input.serialize()],u=[],p={},_=0,E=Object.keys(this.cases).sort();_<E.length;_+=1){var A=E[_];(te=p[this.cases[A]])===void 0?(p[this.cases[A]]=u.length,u.push([this.cases[A],[A]])):u[te][1].push(A)}for(var O=function(_e){return n.inputType.kind==="number"?Number(_e):_e},B=0,j=u;B<j.length;B+=1){var H=j[B],te=H[0],ce=H[1];o.push(ce.length===1?O(ce[0]):ce.map(O)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var ci=function(n,o,u){this.type=n,this.branches=o,this.otherwise=u};ci.parse=function(n,o){if(n.length<4)return o.error("Expected at least 3 arguments, but found only "+(n.length-1)+".");if(n.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var p=[],_=1;_<n.length-1;_+=2){var E=o.parse(n[_],_,rn);if(!E)return null;var A=o.parse(n[_+1],_+1,u);if(!A)return null;p.push([E,A]),u=u||A.type}var O=o.parse(n[n.length-1],n.length-1,u);return O?new ci(u,p,O):null},ci.prototype.evaluate=function(n){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],_=p[1];if(p[0].evaluate(n))return _.evaluate(n)}return this.otherwise.evaluate(n)},ci.prototype.eachChild=function(n){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],_=p[1];n(p[0]),n(_)}n(this.otherwise)},ci.prototype.outputDefined=function(){return this.branches.every(function(n){return n[1].outputDefined()})&&this.otherwise.outputDefined()},ci.prototype.serialize=function(){var n=["case"];return this.eachChild(function(o){n.push(o.serialize())}),n};var Ei=function(n,o,u,p){this.type=n,this.input=o,this.beginIndex=u,this.endIndex=p};function ua(n,o){return n==="=="||n==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Ca(n,o,u,p){return p.compare(o,u)===0}function Si(n,o,u){var p=n!=="=="&&n!=="!=";return function(){function _(E,A,O){this.type=rn,this.lhs=E,this.rhs=A,this.collator=O,this.hasUntypedArgument=E.type.kind==="value"||A.type.kind==="value"}return _.parse=function(E,A){if(E.length!==3&&E.length!==4)return A.error("Expected two or three arguments.");var O=E[0],B=A.parse(E[1],1,gn);if(!B)return null;if(!ua(O,B.type))return A.concat(1).error('"'+O+`" comparisons are not supported for type '`+Pi(B.type)+"'.");var j=A.parse(E[2],2,gn);if(!j)return null;if(!ua(O,j.type))return A.concat(2).error('"'+O+`" comparisons are not supported for type '`+Pi(j.type)+"'.");if(B.type.kind!==j.type.kind&&B.type.kind!=="value"&&j.type.kind!=="value")return A.error("Cannot compare types '"+Pi(B.type)+"' and '"+Pi(j.type)+"'.");p&&(B.type.kind==="value"&&j.type.kind!=="value"?B=new oa(j.type,[B]):B.type.kind!=="value"&&j.type.kind==="value"&&(j=new oa(B.type,[j])));var H=null;if(E.length===4){if(B.type.kind!=="string"&&j.type.kind!=="string"&&B.type.kind!=="value"&&j.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(!(H=A.parse(E[3],3,zi)))return null}return new _(B,j,H)},_.prototype.evaluate=function(E){var A=this.lhs.evaluate(E),O=this.rhs.evaluate(E);if(p&&this.hasUntypedArgument){var B=yt(A),j=yt(O);if(B.kind!==j.kind||B.kind!=="string"&&B.kind!=="number")throw new Na('Expected arguments for "'+n+'" to be (string, string) or (number, number), but found ('+B.kind+", "+j.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var H=yt(A),te=yt(O);if(H.kind!=="string"||te.kind!=="string")return o(E,A,O)}return this.collator?u(E,A,O,this.collator.evaluate(E)):o(E,A,O)},_.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var E=[n];return this.eachChild(function(A){E.push(A.serialize())}),E},_}()}Ei.parse=function(n,o){if(n.length<=2||n.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(n.length-1)+" instead.");var u=o.parse(n[1],1,gn),p=o.parse(n[2],2,tr);if(!u||!p)return null;if(!qt(u.type,[ki(gn),_n,gn]))return o.error("Expected first argument to be of type array or string, but found "+Pi(u.type)+" instead");if(n.length===4){var _=o.parse(n[3],3,tr);return _?new Ei(u.type,u,p,_):null}return new Ei(u.type,u,p)},Ei.prototype.evaluate=function(n){var o=this.input.evaluate(n),u=this.beginIndex.evaluate(n);if(!Gt(o,["string","array"]))throw new Na("Expected first argument to be of type array or string, but found "+Pi(yt(o))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(n);return o.slice(u,p)}return o.slice(u)},Ei.prototype.eachChild=function(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)},Ei.prototype.outputDefined=function(){return!1},Ei.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var _s=Si("==",function(n,o,u){return o===u},Ca),uu=Si("!=",function(n,o,u){return o!==u},function(n,o,u,p){return!Ca(0,o,u,p)}),ll=Si("<",function(n,o,u){return o<u},function(n,o,u,p){return p.compare(o,u)<0}),mf=Si(">",function(n,o,u){return o>u},function(n,o,u,p){return p.compare(o,u)>0}),cl=Si("<=",function(n,o,u){return o<=u},function(n,o,u,p){return p.compare(o,u)<=0}),tc=Si(">=",function(n,o,u){return o>=u},function(n,o,u,p){return p.compare(o,u)>=0}),Eu=function(n,o,u,p,_){this.type=_n,this.number=n,this.locale=o,this.currency=u,this.minFractionDigits=p,this.maxFractionDigits=_};Eu.parse=function(n,o){if(n.length!==3)return o.error("Expected two arguments.");var u=o.parse(n[1],1,tr);if(!u)return null;var p=n[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");var _=null;if(p.locale&&!(_=o.parse(p.locale,1,_n)))return null;var E=null;if(p.currency&&!(E=o.parse(p.currency,1,_n)))return null;var A=null;if(p["min-fraction-digits"]&&!(A=o.parse(p["min-fraction-digits"],1,tr)))return null;var O=null;return p["max-fraction-digits"]&&!(O=o.parse(p["max-fraction-digits"],1,tr))?null:new Eu(u,_,E,A,O)},Eu.prototype.evaluate=function(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))},Eu.prototype.eachChild=function(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)},Eu.prototype.outputDefined=function(){return!1},Eu.prototype.serialize=function(){var n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]};var Lu=function(n){this.type=tr,this.input=n};Lu.parse=function(n,o){if(n.length!==2)return o.error("Expected 1 argument, but found "+(n.length-1)+" instead.");var u=o.parse(n[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+Pi(u.type)+" instead."):new Lu(u):null},Lu.prototype.evaluate=function(n){var o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Na("Expected value to be of type string or array, but found "+Pi(yt(o))+" instead.")},Lu.prototype.eachChild=function(n){n(this.input)},Lu.prototype.outputDefined=function(){return!1},Lu.prototype.serialize=function(){var n=["length"];return this.eachChild(function(o){n.push(o.serialize())}),n};var ku={"==":_s,"!=":uu,">":mf,"<":ll,">=":tc,"<=":cl,array:oa,at:wr,boolean:oa,case:ci,coalesce:Dt,collator:Vo,format:uo,image:Co,in:Br,"index-of":Xn,interpolate:Ie,"interpolate-hcl":Ie,"interpolate-lab":Ie,length:Lu,let:Rt,literal:he,match:bi,number:oa,"number-format":Eu,object:oa,slice:Ei,step:ys,string:oa,"to-boolean":yo,"to-color":yo,"to-number":yo,"to-string":yo,var:ws,within:ms};function fo(n,o){var u=o[0],p=o[1],_=o[2],E=o[3];u=u.evaluate(n),p=p.evaluate(n),_=_.evaluate(n);var A=E?E.evaluate(n):1,O=Wr(u,p,_,A);if(O)throw new Na(O);return new Hi(u/255*A,p/255*A,_/255*A,A)}function $f(n,o){return n in o}function Qf(n,o){var u=o[n];return u===void 0?null:u}function xs(n){return{type:n}}function gf(n){return{result:"success",value:n}}function Du(n){return{result:"error",value:n}}function Ks(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function rc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function qu(n){return!!n.expression&&n.expression.interpolated}function Aa(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function nc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Oh(n){return n}function Il(n,o,u){return n!==void 0?n:o!==void 0?o:u!==void 0?u:void 0}function zs(n,o,u,p,_){return Il(typeof u===_?p[u]:void 0,n.default,o.default)}function up(n,o,u){if(Aa(u)!=="number")return Il(n.default,o.default);var p=n.stops.length;if(p===1||u<=n.stops[0][0])return n.stops[0][1];if(u>=n.stops[p-1][0])return n.stops[p-1][1];var _=cs(n.stops.map(function(E){return E[0]}),u);return n.stops[_][1]}function Ih(n,o,u){var p=n.base!==void 0?n.base:1;if(Aa(u)!=="number")return Il(n.default,o.default);var _=n.stops.length;if(_===1||u<=n.stops[0][0])return n.stops[0][1];if(u>=n.stops[_-1][0])return n.stops[_-1][1];var E=cs(n.stops.map(function(te){return te[0]}),u),A=function(te,ce,_e,Ue){var He=Ue-_e,ft=te-_e;return He===0?0:ce===1?ft/He:(Math.pow(ce,ft)-1)/(Math.pow(ce,He)-1)}(u,p,n.stops[E][0],n.stops[E+1][0]),O=n.stops[E][1],B=n.stops[E+1][1],j=_o[o.type]||Oh;if(n.colorSpace&&n.colorSpace!=="rgb"){var H=se[n.colorSpace];j=function(te,ce){return H.reverse(H.interpolate(H.forward(te),H.forward(ce),A))}}return typeof O.evaluate=="function"?{evaluate:function(){for(var te=[],ce=arguments.length;ce--;)te[ce]=arguments[ce];var _e=O.evaluate.apply(void 0,te),Ue=B.evaluate.apply(void 0,te);if(_e!==void 0&&Ue!==void 0)return j(_e,Ue,A)}}:j(O,B,A)}function yf(n,o,u){return o.type==="color"?u=Hi.parse(u):o.type==="formatted"?u=Fa.fromString(u.toString()):o.type==="resolvedImage"?u=Ea.fromString(u.toString()):Aa(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),Il(u,n.default,o.default)}lo.register(ku,{error:[{kind:"error"},[_n],function(n,o){throw new Na(o[0].evaluate(n))}],typeof:[_n,[gn],function(n,o){return Pi(yt(o[0].evaluate(n)))}],"to-rgba":[ki(tr,4),[cn],function(n,o){return o[0].evaluate(n).toArray()}],rgb:[cn,[tr,tr,tr],fo],rgba:[cn,[tr,tr,tr,tr],fo],has:{type:rn,overloads:[[[_n],function(n,o){return $f(o[0].evaluate(n),n.properties())}],[[_n,wi],function(n,o){var u=o[1];return $f(o[0].evaluate(n),u.evaluate(n))}]]},get:{type:gn,overloads:[[[_n],function(n,o){return Qf(o[0].evaluate(n),n.properties())}],[[_n,wi],function(n,o){var u=o[1];return Qf(o[0].evaluate(n),u.evaluate(n))}]]},"feature-state":[gn,[_n],function(n,o){return Qf(o[0].evaluate(n),n.featureState||{})}],properties:[wi,[],function(n){return n.properties()}],"geometry-type":[_n,[],function(n){return n.geometryType()}],id:[gn,[],function(n){return n.id()}],zoom:[tr,[],function(n){return n.globals.zoom}],"heatmap-density":[tr,[],function(n){return n.globals.heatmapDensity||0}],"line-progress":[tr,[],function(n){return n.globals.lineProgress||0}],accumulated:[gn,[],function(n){return n.globals.accumulated===void 0?null:n.globals.accumulated}],"+":[tr,xs(tr),function(n,o){for(var u=0,p=0,_=o;p<_.length;p+=1)u+=_[p].evaluate(n);return u}],"*":[tr,xs(tr),function(n,o){for(var u=1,p=0,_=o;p<_.length;p+=1)u*=_[p].evaluate(n);return u}],"-":{type:tr,overloads:[[[tr,tr],function(n,o){var u=o[1];return o[0].evaluate(n)-u.evaluate(n)}],[[tr],function(n,o){return-o[0].evaluate(n)}]]},"/":[tr,[tr,tr],function(n,o){var u=o[1];return o[0].evaluate(n)/u.evaluate(n)}],"%":[tr,[tr,tr],function(n,o){var u=o[1];return o[0].evaluate(n)%u.evaluate(n)}],ln2:[tr,[],function(){return Math.LN2}],pi:[tr,[],function(){return Math.PI}],e:[tr,[],function(){return Math.E}],"^":[tr,[tr,tr],function(n,o){var u=o[1];return Math.pow(o[0].evaluate(n),u.evaluate(n))}],sqrt:[tr,[tr],function(n,o){return Math.sqrt(o[0].evaluate(n))}],log10:[tr,[tr],function(n,o){return Math.log(o[0].evaluate(n))/Math.LN10}],ln:[tr,[tr],function(n,o){return Math.log(o[0].evaluate(n))}],log2:[tr,[tr],function(n,o){return Math.log(o[0].evaluate(n))/Math.LN2}],sin:[tr,[tr],function(n,o){return Math.sin(o[0].evaluate(n))}],cos:[tr,[tr],function(n,o){return Math.cos(o[0].evaluate(n))}],tan:[tr,[tr],function(n,o){return Math.tan(o[0].evaluate(n))}],asin:[tr,[tr],function(n,o){return Math.asin(o[0].evaluate(n))}],acos:[tr,[tr],function(n,o){return Math.acos(o[0].evaluate(n))}],atan:[tr,[tr],function(n,o){return Math.atan(o[0].evaluate(n))}],min:[tr,xs(tr),function(n,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(n)}))}],max:[tr,xs(tr),function(n,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(n)}))}],abs:[tr,[tr],function(n,o){return Math.abs(o[0].evaluate(n))}],round:[tr,[tr],function(n,o){var u=o[0].evaluate(n);return u<0?-Math.round(-u):Math.round(u)}],floor:[tr,[tr],function(n,o){return Math.floor(o[0].evaluate(n))}],ceil:[tr,[tr],function(n,o){return Math.ceil(o[0].evaluate(n))}],"filter-==":[rn,[_n,gn],function(n,o){var u=o[0],p=o[1];return n.properties()[u.value]===p.value}],"filter-id-==":[rn,[gn],function(n,o){var u=o[0];return n.id()===u.value}],"filter-type-==":[rn,[_n],function(n,o){var u=o[0];return n.geometryType()===u.value}],"filter-<":[rn,[_n,gn],function(n,o){var u=o[0],p=o[1],_=n.properties()[u.value],E=p.value;return typeof _==typeof E&&_<E}],"filter-id-<":[rn,[gn],function(n,o){var u=o[0],p=n.id(),_=u.value;return typeof p==typeof _&&p<_}],"filter->":[rn,[_n,gn],function(n,o){var u=o[0],p=o[1],_=n.properties()[u.value],E=p.value;return typeof _==typeof E&&_>E}],"filter-id->":[rn,[gn],function(n,o){var u=o[0],p=n.id(),_=u.value;return typeof p==typeof _&&p>_}],"filter-<=":[rn,[_n,gn],function(n,o){var u=o[0],p=o[1],_=n.properties()[u.value],E=p.value;return typeof _==typeof E&&_<=E}],"filter-id-<=":[rn,[gn],function(n,o){var u=o[0],p=n.id(),_=u.value;return typeof p==typeof _&&p<=_}],"filter->=":[rn,[_n,gn],function(n,o){var u=o[0],p=o[1],_=n.properties()[u.value],E=p.value;return typeof _==typeof E&&_>=E}],"filter-id->=":[rn,[gn],function(n,o){var u=o[0],p=n.id(),_=u.value;return typeof p==typeof _&&p>=_}],"filter-has":[rn,[gn],function(n,o){return o[0].value in n.properties()}],"filter-has-id":[rn,[],function(n){return n.id()!==null&&n.id()!==void 0}],"filter-type-in":[rn,[ki(_n)],function(n,o){return o[0].value.indexOf(n.geometryType())>=0}],"filter-id-in":[rn,[ki(gn)],function(n,o){return o[0].value.indexOf(n.id())>=0}],"filter-in-small":[rn,[_n,ki(gn)],function(n,o){var u=o[0];return o[1].value.indexOf(n.properties()[u.value])>=0}],"filter-in-large":[rn,[_n,ki(gn)],function(n,o){var u=o[0],p=o[1];return function(_,E,A,O){for(;A<=O;){var B=A+O>>1;if(E[B]===_)return!0;E[B]>_?O=B-1:A=B+1}return!1}(n.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:rn,overloads:[[[rn,rn],function(n,o){var u=o[1];return o[0].evaluate(n)&&u.evaluate(n)}],[xs(rn),function(n,o){for(var u=0,p=o;u<p.length;u+=1)if(!p[u].evaluate(n))return!1;return!0}]]},any:{type:rn,overloads:[[[rn,rn],function(n,o){var u=o[1];return o[0].evaluate(n)||u.evaluate(n)}],[xs(rn),function(n,o){for(var u=0,p=o;u<p.length;u+=1)if(p[u].evaluate(n))return!0;return!1}]]},"!":[rn,[rn],function(n,o){return!o[0].evaluate(n)}],"is-supported-script":[rn,[_n],function(n,o){var u=n.globals&&n.globals.isSupportedScript;return!u||u(o[0].evaluate(n))}],upcase:[_n,[_n],function(n,o){return o[0].evaluate(n).toUpperCase()}],downcase:[_n,[_n],function(n,o){return o[0].evaluate(n).toLowerCase()}],concat:[_n,xs(gn),function(n,o){return o.map(function(u){return Bs(u.evaluate(n))}).join("")}],"resolved-locale":[_n,[zi],function(n,o){return o[0].evaluate(n).resolvedLocale()}]});var fl=function(n,o){this.expression=n,this._warningHistory={},this._evaluator=new da,this._defaultValue=o?function(u){return u.type==="color"&&nc(u.default)?new Hi(0,0,0,0):u.type==="color"?Hi.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function Ku(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in ku}function Rl(n,o){var u=new Qo(ku,[],o?function(_){var E={color:cn,string:_n,number:tr,enum:_n,boolean:rn,formatted:ca,resolvedImage:sn};return _.type==="array"?ki(E[_.value]||gn,_.length):E[_.type]}(o):void 0),p=u.parse(n,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?gf(new fl(p,o)):Du(u.errors)}fl.prototype.evaluateWithoutErrorHandling=function(n,o,u,p,_,E){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},fl.prototype.evaluate=function(n,o,u,p,_,E){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=E||null;try{var A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Na("Expected value to be one of "+Object.keys(this._enumValues).map(function(O){return JSON.stringify(O)}).join(", ")+", but found "+JSON.stringify(A)+" instead.");return A}catch(O){return this._warningHistory[O.message]||(this._warningHistory[O.message]=!0,typeof console!="undefined"&&console.warn(O.message)),this._defaultValue}};var ic=function(n,o){this.kind=n,this._styleExpression=o,this.isStateDependent=n!=="constant"&&!ls(o.expression)};ic.prototype.evaluateWithoutErrorHandling=function(n,o,u,p,_,E){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,p,_,E)},ic.prototype.evaluate=function(n,o,u,p,_,E){return this._styleExpression.evaluate(n,o,u,p,_,E)};var Ll=function(n,o,u,p){this.kind=n,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!ls(o.expression),this.interpolationType=p};function ac(n,o){if((n=Rl(n,o)).result==="error")return n;var u=n.value.expression,p=Ho(u);if(!p&&!Ks(o))return Du([new Rr("","data expressions not supported")]);var _=gs(u,["zoom"]);if(!_&&!rc(o))return Du([new Rr("","zoom expressions not supported")]);var E=function A(O){var B=null;if(O instanceof Rt)B=A(O.result);else if(O instanceof Dt)for(var j=0,H=O.args;j<H.length&&!(B=A(H[j]));j+=1);else(O instanceof ys||O instanceof Ie)&&O.input instanceof lo&&O.input.name==="zoom"&&(B=O);return B instanceof Rr||O.eachChild(function(te){var ce=A(te);ce instanceof Rr?B=ce:!B&&ce?B=new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):B&&ce&&B!==ce&&(B=new Rr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),B}(u);return E||_?E instanceof Rr?Du([E]):E instanceof Ie&&!qu(o)?Du([new Rr("",'"interpolate" expressions cannot be used with this property')]):gf(E?new Ll(p?"camera":"composite",n.value,E.labels,E instanceof Ie?E.interpolation:void 0):new ic(p?"constant":"source",n.value)):Du([new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Ll.prototype.evaluateWithoutErrorHandling=function(n,o,u,p,_,E){return this._styleExpression.evaluateWithoutErrorHandling(n,o,u,p,_,E)},Ll.prototype.evaluate=function(n,o,u,p,_,E){return this._styleExpression.evaluate(n,o,u,p,_,E)},Ll.prototype.interpolationFactor=function(n,o,u){return this.interpolationType?Ie.interpolationFactor(this.interpolationType,n,o,u):0};var kl=function(n,o){this._parameters=n,this._specification=o,Ir(this,function u(p,_){var E,A,O,B=_.type==="color",j=p.stops&&typeof p.stops[0][0]=="object",H=j||!(j||p.property!==void 0),te=p.type||(qu(_)?"exponential":"interval");if(B&&((p=Ir({},p)).stops&&(p.stops=p.stops.map(function(In){return[In[0],Hi.parse(In[1])]})),p.default=Hi.parse(p.default?p.default:_.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!se[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(te==="exponential")E=Ih;else if(te==="interval")E=up;else if(te==="categorical"){E=zs,A=Object.create(null);for(var ce=0,_e=p.stops;ce<_e.length;ce+=1){var Ue=_e[ce];A[Ue[0]]=Ue[1]}O=typeof p.stops[0][0]}else{if(te!=="identity")throw new Error('Unknown function type "'+te+'"');E=yf}if(j){for(var He={},ft=[],rt=0;rt<p.stops.length;rt++){var Lt=p.stops[rt],$t=Lt[0].zoom;He[$t]===void 0&&(He[$t]={zoom:$t,type:p.type,property:p.property,default:p.default,stops:[]},ft.push($t)),He[$t].stops.push([Lt[0].value,Lt[1]])}for(var Mt=[],Pt=0,Cr=ft;Pt<Cr.length;Pt+=1){var Xr=Cr[Pt];Mt.push([He[Xr].zoom,u(He[Xr],_)])}var pn={name:"linear"};return{kind:"composite",interpolationType:pn,interpolationFactor:Ie.interpolationFactor.bind(void 0,pn),zoomStops:Mt.map(function(In){return In[0]}),evaluate:function(In,oi){var Rn=In.zoom;return Ih({stops:Mt,base:p.base},_,Rn).evaluate(Rn,oi)}}}if(H){var ti=te==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:ti,interpolationFactor:Ie.interpolationFactor.bind(void 0,ti),zoomStops:p.stops.map(function(In){return In[0]}),evaluate:function(In){return E(p,_,In.zoom,A,O)}}}return{kind:"source",evaluate:function(In,oi){var Rn=oi&&oi.properties?oi.properties[p.property]:void 0;return Rn===void 0?Il(p.default,_.default):E(p,_,Rn,A,O)}}}(this._parameters,this._specification))};function $s(n){var o=n.key,u=n.value,p=n.valueSpec||{},_=n.objectElementValidators||{},E=n.style,A=n.styleSpec,O=[],B=Aa(u);if(B!=="object")return[new Ye(o,u,"object expected, "+B+" found")];for(var j in u){var H=j.split(".")[0],te=p[H]||p["*"],ce=void 0;if(_[H])ce=_[H];else if(p[H])ce=Ci;else if(_["*"])ce=_["*"];else{if(!p["*"]){O.push(new Ye(o,u[j],'unknown property "'+j+'"'));continue}ce=Ci}O=O.concat(ce({key:(o&&o+".")+j,value:u[j],valueSpec:te,style:E,styleSpec:A,object:u,objectKey:j},u))}for(var _e in p)_[_e]||p[_e].required&&p[_e].default===void 0&&u[_e]===void 0&&O.push(new Ye(o,u,'missing required property "'+_e+'"'));return O}function _f(n){var o=n.value,u=n.valueSpec,p=n.style,_=n.styleSpec,E=n.key,A=n.arrayElementValidator||Ci;if(Aa(o)!=="array")return[new Ye(E,o,"array expected, "+Aa(o)+" found")];if(u.length&&o.length!==u.length)return[new Ye(E,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new Ye(E,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var O={type:u.value,values:u.values};_.$version<7&&(O.function=u.function),Aa(u.value)==="object"&&(O=u.value);for(var B=[],j=0;j<o.length;j++)B=B.concat(A({array:o,arrayIndex:j,value:o[j],valueSpec:O,style:p,styleSpec:_,key:E+"["+j+"]"}));return B}function xf(n){var o=n.key,u=n.value,p=n.valueSpec,_=Aa(u);return _==="number"&&u!=u&&(_="NaN"),_!=="number"?[new Ye(o,u,"number expected, "+_+" found")]:"minimum"in p&&u<p.minimum?[new Ye(o,u,u+" is less than the minimum value "+p.minimum)]:"maximum"in p&&u>p.maximum?[new Ye(o,u,u+" is greater than the maximum value "+p.maximum)]:[]}function bf(n){var o,u,p,_=n.valueSpec,E=sr(n.value.type),A={},O=E!=="categorical"&&n.value.property===void 0,B=!O,j=Aa(n.value.stops)==="array"&&Aa(n.value.stops[0])==="array"&&Aa(n.value.stops[0][0])==="object",H=$s({key:n.key,value:n.value,valueSpec:n.styleSpec.function,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(_e){if(E==="identity")return[new Ye(_e.key,_e.value,'identity function may not have a "stops" property')];var Ue=[],He=_e.value;return Ue=Ue.concat(_f({key:_e.key,value:He,valueSpec:_e.valueSpec,style:_e.style,styleSpec:_e.styleSpec,arrayElementValidator:te})),Aa(He)==="array"&&He.length===0&&Ue.push(new Ye(_e.key,He,"array must have at least one stop")),Ue},default:function(_e){return Ci({key:_e.key,value:_e.value,valueSpec:_,style:_e.style,styleSpec:_e.styleSpec})}}});return E==="identity"&&O&&H.push(new Ye(n.key,n.value,'missing required property "property"')),E==="identity"||n.value.stops||H.push(new Ye(n.key,n.value,'missing required property "stops"')),E==="exponential"&&n.valueSpec.expression&&!qu(n.valueSpec)&&H.push(new Ye(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(B&&!Ks(n.valueSpec)?H.push(new Ye(n.key,n.value,"property functions not supported")):O&&!rc(n.valueSpec)&&H.push(new Ye(n.key,n.value,"zoom functions not supported"))),E!=="categorical"&&!j||n.value.property!==void 0||H.push(new Ye(n.key,n.value,'"property" property is required')),H;function te(_e){var Ue=[],He=_e.value,ft=_e.key;if(Aa(He)!=="array")return[new Ye(ft,He,"array expected, "+Aa(He)+" found")];if(He.length!==2)return[new Ye(ft,He,"array length 2 expected, length "+He.length+" found")];if(j){if(Aa(He[0])!=="object")return[new Ye(ft,He,"object expected, "+Aa(He[0])+" found")];if(He[0].zoom===void 0)return[new Ye(ft,He,"object stop key must have zoom")];if(He[0].value===void 0)return[new Ye(ft,He,"object stop key must have value")];if(p&&p>sr(He[0].zoom))return[new Ye(ft,He[0].zoom,"stop zoom values must appear in ascending order")];sr(He[0].zoom)!==p&&(p=sr(He[0].zoom),u=void 0,A={}),Ue=Ue.concat($s({key:ft+"[0]",value:He[0],valueSpec:{zoom:{}},style:_e.style,styleSpec:_e.styleSpec,objectElementValidators:{zoom:xf,value:ce}}))}else Ue=Ue.concat(ce({key:ft+"[0]",value:He[0],valueSpec:{},style:_e.style,styleSpec:_e.styleSpec},He));return Ku(cr(He[1]))?Ue.concat([new Ye(ft+"[1]",He[1],"expressions are not allowed in function stops.")]):Ue.concat(Ci({key:ft+"[1]",value:He[1],valueSpec:_,style:_e.style,styleSpec:_e.styleSpec}))}function ce(_e,Ue){var He=Aa(_e.value),ft=sr(_e.value),rt=_e.value!==null?_e.value:Ue;if(o){if(He!==o)return[new Ye(_e.key,rt,He+" stop domain type must match previous stop domain type "+o)]}else o=He;if(He!=="number"&&He!=="string"&&He!=="boolean")return[new Ye(_e.key,rt,"stop domain value must be a number, string, or boolean")];if(He!=="number"&&E!=="categorical"){var Lt="number expected, "+He+" found";return Ks(_)&&E===void 0&&(Lt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(_e.key,rt,Lt)]}return E!=="categorical"||He!=="number"||isFinite(ft)&&Math.floor(ft)===ft?E!=="categorical"&&He==="number"&&u!==void 0&&ft<u?[new Ye(_e.key,rt,"stop domain values must appear in ascending order")]:(u=ft,E==="categorical"&&ft in A?[new Ye(_e.key,rt,"stop domain values must be unique")]:(A[ft]=!0,[])):[new Ye(_e.key,rt,"integer expected, found "+ft)]}}function hl(n){var o=(n.expressionContext==="property"?ac:Rl)(cr(n.value),n.valueSpec);if(o.result==="error")return o.value.map(function(p){return new Ye(""+n.key+p.key,n.value,p.message)});var u=o.value.expression||o.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!u.outputDefined())return[new Ye(n.key,n.value,'Invalid data expression for "'+n.propertyKey+'". Output values must be contained as literals within the expression.')];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!ls(u))return[new Ye(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!ls(u))return[new Ye(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!gs(u,["zoom","feature-state"]))return[new Ye(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Ho(u))return[new Ye(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function oc(n){var o=n.key,u=n.value,p=n.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(sr(u))===-1&&_.push(new Ye(o,u,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(p.values).indexOf(sr(u))===-1&&_.push(new Ye(o,u,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(u)+" found")),_}function Dc(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(var o=0,u=n.slice(1);o<u.length;o+=1){var p=u[o];if(!Dc(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}kl.deserialize=function(n){return new kl(n._parameters,n._specification)},kl.serialize=function(n){return{_parameters:n._parameters,_specification:n._specification}};var Ef={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function $u(n){if(n==null)return{filter:function(){return!0},needGeometry:!1};Dc(n)||(n=Fc(n));var o=Rl(n,Ef);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,p,_){return o.value.evaluate(u,p,{},_)},needGeometry:function u(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var _=1;_<p.length;_++)if(u(p[_]))return!0;return!1}(n)}}function Rh(n,o){return n<o?-1:n>o?1:0}function Fc(n){if(!n)return!0;var o,u=n[0];return n.length<=1?u!=="any":u==="=="?pl(n[1],n[2],"=="):u==="!="?Dl(pl(n[1],n[2],"==")):u==="<"||u===">"||u==="<="||u===">="?pl(n[1],n[2],u):u==="any"?(o=n.slice(1),["any"].concat(o.map(Fc))):u==="all"?["all"].concat(n.slice(1).map(Fc)):u==="none"?["all"].concat(n.slice(1).map(Fc).map(Dl)):u==="in"?sc(n[1],n.slice(2)):u==="!in"?Dl(sc(n[1],n.slice(2))):u==="has"?Jf(n[1]):u==="!has"?Dl(Jf(n[1])):u!=="within"||n}function pl(n,o,u){switch(n){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,n,o]}}function sc(n,o){if(o.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",n,["literal",o.sort(Rh)]]:["filter-in-small",n,["literal",o]]}}function Jf(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Dl(n){return["!",n]}function Lh(n){return Dc(cr(n.value))?hl(Ir({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var p=u.value,_=u.key;if(Aa(p)!=="array")return[new Ye(_,p,"array expected, "+Aa(p)+" found")];var E,A=u.styleSpec,O=[];if(p.length<1)return[new Ye(_,p,"filter array must have at least 1 element")];switch(O=O.concat(oc({key:_+"[0]",value:p[0],valueSpec:A.filter_operator,style:u.style,styleSpec:u.styleSpec})),sr(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&sr(p[1])==="$type"&&O.push(new Ye(_,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&O.push(new Ye(_,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(E=Aa(p[1]))!=="string"&&O.push(new Ye(_+"[1]",p[1],"string expected, "+E+" found"));for(var B=2;B<p.length;B++)E=Aa(p[B]),sr(p[1])==="$type"?O=O.concat(oc({key:_+"["+B+"]",value:p[B],valueSpec:A.geometry_type,style:u.style,styleSpec:u.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&O.push(new Ye(_+"["+B+"]",p[B],"string, number, or boolean expected, "+E+" found"));break;case"any":case"all":case"none":for(var j=1;j<p.length;j++)O=O.concat(o({key:_+"["+j+"]",value:p[j],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":E=Aa(p[1]),p.length!==2?O.push(new Ye(_,p,'filter array for "'+p[0]+'" operator must have 2 elements')):E!=="string"&&O.push(new Ye(_+"[1]",p[1],"string expected, "+E+" found"));break;case"within":E=Aa(p[1]),p.length!==2?O.push(new Ye(_,p,'filter array for "'+p[0]+'" operator must have 2 elements')):E!=="object"&&O.push(new Ye(_+"[1]",p[1],"object expected, "+E+" found"))}return O}(n)}function eh(n,o){var u=n.key,p=n.style,_=n.styleSpec,E=n.value,A=n.objectKey,O=_[o+"_"+n.layerType];if(!O)return[];var B=A.match(/^(.*)-transition$/);if(o==="paint"&&B&&O[B[1]]&&O[B[1]].transition)return Ci({key:u,value:E,valueSpec:_.transition,style:p,styleSpec:_});var j,H=n.valueSpec||O[A];if(!H)return[new Ye(u,E,'unknown property "'+A+'"')];if(Aa(E)==="string"&&Ks(H)&&!H.tokens&&(j=/^{([^}]+)}$/.exec(E)))return[new Ye(u,E,'"'+A+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(j[1])+" }`.")];var te=[];return n.layerType==="symbol"&&(A==="text-field"&&p&&!p.glyphs&&te.push(new Ye(u,E,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&nc(cr(E))&&sr(E.type)==="identity"&&te.push(new Ye(u,E,'"text-font" does not support identity functions'))),te.concat(Ci({key:n.key,value:E,valueSpec:H,style:p,styleSpec:_,expressionContext:"property",propertyType:o,propertyKey:A}))}function th(n){return eh(n,"paint")}function uc(n){return eh(n,"layout")}function Sf(n){var o=[],u=n.value,p=n.key,_=n.style,E=n.styleSpec;u.type||u.ref||o.push(new Ye(p,u,'either "type" or "ref" is required'));var A,O=sr(u.type),B=sr(u.ref);if(u.id)for(var j=sr(u.id),H=0;H<n.arrayIndex;H++){var te=_.layers[H];sr(te.id)===j&&o.push(new Ye(p,u.id,'duplicate layer id "'+u.id+'", previously used at line '+te.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Ue){Ue in u&&o.push(new Ye(p,u[Ue],'"'+Ue+'" is prohibited for ref layers'))}),_.layers.forEach(function(Ue){sr(Ue.id)===B&&(A=Ue)}),A?A.ref?o.push(new Ye(p,u.ref,"ref cannot reference another ref layer")):O=sr(A.type):o.push(new Ye(p,u.ref,'ref layer "'+B+'" not found'));else if(O!=="background")if(u.source){var ce=_.sources&&_.sources[u.source],_e=ce&&sr(ce.type);ce?_e==="vector"&&O==="raster"?o.push(new Ye(p,u.source,'layer "'+u.id+'" requires a raster source')):_e==="raster"&&O!=="raster"?o.push(new Ye(p,u.source,'layer "'+u.id+'" requires a vector source')):_e!=="vector"||u["source-layer"]?_e==="raster-dem"&&O!=="hillshade"?o.push(new Ye(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="line"||!u.paint||!u.paint["line-gradient"]||_e==="geojson"&&ce.lineMetrics||o.push(new Ye(p,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new Ye(p,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new Ye(p,u.source,'source "'+u.source+'" not found'))}else o.push(new Ye(p,u,'missing required property "source"'));return o=o.concat($s({key:p,value:u,valueSpec:E.layer,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Ci({key:p+".type",value:u.type,valueSpec:E.layer.type,style:n.style,styleSpec:n.styleSpec,object:u,objectKey:"type"})},filter:Lh,layout:function(Ue){return $s({layer:u,key:Ue.key,value:Ue.value,style:Ue.style,styleSpec:Ue.styleSpec,objectElementValidators:{"*":function(He){return uc(Ir({layerType:O},He))}}})},paint:function(Ue){return $s({layer:u,key:Ue.key,value:Ue.value,style:Ue.style,styleSpec:Ue.styleSpec,objectElementValidators:{"*":function(He){return th(Ir({layerType:O},He))}}})}}}))}function lc(n){var o=n.value,u=n.key,p=Aa(o);return p!=="string"?[new Ye(u,o,"string expected, "+p+" found")]:[]}var Ka={promoteId:function(n){var o=n.key,u=n.value;if(Aa(u)==="string")return lc({key:o,value:u});var p=[];for(var _ in u)p.push.apply(p,lc({key:o+"."+_,value:u[_]}));return p}};function Bc(n){var o=n.value,u=n.key,p=n.styleSpec,_=n.style;if(!o.type)return[new Ye(u,o,'"type" is required')];var E,A=sr(o.type);switch(A){case"vector":case"raster":case"raster-dem":return $s({key:u,value:o,valueSpec:p["source_"+A.replace("-","_")],style:n.style,styleSpec:p,objectElementValidators:Ka});case"geojson":if(E=$s({key:u,value:o,valueSpec:p.source_geojson,style:_,styleSpec:p,objectElementValidators:Ka}),o.cluster)for(var O in o.clusterProperties){var B=o.clusterProperties[O],j=B[0],H=typeof j=="string"?[j,["accumulated"],["get",O]]:j;E.push.apply(E,hl({key:u+"."+O+".map",value:B[1],expressionContext:"cluster-map"})),E.push.apply(E,hl({key:u+"."+O+".reduce",value:H,expressionContext:"cluster-reduce"}))}return E;case"video":return $s({key:u,value:o,valueSpec:p.source_video,style:_,styleSpec:p});case"image":return $s({key:u,value:o,valueSpec:p.source_image,style:_,styleSpec:p});case"canvas":return[new Ye(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return oc({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:p})}}function Fl(n){var o=n.value,u=n.styleSpec,p=u.light,_=n.style,E=[],A=Aa(o);if(o===void 0)return E;if(A!=="object")return E.concat([new Ye("light",o,"object expected, "+A+" found")]);for(var O in o){var B=O.match(/^(.*)-transition$/);E=E.concat(B&&p[B[1]]&&p[B[1]].transition?Ci({key:O,value:o[O],valueSpec:u.transition,style:_,styleSpec:u}):p[O]?Ci({key:O,value:o[O],valueSpec:p[O],style:_,styleSpec:u}):[new Ye(O,o[O],'unknown property "'+O+'"')])}return E}var Fu={"*":function(){return[]},array:_f,boolean:function(n){var o=n.value,u=n.key,p=Aa(o);return p!=="boolean"?[new Ye(u,o,"boolean expected, "+p+" found")]:[]},number:xf,color:function(n){var o=n.key,u=n.value,p=Aa(u);return p!=="string"?[new Ye(o,u,"color expected, "+p+" found")]:ji(u)===null?[new Ye(o,u,'color expected, "'+u+'" found')]:[]},constants:jt,enum:oc,filter:Lh,function:bf,layer:Sf,object:$s,source:Bc,light:Fl,string:lc,formatted:function(n){return lc(n).length===0?[]:hl(n)},resolvedImage:function(n){return lc(n).length===0?[]:hl(n)}};function Ci(n){var o=n.value,u=n.valueSpec,p=n.styleSpec;return u.expression&&nc(sr(o))?bf(n):u.expression&&Ku(cr(o))?hl(n):u.type&&Fu[u.type]?Fu[u.type](n):$s(Ir({},n,{valueSpec:u.type?p[u.type]:u}))}function Ia(n){var o=n.value,u=n.key,p=lc(n);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new Ye(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new Ye(u,o,'"glyphs" url must include a "{range}" token'))),p}function Gi(n,o){o===void 0&&(o=be);var u=[];return u=u.concat(Ci({key:"",value:n,valueSpec:o.$root,styleSpec:o,style:n,objectElementValidators:{glyphs:Ia,"*":function(){return[]}}})),n.constants&&(u=u.concat(jt({key:"constants",value:n.constants,style:n,styleSpec:o}))),Nc(u)}function Nc(n){return[].concat(n).sort(function(o,u){return o.line-u.line})}function dl(n){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Nc(n.apply(this,o))}}Gi.source=dl(Bc),Gi.light=dl(Fl),Gi.layer=dl(Sf),Gi.filter=dl(Lh),Gi.paintProperty=dl(th),Gi.layoutProperty=dl(uc);var zc=Gi,kh=zc.light,lp=zc.paintProperty,Zc=zc.layoutProperty;function za(n,o){var u=!1;if(o&&o.length)for(var p=0,_=o;p<_.length;p+=1)n.fire(new it(new Error(_[p].message))),u=!0;return u}var Zs=Va;function Va(n,o,u){var p=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var _=new Int32Array(this.arrayBuffer);n=_[0],this.d=(o=_[1])+2*(u=_[2]);for(var E=0;E<this.d*this.d;E++){var A=_[3+E],O=_[3+E+1];p.push(A===O?null:_.subarray(A,O))}var B=_[3+p.length+1];this.keys=_.subarray(_[3+p.length],B),this.bboxes=_.subarray(B),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var j=0;j<this.d*this.d;j++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=n,this.padding=u,this.scale=o/n,this.uid=0;var H=u/o*n;this.min=-H,this.max=n+H}Va.prototype.insert=function(n,o,u,p,_){this._forEachCell(o,u,p,_,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(_)},Va.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Va.prototype._insertCell=function(n,o,u,p,_,E){this.cells[_].push(E)},Va.prototype.query=function(n,o,u,p,_){var E=this.min,A=this.max;if(n<=E&&o<=E&&A<=u&&A<=p&&!_)return Array.prototype.slice.call(this.keys);var O=[];return this._forEachCell(n,o,u,p,this._queryCell,O,{},_),O},Va.prototype._queryCell=function(n,o,u,p,_,E,A,O){var B=this.cells[_];if(B!==null)for(var j=this.keys,H=this.bboxes,te=0;te<B.length;te++){var ce=B[te];if(A[ce]===void 0){var _e=4*ce;(O?O(H[_e+0],H[_e+1],H[_e+2],H[_e+3]):n<=H[_e+2]&&o<=H[_e+3]&&u>=H[_e+0]&&p>=H[_e+1])?(A[ce]=!0,E.push(j[ce])):A[ce]=!1}}},Va.prototype._forEachCell=function(n,o,u,p,_,E,A,O){for(var B=this._convertToCellCoord(n),j=this._convertToCellCoord(o),H=this._convertToCellCoord(u),te=this._convertToCellCoord(p),ce=B;ce<=H;ce++)for(var _e=j;_e<=te;_e++){var Ue=this.d*_e+ce;if((!O||O(this._convertFromCellCoord(ce),this._convertFromCellCoord(_e),this._convertFromCellCoord(ce+1),this._convertFromCellCoord(_e+1)))&&_.call(this,n,o,u,p,Ue,E,A,O))return}},Va.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},Va.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},Va.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,o=3+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var _=new Int32Array(o+u+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var E=o,A=0;A<n.length;A++){var O=n[A];_[3+A]=E,_.set(O,E),E+=O.length}return _[3+n.length]=E,_.set(this.keys,E),_[3+n.length+1]=E+=this.keys.length,_.set(this.bboxes,E),E+=this.bboxes.length,_.buffer};var Bu=re.ImageData,cc=re.ImageBitmap,go={};function Mn(n,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:n,writeable:!1}),go[n]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var $a in Mn("Object",Object),Zs.serialize=function(n,o){var u=n.toArrayBuffer();return o&&o.push(u),{buffer:u}},Zs.deserialize=function(n){return new Zs(n.buffer)},Mn("Grid",Zs),Mn("Color",Hi),Mn("Error",Error),Mn("ResolvedImage",Ea),Mn("StylePropertyFunction",kl),Mn("StyleExpression",fl,{omit:["_evaluator"]}),Mn("ZoomDependentExpression",Ll),Mn("ZoomConstantExpression",ic),Mn("CompoundExpression",lo,{omit:["_evaluate"]}),ku)ku[$a]._classRegistryKey||Mn("Expression_"+$a,ku[$a]);function Qu(n){return n&&typeof ArrayBuffer!="undefined"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function vl(n){return cc&&n instanceof cc}function lu(n,o){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(Qu(n)||vl(n))return o&&o.push(n),n;if(ArrayBuffer.isView(n)){var u=n;return o&&o.push(u.buffer),u}if(n instanceof Bu)return o&&o.push(n.data.buffer),n;if(Array.isArray(n)){for(var p=[],_=0,E=n;_<E.length;_+=1)p.push(lu(E[_],o));return p}if(typeof n=="object"){var A=n.constructor,O=A._classRegistryKey;if(!O)throw new Error("can't serialize object of unregistered class");var B=A.serialize?A.serialize(n,o):{};if(!A.serialize){for(var j in n)if(n.hasOwnProperty(j)&&!(go[O].omit.indexOf(j)>=0)){var H=n[j];B[j]=go[O].shallow.indexOf(j)>=0?H:lu(H,o)}n instanceof Error&&(B.message=n.message)}if(B.$name)throw new Error("$name property is reserved for worker serialization logic.");return O!=="Object"&&(B.$name=O),B}throw new Error("can't serialize object of type "+typeof n)}function Us(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||Qu(n)||vl(n)||ArrayBuffer.isView(n)||n instanceof Bu)return n;if(Array.isArray(n))return n.map(Us);if(typeof n=="object"){var o=n.$name||"Object",u=go[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(n);for(var p=Object.create(u.prototype),_=0,E=Object.keys(n);_<E.length;_+=1){var A=E[_];if(A!=="$name"){var O=n[A];p[A]=go[o].shallow.indexOf(A)>=0?O:Us(O)}}return p}throw new Error("can't deserialize object of type "+typeof n)}var Cf=function(){this.first=!0};Cf.prototype.update=function(n,o){var u=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=u,!0))};var Nr={"Latin-1 Supplement":function(n){return n>=128&&n<=255},Arabic:function(n){return n>=1536&&n<=1791},"Arabic Supplement":function(n){return n>=1872&&n<=1919},"Arabic Extended-A":function(n){return n>=2208&&n<=2303},"Hangul Jamo":function(n){return n>=4352&&n<=4607},"Unified Canadian Aboriginal Syllabics":function(n){return n>=5120&&n<=5759},Khmer:function(n){return n>=6016&&n<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(n){return n>=6320&&n<=6399},"General Punctuation":function(n){return n>=8192&&n<=8303},"Letterlike Symbols":function(n){return n>=8448&&n<=8527},"Number Forms":function(n){return n>=8528&&n<=8591},"Miscellaneous Technical":function(n){return n>=8960&&n<=9215},"Control Pictures":function(n){return n>=9216&&n<=9279},"Optical Character Recognition":function(n){return n>=9280&&n<=9311},"Enclosed Alphanumerics":function(n){return n>=9312&&n<=9471},"Geometric Shapes":function(n){return n>=9632&&n<=9727},"Miscellaneous Symbols":function(n){return n>=9728&&n<=9983},"Miscellaneous Symbols and Arrows":function(n){return n>=11008&&n<=11263},"CJK Radicals Supplement":function(n){return n>=11904&&n<=12031},"Kangxi Radicals":function(n){return n>=12032&&n<=12255},"Ideographic Description Characters":function(n){return n>=12272&&n<=12287},"CJK Symbols and Punctuation":function(n){return n>=12288&&n<=12351},Hiragana:function(n){return n>=12352&&n<=12447},Katakana:function(n){return n>=12448&&n<=12543},Bopomofo:function(n){return n>=12544&&n<=12591},"Hangul Compatibility Jamo":function(n){return n>=12592&&n<=12687},Kanbun:function(n){return n>=12688&&n<=12703},"Bopomofo Extended":function(n){return n>=12704&&n<=12735},"CJK Strokes":function(n){return n>=12736&&n<=12783},"Katakana Phonetic Extensions":function(n){return n>=12784&&n<=12799},"Enclosed CJK Letters and Months":function(n){return n>=12800&&n<=13055},"CJK Compatibility":function(n){return n>=13056&&n<=13311},"CJK Unified Ideographs Extension A":function(n){return n>=13312&&n<=19903},"Yijing Hexagram Symbols":function(n){return n>=19904&&n<=19967},"CJK Unified Ideographs":function(n){return n>=19968&&n<=40959},"Yi Syllables":function(n){return n>=40960&&n<=42127},"Yi Radicals":function(n){return n>=42128&&n<=42191},"Hangul Jamo Extended-A":function(n){return n>=43360&&n<=43391},"Hangul Syllables":function(n){return n>=44032&&n<=55215},"Hangul Jamo Extended-B":function(n){return n>=55216&&n<=55295},"Private Use Area":function(n){return n>=57344&&n<=63743},"CJK Compatibility Ideographs":function(n){return n>=63744&&n<=64255},"Arabic Presentation Forms-A":function(n){return n>=64336&&n<=65023},"Vertical Forms":function(n){return n>=65040&&n<=65055},"CJK Compatibility Forms":function(n){return n>=65072&&n<=65103},"Small Form Variants":function(n){return n>=65104&&n<=65135},"Arabic Presentation Forms-B":function(n){return n>=65136&&n<=65279},"Halfwidth and Fullwidth Forms":function(n){return n>=65280&&n<=65519}};function Af(n){for(var o=0,u=n;o<u.length;o+=1)if(wf(u[o].charCodeAt(0)))return!0;return!1}function wf(n){return!(n!==746&&n!==747&&(n<4352||!(Nr["Bopomofo Extended"](n)||Nr.Bopomofo(n)||Nr["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Nr["CJK Compatibility Ideographs"](n)||Nr["CJK Compatibility"](n)||Nr["CJK Radicals Supplement"](n)||Nr["CJK Strokes"](n)||!(!Nr["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Nr["CJK Unified Ideographs Extension A"](n)||Nr["CJK Unified Ideographs"](n)||Nr["Enclosed CJK Letters and Months"](n)||Nr["Hangul Compatibility Jamo"](n)||Nr["Hangul Jamo Extended-A"](n)||Nr["Hangul Jamo Extended-B"](n)||Nr["Hangul Jamo"](n)||Nr["Hangul Syllables"](n)||Nr.Hiragana(n)||Nr["Ideographic Description Characters"](n)||Nr.Kanbun(n)||Nr["Kangxi Radicals"](n)||Nr["Katakana Phonetic Extensions"](n)||Nr.Katakana(n)&&n!==12540||!(!Nr["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Nr["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Nr["Unified Canadian Aboriginal Syllabics"](n)||Nr["Unified Canadian Aboriginal Syllabics Extended"](n)||Nr["Vertical Forms"](n)||Nr["Yijing Hexagram Symbols"](n)||Nr["Yi Syllables"](n)||Nr["Yi Radicals"](n))))}function Ju(n){return!(wf(n)||function(o){return!!(Nr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Nr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Nr["Letterlike Symbols"](o)||Nr["Number Forms"](o)||Nr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Nr["Control Pictures"](o)&&o!==9251||Nr["Optical Character Recognition"](o)||Nr["Enclosed Alphanumerics"](o)||Nr["Geometric Shapes"](o)||Nr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Nr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Nr["CJK Symbols and Punctuation"](o)||Nr.Katakana(o)||Nr["Private Use Area"](o)||Nr["CJK Compatibility Forms"](o)||Nr["Small Form Variants"](o)||Nr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(n))}function Ba(n){return n>=1424&&n<=2303||Nr["Arabic Presentation Forms-A"](n)||Nr["Arabic Presentation Forms-B"](n)}function Ms(n,o){return!(!o&&Ba(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Nr.Khmer(n))}function Bl(n){for(var o=0,u=n;o<u.length;o+=1)if(Ba(u[o].charCodeAt(0)))return!0;return!1}var cu=null,Ps="unavailable",Ta=null,rh=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Ps="error"),cu&&cu(n)};function Uc(){nh.fire(new Ze("pluginStateChange",{pluginStatus:Ps,pluginURL:Ta}))}var nh=new gt,fc=function(){return Ps},Os=function(){if(Ps!=="deferred"||!Ta)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ps="loading",Uc(),Ta&&ia({url:Ta},function(n){n?rh(n):(Ps="loaded",Uc())})},js={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ps==="loaded"||js.applyArabicShaping!=null},isLoading:function(){return Ps==="loading"},setState:function(n){Ps=n.pluginStatus,Ta=n.pluginURL},isParsed:function(){return js.applyArabicShaping!=null&&js.processBidirectionalText!=null&&js.processStyledBidirectionalText!=null},getPluginURL:function(){return Ta}},Sn=function(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Cf,this.transition={})};Sn.prototype.isSupportedScript=function(n){return function(o,u){for(var p=0,_=o;p<_.length;p+=1)if(!Ms(_[p].charCodeAt(0),u))return!1;return!0}(n,js.isLoaded())},Sn.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Sn.prototype.getCrossfadeParameters=function(){var n=this.zoom,o=n-Math.floor(n),u=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var Su=function(n,o){this.property=n,this.value=o,this.expression=function(u,p){if(nc(u))return new kl(u,p);if(Ku(u)){var _=ac(u,p);if(_.result==="error")throw new Error(_.value.map(function(A){return A.key+": "+A.message}).join(", "));return _.value}var E=u;return typeof u=="string"&&p.type==="color"&&(E=Hi.parse(u)),{kind:"constant",evaluate:function(){return E}}}(o===void 0?n.specification.default:o,n.specification)};Su.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Su.prototype.possiblyEvaluate=function(n,o,u){return this.property.possiblyEvaluate(this,n,o,u)};var fu=function(n){this.property=n,this.value=new Su(n,void 0)};fu.prototype.transitioned=function(n,o){return new el(this.property,this.value,o,_t({},n.transition,this.transition),n.now)},fu.prototype.untransitioned=function(){return new el(this.property,this.value,null,{},0)};var es=function(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)};es.prototype.getValue=function(n){return nt(this._values[n].value.value)},es.prototype.setValue=function(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new fu(this._values[n].property)),this._values[n].value=new Su(this._values[n].property,o===null?void 0:nt(o))},es.prototype.getTransition=function(n){return nt(this._values[n].transition)},es.prototype.setTransition=function(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new fu(this._values[n].property)),this._values[n].transition=nt(o)||void 0},es.prototype.serialize=function(){for(var n={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],_=this.getValue(p);_!==void 0&&(n[p]=_);var E=this.getTransition(p);E!==void 0&&(n[p+"-transition"]=E)}return n},es.prototype.transitioned=function(n,o){for(var u=new Qs(this._properties),p=0,_=Object.keys(this._values);p<_.length;p+=1){var E=_[p];u._values[E]=this._values[E].transitioned(n,o._values[E])}return u},es.prototype.untransitioned=function(){for(var n=new Qs(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o];n._values[p]=this._values[p].untransitioned()}return n};var el=function(n,o,u,p,_){this.property=n,this.value=o,this.begin=_+p.delay||0,this.end=this.begin+p.duration||0,n.specification.transition&&(p.delay||p.duration)&&(this.prior=u)};el.prototype.possiblyEvaluate=function(n,o,u){var p=n.now||0,_=this.value.possiblyEvaluate(n,o,u),E=this.prior;if(E){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return E.possiblyEvaluate(n,o,u);var A=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(n,o,u),_,function(O){if(O<=0)return 0;if(O>=1)return 1;var B=O*O,j=B*O;return 4*(O<.5?j:3*(O-B)+j-.75)}(A))}return _};var Qs=function(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)};Qs.prototype.possiblyEvaluate=function(n,o,u){for(var p=new Js(this._properties),_=0,E=Object.keys(this._values);_<E.length;_+=1){var A=E[_];p._values[A]=this._values[A].possiblyEvaluate(n,o,u)}return p},Qs.prototype.hasTransition=function(){for(var n=0,o=Object.keys(this._values);n<o.length;n+=1)if(this._values[o[n]].prior)return!0;return!1};var Vs=function(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)};Vs.prototype.getValue=function(n){return nt(this._values[n].value)},Vs.prototype.setValue=function(n,o){this._values[n]=new Su(this._values[n].property,o===null?void 0:nt(o))},Vs.prototype.serialize=function(){for(var n={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],_=this.getValue(p);_!==void 0&&(n[p]=_)}return n},Vs.prototype.possiblyEvaluate=function(n,o,u){for(var p=new Js(this._properties),_=0,E=Object.keys(this._values);_<E.length;_+=1){var A=E[_];p._values[A]=this._values[A].possiblyEvaluate(n,o,u)}return p};var bs=function(n,o,u){this.property=n,this.value=o,this.parameters=u};bs.prototype.isConstant=function(){return this.value.kind==="constant"},bs.prototype.constantOr=function(n){return this.value.kind==="constant"?this.value.value:n},bs.prototype.evaluate=function(n,o,u,p){return this.property.evaluate(this.value,this.parameters,n,o,u,p)};var Js=function(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)};Js.prototype.get=function(n){return this._values[n]};var Kn=function(n){this.specification=n};Kn.prototype.possiblyEvaluate=function(n,o){return n.expression.evaluate(o)},Kn.prototype.interpolate=function(n,o,u){var p=_o[this.specification.type];return p?p(n,o,u):n};var jn=function(n,o){this.specification=n,this.overrides=o};jn.prototype.possiblyEvaluate=function(n,o,u,p){return new bs(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},u,p)}:n.expression,o)},jn.prototype.interpolate=function(n,o,u){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new bs(this,{kind:"constant",value:void 0},n.parameters);var p=_o[this.specification.type];return p?new bs(this,{kind:"constant",value:p(n.value.value,o.value.value,u)},n.parameters):n},jn.prototype.evaluate=function(n,o,u,p,_,E){return n.kind==="constant"?n.value:n.evaluate(o,u,p,_,E)};var Nl=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p,_,E){if(u.value===void 0)return new bs(this,{kind:"constant",value:void 0},p);if(u.expression.kind==="constant"){var A=u.expression.evaluate(p,null,{},_,E),O=u.property.specification.type==="resolvedImage"&&typeof A!="string"?A.name:A,B=this._calculate(O,O,O,p);return new bs(this,{kind:"constant",value:B},p)}if(u.expression.kind==="camera"){var j=this._calculate(u.expression.evaluate({zoom:p.zoom-1}),u.expression.evaluate({zoom:p.zoom}),u.expression.evaluate({zoom:p.zoom+1}),p);return new bs(this,{kind:"constant",value:j},p)}return new bs(this,u.expression,p)},o.prototype.evaluate=function(u,p,_,E,A,O){if(u.kind==="source"){var B=u.evaluate(p,_,E,A,O);return this._calculate(B,B,B,p)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(p.zoom)-1},_,E),u.evaluate({zoom:Math.floor(p.zoom)},_,E),u.evaluate({zoom:Math.floor(p.zoom)+1},_,E),p):u.value},o.prototype._calculate=function(u,p,_,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:u,to:p}:{from:_,to:p}},o.prototype.interpolate=function(u){return u},o}(jn),Es=function(n){this.specification=n};Es.prototype.possiblyEvaluate=function(n,o,u,p){if(n.value!==void 0){if(n.expression.kind==="constant"){var _=n.expression.evaluate(o,null,{},u,p);return this._calculate(_,_,_,o)}return this._calculate(n.expression.evaluate(new Sn(Math.floor(o.zoom-1),o)),n.expression.evaluate(new Sn(Math.floor(o.zoom),o)),n.expression.evaluate(new Sn(Math.floor(o.zoom+1),o)),o)}},Es.prototype._calculate=function(n,o,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:n,to:o}:{from:u,to:o}},Es.prototype.interpolate=function(n){return n};var Gs=function(n){this.specification=n};Gs.prototype.possiblyEvaluate=function(n,o,u,p){return!!n.expression.evaluate(o,null,{},u,p)},Gs.prototype.interpolate=function(){return!1};var ts=function(n){for(var o in this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],n){var u=n[o];u.specification.overridable&&this.overridableProperties.push(o);var p=this.defaultPropertyValues[o]=new Su(u,void 0),_=this.defaultTransitionablePropertyValues[o]=new fu(u);this.defaultTransitioningPropertyValues[o]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}};Mn("DataDrivenProperty",jn),Mn("DataConstantProperty",Kn),Mn("CrossFadedDataDrivenProperty",Nl),Mn("CrossFadedProperty",Es),Mn("ColorRampProperty",Gs);var Nu=function(n){function o(u,p){if(n.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),p.layout&&(this._unevaluatedLayout=new Vs(p.layout)),p.paint)){for(var _ in this._transitionablePaint=new es(p.paint),u.paint)this.setPaintProperty(_,u.paint[_],{validate:!1});for(var E in u.layout)this.setLayoutProperty(E,u.layout[E],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Js(p.paint)}}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,p,_){_===void 0&&(_={}),p!=null&&this._validate(Zc,"layers."+this.id+".layout."+u,u,p,_)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,p):this.visibility=p)},o.prototype.getPaintProperty=function(u){return ee(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,p,_){if(_===void 0&&(_={}),p!=null&&this._validate(lp,"layers."+this.id+".paint."+u,u,p,_))return!1;if(ee(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),p||void 0),!1;var E=this._transitionablePaint._values[u],A=E.property.specification["property-type"]==="cross-faded-data-driven",O=E.value.isDataDriven(),B=E.value;this._transitionablePaint.setValue(u,p),this._handleSpecialPaintPropertyUpdate(u);var j=this._transitionablePaint._values[u].value;return j.isDataDriven()||O||A||this._handleOverridablePaintPropertyUpdate(u,B,j)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,_){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,p){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,p)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),At(u,function(p,_){return!(p===void 0||_==="layout"&&!Object.keys(p).length||_==="paint"&&!Object.keys(p).length)})},o.prototype._validate=function(u,p,_,E,A){return A===void 0&&(A={}),(!A||A.validate!==!1)&&za(this,u.call(zc,{key:p,layerType:this.type,objectKey:_,value:E,styleSpec:be,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var p=this.paint.get(u);if(p instanceof bs&&Ks(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},o}(gt),jc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Vc=function(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},va=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ma(n,o){o===void 0&&(o=1);var u=0,p=0;return{members:n.map(function(_){var E=jc[_.type].BYTES_PER_ELEMENT,A=u=ih(u,Math.max(o,E)),O=_.components||1;return p=Math.max(p,E),u+=E*O,{name:_.name,type:_.type,components:O,offset:A}}),size:ih(u,Math.max(p,o)),alignment:o}}function ih(n,o){return Math.ceil(n/o)*o}va.serialize=function(n,o){return n._trim(),o&&(n.isTransferred=!0,o.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}},va.deserialize=function(n){var o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},va.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},va.prototype.clear=function(){this.length=0},va.prototype.resize=function(n){this.reserve(n),this.length=n},va.prototype.reserve=function(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},va.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var zl=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var _=this.length;return this.resize(_+1),this.emplace(_,u,p)},o.prototype.emplace=function(u,p,_){var E=2*u;return this.int16[E+0]=p,this.int16[E+1]=_,u},o}(va);zl.prototype.bytesPerElement=4,Mn("StructArrayLayout2i4",zl);var Hs=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_,E){var A=this.length;return this.resize(A+1),this.emplace(A,u,p,_,E)},o.prototype.emplace=function(u,p,_,E,A){var O=4*u;return this.int16[O+0]=p,this.int16[O+1]=_,this.int16[O+2]=E,this.int16[O+3]=A,u},o}(va);Hs.prototype.bytesPerElement=8,Mn("StructArrayLayout4i8",Hs);var Cu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_,E,A,O){var B=this.length;return this.resize(B+1),this.emplace(B,u,p,_,E,A,O)},o.prototype.emplace=function(u,p,_,E,A,O,B){var j=6*u;return this.int16[j+0]=p,this.int16[j+1]=_,this.int16[j+2]=E,this.int16[j+3]=A,this.int16[j+4]=O,this.int16[j+5]=B,u},o}(va);Cu.prototype.bytesPerElement=12,Mn("StructArrayLayout2i4i12",Cu);var wo=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_,E,A,O){var B=this.length;return this.resize(B+1),this.emplace(B,u,p,_,E,A,O)},o.prototype.emplace=function(u,p,_,E,A,O,B){var j=4*u,H=8*u;return this.int16[j+0]=p,this.int16[j+1]=_,this.uint8[H+4]=E,this.uint8[H+5]=A,this.uint8[H+6]=O,this.uint8[H+7]=B,u},o}(va);wo.prototype.bytesPerElement=8,Mn("StructArrayLayout2i4ub8",wo);var ml=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var _=this.length;return this.resize(_+1),this.emplace(_,u,p)},o.prototype.emplace=function(u,p,_){var E=2*u;return this.float32[E+0]=p,this.float32[E+1]=_,u},o}(va);ml.prototype.bytesPerElement=8,Mn("StructArrayLayout2f8",ml);var hu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_,E,A,O,B,j,H,te){var ce=this.length;return this.resize(ce+1),this.emplace(ce,u,p,_,E,A,O,B,j,H,te)},o.prototype.emplace=function(u,p,_,E,A,O,B,j,H,te,ce){var _e=10*u;return this.uint16[_e+0]=p,this.uint16[_e+1]=_,this.uint16[_e+2]=E,this.uint16[_e+3]=A,this.uint16[_e+4]=O,this.uint16[_e+5]=B,this.uint16[_e+6]=j,this.uint16[_e+7]=H,this.uint16[_e+8]=te,this.uint16[_e+9]=ce,u},o}(va);hu.prototype.bytesPerElement=20,Mn("StructArrayLayout10ui20",hu);var Zl=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_,E,A,O,B,j,H,te,ce,_e){var Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,u,p,_,E,A,O,B,j,H,te,ce,_e)},o.prototype.emplace=function(u,p,_,E,A,O,B,j,H,te,ce,_e,Ue){var He=12*u;return this.int16[He+0]=p,this.int16[He+1]=_,this.int16[He+2]=E,this.int16[He+3]=A,this.uint16[He+4]=O,this.uint16[He+5]=B,this.uint16[He+6]=j,this.uint16[He+7]=H,this.int16[He+8]=te,this.int16[He+9]=ce,this.int16[He+10]=_e,this.int16[He+11]=Ue,u},o}(va);Zl.prototype.bytesPerElement=24,Mn("StructArrayLayout4i4ui4i24",Zl);var hc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_){var E=this.length;return this.resize(E+1),this.emplace(E,u,p,_)},o.prototype.emplace=function(u,p,_,E){var A=3*u;return this.float32[A+0]=p,this.float32[A+1]=_,this.float32[A+2]=E,u},o}(va);hc.prototype.bytesPerElement=12,Mn("StructArrayLayout3f12",hc);var pc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint32[1*u+0]=p,u},o}(va);pc.prototype.bytesPerElement=4,Mn("StructArrayLayout1ul4",pc);var Tf=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_,E,A,O,B,j,H){var te=this.length;return this.resize(te+1),this.emplace(te,u,p,_,E,A,O,B,j,H)},o.prototype.emplace=function(u,p,_,E,A,O,B,j,H,te){var ce=10*u,_e=5*u;return this.int16[ce+0]=p,this.int16[ce+1]=_,this.int16[ce+2]=E,this.int16[ce+3]=A,this.int16[ce+4]=O,this.int16[ce+5]=B,this.uint32[_e+3]=j,this.uint16[ce+8]=H,this.uint16[ce+9]=te,u},o}(va);Tf.prototype.bytesPerElement=20,Mn("StructArrayLayout6i1ul2ui20",Tf);var dc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_,E,A,O){var B=this.length;return this.resize(B+1),this.emplace(B,u,p,_,E,A,O)},o.prototype.emplace=function(u,p,_,E,A,O,B){var j=6*u;return this.int16[j+0]=p,this.int16[j+1]=_,this.int16[j+2]=E,this.int16[j+3]=A,this.int16[j+4]=O,this.int16[j+5]=B,u},o}(va);dc.prototype.bytesPerElement=12,Mn("StructArrayLayout2i2i2i12",dc);var Ss=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_,E,A){var O=this.length;return this.resize(O+1),this.emplace(O,u,p,_,E,A)},o.prototype.emplace=function(u,p,_,E,A,O){var B=4*u,j=8*u;return this.float32[B+0]=p,this.float32[B+1]=_,this.float32[B+2]=E,this.int16[j+6]=A,this.int16[j+7]=O,u},o}(va);Ss.prototype.bytesPerElement=16,Mn("StructArrayLayout2f1f2i16",Ss);var Dh=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_,E){var A=this.length;return this.resize(A+1),this.emplace(A,u,p,_,E)},o.prototype.emplace=function(u,p,_,E,A){var O=12*u,B=3*u;return this.uint8[O+0]=p,this.uint8[O+1]=_,this.float32[B+1]=E,this.float32[B+2]=A,u},o}(va);Dh.prototype.bytesPerElement=12,Mn("StructArrayLayout2ub2f12",Dh);var Ul=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_){var E=this.length;return this.resize(E+1),this.emplace(E,u,p,_)},o.prototype.emplace=function(u,p,_,E){var A=3*u;return this.uint16[A+0]=p,this.uint16[A+1]=_,this.uint16[A+2]=E,u},o}(va);Ul.prototype.bytesPerElement=6,Mn("StructArrayLayout3ui6",Ul);var gl=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_,E,A,O,B,j,H,te,ce,_e,Ue,He,ft,rt,Lt){var $t=this.length;return this.resize($t+1),this.emplace($t,u,p,_,E,A,O,B,j,H,te,ce,_e,Ue,He,ft,rt,Lt)},o.prototype.emplace=function(u,p,_,E,A,O,B,j,H,te,ce,_e,Ue,He,ft,rt,Lt,$t){var Mt=24*u,Pt=12*u,Cr=48*u;return this.int16[Mt+0]=p,this.int16[Mt+1]=_,this.uint16[Mt+2]=E,this.uint16[Mt+3]=A,this.uint32[Pt+2]=O,this.uint32[Pt+3]=B,this.uint32[Pt+4]=j,this.uint16[Mt+10]=H,this.uint16[Mt+11]=te,this.uint16[Mt+12]=ce,this.float32[Pt+7]=_e,this.float32[Pt+8]=Ue,this.uint8[Cr+36]=He,this.uint8[Cr+37]=ft,this.uint8[Cr+38]=rt,this.uint32[Pt+10]=Lt,this.int16[Mt+22]=$t,u},o}(va);gl.prototype.bytesPerElement=48,Mn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",gl);var ah=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_,E,A,O,B,j,H,te,ce,_e,Ue,He,ft,rt,Lt,$t,Mt,Pt,Cr,Xr,pn,ti,In,oi,Rn,Xi){var _i=this.length;return this.resize(_i+1),this.emplace(_i,u,p,_,E,A,O,B,j,H,te,ce,_e,Ue,He,ft,rt,Lt,$t,Mt,Pt,Cr,Xr,pn,ti,In,oi,Rn,Xi)},o.prototype.emplace=function(u,p,_,E,A,O,B,j,H,te,ce,_e,Ue,He,ft,rt,Lt,$t,Mt,Pt,Cr,Xr,pn,ti,In,oi,Rn,Xi,_i){var Gn=34*u,ea=17*u;return this.int16[Gn+0]=p,this.int16[Gn+1]=_,this.int16[Gn+2]=E,this.int16[Gn+3]=A,this.int16[Gn+4]=O,this.int16[Gn+5]=B,this.int16[Gn+6]=j,this.int16[Gn+7]=H,this.uint16[Gn+8]=te,this.uint16[Gn+9]=ce,this.uint16[Gn+10]=_e,this.uint16[Gn+11]=Ue,this.uint16[Gn+12]=He,this.uint16[Gn+13]=ft,this.uint16[Gn+14]=rt,this.uint16[Gn+15]=Lt,this.uint16[Gn+16]=$t,this.uint16[Gn+17]=Mt,this.uint16[Gn+18]=Pt,this.uint16[Gn+19]=Cr,this.uint16[Gn+20]=Xr,this.uint16[Gn+21]=pn,this.uint16[Gn+22]=ti,this.uint32[ea+12]=In,this.float32[ea+13]=oi,this.float32[ea+14]=Rn,this.float32[ea+15]=Xi,this.float32[ea+16]=_i,u},o}(va);ah.prototype.bytesPerElement=68,Mn("StructArrayLayout8i15ui1ul4f68",ah);var pu=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.float32[1*u+0]=p,u},o}(va);pu.prototype.bytesPerElement=4,Mn("StructArrayLayout1f4",pu);var Is=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_){var E=this.length;return this.resize(E+1),this.emplace(E,u,p,_)},o.prototype.emplace=function(u,p,_,E){var A=3*u;return this.int16[A+0]=p,this.int16[A+1]=_,this.int16[A+2]=E,u},o}(va);Is.prototype.bytesPerElement=6,Mn("StructArrayLayout3i6",Is);var jl=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_){var E=this.length;return this.resize(E+1),this.emplace(E,u,p,_)},o.prototype.emplace=function(u,p,_,E){var A=4*u;return this.uint32[2*u+0]=p,this.uint16[A+2]=_,this.uint16[A+3]=E,u},o}(va);jl.prototype.bytesPerElement=8,Mn("StructArrayLayout1ul2ui8",jl);var vc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var _=this.length;return this.resize(_+1),this.emplace(_,u,p)},o.prototype.emplace=function(u,p,_){var E=2*u;return this.uint16[E+0]=p,this.uint16[E+1]=_,u},o}(va);vc.prototype.bytesPerElement=4,Mn("StructArrayLayout2ui4",vc);var Mf=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint16[1*u+0]=p,u},o}(va);Mf.prototype.bytesPerElement=2,Mn("StructArrayLayout1ui2",Mf);var mc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,_,E){var A=this.length;return this.resize(A+1),this.emplace(A,u,p,_,E)},o.prototype.emplace=function(u,p,_,E,A){var O=4*u;return this.float32[O+0]=p,this.float32[O+1]=_,this.float32[O+2]=E,this.float32[O+3]=A,u},o}(va);mc.prototype.bytesPerElement=16,Mn("StructArrayLayout4f16",mc);var c=function(n){function o(){n.apply(this,arguments)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new ne(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(Vc);c.prototype.size=20;var h=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(Tf);Mn("CollisionBoxArray",h);var f=function(n){function o(){n.apply(this,arguments)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(Vc);f.prototype.size=48;var v=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.get=function(u){return new f(this,u)},o}(gl);Mn("PlacedSymbolArray",v);var S=function(n){function o(){n.apply(this,arguments)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(Vc);S.prototype.size=68;var T=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.get=function(u){return new S(this,u)},o}(ah);Mn("SymbolInstanceArray",T);var P=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(pu);Mn("GlyphOffsetArray",P);var D=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(Is);Mn("SymbolLineVertexArray",D);var G=function(n){function o(){n.apply(this,arguments)}n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(Vc);G.prototype.size=8;var Q=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.get=function(u){return new G(this,u)},o}(jl);Mn("FeatureIndexArray",Q);var ge=Ma([{name:"a_pos",components:2,type:"Int16"}],4).members,Ee=function(n){n===void 0&&(n=[]),this.segments=n};function Se(n,o){return 256*(n=Je(Math.floor(n),0,255))+Je(Math.floor(o),0,255)}Ee.prototype.prepareSegment=function(n,o,u,p){var _=this.segments[this.segments.length-1];return n>Ee.MAX_VERTEX_ARRAY_LENGTH&&ut("Max vertices per segment is "+Ee.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+n),(!_||_.vertexLength+n>Ee.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p)&&(_={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(_.sortKey=p),this.segments.push(_)),_},Ee.prototype.get=function(){return this.segments},Ee.prototype.destroy=function(){for(var n=0,o=this.segments;n<o.length;n+=1){var u=o[n];for(var p in u.vaos)u.vaos[p].destroy()}},Ee.simpleSegment=function(n,o,u,p){return new Ee([{vertexOffset:n,primitiveOffset:o,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])},Ee.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Mn("SegmentVector",Ee);var We=Ma([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),je=fe(function(n){n.exports=function(o,u){var p,_,E,A,O,B,j,H;for(_=o.length-(p=3&o.length),E=u,O=3432918353,B=461845907,H=0;H<_;)j=255&o.charCodeAt(H)|(255&o.charCodeAt(++H))<<8|(255&o.charCodeAt(++H))<<16|(255&o.charCodeAt(++H))<<24,++H,E=27492+(65535&(A=5*(65535&(E=(E^=j=(65535&(j=(j=(65535&j)*O+(((j>>>16)*O&65535)<<16)&4294967295)<<15|j>>>17))*B+(((j>>>16)*B&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(j=0,p){case 3:j^=(255&o.charCodeAt(H+2))<<16;case 2:j^=(255&o.charCodeAt(H+1))<<8;case 1:E^=j=(65535&(j=(j=(65535&(j^=255&o.charCodeAt(H)))*O+(((j>>>16)*O&65535)<<16)&4294967295)<<15|j>>>17))*B+(((j>>>16)*B&65535)<<16)&4294967295}return E^=o.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}}),lt=fe(function(n){n.exports=function(o,u){for(var p,_=o.length,E=u^_,A=0;_>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(A)|(255&o.charCodeAt(++A))<<8|(255&o.charCodeAt(++A))<<16|(255&o.charCodeAt(++A))<<24))+((1540483477*(p>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),_-=4,++A;switch(_){case 3:E^=(255&o.charCodeAt(A+2))<<16;case 2:E^=(255&o.charCodeAt(A+1))<<8;case 1:E=1540483477*(65535&(E^=255&o.charCodeAt(A)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}}),Re=je,at=lt;Re.murmur3=je,Re.murmur2=at;var mt=function(){this.ids=[],this.positions=[],this.indexed=!1};mt.prototype.add=function(n,o,u,p){this.ids.push(vr(n)),this.positions.push(o,u,p)},mt.prototype.getPositions=function(n){for(var o=vr(n),u=0,p=this.ids.length-1;u<p;){var _=u+p>>1;this.ids[_]>=o?p=_:u=_+1}for(var E=[];this.ids[u]===o;)E.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return E},mt.serialize=function(n,o){var u=new Float64Array(n.ids),p=new Uint32Array(n.positions);return function _(E,A,O,B){for(;O<B;){for(var j=E[O+B>>1],H=O-1,te=B+1;;){do H++;while(E[H]<j);do te--;while(E[te]>j);if(H>=te)break;ur(E,H,te),ur(A,3*H,3*te),ur(A,3*H+1,3*te+1),ur(A,3*H+2,3*te+2)}te-O<B-te?(_(E,A,O,te),O=te+1):(_(E,A,te+1,B),B=te)}}(u,p,0,u.length-1),o&&o.push(u.buffer,p.buffer),{ids:u,positions:p}},mt.deserialize=function(n){var o=new mt;return o.ids=n.ids,o.positions=n.positions,o.indexed=!0,o};var Wt=Math.pow(2,53)-1;function vr(n){var o=+n;return!isNaN(o)&&o<=Wt?o:Re(String(n))}function ur(n,o,u){var p=n[o];n[o]=n[u],n[u]=p}Mn("FeaturePositionMap",mt);var hr=function(n,o){this.gl=n.gl,this.location=o},Lr=function(n){function o(u,p){n.call(this,u,p),this.current=0}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(hr),Jr=function(n){function o(u,p){n.call(this,u,p),this.current=0}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(hr),Yr=function(n){function o(u,p){n.call(this,u,p),this.current=[0,0]}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(hr),yn=function(n){function o(u,p){n.call(this,u,p),this.current=[0,0,0]}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(hr),Jn=function(n){function o(u,p){n.call(this,u,p),this.current=[0,0,0,0]}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(hr),ei=function(n){function o(u,p){n.call(this,u,p),this.current=Hi.transparent}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(hr),ni=new Float32Array(16),Wi=function(n){function o(u,p){n.call(this,u,p),this.current=ni}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var p=1;p<16;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(hr);function bn(n){return[Se(255*n.r,255*n.g),Se(255*n.b,255*n.a)]}var pi=function(n,o,u){this.value=n,this.uniformNames=o.map(function(p){return"u_"+p}),this.type=u};pi.prototype.setUniform=function(n,o,u){n.set(u.constantOr(this.value))},pi.prototype.getBinding=function(n,o,u){return this.type==="color"?new ei(n,o):new Jr(n,o)};var Ti=function(n,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ti.prototype.setConstantPatternPositions=function(n,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=n.tlbr},Ti.prototype.setUniform=function(n,o,u,p){var _=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&n.set(_)},Ti.prototype.getBinding=function(n,o,u){return u.substr(0,9)==="u_pattern"?new Jn(n,o):new Jr(n,o)};var mi=function(n,o,u,p){this.expression=n,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(_){return{name:"a_"+_,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new p};mi.prototype.populatePaintArray=function(n,o,u,p,_){var E=this.paintVertexArray.length,A=this.expression.evaluate(new Sn(0),o,{},p,[],_);this.paintVertexArray.resize(n),this._setPaintValue(E,n,A)},mi.prototype.updatePaintArray=function(n,o,u,p){var _=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(n,o,_)},mi.prototype._setPaintValue=function(n,o,u){if(this.type==="color")for(var p=bn(u),_=n;_<o;_++)this.paintVertexArray.emplace(_,p[0],p[1]);else{for(var E=n;E<o;E++)this.paintVertexArray.emplace(E,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},mi.prototype.upload=function(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},mi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ui=function(n,o,u,p,_,E){this.expression=n,this.uniformNames=o.map(function(A){return"u_"+A+"_t"}),this.type=u,this.useIntegerZoom=p,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=o.map(function(A){return{name:"a_"+A,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new E};ui.prototype.populatePaintArray=function(n,o,u,p,_){var E=this.expression.evaluate(new Sn(this.zoom),o,{},p,[],_),A=this.expression.evaluate(new Sn(this.zoom+1),o,{},p,[],_),O=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(O,n,E,A)},ui.prototype.updatePaintArray=function(n,o,u,p){var _=this.expression.evaluate({zoom:this.zoom},u,p),E=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(n,o,_,E)},ui.prototype._setPaintValue=function(n,o,u,p){if(this.type==="color")for(var _=bn(u),E=bn(p),A=n;A<o;A++)this.paintVertexArray.emplace(A,_[0],_[1],E[0],E[1]);else{for(var O=n;O<o;O++)this.paintVertexArray.emplace(O,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}},ui.prototype.upload=function(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ui.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ui.prototype.setUniform=function(n,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=Je(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);n.set(p)},ui.prototype.getBinding=function(n,o,u){return new Jr(n,o)};var Oi=function(n,o,u,p,_,E){this.expression=n,this.type=o,this.useIntegerZoom=u,this.zoom=p,this.layerId=E,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};Oi.prototype.populatePaintArray=function(n,o,u){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(p,n,o.patterns&&o.patterns[this.layerId],u)},Oi.prototype.updatePaintArray=function(n,o,u,p,_){this._setPaintValues(n,o,u.patterns&&u.patterns[this.layerId],_)},Oi.prototype._setPaintValues=function(n,o,u,p){if(p&&u){var _=p[u.min],E=p[u.mid],A=p[u.max];if(_&&E&&A)for(var O=n;O<o;O++)this.zoomInPaintVertexArray.emplace(O,E.tl[0],E.tl[1],E.br[0],E.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],E.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(O,E.tl[0],E.tl[1],E.br[0],E.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],E.pixelRatio,A.pixelRatio)}},Oi.prototype.upload=function(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,We.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,We.members,this.expression.isStateDependent))},Oi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var fi=function(n,o,u){this.binders={},this._buffers=[];var p=[];for(var _ in n.paint._values)if(u(_)){var E=n.paint.get(_);if(E instanceof bs&&Ks(E.property.specification)){var A=ho(_,n.type),O=E.value,B=E.property.specification.type,j=E.property.useIntegerZoom,H=E.property.specification["property-type"],te=H==="cross-faded"||H==="cross-faded-data-driven";if(O.kind==="constant")this.binders[_]=te?new Ti(O.value,A):new pi(O.value,A,B),p.push("/u_"+_);else if(O.kind==="source"||te){var ce=Ga(_,B,"source");this.binders[_]=te?new Oi(O,B,j,o,ce,n.id):new mi(O,A,B,ce),p.push("/a_"+_)}else{var _e=Ga(_,B,"composite");this.binders[_]=new ui(O,A,B,j,o,_e),p.push("/z_"+_)}}}this.cacheKey=p.sort().join("")};fi.prototype.getMaxValue=function(n){var o=this.binders[n];return o instanceof mi||o instanceof ui?o.maxValue:0},fi.prototype.populatePaintArrays=function(n,o,u,p,_){for(var E in this.binders){var A=this.binders[E];(A instanceof mi||A instanceof ui||A instanceof Oi)&&A.populatePaintArray(n,o,u,p,_)}},fi.prototype.setConstantPatternPositions=function(n,o){for(var u in this.binders){var p=this.binders[u];p instanceof Ti&&p.setConstantPatternPositions(n,o)}},fi.prototype.updatePaintArrays=function(n,o,u,p,_){var E=!1;for(var A in n)for(var O=0,B=o.getPositions(A);O<B.length;O+=1){var j=B[O],H=u.feature(j.index);for(var te in this.binders){var ce=this.binders[te];if((ce instanceof mi||ce instanceof ui||ce instanceof Oi)&&ce.expression.isStateDependent===!0){var _e=p.paint.get(te);ce.expression=_e.value,ce.updatePaintArray(j.start,j.end,H,n[A],_),E=!0}}}return E},fi.prototype.defines=function(){var n=[];for(var o in this.binders){var u=this.binders[o];(u instanceof pi||u instanceof Ti)&&n.push.apply(n,u.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return n},fi.prototype.getBinderAttributes=function(){var n=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof mi||u instanceof ui)for(var p=0;p<u.paintVertexAttributes.length;p++)n.push(u.paintVertexAttributes[p].name);else if(u instanceof Oi)for(var _=0;_<We.members.length;_++)n.push(We.members[_].name)}return n},fi.prototype.getBinderUniforms=function(){var n=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof pi||u instanceof Ti||u instanceof ui)for(var p=0,_=u.uniformNames;p<_.length;p+=1)n.push(_[p])}return n},fi.prototype.getPaintVertexBuffers=function(){return this._buffers},fi.prototype.getUniforms=function(n,o){var u=[];for(var p in this.binders){var _=this.binders[p];if(_ instanceof pi||_ instanceof Ti||_ instanceof ui)for(var E=0,A=_.uniformNames;E<A.length;E+=1){var O=A[E];if(o[O]){var B=_.getBinding(n,o[O],O);u.push({name:O,property:p,binding:B})}}}return u},fi.prototype.setUniforms=function(n,o,u,p){for(var _=0,E=o;_<E.length;_+=1){var A=E[_],O=A.name,B=A.property;this.binders[B].setUniform(A.binding,p,u.get(B),O)}},fi.prototype.updatePaintBuffers=function(n){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(n&&u instanceof Oi){var p=n.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof mi||u instanceof ui)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},fi.prototype.upload=function(n){for(var o in this.binders){var u=this.binders[o];(u instanceof mi||u instanceof ui||u instanceof Oi)&&u.upload(n)}this.updatePaintBuffers()},fi.prototype.destroy=function(){for(var n in this.binders){var o=this.binders[n];(o instanceof mi||o instanceof ui||o instanceof Oi)&&o.destroy()}};var li=function(n,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var p=0,_=n;p<_.length;p+=1){var E=_[p];this.programConfigurations[E.id]=new fi(E,o,u)}this.needsUpload=!1,this._featureMap=new mt,this._bufferOffset=0};function ho(n,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(o+"-","").replace(/-/g,"_")]}function Ga(n,o,u){var p={color:{source:ml,composite:mc},number:{source:pu,composite:ml}},_=function(E){return{"line-pattern":{source:hu,composite:hu},"fill-pattern":{source:hu,composite:hu},"fill-extrusion-pattern":{source:hu,composite:hu}}[E]}(n);return _&&_[u]||p[o][u]}li.prototype.populatePaintArrays=function(n,o,u,p,_,E){for(var A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(n,o,p,_,E);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0},li.prototype.updatePaintArrays=function(n,o,u,p){for(var _=0,E=u;_<E.length;_+=1){var A=E[_];this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(n,this._featureMap,o,A,p)||this.needsUpload}},li.prototype.get=function(n){return this.programConfigurations[n]},li.prototype.upload=function(n){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}},li.prototype.destroy=function(){for(var n in this.programConfigurations)this.programConfigurations[n].destroy()},Mn("ConstantBinder",pi),Mn("CrossFadedConstantBinder",Ti),Mn("SourceExpressionBinder",mi),Mn("CrossFadedCompositeBinder",Oi),Mn("CompositeExpressionBinder",ui),Mn("ProgramConfiguration",fi,{omit:["_buffers"]}),Mn("ProgramConfigurationSet",li);var Ro=Math.pow(2,14)-1,Lo=-Ro-1;function Qa(n){for(var o=8192/n.extent,u=n.loadGeometry(),p=0;p<u.length;p++)for(var _=u[p],E=0;E<_.length;E++){var A=_[E],O=Math.round(A.x*o),B=Math.round(A.y*o);A.x=Je(O,Lo,Ro),A.y=Je(B,Lo,Ro),(O<A.x||O>A.x+1||B<A.y||B>A.y+1)&&ut("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function po(n,o){return{type:n.type,id:n.id,properties:n.properties,geometry:o?Qa(n):[]}}function Ja(n,o,u,p,_){n.emplaceBack(2*o+(p+1)/2,2*u+(_+1)/2)}var Wo=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new zl,this.indexArray=new Ul,this.segments=new Ee,this.programConfigurations=new li(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function zu(n,o){for(var u=0;u<n.length;u++)if(vu(o,n[u]))return!0;for(var p=0;p<o.length;p++)if(vu(n,o[p]))return!0;return!!Vl(n,o)}function hs(n,o,u){return!!vu(n,o)||!!du(o,n,u)}function Xo(n,o){if(n.length===1)return gc(o,n[0]);for(var u=0;u<o.length;u++)for(var p=o[u],_=0;_<p.length;_++)if(vu(n,p[_]))return!0;for(var E=0;E<n.length;E++)if(gc(o,n[E]))return!0;for(var A=0;A<o.length;A++)if(Vl(n,o[A]))return!0;return!1}function eu(n,o,u){if(n.length>1){if(Vl(n,o))return!0;for(var p=0;p<o.length;p++)if(du(o[p],n,u))return!0}for(var _=0;_<n.length;_++)if(du(n[_],o,u))return!0;return!1}function Vl(n,o){if(n.length===0||o.length===0)return!1;for(var u=0;u<n.length-1;u++)for(var p=n[u],_=n[u+1],E=0;E<o.length-1;E++)if(yl(p,_,o[E],o[E+1]))return!0;return!1}function yl(n,o,u,p){return nr(n,u,p)!==nr(o,u,p)&&nr(n,o,u)!==nr(n,o,p)}function du(n,o,u){var p=u*u;if(o.length===1)return n.distSqr(o[0])<p;for(var _=1;_<o.length;_++)if(Gl(n,o[_-1],o[_])<p)return!0;return!1}function Gl(n,o,u){var p=o.distSqr(u);if(p===0)return n.distSqr(o);var _=((n.x-o.x)*(u.x-o.x)+(n.y-o.y)*(u.y-o.y))/p;return n.distSqr(_<0?o:_>1?u:u.sub(o)._mult(_)._add(o))}function gc(n,o){for(var u,p,_,E=!1,A=0;A<n.length;A++)for(var O=0,B=(u=n[A]).length-1;O<u.length;B=O++)(p=u[O]).y>o.y!=(_=u[B]).y>o.y&&o.x<(_.x-p.x)*(o.y-p.y)/(_.y-p.y)+p.x&&(E=!E);return E}function vu(n,o){for(var u=!1,p=0,_=n.length-1;p<n.length;_=p++){var E=n[p],A=n[_];E.y>o.y!=A.y>o.y&&o.x<(A.x-E.x)*(o.y-E.y)/(A.y-E.y)+E.x&&(u=!u)}return u}function _l(n,o,u){var p=u[0],_=u[2];if(n.x<p.x&&o.x<p.x||n.x>_.x&&o.x>_.x||n.y<p.y&&o.y<p.y||n.y>_.y&&o.y>_.y)return!1;var E=nr(n,o,u[0]);return E!==nr(n,o,u[1])||E!==nr(n,o,u[2])||E!==nr(n,o,u[3])}function Au(n,o,u){var p=o.paint.get(n).value;return p.kind==="constant"?p.value:u.programConfigurations.get(o.id).getMaxValue(n)}function xo(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Zu(n,o,u,p,_){if(!o[0]&&!o[1])return n;var E=ne.convert(o)._mult(_);u==="viewport"&&E._rotate(-p);for(var A=[],O=0;O<n.length;O++)A.push(n[O].sub(E));return A}Wo.prototype.populate=function(n,o,u){var p=this.layers[0],_=[],E=null;p.type==="circle"&&(E=p.layout.get("circle-sort-key"));for(var A=0,O=n;A<O.length;A+=1){var B=O[A],j=B.feature,H=B.id,te=B.index,ce=B.sourceLayerIndex,_e=this.layers[0]._featureFilter.needGeometry,Ue=po(j,_e);if(this.layers[0]._featureFilter.filter(new Sn(this.zoom),Ue,u)){var He=E?E.evaluate(Ue,{},u):void 0,ft={id:H,properties:j.properties,type:j.type,sourceLayerIndex:ce,index:te,geometry:_e?Ue.geometry:Qa(j),patterns:{},sortKey:He};_.push(ft)}}E&&_.sort(function(pn,ti){return pn.sortKey-ti.sortKey});for(var rt=0,Lt=_;rt<Lt.length;rt+=1){var $t=Lt[rt],Mt=$t.geometry,Pt=$t.index,Cr=$t.sourceLayerIndex,Xr=n[Pt].feature;this.addFeature($t,Mt,Pt,u),o.featureIndex.insert(Xr,Mt,Pt,Cr,this.index)}},Wo.prototype.update=function(n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,u)},Wo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Wo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Wo.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ge),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},Wo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Wo.prototype.addFeature=function(n,o,u,p){for(var _=0,E=o;_<E.length;_+=1)for(var A=0,O=E[_];A<O.length;A+=1){var B=O[A],j=B.x,H=B.y;if(!(j<0||j>=8192||H<0||H>=8192)){var te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),ce=te.vertexLength;Ja(this.layoutVertexArray,j,H,-1,-1),Ja(this.layoutVertexArray,j,H,1,-1),Ja(this.layoutVertexArray,j,H,1,1),Ja(this.layoutVertexArray,j,H,-1,1),this.indexArray.emplaceBack(ce,ce+1,ce+2),this.indexArray.emplaceBack(ce,ce+3,ce+2),te.vertexLength+=4,te.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,{},p)},Mn("CircleBucket",Wo,{omit:["layers"]});var tl=new ts({"circle-sort-key":new jn(be.layout_circle["circle-sort-key"])}),Uu={paint:new ts({"circle-radius":new jn(be.paint_circle["circle-radius"]),"circle-color":new jn(be.paint_circle["circle-color"]),"circle-blur":new jn(be.paint_circle["circle-blur"]),"circle-opacity":new jn(be.paint_circle["circle-opacity"]),"circle-translate":new Kn(be.paint_circle["circle-translate"]),"circle-translate-anchor":new Kn(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Kn(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Kn(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new jn(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new jn(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new jn(be.paint_circle["circle-stroke-opacity"])}),layout:tl},aa=typeof Float32Array!="undefined"?Float32Array:Array;function Ws(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function rs(n,o,u){var p=o[0],_=o[1],E=o[2],A=o[3],O=o[4],B=o[5],j=o[6],H=o[7],te=o[8],ce=o[9],_e=o[10],Ue=o[11],He=o[12],ft=o[13],rt=o[14],Lt=o[15],$t=u[0],Mt=u[1],Pt=u[2],Cr=u[3];return n[0]=$t*p+Mt*O+Pt*te+Cr*He,n[1]=$t*_+Mt*B+Pt*ce+Cr*ft,n[2]=$t*E+Mt*j+Pt*_e+Cr*rt,n[3]=$t*A+Mt*H+Pt*Ue+Cr*Lt,n[4]=($t=u[4])*p+(Mt=u[5])*O+(Pt=u[6])*te+(Cr=u[7])*He,n[5]=$t*_+Mt*B+Pt*ce+Cr*ft,n[6]=$t*E+Mt*j+Pt*_e+Cr*rt,n[7]=$t*A+Mt*H+Pt*Ue+Cr*Lt,n[8]=($t=u[8])*p+(Mt=u[9])*O+(Pt=u[10])*te+(Cr=u[11])*He,n[9]=$t*_+Mt*B+Pt*ce+Cr*ft,n[10]=$t*E+Mt*j+Pt*_e+Cr*rt,n[11]=$t*A+Mt*H+Pt*Ue+Cr*Lt,n[12]=($t=u[12])*p+(Mt=u[13])*O+(Pt=u[14])*te+(Cr=u[15])*He,n[13]=$t*_+Mt*B+Pt*ce+Cr*ft,n[14]=$t*E+Mt*j+Pt*_e+Cr*rt,n[15]=$t*A+Mt*H+Pt*Ue+Cr*Lt,n}Math.hypot||(Math.hypot=function(){for(var n=arguments,o=0,u=arguments.length;u--;)o+=n[u]*n[u];return Math.sqrt(o)});var rl,Gc=rs;function Hc(n,o,u){var p=o[0],_=o[1],E=o[2],A=o[3];return n[0]=u[0]*p+u[4]*_+u[8]*E+u[12]*A,n[1]=u[1]*p+u[5]*_+u[9]*E+u[13]*A,n[2]=u[2]*p+u[6]*_+u[10]*E+u[14]*A,n[3]=u[3]*p+u[7]*_+u[11]*E+u[15]*A,n}rl=new aa(3),aa!=Float32Array&&(rl[0]=0,rl[1]=0,rl[2]=0),function(){var n=new aa(4);aa!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0)}();var Pf=(function(){var n=new aa(2);aa!=Float32Array&&(n[0]=0,n[1]=0)}(),function(n){function o(u){n.call(this,u,Uu)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Wo(u)},o.prototype.queryRadius=function(u){var p=u;return Au("circle-radius",this,p)+Au("circle-stroke-width",this,p)+xo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,p,_,E,A,O,B,j){for(var H=Zu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),O.angle,B),te=this.paint.get("circle-radius").evaluate(p,_)+this.paint.get("circle-stroke-width").evaluate(p,_),ce=this.paint.get("circle-pitch-alignment")==="map",_e=ce?H:function(Xr,pn){return Xr.map(function(ti){return tu(ti,pn)})}(H,j),Ue=ce?te*B:te,He=0,ft=E;He<ft.length;He+=1)for(var rt=0,Lt=ft[He];rt<Lt.length;rt+=1){var $t=Lt[rt],Mt=ce?$t:tu($t,j),Pt=Ue,Cr=Hc([],[$t.x,$t.y,0,1],j);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pt*=Cr[3]/O.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pt*=O.cameraToCenterDistance/Cr[3]),hs(_e,Mt,Pt))return!0}return!1},o}(Nu));function tu(n,o){var u=Hc([],[n.x,n.y,0,1],o);return new ne(u[0]/u[3],u[1]/u[3])}var yc=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(Wo);function mu(n,o,u,p){var _=o.width,E=o.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==_*E*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(_*E*u);return n.width=_,n.height=E,n.data=p,n}function xl(n,o,u){var p=o.width,_=o.height;if(p!==n.width||_!==n.height){var E=mu({},{width:p,height:_},u);bl(n,E,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,p),height:Math.min(n.height,_)},u),n.width=p,n.height=_,n.data=E.data}}function bl(n,o,u,p,_,E){if(_.width===0||_.height===0)return o;if(_.width>n.width||_.height>n.height||u.x>n.width-_.width||u.y>n.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>o.width||_.height>o.height||p.x>o.width-_.width||p.y>o.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var A=n.data,O=o.data,B=0;B<_.height;B++)for(var j=((u.y+B)*n.width+u.x)*E,H=((p.y+B)*o.width+p.x)*E,te=0;te<_.width*E;te++)O[H+te]=A[j+te];return o}Mn("HeatmapBucket",yc,{omit:["layers"]});var wu=function(n,o){mu(this,n,1,o)};wu.prototype.resize=function(n){xl(this,n,1)},wu.prototype.clone=function(){return new wu({width:this.width,height:this.height},new Uint8Array(this.data))},wu.copy=function(n,o,u,p,_){bl(n,o,u,p,_,1)};var ko=function(n,o){mu(this,n,4,o)};ko.prototype.resize=function(n){xl(this,n,4)},ko.prototype.replace=function(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n},ko.prototype.clone=function(){return new ko({width:this.width,height:this.height},new Uint8Array(this.data))},ko.copy=function(n,o,u,p,_){bl(n,o,u,p,_,4)},Mn("AlphaImage",wu),Mn("RGBAImage",ko);var Wc={paint:new ts({"heatmap-radius":new jn(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new jn(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Kn(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Gs(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Kn(be.paint_heatmap["heatmap-opacity"])})};function Of(n){var o={},u=n.resolution||256,p=n.clips?n.clips.length:1,_=n.image||new ko({width:u,height:p}),E=function(Ue,He,ft){o[n.evaluationKey]=ft;var rt=n.expression.evaluate(o);_.data[Ue+He+0]=Math.floor(255*rt.r/rt.a),_.data[Ue+He+1]=Math.floor(255*rt.g/rt.a),_.data[Ue+He+2]=Math.floor(255*rt.b/rt.a),_.data[Ue+He+3]=Math.floor(255*rt.a)};if(n.clips)for(var A=0,O=0;A<p;++A,O+=4*u)for(var B=0,j=0;B<u;B++,j+=4){var H=B/(u-1),te=n.clips[A];E(O,j,te.start*(1-H)+te.end*H)}else for(var ce=0,_e=0;ce<u;ce++,_e+=4)E(0,_e,ce/(u-1));return _}var If=function(n){function o(u){n.call(this,u,Wc),this._updateColorRamp()}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.createBucket=function(u){return new yc(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=Of({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(Nu),oh={paint:new ts({"hillshade-illumination-direction":new Kn(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Kn(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Kn(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Kn(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Kn(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Kn(be.paint_hillshade["hillshade-accent-color"])})},cp=function(n){function o(u){n.call(this,u,oh)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(Nu),fp=Ma([{name:"a_pos",components:2,type:"Int16"}],4).members,_c=gu,Rf=gu;function gu(n,o,u){u=u||2;var p,_,E,A,O,B,j,H=o&&o.length,te=H?o[0]*u:n.length,ce=Qp(n,0,te,u,!0),_e=[];if(!ce||ce.next===ce.prev)return _e;if(H&&(ce=function(He,ft,rt,Lt){var $t,Mt,Pt,Cr=[];for($t=0,Mt=ft.length;$t<Mt;$t++)(Pt=Qp(He,ft[$t]*Lt,$t<Mt-1?ft[$t+1]*Lt:He.length,Lt,!1))===Pt.next&&(Pt.steiner=!0),Cr.push(Fh(Pt));for(Cr.sort(kd),$t=0;$t<Cr.length;$t++)Dd(Cr[$t],rt),rt=ru(rt,rt.next);return rt}(n,o,ce,u)),n.length>80*u){p=E=n[0],_=A=n[1];for(var Ue=u;Ue<te;Ue+=u)(O=n[Ue])<p&&(p=O),(B=n[Ue+1])<_&&(_=B),O>E&&(E=O),B>A&&(A=B);j=(j=Math.max(E-p,A-_))!==0?1/j:0}return Lf(ce,_e,u,p,_,j),_e}function Qp(n,o,u,p,_){var E,A;if(_===Kc(n,o,u,p)>0)for(E=o;E<u;E+=p)A=Bh(E,n[E],n[E+1],A);else for(E=u-p;E>=o;E-=p)A=Bh(E,n[E],n[E+1],A);return A&&dp(A,A.next)&&(qc(A),A=A.next),A}function ru(n,o){if(!n)return n;o||(o=n);var u,p=n;do if(u=!1,p.steiner||!dp(p,p.next)&&Fo(p.prev,p,p.next)!==0)p=p.next;else{if(qc(p),(p=o=p.prev)===p.next)break;u=!0}while(u||p!==o);return o}function Lf(n,o,u,p,_,E,A){if(n){!A&&E&&function(H,te,ce,_e){var Ue=H;do Ue.z===null&&(Ue.z=Do(Ue.x,Ue.y,te,ce,_e)),Ue.prevZ=Ue.prev,Ue.nextZ=Ue.next,Ue=Ue.next;while(Ue!==H);Ue.prevZ.nextZ=null,Ue.prevZ=null,function(He){var ft,rt,Lt,$t,Mt,Pt,Cr,Xr,pn=1;do{for(rt=He,He=null,Mt=null,Pt=0;rt;){for(Pt++,Lt=rt,Cr=0,ft=0;ft<pn&&(Cr++,Lt=Lt.nextZ);ft++);for(Xr=pn;Cr>0||Xr>0&&Lt;)Cr!==0&&(Xr===0||!Lt||rt.z<=Lt.z)?($t=rt,rt=rt.nextZ,Cr--):($t=Lt,Lt=Lt.nextZ,Xr--),Mt?Mt.nextZ=$t:He=$t,$t.prevZ=Mt,Mt=$t;rt=Lt}Mt.nextZ=null,pn*=2}while(Pt>1)}(Ue)}(n,p,_,E);for(var O,B,j=n;n.prev!==n.next;)if(O=n.prev,B=n.next,E?hp(n,p,_,E):Xc(n))o.push(O.i/u),o.push(n.i/u),o.push(B.i/u),qc(n),n=B.next,j=B.next;else if((n=B)===j){A?A===1?Lf(n=kf(ru(n),o,u),o,u,p,_,E,2):A===2&&pp(n,o,u,p,_,E):Lf(ru(n),o,u,p,_,E,1);break}}}function Xc(n){var o=n.prev,u=n,p=n.next;if(Fo(o,u,p)>=0)return!1;for(var _=n.next.next;_!==n.prev;){if(Yc(o.x,o.y,u.x,u.y,p.x,p.y,_.x,_.y)&&Fo(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function hp(n,o,u,p){var _=n.prev,E=n,A=n.next;if(Fo(_,E,A)>=0)return!1;for(var O=_.x>E.x?_.x>A.x?_.x:A.x:E.x>A.x?E.x:A.x,B=_.y>E.y?_.y>A.y?_.y:A.y:E.y>A.y?E.y:A.y,j=Do(_.x<E.x?_.x<A.x?_.x:A.x:E.x<A.x?E.x:A.x,_.y<E.y?_.y<A.y?_.y:A.y:E.y<A.y?E.y:A.y,o,u,p),H=Do(O,B,o,u,p),te=n.prevZ,ce=n.nextZ;te&&te.z>=j&&ce&&ce.z<=H;){if(te!==n.prev&&te!==n.next&&Yc(_.x,_.y,E.x,E.y,A.x,A.y,te.x,te.y)&&Fo(te.prev,te,te.next)>=0||(te=te.prevZ,ce!==n.prev&&ce!==n.next&&Yc(_.x,_.y,E.x,E.y,A.x,A.y,ce.x,ce.y)&&Fo(ce.prev,ce,ce.next)>=0))return!1;ce=ce.nextZ}for(;te&&te.z>=j;){if(te!==n.prev&&te!==n.next&&Yc(_.x,_.y,E.x,E.y,A.x,A.y,te.x,te.y)&&Fo(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;ce&&ce.z<=H;){if(ce!==n.prev&&ce!==n.next&&Yc(_.x,_.y,E.x,E.y,A.x,A.y,ce.x,ce.y)&&Fo(ce.prev,ce,ce.next)>=0)return!1;ce=ce.nextZ}return!0}function kf(n,o,u){var p=n;do{var _=p.prev,E=p.next.next;!dp(_,E)&&Fd(_,p,p.next,E)&&nu(_,E)&&nu(E,_)&&(o.push(_.i/u),o.push(p.i/u),o.push(E.i/u),qc(p),qc(p.next),p=n=E),p=p.next}while(p!==n);return ru(p)}function pp(n,o,u,p,_,E){var A=n;do{for(var O=A.next.next;O!==A.prev;){if(A.i!==O.i&&Df(A,O)){var B=mp(A,O);return A=ru(A,A.next),B=ru(B,B.next),Lf(A,o,u,p,_,E),void Lf(B,o,u,p,_,E)}O=O.next}A=A.next}while(A!==n)}function kd(n,o){return n.x-o.x}function Dd(n,o){if(o=function(p,_){var E,A=_,O=p.x,B=p.y,j=-1/0;do{if(B<=A.y&&B>=A.next.y&&A.next.y!==A.y){var H=A.x+(B-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(H<=O&&H>j){if(j=H,H===O){if(B===A.y)return A;if(B===A.next.y)return A.next}E=A.x<A.next.x?A:A.next}}A=A.next}while(A!==_);if(!E)return null;if(O===j)return E;var te,ce=E,_e=E.x,Ue=E.y,He=1/0;A=E;do O>=A.x&&A.x>=_e&&O!==A.x&&Yc(B<Ue?O:j,B,_e,Ue,B<Ue?j:O,B,A.x,A.y)&&(te=Math.abs(B-A.y)/(O-A.x),nu(A,p)&&(te<He||te===He&&(A.x>E.x||A.x===E.x&&Yo(E,A)))&&(E=A,He=te)),A=A.next;while(A!==ce);return E}(n,o)){var u=mp(o,n);ru(o,o.next),ru(u,u.next)}}function Yo(n,o){return Fo(n.prev,n,o.prev)<0&&Fo(o.next,n,n.next)<0}function Do(n,o,u,p,_){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-u)*_)|n<<8))|n<<4))|n<<2))|n<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-p)*_)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Fh(n){var o=n,u=n;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==n);return u}function Yc(n,o,u,p,_,E,A,O){return(_-A)*(o-O)-(n-A)*(E-O)>=0&&(n-A)*(p-O)-(u-A)*(o-O)>=0&&(u-A)*(E-O)-(_-A)*(p-O)>=0}function Df(n,o){return n.next.i!==o.i&&n.prev.i!==o.i&&!function(u,p){var _=u;do{if(_.i!==u.i&&_.next.i!==u.i&&_.i!==p.i&&_.next.i!==p.i&&Fd(_,_.next,u,p))return!0;_=_.next}while(_!==u);return!1}(n,o)&&(nu(n,o)&&nu(o,n)&&function(u,p){var _=u,E=!1,A=(u.x+p.x)/2,O=(u.y+p.y)/2;do _.y>O!=_.next.y>O&&_.next.y!==_.y&&A<(_.next.x-_.x)*(O-_.y)/(_.next.y-_.y)+_.x&&(E=!E),_=_.next;while(_!==u);return E}(n,o)&&(Fo(n.prev,n,o.prev)||Fo(n,o.prev,o))||dp(n,o)&&Fo(n.prev,n,n.next)>0&&Fo(o.prev,o,o.next)>0)}function Fo(n,o,u){return(o.y-n.y)*(u.x-o.x)-(o.x-n.x)*(u.y-o.y)}function dp(n,o){return n.x===o.x&&n.y===o.y}function Fd(n,o,u,p){var _=sh(Fo(n,o,u)),E=sh(Fo(n,o,p)),A=sh(Fo(u,p,n)),O=sh(Fo(u,p,o));return _!==E&&A!==O||!(_!==0||!vp(n,u,o))||!(E!==0||!vp(n,p,o))||!(A!==0||!vp(u,n,p))||!(O!==0||!vp(u,o,p))}function vp(n,o,u){return o.x<=Math.max(n.x,u.x)&&o.x>=Math.min(n.x,u.x)&&o.y<=Math.max(n.y,u.y)&&o.y>=Math.min(n.y,u.y)}function sh(n){return n>0?1:n<0?-1:0}function nu(n,o){return Fo(n.prev,n,n.next)<0?Fo(n,o,n.next)>=0&&Fo(n,n.prev,o)>=0:Fo(n,o,n.prev)<0||Fo(n,n.next,o)<0}function mp(n,o){var u=new nl(n.i,n.x,n.y),p=new nl(o.i,o.x,o.y),_=n.next,E=o.prev;return n.next=o,o.prev=n,u.next=_,_.prev=u,p.next=u,u.prev=p,E.next=p,p.prev=E,p}function Bh(n,o,u,p){var _=new nl(n,o,u);return p?(_.next=p.next,_.prev=p,p.next.prev=_,p.next=_):(_.prev=_,_.next=_),_}function qc(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function nl(n,o,u){this.i=n,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Kc(n,o,u,p){for(var _=0,E=o,A=u-p;E<u;E+=p)_+=(n[A]-n[E])*(n[E+1]+n[A+1]),A=E;return _}function $c(n,o,u,p,_){(function E(A,O,B,j,H){for(;j>B;){if(j-B>600){var te=j-B+1,ce=O-B+1,_e=Math.log(te),Ue=.5*Math.exp(2*_e/3),He=.5*Math.sqrt(_e*Ue*(te-Ue)/te)*(ce-te/2<0?-1:1);E(A,O,Math.max(B,Math.floor(O-ce*Ue/te+He)),Math.min(j,Math.floor(O+(te-ce)*Ue/te+He)),H)}var ft=A[O],rt=B,Lt=j;for(Hl(A,B,O),H(A[j],ft)>0&&Hl(A,B,j);rt<Lt;){for(Hl(A,rt,Lt),rt++,Lt--;H(A[rt],ft)<0;)rt++;for(;H(A[Lt],ft)>0;)Lt--}H(A[B],ft)===0?Hl(A,B,Lt):Hl(A,++Lt,j),Lt<=O&&(B=Lt+1),O<=Lt&&(j=Lt-1)}})(n,o,u||0,p||n.length-1,_||uh)}function Hl(n,o,u){var p=n[o];n[o]=n[u],n[u]=p}function uh(n,o){return n<o?-1:n>o?1:0}function xc(n,o){var u=n.length;if(u<=1)return[n];for(var p,_,E=[],A=0;A<u;A++){var O=Mr(n[A]);O!==0&&(n[A].area=Math.abs(O),_===void 0&&(_=O<0),_===O<0?(p&&E.push(p),p=[n[A]]):p.push(n[A]))}if(p&&E.push(p),o>1)for(var B=0;B<E.length;B++)E[B].length<=o||($c(E[B],o,1,E[B].length-1,Qc),E[B]=E[B].slice(0,o));return E}function Qc(n,o){return o.area-n.area}function Jc(n,o,u){for(var p=u.patternDependencies,_=!1,E=0,A=o;E<A.length;E+=1){var O=A[E].paint.get(n+"-pattern");O.isConstant()||(_=!0);var B=O.constantOr(null);B&&(_=!0,p[B.to]=!0,p[B.from]=!0)}return _}function ef(n,o,u,p,_){for(var E=_.patternDependencies,A=0,O=o;A<O.length;A+=1){var B=O[A],j=B.paint.get(n+"-pattern").value;if(j.kind!=="constant"){var H=j.evaluate({zoom:p-1},u,{},_.availableImages),te=j.evaluate({zoom:p},u,{},_.availableImages),ce=j.evaluate({zoom:p+1},u,{},_.availableImages);te=te&&te.name?te.name:te,ce=ce&&ce.name?ce.name:ce,E[H=H&&H.name?H.name:H]=!0,E[te]=!0,E[ce]=!0,u.patterns[B.id]={min:H,mid:te,max:ce}}}return u}gu.deviation=function(n,o,u,p){var _=o&&o.length,E=Math.abs(Kc(n,0,_?o[0]*u:n.length,u));if(_)for(var A=0,O=o.length;A<O;A++)E-=Math.abs(Kc(n,o[A]*u,A<O-1?o[A+1]*u:n.length,u));var B=0;for(A=0;A<p.length;A+=3){var j=p[A]*u,H=p[A+1]*u,te=p[A+2]*u;B+=Math.abs((n[j]-n[te])*(n[H+1]-n[j+1])-(n[j]-n[H])*(n[te+1]-n[j+1]))}return E===0&&B===0?0:Math.abs((B-E)/E)},gu.flatten=function(n){for(var o=n[0][0].length,u={vertices:[],holes:[],dimensions:o},p=0,_=0;_<n.length;_++){for(var E=0;E<n[_].length;E++)for(var A=0;A<o;A++)u.vertices.push(n[_][E][A]);_>0&&u.holes.push(p+=n[_-1].length)}return u},_c.default=Rf;var Rs=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new zl,this.indexArray=new Ul,this.indexArray2=new vc,this.programConfigurations=new li(n.layers,n.zoom),this.segments=new Ee,this.segments2=new Ee,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};Rs.prototype.populate=function(n,o,u){this.hasPattern=Jc("fill",this.layers,o);for(var p=this.layers[0].layout.get("fill-sort-key"),_=[],E=0,A=n;E<A.length;E+=1){var O=A[E],B=O.feature,j=O.id,H=O.index,te=O.sourceLayerIndex,ce=this.layers[0]._featureFilter.needGeometry,_e=po(B,ce);if(this.layers[0]._featureFilter.filter(new Sn(this.zoom),_e,u)){var Ue=p?p.evaluate(_e,{},u,o.availableImages):void 0,He={id:j,properties:B.properties,type:B.type,sourceLayerIndex:te,index:H,geometry:ce?_e.geometry:Qa(B),patterns:{},sortKey:Ue};_.push(He)}}p&&_.sort(function(Xr,pn){return Xr.sortKey-pn.sortKey});for(var ft=0,rt=_;ft<rt.length;ft+=1){var Lt=rt[ft],$t=Lt.geometry,Mt=Lt.index,Pt=Lt.sourceLayerIndex;if(this.hasPattern){var Cr=ef("fill",this.layers,Lt,this.zoom,o);this.patternFeatures.push(Cr)}else this.addFeature(Lt,$t,Mt,u,{});o.featureIndex.insert(n[Mt].feature,$t,Mt,Pt,this.index)}},Rs.prototype.update=function(n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,u)},Rs.prototype.addFeatures=function(n,o,u){for(var p=0,_=this.patternFeatures;p<_.length;p+=1){var E=_[p];this.addFeature(E,E.geometry,E.index,o,u)}},Rs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Rs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Rs.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,fp),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0},Rs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Rs.prototype.addFeature=function(n,o,u,p,_){for(var E=0,A=xc(o,500);E<A.length;E+=1){for(var O=A[E],B=0,j=0,H=O;j<H.length;j+=1)B+=H[j].length;for(var te=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray),ce=te.vertexLength,_e=[],Ue=[],He=0,ft=O;He<ft.length;He+=1){var rt=ft[He];if(rt.length!==0){rt!==O[0]&&Ue.push(_e.length/2);var Lt=this.segments2.prepareSegment(rt.length,this.layoutVertexArray,this.indexArray2),$t=Lt.vertexLength;this.layoutVertexArray.emplaceBack(rt[0].x,rt[0].y),this.indexArray2.emplaceBack($t+rt.length-1,$t),_e.push(rt[0].x),_e.push(rt[0].y);for(var Mt=1;Mt<rt.length;Mt++)this.layoutVertexArray.emplaceBack(rt[Mt].x,rt[Mt].y),this.indexArray2.emplaceBack($t+Mt-1,$t+Mt),_e.push(rt[Mt].x),_e.push(rt[Mt].y);Lt.vertexLength+=rt.length,Lt.primitiveLength+=rt.length}}for(var Pt=_c(_e,Ue),Cr=0;Cr<Pt.length;Cr+=3)this.indexArray.emplaceBack(ce+Pt[Cr],ce+Pt[Cr+1],ce+Pt[Cr+2]);te.vertexLength+=B,te.primitiveLength+=Pt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,_,p)},Mn("FillBucket",Rs,{omit:["layers","patternFeatures"]});var Ff=new ts({"fill-sort-key":new jn(be.layout_fill["fill-sort-key"])}),lh={paint:new ts({"fill-antialias":new Kn(be.paint_fill["fill-antialias"]),"fill-opacity":new jn(be.paint_fill["fill-opacity"]),"fill-color":new jn(be.paint_fill["fill-color"]),"fill-outline-color":new jn(be.paint_fill["fill-outline-color"]),"fill-translate":new Kn(be.paint_fill["fill-translate"]),"fill-translate-anchor":new Kn(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Nl(be.paint_fill["fill-pattern"])}),layout:Ff},Bf=function(n){function o(u){n.call(this,u,lh)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.recalculate=function(u,p){n.prototype.recalculate.call(this,u,p);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new Rs(u)},o.prototype.queryRadius=function(){return xo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,p,_,E,A,O,B){return Xo(Zu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),O.angle,B),E)},o.prototype.isTileClipped=function(){return!0},o}(Nu),yu=Ma([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,ch=El;function El(n,o,u,p,_){this.properties={},this.extent=u,this.type=0,this._pbf=n,this._geometry=-1,this._keys=p,this._values=_,n.readFields(tf,this,o)}function tf(n,o,u){n==1?o.id=u.readVarint():n==2?function(p,_){for(var E=p.readVarint()+p.pos;p.pos<E;){var A=_._keys[p.readVarint()],O=_._values[p.readVarint()];_.properties[A]=O}}(u,o):n==3?o.type=u.readVarint():n==4&&(o._geometry=u.pos)}function Jp(n){for(var o,u,p=0,_=0,E=n.length,A=E-1;_<E;A=_++)p+=((u=n[A]).x-(o=n[_]).x)*(o.y+u.y);return p}El.types=["Unknown","Point","LineString","Polygon"],El.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var o,u=n.readVarint()+n.pos,p=1,_=0,E=0,A=0,O=[];n.pos<u;){if(_<=0){var B=n.readVarint();p=7&B,_=B>>3}if(_--,p===1||p===2)E+=n.readSVarint(),A+=n.readSVarint(),p===1&&(o&&O.push(o),o=[]),o.push(new ne(E,A));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&O.push(o),O},El.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var o=n.readVarint()+n.pos,u=1,p=0,_=0,E=0,A=1/0,O=-1/0,B=1/0,j=-1/0;n.pos<o;){if(p<=0){var H=n.readVarint();u=7&H,p=H>>3}if(p--,u===1||u===2)(_+=n.readSVarint())<A&&(A=_),_>O&&(O=_),(E+=n.readSVarint())<B&&(B=E),E>j&&(j=E);else if(u!==7)throw new Error("unknown command "+u)}return[A,B,O,j]},El.prototype.toGeoJSON=function(n,o,u){var p,_,E=this.extent*Math.pow(2,u),A=this.extent*n,O=this.extent*o,B=this.loadGeometry(),j=El.types[this.type];function H(_e){for(var Ue=0;Ue<_e.length;Ue++){var He=_e[Ue];_e[Ue]=[360*(He.x+A)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(He.y+O)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var te=[];for(p=0;p<B.length;p++)te[p]=B[p][0];H(B=te);break;case 2:for(p=0;p<B.length;p++)H(B[p]);break;case 3:for(B=function(_e){var Ue=_e.length;if(Ue<=1)return[_e];for(var He,ft,rt=[],Lt=0;Lt<Ue;Lt++){var $t=Jp(_e[Lt]);$t!==0&&(ft===void 0&&(ft=$t<0),ft===$t<0?(He&&rt.push(He),He=[_e[Lt]]):He.push(_e[Lt]))}return He&&rt.push(He),rt}(B),p=0;p<B.length;p++)for(_=0;_<B[p].length;_++)H(B[p][_])}B.length===1?B=B[0]:j="Multi"+j;var ce={type:"Feature",geometry:{type:j,coordinates:B},properties:this.properties};return"id"in this&&(ce.id=this.id),ce};var Nh=ed;function ed(n,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(Bd,this,o),this.length=this._features.length}function Bd(n,o,u){n===15?o.version=u.readVarint():n===1?o.name=u.readString():n===5?o.extent=u.readVarint():n===2?o._features.push(u.pos):n===3?o._keys.push(u.readString()):n===4&&o._values.push(function(p){for(var _=null,E=p.readVarint()+p.pos;p.pos<E;){var A=p.readVarint()>>3;_=A===1?p.readString():A===2?p.readFloat():A===3?p.readDouble():A===4?p.readVarint64():A===5?p.readVarint():A===6?p.readSVarint():A===7?p.readBoolean():null}return _}(u))}function gp(n,o,u){if(n===3){var p=new Nh(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}ed.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var o=this._pbf.readVarint()+this._pbf.pos;return new ch(this._pbf,o,this.extent,this._keys,this._values)};var Tu={VectorTile:function(n,o){this.layers=n.readFields(gp,{},o)},VectorTileFeature:ch,VectorTileLayer:Nh},yp=Tu.VectorTileFeature.types,fh=Math.pow(2,13);function rf(n,o,u,p,_,E,A,O){n.emplaceBack(o,u,2*Math.floor(p*fh)+A,_*fh*2,E*fh*2,Math.round(O))}var ju=function(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Cu,this.indexArray=new Ul,this.programConfigurations=new li(n.layers,n.zoom),this.segments=new Ee,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function td(n,o){return n.x===o.x&&(n.x<0||n.x>8192)||n.y===o.y&&(n.y<0||n.y>8192)}ju.prototype.populate=function(n,o,u){this.features=[],this.hasPattern=Jc("fill-extrusion",this.layers,o);for(var p=0,_=n;p<_.length;p+=1){var E=_[p],A=E.feature,O=E.id,B=E.index,j=E.sourceLayerIndex,H=this.layers[0]._featureFilter.needGeometry,te=po(A,H);if(this.layers[0]._featureFilter.filter(new Sn(this.zoom),te,u)){var ce={id:O,sourceLayerIndex:j,index:B,geometry:H?te.geometry:Qa(A),properties:A.properties,type:A.type,patterns:{}};this.hasPattern?this.features.push(ef("fill-extrusion",this.layers,ce,this.zoom,o)):this.addFeature(ce,ce.geometry,B,u,{}),o.featureIndex.insert(A,ce.geometry,B,j,this.index,!0)}}},ju.prototype.addFeatures=function(n,o,u){for(var p=0,_=this.features;p<_.length;p+=1){var E=_[p];this.addFeature(E,E.geometry,E.index,o,u)}},ju.prototype.update=function(n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,u)},ju.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ju.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ju.prototype.upload=function(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,yu),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},ju.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ju.prototype.addFeature=function(n,o,u,p,_){for(var E=0,A=xc(o,500);E<A.length;E+=1){for(var O=A[E],B=0,j=0,H=O;j<H.length;j+=1)B+=H[j].length;for(var te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ce=0,_e=O;ce<_e.length;ce+=1){var Ue=_e[ce];if(Ue.length!==0&&!((ea=Ue).every(function(Ui){return Ui.x<0})||ea.every(function(Ui){return Ui.x>8192})||ea.every(function(Ui){return Ui.y<0})||ea.every(function(Ui){return Ui.y>8192})))for(var He=0,ft=0;ft<Ue.length;ft++){var rt=Ue[ft];if(ft>=1){var Lt=Ue[ft-1];if(!td(rt,Lt)){te.vertexLength+4>Ee.MAX_VERTEX_ARRAY_LENGTH&&(te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var $t=rt.sub(Lt)._perp()._unit(),Mt=Lt.dist(rt);He+Mt>32768&&(He=0),rf(this.layoutVertexArray,rt.x,rt.y,$t.x,$t.y,0,0,He),rf(this.layoutVertexArray,rt.x,rt.y,$t.x,$t.y,0,1,He),rf(this.layoutVertexArray,Lt.x,Lt.y,$t.x,$t.y,0,0,He+=Mt),rf(this.layoutVertexArray,Lt.x,Lt.y,$t.x,$t.y,0,1,He);var Pt=te.vertexLength;this.indexArray.emplaceBack(Pt,Pt+2,Pt+1),this.indexArray.emplaceBack(Pt+1,Pt+2,Pt+3),te.vertexLength+=4,te.primitiveLength+=2}}}}if(te.vertexLength+B>Ee.MAX_VERTEX_ARRAY_LENGTH&&(te=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray)),yp[n.type]==="Polygon"){for(var Cr=[],Xr=[],pn=te.vertexLength,ti=0,In=O;ti<In.length;ti+=1){var oi=In[ti];if(oi.length!==0){oi!==O[0]&&Xr.push(Cr.length/2);for(var Rn=0;Rn<oi.length;Rn++){var Xi=oi[Rn];rf(this.layoutVertexArray,Xi.x,Xi.y,0,0,1,1,0),Cr.push(Xi.x),Cr.push(Xi.y)}}}for(var _i=_c(Cr,Xr),Gn=0;Gn<_i.length;Gn+=3)this.indexArray.emplaceBack(pn+_i[Gn],pn+_i[Gn+2],pn+_i[Gn+1]);te.primitiveLength+=_i.length/3,te.vertexLength+=B}}var ea;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,_,p)},Mn("FillExtrusionBucket",ju,{omit:["layers","features"]});var Nd={paint:new ts({"fill-extrusion-opacity":new Kn(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new jn(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Kn(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Kn(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Nl(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new jn(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new jn(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Kn(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Sl=function(n){function o(u){n.call(this,u,Nd)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.createBucket=function(u){return new ju(u)},o.prototype.queryRadius=function(){return xo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,p,_,E,A,O,B,j){var H=Zu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),O.angle,B),te=this.paint.get("fill-extrusion-height").evaluate(p,_),ce=this.paint.get("fill-extrusion-base").evaluate(p,_),_e=function(He,ft,rt,Lt){for(var $t=[],Mt=0,Pt=He;Mt<Pt.length;Mt+=1){var Cr=Pt[Mt],Xr=[Cr.x,Cr.y,0,1];Hc(Xr,Xr,ft),$t.push(new ne(Xr[0]/Xr[3],Xr[1]/Xr[3]))}return $t}(H,j),Ue=function(He,ft,rt,Lt){for(var $t=[],Mt=[],Pt=Lt[8]*ft,Cr=Lt[9]*ft,Xr=Lt[10]*ft,pn=Lt[11]*ft,ti=Lt[8]*rt,In=Lt[9]*rt,oi=Lt[10]*rt,Rn=Lt[11]*rt,Xi=0,_i=He;Xi<_i.length;Xi+=1){for(var Gn=[],ea=[],Ui=0,la=_i[Xi];Ui<la.length;Ui+=1){var si=la[Ui],ga=si.x,vo=si.y,Po=Lt[0]*ga+Lt[4]*vo+Lt[12],Eo=Lt[1]*ga+Lt[5]*vo+Lt[13],mo=Lt[2]*ga+Lt[6]*vo+Lt[14],Oo=Lt[3]*ga+Lt[7]*vo+Lt[15],ds=mo+Xr,vs=Oo+pn,au=Po+ti,Cs=Eo+In,ou=mo+oi,zo=Oo+Rn,As=new ne((Po+Pt)/vs,(Eo+Cr)/vs);As.z=ds/vs,Gn.push(As);var Qi=new ne(au/zo,Cs/zo);Qi.z=ou/zo,ea.push(Qi)}$t.push(Gn),Mt.push(ea)}return[$t,Mt]}(E,ce,te,j);return function(He,ft,rt){var Lt=1/0;Xo(rt,ft)&&(Lt=af(rt,ft[0]));for(var $t=0;$t<ft.length;$t++)for(var Mt=ft[$t],Pt=He[$t],Cr=0;Cr<Mt.length-1;Cr++){var Xr=Mt[Cr],pn=[Xr,Mt[Cr+1],Pt[Cr+1],Pt[Cr],Xr];zu(rt,pn)&&(Lt=Math.min(Lt,af(rt,pn)))}return Lt!==1/0&&Lt}(Ue[0],Ue[1],_e)},o}(Nu);function nf(n,o){return n.x*o.x+n.y*o.y}function af(n,o){if(n.length===1){for(var u,p=0,_=o[p++];!u||_.equals(u);)if(!(u=o[p++]))return 1/0;for(;p<o.length;p++){var E=o[p],A=n[0],O=u.sub(_),B=E.sub(_),j=A.sub(_),H=nf(O,O),te=nf(O,B),ce=nf(B,B),_e=nf(j,O),Ue=nf(j,B),He=H*ce-te*te,ft=(ce*_e-te*Ue)/He,rt=(H*Ue-te*_e)/He,Lt=_.z*(1-ft-rt)+u.z*ft+E.z*rt;if(isFinite(Lt))return Lt}return 1/0}for(var $t=1/0,Mt=0,Pt=o;Mt<Pt.length;Mt+=1)$t=Math.min($t,Pt[Mt].z);return $t}var bc=Ma([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,rd=Ma([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,zh=Tu.VectorTileFeature.types,Ec=Math.cos(Math.PI/180*37.5),_p=Math.pow(2,14)/.5,ya=function(n){var o=this;this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new wo,this.layoutVertexArray2=new ml,this.indexArray=new Ul,this.programConfigurations=new li(n.layers,n.zoom),this.segments=new Ee,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};ya.prototype.populate=function(n,o,u){this.hasPattern=Jc("line",this.layers,o);for(var p=this.layers[0].layout.get("line-sort-key"),_=[],E=0,A=n;E<A.length;E+=1){var O=A[E],B=O.feature,j=O.id,H=O.index,te=O.sourceLayerIndex,ce=this.layers[0]._featureFilter.needGeometry,_e=po(B,ce);if(this.layers[0]._featureFilter.filter(new Sn(this.zoom),_e,u)){var Ue=p?p.evaluate(_e,{},u):void 0,He={id:j,properties:B.properties,type:B.type,sourceLayerIndex:te,index:H,geometry:ce?_e.geometry:Qa(B),patterns:{},sortKey:Ue};_.push(He)}}p&&_.sort(function(Xr,pn){return Xr.sortKey-pn.sortKey});for(var ft=0,rt=_;ft<rt.length;ft+=1){var Lt=rt[ft],$t=Lt.geometry,Mt=Lt.index,Pt=Lt.sourceLayerIndex;if(this.hasPattern){var Cr=ef("line",this.layers,Lt,this.zoom,o);this.patternFeatures.push(Cr)}else this.addFeature(Lt,$t,Mt,u,{});o.featureIndex.insert(n[Mt].feature,$t,Mt,Pt,this.index)}},ya.prototype.update=function(n,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,u)},ya.prototype.addFeatures=function(n,o,u){for(var p=0,_=this.patternFeatures;p<_.length;p+=1){var E=_[p];this.addFeature(E,E.geometry,E.index,o,u)}},ya.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ya.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ya.prototype.upload=function(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,rd)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,bc),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0},ya.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ya.prototype.lineFeatureClips=function(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}},ya.prototype.addFeature=function(n,o,u,p,_){var E=this.layers[0].layout,A=E.get("line-join").evaluate(n,{}),O=E.get("line-cap"),B=E.get("line-miter-limit"),j=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(var H=0,te=o;H<te.length;H+=1)this.addLine(te[H],n,A,O,B,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,_,p)},ya.prototype.addLine=function(n,o,u,p,_,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var A=0;A<n.length-1;A++)this.totalDistance+=n[A].dist(n[A+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var O=zh[o.type]==="Polygon",B=n.length;B>=2&&n[B-1].equals(n[B-2]);)B--;for(var j=0;j<B-1&&n[j].equals(n[j+1]);)j++;if(!(B<(O?3:2))){u==="bevel"&&(_=1.05);var H,te=this.overscaling<=16?122880/(512*this.overscaling):0,ce=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray),_e=void 0,Ue=void 0,He=void 0,ft=void 0;this.e1=this.e2=-1,O&&(ft=n[j].sub(H=n[B-2])._unit()._perp());for(var rt=j;rt<B;rt++)if(!(Ue=rt===B-1?O?n[j+1]:void 0:n[rt+1])||!n[rt].equals(Ue)){ft&&(He=ft),H&&(_e=H),H=n[rt],ft=Ue?Ue.sub(H)._unit()._perp():He;var Lt=(He=He||ft).add(ft);Lt.x===0&&Lt.y===0||Lt._unit();var $t=He.x*ft.x+He.y*ft.y,Mt=Lt.x*ft.x+Lt.y*ft.y,Pt=Mt!==0?1/Mt:1/0,Cr=2*Math.sqrt(2-2*Mt),Xr=Mt<Ec&&_e&&Ue,pn=He.x*ft.y-He.y*ft.x>0;if(Xr&&rt>j){var ti=H.dist(_e);if(ti>2*te){var In=H.sub(H.sub(_e)._mult(te/ti)._round());this.updateDistance(_e,In),this.addCurrentVertex(In,He,0,0,ce),_e=In}}var oi=_e&&Ue,Rn=oi?u:O?"butt":p;if(oi&&Rn==="round"&&(Pt<E?Rn="miter":Pt<=2&&(Rn="fakeround")),Rn==="miter"&&Pt>_&&(Rn="bevel"),Rn==="bevel"&&(Pt>2&&(Rn="flipbevel"),Pt<_&&(Rn="miter")),_e&&this.updateDistance(_e,H),Rn==="miter")Lt._mult(Pt),this.addCurrentVertex(H,Lt,0,0,ce);else if(Rn==="flipbevel"){if(Pt>100)Lt=ft.mult(-1);else{var Xi=Pt*He.add(ft).mag()/He.sub(ft).mag();Lt._perp()._mult(Xi*(pn?-1:1))}this.addCurrentVertex(H,Lt,0,0,ce),this.addCurrentVertex(H,Lt.mult(-1),0,0,ce)}else if(Rn==="bevel"||Rn==="fakeround"){var _i=-Math.sqrt(Pt*Pt-1),Gn=pn?_i:0,ea=pn?0:_i;if(_e&&this.addCurrentVertex(H,He,Gn,ea,ce),Rn==="fakeround")for(var Ui=Math.round(180*Cr/Math.PI/20),la=1;la<Ui;la++){var si=la/Ui;if(si!==.5){var ga=si-.5;si+=si*ga*(si-1)*((1.0904+$t*($t*(3.55645-1.43519*$t)-3.2452))*ga*ga+(.848013+$t*(.215638*$t-1.06021)))}var vo=ft.sub(He)._mult(si)._add(He)._unit()._mult(pn?-1:1);this.addHalfVertex(H,vo.x,vo.y,!1,pn,0,ce)}Ue&&this.addCurrentVertex(H,ft,-Gn,-ea,ce)}else if(Rn==="butt")this.addCurrentVertex(H,Lt,0,0,ce);else if(Rn==="square"){var Po=_e?1:-1;this.addCurrentVertex(H,Lt,Po,Po,ce)}else Rn==="round"&&(_e&&(this.addCurrentVertex(H,He,0,0,ce),this.addCurrentVertex(H,He,1,1,ce,!0)),Ue&&(this.addCurrentVertex(H,ft,-1,-1,ce,!0),this.addCurrentVertex(H,ft,0,0,ce)));if(Xr&&rt<B-1){var Eo=H.dist(Ue);if(Eo>2*te){var mo=H.add(Ue.sub(H)._mult(te/Eo)._round());this.updateDistance(H,mo),this.addCurrentVertex(mo,ft,0,0,ce),H=mo}}}}},ya.prototype.addCurrentVertex=function(n,o,u,p,_,E){E===void 0&&(E=!1);var A=o.y*p-o.x,O=-o.y-o.x*p;this.addHalfVertex(n,o.x+o.y*u,o.y-o.x*u,E,!1,u,_),this.addHalfVertex(n,A,O,E,!0,-p,_),this.distance>_p/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(n,o,u,p,_,E))},ya.prototype.addHalfVertex=function(n,o,u,p,_,E,A){var O=.5*(this.lineClips?this.scaledDistance*(_p-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n.x<<1)+(p?1:0),(n.y<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(E===0?0:E<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var B=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,B),A.primitiveLength++),_?this.e2=B:this.e1=B},ya.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ya.prototype.updateDistance=function(n,o){this.distance+=n.dist(o),this.updateScaledDistance()},Mn("LineBucket",ya,{omit:["layers","patternFeatures"]});var Sc=new ts({"line-cap":new Kn(be.layout_line["line-cap"]),"line-join":new jn(be.layout_line["line-join"]),"line-miter-limit":new Kn(be.layout_line["line-miter-limit"]),"line-round-limit":new Kn(be.layout_line["line-round-limit"]),"line-sort-key":new jn(be.layout_line["line-sort-key"])}),To={paint:new ts({"line-opacity":new jn(be.paint_line["line-opacity"]),"line-color":new jn(be.paint_line["line-color"]),"line-translate":new Kn(be.paint_line["line-translate"]),"line-translate-anchor":new Kn(be.paint_line["line-translate-anchor"]),"line-width":new jn(be.paint_line["line-width"]),"line-gap-width":new jn(be.paint_line["line-gap-width"]),"line-offset":new jn(be.paint_line["line-offset"]),"line-blur":new jn(be.paint_line["line-blur"]),"line-dasharray":new Es(be.paint_line["line-dasharray"]),"line-pattern":new Nl(be.paint_line["line-pattern"]),"line-gradient":new Gs(be.paint_line["line-gradient"])}),layout:Sc},iu=new(function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p){return p=new Sn(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),n.prototype.possiblyEvaluate.call(this,u,p)},o.prototype.evaluate=function(u,p,_,E){return p=_t({},p,{zoom:Math.floor(p.zoom)}),n.prototype.evaluate.call(this,u,p,_,E)},o}(jn))(To.paint.properties["line-width"].specification);iu.useIntegerZoom=!0;var xp=function(n){function o(u){n.call(this,u,To),this.gradientVersion=0}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ys,this.gradientVersion=(this.gradientVersion+1)%ke)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,p){n.prototype.recalculate.call(this,u,p),this.paint._values["line-floorwidth"]=iu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new ya(u)},o.prototype.queryRadius=function(u){var p=u,_=nd(Au("line-width",this,p),Au("line-gap-width",this,p)),E=Au("line-offset",this,p);return _/2+Math.abs(E)+xo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,p,_,E,A,O,B){var j=Zu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),O.angle,B),H=B/2*nd(this.paint.get("line-width").evaluate(p,_),this.paint.get("line-gap-width").evaluate(p,_)),te=this.paint.get("line-offset").evaluate(p,_);return te&&(E=function(ce,_e){for(var Ue=[],He=new ne(0,0),ft=0;ft<ce.length;ft++){for(var rt=ce[ft],Lt=[],$t=0;$t<rt.length;$t++){var Mt=rt[$t],Pt=rt[$t+1],Cr=$t===0?He:Mt.sub(rt[$t-1])._unit()._perp(),Xr=$t===rt.length-1?He:Pt.sub(Mt)._unit()._perp(),pn=Cr._add(Xr)._unit();pn._mult(1/(pn.x*Xr.x+pn.y*Xr.y)),Lt.push(pn._mult(_e)._add(Mt))}Ue.push(Lt)}return Ue}(E,te*B)),function(ce,_e,Ue){for(var He=0;He<_e.length;He++){var ft=_e[He];if(ce.length>=3){for(var rt=0;rt<ft.length;rt++)if(vu(ce,ft[rt]))return!0}if(eu(ce,ft,Ue))return!0}return!1}(j,E,H)},o.prototype.isTileClipped=function(){return!0},o}(Nu);function nd(n,o){return o>0?o+2*n:n}var id=Ma([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),bp=Ma([{name:"a_projected_pos",components:3,type:"Float32"}],4),zd=(Ma([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ma([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Ep=(Ma([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ma([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Zd=Ma([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ud(n,o,u){return n.sections.forEach(function(p){p.text=function(_,E,A){var O=E.layout.get("text-transform").evaluate(A,{});return O==="uppercase"?_=_.toLocaleUpperCase():O==="lowercase"&&(_=_.toLocaleLowerCase()),js.applyArabicShaping&&(_=js.applyArabicShaping(_)),_}(p.text,o,u)}),n}Ma([{name:"triangle",components:3,type:"Uint16"}]),Ma([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ma([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ma([{type:"Float32",name:"offsetX"}]),Ma([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var hh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},ad=function(n,o,u,p,_){var E,A,O=8*_-p-1,B=(1<<O)-1,j=B>>1,H=-7,te=u?_-1:0,ce=u?-1:1,_e=n[o+te];for(te+=ce,E=_e&(1<<-H)-1,_e>>=-H,H+=O;H>0;E=256*E+n[o+te],te+=ce,H-=8);for(A=E&(1<<-H)-1,E>>=-H,H+=p;H>0;A=256*A+n[o+te],te+=ce,H-=8);if(E===0)E=1-j;else{if(E===B)return A?NaN:1/0*(_e?-1:1);A+=Math.pow(2,p),E-=j}return(_e?-1:1)*A*Math.pow(2,E-p)},of=function(n,o,u,p,_,E){var A,O,B,j=8*E-_-1,H=(1<<j)-1,te=H>>1,ce=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,_e=p?0:E-1,Ue=p?1:-1,He=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(O=isNaN(o)?1:0,A=H):(A=Math.floor(Math.log(o)/Math.LN2),o*(B=Math.pow(2,-A))<1&&(A--,B*=2),(o+=A+te>=1?ce/B:ce*Math.pow(2,1-te))*B>=2&&(A++,B/=2),A+te>=H?(O=0,A=H):A+te>=1?(O=(o*B-1)*Math.pow(2,_),A+=te):(O=o*Math.pow(2,te-1)*Math.pow(2,_),A=0));_>=8;n[u+_e]=255&O,_e+=Ue,O/=256,_-=8);for(A=A<<_|O,j+=_;j>0;n[u+_e]=255&A,_e+=Ue,A/=256,j-=8);n[u+_e-Ue]|=128*He},ph=Ra;function Ra(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}Ra.Varint=0,Ra.Fixed64=1,Ra.Bytes=2,Ra.Fixed32=5;var Sp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Wl(n){return n.type===Ra.Bytes?n.readVarint()+n.pos:n.pos+1}function sf(n,o,u){return u?4294967296*o+(n>>>0):4294967296*(o>>>0)+(n>>>0)}function Zh(n,o,u){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(p);for(var _=u.pos-1;_>=n;_--)u.buf[_+p]=u.buf[_]}function jd(n,o){for(var u=0;u<n.length;u++)o.writeVarint(n[u])}function Z(n,o){for(var u=0;u<n.length;u++)o.writeSVarint(n[u])}function Me(n,o){for(var u=0;u<n.length;u++)o.writeFloat(n[u])}function qe(n,o){for(var u=0;u<n.length;u++)o.writeDouble(n[u])}function lr(n,o){for(var u=0;u<n.length;u++)o.writeBoolean(n[u])}function Sr(n,o){for(var u=0;u<n.length;u++)o.writeFixed32(n[u])}function ar(n,o){for(var u=0;u<n.length;u++)o.writeSFixed32(n[u])}function yr(n,o){for(var u=0;u<n.length;u++)o.writeFixed64(n[u])}function Tr(n,o){for(var u=0;u<n.length;u++)o.writeSFixed64(n[u])}function Fr(n,o){return(n[o]|n[o+1]<<8|n[o+2]<<16)+16777216*n[o+3]}function wt(n,o,u){n[u]=o,n[u+1]=o>>>8,n[u+2]=o>>>16,n[u+3]=o>>>24}function Gr(n,o){return(n[o]|n[o+1]<<8|n[o+2]<<16)+(n[o+3]<<24)}function Ke(n,o,u){n===1&&u.readMessage(on,o)}function on(n,o,u){if(n===3){var p=u.readMessage(zr,{}),_=p.width,E=p.height,A=p.left,O=p.top,B=p.advance;o.push({id:p.id,bitmap:new wu({width:_+6,height:E+6},p.bitmap),metrics:{width:_,height:E,left:A,top:O,advance:B}})}}function zr(n,o,u){n===1?o.id=u.readVarint():n===2?o.bitmap=u.readBytes():n===3?o.width=u.readVarint():n===4?o.height=u.readVarint():n===5?o.left=u.readSVarint():n===6?o.top=u.readSVarint():n===7&&(o.advance=u.readVarint())}function jr(n){for(var o=0,u=0,p=0,_=n;p<_.length;p+=1){var E=_[p];o+=E.w*E.h,u=Math.max(u,E.w)}n.sort(function(He,ft){return ft.h-He.h});for(var A=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],O=0,B=0,j=0,H=n;j<H.length;j+=1)for(var te=H[j],ce=A.length-1;ce>=0;ce--){var _e=A[ce];if(!(te.w>_e.w||te.h>_e.h)){if(te.x=_e.x,te.y=_e.y,B=Math.max(B,te.y+te.h),O=Math.max(O,te.x+te.w),te.w===_e.w&&te.h===_e.h){var Ue=A.pop();ce<A.length&&(A[ce]=Ue)}else te.h===_e.h?(_e.x+=te.w,_e.w-=te.w):te.w===_e.w?(_e.y+=te.h,_e.h-=te.h):(A.push({x:_e.x+te.w,y:_e.y,w:_e.w-te.w,h:te.h}),_e.y+=te.h,_e.h-=te.h);break}}return{w:O,h:B,fill:o/(O*B)||0}}Ra.prototype={destroy:function(){this.buf=null},readFields:function(n,o,u){for(u=u||this.length;this.pos<u;){var p=this.readVarint(),_=p>>3,E=this.pos;this.type=7&p,n(_,o,this),this.pos===E&&this.skip(p)}return o},readMessage:function(n,o){return this.readFields(n,o,this.readVarint()+this.pos)},readFixed32:function(){var n=Fr(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Gr(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Fr(this.buf,this.pos)+4294967296*Fr(this.buf,this.pos+4);return this.pos+=8,n},readSFixed64:function(){var n=Fr(this.buf,this.pos)+4294967296*Gr(this.buf,this.pos+4);return this.pos+=8,n},readFloat:function(){var n=ad(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=ad(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var o,u,p=this.buf;return o=127&(u=p[this.pos++]),u<128?o:(o|=(127&(u=p[this.pos++]))<<7,u<128?o:(o|=(127&(u=p[this.pos++]))<<14,u<128?o:(o|=(127&(u=p[this.pos++]))<<21,u<128?o:function(_,E,A){var O,B,j=A.buf;if(O=(112&(B=j[A.pos++]))>>4,B<128||(O|=(127&(B=j[A.pos++]))<<3,B<128)||(O|=(127&(B=j[A.pos++]))<<10,B<128)||(O|=(127&(B=j[A.pos++]))<<17,B<128)||(O|=(127&(B=j[A.pos++]))<<24,B<128)||(O|=(1&(B=j[A.pos++]))<<31,B<128))return sf(_,O,E);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=p[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,o=this.pos;return this.pos=n,n-o>=12&&Sp?function(u,p,_){return Sp.decode(u.subarray(p,_))}(this.buf,o,n):function(u,p,_){for(var E="",A=p;A<_;){var O,B,j,H=u[A],te=null,ce=H>239?4:H>223?3:H>191?2:1;if(A+ce>_)break;ce===1?H<128&&(te=H):ce===2?(192&(O=u[A+1]))==128&&(te=(31&H)<<6|63&O)<=127&&(te=null):ce===3?(B=u[A+2],(192&(O=u[A+1]))==128&&(192&B)==128&&((te=(15&H)<<12|(63&O)<<6|63&B)<=2047||te>=55296&&te<=57343)&&(te=null)):ce===4&&(B=u[A+2],j=u[A+3],(192&(O=u[A+1]))==128&&(192&B)==128&&(192&j)==128&&((te=(15&H)<<18|(63&O)<<12|(63&B)<<6|63&j)<=65535||te>=1114112)&&(te=null)),te===null?(te=65533,ce=1):te>65535&&(te-=65536,E+=String.fromCharCode(te>>>10&1023|55296),te=56320|1023&te),E+=String.fromCharCode(te),A+=ce}return E}(this.buf,o,n)},readBytes:function(){var n=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,n);return this.pos=n,o},readPackedVarint:function(n,o){if(this.type!==Ra.Bytes)return n.push(this.readVarint(o));var u=Wl(this);for(n=n||[];this.pos<u;)n.push(this.readVarint(o));return n},readPackedSVarint:function(n){if(this.type!==Ra.Bytes)return n.push(this.readSVarint());var o=Wl(this);for(n=n||[];this.pos<o;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==Ra.Bytes)return n.push(this.readBoolean());var o=Wl(this);for(n=n||[];this.pos<o;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==Ra.Bytes)return n.push(this.readFloat());var o=Wl(this);for(n=n||[];this.pos<o;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==Ra.Bytes)return n.push(this.readDouble());var o=Wl(this);for(n=n||[];this.pos<o;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==Ra.Bytes)return n.push(this.readFixed32());var o=Wl(this);for(n=n||[];this.pos<o;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==Ra.Bytes)return n.push(this.readSFixed32());var o=Wl(this);for(n=n||[];this.pos<o;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==Ra.Bytes)return n.push(this.readFixed64());var o=Wl(this);for(n=n||[];this.pos<o;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==Ra.Bytes)return n.push(this.readSFixed64());var o=Wl(this);for(n=n||[];this.pos<o;)n.push(this.readSFixed64());return n},skip:function(n){var o=7&n;if(o===Ra.Varint)for(;this.buf[this.pos++]>127;);else if(o===Ra.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Ra.Fixed32)this.pos+=4;else{if(o!==Ra.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(n,o){this.writeVarint(n<<3|o)},realloc:function(n){for(var o=this.length||16;o<this.pos+n;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),wt(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),wt(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),wt(this.buf,-1&n,this.pos),wt(this.buf,Math.floor(n*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),wt(this.buf,-1&n,this.pos),wt(this.buf,Math.floor(n*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(o,u){var p,_;if(o>=0?(p=o%4294967296|0,_=o/4294967296|0):(_=~(-o/4294967296),4294967295^(p=~(-o%4294967296))?p=p+1|0:(p=0,_=_+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(E,A,O){O.buf[O.pos++]=127&E|128,E>>>=7,O.buf[O.pos++]=127&E|128,E>>>=7,O.buf[O.pos++]=127&E|128,E>>>=7,O.buf[O.pos++]=127&E|128,O.buf[O.pos]=127&(E>>>=7)}(p,0,u),function(E,A){var O=(7&E)<<4;A.buf[A.pos++]|=O|((E>>>=3)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E)))))}(_,u)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var o=this.pos;this.pos=function(p,_,E){for(var A,O,B=0;B<_.length;B++){if((A=_.charCodeAt(B))>55295&&A<57344){if(!O){A>56319||B+1===_.length?(p[E++]=239,p[E++]=191,p[E++]=189):O=A;continue}if(A<56320){p[E++]=239,p[E++]=191,p[E++]=189,O=A;continue}A=O-55296<<10|A-56320|65536,O=null}else O&&(p[E++]=239,p[E++]=191,p[E++]=189,O=null);A<128?p[E++]=A:(A<2048?p[E++]=A>>6|192:(A<65536?p[E++]=A>>12|224:(p[E++]=A>>18|240,p[E++]=A>>12&63|128),p[E++]=A>>6&63|128),p[E++]=63&A|128)}return E}(this.buf,n,this.pos);var u=this.pos-o;u>=128&&Zh(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(n){this.realloc(4),of(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),of(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var o=n.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=n[u]},writeRawMessage:function(n,o){this.pos++;var u=this.pos;n(o,this);var p=this.pos-u;p>=128&&Zh(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeMessage:function(n,o,u){this.writeTag(n,Ra.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(n,o){o.length&&this.writeMessage(n,jd,o)},writePackedSVarint:function(n,o){o.length&&this.writeMessage(n,Z,o)},writePackedBoolean:function(n,o){o.length&&this.writeMessage(n,lr,o)},writePackedFloat:function(n,o){o.length&&this.writeMessage(n,Me,o)},writePackedDouble:function(n,o){o.length&&this.writeMessage(n,qe,o)},writePackedFixed32:function(n,o){o.length&&this.writeMessage(n,Sr,o)},writePackedSFixed32:function(n,o){o.length&&this.writeMessage(n,ar,o)},writePackedFixed64:function(n,o){o.length&&this.writeMessage(n,yr,o)},writePackedSFixed64:function(n,o){o.length&&this.writeMessage(n,Tr,o)},writeBytesField:function(n,o){this.writeTag(n,Ra.Bytes),this.writeBytes(o)},writeFixed32Field:function(n,o){this.writeTag(n,Ra.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(n,o){this.writeTag(n,Ra.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(n,o){this.writeTag(n,Ra.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(n,o){this.writeTag(n,Ra.Fixed64),this.writeSFixed64(o)},writeVarintField:function(n,o){this.writeTag(n,Ra.Varint),this.writeVarint(o)},writeSVarintField:function(n,o){this.writeTag(n,Ra.Varint),this.writeSVarint(o)},writeStringField:function(n,o){this.writeTag(n,Ra.Bytes),this.writeString(o)},writeFloatField:function(n,o){this.writeTag(n,Ra.Fixed32),this.writeFloat(o)},writeDoubleField:function(n,o){this.writeTag(n,Ra.Fixed64),this.writeDouble(o)},writeBooleanField:function(n,o){this.writeVarintField(n,Boolean(o))}};var kt=function(n,o){var u=o.pixelRatio,p=o.version,_=o.stretchX,E=o.stretchY,A=o.content;this.paddedRect=n,this.pixelRatio=u,this.stretchX=_,this.stretchY=E,this.content=A,this.version=p},dr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};dr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},dr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},dr.tlbr.get=function(){return this.tl.concat(this.br)},dr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(kt.prototype,dr);var Zr=function(n,o){var u={},p={};this.haveRenderCallbacks=[];var _=[];this.addImages(n,u,_),this.addImages(o,p,_);var E=jr(_),A=new ko({width:E.w||1,height:E.h||1});for(var O in n){var B=n[O],j=u[O].paddedRect;ko.copy(B.data,A,{x:0,y:0},{x:j.x+1,y:j.y+1},B.data)}for(var H in o){var te=o[H],ce=p[H].paddedRect,_e=ce.x+1,Ue=ce.y+1,He=te.data.width,ft=te.data.height;ko.copy(te.data,A,{x:0,y:0},{x:_e,y:Ue},te.data),ko.copy(te.data,A,{x:0,y:ft-1},{x:_e,y:Ue-1},{width:He,height:1}),ko.copy(te.data,A,{x:0,y:0},{x:_e,y:Ue+ft},{width:He,height:1}),ko.copy(te.data,A,{x:He-1,y:0},{x:_e-1,y:Ue},{width:1,height:ft}),ko.copy(te.data,A,{x:0,y:0},{x:_e+He,y:Ue},{width:1,height:ft})}this.image=A,this.iconPositions=u,this.patternPositions=p};Zr.prototype.addImages=function(n,o,u){for(var p in n){var _=n[p],E={x:0,y:0,w:_.data.width+2,h:_.data.height+2};u.push(E),o[p]=new kt(E,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},Zr.prototype.patchUpdatedImages=function(n,o){for(var u in n.dispatchRenderCallbacks(this.haveRenderCallbacks),n.updatedImages)this.patchUpdatedImage(this.iconPositions[u],n.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],n.getImage(u),o)},Zr.prototype.patchUpdatedImage=function(n,o,u){if(n&&o&&n.version!==o.version){n.version=o.version;var p=n.tl;u.update(o.data,void 0,{x:p[0],y:p[1]})}},Mn("ImagePosition",kt),Mn("ImageAtlas",Zr);var tn={horizontal:1,vertical:2,horizontalOnly:3},Ar=function(){this.scale=1,this.fontStack="",this.imageName=null};Ar.forText=function(n,o){var u=new Ar;return u.scale=n||1,u.fontStack=o,u},Ar.forImage=function(n){var o=new Ar;return o.imageName=n,o};var qr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function vn(n,o,u,p,_,E,A,O,B,j,H,te,ce,_e,Ue,He){var ft,rt=qr.fromFeature(n,_);te===tn.vertical&&rt.verticalizePunctuation();var Lt=js.processBidirectionalText,$t=js.processStyledBidirectionalText;if(Lt&&rt.sections.length===1){ft=[];for(var Mt=0,Pt=Lt(rt.toString(),fn(rt,j,E,o,p,_e,Ue));Mt<Pt.length;Mt+=1){var Cr=Pt[Mt],Xr=new qr;Xr.text=Cr,Xr.sections=rt.sections;for(var pn=0;pn<Cr.length;pn++)Xr.sectionIndex.push(0);ft.push(Xr)}}else if($t){ft=[];for(var ti=0,In=$t(rt.text,rt.sectionIndex,fn(rt,j,E,o,p,_e,Ue));ti<In.length;ti+=1){var oi=In[ti],Rn=new qr;Rn.text=oi[0],Rn.sectionIndex=oi[1],Rn.sections=rt.sections,ft.push(Rn)}}else ft=function(Gn,ea){for(var Ui=[],la=Gn.text,si=0,ga=0,vo=ea;ga<vo.length;ga+=1){var Po=vo[ga];Ui.push(Gn.substring(si,Po)),si=Po}return si<la.length&&Ui.push(Gn.substring(si,la.length)),Ui}(rt,fn(rt,j,E,o,p,_e,Ue));var Xi=[],_i={positionedLines:Xi,text:rt.toString(),top:H[1],bottom:H[1],left:H[0],right:H[0],writingMode:te,iconsInText:!1,verticalizable:!1};return function(Gn,ea,Ui,la,si,ga,vo,Po,Eo,mo,Oo,ds){for(var vs=0,au=-17,Cs=0,ou=0,zo=Po==="right"?1:Po==="left"?0:.5,As=0,Qi=0,Za=si;Qi<Za.length;Qi+=1){var ka=Za[Qi];ka.trim();var ha=ka.getMaxScale(),_u=24*(ha-1),Xs={positionedGlyphs:[],lineOffset:0};Gn.positionedLines[As]=Xs;var oo=Xs.positionedGlyphs,$o=0;if(ka.length()){for(var Ys=0;Ys<ka.length();Ys++){var _a=ka.getSection(Ys),ff=ka.getSectionIndex(Ys),il=ka.getCharCode(Ys),hf=0,Zo=null,Al=null,wl=null,vh=24,Nf=!(Eo===tn.horizontal||!Oo&&!wf(il)||Oo&&($n[il]||(pf=il,Nr.Arabic(pf)||Nr["Arabic Supplement"](pf)||Nr["Arabic Extended-A"](pf)||Nr["Arabic Presentation Forms-A"](pf)||Nr["Arabic Presentation Forms-B"](pf))));if(_a.imageName){var al=la[_a.imageName];if(!al)continue;wl=_a.imageName,Gn.iconsInText=Gn.iconsInText||!0,Al=al.paddedRect;var Ou=al.displaySize;_a.scale=24*_a.scale/ds,hf=_u+(24-Ou[1]*_a.scale),vh=(Zo={width:Ou[0],height:Ou[1],left:1,top:-3,advance:Nf?Ou[1]:Ou[0]}).advance;var mh=Nf?Ou[0]*_a.scale-24*ha:Ou[1]*_a.scale-24*ha;mh>0&&mh>$o&&($o=mh)}else{var wp=Ui[_a.fontStack],gh=wp&&wp[il];if(gh&&gh.rect)Al=gh.rect,Zo=gh.metrics;else{var yh=ea[_a.fontStack],Tp=yh&&yh[il];if(!Tp)continue;Zo=Tp.metrics}hf=24*(ha-_a.scale)}Nf?(Gn.verticalizable=!0,oo.push({glyph:il,imageName:wl,x:vs,y:au+hf,vertical:Nf,scale:_a.scale,fontStack:_a.fontStack,sectionIndex:ff,metrics:Zo,rect:Al}),vs+=vh*_a.scale+mo):(oo.push({glyph:il,imageName:wl,x:vs,y:au+hf,vertical:Nf,scale:_a.scale,fontStack:_a.fontStack,sectionIndex:ff,metrics:Zo,rect:Al}),vs+=Zo.advance*_a.scale+mo)}oo.length!==0&&(Cs=Math.max(vs-mo,Cs),Mi(oo,0,oo.length-1,zo,$o)),vs=0;var ud=ga*ha+$o;Xs.lineOffset=Math.max($o,_u),au+=ud,ou=Math.max(ud,ou),++As}else au+=ga,++As}var pf,Mp=au- -17,Ac=dn(vo),Uo=Ac.horizontalAlign,_h=Ac.verticalAlign;(function(Pp,Op,xh,Vh,ld,Ip,Rp,Lp,cd){var Gh,fd=(Op-xh)*ld;Gh=Ip!==Rp?-Lp*Vh- -17:(-Vh*cd+.5)*Rp;for(var W=0,Hh=Pp;W<Hh.length;W+=1)for(var zf=0,Wh=Hh[W].positionedGlyphs;zf<Wh.length;zf+=1){var bh=Wh[zf];bh.x+=fd,bh.y+=Gh}})(Gn.positionedLines,zo,Uo,_h,Cs,ou,ga,Mp,si.length),Gn.top+=-_h*Mp,Gn.bottom=Gn.top+Mp,Gn.left+=-Uo*Cs,Gn.right=Gn.left+Cs}(_i,o,u,p,ft,A,O,B,te,j,ce,He),!function(Gn){for(var ea=0,Ui=Gn;ea<Ui.length;ea+=1)if(Ui[ea].positionedGlyphs.length!==0)return!1;return!0}(Xi)&&_i}qr.fromFeature=function(n,o){for(var u=new qr,p=0;p<n.sections.length;p++){var _=n.sections[p];_.image?u.addImageSection(_):u.addTextSection(_,o)}return u},qr.prototype.length=function(){return this.text.length},qr.prototype.getSection=function(n){return this.sections[this.sectionIndex[n]]},qr.prototype.getSectionIndex=function(n){return this.sectionIndex[n]},qr.prototype.getCharCode=function(n){return this.text.charCodeAt(n)},qr.prototype.verticalizePunctuation=function(){this.text=function(n){for(var o="",u=0;u<n.length;u++){var p=n.charCodeAt(u+1)||null,_=n.charCodeAt(u-1)||null;o+=p&&Ju(p)&&!hh[n[u+1]]||_&&Ju(_)&&!hh[n[u-1]]||!hh[n[u]]?n[u]:hh[n[u]]}return o}(this.text)},qr.prototype.trim=function(){for(var n=0,o=0;o<this.text.length&&$n[this.text.charCodeAt(o)];o++)n++;for(var u=this.text.length,p=this.text.length-1;p>=0&&p>=n&&$n[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(n,u),this.sectionIndex=this.sectionIndex.slice(n,u)},qr.prototype.substring=function(n,o){var u=new qr;return u.text=this.text.substring(n,o),u.sectionIndex=this.sectionIndex.slice(n,o),u.sections=this.sections,u},qr.prototype.toString=function(){return this.text},qr.prototype.getMaxScale=function(){var n=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,n.sections[u].scale)},0)},qr.prototype.addTextSection=function(n,o){this.text+=n.text,this.sections.push(Ar.forText(n.scale,n.fontStack||o));for(var u=this.sections.length-1,p=0;p<n.text.length;++p)this.sectionIndex.push(u)},qr.prototype.addImageSection=function(n){var o=n.image?n.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Ar.forImage(o)),this.sectionIndex.push(this.sections.length-1)):ut("Reached maximum number of images 6401")}else ut("Can't add FormattedSection with an empty image.")},qr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var $n={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gr={};function Er(n,o,u,p,_,E){if(o.imageName){var A=p[o.imageName];return A?A.displaySize[0]*o.scale*24/E+_:0}var O=u[o.fontStack],B=O&&O[n];return B?B.metrics.advance*o.scale+_:0}function Fn(n,o,u,p){var _=Math.pow(n-o,2);return p?n<o?_/2:2*_:_+Math.abs(u)*u}function un(n,o,u){var p=0;return n===10&&(p-=1e4),u&&(p+=150),n!==40&&n!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function Ur(n,o,u,p,_,E){for(var A=null,O=Fn(o,u,_,E),B=0,j=p;B<j.length;B+=1){var H=j[B],te=Fn(o-H.x,u,_,E)+H.badness;te<=O&&(A=H,O=te)}return{index:n,x:o,priorBreak:A,badness:O}}function fn(n,o,u,p,_,E,A){if(E!=="point")return[];if(!n)return[];for(var O,B=[],j=function(ft,rt,Lt,$t,Mt,Pt){for(var Cr=0,Xr=0;Xr<ft.length();Xr++){var pn=ft.getSection(Xr);Cr+=Er(ft.getCharCode(Xr),pn,$t,Mt,rt,Pt)}return Cr/Math.max(1,Math.ceil(Cr/Lt))}(n,o,u,p,_,A),H=n.text.indexOf("\u200B")>=0,te=0,ce=0;ce<n.length();ce++){var _e=n.getSection(ce),Ue=n.getCharCode(ce);if($n[Ue]||(te+=Er(Ue,_e,p,_,o,A)),ce<n.length()-1){var He=!((O=Ue)<11904||!(Nr["Bopomofo Extended"](O)||Nr.Bopomofo(O)||Nr["CJK Compatibility Forms"](O)||Nr["CJK Compatibility Ideographs"](O)||Nr["CJK Compatibility"](O)||Nr["CJK Radicals Supplement"](O)||Nr["CJK Strokes"](O)||Nr["CJK Symbols and Punctuation"](O)||Nr["CJK Unified Ideographs Extension A"](O)||Nr["CJK Unified Ideographs"](O)||Nr["Enclosed CJK Letters and Months"](O)||Nr["Halfwidth and Fullwidth Forms"](O)||Nr.Hiragana(O)||Nr["Ideographic Description Characters"](O)||Nr["Kangxi Radicals"](O)||Nr["Katakana Phonetic Extensions"](O)||Nr.Katakana(O)||Nr["Vertical Forms"](O)||Nr["Yi Radicals"](O)||Nr["Yi Syllables"](O)));(gr[Ue]||He||_e.imageName)&&B.push(Ur(ce+1,te,j,B,un(Ue,n.getCharCode(ce+1),He&&H),!1))}}return function ft(rt){return rt?ft(rt.priorBreak).concat(rt.index):[]}(Ur(n.length(),te,j,B,0,!0))}function dn(n){var o=.5,u=.5;switch(n){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function Mi(n,o,u,p,_){if(p||_)for(var E=n[u],A=(n[u].x+E.metrics.advance*E.scale)*p,O=o;O<=u;O++)n[O].x-=A,n[O].y+=_}function yi(n,o,u,p,_,E){var A,O=n.image;if(O.content){var B=O.content,j=O.pixelRatio||1;A=[B[0]/j,B[1]/j,O.displaySize[0]-B[2]/j,O.displaySize[1]-B[3]/j]}var H,te,ce,_e,Ue=o.left*E,He=o.right*E;u==="width"||u==="both"?(_e=_[0]+Ue-p[3],te=_[0]+He+p[1]):te=(_e=_[0]+(Ue+He-O.displaySize[0])/2)+O.displaySize[0];var ft=o.top*E,rt=o.bottom*E;return u==="height"||u==="both"?(H=_[1]+ft-p[0],ce=_[1]+rt+p[2]):ce=(H=_[1]+(ft+rt-O.displaySize[1])/2)+O.displaySize[1],{image:O,top:H,right:te,bottom:ce,left:_e,collisionPadding:A}}gr[10]=!0,gr[32]=!0,gr[38]=!0,gr[40]=!0,gr[41]=!0,gr[43]=!0,gr[45]=!0,gr[47]=!0,gr[173]=!0,gr[183]=!0,gr[8203]=!0,gr[8208]=!0,gr[8211]=!0,gr[8231]=!0;var hn=function(n){function o(u,p,_,E){n.call(this,u,p),this.angle=_,E!==void 0&&(this.segment=E)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(ne);function En(n,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Sn(n+1))};if(u.kind==="source")return{kind:"source"};for(var p=u.zoomStops,_=u.interpolationType,E=0;E<p.length&&p[E]<=n;)E++;for(var A=E=Math.max(0,E-1);A<p.length&&p[A]<n+1;)A++;A=Math.min(p.length-1,A);var O=p[E],B=p[A];return u.kind==="composite"?{kind:"composite",minZoom:O,maxZoom:B,interpolationType:_}:{kind:"camera",minZoom:O,maxZoom:B,minSize:u.evaluate(new Sn(O)),maxSize:u.evaluate(new Sn(B)),interpolationType:_}}function di(n,o,u){var p=o.uSize,_=u.lowerSize;return n.kind==="source"?_/128:n.kind==="composite"?Sa(_/128,u.upperSize/128,o.uSizeT):p}function Ai(n,o){var u=0,p=0;if(n.kind==="constant")p=n.layoutSize;else if(n.kind!=="source"){var _=n.interpolationType,E=_?Je(Ie.interpolationFactor(_,o,n.minZoom,n.maxZoom),0,1):0;n.kind==="camera"?p=Sa(n.minSize,n.maxSize,E):u=E}return{uSizeT:u,uSize:p}}Mn("Anchor",hn);var $i=Object.freeze({__proto__:null,getSizeData:En,evaluateSizeForFeature:di,evaluateSizeForZoom:Ai,SIZE_PACK_FACTOR:128});function no(n,o,u,p,_){if(o.segment===void 0)return!0;for(var E=o,A=o.segment+1,O=0;O>-u/2;){if(--A<0)return!1;O-=n[A].dist(E),E=n[A]}O+=n[A].dist(n[A+1]),A++;for(var B=[],j=0;O<u/2;){var H=n[A],te=n[A+1];if(!te)return!1;var ce=n[A-1].angleTo(H)-H.angleTo(te);for(ce=Math.abs((ce+3*Math.PI)%(2*Math.PI)-Math.PI),B.push({distance:O,angleDelta:ce}),j+=ce;O-B[0].distance>p;)j-=B.shift().angleDelta;if(j>_)return!1;A++,O+=H.dist(te)}return!0}function io(n){for(var o=0,u=0;u<n.length-1;u++)o+=n[u].dist(n[u+1]);return o}function Yi(n,o,u){return n?.6*o*u:0}function qo(n,o){return Math.max(n?n.right-n.left:0,o?o.right-o.left:0)}function Ha(n,o,u,p,_,E){for(var A=Yi(u,_,E),O=qo(u,p)*E,B=0,j=io(n)/2,H=0;H<n.length-1;H++){var te=n[H],ce=n[H+1],_e=te.dist(ce);if(B+_e>j){var Ue=(j-B)/_e,He=Sa(te.x,ce.x,Ue),ft=Sa(te.y,ce.y,Ue),rt=new hn(He,ft,ce.angleTo(te),H);return rt._round(),!A||no(n,rt,O,A,o)?rt:void 0}B+=_e}}function ns(n,o,u,p,_,E,A,O,B){var j=Yi(p,E,A),H=qo(p,_),te=H*A,ce=n[0].x===0||n[0].x===B||n[0].y===0||n[0].y===B;return o-te<o/4&&(o=te+o/4),function _e(Ue,He,ft,rt,Lt,$t,Mt,Pt,Cr){for(var Xr=$t/2,pn=io(Ue),ti=0,In=He-ft,oi=[],Rn=0;Rn<Ue.length-1;Rn++){for(var Xi=Ue[Rn],_i=Ue[Rn+1],Gn=Xi.dist(_i),ea=_i.angleTo(Xi);In+ft<ti+Gn;){var Ui=((In+=ft)-ti)/Gn,la=Sa(Xi.x,_i.x,Ui),si=Sa(Xi.y,_i.y,Ui);if(la>=0&&la<Cr&&si>=0&&si<Cr&&In-Xr>=0&&In+Xr<=pn){var ga=new hn(la,si,ea,Rn);ga._round(),rt&&!no(Ue,ga,$t,rt,Lt)||oi.push(ga)}}ti+=Gn}return Pt||oi.length||Mt||(oi=_e(Ue,ti/2,ft,rt,Lt,$t,Mt,!0,Cr)),oi}(n,ce?o/2*O%o:(H/2+2*E)*A*O%o,o,j,u,te,ce,!1,B)}function bo(n,o,u,p,_){for(var E=[],A=0;A<n.length;A++)for(var O=n[A],B=void 0,j=0;j<O.length-1;j++){var H=O[j],te=O[j+1];H.x<o&&te.x<o||(H.x<o?H=new ne(o,H.y+(o-H.x)/(te.x-H.x)*(te.y-H.y))._round():te.x<o&&(te=new ne(o,H.y+(o-H.x)/(te.x-H.x)*(te.y-H.y))._round()),H.y<u&&te.y<u||(H.y<u?H=new ne(H.x+(u-H.y)/(te.y-H.y)*(te.x-H.x),u)._round():te.y<u&&(te=new ne(H.x+(u-H.y)/(te.y-H.y)*(te.x-H.x),u)._round()),H.x>=p&&te.x>=p||(H.x>=p?H=new ne(p,H.y+(p-H.x)/(te.x-H.x)*(te.y-H.y))._round():te.x>=p&&(te=new ne(p,H.y+(p-H.x)/(te.x-H.x)*(te.y-H.y))._round()),H.y>=_&&te.y>=_||(H.y>=_?H=new ne(H.x+(_-H.y)/(te.y-H.y)*(te.x-H.x),_)._round():te.y>=_&&(te=new ne(H.x+(_-H.y)/(te.y-H.y)*(te.x-H.x),_)._round()),B&&H.equals(B[B.length-1])||E.push(B=[H]),B.push(te)))))}return E}function Bo(n,o,u,p){var _=[],E=n.image,A=E.pixelRatio,O=E.paddedRect.w-2,B=E.paddedRect.h-2,j=n.right-n.left,H=n.bottom-n.top,te=E.stretchX||[[0,O]],ce=E.stretchY||[[0,B]],_e=function(la,si){return la+si[1]-si[0]},Ue=te.reduce(_e,0),He=ce.reduce(_e,0),ft=O-Ue,rt=B-He,Lt=0,$t=Ue,Mt=0,Pt=He,Cr=0,Xr=ft,pn=0,ti=rt;if(E.content&&p){var In=E.content;Lt=Mo(te,0,In[0]),Mt=Mo(ce,0,In[1]),$t=Mo(te,In[0],In[2]),Pt=Mo(ce,In[1],In[3]),Cr=In[0]-Lt,pn=In[1]-Mt,Xr=In[2]-In[0]-$t,ti=In[3]-In[1]-Pt}var oi=function(la,si,ga,vo){var Po=ao(la.stretch-Lt,$t,j,n.left),Eo=Ii(la.fixed-Cr,Xr,la.stretch,Ue),mo=ao(si.stretch-Mt,Pt,H,n.top),Oo=Ii(si.fixed-pn,ti,si.stretch,He),ds=ao(ga.stretch-Lt,$t,j,n.left),vs=Ii(ga.fixed-Cr,Xr,ga.stretch,Ue),au=ao(vo.stretch-Mt,Pt,H,n.top),Cs=Ii(vo.fixed-pn,ti,vo.stretch,He),ou=new ne(Po,mo),zo=new ne(ds,mo),As=new ne(ds,au),Qi=new ne(Po,au),Za=new ne(Eo/A,Oo/A),ka=new ne(vs/A,Cs/A),ha=o*Math.PI/180;if(ha){var _u=Math.sin(ha),Xs=Math.cos(ha),oo=[Xs,-_u,_u,Xs];ou._matMult(oo),zo._matMult(oo),Qi._matMult(oo),As._matMult(oo)}var $o=la.stretch+la.fixed,Ys=si.stretch+si.fixed;return{tl:ou,tr:zo,bl:Qi,br:As,tex:{x:E.paddedRect.x+1+$o,y:E.paddedRect.y+1+Ys,w:ga.stretch+ga.fixed-$o,h:vo.stretch+vo.fixed-Ys},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Za,pixelOffsetBR:ka,minFontScaleX:Xr/A/j,minFontScaleY:ti/A/H,isSDF:u}};if(p&&(E.stretchX||E.stretchY))for(var Rn=ps(te,ft,Ue),Xi=ps(ce,rt,He),_i=0;_i<Rn.length-1;_i++)for(var Gn=Rn[_i],ea=Rn[_i+1],Ui=0;Ui<Xi.length-1;Ui++)_.push(oi(Gn,Xi[Ui],ea,Xi[Ui+1]));else _.push(oi({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:O+1},{fixed:0,stretch:B+1}));return _}function Mo(n,o,u){for(var p=0,_=0,E=n;_<E.length;_+=1){var A=E[_];p+=Math.max(o,Math.min(u,A[1]))-Math.max(o,Math.min(u,A[0]))}return p}function ps(n,o,u){for(var p=[{fixed:-1,stretch:0}],_=0,E=n;_<E.length;_+=1){var A=E[_],O=A[0],B=A[1],j=p[p.length-1];p.push({fixed:O-j.stretch,stretch:j.stretch}),p.push({fixed:O-j.stretch,stretch:j.stretch+(B-O)})}return p.push({fixed:o+1,stretch:u}),p}function ao(n,o,u,p){return n/o*u+p}function Ii(n,o,u,p){return n-o*u/p}var No=function(n,o,u,p,_,E,A,O,B,j){if(this.boxStartIndex=n.length,B){var H=E.top,te=E.bottom,ce=E.collisionPadding;ce&&(H-=ce[1],te+=ce[3]);var _e=te-H;_e>0&&(_e=Math.max(10,_e),this.circleDiameter=_e)}else{var Ue=E.top*A-O,He=E.bottom*A+O,ft=E.left*A-O,rt=E.right*A+O,Lt=E.collisionPadding;if(Lt&&(ft-=Lt[0]*A,Ue-=Lt[1]*A,rt+=Lt[2]*A,He+=Lt[3]*A),j){var $t=new ne(ft,Ue),Mt=new ne(rt,Ue),Pt=new ne(ft,He),Cr=new ne(rt,He),Xr=j*Math.PI/180;$t._rotate(Xr),Mt._rotate(Xr),Pt._rotate(Xr),Cr._rotate(Xr),ft=Math.min($t.x,Mt.x,Pt.x,Cr.x),rt=Math.max($t.x,Mt.x,Pt.x,Cr.x),Ue=Math.min($t.y,Mt.y,Pt.y,Cr.y),He=Math.max($t.y,Mt.y,Pt.y,Cr.y)}n.emplaceBack(o.x,o.y,ft,Ue,rt,He,u,p,_)}this.boxEndIndex=n.length},sa=function(n,o){if(n===void 0&&(n=[]),o===void 0&&(o=is),this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function is(n,o){return n<o?-1:n>o?1:0}function gi(n,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var p=1/0,_=1/0,E=-1/0,A=-1/0,O=n[0],B=0;B<O.length;B++){var j=O[B];(!B||j.x<p)&&(p=j.x),(!B||j.y<_)&&(_=j.y),(!B||j.x>E)&&(E=j.x),(!B||j.y>A)&&(A=j.y)}var H=Math.min(E-p,A-_),te=H/2,ce=new sa([],Zi);if(H===0)return new ne(p,_);for(var _e=p;_e<E;_e+=H)for(var Ue=_;Ue<A;Ue+=H)ce.push(new ma(_e+te,Ue+te,te,n));for(var He=function(Lt){for(var $t=0,Mt=0,Pt=0,Cr=Lt[0],Xr=0,pn=Cr.length,ti=pn-1;Xr<pn;ti=Xr++){var In=Cr[Xr],oi=Cr[ti],Rn=In.x*oi.y-oi.x*In.y;Mt+=(In.x+oi.x)*Rn,Pt+=(In.y+oi.y)*Rn,$t+=3*Rn}return new ma(Mt/$t,Pt/$t,0,Lt)}(n),ft=ce.length;ce.length;){var rt=ce.pop();(rt.d>He.d||!He.d)&&(He=rt,u&&console.log("found best %d after %d probes",Math.round(1e4*rt.d)/1e4,ft)),rt.max-He.d<=o||(ce.push(new ma(rt.p.x-(te=rt.h/2),rt.p.y-te,te,n)),ce.push(new ma(rt.p.x+te,rt.p.y-te,te,n)),ce.push(new ma(rt.p.x-te,rt.p.y+te,te,n)),ce.push(new ma(rt.p.x+te,rt.p.y+te,te,n)),ft+=4)}return u&&(console.log("num probes: "+ft),console.log("best distance: "+He.d)),He.p}function Zi(n,o){return o.max-n.max}function ma(n,o,u,p){this.p=new ne(n,o),this.h=u,this.d=function(_,E){for(var A=!1,O=1/0,B=0;B<E.length;B++)for(var j=E[B],H=0,te=j.length,ce=te-1;H<te;ce=H++){var _e=j[H],Ue=j[ce];_e.y>_.y!=Ue.y>_.y&&_.x<(Ue.x-_e.x)*(_.y-_e.y)/(Ue.y-_e.y)+_e.x&&(A=!A),O=Math.min(O,Gl(_,_e,Ue))}return(A?1:-1)*Math.sqrt(O)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}sa.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},sa.prototype.pop=function(){if(this.length!==0){var n=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),n}},sa.prototype.peek=function(){return this.data[0]},sa.prototype._up=function(n){for(var o=this.data,u=this.compare,p=o[n];n>0;){var _=n-1>>1,E=o[_];if(u(p,E)>=0)break;o[n]=E,n=_}o[n]=p},sa.prototype._down=function(n){for(var o=this.data,u=this.compare,p=this.length>>1,_=o[n];n<p;){var E=1+(n<<1),A=o[E],O=E+1;if(O<this.length&&u(o[O],A)<0&&(E=O,A=o[O]),u(A,_)>=0)break;o[n]=A,n=E}o[n]=_};var Di=Number.POSITIVE_INFINITY;function Ls(n,o){return o[1]!==Di?function(u,p,_){var E=0,A=0;switch(p=Math.abs(p),_=Math.abs(_),u){case"top-right":case"top-left":case"top":A=_-7;break;case"bottom-right":case"bottom-left":case"bottom":A=7-_}switch(u){case"top-right":case"bottom-right":case"right":E=-p;break;case"top-left":case"bottom-left":case"left":E=p}return[E,A]}(n,o[0],o[1]):function(u,p){var _=0,E=0;p<0&&(p=0);var A=p/Math.sqrt(2);switch(u){case"top-right":case"top-left":E=A-7;break;case"bottom-right":case"bottom-left":E=7-A;break;case"bottom":E=7-p;break;case"top":E=p-7}switch(u){case"top-right":case"bottom-right":_=-A;break;case"top-left":case"bottom-left":_=A;break;case"left":_=p;break;case"right":_=-p}return[_,E]}(n,o[0])}function ze(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fr(n,o,u,p,_,E,A,O,B,j,H,te,ce,_e,Ue){var He=function(Mt,Pt,Cr,Xr,pn,ti,In,oi){for(var Rn=Xr.layout.get("text-rotate").evaluate(ti,{})*Math.PI/180,Xi=[],_i=0,Gn=Pt.positionedLines;_i<Gn.length;_i+=1)for(var ea=Gn[_i],Ui=0,la=ea.positionedGlyphs;Ui<la.length;Ui+=1){var si=la[Ui];if(si.rect){var ga=si.rect||{},vo=4,Po=!0,Eo=1,mo=0,Oo=(pn||oi)&&si.vertical,ds=si.metrics.advance*si.scale/2;if(oi&&Pt.verticalizable&&(mo=ea.lineOffset/2-(si.imageName?-(24-si.metrics.width*si.scale)/2:24*(si.scale-1))),si.imageName){var vs=In[si.imageName];Po=vs.sdf,vo=1/(Eo=vs.pixelRatio)}var au=pn?[si.x+ds,si.y]:[0,0],Cs=pn?[0,0]:[si.x+ds+Cr[0],si.y+Cr[1]-mo],ou=[0,0];Oo&&(ou=Cs,Cs=[0,0]);var zo=(si.metrics.left-vo)*si.scale-ds+Cs[0],As=(-si.metrics.top-vo)*si.scale+Cs[1],Qi=zo+ga.w*si.scale/Eo,Za=As+ga.h*si.scale/Eo,ka=new ne(zo,As),ha=new ne(Qi,As),_u=new ne(zo,Za),Xs=new ne(Qi,Za);if(Oo){var oo=new ne(-ds,ds- -17),$o=-Math.PI/2,Ys=12-ds,_a=new ne(22-Ys,-(si.imageName?Ys:0)),ff=new(Function.prototype.bind.apply(ne,[null].concat(ou)));ka._rotateAround($o,oo)._add(_a)._add(ff),ha._rotateAround($o,oo)._add(_a)._add(ff),_u._rotateAround($o,oo)._add(_a)._add(ff),Xs._rotateAround($o,oo)._add(_a)._add(ff)}if(Rn){var il=Math.sin(Rn),hf=Math.cos(Rn),Zo=[hf,-il,il,hf];ka._matMult(Zo),ha._matMult(Zo),_u._matMult(Zo),Xs._matMult(Zo)}var Al=new ne(0,0),wl=new ne(0,0);Xi.push({tl:ka,tr:ha,bl:_u,br:Xs,tex:ga,writingMode:Pt.writingMode,glyphOffset:au,sectionIndex:si.sectionIndex,isSDF:Po,pixelOffsetTL:Al,pixelOffsetBR:wl,minFontScaleX:0,minFontScaleY:0})}}return Xi}(0,u,O,_,E,A,p,n.allowVerticalPlacement),ft=n.textSizeData,rt=null;ft.kind==="source"?(rt=[128*_.layout.get("text-size").evaluate(A,{})])[0]>32640&&ut(n.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ft.kind==="composite"&&((rt=[128*_e.compositeTextSizes[0].evaluate(A,{},Ue),128*_e.compositeTextSizes[1].evaluate(A,{},Ue)])[0]>32640||rt[1]>32640)&&ut(n.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),n.addSymbols(n.text,He,rt,O,E,A,j,o,B.lineStartIndex,B.lineLength,ce,Ue);for(var Lt=0,$t=H;Lt<$t.length;Lt+=1)te[$t[Lt]]=n.text.placedSymbolArray.length-1;return 4*He.length}function Xt(n){for(var o in n)return n[o];return null}function Pn(n,o,u,p){var _=n.compareText;if(o in _){for(var E=_[o],A=E.length-1;A>=0;A--)if(p.dist(E[A])<u)return!0}else _[o]=[];return _[o].push(p),!1}var qi=Tu.VectorTileFeature.types,De=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ye(n,o,u,p,_,E,A,O,B,j,H,te,ce){var _e=O?Math.min(32640,Math.round(O[0])):0,Ue=O?Math.min(32640,Math.round(O[1])):0;n.emplaceBack(o,u,Math.round(32*p),Math.round(32*_),E,A,(_e<<1)+(B?1:0),Ue,16*j,16*H,256*te,256*ce)}function st(n,o,u){n.emplaceBack(o.x,o.y,u),n.emplaceBack(o.x,o.y,u),n.emplaceBack(o.x,o.y,u),n.emplaceBack(o.x,o.y,u)}function Nt(n){for(var o=0,u=n.sections;o<u.length;o+=1)if(Bl(u[o].text))return!0;return!1}var Yt=function(n){this.layoutVertexArray=new Zl,this.indexArray=new Ul,this.programConfigurations=n,this.segments=new Ee,this.dynamicLayoutVertexArray=new hc,this.opacityVertexArray=new pc,this.placedSymbolArray=new v};Yt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Yt.prototype.upload=function(n,o,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,id.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,bp.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,De,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(n))},Yt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Mn("SymbolBuffers",Yt);var ht=function(n,o,u){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new u,this.segments=new Ee,this.collisionVertexArray=new Dh};ht.prototype.upload=function(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,zd.members,!0)},ht.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Mn("CollisionBuffers",ht);var Xe=function(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(function(E){return E.id}),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ws([]),this.placementViewportMatrix=Ws([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=En(this.zoom,o["text-size"]),this.iconSizeData=En(this.zoom,o["icon-size"]);var u=this.layers[0].layout,p=u.get("symbol-sort-key"),_=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(E){return tn[E]})),this.stateDependentLayerIds=this.layers.filter(function(E){return E.isStateDependent()}).map(function(E){return E.id}),this.sourceID=n.sourceID};Xe.prototype.createArrays=function(){this.text=new Yt(new li(this.layers,this.zoom,function(n){return/^text/.test(n)})),this.icon=new Yt(new li(this.layers,this.zoom,function(n){return/^icon/.test(n)})),this.glyphOffsetArray=new P,this.lineVertexArray=new D,this.symbolInstances=new T},Xe.prototype.calculateGlyphDependencies=function(n,o,u,p,_){for(var E=0;E<n.length;E++)if(o[n.charCodeAt(E)]=!0,(u||p)&&_){var A=hh[n.charAt(E)];A&&(o[A.charCodeAt(0)]=!0)}},Xe.prototype.populate=function(n,o,u){var p=this.layers[0],_=p.layout,E=_.get("text-font"),A=_.get("text-field"),O=_.get("icon-image"),B=(A.value.kind!=="constant"||A.value.value instanceof Fa&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),j=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,H=_.get("symbol-sort-key");if(this.features=[],B||j){for(var te=o.iconDependencies,ce=o.glyphDependencies,_e=o.availableImages,Ue=new Sn(this.zoom),He=0,ft=n;He<ft.length;He+=1){var rt=ft[He],Lt=rt.feature,$t=rt.id,Mt=rt.index,Pt=rt.sourceLayerIndex,Cr=p._featureFilter.needGeometry,Xr=po(Lt,Cr);if(p._featureFilter.filter(Ue,Xr,u)){Cr||(Xr.geometry=Qa(Lt));var pn=void 0;if(B){var ti=p.getValueAndResolveTokens("text-field",Xr,u,_e),In=Fa.factory(ti);Nt(In)&&(this.hasRTLText=!0),(!this.hasRTLText||fc()==="unavailable"||this.hasRTLText&&js.isParsed())&&(pn=Ud(In,p,Xr))}var oi=void 0;if(j){var Rn=p.getValueAndResolveTokens("icon-image",Xr,u,_e);oi=Rn instanceof Ea?Rn:Ea.fromString(Rn)}if(pn||oi){var Xi=this.sortFeaturesByKey?H.evaluate(Xr,{},u):void 0;if(this.features.push({id:$t,text:pn,icon:oi,index:Mt,sourceLayerIndex:Pt,geometry:Xr.geometry,properties:Lt.properties,type:qi[Lt.type],sortKey:Xi}),oi&&(te[oi.name]=!0),pn){var _i=E.evaluate(Xr,{},u).join(","),Gn=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(tn.vertical)>=0;for(var ea=0,Ui=pn.sections;ea<Ui.length;ea+=1){var la=Ui[ea];if(la.image)te[la.image.name]=!0;else{var si=Af(pn.toString()),ga=la.fontStack||_i,vo=ce[ga]=ce[ga]||{};this.calculateGlyphDependencies(la.text,vo,Gn,this.allowVerticalPlacement,si)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(Po){var Eo={},mo={},Oo=[],ds=0;function vs(oo){Oo.push(Po[oo]),ds++}function au(oo,$o,Ys){var _a=mo[oo];return delete mo[oo],mo[$o]=_a,Oo[_a].geometry[0].pop(),Oo[_a].geometry[0]=Oo[_a].geometry[0].concat(Ys[0]),_a}function Cs(oo,$o,Ys){var _a=Eo[$o];return delete Eo[$o],Eo[oo]=_a,Oo[_a].geometry[0].shift(),Oo[_a].geometry[0]=Ys[0].concat(Oo[_a].geometry[0]),_a}function ou(oo,$o,Ys){var _a=Ys?$o[0][$o[0].length-1]:$o[0][0];return oo+":"+_a.x+":"+_a.y}for(var zo=0;zo<Po.length;zo++){var As=Po[zo],Qi=As.geometry,Za=As.text?As.text.toString():null;if(Za){var ka=ou(Za,Qi),ha=ou(Za,Qi,!0);if(ka in mo&&ha in Eo&&mo[ka]!==Eo[ha]){var _u=Cs(ka,ha,Qi),Xs=au(ka,ha,Oo[_u].geometry);delete Eo[ka],delete mo[ha],mo[ou(Za,Oo[Xs].geometry,!0)]=Xs,Oo[_u].geometry=null}else ka in mo?au(ka,ha,Qi):ha in Eo?Cs(ka,ha,Qi):(vs(zo),Eo[ka]=ds-1,mo[ha]=ds-1)}else vs(zo)}return Oo.filter(function(oo){return oo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Po,Eo){return Po.sortKey-Eo.sortKey})}},Xe.prototype.update=function(n,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(n,o,this.layers,u))},Xe.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Xe.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Xe.prototype.upload=function(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Xe.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Xe.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Xe.prototype.addToLineVertexArray=function(n,o){var u=this.lineVertexArray.length;if(n.segment!==void 0){for(var p=n.dist(o[n.segment+1]),_=n.dist(o[n.segment]),E={},A=n.segment+1;A<o.length;A++)E[A]={x:o[A].x,y:o[A].y,tileUnitDistanceFromAnchor:p},A<o.length-1&&(p+=o[A+1].dist(o[A]));for(var O=n.segment||0;O>=0;O--)E[O]={x:o[O].x,y:o[O].y,tileUnitDistanceFromAnchor:_},O>0&&(_+=o[O-1].dist(o[O]));for(var B=0;B<o.length;B++){var j=E[B];this.lineVertexArray.emplaceBack(j.x,j.y,j.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Xe.prototype.addSymbols=function(n,o,u,p,_,E,A,O,B,j,H,te){for(var ce=n.indexArray,_e=n.layoutVertexArray,Ue=n.segments.prepareSegment(4*o.length,_e,ce,this.canOverlap?E.sortKey:void 0),He=this.glyphOffsetArray.length,ft=Ue.vertexLength,rt=this.allowVerticalPlacement&&A===tn.vertical?Math.PI/2:0,Lt=E.text&&E.text.sections,$t=0;$t<o.length;$t++){var Mt=o[$t],Pt=Mt.tl,Cr=Mt.tr,Xr=Mt.bl,pn=Mt.br,ti=Mt.tex,In=Mt.pixelOffsetTL,oi=Mt.pixelOffsetBR,Rn=Mt.minFontScaleX,Xi=Mt.minFontScaleY,_i=Mt.glyphOffset,Gn=Mt.isSDF,ea=Mt.sectionIndex,Ui=Ue.vertexLength,la=_i[1];ye(_e,O.x,O.y,Pt.x,la+Pt.y,ti.x,ti.y,u,Gn,In.x,In.y,Rn,Xi),ye(_e,O.x,O.y,Cr.x,la+Cr.y,ti.x+ti.w,ti.y,u,Gn,oi.x,In.y,Rn,Xi),ye(_e,O.x,O.y,Xr.x,la+Xr.y,ti.x,ti.y+ti.h,u,Gn,In.x,oi.y,Rn,Xi),ye(_e,O.x,O.y,pn.x,la+pn.y,ti.x+ti.w,ti.y+ti.h,u,Gn,oi.x,oi.y,Rn,Xi),st(n.dynamicLayoutVertexArray,O,rt),ce.emplaceBack(Ui,Ui+1,Ui+2),ce.emplaceBack(Ui+1,Ui+2,Ui+3),Ue.vertexLength+=4,Ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_i[0]),$t!==o.length-1&&ea===o[$t+1].sectionIndex||n.programConfigurations.populatePaintArrays(_e.length,E,E.index,{},te,Lt&&Lt[ea])}n.placedSymbolArray.emplaceBack(O.x,O.y,He,this.glyphOffsetArray.length-He,ft,B,j,O.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],A,0,!1,0,H)},Xe.prototype._addCollisionDebugVertex=function(n,o,u,p,_,E){return o.emplaceBack(0,0),n.emplaceBack(u.x,u.y,p,_,Math.round(E.x),Math.round(E.y))},Xe.prototype.addCollisionDebugVertices=function(n,o,u,p,_,E,A){var O=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),B=O.vertexLength,j=_.layoutVertexArray,H=_.collisionVertexArray,te=A.anchorX,ce=A.anchorY;this._addCollisionDebugVertex(j,H,E,te,ce,new ne(n,o)),this._addCollisionDebugVertex(j,H,E,te,ce,new ne(u,o)),this._addCollisionDebugVertex(j,H,E,te,ce,new ne(u,p)),this._addCollisionDebugVertex(j,H,E,te,ce,new ne(n,p)),O.vertexLength+=4;var _e=_.indexArray;_e.emplaceBack(B,B+1),_e.emplaceBack(B+1,B+2),_e.emplaceBack(B+2,B+3),_e.emplaceBack(B+3,B),O.primitiveLength+=4},Xe.prototype.addDebugCollisionBoxes=function(n,o,u,p){for(var _=n;_<o;_++){var E=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,p?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,u)}},Xe.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ht(dc,Ep.members,vc),this.iconCollisionBox=new ht(dc,Ep.members,vc);for(var n=0;n<this.symbolInstances.length;n++){var o=this.symbolInstances.get(n);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Xe.prototype._deserializeCollisionBoxesForSymbol=function(n,o,u,p,_,E,A,O,B){for(var j={},H=o;H<u;H++){var te=n.get(H);j.textBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},j.textFeatureIndex=te.featureIndex;break}for(var ce=p;ce<_;ce++){var _e=n.get(ce);j.verticalTextBox={x1:_e.x1,y1:_e.y1,x2:_e.x2,y2:_e.y2,anchorPointX:_e.anchorPointX,anchorPointY:_e.anchorPointY},j.verticalTextFeatureIndex=_e.featureIndex;break}for(var Ue=E;Ue<A;Ue++){var He=n.get(Ue);j.iconBox={x1:He.x1,y1:He.y1,x2:He.x2,y2:He.y2,anchorPointX:He.anchorPointX,anchorPointY:He.anchorPointY},j.iconFeatureIndex=He.featureIndex;break}for(var ft=O;ft<B;ft++){var rt=n.get(ft);j.verticalIconBox={x1:rt.x1,y1:rt.y1,x2:rt.x2,y2:rt.y2,anchorPointX:rt.anchorPointX,anchorPointY:rt.anchorPointY},j.verticalIconFeatureIndex=rt.featureIndex;break}return j},Xe.prototype.deserializeCollisionBoxes=function(n){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Xe.prototype.hasTextData=function(){return this.text.segments.get().length>0},Xe.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Xe.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Xe.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Xe.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Xe.prototype.addIndicesForPlacedSymbol=function(n,o){for(var u=n.placedSymbolArray.get(o),p=u.vertexStartIndex+4*u.numGlyphs,_=u.vertexStartIndex;_<p;_+=4)n.indexArray.emplaceBack(_,_+1,_+2),n.indexArray.emplaceBack(_+1,_+2,_+3)},Xe.prototype.getSortedSymbolIndexes=function(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(n),u=Math.cos(n),p=[],_=[],E=[],A=0;A<this.symbolInstances.length;++A){E.push(A);var O=this.symbolInstances.get(A);p.push(0|Math.round(o*O.anchorX+u*O.anchorY)),_.push(O.featureIndex)}return E.sort(function(B,j){return p[B]-p[j]||_[j]-_[B]}),E},Xe.prototype.addToSortKeyRanges=function(n,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})},Xe.prototype.sortFeatures=function(n){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,p=this.symbolInstanceIndexes;u<p.length;u+=1){var _=this.symbolInstances.get(p[u]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(E,A,O){E>=0&&O.indexOf(E)===A&&o.addIndicesForPlacedSymbol(o.text,E)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Mn("SymbolBucket",Xe,{omit:["layers","collisionBoxArray","features","compareText"]}),Xe.MAX_GLYPHS=65535,Xe.addDynamicAttributes=st;var Ct=new ts({"symbol-placement":new Kn(be.layout_symbol["symbol-placement"]),"symbol-spacing":new Kn(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Kn(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new jn(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Kn(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Kn(be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Kn(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new Kn(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Kn(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new jn(be.layout_symbol["icon-size"]),"icon-text-fit":new Kn(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Kn(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new jn(be.layout_symbol["icon-image"]),"icon-rotate":new jn(be.layout_symbol["icon-rotate"]),"icon-padding":new Kn(be.layout_symbol["icon-padding"]),"icon-keep-upright":new Kn(be.layout_symbol["icon-keep-upright"]),"icon-offset":new jn(be.layout_symbol["icon-offset"]),"icon-anchor":new jn(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Kn(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Kn(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Kn(be.layout_symbol["text-rotation-alignment"]),"text-field":new jn(be.layout_symbol["text-field"]),"text-font":new jn(be.layout_symbol["text-font"]),"text-size":new jn(be.layout_symbol["text-size"]),"text-max-width":new jn(be.layout_symbol["text-max-width"]),"text-line-height":new Kn(be.layout_symbol["text-line-height"]),"text-letter-spacing":new jn(be.layout_symbol["text-letter-spacing"]),"text-justify":new jn(be.layout_symbol["text-justify"]),"text-radial-offset":new jn(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Kn(be.layout_symbol["text-variable-anchor"]),"text-anchor":new jn(be.layout_symbol["text-anchor"]),"text-max-angle":new Kn(be.layout_symbol["text-max-angle"]),"text-writing-mode":new Kn(be.layout_symbol["text-writing-mode"]),"text-rotate":new jn(be.layout_symbol["text-rotate"]),"text-padding":new Kn(be.layout_symbol["text-padding"]),"text-keep-upright":new Kn(be.layout_symbol["text-keep-upright"]),"text-transform":new jn(be.layout_symbol["text-transform"]),"text-offset":new jn(be.layout_symbol["text-offset"]),"text-allow-overlap":new Kn(be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Kn(be.layout_symbol["text-ignore-placement"]),"text-optional":new Kn(be.layout_symbol["text-optional"])}),Pe={paint:new ts({"icon-opacity":new jn(be.paint_symbol["icon-opacity"]),"icon-color":new jn(be.paint_symbol["icon-color"]),"icon-halo-color":new jn(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new jn(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new jn(be.paint_symbol["icon-halo-blur"]),"icon-translate":new Kn(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new Kn(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new jn(be.paint_symbol["text-opacity"]),"text-color":new jn(be.paint_symbol["text-color"],{runtimeType:cn,getOverride:function(n){return n.textColor},hasOverride:function(n){return!!n.textColor}}),"text-halo-color":new jn(be.paint_symbol["text-halo-color"]),"text-halo-width":new jn(be.paint_symbol["text-halo-width"]),"text-halo-blur":new jn(be.paint_symbol["text-halo-blur"]),"text-translate":new Kn(be.paint_symbol["text-translate"]),"text-translate-anchor":new Kn(be.paint_symbol["text-translate-anchor"])}),layout:Ct},tt=function(n){this.type=n.property.overrides?n.property.overrides.runtimeType:Tn,this.defaultValue=n};tt.prototype.evaluate=function(n){if(n.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default},tt.prototype.eachChild=function(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)},tt.prototype.outputDefined=function(){return!1},tt.prototype.serialize=function(){return null},Mn("FormatSectionOverride",tt,{omit:["defaultValue"]});var Be=function(n){function o(u){n.call(this,u,Pe)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.recalculate=function(u,p){if(n.prototype.recalculate.call(this,u,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var E=[],A=0,O=_;A<O.length;A+=1){var B=O[A];E.indexOf(B)<0&&E.push(B)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,p,_,E){var A=this.layout.get(u).evaluate(p,{},_,E),O=this._unevaluatedLayout._values[u];return O.isDataDriven()||Ku(O.value)||!A?A:function(B,j){return j.replace(/{([^{}]+)}/g,function(H,te){return te in B?String(B[te]):""})}(p.properties,A)},o.prototype.createBucket=function(u){return new Xe(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,p=Pe.paint.overridableProperties;u<p.length;u+=1){var _=p[u];if(o.hasPaintOverride(this.layout,_)){var E,A=this.paint.get(_),O=new tt(A),B=new fl(O,A.property.specification);E=A.value.kind==="constant"||A.value.kind==="source"?new ic("source",B):new Ll("composite",B,A.value.zoomStops,A.value._interpolationType),this.paint._values[_]=new bs(A.property,E,A.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,_){return!(!this.layout||p.isDataDriven()||_.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,p){var _=u.get("text-field"),E=Pe.paint.properties[p],A=!1,O=function(H){for(var te=0,ce=H;te<ce.length;te+=1)if(E.overrides&&E.overrides.hasOverride(ce[te]))return void(A=!0)};if(_.value.kind==="constant"&&_.value.value instanceof Fa)O(_.value.value.sections);else if(_.value.kind==="source"){var B=function(H){A||(H instanceof he&&yt(H.value)===ca?O(H.value.sections):H instanceof uo?O(H.sections):H.eachChild(B))},j=_.value;j._styleExpression&&B(j._styleExpression.expression)}return A},o}(Nu),Ft={paint:new ts({"background-color":new Kn(be.paint_background["background-color"]),"background-pattern":new Es(be.paint_background["background-pattern"]),"background-opacity":new Kn(be.paint_background["background-opacity"])})},Kt=function(n){function o(u){n.call(this,u,Ft)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(Nu),Or={paint:new ts({"raster-opacity":new Kn(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new Kn(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Kn(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Kn(be.paint_raster["raster-brightness-max"]),"raster-saturation":new Kn(be.paint_raster["raster-saturation"]),"raster-contrast":new Kn(be.paint_raster["raster-contrast"]),"raster-resampling":new Kn(be.paint_raster["raster-resampling"]),"raster-fade-duration":new Kn(be.paint_raster["raster-fade-duration"])})},nn=function(n){function o(u){n.call(this,u,Or)}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o}(Nu),an=function(n){function o(u){n.call(this,u,{}),this.implementation=u}return n&&(o.__proto__=n),(o.prototype=Object.create(n&&n.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(Nu),xn={circle:Pf,heatmap:If,hillshade:cp,fill:Bf,"fill-extrusion":Sl,line:xp,symbol:Be,background:Kt,raster:nn},$r=re.HTMLImageElement,Zn=re.HTMLCanvasElement,Cn=re.HTMLVideoElement,Bn=re.ImageData,Nn=re.ImageBitmap,On=function(n,o,u,p){this.context=n,this.format=u,this.texture=n.gl.createTexture(),this.update(o,p)};On.prototype.update=function(n,o,u){var p=n.width,_=n.height,E=!(this.size&&this.size[0]===p&&this.size[1]===_||u),A=this.context,O=A.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),O.bindTexture(O.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===O.RGBA&&(!o||o.premultiply!==!1)),E)this.size=[p,_],n instanceof $r||n instanceof Zn||n instanceof Cn||n instanceof Bn||Nn&&n instanceof Nn?O.texImage2D(O.TEXTURE_2D,0,this.format,this.format,O.UNSIGNED_BYTE,n):O.texImage2D(O.TEXTURE_2D,0,this.format,p,_,0,this.format,O.UNSIGNED_BYTE,n.data);else{var B=u||{x:0,y:0},j=B.x,H=B.y;n instanceof $r||n instanceof Zn||n instanceof Cn||n instanceof Bn||Nn&&n instanceof Nn?O.texSubImage2D(O.TEXTURE_2D,0,j,H,O.RGBA,O.UNSIGNED_BYTE,n):O.texSubImage2D(O.TEXTURE_2D,0,j,H,p,_,O.RGBA,O.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&O.generateMipmap(O.TEXTURE_2D)},On.prototype.bind=function(n,o,u){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),n!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||n),this.filter=n),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)},On.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},On.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var hi=function(n){var o=this;this._callback=n,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};hi.prototype.trigger=function(){var n=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){n._triggered=!1,n._callback()},0))},hi.prototype.remove=function(){delete this._channel,this._callback=function(){}};var wa=function(n,o,u){this.target=n,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Vt(["receive","process"],this),this.invoker=new hi(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=q()?n:re};function as(n,o,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[n*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}wa.prototype.send=function(n,o,u,p,_){var E=this;_===void 0&&(_=!1);var A=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[A]=u);var O=le(this.globalScope)?void 0:[];return this.target.postMessage({id:A,type:n,hasCallback:!!u,targetMapId:p,mustQueue:_,sourceMapId:this.mapId,data:lu(o,O)},O),{cancel:function(){u&&delete E.callbacks[A],E.target.postMessage({id:A,type:"<cancel>",targetMapId:p,sourceMapId:E.mapId})}}},wa.prototype.receive=function(n){var o=n.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p()}else q()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},wa.prototype.process=function(){if(this.taskQueue.length){var n=this.taskQueue.shift(),o=this.tasks[n];delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(n,o)}},wa.prototype.processTask=function(n,o){var u=this;if(o.type==="<response>"){var p=this.callbacks[n];delete this.callbacks[n],p&&(o.error?p(Us(o.error)):p(null,Us(o.data)))}else{var _=!1,E=le(this.globalScope)?void 0:[],A=o.hasCallback?function(H,te){_=!0,delete u.cancelCallbacks[n],u.target.postMessage({id:n,type:"<response>",sourceMapId:u.mapId,error:H?lu(H):null,data:lu(te,E)},E)}:function(H){_=!0},O=null,B=Us(o.data);if(this.parent[o.type])O=this.parent[o.type](o.sourceMapId,B,A);else if(this.parent.getWorkerSource){var j=o.type.split(".");O=this.parent.getWorkerSource(o.sourceMapId,j[0],B.source)[j[1]](B,A)}else A(new Error("Could not find function "+o.type));!_&&O&&O.cancel&&(this.cancelCallbacks[n]=O.cancel)}},wa.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var La=function(n,o){n&&(o?this.setSouthWest(n).setNorthEast(o):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))};La.prototype.setNorthEast=function(n){return this._ne=n instanceof fa?new fa(n.lng,n.lat):fa.convert(n),this},La.prototype.setSouthWest=function(n){return this._sw=n instanceof fa?new fa(n.lng,n.lat):fa.convert(n),this},La.prototype.extend=function(n){var o,u,p=this._sw,_=this._ne;if(n instanceof fa)o=n,u=n;else{if(!(n instanceof La))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(La.convert(n)):this.extend(fa.convert(n)):this;if(u=n._ne,!(o=n._sw)||!u)return this}return p||_?(p.lng=Math.min(o.lng,p.lng),p.lat=Math.min(o.lat,p.lat),_.lng=Math.max(u.lng,_.lng),_.lat=Math.max(u.lat,_.lat)):(this._sw=new fa(o.lng,o.lat),this._ne=new fa(u.lng,u.lat)),this},La.prototype.getCenter=function(){return new fa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},La.prototype.getSouthWest=function(){return this._sw},La.prototype.getNorthEast=function(){return this._ne},La.prototype.getNorthWest=function(){return new fa(this.getWest(),this.getNorth())},La.prototype.getSouthEast=function(){return new fa(this.getEast(),this.getSouth())},La.prototype.getWest=function(){return this._sw.lng},La.prototype.getSouth=function(){return this._sw.lat},La.prototype.getEast=function(){return this._ne.lng},La.prototype.getNorth=function(){return this._ne.lat},La.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},La.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},La.prototype.isEmpty=function(){return!(this._sw&&this._ne)},La.prototype.contains=function(n){var o=fa.convert(n),u=o.lng,p=o.lat,_=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&_},La.convert=function(n){return!n||n instanceof La?n:new La(n)};var fa=function(n,o){if(isNaN(n)||isNaN(o))throw new Error("Invalid LngLat object: ("+n+", "+o+")");if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};fa.prototype.wrap=function(){return new fa(Jt(this.lng,-180,180),this.lat)},fa.prototype.toArray=function(){return[this.lng,this.lat]},fa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},fa.prototype.distanceTo=function(n){var o=Math.PI/180,u=this.lat*o,p=n.lat*o,_=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((n.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(_,1))},fa.prototype.toBounds=function(n){n===void 0&&(n=0);var o=360*n/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new La(new fa(this.lng-u,this.lat-o),new fa(this.lng+u,this.lat+o))},fa.convert=function(n){if(n instanceof fa)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new fa(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new fa(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Cl=2*Math.PI*63710088e-1;function ks(n){return Cl*Math.cos(n*Math.PI/180)}function Vu(n){return(180+n)/360}function Mu(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Cp(n,o){return n/ks(o)}function Pu(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}var Cc=function(n,o,u){u===void 0&&(u=0),this.x=+n,this.y=+o,this.z=+u};Cc.fromLngLat=function(n,o){o===void 0&&(o=0);var u=fa.convert(n);return new Cc(Vu(u.lng),Mu(u.lat),Cp(o,u.lat))},Cc.prototype.toLngLat=function(){return new fa(360*this.x-180,Pu(this.y))},Cc.prototype.toAltitude=function(){return this.z*ks(Pu(this.y))},Cc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Cl*(n=Pu(this.y),1/Math.cos(n*Math.PI/180));var n};var dh=function(n,o,u){this.z=n,this.x=o,this.y=u,this.key=Uh(0,n,n,o,u)};dh.prototype.equals=function(n){return this.z===n.z&&this.x===n.x&&this.y===n.y},dh.prototype.url=function(n,o){var u,p,_,E,A,O=(p=this.y,_=this.z,E=as(256*(u=this.x),256*(p=Math.pow(2,_)-p-1),_),A=as(256*(u+1),256*(p+1),_),E[0]+","+E[1]+","+A[0]+","+A[1]),B=function(j,H,te){for(var ce,_e="",Ue=j;Ue>0;Ue--)_e+=(H&(ce=1<<Ue-1)?1:0)+(te&ce?2:0);return _e}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",B).replace("{bbox-epsg-3857}",O)},dh.prototype.getTilePoint=function(n){var o=Math.pow(2,this.z);return new ne(8192*(n.x*o-this.x),8192*(n.y*o-this.y))},dh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var O0=function(n,o){this.wrap=n,this.canonical=o,this.key=Uh(n,o.z,o.z,o.x,o.y)},Ko=function(n,o,u,p,_){this.overscaledZ=n,this.wrap=o,this.canonical=new dh(u,+p,+_),this.key=Uh(o,n,u,p,_)};function Uh(n,o,u,p,_){(n*=2)<0&&(n=-1*n-1);var E=1<<u;return(E*E*n+E*_+p).toString(36)+u.toString(36)+o.toString(36)}Ko.prototype.equals=function(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)},Ko.prototype.scaledTo=function(n){var o=this.canonical.z-n;return n>this.canonical.z?new Ko(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ko(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)},Ko.prototype.calculateScaledKey=function(n,o){var u=this.canonical.z-n;return n>this.canonical.z?Uh(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y):Uh(this.wrap*+o,n,n,this.canonical.x>>u,this.canonical.y>>u)},Ko.prototype.isChildOf=function(n){if(n.wrap!==this.wrap)return!1;var o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o},Ko.prototype.children=function(n){if(this.overscaledZ>=n)return[new Ko(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new Ko(o,this.wrap,o,u,p),new Ko(o,this.wrap,o,u+1,p),new Ko(o,this.wrap,o,u,p+1),new Ko(o,this.wrap,o,u+1,p+1)]},Ko.prototype.isLessThan=function(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))},Ko.prototype.wrapped=function(){return new Ko(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Ko.prototype.unwrapTo=function(n){return new Ko(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)},Ko.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Ko.prototype.toUnwrapped=function(){return new O0(this.wrap,this.canonical)},Ko.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Ko.prototype.getTilePoint=function(n){return this.canonical.getTilePoint(new Cc(n.x-this.wrap,n.y))},Mn("CanonicalTileID",dh),Mn("OverscaledTileID",Ko,{omit:["posMatrix"]});var uf=function(n,o,u){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return ut('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var _=0;_<p;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(p,_)]=this.data[this._idx(p-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,p)]=this.data[this._idx(_,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};uf.prototype.get=function(n,o){var u=new Uint8Array(this.data.buffer),p=4*this._idx(n,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])},uf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},uf.prototype._idx=function(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)},uf.prototype._unpackMapbox=function(n,o,u){return(256*n*256+256*o+u)/10-1e4},uf.prototype._unpackTerrarium=function(n,o,u){return 256*n+o+u/256-32768},uf.prototype.getPixels=function(){return new ko({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},uf.prototype.backfillBorder=function(n,o,u){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");var p=o*this.dim,_=o*this.dim+this.dim,E=u*this.dim,A=u*this.dim+this.dim;switch(o){case-1:p=_-1;break;case 1:_=p+1}switch(u){case-1:E=A-1;break;case 1:A=E+1}for(var O=-o*this.dim,B=-u*this.dim,j=E;j<A;j++)for(var H=p;H<_;H++)this.data[this._idx(H,j)]=n.data[this._idx(H+O,j+B)]},Mn("DEMData",uf);var od=function(n){this._stringToNumber={},this._numberToString=[];for(var o=0;o<n.length;o++){var u=n[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};od.prototype.encode=function(n){return this._stringToNumber[n]},od.prototype.decode=function(n){return this._numberToString[n]};var sd=function(n,o,u,p,_){this.type="Feature",this._vectorTileFeature=n,n._z=o,n._x=u,n._y=p,this.properties=n.properties,this.id=_},Ap={geometry:{configurable:!0}};Ap.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Ap.geometry.set=function(n){this._geometry=n},sd.prototype.toJSON=function(){var n={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(n[o]=this[o]);return n},Object.defineProperties(sd.prototype,Ap);var jh=function(){this.state={},this.stateChanges={},this.deletedStates={}};jh.prototype.updateState=function(n,o,u){var p=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][p]=this.stateChanges[n][p]||{},_t(this.stateChanges[n][p],u),this.deletedStates[n]===null)for(var _ in this.deletedStates[n]={},this.state[n])_!==p&&(this.deletedStates[n][_]=null);else if(this.deletedStates[n]&&this.deletedStates[n][p]===null)for(var E in this.deletedStates[n][p]={},this.state[n][p])u[E]||(this.deletedStates[n][p][E]=null);else for(var A in u)this.deletedStates[n]&&this.deletedStates[n][p]&&this.deletedStates[n][p][A]===null&&delete this.deletedStates[n][p][A]},jh.prototype.removeFeatureState=function(n,o,u){if(this.deletedStates[n]!==null){var p=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},u&&o!==void 0)this.deletedStates[n][p]!==null&&(this.deletedStates[n][p]=this.deletedStates[n][p]||{},this.deletedStates[n][p][u]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][p])for(u in this.deletedStates[n][p]={},this.stateChanges[n][p])this.deletedStates[n][p][u]=null;else this.deletedStates[n][p]=null;else this.deletedStates[n]=null}},jh.prototype.getState=function(n,o){var u=String(o),p=_t({},(this.state[n]||{})[u],(this.stateChanges[n]||{})[u]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){var _=this.deletedStates[n][o];if(_===null)return{};for(var E in _)delete p[E]}return p},jh.prototype.initializeTileState=function(n,o){n.setFeatureState(this.state,o)},jh.prototype.coalesceChanges=function(n,o){var u={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var _={};for(var E in this.stateChanges[p])this.state[p][E]||(this.state[p][E]={}),_t(this.state[p][E],this.stateChanges[p][E]),_[E]=this.state[p][E];u[p]=_}for(var A in this.deletedStates){this.state[A]=this.state[A]||{};var O={};if(this.deletedStates[A]===null)for(var B in this.state[A])O[B]={},this.state[A][B]={};else for(var j in this.deletedStates[A]){if(this.deletedStates[A][j]===null)this.state[A][j]={};else for(var H=0,te=Object.keys(this.deletedStates[A][j]);H<te.length;H+=1)delete this.state[A][j][te[H]];O[j]=this.state[A][j]}u[A]=u[A]||{},_t(u[A],O)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var ce in n)n[ce].setFeatureState(u,o)};var lf=function(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Zs(8192,16,0),this.grid3D=new Zs(8192,16,0),this.featureIndexArray=new Q,this.promoteId=o};function Vd(n,o,u,p,_){return rr(n,function(E,A){var O=o instanceof Js?o.get(A):null;return O&&O.evaluate?O.evaluate(u,p,_):O})}function Gd(n){for(var o=1/0,u=1/0,p=-1/0,_=-1/0,E=0,A=n;E<A.length;E+=1){var O=A[E];o=Math.min(o,O.x),u=Math.min(u,O.y),p=Math.max(p,O.x),_=Math.max(_,O.y)}return{minX:o,minY:u,maxX:p,maxY:_}}function kv(n,o){return o-n}lf.prototype.insert=function(n,o,u,p,_,E){var A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,_);for(var O=E?this.grid3D:this.grid,B=0;B<o.length;B++){for(var j=o[B],H=[1/0,1/0,-1/0,-1/0],te=0;te<j.length;te++){var ce=j[te];H[0]=Math.min(H[0],ce.x),H[1]=Math.min(H[1],ce.y),H[2]=Math.max(H[2],ce.x),H[3]=Math.max(H[3],ce.y)}H[0]<8192&&H[1]<8192&&H[2]>=0&&H[3]>=0&&O.insert(A,H[0],H[1],H[2],H[3])}},lf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Tu.VectorTile(new ph(this.rawTileData)).layers,this.sourceLayerCoder=new od(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},lf.prototype.query=function(n,o,u,p){var _=this;this.loadVTLayers();for(var E=n.params||{},A=8192/n.tileSize/n.scale,O=$u(E.filter),B=n.queryGeometry,j=n.queryPadding*A,H=Gd(B),te=this.grid.query(H.minX-j,H.minY-j,H.maxX+j,H.maxY+j),ce=Gd(n.cameraQueryGeometry),_e=this.grid3D.query(ce.minX-j,ce.minY-j,ce.maxX+j,ce.maxY+j,function(Mt,Pt,Cr,Xr){return function(pn,ti,In,oi,Rn){for(var Xi=0,_i=pn;Xi<_i.length;Xi+=1){var Gn=_i[Xi];if(ti<=Gn.x&&In<=Gn.y&&oi>=Gn.x&&Rn>=Gn.y)return!0}var ea=[new ne(ti,In),new ne(ti,Rn),new ne(oi,Rn),new ne(oi,In)];if(pn.length>2){for(var Ui=0,la=ea;Ui<la.length;Ui+=1)if(vu(pn,la[Ui]))return!0}for(var si=0;si<pn.length-1;si++)if(_l(pn[si],pn[si+1],ea))return!0;return!1}(n.cameraQueryGeometry,Mt-j,Pt-j,Cr+j,Xr+j)}),Ue=0,He=_e;Ue<He.length;Ue+=1)te.push(He[Ue]);te.sort(kv);for(var ft,rt={},Lt=function(Mt){var Pt=te[Mt];if(Pt!==ft){ft=Pt;var Cr=_.featureIndexArray.get(Pt),Xr=null;_.loadMatchingFeature(rt,Cr.bucketIndex,Cr.sourceLayerIndex,Cr.featureIndex,O,E.layers,E.availableImages,o,u,p,function(pn,ti,In){return Xr||(Xr=Qa(pn)),ti.queryIntersectsFeature(B,pn,In,Xr,_.z,n.transform,A,n.pixelPosMatrix)})}},$t=0;$t<te.length;$t++)Lt($t);return rt},lf.prototype.loadMatchingFeature=function(n,o,u,p,_,E,A,O,B,j,H){var te=this.bucketLayerIDs[o];if(!E||function(pn,ti){for(var In=0;In<pn.length;In++)if(ti.indexOf(pn[In])>=0)return!0;return!1}(E,te)){var ce=this.sourceLayerCoder.decode(u),_e=this.vtLayers[ce].feature(p);if(_.needGeometry){var Ue=po(_e,!0);if(!_.filter(new Sn(this.tileID.overscaledZ),Ue,this.tileID.canonical))return}else if(!_.filter(new Sn(this.tileID.overscaledZ),_e))return;for(var He=this.getId(_e,ce),ft=0;ft<te.length;ft++){var rt=te[ft];if(!(E&&E.indexOf(rt)<0)){var Lt=O[rt];if(Lt){var $t={};He!==void 0&&j&&($t=j.getState(Lt.sourceLayer||"_geojsonTileLayer",He));var Mt=_t({},B[rt]);Mt.paint=Vd(Mt.paint,Lt.paint,_e,$t,A),Mt.layout=Vd(Mt.layout,Lt.layout,_e,$t,A);var Pt=!H||H(_e,Lt,$t);if(Pt){var Cr=new sd(_e,this.z,this.x,this.y,He);Cr.layer=Mt;var Xr=n[rt];Xr===void 0&&(Xr=n[rt]=[]),Xr.push({featureIndex:p,feature:Cr,intersectionZ:Pt})}}}}}},lf.prototype.lookupSymbolFeatures=function(n,o,u,p,_,E,A,O){var B={};this.loadVTLayers();for(var j=$u(_),H=0,te=n;H<te.length;H+=1)this.loadMatchingFeature(B,u,p,te[H],j,E,A,O,o);return B},lf.prototype.hasLayer=function(n){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var p=0,_=u[o];p<_.length;p+=1)if(n===_[p])return!0;return!1},lf.prototype.getId=function(n,o){var u=n.id;return this.promoteId&&typeof(u=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},Mn("FeatureIndex",lf,{omit:["rawTileData","sourceLayerCoder"]});var os=function(n,o){this.tileID=n,this.uid=Tt(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};os.prototype.registerFadeDuration=function(n){var o=n+this.timeAdded;o<An.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},os.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},os.prototype.loadVectorData=function(n,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){for(var p in n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(j,H){var te={};if(!H)return te;for(var ce=function(){var He=Ue[_e],ft=He.layerIds.map(function($t){return H.getLayer($t)}).filter(Boolean);if(ft.length!==0){He.layers=ft,He.stateDependentLayerIds&&(He.stateDependentLayers=He.stateDependentLayerIds.map(function($t){return ft.filter(function(Mt){return Mt.id===$t})[0]}));for(var rt=0,Lt=ft;rt<Lt.length;rt+=1)te[Lt[rt].id]=He}},_e=0,Ue=j;_e<Ue.length;_e+=1)ce();return te}(n.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[p];if(_ instanceof Xe){if(this.hasSymbolBuckets=!0,!u)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var A=this.buckets[E];if(A instanceof Xe&&A.hasRTLText){this.hasRTLText=!0,js.isLoading()||js.isLoaded()||fc()!=="deferred"||Os();break}}for(var O in this.queryPadding=0,this.buckets){var B=this.buckets[O];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(O).queryRadius(B))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new h},os.prototype.unloadVectorData=function(){for(var n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},os.prototype.getBucket=function(n){return this.buckets[n.id]},os.prototype.upload=function(n){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(n)}var p=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new On(n,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new On(n,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},os.prototype.prepare=function(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)},os.prototype.queryRenderedFeatures=function(n,o,u,p,_,E,A,O,B,j){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:_,scale:E,tileSize:this.tileSize,pixelPosMatrix:j,transform:O,params:A,queryPadding:this.queryPadding*B},n,o,u):{}},os.prototype.querySourceFeatures=function(n,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var p=u.loadVTLayers(),_=o?o.sourceLayer:"",E=p._geojsonTileLayer||p[_];if(E)for(var A=$u(o&&o.filter),O=this.tileID.canonical,B=O.z,j=O.x,H=O.y,te={z:B,x:j,y:H},ce=0;ce<E.length;ce++){var _e=E.feature(ce);if(A.needGeometry){var Ue=po(_e,!0);if(!A.filter(new Sn(this.tileID.overscaledZ),Ue,this.tileID.canonical))continue}else if(!A.filter(new Sn(this.tileID.overscaledZ),_e))continue;var He=u.getId(_e,_),ft=new sd(_e,B,j,H,He);ft.tile=te,n.push(ft)}}},os.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},os.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},os.prototype.setExpiryData=function(n){var o=this.expirationTime;if(n.cacheControl){var u=pe(n.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){var p=Date.now(),_=!1;if(this.expirationTime>p)_=!1;else if(o)if(this.expirationTime<o)_=!0;else{var E=this.expirationTime-o;E?this.expirationTime=p+Math.max(E,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},os.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},os.prototype.setFeatureState=function(n,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(o.style.hasLayer(p)){var _=this.buckets[p],E=_.layers[0].sourceLayer||"_geojsonTileLayer",A=u[E],O=n[E];if(A&&O&&Object.keys(O).length!==0){_.update(O,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});var B=o&&o.style&&o.style.getLayer(p);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(_)))}}}},os.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},os.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<An.now()},os.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},os.prototype.setHoldDuration=function(n){this.symbolFadeHoldUntil=An.now()+n},os.prototype.setDependencies=function(n,o){for(var u={},p=0,_=o;p<_.length;p+=1)u[_[p]]=!0;this.dependencies[n]=u},os.prototype.hasDependency=function(n,o){for(var u=0,p=n;u<p.length;u+=1){var _=this.dependencies[p[u]];if(_){for(var E=0,A=o;E<A.length;E+=1)if(_[A[E]])return!0}}return!1};var cf=re.performance,I0=function(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},cf.mark(this._marks.start)};I0.prototype.finish=function(){cf.mark(this._marks.end);var n=cf.getEntriesByName(this._marks.measure);return n.length===0&&(cf.measure(this._marks.measure,this._marks.start,this._marks.end),n=cf.getEntriesByName(this._marks.measure),cf.clearMarks(this._marks.start),cf.clearMarks(this._marks.end),cf.clearMeasures(this._marks.measure)),n},g.Actor=wa,g.AlphaImage=wu,g.CanonicalTileID=dh,g.CollisionBoxArray=h,g.Color=Hi,g.DEMData=uf,g.DataConstantProperty=Kn,g.DictionaryCoder=od,g.EXTENT=8192,g.ErrorEvent=it,g.EvaluationParameters=Sn,g.Event=Ze,g.Evented=gt,g.FeatureIndex=lf,g.FillBucket=Rs,g.FillExtrusionBucket=ju,g.ImageAtlas=Zr,g.ImagePosition=kt,g.LineBucket=ya,g.LngLat=fa,g.LngLatBounds=La,g.MercatorCoordinate=Cc,g.ONE_EM=24,g.OverscaledTileID=Ko,g.Point=ne,g.Point$1=ne,g.Properties=ts,g.Protobuf=ph,g.RGBAImage=ko,g.RequestManager=Ni,g.RequestPerformance=I0,g.ResourceType=Dr,g.SegmentVector=Ee,g.SourceFeatureState=jh,g.StructArrayLayout1ui2=Mf,g.StructArrayLayout2f1f2i16=Ss,g.StructArrayLayout2i4=zl,g.StructArrayLayout3ui6=Ul,g.StructArrayLayout4i8=Hs,g.SymbolBucket=Xe,g.Texture=On,g.Tile=os,g.Transitionable=es,g.Uniform1f=Jr,g.Uniform1i=Lr,g.Uniform2f=Yr,g.Uniform3f=yn,g.Uniform4f=Jn,g.UniformColor=ei,g.UniformMatrix4f=Wi,g.UnwrappedTileID=O0,g.ValidationError=Ye,g.WritingMode=tn,g.ZoomHistory=Cf,g.add=function(n,o,u){return n[0]=o[0]+u[0],n[1]=o[1]+u[1],n[2]=o[2]+u[2],n},g.addDynamicAttributes=st,g.asyncAll=function(n,o,u){if(!n.length)return u(null,[]);var p=n.length,_=new Array(n.length),E=null;n.forEach(function(A,O){o(A,function(B,j){B&&(E=B),_[O]=j,--p==0&&u(E,_)})})},g.bezier=Ve,g.bindAll=Vt,g.browser=An,g.cacheEntryPossiblyAdded=function(n){++Qr>Ht&&(n.getActor().send("enforceCacheSizeLimit",$e),Qr=0)},g.clamp=Je,g.clearTileCache=function(n){var o=re.caches.delete("mapbox-tiles");n&&o.catch(n).then(function(){return n()})},g.clipLine=bo,g.clone=function(n){var o=new aa(16);return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o},g.clone$1=nt,g.clone$2=function(n){var o=new aa(3);return o[0]=n[0],o[1]=n[1],o[2]=n[2],o},g.collisionCircleLayout=Zd,g.config=mn,g.create=function(){var n=new aa(16);return aa!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},g.create$1=function(){var n=new aa(9);return aa!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n},g.create$2=function(){var n=new aa(4);return aa!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},g.createCommonjsModule=fe,g.createExpression=Rl,g.createLayout=Ma,g.createStyleLayer=function(n){return n.type==="custom"?new an(n):new xn[n.type](n)},g.cross=function(n,o,u){var p=o[0],_=o[1],E=o[2],A=u[0],O=u[1],B=u[2];return n[0]=_*B-E*O,n[1]=E*A-p*B,n[2]=p*O-_*A,n},g.deepEqual=function n(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var p=0;p<o.length;p++)if(!n(o[p],u[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var _ in o)if(!n(o[_],u[_]))return!1;return!0}return o===u},g.dot=function(n,o){return n[0]*o[0]+n[1]*o[1]+n[2]*o[2]},g.dot$1=function(n,o){return n[0]*o[0]+n[1]*o[1]+n[2]*o[2]+n[3]*o[3]},g.ease=Ne,g.emitValidationErrors=za,g.endsWith=ee,g.enforceCacheSizeLimit=function(n){or(),V&&V.then(function(o){o.keys().then(function(u){for(var p=0;p<u.length-n;p++)o.delete(u[p])})})},g.evaluateSizeForFeature=di,g.evaluateSizeForZoom=Ai,g.evaluateVariableOffset=Ls,g.evented=nh,g.extend=_t,g.featureFilter=$u,g.filterObject=At,g.fromRotation=function(n,o){var u=Math.sin(o),p=Math.cos(o);return n[0]=p,n[1]=u,n[2]=0,n[3]=-u,n[4]=p,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},g.getAnchorAlignment=dn,g.getAnchorJustification=ze,g.getArrayBuffer=ia,g.getImage=ue,g.getJSON=function(n,o){return ba(_t(n,{type:"json"}),o)},g.getRTLTextPluginStatus=fc,g.getReferrer=qn,g.getVideo=function(n,o){var u,p,_=re.document.createElement("video");_.muted=!0,_.onloadstart=function(){o(null,_)};for(var E=0;E<n.length;E++){var A=re.document.createElement("source");u=n[E],p=void 0,(p=re.document.createElement("a")).href=u,(p.protocol!==re.document.location.protocol||p.host!==re.document.location.host)&&(_.crossOrigin="Anonymous"),A.src=n[E],_.appendChild(A)}return{cancel:function(){}}},g.identity=Ws,g.invert=function(n,o){var u=o[0],p=o[1],_=o[2],E=o[3],A=o[4],O=o[5],B=o[6],j=o[7],H=o[8],te=o[9],ce=o[10],_e=o[11],Ue=o[12],He=o[13],ft=o[14],rt=o[15],Lt=u*O-p*A,$t=u*B-_*A,Mt=u*j-E*A,Pt=p*B-_*O,Cr=p*j-E*O,Xr=_*j-E*B,pn=H*He-te*Ue,ti=H*ft-ce*Ue,In=H*rt-_e*Ue,oi=te*ft-ce*He,Rn=te*rt-_e*He,Xi=ce*rt-_e*ft,_i=Lt*Xi-$t*Rn+Mt*oi+Pt*In-Cr*ti+Xr*pn;return _i?(n[0]=(O*Xi-B*Rn+j*oi)*(_i=1/_i),n[1]=(_*Rn-p*Xi-E*oi)*_i,n[2]=(He*Xr-ft*Cr+rt*Pt)*_i,n[3]=(ce*Cr-te*Xr-_e*Pt)*_i,n[4]=(B*In-A*Xi-j*ti)*_i,n[5]=(u*Xi-_*In+E*ti)*_i,n[6]=(ft*Mt-Ue*Xr-rt*$t)*_i,n[7]=(H*Xr-ce*Mt+_e*$t)*_i,n[8]=(A*Rn-O*In+j*pn)*_i,n[9]=(p*In-u*Rn-E*pn)*_i,n[10]=(Ue*Cr-He*Mt+rt*Lt)*_i,n[11]=(te*Mt-H*Cr-_e*Lt)*_i,n[12]=(O*ti-A*oi-B*pn)*_i,n[13]=(u*oi-p*ti+_*pn)*_i,n[14]=(He*$t-Ue*Pt-ft*Lt)*_i,n[15]=(H*Pt-te*$t+ce*Lt)*_i,n):null},g.isChar=Nr,g.isMapboxURL=ai,g.keysDifference=function(n,o){var u=[];for(var p in n)p in o||u.push(p);return u},g.makeRequest=ba,g.mapObject=rr,g.mercatorXfromLng=Vu,g.mercatorYfromLat=Mu,g.mercatorZfromAltitude=Cp,g.mul=Gc,g.multiply=rs,g.mvt=Tu,g.nextPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},g.normalize=function(n,o){var u=o[0],p=o[1],_=o[2],E=u*u+p*p+_*_;return E>0&&(E=1/Math.sqrt(E)),n[0]=o[0]*E,n[1]=o[1]*E,n[2]=o[2]*E,n},g.number=Sa,g.offscreenCanvasSupported=en,g.ortho=function(n,o,u,p,_,E,A){var O=1/(o-u),B=1/(p-_),j=1/(E-A);return n[0]=-2*O,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*B,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*j,n[11]=0,n[12]=(o+u)*O,n[13]=(_+p)*B,n[14]=(A+E)*j,n[15]=1,n},g.parseGlyphPBF=function(n){return new ph(n).readFields(Ke,[])},g.pbf=ph,g.performSymbolLayout=function(n,o,u,p,_,E,A){n.createArrays(),n.tilePixelRatio=8192/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;var O=n.layers[0].layout,B=n.layers[0]._unevaluatedLayout._values,j={};if(n.textSizeData.kind==="composite"){var H=n.textSizeData,te=H.maxZoom;j.compositeTextSizes=[B["text-size"].possiblyEvaluate(new Sn(H.minZoom),A),B["text-size"].possiblyEvaluate(new Sn(te),A)]}if(n.iconSizeData.kind==="composite"){var ce=n.iconSizeData,_e=ce.maxZoom;j.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new Sn(ce.minZoom),A),B["icon-size"].possiblyEvaluate(new Sn(_e),A)]}j.layoutTextSize=B["text-size"].possiblyEvaluate(new Sn(n.zoom+1),A),j.layoutIconSize=B["icon-size"].possiblyEvaluate(new Sn(n.zoom+1),A),j.textMaxSize=B["text-size"].possiblyEvaluate(new Sn(18));for(var Ue=24*O.get("text-line-height"),He=O.get("text-rotation-alignment")==="map"&&O.get("symbol-placement")!=="point",ft=O.get("text-keep-upright"),rt=O.get("text-size"),Lt=function(){var Pt=Mt[$t],Cr=O.get("text-font").evaluate(Pt,{},A).join(","),Xr=rt.evaluate(Pt,{},A),pn=j.layoutTextSize.evaluate(Pt,{},A),ti=j.layoutIconSize.evaluate(Pt,{},A),In={horizontal:{},vertical:void 0},oi=Pt.text,Rn=[0,0];if(oi){var Xi=oi.toString(),_i=24*O.get("text-letter-spacing").evaluate(Pt,{},A),Gn=function(Qi){for(var Za=0,ka=Qi;Za<ka.length;Za+=1)if(ha=ka[Za].charCodeAt(0),Nr.Arabic(ha)||Nr["Arabic Supplement"](ha)||Nr["Arabic Extended-A"](ha)||Nr["Arabic Presentation Forms-A"](ha)||Nr["Arabic Presentation Forms-B"](ha))return!1;var ha;return!0}(Xi)?_i:0,ea=O.get("text-anchor").evaluate(Pt,{},A),Ui=O.get("text-variable-anchor");if(!Ui){var la=O.get("text-radial-offset").evaluate(Pt,{},A);Rn=la?Ls(ea,[24*la,Di]):O.get("text-offset").evaluate(Pt,{},A).map(function(Qi){return 24*Qi})}var si=He?"center":O.get("text-justify").evaluate(Pt,{},A),ga=O.get("symbol-placement"),vo=ga==="point"?24*O.get("text-max-width").evaluate(Pt,{},A):0,Po=function(){n.allowVerticalPlacement&&Af(Xi)&&(In.vertical=vn(oi,o,u,_,Cr,vo,Ue,ea,"left",Gn,Rn,tn.vertical,!0,ga,pn,Xr))};if(!He&&Ui){for(var Eo=si==="auto"?Ui.map(function(Qi){return ze(Qi)}):[si],mo=!1,Oo=0;Oo<Eo.length;Oo++){var ds=Eo[Oo];if(!In.horizontal[ds])if(mo)In.horizontal[ds]=In.horizontal[0];else{var vs=vn(oi,o,u,_,Cr,vo,Ue,"center",ds,Gn,Rn,tn.horizontal,!1,ga,pn,Xr);vs&&(In.horizontal[ds]=vs,mo=vs.positionedLines.length===1)}}Po()}else{si==="auto"&&(si=ze(ea));var au=vn(oi,o,u,_,Cr,vo,Ue,ea,si,Gn,Rn,tn.horizontal,!1,ga,pn,Xr);au&&(In.horizontal[si]=au),Po(),Af(Xi)&&He&&ft&&(In.vertical=vn(oi,o,u,_,Cr,vo,Ue,ea,si,Gn,Rn,tn.vertical,!1,ga,pn,Xr))}}var Cs=void 0,ou=!1;if(Pt.icon&&Pt.icon.name){var zo=p[Pt.icon.name];zo&&(Cs=function(Qi,Za,ka){var ha=dn(ka),_u=Za[0]-Qi.displaySize[0]*ha.horizontalAlign,Xs=Za[1]-Qi.displaySize[1]*ha.verticalAlign;return{image:Qi,top:Xs,bottom:Xs+Qi.displaySize[1],left:_u,right:_u+Qi.displaySize[0]}}(_[Pt.icon.name],O.get("icon-offset").evaluate(Pt,{},A),O.get("icon-anchor").evaluate(Pt,{},A)),ou=zo.sdf,n.sdfIcons===void 0?n.sdfIcons=zo.sdf:n.sdfIcons!==zo.sdf&&ut("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(zo.pixelRatio!==n.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0))}var As=Xt(In.horizontal)||In.vertical;n.iconsInText=!!As&&As.iconsInText,(As||Cs)&&function(Qi,Za,ka,ha,_u,Xs,oo,$o,Ys,_a,ff){var il=Xs.textMaxSize.evaluate(Za,{});il===void 0&&(il=oo);var hf,Zo=Qi.layers[0].layout,Al=Zo.get("icon-offset").evaluate(Za,{},ff),wl=Xt(ka.horizontal),vh=oo/24,Nf=Qi.tilePixelRatio*vh,al=Qi.tilePixelRatio*il/24,Ou=Qi.tilePixelRatio*$o,mh=Qi.tilePixelRatio*Zo.get("symbol-spacing"),wp=Zo.get("text-padding")*Qi.tilePixelRatio,gh=Zo.get("icon-padding")*Qi.tilePixelRatio,yh=Zo.get("text-max-angle")/180*Math.PI,Tp=Zo.get("text-rotation-alignment")==="map"&&Zo.get("symbol-placement")!=="point",ud=Zo.get("icon-rotation-alignment")==="map"&&Zo.get("symbol-placement")!=="point",pf=Zo.get("symbol-placement"),Mp=mh/2,Ac=Zo.get("icon-text-fit");ha&&Ac!=="none"&&(Qi.allowVerticalPlacement&&ka.vertical&&(hf=yi(ha,ka.vertical,Ac,Zo.get("icon-text-fit-padding"),Al,vh)),wl&&(ha=yi(ha,wl,Ac,Zo.get("icon-text-fit-padding"),Al,vh)));var Uo=function(R0,Xh){Xh.x<0||Xh.x>=8192||Xh.y<0||Xh.y>=8192||function(So,Tl,L0,Xl,Wd,k0,kp,Yl,Dp,Yh,Fp,Uf,vd,Xd,qh,D0,F0,Yd,B0,Eh,Gu,Ml,N0,wc,Dv){var Kh,jf,Sh,Ch,Vf,Ah=So.addToLineVertexArray(Tl,L0),qd=0,Bp=0,Fv=0,z0=0,Kd=-1,md=-1,df={},$d=Re(""),gd=0,yd=0;if(Yl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(gd=(Kh=Yl.layout.get("text-offset").evaluate(Gu,{},wc).map(function(Qh){return 24*Qh}))[0],yd=Kh[1]):(gd=24*Yl.layout.get("text-radial-offset").evaluate(Gu,{},wc),yd=Di),So.allowVerticalPlacement&&Xl.vertical){var Qd=Yl.layout.get("text-rotate").evaluate(Gu,{},wc)+90;Ch=new No(Dp,Tl,Yh,Fp,Uf,Xl.vertical,vd,Xd,qh,Qd),kp&&(Vf=new No(Dp,Tl,Yh,Fp,Uf,kp,F0,Yd,qh,Qd))}if(Wd){var _d=Yl.layout.get("icon-rotate").evaluate(Gu,{}),Jd=Yl.layout.get("icon-text-fit")!=="none",e0=Bo(Wd,_d,N0,Jd),xd=kp?Bo(kp,_d,N0,Jd):void 0;Sh=new No(Dp,Tl,Yh,Fp,Uf,Wd,F0,Yd,!1,_d),qd=4*e0.length;var t0=So.iconSizeData,$h=null;t0.kind==="source"?($h=[128*Yl.layout.get("icon-size").evaluate(Gu,{})])[0]>32640&&ut(So.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):t0.kind==="composite"&&(($h=[128*Ml.compositeIconSizes[0].evaluate(Gu,{},wc),128*Ml.compositeIconSizes[1].evaluate(Gu,{},wc)])[0]>32640||$h[1]>32640)&&ut(So.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),So.addSymbols(So.icon,e0,$h,Eh,B0,Gu,!1,Tl,Ah.lineStartIndex,Ah.lineLength,-1,wc),Kd=So.icon.placedSymbolArray.length-1,xd&&(Bp=4*xd.length,So.addSymbols(So.icon,xd,$h,Eh,B0,Gu,tn.vertical,Tl,Ah.lineStartIndex,Ah.lineLength,-1,wc),md=So.icon.placedSymbolArray.length-1)}for(var r0 in Xl.horizontal){var Np=Xl.horizontal[r0];if(!jf){$d=Re(Np.text);var Z0=Yl.layout.get("text-rotate").evaluate(Gu,{},wc);jf=new No(Dp,Tl,Yh,Fp,Uf,Np,vd,Xd,qh,Z0)}var n0=Np.positionedLines.length===1;if(Fv+=fr(So,Tl,Np,k0,Yl,qh,Gu,D0,Ah,Xl.vertical?tn.horizontal:tn.horizontalOnly,n0?Object.keys(Xl.horizontal):[r0],df,Kd,Ml,wc),n0)break}Xl.vertical&&(z0+=fr(So,Tl,Xl.vertical,k0,Yl,qh,Gu,D0,Ah,tn.vertical,["vertical"],df,md,Ml,wc));var U0=jf?jf.boxStartIndex:So.collisionBoxArray.length,j0=jf?jf.boxEndIndex:So.collisionBoxArray.length,V0=Ch?Ch.boxStartIndex:So.collisionBoxArray.length,su=Ch?Ch.boxEndIndex:So.collisionBoxArray.length,G0=Sh?Sh.boxStartIndex:So.collisionBoxArray.length,H0=Sh?Sh.boxEndIndex:So.collisionBoxArray.length,W0=Vf?Vf.boxStartIndex:So.collisionBoxArray.length,X0=Vf?Vf.boxEndIndex:So.collisionBoxArray.length,ql=-1,zp=function(Qh,a0){return Qh&&Qh.circleDiameter?Math.max(Qh.circleDiameter,a0):a0};ql=zp(jf,ql),ql=zp(Ch,ql),ql=zp(Sh,ql);var i0=(ql=zp(Vf,ql))>-1?1:0;i0&&(ql*=Dv/24),So.glyphOffsetArray.length>=Xe.MAX_GLYPHS&&ut("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Gu.sortKey!==void 0&&So.addToSortKeyRanges(So.symbolInstances.length,Gu.sortKey),So.symbolInstances.emplaceBack(Tl.x,Tl.y,df.right>=0?df.right:-1,df.center>=0?df.center:-1,df.left>=0?df.left:-1,df.vertical||-1,Kd,md,$d,U0,j0,V0,su,G0,H0,W0,X0,Yh,Fv,z0,qd,Bp,i0,0,vd,gd,yd,ql)}(Qi,Xh,R0,ka,ha,_u,hf,Qi.layers[0],Qi.collisionBoxArray,Za.index,Za.sourceLayerIndex,Qi.index,Nf,wp,Tp,Ys,Ou,gh,ud,Al,Za,Xs,_a,ff,oo)};if(pf==="line")for(var _h=0,Pp=bo(Za.geometry,0,0,8192,8192);_h<Pp.length;_h+=1)for(var Op=Pp[_h],xh=0,Vh=ns(Op,mh,yh,ka.vertical||wl,ha,24,al,Qi.overscaling,8192);xh<Vh.length;xh+=1){var ld=Vh[xh];wl&&Pn(Qi,wl.text,Mp,ld)||Uo(Op,ld)}else if(pf==="line-center")for(var Ip=0,Rp=Za.geometry;Ip<Rp.length;Ip+=1){var Lp=Rp[Ip];if(Lp.length>1){var cd=Ha(Lp,yh,ka.vertical||wl,ha,24,al);cd&&Uo(Lp,cd)}}else if(Za.type==="Polygon")for(var Gh=0,fd=xc(Za.geometry,0);Gh<fd.length;Gh+=1){var W=fd[Gh],Hh=gi(W,16);Uo(W[0],new hn(Hh.x,Hh.y,0))}else if(Za.type==="LineString")for(var zf=0,Wh=Za.geometry;zf<Wh.length;zf+=1){var bh=Wh[zf];Uo(bh,new hn(bh[0].x,bh[0].y,0))}else if(Za.type==="Point")for(var hd=0,Hd=Za.geometry;hd<Hd.length;hd+=1)for(var pd=0,Zf=Hd[hd];pd<Zf.length;pd+=1){var dd=Zf[pd];Uo([dd],new hn(dd.x,dd.y,0))}}(n,Pt,In,Cs,p,j,pn,ti,Rn,ou,A)},$t=0,Mt=n.features;$t<Mt.length;$t+=1)Lt();E&&n.generateCollisionDebugBuffers()},g.perspective=function(n,o,u,p,_){var E,A=1/Math.tan(o/2);return n[0]=A/u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=A,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,_!=null&&_!==1/0?(n[10]=(_+p)*(E=1/(p-_)),n[14]=2*_*p*E):(n[10]=-1,n[14]=-2*p),n},g.pick=function(n,o){for(var u={},p=0;p<o.length;p++){var _=o[p];_ in n&&(u[_]=n[_])}return u},g.plugin=js,g.polygonIntersectsPolygon=zu,g.postMapLoadEvent=Oe,g.postTurnstileEvent=et,g.potpack=jr,g.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],g.register=Mn,g.registerForPluginStateChange=function(n){return n({pluginStatus:Ps,pluginURL:Ta}),nh.on("pluginStateChange",n),n},g.renderColorRamp=Of,g.rotate=function(n,o,u){var p=o[0],_=o[1],E=o[2],A=o[3],O=Math.sin(u),B=Math.cos(u);return n[0]=p*B+E*O,n[1]=_*B+A*O,n[2]=p*-O+E*B,n[3]=_*-O+A*B,n},g.rotateX=function(n,o,u){var p=Math.sin(u),_=Math.cos(u),E=o[4],A=o[5],O=o[6],B=o[7],j=o[8],H=o[9],te=o[10],ce=o[11];return o!==n&&(n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=o[3],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15]),n[4]=E*_+j*p,n[5]=A*_+H*p,n[6]=O*_+te*p,n[7]=B*_+ce*p,n[8]=j*_-E*p,n[9]=H*_-A*p,n[10]=te*_-O*p,n[11]=ce*_-B*p,n},g.rotateZ=function(n,o,u){var p=Math.sin(u),_=Math.cos(u),E=o[0],A=o[1],O=o[2],B=o[3],j=o[4],H=o[5],te=o[6],ce=o[7];return o!==n&&(n[8]=o[8],n[9]=o[9],n[10]=o[10],n[11]=o[11],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15]),n[0]=E*_+j*p,n[1]=A*_+H*p,n[2]=O*_+te*p,n[3]=B*_+ce*p,n[4]=j*_-E*p,n[5]=H*_-A*p,n[6]=te*_-O*p,n[7]=ce*_-B*p,n},g.scale=function(n,o,u){var p=u[0],_=u[1],E=u[2];return n[0]=o[0]*p,n[1]=o[1]*p,n[2]=o[2]*p,n[3]=o[3]*p,n[4]=o[4]*_,n[5]=o[5]*_,n[6]=o[6]*_,n[7]=o[7]*_,n[8]=o[8]*E,n[9]=o[9]*E,n[10]=o[10]*E,n[11]=o[11]*E,n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15],n},g.scale$1=function(n,o,u){return n[0]=o[0]*u,n[1]=o[1]*u,n[2]=o[2]*u,n[3]=o[3]*u,n},g.scale$2=function(n,o,u){return n[0]=o[0]*u,n[1]=o[1]*u,n[2]=o[2]*u,n},g.setCacheLimits=function(n,o){$e=n,Ht=o},g.setRTLTextPlugin=function(n,o,u){if(u===void 0&&(u=!1),Ps==="deferred"||Ps==="loading"||Ps==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Ta=An.resolveURL(n),Ps="deferred",cu=o,Uc(),u||Os()},g.sphericalToCartesian=function(n){var o=n[0],u=n[1],p=n[2];return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(p),y:o*Math.sin(u)*Math.sin(p),z:o*Math.cos(p)}},g.sqrLen=function(n){var o=n[0],u=n[1];return o*o+u*u},g.styleSpec=be,g.sub=function(n,o,u){return n[0]=o[0]-u[0],n[1]=o[1]-u[1],n[2]=o[2]-u[2],n},g.symbolSize=$i,g.transformMat3=function(n,o,u){var p=o[0],_=o[1],E=o[2];return n[0]=p*u[0]+_*u[3]+E*u[6],n[1]=p*u[1]+_*u[4]+E*u[7],n[2]=p*u[2]+_*u[5]+E*u[8],n},g.transformMat4=Hc,g.translate=function(n,o,u){var p,_,E,A,O,B,j,H,te,ce,_e,Ue,He=u[0],ft=u[1],rt=u[2];return o===n?(n[12]=o[0]*He+o[4]*ft+o[8]*rt+o[12],n[13]=o[1]*He+o[5]*ft+o[9]*rt+o[13],n[14]=o[2]*He+o[6]*ft+o[10]*rt+o[14],n[15]=o[3]*He+o[7]*ft+o[11]*rt+o[15]):(_=o[1],E=o[2],A=o[3],O=o[4],B=o[5],j=o[6],H=o[7],te=o[8],ce=o[9],_e=o[10],Ue=o[11],n[0]=p=o[0],n[1]=_,n[2]=E,n[3]=A,n[4]=O,n[5]=B,n[6]=j,n[7]=H,n[8]=te,n[9]=ce,n[10]=_e,n[11]=Ue,n[12]=p*He+O*ft+te*rt+o[12],n[13]=_*He+B*ft+ce*rt+o[13],n[14]=E*He+j*ft+_e*rt+o[14],n[15]=A*He+H*ft+Ue*rt+o[15]),n},g.triggerPluginCompletionEvent=rh,g.uniqueId=Tt,g.validateCustomStyleLayer=function(n){var o=[],u=n.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),n.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},g.validateLight=kh,g.validateStyle=zc,g.values=function(n){var o=[];for(var u in n)o.push(n[u]);return o},g.vectorTile=Tu,g.version="1.13.2",g.warnOnce=ut,g.webpSupported=wn,g.window=re,g.wrap=Jt}),Y(["./shared"],function(g){"use strict";function fe($){var ue=typeof $;if(ue==="number"||ue==="boolean"||ue==="string"||$==null)return JSON.stringify($);if(Array.isArray($)){for(var ve="[",Te=0,Ze=$;Te<Ze.length;Te+=1)ve+=fe(Ze[Te])+",";return ve+"]"}for(var it=Object.keys($).sort(),gt="{",be=0;be<it.length;be++)gt+=JSON.stringify(it[be])+":"+fe($[it[be]])+",";return gt+"}"}function N($){for(var ue="",ve=0,Te=g.refProperties;ve<Te.length;ve+=1)ue+="/"+fe($[Te[ve]]);return ue}var oe=function($){this.keyCache={},$&&this.replace($)};oe.prototype.replace=function($){this._layerConfigs={},this._layers={},this.update($,[])},oe.prototype.update=function($,ue){for(var ve=this,Te=0,Ze=$;Te<Ze.length;Te+=1){var it=Ze[Te];this._layerConfigs[it.id]=it;var gt=this._layers[it.id]=g.createStyleLayer(it);gt._featureFilter=g.featureFilter(gt.filter),this.keyCache[it.id]&&delete this.keyCache[it.id]}for(var be=0,Ye=ue;be<Ye.length;be+=1){var jt=Ye[be];delete this.keyCache[jt],delete this._layerConfigs[jt],delete this._layers[jt]}this.familiesBySource={};for(var Ir=0,sr=function(rn,cn){for(var wi={},gn=0;gn<rn.length;gn++){var zi=cn&&cn[rn[gn].id]||N(rn[gn]);cn&&(cn[rn[gn].id]=zi);var ca=wi[zi];ca||(ca=wi[zi]=[]),ca.push(rn[gn])}var sn=[];for(var ki in wi)sn.push(wi[ki]);return sn}(g.values(this._layerConfigs),this.keyCache);Ir<sr.length;Ir+=1){var cr=sr[Ir].map(function(rn){return ve._layers[rn.id]}),Rr=cr[0];if(Rr.visibility!=="none"){var zn=Rr.source||"",Tn=this.familiesBySource[zn];Tn||(Tn=this.familiesBySource[zn]={});var tr=Rr.sourceLayer||"_geojsonTileLayer",_n=Tn[tr];_n||(_n=Tn[tr]=[]),_n.push(cr)}}};var ne=function($){var ue={},ve=[];for(var Te in $){var Ze=$[Te],it=ue[Te]={};for(var gt in Ze){var be=Ze[+gt];if(be&&be.bitmap.width!==0&&be.bitmap.height!==0){var Ye={x:0,y:0,w:be.bitmap.width+2,h:be.bitmap.height+2};ve.push(Ye),it[gt]={rect:Ye,metrics:be.metrics}}}}var jt=g.potpack(ve),Ir=new g.AlphaImage({width:jt.w||1,height:jt.h||1});for(var sr in $){var cr=$[sr];for(var Rr in cr){var zn=cr[+Rr];if(zn&&zn.bitmap.width!==0&&zn.bitmap.height!==0){var Tn=ue[sr][Rr].rect;g.AlphaImage.copy(zn.bitmap,Ir,{x:0,y:0},{x:Tn.x+1,y:Tn.y+1},zn.bitmap)}}}this.image=Ir,this.positions=ue};g.register("GlyphAtlas",ne);var we=function($){this.tileID=new g.OverscaledTileID($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.uid=$.uid,this.zoom=$.zoom,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.returnDependencies=!!$.returnDependencies,this.promoteId=$.promoteId};function re($,ue,ve){for(var Te=new g.EvaluationParameters(ue),Ze=0,it=$;Ze<it.length;Ze+=1)it[Ze].recalculate(Te,ve)}function ke($,ue){var ve=g.getArrayBuffer($.request,function(Te,Ze,it,gt){Te?ue(Te):Ze&&ue(null,{vectorTile:new g.vectorTile.VectorTile(new g.pbf(Ze)),rawData:Ze,cacheControl:it,expires:gt})});return function(){ve.cancel(),ue()}}we.prototype.parse=function($,ue,ve,Te,Ze){var it=this;this.status="parsing",this.data=$,this.collisionBoxArray=new g.CollisionBoxArray;var gt=new g.DictionaryCoder(Object.keys($.layers).sort()),be=new g.FeatureIndex(this.tileID,this.promoteId);be.bucketLayerIDs=[];var Ye,jt,Ir,sr,cr={},Rr={featureIndex:be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ve},zn=ue.familiesBySource[this.source];for(var Tn in zn){var tr=$.layers[Tn];if(tr){tr.version===1&&g.warnOnce('Vector tile source "'+this.source+'" layer "'+Tn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var _n=gt.encode(Tn),rn=[],cn=0;cn<tr.length;cn++){var wi=tr.feature(cn),gn=be.getId(wi,Tn);rn.push({feature:wi,id:gn,index:cn,sourceLayerIndex:_n})}for(var zi=0,ca=zn[Tn];zi<ca.length;zi+=1){var sn=ca[zi],ki=sn[0];ki.minzoom&&this.zoom<Math.floor(ki.minzoom)||ki.maxzoom&&this.zoom>=ki.maxzoom||ki.visibility!=="none"&&(re(sn,this.zoom,ve),(cr[ki.id]=ki.createBucket({index:be.bucketLayerIDs.length,layers:sn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_n,sourceID:this.source})).populate(rn,Rr,this.tileID.canonical),be.bucketLayerIDs.push(sn.map(function(Gt){return Gt.id})))}}}var Pi=g.mapObject(Rr.glyphDependencies,function(Gt){return Object.keys(Gt).map(Number)});Object.keys(Pi).length?Te.send("getGlyphs",{uid:this.uid,stacks:Pi},function(Gt,ji){Ye||(Ye=Gt,jt=ji,qt.call(it))}):jt={};var vi=Object.keys(Rr.iconDependencies);vi.length?Te.send("getImages",{icons:vi,source:this.source,tileID:this.tileID,type:"icons"},function(Gt,ji){Ye||(Ye=Gt,Ir=ji,qt.call(it))}):Ir={};var Ji=Object.keys(Rr.patternDependencies);function qt(){if(Ye)return Ze(Ye);if(jt&&Ir&&sr){var Gt=new ne(jt),ji=new g.ImageAtlas(Ir,sr);for(var Hi in cr){var Pa=cr[Hi];Pa instanceof g.SymbolBucket?(re(Pa.layers,this.zoom,ve),g.performSymbolLayout(Pa,jt,Gt.positions,Ir,ji.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Pa.hasPattern&&(Pa instanceof g.LineBucket||Pa instanceof g.FillBucket||Pa instanceof g.FillExtrusionBucket)&&(re(Pa.layers,this.zoom,ve),Pa.addFeatures(Rr,this.tileID.canonical,ji.patternPositions))}this.status="done",Ze(null,{buckets:g.values(cr).filter(function(so){return!so.isEmpty()}),featureIndex:be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Gt.image,imageAtlas:ji,glyphMap:this.returnDependencies?jt:null,iconMap:this.returnDependencies?Ir:null,glyphPositions:this.returnDependencies?Gt.positions:null})}}Ji.length?Te.send("getImages",{icons:Ji,source:this.source,tileID:this.tileID,type:"patterns"},function(Gt,ji){Ye||(Ye=Gt,sr=ji,qt.call(it))}):sr={},qt.call(this)};var Ve=function($,ue,ve,Te){this.actor=$,this.layerIndex=ue,this.availableImages=ve,this.loadVectorData=Te||ke,this.loading={},this.loaded={}};Ve.prototype.loadTile=function($,ue){var ve=this,Te=$.uid;this.loading||(this.loading={});var Ze=!!($&&$.request&&$.request.collectResourceTiming)&&new g.RequestPerformance($.request),it=this.loading[Te]=new we($);it.abort=this.loadVectorData($,function(gt,be){if(delete ve.loading[Te],gt||!be)return it.status="done",ve.loaded[Te]=it,ue(gt);var Ye=be.rawData,jt={};be.expires&&(jt.expires=be.expires),be.cacheControl&&(jt.cacheControl=be.cacheControl);var Ir={};if(Ze){var sr=Ze.finish();sr&&(Ir.resourceTiming=JSON.parse(JSON.stringify(sr)))}it.vectorTile=be.vectorTile,it.parse(be.vectorTile,ve.layerIndex,ve.availableImages,ve.actor,function(cr,Rr){if(cr||!Rr)return ue(cr);ue(null,g.extend({rawTileData:Ye.slice(0)},Rr,jt,Ir))}),ve.loaded=ve.loaded||{},ve.loaded[Te]=it})},Ve.prototype.reloadTile=function($,ue){var ve=this,Te=this.loaded,Ze=$.uid,it=this;if(Te&&Te[Ze]){var gt=Te[Ze];gt.showCollisionBoxes=$.showCollisionBoxes;var be=function(Ye,jt){var Ir=gt.reloadCallback;Ir&&(delete gt.reloadCallback,gt.parse(gt.vectorTile,it.layerIndex,ve.availableImages,it.actor,Ir)),ue(Ye,jt)};gt.status==="parsing"?gt.reloadCallback=be:gt.status==="done"&&(gt.vectorTile?gt.parse(gt.vectorTile,this.layerIndex,this.availableImages,this.actor,be):be())}},Ve.prototype.abortTile=function($,ue){var ve=this.loading,Te=$.uid;ve&&ve[Te]&&ve[Te].abort&&(ve[Te].abort(),delete ve[Te]),ue()},Ve.prototype.removeTile=function($,ue){var ve=this.loaded,Te=$.uid;ve&&ve[Te]&&delete ve[Te],ue()};var Ne=g.window.ImageBitmap,Je=function(){this.loaded={}};function Jt($,ue){if($.length!==0){_t($[0],ue);for(var ve=1;ve<$.length;ve++)_t($[ve],!ue)}}function _t($,ue){for(var ve=0,Te=0,Ze=$.length,it=Ze-1;Te<Ze;it=Te++)ve+=($[Te][0]-$[it][0])*($[it][1]+$[Te][1]);ve>=0!=!!ue&&$.reverse()}Je.prototype.loadTile=function($,ue){var ve=$.uid,Te=$.encoding,Ze=$.rawImageData,it=Ne&&Ze instanceof Ne?this.getImageData(Ze):Ze,gt=new g.DEMData(ve,it,Te);this.loaded=this.loaded||{},this.loaded[ve]=gt,ue(null,gt)},Je.prototype.getImageData=function($){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas($.width,$.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=$.width,this.offscreenCanvas.height=$.height,this.offscreenCanvasContext.drawImage($,0,0,$.width,$.height);var ue=this.offscreenCanvasContext.getImageData(-1,-1,$.width+2,$.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new g.RGBAImage({width:ue.width,height:ue.height},ue.data)},Je.prototype.removeTile=function($){var ue=this.loaded,ve=$.uid;ue&&ue[ve]&&delete ue[ve]};var Ut=g.vectorTile.VectorTileFeature.prototype.toGeoJSON,Tt=function($){this._feature=$,this.extent=g.EXTENT,this.type=$.type,this.properties=$.tags,"id"in $&&!isNaN($.id)&&(this.id=parseInt($.id,10))};Tt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var $=[],ue=0,ve=this._feature.geometry;ue<ve.length;ue+=1){var Te=ve[ue];$.push([new g.Point$1(Te[0],Te[1])])}return $}for(var Ze=[],it=0,gt=this._feature.geometry;it<gt.length;it+=1){for(var be=[],Ye=0,jt=gt[it];Ye<jt.length;Ye+=1){var Ir=jt[Ye];be.push(new g.Point$1(Ir[0],Ir[1]))}Ze.push(be)}return Ze},Tt.prototype.toGeoJSON=function($,ue,ve){return Ut.call(this,$,ue,ve)};var vt=function($){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.EXTENT,this.length=$.length,this._features=$};vt.prototype.feature=function($){return new Tt(this._features[$])};var pt=g.vectorTile.VectorTileFeature,Vt=ee;function ee($,ue){this.options=ue||{},this.features=$,this.length=$.length}function rr($,ue){this.id=typeof $.id=="number"?$.id:void 0,this.type=$.type,this.rawGeometry=$.type===1?[$.geometry]:$.geometry,this.properties=$.tags,this.extent=ue||4096}ee.prototype.feature=function($){return new rr(this.features[$],this.options.extent)},rr.prototype.loadGeometry=function(){var $=this.rawGeometry;this.geometry=[];for(var ue=0;ue<$.length;ue++){for(var ve=$[ue],Te=[],Ze=0;Ze<ve.length;Ze++)Te.push(new g.Point$1(ve[Ze][0],ve[Ze][1]));this.geometry.push(Te)}return this.geometry},rr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $=this.geometry,ue=1/0,ve=-1/0,Te=1/0,Ze=-1/0,it=0;it<$.length;it++)for(var gt=$[it],be=0;be<gt.length;be++){var Ye=gt[be];ue=Math.min(ue,Ye.x),ve=Math.max(ve,Ye.x),Te=Math.min(Te,Ye.y),Ze=Math.max(Ze,Ye.y)}return[ue,Te,ve,Ze]},rr.prototype.toGeoJSON=pt.prototype.toGeoJSON;var At=Zt,nt=Vt;function Zt($){var ue=new g.pbf;return function(ve,Te){for(var Ze in ve.layers)Te.writeMessage(3,ut,ve.layers[Ze])}($,ue),ue.finish()}function ut($,ue){var ve;ue.writeVarintField(15,$.version||1),ue.writeStringField(1,$.name||""),ue.writeVarintField(5,$.extent||4096);var Te={keys:[],values:[],keycache:{},valuecache:{}};for(ve=0;ve<$.length;ve++)Te.feature=$.feature(ve),ue.writeMessage(2,nr,Te);var Ze=Te.keys;for(ve=0;ve<Ze.length;ve++)ue.writeStringField(3,Ze[ve]);var it=Te.values;for(ve=0;ve<it.length;ve++)ue.writeMessage(4,le,it[ve])}function nr($,ue){var ve=$.feature;ve.id!==void 0&&ue.writeVarintField(1,ve.id),ue.writeMessage(2,Mr,$),ue.writeVarintField(3,ve.type),ue.writeMessage(4,b,ve)}function Mr($,ue){var ve=$.feature,Te=$.keys,Ze=$.values,it=$.keycache,gt=$.valuecache;for(var be in ve.properties){var Ye=it[be];Ye===void 0&&(Te.push(be),it[be]=Ye=Te.length-1),ue.writeVarint(Ye);var jt=ve.properties[be],Ir=typeof jt;Ir!=="string"&&Ir!=="boolean"&&Ir!=="number"&&(jt=JSON.stringify(jt));var sr=Ir+":"+jt,cr=gt[sr];cr===void 0&&(Ze.push(jt),gt[sr]=cr=Ze.length-1),ue.writeVarint(cr)}}function q($,ue){return(ue<<3)+(7&$)}function pe($){return $<<1^$>>31}function b($,ue){for(var ve=$.loadGeometry(),Te=$.type,Ze=0,it=0,gt=ve.length,be=0;be<gt;be++){var Ye=ve[be],jt=1;Te===1&&(jt=Ye.length),ue.writeVarint(q(1,jt));for(var Ir=Te===3?Ye.length-1:Ye.length,sr=0;sr<Ir;sr++){sr===1&&Te!==1&&ue.writeVarint(q(2,Ir-1));var cr=Ye[sr].x-Ze,Rr=Ye[sr].y-it;ue.writeVarint(pe(cr)),ue.writeVarint(pe(Rr)),Ze+=cr,it+=Rr}Te===3&&ue.writeVarint(q(7,1))}}function le($,ue){var ve=typeof $;ve==="string"?ue.writeStringField(1,$):ve==="boolean"?ue.writeBooleanField(7,$):ve==="number"&&($%1!=0?ue.writeDoubleField(3,$):$<0?ue.writeSVarintField(6,$):ue.writeVarintField(5,$))}function xe($,ue,ve,Te){Qe($,ve,Te),Qe(ue,2*ve,2*Te),Qe(ue,2*ve+1,2*Te+1)}function Qe($,ue,ve){var Te=$[ue];$[ue]=$[ve],$[ve]=Te}function xt($,ue,ve,Te){var Ze=$-ve,it=ue-Te;return Ze*Ze+it*it}At.fromVectorTileJs=Zt,At.fromGeojsonVt=function($,ue){ue=ue||{};var ve={};for(var Te in $)ve[Te]=new Vt($[Te].features,ue),ve[Te].name=Te,ve[Te].version=ue.version,ve[Te].extent=ue.extent;return Zt({layers:ve})},At.GeoJSONWrapper=nt;var Bt=function($){return $[0]},Fe=function($){return $[1]},bt=function($,ue,ve,Te,Ze){ue===void 0&&(ue=Bt),ve===void 0&&(ve=Fe),Te===void 0&&(Te=64),Ze===void 0&&(Ze=Float64Array),this.nodeSize=Te,this.points=$;for(var it=$.length<65536?Uint16Array:Uint32Array,gt=this.ids=new it($.length),be=this.coords=new Ze(2*$.length),Ye=0;Ye<$.length;Ye++)gt[Ye]=Ye,be[2*Ye]=ue($[Ye]),be[2*Ye+1]=ve($[Ye]);(function jt(Ir,sr,cr,Rr,zn,Tn){if(!(zn-Rr<=cr)){var tr=Rr+zn>>1;(function _n(rn,cn,wi,gn,zi,ca){for(;zi>gn;){if(zi-gn>600){var sn=zi-gn+1,ki=wi-gn+1,Pi=Math.log(sn),vi=.5*Math.exp(2*Pi/3),Ji=.5*Math.sqrt(Pi*vi*(sn-vi)/sn)*(ki-sn/2<0?-1:1);_n(rn,cn,wi,Math.max(gn,Math.floor(wi-ki*vi/sn+Ji)),Math.min(zi,Math.floor(wi+(sn-ki)*vi/sn+Ji)),ca)}var qt=cn[2*wi+ca],Gt=gn,ji=zi;for(xe(rn,cn,gn,wi),cn[2*zi+ca]>qt&&xe(rn,cn,gn,zi);Gt<ji;){for(xe(rn,cn,Gt,ji),Gt++,ji--;cn[2*Gt+ca]<qt;)Gt++;for(;cn[2*ji+ca]>qt;)ji--}cn[2*gn+ca]===qt?xe(rn,cn,gn,ji):xe(rn,cn,++ji,zi),ji<=wi&&(gn=ji+1),wi<=ji&&(zi=ji-1)}})(Ir,sr,tr,Rr,zn,Tn%2),jt(Ir,sr,cr,Rr,tr-1,Tn+1),jt(Ir,sr,cr,tr+1,zn,Tn+1)}})(gt,be,Te,0,gt.length-1,0)};bt.prototype.range=function($,ue,ve,Te){return function(Ze,it,gt,be,Ye,jt,Ir){for(var sr,cr,Rr=[0,Ze.length-1,0],zn=[];Rr.length;){var Tn=Rr.pop(),tr=Rr.pop(),_n=Rr.pop();if(tr-_n<=Ir)for(var rn=_n;rn<=tr;rn++)cr=it[2*rn+1],(sr=it[2*rn])>=gt&&sr<=Ye&&cr>=be&&cr<=jt&&zn.push(Ze[rn]);else{var cn=Math.floor((_n+tr)/2);cr=it[2*cn+1],(sr=it[2*cn])>=gt&&sr<=Ye&&cr>=be&&cr<=jt&&zn.push(Ze[cn]);var wi=(Tn+1)%2;(Tn===0?gt<=sr:be<=cr)&&(Rr.push(_n),Rr.push(cn-1),Rr.push(wi)),(Tn===0?Ye>=sr:jt>=cr)&&(Rr.push(cn+1),Rr.push(tr),Rr.push(wi))}}return zn}(this.ids,this.coords,$,ue,ve,Te,this.nodeSize)},bt.prototype.within=function($,ue,ve){return function(Te,Ze,it,gt,be,Ye){for(var jt=[0,Te.length-1,0],Ir=[],sr=be*be;jt.length;){var cr=jt.pop(),Rr=jt.pop(),zn=jt.pop();if(Rr-zn<=Ye)for(var Tn=zn;Tn<=Rr;Tn++)xt(Ze[2*Tn],Ze[2*Tn+1],it,gt)<=sr&&Ir.push(Te[Tn]);else{var tr=Math.floor((zn+Rr)/2),_n=Ze[2*tr],rn=Ze[2*tr+1];xt(_n,rn,it,gt)<=sr&&Ir.push(Te[tr]);var cn=(cr+1)%2;(cr===0?it-be<=_n:gt-be<=rn)&&(jt.push(zn),jt.push(tr-1),jt.push(cn)),(cr===0?it+be>=_n:gt+be>=rn)&&(jt.push(tr+1),jt.push(Rr),jt.push(cn))}}return Ir}(this.ids,this.coords,$,ue,ve,this.nodeSize)};var br={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function($){return $}},mr=function($){this.options=Vi(Object.create(br),$),this.trees=new Array(this.options.maxZoom+1)};function An($,ue,ve,Te,Ze){return{x:$,y:ue,zoom:1/0,id:ve,parentId:-1,numPoints:Te,properties:Ze}}function mn($,ue){var ve=$.geometry.coordinates,Te=ve[1];return{x:Qn(ve[0]),y:ii(Te),zoom:1/0,index:ue,parentId:-1}}function wn($){return{type:"Feature",id:$.id,properties:Ri($),geometry:{type:"Point",coordinates:[(Te=$.x,360*(Te-.5)),(ue=$.y,ve=(180-360*ue)*Math.PI/180,360*Math.atan(Math.exp(ve))/Math.PI-90)]}};var ue,ve,Te}function Ri($){var ue=$.numPoints,ve=ue>=1e4?Math.round(ue/1e3)+"k":ue>=1e3?Math.round(ue/100)/10+"k":ue;return Vi(Vi({},$.properties),{cluster:!0,cluster_id:$.id,point_count:ue,point_count_abbreviated:ve})}function Qn($){return $/360+.5}function ii($){var ue=Math.sin($*Math.PI/180),ve=.5-.25*Math.log((1+ue)/(1-ue))/Math.PI;return ve<0?0:ve>1?1:ve}function Vi($,ue){for(var ve in ue)$[ve]=ue[ve];return $}function Ni($){return $.x}function ai($){return $.y}function Vn($,ue,ve,Te,Ze,it){var gt=Ze-ve,be=it-Te;if(gt!==0||be!==0){var Ye=(($-ve)*gt+(ue-Te)*be)/(gt*gt+be*be);Ye>1?(ve=Ze,Te=it):Ye>0&&(ve+=gt*Ye,Te+=be*Ye)}return(gt=$-ve)*gt+(be=ue-Te)*be}function Yn($,ue,ve,Te){var Ze={id:$===void 0?null:$,type:ue,geometry:ve,tags:Te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(it){var gt=it.geometry,be=it.type;if(be==="Point"||be==="MultiPoint"||be==="LineString")Li(it,gt);else if(be==="Polygon"||be==="MultiLineString")for(var Ye=0;Ye<gt.length;Ye++)Li(it,gt[Ye]);else if(be==="MultiPolygon")for(Ye=0;Ye<gt.length;Ye++)for(var jt=0;jt<gt[Ye].length;jt++)Li(it,gt[Ye][jt])}(Ze),Ze}function Li($,ue){for(var ve=0;ve<ue.length;ve+=3)$.minX=Math.min($.minX,ue[ve]),$.minY=Math.min($.minY,ue[ve+1]),$.maxX=Math.max($.maxX,ue[ve]),$.maxY=Math.max($.maxY,ue[ve+1])}function ra($,ue,ve,Te){if(ue.geometry){var Ze=ue.geometry.coordinates,it=ue.geometry.type,gt=Math.pow(ve.tolerance/((1<<ve.maxZoom)*ve.extent),2),be=[],Ye=ue.id;if(ve.promoteId?Ye=ue.properties[ve.promoteId]:ve.generateId&&(Ye=Te||0),it==="Point")ri(Ze,be);else if(it==="MultiPoint")for(var jt=0;jt<Ze.length;jt++)ri(Ze[jt],be);else if(it==="LineString")Et(Ze,be,gt,!1);else if(it==="MultiLineString"){if(ve.lineMetrics){for(jt=0;jt<Ze.length;jt++)Et(Ze[jt],be=[],gt,!1),$.push(Yn(Ye,"LineString",be,ue.properties));return}de(Ze,be,gt,!1)}else if(it==="Polygon")de(Ze,be,gt,!0);else{if(it!=="MultiPolygon"){if(it==="GeometryCollection"){for(jt=0;jt<ue.geometry.geometries.length;jt++)ra($,{id:Ye,geometry:ue.geometry.geometries[jt],properties:ue.properties},ve,Te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(jt=0;jt<Ze.length;jt++){var Ir=[];de(Ze[jt],Ir,gt,!0),be.push(Ir)}}$.push(Yn(Ye,it,be,ue.properties))}}function ri($,ue){ue.push(V($[0])),ue.push(X($[1])),ue.push(0)}function Et($,ue,ve,Te){for(var Ze,it,gt=0,be=0;be<$.length;be++){var Ye=V($[be][0]),jt=X($[be][1]);ue.push(Ye),ue.push(jt),ue.push(0),be>0&&(gt+=Te?(Ze*jt-Ye*it)/2:Math.sqrt(Math.pow(Ye-Ze,2)+Math.pow(jt-it,2))),Ze=Ye,it=jt}var Ir=ue.length-3;ue[2]=1,function sr(cr,Rr,zn,Tn){for(var tr,_n=Tn,rn=zn-Rr>>1,cn=zn-Rr,wi=cr[Rr],gn=cr[Rr+1],zi=cr[zn],ca=cr[zn+1],sn=Rr+3;sn<zn;sn+=3){var ki=Vn(cr[sn],cr[sn+1],wi,gn,zi,ca);if(ki>_n)tr=sn,_n=ki;else if(ki===_n){var Pi=Math.abs(sn-rn);Pi<cn&&(tr=sn,cn=Pi)}}_n>Tn&&(tr-Rr>3&&sr(cr,Rr,tr,Tn),cr[tr+2]=_n,zn-tr>3&&sr(cr,tr,zn,Tn))}(ue,0,Ir,ve),ue[Ir+2]=1,ue.size=Math.abs(gt),ue.start=0,ue.end=ue.size}function de($,ue,ve,Te){for(var Ze=0;Ze<$.length;Ze++){var it=[];Et($[Ze],it,ve,Te),ue.push(it)}}function V($){return $/360+.5}function X($){var ue=Math.sin($*Math.PI/180),ve=.5-.25*Math.log((1+ue)/(1-ue))/Math.PI;return ve<0?0:ve>1?1:ve}function k($,ue,ve,Te,Ze,it,gt,be){if(Te/=ue,it>=(ve/=ue)&&gt<Te)return $;if(gt<ve||it>=Te)return null;for(var Ye=[],jt=0;jt<$.length;jt++){var Ir=$[jt],sr=Ir.geometry,cr=Ir.type,Rr=Ze===0?Ir.minX:Ir.minY,zn=Ze===0?Ir.maxX:Ir.maxY;if(Rr>=ve&&zn<Te)Ye.push(Ir);else if(!(zn<ve||Rr>=Te)){var Tn=[];if(cr==="Point"||cr==="MultiPoint")Ce(sr,Tn,ve,Te,Ze);else if(cr==="LineString")et(sr,Tn,ve,Te,Ze,!1,be.lineMetrics);else if(cr==="MultiLineString")Oe(sr,Tn,ve,Te,Ze,!1);else if(cr==="Polygon")Oe(sr,Tn,ve,Te,Ze,!0);else if(cr==="MultiPolygon")for(var tr=0;tr<sr.length;tr++){var _n=[];Oe(sr[tr],_n,ve,Te,Ze,!0),_n.length&&Tn.push(_n)}if(Tn.length){if(be.lineMetrics&&cr==="LineString"){for(tr=0;tr<Tn.length;tr++)Ye.push(Yn(Ir.id,cr,Tn[tr],Ir.tags));continue}cr!=="LineString"&&cr!=="MultiLineString"||(Tn.length===1?(cr="LineString",Tn=Tn[0]):cr="MultiLineString"),cr!=="Point"&&cr!=="MultiPoint"||(cr=Tn.length===3?"Point":"MultiPoint"),Ye.push(Yn(Ir.id,cr,Tn,Ir.tags))}}}return Ye.length?Ye:null}function Ce($,ue,ve,Te,Ze){for(var it=0;it<$.length;it+=3){var gt=$[it+Ze];gt>=ve&&gt<=Te&&(ue.push($[it]),ue.push($[it+1]),ue.push($[it+2]))}}function et($,ue,ve,Te,Ze,it,gt){for(var be,Ye,jt=Qt($),Ir=Ze===0?Ht:or,sr=$.start,cr=0;cr<$.length-3;cr+=3){var Rr=$[cr],zn=$[cr+1],Tn=$[cr+2],tr=$[cr+3],_n=$[cr+4],rn=Ze===0?Rr:zn,cn=Ze===0?tr:_n,wi=!1;gt&&(be=Math.sqrt(Math.pow(Rr-tr,2)+Math.pow(zn-_n,2))),rn<ve?cn>ve&&(Ye=Ir(jt,Rr,zn,tr,_n,ve),gt&&(jt.start=sr+be*Ye)):rn>Te?cn<Te&&(Ye=Ir(jt,Rr,zn,tr,_n,Te),gt&&(jt.start=sr+be*Ye)):$e(jt,Rr,zn,Tn),cn<ve&&rn>=ve&&(Ye=Ir(jt,Rr,zn,tr,_n,ve),wi=!0),cn>Te&&rn<=Te&&(Ye=Ir(jt,Rr,zn,tr,_n,Te),wi=!0),!it&&wi&&(gt&&(jt.end=sr+be*Ye),ue.push(jt),jt=Qt($)),gt&&(sr+=be)}var gn=$.length-3;Rr=$[gn],zn=$[gn+1],Tn=$[gn+2],(rn=Ze===0?Rr:zn)>=ve&&rn<=Te&&$e(jt,Rr,zn,Tn),gn=jt.length-3,it&&gn>=3&&(jt[gn]!==jt[0]||jt[gn+1]!==jt[1])&&$e(jt,jt[0],jt[1],jt[2]),jt.length&&ue.push(jt)}function Qt($){var ue=[];return ue.size=$.size,ue.start=$.start,ue.end=$.end,ue}function Oe($,ue,ve,Te,Ze,it){for(var gt=0;gt<$.length;gt++)et($[gt],ue,ve,Te,Ze,it,!1)}function $e($,ue,ve,Te){$.push(ue),$.push(ve),$.push(Te)}function Ht($,ue,ve,Te,Ze,it){var gt=(it-ue)/(Te-ue);return $.push(it),$.push(ve+(Ze-ve)*gt),$.push(1),gt}function or($,ue,ve,Te,Ze,it){var gt=(it-ve)/(Ze-ve);return $.push(ue+(Te-ue)*gt),$.push(it),$.push(1),gt}function pr($,ue){for(var ve=[],Te=0;Te<$.length;Te++){var Ze,it=$[Te],gt=it.type;if(gt==="Point"||gt==="MultiPoint"||gt==="LineString")Ze=xr(it.geometry,ue);else if(gt==="MultiLineString"||gt==="Polygon"){Ze=[];for(var be=0;be<it.geometry.length;be++)Ze.push(xr(it.geometry[be],ue))}else if(gt==="MultiPolygon")for(Ze=[],be=0;be<it.geometry.length;be++){for(var Ye=[],jt=0;jt<it.geometry[be].length;jt++)Ye.push(xr(it.geometry[be][jt],ue));Ze.push(Ye)}ve.push(Yn(it.id,gt,Ze,it.tags))}return ve}function xr($,ue){var ve=[];ve.size=$.size,$.start!==void 0&&(ve.start=$.start,ve.end=$.end);for(var Te=0;Te<$.length;Te+=3)ve.push($[Te]+ue,$[Te+1],$[Te+2]);return ve}function Qr($,ue){if($.transformed)return $;var ve,Te,Ze,it=1<<$.z,gt=$.x,be=$.y;for(ve=0;ve<$.features.length;ve++){var Ye=$.features[ve],jt=Ye.geometry,Ir=Ye.type;if(Ye.geometry=[],Ir===1)for(Te=0;Te<jt.length;Te+=2)Ye.geometry.push(en(jt[Te],jt[Te+1],ue,it,gt,be));else for(Te=0;Te<jt.length;Te++){var sr=[];for(Ze=0;Ze<jt[Te].length;Ze+=2)sr.push(en(jt[Te][Ze],jt[Te][Ze+1],ue,it,gt,be));Ye.geometry.push(sr)}}return $.transformed=!0,$}function en($,ue,ve,Te,Ze,it){return[Math.round(ve*($*Te-Ze)),Math.round(ve*(ue*Te-it))]}function Dr($,ue,ve,Te,Ze){for(var it=ue===Ze.maxZoom?0:Ze.tolerance/((1<<ue)*Ze.extent),gt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ve,y:Te,z:ue,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},be=0;be<$.length;be++){gt.numFeatures++,Wn(gt,$[be],it,Ze);var Ye=$[be].minX,jt=$[be].minY,Ir=$[be].maxX,sr=$[be].maxY;Ye<gt.minX&&(gt.minX=Ye),jt<gt.minY&&(gt.minY=jt),Ir>gt.maxX&&(gt.maxX=Ir),sr>gt.maxY&&(gt.maxY=sr)}return gt}function Wn($,ue,ve,Te){var Ze=ue.geometry,it=ue.type,gt=[];if(it==="Point"||it==="MultiPoint")for(var be=0;be<Ze.length;be+=3)gt.push(Ze[be]),gt.push(Ze[be+1]),$.numPoints++,$.numSimplified++;else if(it==="LineString")qn(gt,Ze,$,ve,!1,!1);else if(it==="MultiLineString"||it==="Polygon")for(be=0;be<Ze.length;be++)qn(gt,Ze[be],$,ve,it==="Polygon",be===0);else if(it==="MultiPolygon")for(var Ye=0;Ye<Ze.length;Ye++){var jt=Ze[Ye];for(be=0;be<jt.length;be++)qn(gt,jt[be],$,ve,!0,be===0)}if(gt.length){var Ir=ue.tags||null;if(it==="LineString"&&Te.lineMetrics){for(var sr in Ir={},ue.tags)Ir[sr]=ue.tags[sr];Ir.mapbox_clip_start=Ze.start/Ze.size,Ir.mapbox_clip_end=Ze.end/Ze.size}var cr={geometry:gt,type:it==="Polygon"||it==="MultiPolygon"?3:it==="LineString"||it==="MultiLineString"?2:1,tags:Ir};ue.id!==null&&(cr.id=ue.id),$.features.push(cr)}}function qn($,ue,ve,Te,Ze,it){var gt=Te*Te;if(Te>0&&ue.size<(Ze?gt:Te))ve.numPoints+=ue.length/3;else{for(var be=[],Ye=0;Ye<ue.length;Ye+=3)(Te===0||ue[Ye+2]>gt)&&(ve.numSimplified++,be.push(ue[Ye]),be.push(ue[Ye+1])),ve.numPoints++;Ze&&function(jt,Ir){for(var sr=0,cr=0,Rr=jt.length,zn=Rr-2;cr<Rr;zn=cr,cr+=2)sr+=(jt[cr]-jt[zn])*(jt[cr+1]+jt[zn+1]);if(sr>0===Ir)for(cr=0,Rr=jt.length;cr<Rr/2;cr+=2){var Tn=jt[cr],tr=jt[cr+1];jt[cr]=jt[Rr-2-cr],jt[cr+1]=jt[Rr-1-cr],jt[Rr-2-cr]=Tn,jt[Rr-1-cr]=tr}}(be,it),$.push(be)}}function ta($,ue){var ve=(ue=this.options=function(Ze,it){for(var gt in it)Ze[gt]=it[gt];return Ze}(Object.create(this.options),ue)).debug;if(ve&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");var Te=function(Ze,it){var gt=[];if(Ze.type==="FeatureCollection")for(var be=0;be<Ze.features.length;be++)ra(gt,Ze.features[be],it,be);else ra(gt,Ze.type==="Feature"?Ze:{geometry:Ze},it);return gt}($,ue);this.tiles={},this.tileCoords=[],ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Te=function(Ze,it){var gt=it.buffer/it.extent,be=Ze,Ye=k(Ze,1,-1-gt,gt,0,-1,2,it),jt=k(Ze,1,1-gt,2+gt,0,-1,2,it);return(Ye||jt)&&(be=k(Ze,1,-gt,1+gt,0,-1,2,it)||[],Ye&&(be=pr(Ye,1).concat(be)),jt&&(be=be.concat(pr(jt,-1)))),be}(Te,ue)).length&&this.splitTile(Te,0,0,0),ve&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function na($,ue,ve){return 32*((1<<$)*ve+ue)+$}function ba($,ue){var ve=$.tileID.canonical;if(!this._geoJSONIndex)return ue(null,null);var Te=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!Te)return ue(null,null);var Ze=new vt(Te.features),it=At(Ze);it.byteOffset===0&&it.byteLength===it.buffer.byteLength||(it=new Uint8Array(it)),ue(null,{vectorTile:Ze,rawData:it.buffer})}mr.prototype.load=function($){var ue=this.options,ve=ue.log,Te=ue.minZoom,Ze=ue.maxZoom,it=ue.nodeSize;ve&&console.time("total time");var gt="prepare "+$.length+" points";ve&&console.time(gt),this.points=$;for(var be=[],Ye=0;Ye<$.length;Ye++)$[Ye].geometry&&be.push(mn($[Ye],Ye));this.trees[Ze+1]=new bt(be,Ni,ai,it,Float32Array),ve&&console.timeEnd(gt);for(var jt=Ze;jt>=Te;jt--){var Ir=+Date.now();be=this._cluster(be,jt),this.trees[jt]=new bt(be,Ni,ai,it,Float32Array),ve&&console.log("z%d: %d clusters in %dms",jt,be.length,+Date.now()-Ir)}return ve&&console.timeEnd("total time"),this},mr.prototype.getClusters=function($,ue){var ve=(($[0]+180)%360+360)%360-180,Te=Math.max(-90,Math.min(90,$[1])),Ze=$[2]===180?180:(($[2]+180)%360+360)%360-180,it=Math.max(-90,Math.min(90,$[3]));if($[2]-$[0]>=360)ve=-180,Ze=180;else if(ve>Ze){var gt=this.getClusters([ve,Te,180,it],ue),be=this.getClusters([-180,Te,Ze,it],ue);return gt.concat(be)}for(var Ye=this.trees[this._limitZoom(ue)],jt=[],Ir=0,sr=Ye.range(Qn(ve),ii(it),Qn(Ze),ii(Te));Ir<sr.length;Ir+=1){var cr=Ye.points[sr[Ir]];jt.push(cr.numPoints?wn(cr):this.points[cr.index])}return jt},mr.prototype.getChildren=function($){var ue=this._getOriginId($),ve=this._getOriginZoom($),Te="No cluster with the specified id.",Ze=this.trees[ve];if(!Ze)throw new Error(Te);var it=Ze.points[ue];if(!it)throw new Error(Te);for(var gt=this.options.radius/(this.options.extent*Math.pow(2,ve-1)),be=[],Ye=0,jt=Ze.within(it.x,it.y,gt);Ye<jt.length;Ye+=1){var Ir=Ze.points[jt[Ye]];Ir.parentId===$&&be.push(Ir.numPoints?wn(Ir):this.points[Ir.index])}if(be.length===0)throw new Error(Te);return be},mr.prototype.getLeaves=function($,ue,ve){var Te=[];return this._appendLeaves(Te,$,ue=ue||10,ve=ve||0,0),Te},mr.prototype.getTile=function($,ue,ve){var Te=this.trees[this._limitZoom($)],Ze=Math.pow(2,$),it=this.options,gt=it.radius/it.extent,be=(ve-gt)/Ze,Ye=(ve+1+gt)/Ze,jt={features:[]};return this._addTileFeatures(Te.range((ue-gt)/Ze,be,(ue+1+gt)/Ze,Ye),Te.points,ue,ve,Ze,jt),ue===0&&this._addTileFeatures(Te.range(1-gt/Ze,be,1,Ye),Te.points,Ze,ve,Ze,jt),ue===Ze-1&&this._addTileFeatures(Te.range(0,be,gt/Ze,Ye),Te.points,-1,ve,Ze,jt),jt.features.length?jt:null},mr.prototype.getClusterExpansionZoom=function($){for(var ue=this._getOriginZoom($)-1;ue<=this.options.maxZoom;){var ve=this.getChildren($);if(ue++,ve.length!==1)break;$=ve[0].properties.cluster_id}return ue},mr.prototype._appendLeaves=function($,ue,ve,Te,Ze){for(var it=0,gt=this.getChildren(ue);it<gt.length;it+=1){var be=gt[it],Ye=be.properties;if(Ye&&Ye.cluster?Ze+Ye.point_count<=Te?Ze+=Ye.point_count:Ze=this._appendLeaves($,Ye.cluster_id,ve,Te,Ze):Ze<Te?Ze++:$.push(be),$.length===ve)break}return Ze},mr.prototype._addTileFeatures=function($,ue,ve,Te,Ze,it){for(var gt=0,be=$;gt<be.length;gt+=1){var Ye=ue[be[gt]],jt=Ye.numPoints,Ir={type:1,geometry:[[Math.round(this.options.extent*(Ye.x*Ze-ve)),Math.round(this.options.extent*(Ye.y*Ze-Te))]],tags:jt?Ri(Ye):this.points[Ye.index].properties},sr=void 0;jt?sr=Ye.id:this.options.generateId?sr=Ye.index:this.points[Ye.index].id&&(sr=this.points[Ye.index].id),sr!==void 0&&(Ir.id=sr),it.features.push(Ir)}},mr.prototype._limitZoom=function($){return Math.max(this.options.minZoom,Math.min(+$,this.options.maxZoom+1))},mr.prototype._cluster=function($,ue){for(var ve=[],Te=this.options,Ze=Te.reduce,it=Te.minPoints,gt=Te.radius/(Te.extent*Math.pow(2,ue)),be=0;be<$.length;be++){var Ye=$[be];if(!(Ye.zoom<=ue)){Ye.zoom=ue;for(var jt=this.trees[ue+1],Ir=jt.within(Ye.x,Ye.y,gt),sr=Ye.numPoints||1,cr=sr,Rr=0,zn=Ir;Rr<zn.length;Rr+=1){var Tn=jt.points[zn[Rr]];Tn.zoom>ue&&(cr+=Tn.numPoints||1)}if(cr>=it){for(var tr=Ye.x*sr,_n=Ye.y*sr,rn=Ze&&sr>1?this._map(Ye,!0):null,cn=(be<<5)+(ue+1)+this.points.length,wi=0,gn=Ir;wi<gn.length;wi+=1){var zi=jt.points[gn[wi]];if(!(zi.zoom<=ue)){zi.zoom=ue;var ca=zi.numPoints||1;tr+=zi.x*ca,_n+=zi.y*ca,zi.parentId=cn,Ze&&(rn||(rn=this._map(Ye,!0)),Ze(rn,this._map(zi)))}}Ye.parentId=cn,ve.push(An(tr/cr,_n/cr,cn,cr,rn))}else if(ve.push(Ye),cr>1)for(var sn=0,ki=Ir;sn<ki.length;sn+=1){var Pi=jt.points[ki[sn]];Pi.zoom<=ue||(Pi.zoom=ue,ve.push(Pi))}}}return ve},mr.prototype._getOriginId=function($){return $-this.points.length>>5},mr.prototype._getOriginZoom=function($){return($-this.points.length)%32},mr.prototype._map=function($,ue){if($.numPoints)return ue?Vi({},$.properties):$.properties;var ve=this.points[$.index].properties,Te=this.options.map(ve);return ue&&Te===ve?Vi({},Te):Te},ta.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ta.prototype.splitTile=function($,ue,ve,Te,Ze,it,gt){for(var be=[$,ue,ve,Te],Ye=this.options,jt=Ye.debug;be.length;){Te=be.pop(),ve=be.pop(),ue=be.pop(),$=be.pop();var Ir=1<<ue,sr=na(ue,ve,Te),cr=this.tiles[sr];if(!cr&&(jt>1&&console.time("creation"),cr=this.tiles[sr]=Dr($,ue,ve,Te,Ye),this.tileCoords.push({z:ue,x:ve,y:Te}),jt)){jt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,ve,Te,cr.numFeatures,cr.numPoints,cr.numSimplified),console.timeEnd("creation"));var Rr="z"+ue;this.stats[Rr]=(this.stats[Rr]||0)+1,this.total++}if(cr.source=$,Ze){if(ue===Ye.maxZoom||ue===Ze)continue;var zn=1<<Ze-ue;if(ve!==Math.floor(it/zn)||Te!==Math.floor(gt/zn))continue}else if(ue===Ye.indexMaxZoom||cr.numPoints<=Ye.indexMaxPoints)continue;if(cr.source=null,$.length!==0){jt>1&&console.time("clipping");var Tn,tr,_n,rn,cn,wi,gn=.5*Ye.buffer/Ye.extent,zi=.5-gn,ca=.5+gn,sn=1+gn;Tn=tr=_n=rn=null,cn=k($,Ir,ve-gn,ve+ca,0,cr.minX,cr.maxX,Ye),wi=k($,Ir,ve+zi,ve+sn,0,cr.minX,cr.maxX,Ye),$=null,cn&&(Tn=k(cn,Ir,Te-gn,Te+ca,1,cr.minY,cr.maxY,Ye),tr=k(cn,Ir,Te+zi,Te+sn,1,cr.minY,cr.maxY,Ye),cn=null),wi&&(_n=k(wi,Ir,Te-gn,Te+ca,1,cr.minY,cr.maxY,Ye),rn=k(wi,Ir,Te+zi,Te+sn,1,cr.minY,cr.maxY,Ye),wi=null),jt>1&&console.timeEnd("clipping"),be.push(Tn||[],ue+1,2*ve,2*Te),be.push(tr||[],ue+1,2*ve,2*Te+1),be.push(_n||[],ue+1,2*ve+1,2*Te),be.push(rn||[],ue+1,2*ve+1,2*Te+1)}}},ta.prototype.getTile=function($,ue,ve){var Te=this.options,Ze=Te.extent,it=Te.debug;if($<0||$>24)return null;var gt=1<<$,be=na($,ue=(ue%gt+gt)%gt,ve);if(this.tiles[be])return Qr(this.tiles[be],Ze);it>1&&console.log("drilling down to z%d-%d-%d",$,ue,ve);for(var Ye,jt=$,Ir=ue,sr=ve;!Ye&&jt>0;)jt--,Ir=Math.floor(Ir/2),sr=Math.floor(sr/2),Ye=this.tiles[na(jt,Ir,sr)];return Ye&&Ye.source?(it>1&&console.log("found parent tile z%d-%d-%d",jt,Ir,sr),it>1&&console.time("drilling down"),this.splitTile(Ye.source,jt,Ir,sr,$,ue,ve),it>1&&console.timeEnd("drilling down"),this.tiles[be]?Qr(this.tiles[be],Ze):null):null};var ia=function($){function ue(ve,Te,Ze,it){$.call(this,ve,Te,Ze,ba),it&&(this.loadGeoJSON=it)}return $&&(ue.__proto__=$),(ue.prototype=Object.create($&&$.prototype)).constructor=ue,ue.prototype.loadData=function(ve,Te){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Te,this._pendingLoadDataParams=ve,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ue.prototype._loadData=function(){var ve=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Te=this._pendingCallback,Ze=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var it=!!(Ze&&Ze.request&&Ze.request.collectResourceTiming)&&new g.RequestPerformance(Ze.request);this.loadGeoJSON(Ze,function(gt,be){if(gt||!be)return Te(gt);if(typeof be!="object")return Te(new Error("Input data given to '"+Ze.source+"' is not a valid GeoJSON object."));(function cr(Rr,zn){var Tn,tr=Rr&&Rr.type;if(tr==="FeatureCollection")for(Tn=0;Tn<Rr.features.length;Tn++)cr(Rr.features[Tn],zn);else if(tr==="GeometryCollection")for(Tn=0;Tn<Rr.geometries.length;Tn++)cr(Rr.geometries[Tn],zn);else if(tr==="Feature")cr(Rr.geometry,zn);else if(tr==="Polygon")Jt(Rr.coordinates,zn);else if(tr==="MultiPolygon")for(Tn=0;Tn<Rr.coordinates.length;Tn++)Jt(Rr.coordinates[Tn],zn);return Rr})(be,!0);try{if(Ze.filter){var Ye=g.createExpression(Ze.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ye.result==="error")throw new Error(Ye.value.map(function(cr){return cr.key+": "+cr.message}).join(", "));var jt=be.features.filter(function(cr){return Ye.value.evaluate({zoom:0},cr)});be={type:"FeatureCollection",features:jt}}ve._geoJSONIndex=Ze.cluster?new mr(function(cr){var Rr=cr.superclusterOptions,zn=cr.clusterProperties;if(!zn||!Rr)return Rr;for(var Tn={},tr={},_n={accumulated:null,zoom:0},rn={properties:null},cn=Object.keys(zn),wi=0,gn=cn;wi<gn.length;wi+=1){var zi=gn[wi],ca=zn[zi],sn=ca[0],ki=g.createExpression(ca[1]),Pi=g.createExpression(typeof sn=="string"?[sn,["accumulated"],["get",zi]]:sn);Tn[zi]=ki.value,tr[zi]=Pi.value}return Rr.map=function(vi){rn.properties=vi;for(var Ji={},qt=0,Gt=cn;qt<Gt.length;qt+=1){var ji=Gt[qt];Ji[ji]=Tn[ji].evaluate(_n,rn)}return Ji},Rr.reduce=function(vi,Ji){rn.properties=Ji;for(var qt=0,Gt=cn;qt<Gt.length;qt+=1){var ji=Gt[qt];_n.accumulated=vi[ji],vi[ji]=tr[ji].evaluate(_n,rn)}},Rr}(Ze)).load(be.features):function(cr,Rr){return new ta(cr,Rr)}(be,Ze.geojsonVtOptions)}catch(cr){return Te(cr)}ve.loaded={};var Ir={};if(it){var sr=it.finish();sr&&(Ir.resourceTiming={},Ir.resourceTiming[Ze.source]=JSON.parse(JSON.stringify(sr)))}Te(null,Ir)})}},ue.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ue.prototype.reloadTile=function(ve,Te){var Ze=this.loaded;return Ze&&Ze[ve.uid]?$.prototype.reloadTile.call(this,ve,Te):this.loadTile(ve,Te)},ue.prototype.loadGeoJSON=function(ve,Te){if(ve.request)g.getJSON(ve.request,Te);else{if(typeof ve.data!="string")return Te(new Error("Input data given to '"+ve.source+"' is not a valid GeoJSON object."));try{return Te(null,JSON.parse(ve.data))}catch(Ze){return Te(new Error("Input data given to '"+ve.source+"' is not a valid GeoJSON object."))}}},ue.prototype.removeSource=function(ve,Te){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Te()},ue.prototype.getClusterExpansionZoom=function(ve,Te){try{Te(null,this._geoJSONIndex.getClusterExpansionZoom(ve.clusterId))}catch(Ze){Te(Ze)}},ue.prototype.getClusterChildren=function(ve,Te){try{Te(null,this._geoJSONIndex.getChildren(ve.clusterId))}catch(Ze){Te(Ze)}},ue.prototype.getClusterLeaves=function(ve,Te){try{Te(null,this._geoJSONIndex.getLeaves(ve.clusterId,ve.limit,ve.offset))}catch(Ze){Te(Ze)}},ue}(Ve),Ki=function($){var ue=this;this.self=$,this.actor=new g.Actor($,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ve,geojson:ia},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ve,Te){if(ue.workerSourceTypes[ve])throw new Error('Worker source with name "'+ve+'" already registered.');ue.workerSourceTypes[ve]=Te},this.self.registerRTLTextPlugin=function(ve){if(g.plugin.isParsed())throw new Error("RTL text plugin already registered.");g.plugin.applyArabicShaping=ve.applyArabicShaping,g.plugin.processBidirectionalText=ve.processBidirectionalText,g.plugin.processStyledBidirectionalText=ve.processStyledBidirectionalText}};return Ki.prototype.setReferrer=function($,ue){this.referrer=ue},Ki.prototype.setImages=function($,ue,ve){for(var Te in this.availableImages[$]=ue,this.workerSources[$]){var Ze=this.workerSources[$][Te];for(var it in Ze)Ze[it].availableImages=ue}ve()},Ki.prototype.setLayers=function($,ue,ve){this.getLayerIndex($).replace(ue),ve()},Ki.prototype.updateLayers=function($,ue,ve){this.getLayerIndex($).update(ue.layers,ue.removedIds),ve()},Ki.prototype.loadTile=function($,ue,ve){this.getWorkerSource($,ue.type,ue.source).loadTile(ue,ve)},Ki.prototype.loadDEMTile=function($,ue,ve){this.getDEMWorkerSource($,ue.source).loadTile(ue,ve)},Ki.prototype.reloadTile=function($,ue,ve){this.getWorkerSource($,ue.type,ue.source).reloadTile(ue,ve)},Ki.prototype.abortTile=function($,ue,ve){this.getWorkerSource($,ue.type,ue.source).abortTile(ue,ve)},Ki.prototype.removeTile=function($,ue,ve){this.getWorkerSource($,ue.type,ue.source).removeTile(ue,ve)},Ki.prototype.removeDEMTile=function($,ue){this.getDEMWorkerSource($,ue.source).removeTile(ue)},Ki.prototype.removeSource=function($,ue,ve){if(this.workerSources[$]&&this.workerSources[$][ue.type]&&this.workerSources[$][ue.type][ue.source]){var Te=this.workerSources[$][ue.type][ue.source];delete this.workerSources[$][ue.type][ue.source],Te.removeSource!==void 0?Te.removeSource(ue,ve):ve()}},Ki.prototype.loadWorkerSource=function($,ue,ve){try{this.self.importScripts(ue.url),ve()}catch(Te){ve(Te.toString())}},Ki.prototype.syncRTLPluginState=function($,ue,ve){try{g.plugin.setState(ue);var Te=g.plugin.getPluginURL();if(g.plugin.isLoaded()&&!g.plugin.isParsed()&&Te!=null){this.self.importScripts(Te);var Ze=g.plugin.isParsed();ve(Ze?void 0:new Error("RTL Text Plugin failed to import scripts from "+Te),Ze)}}catch(it){ve(it.toString())}},Ki.prototype.getAvailableImages=function($){var ue=this.availableImages[$];return ue||(ue=[]),ue},Ki.prototype.getLayerIndex=function($){var ue=this.layerIndexes[$];return ue||(ue=this.layerIndexes[$]=new oe),ue},Ki.prototype.getWorkerSource=function($,ue,ve){var Te=this;return this.workerSources[$]||(this.workerSources[$]={}),this.workerSources[$][ue]||(this.workerSources[$][ue]={}),this.workerSources[$][ue][ve]||(this.workerSources[$][ue][ve]=new this.workerSourceTypes[ue]({send:function(Ze,it,gt){Te.actor.send(Ze,it,gt,$)}},this.getLayerIndex($),this.getAvailableImages($))),this.workerSources[$][ue][ve]},Ki.prototype.getDEMWorkerSource=function($,ue){return this.demWorkerSources[$]||(this.demWorkerSources[$]={}),this.demWorkerSources[$][ue]||(this.demWorkerSources[$][ue]=new Je),this.demWorkerSources[$][ue]},Ki.prototype.enforceCacheSizeLimit=function($,ue){g.enforceCacheSizeLimit(ue)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ki(self)),Ki}),Y(["./shared"],function(g){"use strict";var fe=g.createCommonjsModule(function(c){function h(S){return!f(S)}function f(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,D,G=new Blob([""],{type:"text/javascript"}),Q=URL.createObjectURL(G);try{D=new Worker(Q),P=!0}catch(ge){P=!1}return D&&D.terminate(),URL.revokeObjectURL(Q),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var D=P.getContext("2d");if(!D)return!1;var G=D.getImageData(0,0,1,1);return G&&G.width===P.width}()?(v[T=S&&S.failIfMajorPerformanceCaveat]===void 0&&(v[T]=function(P){var D=function(Q){var ge=document.createElement("canvas"),Ee=Object.create(h.webGLContextAttributes);return Ee.failIfMajorPerformanceCaveat=Q,ge.probablySupportsContext?ge.probablySupportsContext("webgl",Ee)||ge.probablySupportsContext("experimental-webgl",Ee):ge.supportsContext?ge.supportsContext("webgl",Ee)||ge.supportsContext("experimental-webgl",Ee):ge.getContext("webgl",Ee)||ge.getContext("experimental-webgl",Ee)}(P);if(!D)return!1;var G=D.createShader(D.VERTEX_SHADER);return!(!G||D.isContextLost())&&(D.shaderSource(G,"void main() {}"),D.compileShader(G),D.getShaderParameter(G,D.COMPILE_STATUS)===!0)}(T)),v[T]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var T}c.exports?c.exports=h:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=h,window.mapboxgl.notSupportedReason=f);var v={};h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),N={create:function(c,h,f){var v=g.window.document.createElement(c);return h!==void 0&&(v.className=h),f&&f.appendChild(v),v},createNS:function(c,h){return g.window.document.createElementNS(c,h)}},oe=g.window.document&&g.window.document.documentElement.style;function ne(c){if(!oe)return c[0];for(var h=0;h<c.length;h++)if(c[h]in oe)return c[h];return c[0]}var we,re=ne(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);N.disableDrag=function(){oe&&re&&(we=oe[re],oe[re]="none")},N.enableDrag=function(){oe&&re&&(oe[re]=we)};var ke=ne(["transform","WebkitTransform"]);N.setTransform=function(c,h){c.style[ke]=h};var Ve=!1;try{var Ne=Object.defineProperty({},"passive",{get:function(){Ve=!0}});g.window.addEventListener("test",Ne,Ne),g.window.removeEventListener("test",Ne,Ne)}catch(c){Ve=!1}N.addEventListener=function(c,h,f,v){v===void 0&&(v={}),c.addEventListener(h,f,"passive"in v&&Ve?v:v.capture)},N.removeEventListener=function(c,h,f,v){v===void 0&&(v={}),c.removeEventListener(h,f,"passive"in v&&Ve?v:v.capture)};var Je=function(c){c.preventDefault(),c.stopPropagation(),g.window.removeEventListener("click",Je,!0)};function Jt(c){var h=c.userImage;return!!(h&&h.render&&h.render())&&(c.data.replace(new Uint8Array(h.data.buffer)),!0)}N.suppressClick=function(){g.window.addEventListener("click",Je,!0),g.window.setTimeout(function(){g.window.removeEventListener("click",Je,!0)},0)},N.mousePos=function(c,h){var f=c.getBoundingClientRect();return new g.Point(h.clientX-f.left-c.clientLeft,h.clientY-f.top-c.clientTop)},N.touchPos=function(c,h){for(var f=c.getBoundingClientRect(),v=[],S=0;S<h.length;S++)v.push(new g.Point(h[S].clientX-f.left-c.clientLeft,h[S].clientY-f.top-c.clientTop));return v},N.mouseButton=function(c){return g.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&g.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button},N.remove=function(c){c.parentNode&&c.parentNode.removeChild(c)};var _t=function(c){function h(){c.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new g.RGBAImage({width:1,height:1}),this.dirty=!0}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.isLoaded=function(){return this.loaded},h.prototype.setLoaded=function(f){if(this.loaded!==f&&(this.loaded=f,f)){for(var v=0,S=this.requestors;v<S.length;v+=1){var T=S[v];this._notify(T.ids,T.callback)}this.requestors=[]}},h.prototype.getImage=function(f){return this.images[f]},h.prototype.addImage=function(f,v){this._validate(f,v)&&(this.images[f]=v)},h.prototype._validate=function(f,v){var S=!0;return this._validateStretch(v.stretchX,v.data&&v.data.width)||(this.fire(new g.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(v.stretchY,v.data&&v.data.height)||(this.fire(new g.ErrorEvent(new Error('Image "'+f+'" has invalid "stretchY" value'))),S=!1),this._validateContent(v.content,v)||(this.fire(new g.ErrorEvent(new Error('Image "'+f+'" has invalid "content" value'))),S=!1),S},h.prototype._validateStretch=function(f,v){if(!f)return!0;for(var S=0,T=0,P=f;T<P.length;T+=1){var D=P[T];if(D[0]<S||D[1]<D[0]||v<D[1])return!1;S=D[1]}return!0},h.prototype._validateContent=function(f,v){return!(f&&(f.length!==4||f[0]<0||v.data.width<f[0]||f[1]<0||v.data.height<f[1]||f[2]<0||v.data.width<f[2]||f[3]<0||v.data.height<f[3]||f[2]<f[0]||f[3]<f[1]))},h.prototype.updateImage=function(f,v){v.version=this.images[f].version+1,this.images[f]=v,this.updatedImages[f]=!0},h.prototype.removeImage=function(f){var v=this.images[f];delete this.images[f],delete this.patterns[f],v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()},h.prototype.listImages=function(){return Object.keys(this.images)},h.prototype.getImages=function(f,v){var S=!0;if(!this.isLoaded())for(var T=0,P=f;T<P.length;T+=1)this.images[P[T]]||(S=!1);this.isLoaded()||S?this._notify(f,v):this.requestors.push({ids:f,callback:v})},h.prototype._notify=function(f,v){for(var S={},T=0,P=f;T<P.length;T+=1){var D=P[T];this.images[D]||this.fire(new g.Event("styleimagemissing",{id:D}));var G=this.images[D];G?S[D]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:Boolean(G.userImage&&G.userImage.render)}:g.warnOnce('Image "'+D+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}v(null,S)},h.prototype.getPixelSize=function(){var f=this.atlasImage;return{width:f.width,height:f.height}},h.prototype.getPattern=function(f){var v=this.patterns[f],S=this.getImage(f);if(!S)return null;if(v&&v.position.version===S.version)return v.position;if(v)v.position.version=S.version;else{var T={w:S.data.width+2,h:S.data.height+2,x:0,y:0},P=new g.ImagePosition(T,S);this.patterns[f]={bin:T,position:P}}return this._updatePatternAtlas(),this.patterns[f].position},h.prototype.bind=function(f){var v=f.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new g.Texture(f,this.atlasImage,v.RGBA),this.atlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE)},h.prototype._updatePatternAtlas=function(){var f=[];for(var v in this.patterns)f.push(this.patterns[v].bin);var S=g.potpack(f),T=S.w,P=S.h,D=this.atlasImage;for(var G in D.resize({width:T||1,height:P||1}),this.patterns){var Q=this.patterns[G].bin,ge=Q.x+1,Ee=Q.y+1,Se=this.images[G].data,We=Se.width,je=Se.height;g.RGBAImage.copy(Se,D,{x:0,y:0},{x:ge,y:Ee},{width:We,height:je}),g.RGBAImage.copy(Se,D,{x:0,y:je-1},{x:ge,y:Ee-1},{width:We,height:1}),g.RGBAImage.copy(Se,D,{x:0,y:0},{x:ge,y:Ee+je},{width:We,height:1}),g.RGBAImage.copy(Se,D,{x:We-1,y:0},{x:ge-1,y:Ee},{width:1,height:je}),g.RGBAImage.copy(Se,D,{x:0,y:0},{x:ge+We,y:Ee},{width:1,height:je})}this.dirty=!0},h.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},h.prototype.dispatchRenderCallbacks=function(f){for(var v=0,S=f;v<S.length;v+=1){var T=S[v];if(!this.callbackDispatchedThisFrame[T]){this.callbackDispatchedThisFrame[T]=!0;var P=this.images[T];Jt(P)&&this.updateImage(T,P)}}},h}(g.Evented),Ut=pt,Tt=pt,vt=1e20;function pt(c,h,f,v,S,T){this.fontSize=c||24,this.buffer=h===void 0?3:h,this.cutoff=v||.25,this.fontFamily=S||"sans-serif",this.fontWeight=T||"normal",this.radius=f||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Vt(c,h,f,v,S,T,P){for(var D=0;D<h;D++){for(var G=0;G<f;G++)v[G]=c[G*h+D];for(ee(v,S,T,P,f),G=0;G<f;G++)c[G*h+D]=S[G]}for(G=0;G<f;G++){for(D=0;D<h;D++)v[D]=c[G*h+D];for(ee(v,S,T,P,h),D=0;D<h;D++)c[G*h+D]=Math.sqrt(S[D])}}function ee(c,h,f,v,S){f[0]=0,v[0]=-vt,v[1]=+vt;for(var T=1,P=0;T<S;T++){for(var D=(c[T]+T*T-(c[f[P]]+f[P]*f[P]))/(2*T-2*f[P]);D<=v[P];)P--,D=(c[T]+T*T-(c[f[P]]+f[P]*f[P]))/(2*T-2*f[P]);f[++P]=T,v[P]=D,v[P+1]=+vt}for(T=0,P=0;T<S;T++){for(;v[P+1]<T;)P++;h[T]=(T-f[P])*(T-f[P])+c[f[P]]}}pt.prototype.draw=function(c){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(c,this.buffer,this.middle);for(var h=this.ctx.getImageData(0,0,this.size,this.size),f=new Uint8ClampedArray(this.size*this.size),v=0;v<this.size*this.size;v++){var S=h.data[4*v+3]/255;this.gridOuter[v]=S===1?0:S===0?vt:Math.pow(Math.max(0,.5-S),2),this.gridInner[v]=S===1?vt:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(Vt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Vt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),v=0;v<this.size*this.size;v++)f[v]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[v]-this.gridInner[v])/this.radius+this.cutoff))));return f},Ut.default=Tt;var rr=function(c,h){this.requestManager=c,this.localIdeographFontFamily=h,this.entries={}};rr.prototype.setURL=function(c){this.url=c},rr.prototype.getGlyphs=function(c,h){var f=this,v=[];for(var S in c)for(var T=0,P=c[S];T<P.length;T+=1)v.push({stack:S,id:P[T]});g.asyncAll(v,function(D,G){var Q=D.stack,ge=D.id,Ee=f.entries[Q];Ee||(Ee=f.entries[Q]={glyphs:{},requests:{},ranges:{}});var Se=Ee.glyphs[ge];if(Se===void 0){if(Se=f._tinySDF(Ee,Q,ge))return Ee.glyphs[ge]=Se,void G(null,{stack:Q,id:ge,glyph:Se});var We=Math.floor(ge/256);if(256*We>65535)G(new Error("glyphs > 65535 not supported"));else if(Ee.ranges[We])G(null,{stack:Q,id:ge,glyph:Se});else{var je=Ee.requests[We];je||(je=Ee.requests[We]=[],rr.loadGlyphRange(Q,We,f.url,f.requestManager,function(lt,Re){if(Re){for(var at in Re)f._doesCharSupportLocalGlyph(+at)||(Ee.glyphs[+at]=Re[+at]);Ee.ranges[We]=!0}for(var mt=0,Wt=je;mt<Wt.length;mt+=1)(0,Wt[mt])(lt,Re);delete Ee.requests[We]})),je.push(function(lt,Re){lt?G(lt):Re&&G(null,{stack:Q,id:ge,glyph:Re[ge]||null})})}}else G(null,{stack:Q,id:ge,glyph:Se})},function(D,G){if(D)h(D);else if(G){for(var Q={},ge=0,Ee=G;ge<Ee.length;ge+=1){var Se=Ee[ge],We=Se.stack,je=Se.id,lt=Se.glyph;(Q[We]||(Q[We]={}))[je]=lt&&{id:lt.id,bitmap:lt.bitmap.clone(),metrics:lt.metrics}}h(null,Q)}})},rr.prototype._doesCharSupportLocalGlyph=function(c){return!!this.localIdeographFontFamily&&(g.isChar["CJK Unified Ideographs"](c)||g.isChar["Hangul Syllables"](c)||g.isChar.Hiragana(c)||g.isChar.Katakana(c))},rr.prototype._tinySDF=function(c,h,f){var v=this.localIdeographFontFamily;if(v&&this._doesCharSupportLocalGlyph(f)){var S=c.tinySDF;if(!S){var T="400";/bold/i.test(h)?T="900":/medium/i.test(h)?T="500":/light/i.test(h)&&(T="200"),S=c.tinySDF=new rr.TinySDF(24,3,8,.25,v,T)}return{id:f,bitmap:new g.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(f))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},rr.loadGlyphRange=function(c,h,f,v,S){var T=256*h,P=T+255,D=v.transformRequest(v.normalizeGlyphsURL(f).replace("{fontstack}",c).replace("{range}",T+"-"+P),g.ResourceType.Glyphs);g.getArrayBuffer(D,function(G,Q){if(G)S(G);else if(Q){for(var ge={},Ee=0,Se=g.parseGlyphPBF(Q);Ee<Se.length;Ee+=1){var We=Se[Ee];ge[We.id]=We}S(null,ge)}})},rr.TinySDF=Ut;var At=function(){this.specification=g.styleSpec.light.position};At.prototype.possiblyEvaluate=function(c,h){return g.sphericalToCartesian(c.expression.evaluate(h))},At.prototype.interpolate=function(c,h,f){return{x:g.number(c.x,h.x,f),y:g.number(c.y,h.y,f),z:g.number(c.z,h.z,f)}};var nt=new g.Properties({anchor:new g.DataConstantProperty(g.styleSpec.light.anchor),position:new At,color:new g.DataConstantProperty(g.styleSpec.light.color),intensity:new g.DataConstantProperty(g.styleSpec.light.intensity)}),Zt=function(c){function h(f){c.call(this),this._transitionable=new g.Transitionable(nt),this.setLight(f),this._transitioning=this._transitionable.untransitioned()}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getLight=function(){return this._transitionable.serialize()},h.prototype.setLight=function(f,v){if(v===void 0&&(v={}),!this._validate(g.validateLight,f,v))for(var S in f){var T=f[S];g.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-"-transition".length),T):this._transitionable.setValue(S,T)}},h.prototype.updateTransitions=function(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)},h.prototype.hasTransition=function(){return this._transitioning.hasTransition()},h.prototype.recalculate=function(f){this.properties=this._transitioning.possiblyEvaluate(f)},h.prototype._validate=function(f,v,S){return(!S||S.validate!==!1)&&g.emitValidationErrors(this,f.call(g.validateStyle,g.extend({value:v,style:{glyphs:!0,sprite:!0},styleSpec:g.styleSpec})))},h}(g.Evented),ut=function(c,h){this.width=c,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};ut.prototype.getDash=function(c,h){var f=c.join(",")+String(h);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(c,h)),this.dashEntry[f]},ut.prototype.getDashRanges=function(c,h,f){var v=[],S=c.length%2==1?-c[c.length-1]*f:0,T=c[0]*f,P=!0;v.push({left:S,right:T,isDash:P,zeroLength:c[0]===0});for(var D=c[0],G=1;G<c.length;G++){var Q=c[G];v.push({left:S=D*f,right:T=(D+=Q)*f,isDash:P=!P,zeroLength:Q===0})}return v},ut.prototype.addRoundDash=function(c,h,f){for(var v=h/2,S=-f;S<=f;S++)for(var T=this.width*(this.nextRow+f+S),P=0,D=c[P],G=0;G<this.width;G++){G/D.right>1&&(D=c[++P]);var Q=Math.abs(G-D.left),ge=Math.abs(G-D.right),Ee=Math.min(Q,ge),Se=void 0,We=S/f*(v+1);if(D.isDash){var je=v-Math.abs(We);Se=Math.sqrt(Ee*Ee+je*je)}else Se=v-Math.sqrt(Ee*Ee+We*We);this.data[T+G]=Math.max(0,Math.min(255,Se+128))}},ut.prototype.addRegularDash=function(c){for(var h=c.length-1;h>=0;--h){var f=c[h],v=c[h+1];f.zeroLength?c.splice(h,1):v&&v.isDash===f.isDash&&(v.left=f.left,c.splice(h,1))}var S=c[0],T=c[c.length-1];S.isDash===T.isDash&&(S.left=T.left-this.width,T.right=S.right+this.width);for(var P=this.width*this.nextRow,D=0,G=c[D],Q=0;Q<this.width;Q++){Q/G.right>1&&(G=c[++D]);var ge=Math.abs(Q-G.left),Ee=Math.abs(Q-G.right),Se=Math.min(ge,Ee);this.data[P+Q]=Math.max(0,Math.min(255,(G.isDash?Se:-Se)+128))}},ut.prototype.addDash=function(c,h){var f=h?7:0,v=2*f+1;if(this.nextRow+v>this.height)return g.warnOnce("LineAtlas out of space"),null;for(var S=0,T=0;T<c.length;T++)S+=c[T];if(S!==0){var P=this.width/S,D=this.getDashRanges(c,this.width,P);h?this.addRoundDash(D,P,f):this.addRegularDash(D)}var G={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:S};return this.nextRow+=v,this.dirty=!0,G},ut.prototype.bind=function(c){var h=c.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))};var nr=function c(h,f){this.workerPool=h,this.actors=[],this.currentActor=0,this.id=g.uniqueId();for(var v=this.workerPool.acquire(this.id),S=0;S<v.length;S++){var T=new c.Actor(v[S],f,this.id);T.name="Worker "+S,this.actors.push(T)}};function Mr(c,h,f){var v=function(S,T){if(S)return f(S);if(T){var P=g.pick(g.extend(T,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(P.vectorLayers=T.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(D){return D.id})),P.tiles=h.canonicalizeTileset(P,c.url),f(null,P)}};return c.url?g.getJSON(h.transformRequest(h.normalizeSourceURL(c.url),g.ResourceType.Source),v):g.browser.frame(function(){return v(null,c)})}nr.prototype.broadcast=function(c,h,f){g.asyncAll(this.actors,function(v,S){v.send(c,h,S)},f=f||function(){})},nr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},nr.prototype.remove=function(){this.actors.forEach(function(c){c.remove()}),this.actors=[],this.workerPool.release(this.id)},nr.Actor=g.Actor;var q=function(c,h,f){this.bounds=g.LngLatBounds.convert(this.validateBounds(c)),this.minzoom=h||0,this.maxzoom=f||24};q.prototype.validateBounds=function(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]},q.prototype.contains=function(c){var h=Math.pow(2,c.z),f=Math.floor(g.mercatorXfromLng(this.bounds.getWest())*h),v=Math.floor(g.mercatorYfromLat(this.bounds.getNorth())*h),S=Math.ceil(g.mercatorXfromLng(this.bounds.getEast())*h),T=Math.ceil(g.mercatorYfromLat(this.bounds.getSouth())*h);return c.x>=f&&c.x<S&&c.y>=v&&c.y<T};var pe=function(c){function h(f,v,S,T){if(c.call(this),this.id=f,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,g.extend(this,g.pick(v,["url","scheme","tileSize","promoteId"])),this._options=g.extend({type:"vector"},v),this._collectResourceTiming=v.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(T)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Mr(this._options,this.map._requestManager,function(v,S){f._tileJSONRequest=null,f._loaded=!0,v?f.fire(new g.ErrorEvent(v)):S&&(g.extend(f,S),S.bounds&&(f.tileBounds=new q(S.bounds,f.minzoom,f.maxzoom)),g.postTurnstileEvent(S.tiles,f.map._requestManager._customAccessToken),g.postMapLoadEvent(S.tiles,f.map._getMapId(),f.map._requestManager._skuToken,f.map._requestManager._customAccessToken),f.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setSourceProperty=function(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},h.prototype.setTiles=function(f){var v=this;return this.setSourceProperty(function(){v._options.tiles=f}),this},h.prototype.setUrl=function(f){var v=this;return this.setSourceProperty(function(){v.url=f,v._options.url=f}),this},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return g.extend({},this._options)},h.prototype.loadTile=function(f,v){var S=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),T={request:this.map._requestManager.transformRequest(S,g.ResourceType.Tile),uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:g.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(D,G){return delete f.request,f.aborted?v(null):D&&D.status!==404?v(D):(G&&G.resourceTiming&&(f.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&f.setExpiryData(G),f.loadVectorData(G,this.map.painter),g.cacheEntryPossiblyAdded(this.dispatcher),v(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}T.request.collectResourceTiming=this._collectResourceTiming,f.actor&&f.state!=="expired"?f.state==="loading"?f.reloadCallback=v:f.request=f.actor.send("reloadTile",T,P.bind(this)):(f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",T,P.bind(this)))},h.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id},void 0)},h.prototype.unloadTile=function(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id},void 0)},h.prototype.hasTransition=function(){return!1},h}(g.Evented),b=function(c){function h(f,v,S,T){c.call(this),this.id=f,this.dispatcher=S,this.setEventedParent(T),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=g.extend({type:"raster"},v),g.extend(this,g.pick(v,["url","scheme","tileSize"]))}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Mr(this._options,this.map._requestManager,function(v,S){f._tileJSONRequest=null,f._loaded=!0,v?f.fire(new g.ErrorEvent(v)):S&&(g.extend(f,S),S.bounds&&(f.tileBounds=new q(S.bounds,f.minzoom,f.maxzoom)),g.postTurnstileEvent(S.tiles),g.postMapLoadEvent(S.tiles,f.map._getMapId(),f.map._requestManager._skuToken),f.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),f.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})},h.prototype.loaded=function(){return this._loaded},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},h.prototype.serialize=function(){return g.extend({},this._options)},h.prototype.hasTile=function(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)},h.prototype.loadTile=function(f,v){var S=this,T=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);f.request=g.getImage(this.map._requestManager.transformRequest(T,g.ResourceType.Tile),function(P,D){if(delete f.request,f.aborted)f.state="unloaded",v(null);else if(P)f.state="errored",v(P);else if(D){S.map._refreshExpiredTiles&&f.setExpiryData(D),delete D.cacheControl,delete D.expires;var G=S.map.painter.context,Q=G.gl;f.texture=S.map.painter.getTileTexture(D.width),f.texture?f.texture.update(D,{useMipmap:!0}):(f.texture=new g.Texture(G,D,Q.RGBA,{useMipmap:!0}),f.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&Q.texParameterf(Q.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),f.state="loaded",g.cacheEntryPossiblyAdded(S.dispatcher),v(null)}})},h.prototype.abortTile=function(f,v){f.request&&(f.request.cancel(),delete f.request),v()},h.prototype.unloadTile=function(f,v){f.texture&&this.map.painter.saveTileTexture(f.texture),v()},h.prototype.hasTransition=function(){return!1},h}(g.Evented),le=function(c){function h(f,v,S,T){c.call(this,f,v,S,T),this.type="raster-dem",this.maxzoom=22,this._options=g.extend({type:"raster-dem"},v),this.encoding=v.encoding||"mapbox"}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},h.prototype.loadTile=function(f,v){var S=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function T(P,D){P&&(f.state="errored",v(P)),D&&(f.dem=D,f.needsHillshadePrepare=!0,f.state="loaded",v(null))}f.request=g.getImage(this.map._requestManager.transformRequest(S,g.ResourceType.Tile),function(P,D){if(delete f.request,f.aborted)f.state="unloaded",v(null);else if(P)f.state="errored",v(P);else if(D){this.map._refreshExpiredTiles&&f.setExpiryData(D),delete D.cacheControl,delete D.expires;var G=g.window.ImageBitmap&&D instanceof g.window.ImageBitmap&&g.offscreenCanvasSupported()?D:g.browser.getImageData(D,1),Q={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:G,encoding:this.encoding};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",Q,T.bind(this)))}}.bind(this)),f.neighboringTiles=this._getNeighboringTiles(f.tileID)},h.prototype._getNeighboringTiles=function(f){var v=f.canonical,S=Math.pow(2,v.z),T=(v.x-1+S)%S,P=v.x===0?f.wrap-1:f.wrap,D=(v.x+1+S)%S,G=v.x+1===S?f.wrap+1:f.wrap,Q={};return Q[new g.OverscaledTileID(f.overscaledZ,P,v.z,T,v.y).key]={backfilled:!1},Q[new g.OverscaledTileID(f.overscaledZ,G,v.z,D,v.y).key]={backfilled:!1},v.y>0&&(Q[new g.OverscaledTileID(f.overscaledZ,P,v.z,T,v.y-1).key]={backfilled:!1},Q[new g.OverscaledTileID(f.overscaledZ,f.wrap,v.z,v.x,v.y-1).key]={backfilled:!1},Q[new g.OverscaledTileID(f.overscaledZ,G,v.z,D,v.y-1).key]={backfilled:!1}),v.y+1<S&&(Q[new g.OverscaledTileID(f.overscaledZ,P,v.z,T,v.y+1).key]={backfilled:!1},Q[new g.OverscaledTileID(f.overscaledZ,f.wrap,v.z,v.x,v.y+1).key]={backfilled:!1},Q[new g.OverscaledTileID(f.overscaledZ,G,v.z,D,v.y+1).key]={backfilled:!1}),Q},h.prototype.unloadTile=function(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded",f.actor&&f.actor.send("removeDEMTile",{uid:f.uid,source:this.id})},h}(b),xe=function(c){function h(f,v,S,T){c.call(this),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(T),this._data=v.data,this._options=g.extend({},v),this._collectResourceTiming=v.collectResourceTiming,this._resourceTiming=[],v.maxzoom!==void 0&&(this.maxzoom=v.maxzoom),v.type&&(this.type=v.type),v.attribution&&(this.attribution=v.attribution),this.promoteId=v.promoteId;var P=g.EXTENT/this.tileSize;this.workerOptions=g.extend({source:this.id,cluster:v.cluster||!1,geojsonVtOptions:{buffer:(v.buffer!==void 0?v.buffer:128)*P,tolerance:(v.tolerance!==void 0?v.tolerance:.375)*P,extent:g.EXTENT,maxZoom:this.maxzoom,lineMetrics:v.lineMetrics||!1,generateId:v.generateId||!1},superclusterOptions:{maxZoom:v.clusterMaxZoom!==void 0?Math.min(v.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,v.clusterMinPoints||2),extent:g.EXTENT,radius:(v.clusterRadius||50)*P,log:!1,generateId:v.generateId||!1},clusterProperties:v.clusterProperties,filter:v.filter},v.workerOptions)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this.fire(new g.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(v){if(v)f.fire(new g.ErrorEvent(v));else{var S={dataType:"source",sourceDataType:"metadata"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(S.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new g.Event("data",S))}})},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setData=function(f){var v=this;return this._data=f,this.fire(new g.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)v.fire(new g.ErrorEvent(S));else{var T={dataType:"source",sourceDataType:"content"};v._collectResourceTiming&&v._resourceTiming&&v._resourceTiming.length>0&&(T.resourceTiming=v._resourceTiming,v._resourceTiming=[]),v.fire(new g.Event("data",T))}}),this},h.prototype.getClusterExpansionZoom=function(f,v){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},v),this},h.prototype.getClusterChildren=function(f,v){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},v),this},h.prototype.getClusterLeaves=function(f,v,S,T){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:v,offset:S},T),this},h.prototype._updateWorkerData=function(f){var v=this;this._loaded=!1;var S=g.extend({},this.workerOptions),T=this._data;typeof T=="string"?(S.request=this.map._requestManager.transformRequest(g.browser.resolveURL(T),g.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(T),this.actor.send(this.type+".loadData",S,function(P,D){v._removed||D&&D.abandoned||(v._loaded=!0,D&&D.resourceTiming&&D.resourceTiming[v.id]&&(v._resourceTiming=D.resourceTiming[v.id].slice(0)),v.actor.send(v.type+".coalesce",{source:S.source},null),f(P))})},h.prototype.loaded=function(){return this._loaded},h.prototype.loadTile=function(f,v){var S=this,T=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(T,{type:this.type,uid:f.uid,tileID:f.tileID,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:g.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,D){return delete f.request,f.unloadVectorData(),f.aborted?v(null):P?v(P):(f.loadVectorData(D,S.map.painter,T==="reloadTile"),v(null))})},h.prototype.abortTile=function(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0},h.prototype.unloadTile=function(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})},h.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},h.prototype.serialize=function(){return g.extend({},this._options,{type:this.type,data:this._data})},h.prototype.hasTransition=function(){return!1},h}(g.Evented),Qe=g.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),xt=function(c){function h(f,v,S,T){c.call(this),this.id=f,this.dispatcher=S,this.coordinates=v.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(T),this.options=v}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(f,v){var S=this;this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this.url=this.options.url,g.getImage(this.map._requestManager.transformRequest(this.url,g.ResourceType.Image),function(T,P){S._loaded=!0,T?S.fire(new g.ErrorEvent(T)):P&&(S.image=P,f&&(S.coordinates=f),v&&v(),S._finishLoading())})},h.prototype.loaded=function(){return this._loaded},h.prototype.updateImage=function(f){var v=this;return this.image&&f.url?(this.options.url=f.url,this.load(f.coordinates,function(){v.texture=null}),this):this},h.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})))},h.prototype.onAdd=function(f){this.map=f,this.load()},h.prototype.setCoordinates=function(f){var v=this;this.coordinates=f;var S=f.map(g.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var D=1/0,G=1/0,Q=-1/0,ge=-1/0,Ee=0,Se=P;Ee<Se.length;Ee+=1){var We=Se[Ee];D=Math.min(D,We.x),G=Math.min(G,We.y),Q=Math.max(Q,We.x),ge=Math.max(ge,We.y)}var je=Math.max(Q-D,ge-G),lt=Math.max(0,Math.floor(-Math.log(je)/Math.LN2)),Re=Math.pow(2,lt);return new g.CanonicalTileID(lt,Math.floor((D+Q)/2*Re),Math.floor((G+ge)/2*Re))}(S),this.minzoom=this.maxzoom=this.tileID.z;var T=S.map(function(P){return v.tileID.getTilePoint(P)._round()});return this._boundsArray=new g.StructArrayLayout4i8,this._boundsArray.emplaceBack(T[0].x,T[0].y,0,0),this._boundsArray.emplaceBack(T[1].x,T[1].y,g.EXTENT,0),this._boundsArray.emplaceBack(T[3].x,T[3].y,0,g.EXTENT),this._boundsArray.emplaceBack(T[2].x,T[2].y,g.EXTENT,g.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})),this},h.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var f=this.map.painter.context,v=f.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Qe.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new g.Texture(f,this.image,v.RGBA),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE)),this.tiles){var T=this.tiles[S];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},h.prototype.loadTile=function(f,v){this.tileID&&this.tileID.equals(f.tileID.canonical)?(this.tiles[String(f.tileID.wrap)]=f,f.buckets={},v(null)):(f.state="errored",v(null))},h.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return!1},h}(g.Evented),Bt=function(c){function h(f,v,S,T){c.call(this,f,v,S,T),this.roundZoom=!0,this.type="video",this.options=v}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){var f=this;this._loaded=!1;var v=this.options;this.urls=[];for(var S=0,T=v.urls;S<T.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(T[S],g.ResourceType.Source).url);g.getVideo(this.urls,function(P,D){f._loaded=!0,P?f.fire(new g.ErrorEvent(P)):D&&(f.video=D,f.video.loop=!0,f.video.addEventListener("playing",function(){f.map.triggerRepaint()}),f.map&&f.video.play(),f._finishLoading())})},h.prototype.pause=function(){this.video&&this.video.pause()},h.prototype.play=function(){this.video&&this.video.play()},h.prototype.seek=function(f){if(this.video){var v=this.video.seekable;f<v.start(0)||f>v.end(0)?this.fire(new g.ErrorEvent(new g.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+v.start(0)+" and "+v.end(0)+"-second mark."))):this.video.currentTime=f}},h.prototype.getVideo=function(){return this.video},h.prototype.onAdd=function(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},h.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var f=this.map.painter.context,v=f.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Qe.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.texSubImage2D(v.TEXTURE_2D,0,0,0,v.RGBA,v.UNSIGNED_BYTE,this.video)):(this.texture=new g.Texture(f,this.video,v.RGBA),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE)),this.tiles){var T=this.tiles[S];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this.video&&!this.video.paused},h}(xt),Fe=function(c){function h(f,v,S,T){c.call(this,f,v,S,T),v.coordinates?Array.isArray(v.coordinates)&&v.coordinates.length===4&&!v.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(D){return typeof D!="number"})})||this.fire(new g.ErrorEvent(new g.ValidationError("sources."+f,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new g.ErrorEvent(new g.ValidationError("sources."+f,null,'missing required property "coordinates"'))),v.animate&&typeof v.animate!="boolean"&&this.fire(new g.ErrorEvent(new g.ValidationError("sources."+f,null,'optional "animate" property must be a boolean value'))),v.canvas?typeof v.canvas=="string"||v.canvas instanceof g.window.HTMLCanvasElement||this.fire(new g.ErrorEvent(new g.ValidationError("sources."+f,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new g.ErrorEvent(new g.ValidationError("sources."+f,null,'missing required property "canvas"'))),this.options=v,this.animate=v.animate===void 0||v.animate}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof g.window.HTMLCanvasElement?this.options.canvas:g.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new g.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},h.prototype.getCanvas=function(){return this.canvas},h.prototype.onAdd=function(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()},h.prototype.onRemove=function(){this.pause()},h.prototype.prepare=function(){var f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var v=this.map.painter.context,S=v.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,Qe.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new g.Texture(v,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[T];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},h.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},h.prototype.hasTransition=function(){return this._playing},h.prototype._hasInvalidDimensions=function(){for(var f=0,v=[this.canvas.width,this.canvas.height];f<v.length;f+=1){var S=v[f];if(isNaN(S)||S<=0)return!0}return!1},h}(xt),bt={vector:pe,raster:b,"raster-dem":le,geojson:xe,video:Bt,image:xt,canvas:Fe};function br(c,h){var f=g.identity([]);return g.translate(f,f,[1,1,0]),g.scale(f,f,[.5*c.width,.5*c.height,1]),g.multiply(f,f,c.calculatePosMatrix(h.toUnwrapped()))}function mr(c,h,f,v,S,T){var P=function(lt,Re,at){if(lt)for(var mt=0,Wt=lt;mt<Wt.length;mt+=1){var vr=Re[Wt[mt]];if(vr&&vr.source===at&&vr.type==="fill-extrusion")return!0}else for(var ur in Re){var hr=Re[ur];if(hr.source===at&&hr.type==="fill-extrusion")return!0}return!1}(S&&S.layers,h,c.id),D=T.maxPitchScaleFactor(),G=c.tilesIn(v,D,P);G.sort(An);for(var Q=[],ge=0,Ee=G;ge<Ee.length;ge+=1){var Se=Ee[ge];Q.push({wrappedTileID:Se.tileID.wrapped().key,queryResults:Se.tile.queryRenderedFeatures(h,f,c._state,Se.queryGeometry,Se.cameraQueryGeometry,Se.scale,S,T,D,br(c.transform,Se.tileID))})}var We=function(lt){for(var Re={},at={},mt=0,Wt=lt;mt<Wt.length;mt+=1){var vr=Wt[mt],ur=vr.queryResults,hr=vr.wrappedTileID,Lr=at[hr]=at[hr]||{};for(var Jr in ur)for(var Yr=ur[Jr],yn=Lr[Jr]=Lr[Jr]||{},Jn=Re[Jr]=Re[Jr]||[],ei=0,ni=Yr;ei<ni.length;ei+=1){var Wi=ni[ei];yn[Wi.featureIndex]||(yn[Wi.featureIndex]=!0,Jn.push(Wi))}}return Re}(Q);for(var je in We)We[je].forEach(function(lt){var Re=lt.feature,at=c.getFeatureState(Re.layer["source-layer"],Re.id);Re.source=Re.layer.source,Re.layer["source-layer"]&&(Re.sourceLayer=Re.layer["source-layer"]),Re.state=at});return We}function An(c,h){var f=c.tileID,v=h.tileID;return f.overscaledZ-v.overscaledZ||f.canonical.y-v.canonical.y||f.wrap-v.wrap||f.canonical.x-v.canonical.x}var mn=function(c,h){this.max=c,this.onRemove=h,this.reset()};mn.prototype.reset=function(){for(var c in this.data)for(var h=0,f=this.data[c];h<f.length;h+=1){var v=f[h];v.timeout&&clearTimeout(v.timeout),this.onRemove(v.value)}return this.data={},this.order=[],this},mn.prototype.add=function(c,h,f){var v=this,S=c.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var T={value:h,timeout:void 0};if(f!==void 0&&(T.timeout=setTimeout(function(){v.remove(c,T)},f)),this.data[S].push(T),this.order.push(S),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},mn.prototype.has=function(c){return c.wrapped().key in this.data},mn.prototype.getAndRemove=function(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null},mn.prototype._getAndRemoveByKey=function(c){var h=this.data[c].shift();return h.timeout&&clearTimeout(h.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),h.value},mn.prototype.getByKey=function(c){var h=this.data[c];return h?h[0].value:null},mn.prototype.get=function(c){return this.has(c)?this.data[c.wrapped().key][0].value:null},mn.prototype.remove=function(c,h){if(!this.has(c))return this;var f=c.wrapped().key,v=h===void 0?0:this.data[f].indexOf(h),S=this.data[f][v];return this.data[f].splice(v,1),S.timeout&&clearTimeout(S.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(S.value),this.order.splice(this.order.indexOf(f),1),this},mn.prototype.setMaxSize=function(c){for(this.max=c;this.order.length>this.max;){var h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this},mn.prototype.filter=function(c){var h=[];for(var f in this.data)for(var v=0,S=this.data[f];v<S.length;v+=1){var T=S[v];c(T.value)||h.push(T)}for(var P=0,D=h;P<D.length;P+=1){var G=D[P];this.remove(G.value.tileID,G)}};var wn=function(c,h,f){this.context=c;var v=c.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(f),this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};wn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},wn.prototype.updateData=function(c){var h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)},wn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ri={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Qn=function(c,h,f,v){this.length=h.length,this.attributes=f,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.context=c;var S=c.gl;this.buffer=S.createBuffer(),c.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};Qn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Qn.prototype.updateData=function(c){var h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,c.arrayBuffer)},Qn.prototype.enableAttributes=function(c,h){for(var f=0;f<this.attributes.length;f++){var v=h.attributes[this.attributes[f].name];v!==void 0&&c.enableVertexAttribArray(v)}},Qn.prototype.setVertexAttribPointers=function(c,h,f){for(var v=0;v<this.attributes.length;v++){var S=this.attributes[v],T=h.attributes[S.name];T!==void 0&&c.vertexAttribPointer(T,S.components,c[Ri[S.type]],!1,this.itemSize,S.offset+this.itemSize*(f||0))}},Qn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ii=function(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ii.prototype.get=function(){return this.current},ii.prototype.set=function(c){},ii.prototype.getDefault=function(){return this.default},ii.prototype.setDefault=function(){this.set(this.default)};var Vi=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return g.Color.transparent},h.prototype.set=function(f){var v=this.current;(f.r!==v.r||f.g!==v.g||f.b!==v.b||f.a!==v.a||this.dirty)&&(this.gl.clearColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},h}(ii),Ni=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 1},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearDepth(f),this.current=f,this.dirty=!1)},h}(ii),ai=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.clearStencil(f),this.current=f,this.dirty=!1)},h}(ii),Vn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return[!0,!0,!0,!0]},h.prototype.set=function(f){var v=this.current;(f[0]!==v[0]||f[1]!==v[1]||f[2]!==v[2]||f[3]!==v[3]||this.dirty)&&(this.gl.colorMask(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},h}(ii),Yn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthMask(f),this.current=f,this.dirty=!1)},h}(ii),Li=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 255},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.stencilMask(f),this.current=f,this.dirty=!1)},h}(ii),ra=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},h.prototype.set=function(f){var v=this.current;(f.func!==v.func||f.ref!==v.ref||f.mask!==v.mask||this.dirty)&&(this.gl.stencilFunc(f.func,f.ref,f.mask),this.current=f,this.dirty=!1)},h}(ii),ri=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[f.KEEP,f.KEEP,f.KEEP]},h.prototype.set=function(f){var v=this.current;(f[0]!==v[0]||f[1]!==v[1]||f[2]!==v[2]||this.dirty)&&(this.gl.stencilOp(f[0],f[1],f[2]),this.current=f,this.dirty=!1)},h}(ii),Et=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var v=this.gl;f?v.enable(v.STENCIL_TEST):v.disable(v.STENCIL_TEST),this.current=f,this.dirty=!1}},h}(ii),de=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return[0,1]},h.prototype.set=function(f){var v=this.current;(f[0]!==v[0]||f[1]!==v[1]||this.dirty)&&(this.gl.depthRange(f[0],f[1]),this.current=f,this.dirty=!1)},h}(ii),V=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var v=this.gl;f?v.enable(v.DEPTH_TEST):v.disable(v.DEPTH_TEST),this.current=f,this.dirty=!1}},h}(ii),X=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.LESS},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.depthFunc(f),this.current=f,this.dirty=!1)},h}(ii),k=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var v=this.gl;f?v.enable(v.BLEND):v.disable(v.BLEND),this.current=f,this.dirty=!1}},h}(ii),Ce=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[f.ONE,f.ZERO]},h.prototype.set=function(f){var v=this.current;(f[0]!==v[0]||f[1]!==v[1]||this.dirty)&&(this.gl.blendFunc(f[0],f[1]),this.current=f,this.dirty=!1)},h}(ii),et=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return g.Color.transparent},h.prototype.set=function(f){var v=this.current;(f.r!==v.r||f.g!==v.g||f.b!==v.b||f.a!==v.a||this.dirty)&&(this.gl.blendColor(f.r,f.g,f.b,f.a),this.current=f,this.dirty=!1)},h}(ii),Qt=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.FUNC_ADD},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.blendEquation(f),this.current=f,this.dirty=!1)},h}(ii),Oe=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var v=this.gl;f?v.enable(v.CULL_FACE):v.disable(v.CULL_FACE),this.current=f,this.dirty=!1}},h}(ii),$e=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.BACK},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.cullFace(f),this.current=f,this.dirty=!1)},h}(ii),Ht=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.CCW},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.frontFace(f),this.current=f,this.dirty=!1)},h}(ii),or=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)},h}(ii),pr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return this.gl.TEXTURE0},h.prototype.set=function(f){(f!==this.current||this.dirty)&&(this.gl.activeTexture(f),this.current=f,this.dirty=!1)},h}(ii),xr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){var f=this.gl;return[0,0,f.drawingBufferWidth,f.drawingBufferHeight]},h.prototype.set=function(f){var v=this.current;(f[0]!==v[0]||f[1]!==v[1]||f[2]!==v[2]||f[3]!==v[3]||this.dirty)&&(this.gl.viewport(f[0],f[1],f[2],f[3]),this.current=f,this.dirty=!1)},h}(ii),Qr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var v=this.gl;v.bindFramebuffer(v.FRAMEBUFFER,f),this.current=f,this.dirty=!1}},h}(ii),en=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var v=this.gl;v.bindRenderbuffer(v.RENDERBUFFER,f),this.current=f,this.dirty=!1}},h}(ii),Dr=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var v=this.gl;v.bindTexture(v.TEXTURE_2D,f),this.current=f,this.dirty=!1}},h}(ii),Wn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){if(f!==this.current||this.dirty){var v=this.gl;v.bindBuffer(v.ARRAY_BUFFER,f),this.current=f,this.dirty=!1}},h}(ii),qn=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){var v=this.gl;v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,f),this.current=f,this.dirty=!1},h}(ii),ta=function(c){function h(f){c.call(this,f),this.vao=f.extVertexArrayObject}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h.prototype.set=function(f){this.vao&&(f!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(f),this.current=f,this.dirty=!1)},h}(ii),na=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return 4},h.prototype.set=function(f){if(f!==this.current||this.dirty){var v=this.gl;v.pixelStorei(v.UNPACK_ALIGNMENT,f),this.current=f,this.dirty=!1}},h}(ii),ba=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var v=this.gl;v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f),this.current=f,this.dirty=!1}},h}(ii),ia=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return!1},h.prototype.set=function(f){if(f!==this.current||this.dirty){var v=this.gl;v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,f),this.current=f,this.dirty=!1}},h}(ii),Ki=function(c){function h(f,v){c.call(this,f),this.context=f,this.parent=v}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getDefault=function(){return null},h}(ii),$=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.setDirty=function(){this.dirty=!0},h.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var v=this.gl;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,f,0),this.current=f,this.dirty=!1}},h}(Ki),ue=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.set=function(f){if(f!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var v=this.gl;v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,f),this.current=f,this.dirty=!1}},h}(Ki),ve=function(c,h,f,v){this.context=c,this.width=h,this.height=f;var S=this.framebuffer=c.gl.createFramebuffer();this.colorAttachment=new $(c,S),v&&(this.depthAttachment=new ue(c,S))};ve.prototype.destroy=function(){var c=this.context.gl,h=this.colorAttachment.get();if(h&&c.deleteTexture(h),this.depthAttachment){var f=this.depthAttachment.get();f&&c.deleteRenderbuffer(f)}c.deleteFramebuffer(this.framebuffer)};var Te=function(c,h,f){this.func=c,this.mask=h,this.range=f};Te.ReadOnly=!1,Te.ReadWrite=!0,Te.disabled=new Te(519,Te.ReadOnly,[0,1]);var Ze=function(c,h,f,v,S,T){this.test=c,this.ref=h,this.mask=f,this.fail=v,this.depthFail=S,this.pass=T};Ze.disabled=new Ze({func:519,mask:0},0,0,7680,7680,7680);var it=function(c,h,f){this.blendFunction=c,this.blendColor=h,this.mask=f};it.disabled=new it(it.Replace=[1,0],g.Color.transparent,[!1,!1,!1,!1]),it.unblended=new it(it.Replace,g.Color.transparent,[!0,!0,!0,!0]),it.alphaBlended=new it([1,771],g.Color.transparent,[!0,!0,!0,!0]);var gt=function(c,h,f){this.enable=c,this.mode=h,this.frontFace=f};gt.disabled=new gt(!1,1029,2305),gt.backCCW=new gt(!0,1029,2305);var be=function(c){this.gl=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Vi(this),this.clearDepth=new Ni(this),this.clearStencil=new ai(this),this.colorMask=new Vn(this),this.depthMask=new Yn(this),this.stencilMask=new Li(this),this.stencilFunc=new ra(this),this.stencilOp=new ri(this),this.stencilTest=new Et(this),this.depthRange=new de(this),this.depthTest=new V(this),this.depthFunc=new X(this),this.blend=new k(this),this.blendFunc=new Ce(this),this.blendColor=new et(this),this.blendEquation=new Qt(this),this.cullFace=new Oe(this),this.cullFaceSide=new $e(this),this.frontFace=new Ht(this),this.program=new or(this),this.activeTexture=new pr(this),this.viewport=new xr(this),this.bindFramebuffer=new Qr(this),this.bindRenderbuffer=new en(this),this.bindTexture=new Dr(this),this.bindVertexBuffer=new Wn(this),this.bindElementBuffer=new qn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ta(this),this.pixelStoreUnpack=new na(this),this.pixelStoreUnpackPremultiplyAlpha=new ba(this),this.pixelStoreUnpackFlipY=new ia(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(c.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)};be.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},be.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},be.prototype.createIndexBuffer=function(c,h){return new wn(this,c,h)},be.prototype.createVertexBuffer=function(c,h,f){return new Qn(this,c,h,f)},be.prototype.createRenderbuffer=function(c,h,f){var v=this.gl,S=v.createRenderbuffer();return this.bindRenderbuffer.set(S),v.renderbufferStorage(v.RENDERBUFFER,c,h,f),this.bindRenderbuffer.set(null),S},be.prototype.createFramebuffer=function(c,h,f){return new ve(this,c,h,f)},be.prototype.clear=function(c){var h=c.color,f=c.depth,v=this.gl,S=0;h&&(S|=v.COLOR_BUFFER_BIT,this.clearColor.set(h),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(S|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),v.clear(S)},be.prototype.setCullFace=function(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))},be.prototype.setDepthMode=function(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)},be.prototype.setStencilMode=function(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)},be.prototype.setColorMode=function(c){g.deepEqual(c.blendFunction,it.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)},be.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ye=function(c){function h(f,v,S){var T=this;c.call(this),this.id=f,this.dispatcher=S,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(T._sourceLoaded=!0),T._sourceLoaded&&!T._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(T.reload(),T.transform&&T.update(T.transform))}),this.on("error",function(){T._sourceErrored=!0}),this._source=function(P,D,G,Q){var ge=new bt[D.type](P,D,G,Q);if(ge.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+ge.id);return g.bindAll(["load","abort","unload","serialize","prepare"],ge),ge}(f,v,S,this),this._tiles={},this._cache=new mn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new g.SourceFeatureState}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.onAdd=function(f){this.map=f,this._maxTileCacheSize=f?f._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(f)},h.prototype.onRemove=function(f){this._source&&this._source.onRemove&&this._source.onRemove(f)},h.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var f in this._tiles){var v=this._tiles[f];if(v.state!=="loaded"&&v.state!=="errored")return!1}return!0},h.prototype.getSource=function(){return this._source},h.prototype.pause=function(){this._paused=!0},h.prototype.resume=function(){if(this._paused){var f=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,f&&this.reload(),this.transform&&this.update(this.transform)}},h.prototype._loadTile=function(f,v){return this._source.loadTile(f,v)},h.prototype._unloadTile=function(f){if(this._source.unloadTile)return this._source.unloadTile(f,function(){})},h.prototype._abortTile=function(f){if(this._source.abortTile)return this._source.abortTile(f,function(){})},h.prototype.serialize=function(){return this._source.serialize()},h.prototype.prepare=function(f){for(var v in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[v];S.upload(f),S.prepare(this.map.style.imageManager)}},h.prototype.getIds=function(){return g.values(this._tiles).map(function(f){return f.tileID}).sort(jt).map(function(f){return f.key})},h.prototype.getRenderableIds=function(f){var v=this,S=[];for(var T in this._tiles)this._isIdRenderable(T,f)&&S.push(this._tiles[T]);return f?S.sort(function(P,D){var G=P.tileID,Q=D.tileID,ge=new g.Point(G.canonical.x,G.canonical.y)._rotate(v.transform.angle),Ee=new g.Point(Q.canonical.x,Q.canonical.y)._rotate(v.transform.angle);return G.overscaledZ-Q.overscaledZ||Ee.y-ge.y||Ee.x-ge.x}).map(function(P){return P.tileID.key}):S.map(function(P){return P.tileID}).sort(jt).map(function(P){return P.key})},h.prototype.hasRenderableParent=function(f){var v=this.findLoadedParent(f,0);return!!v&&this._isIdRenderable(v.tileID.key)},h.prototype._isIdRenderable=function(f,v){return this._tiles[f]&&this._tiles[f].hasData()&&!this._coveredTiles[f]&&(v||!this._tiles[f].holdingForFade())},h.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var f in this._cache.reset(),this._tiles)this._tiles[f].state!=="errored"&&this._reloadTile(f,"reloading")},h.prototype._reloadTile=function(f,v){var S=this._tiles[f];S&&(S.state!=="loading"&&(S.state=v),this._loadTile(S,this._tileLoaded.bind(this,S,f,v)))},h.prototype._tileLoaded=function(f,v,S,T){if(T)return f.state="errored",void(T.status!==404?this._source.fire(new g.ErrorEvent(T,{tile:f})):this.update(this.transform));f.timeAdded=g.browser.now(),S==="expired"&&(f.refreshedUponExpiration=!0),this._setTileReloadTimer(v,f),this.getSource().type==="raster-dem"&&f.dem&&this._backfillDEM(f),this._state.initializeTileState(f,this.map?this.map.painter:null),this._source.fire(new g.Event("data",{dataType:"source",tile:f,coord:f.tileID}))},h.prototype._backfillDEM=function(f){for(var v=this.getRenderableIds(),S=0;S<v.length;S++){var T=v[S];if(f.neighboringTiles&&f.neighboringTiles[T]){var P=this.getTileByID(T);D(f,P),D(P,f)}}function D(G,Q){G.needsHillshadePrepare=!0;var ge=Q.tileID.canonical.x-G.tileID.canonical.x,Ee=Q.tileID.canonical.y-G.tileID.canonical.y,Se=Math.pow(2,G.tileID.canonical.z),We=Q.tileID.key;ge===0&&Ee===0||Math.abs(Ee)>1||(Math.abs(ge)>1&&(Math.abs(ge+Se)===1?ge+=Se:Math.abs(ge-Se)===1&&(ge-=Se)),Q.dem&&G.dem&&(G.dem.backfillBorder(Q.dem,ge,Ee),G.neighboringTiles&&G.neighboringTiles[We]&&(G.neighboringTiles[We].backfilled=!0)))}},h.prototype.getTile=function(f){return this.getTileByID(f.key)},h.prototype.getTileByID=function(f){return this._tiles[f]},h.prototype._retainLoadedChildren=function(f,v,S,T){for(var P in this._tiles){var D=this._tiles[P];if(!(T[P]||!D.hasData()||D.tileID.overscaledZ<=v||D.tileID.overscaledZ>S)){for(var G=D.tileID;D&&D.tileID.overscaledZ>v+1;){var Q=D.tileID.scaledTo(D.tileID.overscaledZ-1);(D=this._tiles[Q.key])&&D.hasData()&&(G=Q)}for(var ge=G;ge.overscaledZ>v;)if(f[(ge=ge.scaledTo(ge.overscaledZ-1)).key]){T[G.key]=G;break}}}},h.prototype.findLoadedParent=function(f,v){if(f.key in this._loadedParentTiles){var S=this._loadedParentTiles[f.key];return S&&S.tileID.overscaledZ>=v?S:null}for(var T=f.overscaledZ-1;T>=v;T--){var P=f.scaledTo(T),D=this._getLoadedTile(P);if(D)return D}},h.prototype._getLoadedTile=function(f){var v=this._tiles[f.key];return v&&v.hasData()?v:this._cache.getByKey(f.wrapped().key)},h.prototype.updateCacheSize=function(f){var v=Math.ceil(f.width/this._source.tileSize)+1,S=Math.ceil(f.height/this._source.tileSize)+1,T=Math.floor(v*S*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(P)},h.prototype.handleWrapJump=function(f){var v=Math.round((f-(this._prevLng===void 0?f:this._prevLng))/360);if(this._prevLng=f,v){var S={};for(var T in this._tiles){var P=this._tiles[T];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+v),S[P.tileID.key]=P}for(var D in this._tiles=S,this._timers)clearTimeout(this._timers[D]),delete this._timers[D];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},h.prototype.update=function(f){var v=this;if(this.transform=f,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(f),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=f.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Lr){return new g.OverscaledTileID(Lr.canonical.z,Lr.wrap,Lr.canonical.z,Lr.canonical.x,Lr.canonical.y)}):(S=f.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(Lr){return v._source.hasTile(Lr)}))):S=[];var T=f.coveringZoomLevel(this._source),P=Math.max(T-h.maxOverzooming,this._source.minzoom),D=Math.max(T+h.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(S,T);if(Ir(this._source.type)){for(var Q={},ge={},Ee=0,Se=Object.keys(G);Ee<Se.length;Ee+=1){var We=Se[Ee],je=G[We],lt=this._tiles[We];if(lt&&!(lt.fadeEndTime&&lt.fadeEndTime<=g.browser.now())){var Re=this.findLoadedParent(je,P);Re&&(this._addTile(Re.tileID),Q[Re.tileID.key]=Re.tileID),ge[We]=je}}for(var at in this._retainLoadedChildren(ge,T,D,G),Q)G[at]||(this._coveredTiles[at]=!0,G[at]=Q[at])}for(var mt in G)this._tiles[mt].clearFadeHold();for(var Wt=0,vr=g.keysDifference(this._tiles,G);Wt<vr.length;Wt+=1){var ur=vr[Wt],hr=this._tiles[ur];hr.hasSymbolBuckets&&!hr.holdingForFade()?hr.setHoldDuration(this.map._fadeDuration):hr.hasSymbolBuckets&&!hr.symbolFadeFinished()||this._removeTile(ur)}this._updateLoadedParentTileCache()}},h.prototype.releaseSymbolFadeTiles=function(){for(var f in this._tiles)this._tiles[f].holdingForFade()&&this._removeTile(f)},h.prototype._updateRetainedTiles=function(f,v){for(var S={},T={},P=Math.max(v-h.maxOverzooming,this._source.minzoom),D=Math.max(v+h.maxUnderzooming,this._source.minzoom),G={},Q=0,ge=f;Q<ge.length;Q+=1){var Ee=ge[Q],Se=this._addTile(Ee);S[Ee.key]=Ee,Se.hasData()||v<this._source.maxzoom&&(G[Ee.key]=Ee)}this._retainLoadedChildren(G,v,D,S);for(var We=0,je=f;We<je.length;We+=1){var lt=je[We],Re=this._tiles[lt.key];if(!Re.hasData()){if(v+1>this._source.maxzoom){var at=lt.children(this._source.maxzoom)[0],mt=this.getTile(at);if(mt&&mt.hasData()){S[at.key]=at;continue}}else{var Wt=lt.children(this._source.maxzoom);if(S[Wt[0].key]&&S[Wt[1].key]&&S[Wt[2].key]&&S[Wt[3].key])continue}for(var vr=Re.wasRequested(),ur=lt.overscaledZ-1;ur>=P;--ur){var hr=lt.scaledTo(ur);if(T[hr.key]||(T[hr.key]=!0,!(Re=this.getTile(hr))&&vr&&(Re=this._addTile(hr)),Re&&(S[hr.key]=hr,vr=Re.wasRequested(),Re.hasData())))break}}}return S},h.prototype._updateLoadedParentTileCache=function(){for(var f in this._loadedParentTiles={},this._tiles){for(var v=[],S=void 0,T=this._tiles[f].tileID;T.overscaledZ>0;){if(T.key in this._loadedParentTiles){S=this._loadedParentTiles[T.key];break}v.push(T.key);var P=T.scaledTo(T.overscaledZ-1);if(S=this._getLoadedTile(P))break;T=P}for(var D=0,G=v;D<G.length;D+=1)this._loadedParentTiles[G[D]]=S}},h.prototype._addTile=function(f){var v=this._tiles[f.key];if(v)return v;(v=this._cache.getAndRemove(f))&&(this._setTileReloadTimer(f.key,v),v.tileID=f,this._state.initializeTileState(v,this.map?this.map.painter:null),this._cacheTimers[f.key]&&(clearTimeout(this._cacheTimers[f.key]),delete this._cacheTimers[f.key],this._setTileReloadTimer(f.key,v)));var S=Boolean(v);return S||(v=new g.Tile(f,this._source.tileSize*f.overscaleFactor()),this._loadTile(v,this._tileLoaded.bind(this,v,f.key,v.state))),v?(v.uses++,this._tiles[f.key]=v,S||this._source.fire(new g.Event("dataloading",{tile:v,coord:v.tileID,dataType:"source"})),v):null},h.prototype._setTileReloadTimer=function(f,v){var S=this;f in this._timers&&(clearTimeout(this._timers[f]),delete this._timers[f]);var T=v.getExpiryTimeout();T&&(this._timers[f]=setTimeout(function(){S._reloadTile(f,"expired"),delete S._timers[f]},T))},h.prototype._removeTile=function(f){var v=this._tiles[f];v&&(v.uses--,delete this._tiles[f],this._timers[f]&&(clearTimeout(this._timers[f]),delete this._timers[f]),v.uses>0||(v.hasData()&&v.state!=="reloading"?this._cache.add(v.tileID,v,v.getExpiryTimeout()):(v.aborted=!0,this._abortTile(v),this._unloadTile(v))))},h.prototype.clearTiles=function(){for(var f in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(f);this._cache.reset()},h.prototype.tilesIn=function(f,v,S){var T=this,P=[],D=this.transform;if(!D)return P;for(var G=S?D.getCameraQueryGeometry(f):f,Q=f.map(function(ur){return D.pointCoordinate(ur)}),ge=G.map(function(ur){return D.pointCoordinate(ur)}),Ee=this.getIds(),Se=1/0,We=1/0,je=-1/0,lt=-1/0,Re=0,at=ge;Re<at.length;Re+=1){var mt=at[Re];Se=Math.min(Se,mt.x),We=Math.min(We,mt.y),je=Math.max(je,mt.x),lt=Math.max(lt,mt.y)}for(var Wt=function(ur){var hr=T._tiles[Ee[ur]];if(!hr.holdingForFade()){var Lr=hr.tileID,Jr=Math.pow(2,D.zoom-hr.tileID.overscaledZ),Yr=v*hr.queryPadding*g.EXTENT/hr.tileSize/Jr,yn=[Lr.getTilePoint(new g.MercatorCoordinate(Se,We)),Lr.getTilePoint(new g.MercatorCoordinate(je,lt))];if(yn[0].x-Yr<g.EXTENT&&yn[0].y-Yr<g.EXTENT&&yn[1].x+Yr>=0&&yn[1].y+Yr>=0){var Jn=Q.map(function(ni){return Lr.getTilePoint(ni)}),ei=ge.map(function(ni){return Lr.getTilePoint(ni)});P.push({tile:hr,tileID:Lr,queryGeometry:Jn,cameraQueryGeometry:ei,scale:Jr})}}},vr=0;vr<Ee.length;vr++)Wt(vr);return P},h.prototype.getVisibleCoordinates=function(f){for(var v=this,S=this.getRenderableIds(f).map(function(G){return v._tiles[G].tileID}),T=0,P=S;T<P.length;T+=1){var D=P[T];D.posMatrix=this.transform.calculatePosMatrix(D.toUnwrapped())}return S},h.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Ir(this._source.type))for(var f in this._tiles){var v=this._tiles[f];if(v.fadeEndTime!==void 0&&v.fadeEndTime>=g.browser.now())return!0}return!1},h.prototype.setFeatureState=function(f,v,S){this._state.updateState(f=f||"_geojsonTileLayer",v,S)},h.prototype.removeFeatureState=function(f,v,S){this._state.removeFeatureState(f=f||"_geojsonTileLayer",v,S)},h.prototype.getFeatureState=function(f,v){return this._state.getState(f=f||"_geojsonTileLayer",v)},h.prototype.setDependencies=function(f,v,S){var T=this._tiles[f];T&&T.setDependencies(v,S)},h.prototype.reloadTilesForDependencies=function(f,v){for(var S in this._tiles)this._tiles[S].hasDependency(f,v)&&this._reloadTile(S,"reloading");this._cache.filter(function(T){return!T.hasDependency(f,v)})},h}(g.Evented);function jt(c,h){var f=Math.abs(2*c.wrap)-+(c.wrap<0),v=Math.abs(2*h.wrap)-+(h.wrap<0);return c.overscaledZ-h.overscaledZ||v-f||h.canonical.y-c.canonical.y||h.canonical.x-c.canonical.x}function Ir(c){return c==="raster"||c==="image"||c==="video"}function sr(){return new g.window.Worker(mc.workerUrl)}Ye.maxOverzooming=10,Ye.maxUnderzooming=3;var cr="mapboxgl_preloaded_worker_pool",Rr=function(){this.active={}};Rr.prototype.acquire=function(c){if(!this.workers)for(this.workers=[];this.workers.length<Rr.workerCount;)this.workers.push(new sr);return this.active[c]=!0,this.workers.slice()},Rr.prototype.release=function(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(function(h){h.terminate()}),this.workers=null)},Rr.prototype.isPreloaded=function(){return!!this.active[cr]},Rr.prototype.numActive=function(){return Object.keys(this.active).length};var zn,Tn=Math.floor(g.browser.hardwareConcurrency/2);function tr(){return zn||(zn=new Rr),zn}function _n(c,h){var f={};for(var v in c)v!=="ref"&&(f[v]=c[v]);return g.refProperties.forEach(function(S){S in h&&(f[S]=h[S])}),f}function rn(c){c=c.slice();for(var h=Object.create(null),f=0;f<c.length;f++)h[c[f].id]=c[f];for(var v=0;v<c.length;v++)"ref"in c[v]&&(c[v]=_n(c[v],h[c[v].ref]));return c}Rr.workerCount=Math.max(Math.min(Tn,6),1);var cn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function wi(c,h,f){f.push({command:cn.addSource,args:[c,h[c]]})}function gn(c,h,f){h.push({command:cn.removeSource,args:[c]}),f[c]=!0}function zi(c,h,f,v){gn(c,f,v),wi(c,h,f)}function ca(c,h,f){var v;for(v in c[f])if(c[f].hasOwnProperty(v)&&v!=="data"&&!g.deepEqual(c[f][v],h[f][v]))return!1;for(v in h[f])if(h[f].hasOwnProperty(v)&&v!=="data"&&!g.deepEqual(c[f][v],h[f][v]))return!1;return!0}function sn(c,h,f,v,S,T){var P;for(P in h=h||{},c=c||{})c.hasOwnProperty(P)&&(g.deepEqual(c[P],h[P])||f.push({command:T,args:[v,P,h[P],S]}));for(P in h)h.hasOwnProperty(P)&&!c.hasOwnProperty(P)&&(g.deepEqual(c[P],h[P])||f.push({command:T,args:[v,P,h[P],S]}))}function ki(c){return c.id}function Pi(c,h){return c[h.id]=h,c}var vi=function(c,h){this.reset(c,h)};vi.prototype.reset=function(c,h){this.points=c||[],this._distances=[0];for(var f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding},vi.prototype.lerp=function(c){if(this.points.length===1)return this.points[0];c=g.clamp(c,0,1);for(var h=1,f=this._distances[h],v=c*this.paddedLength+this.padding;f<v&&h<this._distances.length;)f=this._distances[++h];var S=h-1,T=this._distances[S],P=f-T,D=P>0?(v-T)/P:0;return this.points[S].mult(1-D).add(this.points[h].mult(D))};var Ji=function(c,h,f){var v=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/f),this.yCellCount=Math.ceil(h/f);for(var T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=h,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function qt(c,h,f,v,S){var T=g.create();return h?(g.scale(T,T,[1/S,1/S,1]),f||g.rotateZ(T,T,v.angle)):g.multiply(T,v.labelPlaneMatrix,c),T}function Gt(c,h,f,v,S){if(h){var T=g.clone(c);return g.scale(T,T,[S,S,1]),f||g.rotateZ(T,T,-v.angle),T}return v.glCoordMatrix}function ji(c,h){var f=[c.x,c.y,0,1];Na(f,f,h);var v=f[3];return{point:new g.Point(f[0]/v,f[1]/v),signedDistanceFromCamera:v}}function Hi(c,h){return .5+c/h*.5}function Pa(c,h){var f=c[0]/c[3],v=c[1]/c[3];return f>=-h[0]&&f<=h[0]&&v>=-h[1]&&v<=h[1]}function so(c,h,f,v,S,T,P,D){var G=v?c.textSizeData:c.iconSizeData,Q=g.evaluateSizeForZoom(G,f.transform.zoom),ge=[256/f.width*2+1,256/f.height*2+1],Ee=v?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Ee.clear();for(var Se=c.lineVertexArray,We=v?c.text.placedSymbolArray:c.icon.placedSymbolArray,je=f.transform.width/f.transform.height,lt=!1,Re=0;Re<We.length;Re++){var at=We.get(Re);if(at.hidden||at.writingMode===g.WritingMode.vertical&&!lt)he(at.numGlyphs,Ee);else{lt=!1;var mt=[at.anchorX,at.anchorY,0,1];if(g.transformMat4(mt,mt,h),Pa(mt,ge)){var Wt=Hi(f.transform.cameraToCenterDistance,mt[3]),vr=g.evaluateSizeForFeature(G,Q,at),ur=P?vr/Wt:vr*Wt,hr=new g.Point(at.anchorX,at.anchorY),Lr=ji(hr,S).point,Jr={},Yr=Wr(at,ur,!1,D,h,S,T,c.glyphOffsetArray,Se,Ee,Lr,hr,Jr,je);lt=Yr.useVertical,(Yr.notEnoughRoom||lt||Yr.needsFlipping&&Wr(at,ur,!0,D,h,S,T,c.glyphOffsetArray,Se,Ee,Lr,hr,Jr,je).notEnoughRoom)&&he(at.numGlyphs,Ee)}else he(at.numGlyphs,Ee)}}v?c.text.dynamicLayoutVertexBuffer.updateData(Ee):c.icon.dynamicLayoutVertexBuffer.updateData(Ee)}function Fa(c,h,f,v,S,T,P,D,G,Q,ge){var Ee=D.glyphStartIndex+D.numGlyphs,Se=D.lineStartIndex,We=D.lineStartIndex+D.lineLength,je=h.getoffsetX(D.glyphStartIndex),lt=h.getoffsetX(Ee-1),Re=yt(c*je,f,v,S,T,P,D.segment,Se,We,G,Q,ge);if(!Re)return null;var at=yt(c*lt,f,v,S,T,P,D.segment,Se,We,G,Q,ge);return at?{first:Re,last:at}:null}function Ea(c,h,f,v){return c===g.WritingMode.horizontal&&Math.abs(f.y-h.y)>Math.abs(f.x-h.x)*v?{useVertical:!0}:(c===g.WritingMode.vertical?h.y<f.y:h.x>f.x)?{needsFlipping:!0}:null}function Wr(c,h,f,v,S,T,P,D,G,Q,ge,Ee,Se,We){var je,lt=h/24,Re=c.lineOffsetX*lt,at=c.lineOffsetY*lt;if(c.numGlyphs>1){var mt=c.glyphStartIndex+c.numGlyphs,Wt=c.lineStartIndex,vr=c.lineStartIndex+c.lineLength,ur=Fa(lt,D,Re,at,f,ge,Ee,c,G,T,Se);if(!ur)return{notEnoughRoom:!0};var hr=ji(ur.first.point,P).point,Lr=ji(ur.last.point,P).point;if(v&&!f){var Jr=Ea(c.writingMode,hr,Lr,We);if(Jr)return Jr}je=[ur.first];for(var Yr=c.glyphStartIndex+1;Yr<mt-1;Yr++)je.push(yt(lt*D.getoffsetX(Yr),Re,at,f,ge,Ee,c.segment,Wt,vr,G,T,Se));je.push(ur.last)}else{if(v&&!f){var yn=ji(Ee,S).point,Jn=c.lineStartIndex+c.segment+1,ei=new g.Point(G.getx(Jn),G.gety(Jn)),ni=ji(ei,S),Wi=ni.signedDistanceFromCamera>0?ni.point:Hr(Ee,ei,yn,1,S),bn=Ea(c.writingMode,yn,Wi,We);if(bn)return bn}var pi=yt(lt*D.getoffsetX(c.glyphStartIndex),Re,at,f,ge,Ee,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,G,T,Se);if(!pi)return{notEnoughRoom:!0};je=[pi]}for(var Ti=0,mi=je;Ti<mi.length;Ti+=1){var ui=mi[Ti];g.addDynamicAttributes(Q,ui.point,ui.angle)}return{}}function Hr(c,h,f,v,S){var T=ji(c.add(c.sub(h)._unit()),S).point,P=f.sub(T);return f.add(P._mult(v/P.mag()))}function yt(c,h,f,v,S,T,P,D,G,Q,ge,Ee){var Se=v?c-h:c+h,We=Se>0?1:-1,je=0;v&&(We*=-1,je=Math.PI),We<0&&(je+=Math.PI);for(var lt=We>0?D+P:D+P+1,Re=S,at=S,mt=0,Wt=0,vr=Math.abs(Se),ur=[];mt+Wt<=vr;){if((lt+=We)<D||lt>=G)return null;if(at=Re,ur.push(Re),(Re=Ee[lt])===void 0){var hr=new g.Point(Q.getx(lt),Q.gety(lt)),Lr=ji(hr,ge);if(Lr.signedDistanceFromCamera>0)Re=Ee[lt]=Lr.point;else{var Jr=lt-We;Re=Hr(mt===0?T:new g.Point(Q.getx(Jr),Q.gety(Jr)),hr,at,vr-mt+1,ge)}}mt+=Wt,Wt=at.dist(Re)}var Yr=(vr-mt)/Wt,yn=Re.sub(at),Jn=yn.mult(Yr)._add(at);Jn._add(yn._unit()._perp()._mult(f*We));var ei=je+Math.atan2(Re.y-at.y,Re.x-at.x);return ur.push(Jn),{point:Jn,angle:ei,path:ur}}Ji.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ji.prototype.insert=function(c,h,f,v,S){this._forEachCell(h,f,v,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(S)},Ji.prototype.insertCircle=function(c,h,f,v){this._forEachCell(h-v,f-v,h+v,f+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(h),this.circles.push(f),this.circles.push(v)},Ji.prototype._insertBoxCell=function(c,h,f,v,S,T){this.boxCells[S].push(T)},Ji.prototype._insertCircleCell=function(c,h,f,v,S,T){this.circleCells[S].push(T)},Ji.prototype._query=function(c,h,f,v,S,T){if(f<0||c>this.width||v<0||h>this.height)return!S&&[];var P=[];if(c<=0&&h<=0&&this.width<=f&&this.height<=v){if(S)return!0;for(var D=0;D<this.boxKeys.length;D++)P.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(var G=0;G<this.circleKeys.length;G++){var Q=this.circles[3*G],ge=this.circles[3*G+1],Ee=this.circles[3*G+2];P.push({key:this.circleKeys[G],x1:Q-Ee,y1:ge-Ee,x2:Q+Ee,y2:ge+Ee})}return T?P.filter(T):P}return this._forEachCell(c,h,f,v,this._queryCell,P,{hitTest:S,seenUids:{box:{},circle:{}}},T),S?P.length>0:P},Ji.prototype._queryCircle=function(c,h,f,v,S){var T=c-f,P=c+f,D=h-f,G=h+f;if(P<0||T>this.width||G<0||D>this.height)return!v&&[];var Q=[];return this._forEachCell(T,D,P,G,this._queryCellCircle,Q,{hitTest:v,circle:{x:c,y:h,radius:f},seenUids:{box:{},circle:{}}},S),v?Q.length>0:Q},Ji.prototype.query=function(c,h,f,v,S){return this._query(c,h,f,v,!1,S)},Ji.prototype.hitTest=function(c,h,f,v,S){return this._query(c,h,f,v,!0,S)},Ji.prototype.hitTestCircle=function(c,h,f,v){return this._queryCircle(c,h,f,!0,v)},Ji.prototype._queryCell=function(c,h,f,v,S,T,P,D){var G=P.seenUids,Q=this.boxCells[S];if(Q!==null)for(var ge=this.bboxes,Ee=0,Se=Q;Ee<Se.length;Ee+=1){var We=Se[Ee];if(!G.box[We]){G.box[We]=!0;var je=4*We;if(c<=ge[je+2]&&h<=ge[je+3]&&f>=ge[je+0]&&v>=ge[je+1]&&(!D||D(this.boxKeys[We]))){if(P.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[We],x1:ge[je],y1:ge[je+1],x2:ge[je+2],y2:ge[je+3]})}}}var lt=this.circleCells[S];if(lt!==null)for(var Re=this.circles,at=0,mt=lt;at<mt.length;at+=1){var Wt=mt[at];if(!G.circle[Wt]){G.circle[Wt]=!0;var vr=3*Wt;if(this._circleAndRectCollide(Re[vr],Re[vr+1],Re[vr+2],c,h,f,v)&&(!D||D(this.circleKeys[Wt]))){if(P.hitTest)return T.push(!0),!0;var ur=Re[vr],hr=Re[vr+1],Lr=Re[vr+2];T.push({key:this.circleKeys[Wt],x1:ur-Lr,y1:hr-Lr,x2:ur+Lr,y2:hr+Lr})}}}},Ji.prototype._queryCellCircle=function(c,h,f,v,S,T,P,D){var G=P.circle,Q=P.seenUids,ge=this.boxCells[S];if(ge!==null)for(var Ee=this.bboxes,Se=0,We=ge;Se<We.length;Se+=1){var je=We[Se];if(!Q.box[je]){Q.box[je]=!0;var lt=4*je;if(this._circleAndRectCollide(G.x,G.y,G.radius,Ee[lt+0],Ee[lt+1],Ee[lt+2],Ee[lt+3])&&(!D||D(this.boxKeys[je])))return T.push(!0),!0}}var Re=this.circleCells[S];if(Re!==null)for(var at=this.circles,mt=0,Wt=Re;mt<Wt.length;mt+=1){var vr=Wt[mt];if(!Q.circle[vr]){Q.circle[vr]=!0;var ur=3*vr;if(this._circlesCollide(at[ur],at[ur+1],at[ur+2],G.x,G.y,G.radius)&&(!D||D(this.circleKeys[vr])))return T.push(!0),!0}}},Ji.prototype._forEachCell=function(c,h,f,v,S,T,P,D){for(var G=this._convertToXCellCoord(c),Q=this._convertToYCellCoord(h),ge=this._convertToXCellCoord(f),Ee=this._convertToYCellCoord(v),Se=G;Se<=ge;Se++)for(var We=Q;We<=Ee;We++)if(S.call(this,c,h,f,v,this.xCellCount*We+Se,T,P,D))return},Ji.prototype._convertToXCellCoord=function(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))},Ji.prototype._convertToYCellCoord=function(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))},Ji.prototype._circlesCollide=function(c,h,f,v,S,T){var P=v-c,D=S-h,G=f+T;return G*G>P*P+D*D},Ji.prototype._circleAndRectCollide=function(c,h,f,v,S,T,P){var D=(T-v)/2,G=Math.abs(c-(v+D));if(G>D+f)return!1;var Q=(P-S)/2,ge=Math.abs(h-(S+Q));if(ge>Q+f)return!1;if(G<=D||ge<=Q)return!0;var Ee=G-D,Se=ge-Q;return Ee*Ee+Se*Se<=f*f};var Bs=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function he(c,h){for(var f=0;f<c;f++){var v=h.length;h.resize(v+4),h.float32.set(Bs,3*v)}}function Na(c,h,f){var v=h[0],S=h[1];return c[0]=f[0]*v+f[4]*S+f[12],c[1]=f[1]*v+f[5]*S+f[13],c[3]=f[3]*v+f[7]*S+f[15],c}var Ya=function(c,h,f){h===void 0&&(h=new Ji(c.width+200,c.height+200,25)),f===void 0&&(f=new Ji(c.width+200,c.height+200,25)),this.transform=c,this.grid=h,this.ignoredGrid=f,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+100,this.screenBottomBoundary=c.height+100,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200};function oa(c,h,f){return h*(g.EXTENT/(c.tileSize*Math.pow(2,f-c.tileID.overscaledZ)))}Ya.prototype.placeCollisionBox=function(c,h,f,v,S){var T=this.projectAndGetPerspectiveRatio(v,c.anchorPointX,c.anchorPointY),P=f*T.perspectiveRatio,D=c.x1*P+T.point.x,G=c.y1*P+T.point.y,Q=c.x2*P+T.point.x,ge=c.y2*P+T.point.y;return!this.isInsideGrid(D,G,Q,ge)||!h&&this.grid.hitTest(D,G,Q,ge,S)?{box:[],offscreen:!1}:{box:[D,G,Q,ge],offscreen:this.isOffscreen(D,G,Q,ge)}},Ya.prototype.placeCollisionCircles=function(c,h,f,v,S,T,P,D,G,Q,ge,Ee,Se){var We=[],je=new g.Point(h.anchorX,h.anchorY),lt=ji(je,T),Re=Hi(this.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),at=(Q?S/Re:S*Re)/g.ONE_EM,mt=ji(je,P).point,Wt=Fa(at,v,h.lineOffsetX*at,h.lineOffsetY*at,!1,mt,je,h,f,P,{}),vr=!1,ur=!1,hr=!0;if(Wt){for(var Lr=.5*Ee*Re+Se,Jr=new g.Point(-100,-100),Yr=new g.Point(this.screenRightBoundary,this.screenBottomBoundary),yn=new vi,Jn=Wt.first,ei=Wt.last,ni=[],Wi=Jn.path.length-1;Wi>=1;Wi--)ni.push(Jn.path[Wi]);for(var bn=1;bn<ei.path.length;bn++)ni.push(ei.path[bn]);var pi=2.5*Lr;if(D){var Ti=ni.map(function(eu){return ji(eu,D)});ni=Ti.some(function(eu){return eu.signedDistanceFromCamera<=0})?[]:Ti.map(function(eu){return eu.point})}var mi=[];if(ni.length>0){for(var ui=ni[0].clone(),Oi=ni[0].clone(),fi=1;fi<ni.length;fi++)ui.x=Math.min(ui.x,ni[fi].x),ui.y=Math.min(ui.y,ni[fi].y),Oi.x=Math.max(Oi.x,ni[fi].x),Oi.y=Math.max(Oi.y,ni[fi].y);mi=ui.x>=Jr.x&&Oi.x<=Yr.x&&ui.y>=Jr.y&&Oi.y<=Yr.y?[ni]:Oi.x<Jr.x||ui.x>Yr.x||Oi.y<Jr.y||ui.y>Yr.y?[]:g.clipLine([ni],Jr.x,Jr.y,Yr.x,Yr.y)}for(var li=0,ho=mi;li<ho.length;li+=1){var Ga;yn.reset(ho[li],.25*Lr),Ga=yn.length<=.5*Lr?1:Math.ceil(yn.paddedLength/pi)+1;for(var Ro=0;Ro<Ga;Ro++){var Lo=Ro/Math.max(Ga-1,1),Qa=yn.lerp(Lo),po=Qa.x+100,Ja=Qa.y+100;We.push(po,Ja,Lr,0);var Wo=po-Lr,zu=Ja-Lr,hs=po+Lr,Xo=Ja+Lr;if(hr=hr&&this.isOffscreen(Wo,zu,hs,Xo),ur=ur||this.isInsideGrid(Wo,zu,hs,Xo),!c&&this.grid.hitTestCircle(po,Ja,Lr,ge)&&(vr=!0,!G))return{circles:[],offscreen:!1,collisionDetected:vr}}}}return{circles:!G&&vr||!ur?[]:We,offscreen:hr,collisionDetected:vr}},Ya.prototype.queryRenderedSymbols=function(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var h=[],f=1/0,v=1/0,S=-1/0,T=-1/0,P=0,D=c;P<D.length;P+=1){var G=D[P],Q=new g.Point(G.x+100,G.y+100);f=Math.min(f,Q.x),v=Math.min(v,Q.y),S=Math.max(S,Q.x),T=Math.max(T,Q.y),h.push(Q)}for(var ge={},Ee={},Se=0,We=this.grid.query(f,v,S,T).concat(this.ignoredGrid.query(f,v,S,T));Se<We.length;Se+=1){var je=We[Se],lt=je.key;if(ge[lt.bucketInstanceId]===void 0&&(ge[lt.bucketInstanceId]={}),!ge[lt.bucketInstanceId][lt.featureIndex]){var Re=[new g.Point(je.x1,je.y1),new g.Point(je.x2,je.y1),new g.Point(je.x2,je.y2),new g.Point(je.x1,je.y2)];g.polygonIntersectsPolygon(h,Re)&&(ge[lt.bucketInstanceId][lt.featureIndex]=!0,Ee[lt.bucketInstanceId]===void 0&&(Ee[lt.bucketInstanceId]=[]),Ee[lt.bucketInstanceId].push(lt.featureIndex))}}return Ee},Ya.prototype.insertCollisionBox=function(c,h,f,v,S){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:v,collisionGroupID:S},c[0],c[1],c[2],c[3])},Ya.prototype.insertCollisionCircles=function(c,h,f,v,S){for(var T=h?this.ignoredGrid:this.grid,P={bucketInstanceId:f,featureIndex:v,collisionGroupID:S},D=0;D<c.length;D+=4)T.insertCircle(P,c[D],c[D+1],c[D+2])},Ya.prototype.projectAndGetPerspectiveRatio=function(c,h,f){var v=[h,f,0,1];return Na(v,v,c),{point:new g.Point((v[0]/v[3]+1)/2*this.transform.width+100,(-v[1]/v[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}},Ya.prototype.isOffscreen=function(c,h,f,v){return f<100||c>=this.screenRightBoundary||v<100||h>this.screenBottomBoundary},Ya.prototype.isInsideGrid=function(c,h,f,v){return f>=0&&c<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary},Ya.prototype.getViewportMatrix=function(){var c=g.identity([]);return g.translate(c,c,[-100,-100,0]),c};var uo=function(c,h,f,v){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?h:-h))):v&&f?1:0,this.placed=f};uo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Co=function(c,h,f,v,S){this.text=new uo(c?c.text:null,h,f,S),this.icon=new uo(c?c.icon:null,h,v,S)};Co.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Ru=function(c,h,f){this.text=c,this.icon=h,this.skipFade=f},yo=function(){this.invProjMatrix=g.create(),this.viewportMatrix=g.create(),this.circles=[]},Ao=function(c,h,f,v,S){this.bucketInstanceId=c,this.featureIndex=h,this.sourceLayerIndex=f,this.bucketIndex=v,this.tileID=S},da=function(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}};function lo(c,h,f,v,S){var T=g.getAnchorAlignment(c),P=-(T.horizontalAlign-.5)*h,D=-(T.verticalAlign-.5)*f,G=g.evaluateVariableOffset(c,v);return new g.Point(P+G[0]*S,D+G[1]*S)}function Vo(c,h,f,v,S,T){var P=c.x1,D=c.x2,G=c.y1,Q=c.y2,ge=c.anchorPointX,Ee=c.anchorPointY,Se=new g.Point(h,f);return v&&Se._rotate(S?T:-T),{x1:P+Se.x,y1:G+Se.y,x2:D+Se.x,y2:Q+Se.y,anchorPointX:ge,anchorPointY:Ee}}da.prototype.get=function(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){var h=++this.maxGroupID;this.collisionGroups[c]={ID:h,predicate:function(f){return f.collisionGroupID===h}}}return this.collisionGroups[c]};var co=function(c,h,f,v){this.transform=c.clone(),this.collisionIndex=new Ya(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new da(f),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}};function Ns(c,h,f,v,S){c.emplaceBack(h?1:0,f?1:0,v||0,S||0),c.emplaceBack(h?1:0,f?1:0,v||0,S||0),c.emplaceBack(h?1:0,f?1:0,v||0,S||0),c.emplaceBack(h?1:0,f?1:0,v||0,S||0)}co.prototype.getBucketParts=function(c,h,f,v){var S=f.getBucket(h),T=f.latestFeatureIndex;if(S&&T&&h.id===S.layerIds[0]){var P=f.collisionBoxArray,D=S.layers[0].layout,G=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),Q=f.tileSize/g.EXTENT,ge=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),Ee=D.get("text-pitch-alignment")==="map",Se=D.get("text-rotation-alignment")==="map",We=oa(f,1,this.transform.zoom),je=qt(ge,Ee,Se,this.transform,We),lt=null;if(Ee){var Re=Gt(ge,Ee,Se,this.transform,We);lt=g.multiply([],this.transform.labelPlaneMatrix,Re)}this.retainedQueryData[S.bucketInstanceId]=new Ao(S.bucketInstanceId,T,S.sourceLayerIndex,S.index,f.tileID);var at={bucket:S,layout:D,posMatrix:ge,textLabelPlaneMatrix:je,labelToScreenMatrix:lt,scale:G,textPixelRatio:Q,holdingForFade:f.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:g.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(v)for(var mt=0,Wt=S.sortKeyRanges;mt<Wt.length;mt+=1){var vr=Wt[mt];c.push({sortKey:vr.sortKey,symbolInstanceStart:vr.symbolInstanceStart,symbolInstanceEnd:vr.symbolInstanceEnd,parameters:at})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:at})}},co.prototype.attemptAnchorPlacement=function(c,h,f,v,S,T,P,D,G,Q,ge,Ee,Se,We,je){var lt,Re=[Ee.textOffset0,Ee.textOffset1],at=lo(c,f,v,Re,S),mt=this.collisionIndex.placeCollisionBox(Vo(h,at.x,at.y,T,P,this.transform.angle),ge,D,G,Q.predicate);if(!je||this.collisionIndex.placeCollisionBox(Vo(je,at.x,at.y,T,P,this.transform.angle),ge,D,G,Q.predicate).box.length!==0)return mt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Ee.crossTileID]&&this.prevPlacement.placements[Ee.crossTileID]&&this.prevPlacement.placements[Ee.crossTileID].text&&(lt=this.prevPlacement.variableOffsets[Ee.crossTileID].anchor),this.variableOffsets[Ee.crossTileID]={textOffset:Re,width:f,height:v,anchor:c,textBoxScale:S,prevAnchor:lt},this.markUsedJustification(Se,c,Ee,We),Se.allowVerticalPlacement&&(this.markUsedOrientation(Se,We,Ee),this.placedOrientations[Ee.crossTileID]=We),{shift:at,placedGlyphBoxes:mt}):void 0},co.prototype.placeLayerBucketPart=function(c,h,f){var v=this,S=c.parameters,T=S.bucket,P=S.layout,D=S.posMatrix,G=S.textLabelPlaneMatrix,Q=S.labelToScreenMatrix,ge=S.textPixelRatio,Ee=S.holdingForFade,Se=S.collisionBoxArray,We=S.partiallyEvaluatedTextSize,je=S.collisionGroup,lt=P.get("text-optional"),Re=P.get("icon-optional"),at=P.get("text-allow-overlap"),mt=P.get("icon-allow-overlap"),Wt=P.get("text-rotation-alignment")==="map",vr=P.get("text-pitch-alignment")==="map",ur=P.get("icon-text-fit")!=="none",hr=P.get("symbol-z-order")==="viewport-y",Lr=at&&(mt||!T.hasIconData()||Re),Jr=mt&&(at||!T.hasTextData()||lt);!T.collisionArrays&&Se&&T.deserializeCollisionBoxes(Se);var Yr=function(bn,pi){if(!h[bn.crossTileID])if(Ee)v.placements[bn.crossTileID]=new Ru(!1,!1,!1);else{var Ti,mi=!1,ui=!1,Oi=!0,fi=null,li={box:null,offscreen:null},ho={box:null,offscreen:null},Ga=null,Ro=null,Lo=0,Qa=0,po=0;pi.textFeatureIndex?Lo=pi.textFeatureIndex:bn.useRuntimeCollisionCircles&&(Lo=bn.featureIndex),pi.verticalTextFeatureIndex&&(Qa=pi.verticalTextFeatureIndex);var Ja=pi.textBox;if(Ja){var Wo=function(aa){var Ws=g.WritingMode.horizontal;if(T.allowVerticalPlacement&&!aa&&v.prevPlacement){var rs=v.prevPlacement.placedOrientations[bn.crossTileID];rs&&(v.placedOrientations[bn.crossTileID]=rs,v.markUsedOrientation(T,Ws=rs,bn))}return Ws},zu=function(aa,Ws){if(T.allowVerticalPlacement&&bn.numVerticalGlyphVertices>0&&pi.verticalTextBox)for(var rs=0,rl=T.writingModes;rs<rl.length&&(rl[rs]===g.WritingMode.vertical?(li=Ws(),ho=li):li=aa(),!(li&&li.box&&li.box.length));rs+=1);else li=aa()};if(P.get("text-variable-anchor")){var hs=P.get("text-variable-anchor");if(v.prevPlacement&&v.prevPlacement.variableOffsets[bn.crossTileID]){var Xo=v.prevPlacement.variableOffsets[bn.crossTileID];hs.indexOf(Xo.anchor)>0&&(hs=hs.filter(function(aa){return aa!==Xo.anchor})).unshift(Xo.anchor)}var eu=function(aa,Ws,rs){for(var rl=aa.x2-aa.x1,Gc=aa.y2-aa.y1,Hc=bn.textBoxScale,Pf=ur&&!mt?Ws:null,tu={box:[],offscreen:!1},yc=at?2*hs.length:hs.length,mu=0;mu<yc;++mu){var xl=v.attemptAnchorPlacement(hs[mu%hs.length],aa,rl,Gc,Hc,Wt,vr,ge,D,je,mu>=hs.length,bn,T,rs,Pf);if(xl&&(tu=xl.placedGlyphBoxes)&&tu.box&&tu.box.length){mi=!0,fi=xl.shift;break}}return tu};zu(function(){return eu(Ja,pi.iconBox,g.WritingMode.horizontal)},function(){var aa=pi.verticalTextBox;return T.allowVerticalPlacement&&!(li&&li.box&&li.box.length)&&bn.numVerticalGlyphVertices>0&&aa?eu(aa,pi.verticalIconBox,g.WritingMode.vertical):{box:null,offscreen:null}}),li&&(mi=li.box,Oi=li.offscreen);var Vl=Wo(li&&li.box);if(!mi&&v.prevPlacement){var yl=v.prevPlacement.variableOffsets[bn.crossTileID];yl&&(v.variableOffsets[bn.crossTileID]=yl,v.markUsedJustification(T,yl.anchor,bn,Vl))}}else{var du=function(aa,Ws){var rs=v.collisionIndex.placeCollisionBox(aa,at,ge,D,je.predicate);return rs&&rs.box&&rs.box.length&&(v.markUsedOrientation(T,Ws,bn),v.placedOrientations[bn.crossTileID]=Ws),rs};zu(function(){return du(Ja,g.WritingMode.horizontal)},function(){var aa=pi.verticalTextBox;return T.allowVerticalPlacement&&bn.numVerticalGlyphVertices>0&&aa?du(aa,g.WritingMode.vertical):{box:null,offscreen:null}}),Wo(li&&li.box&&li.box.length)}}if(mi=(Ti=li)&&Ti.box&&Ti.box.length>0,Oi=Ti&&Ti.offscreen,bn.useRuntimeCollisionCircles){var Gl=T.text.placedSymbolArray.get(bn.centerJustifiedTextSymbolIndex),gc=g.evaluateSizeForFeature(T.textSizeData,We,Gl),vu=P.get("text-padding");Ga=v.collisionIndex.placeCollisionCircles(at,Gl,T.lineVertexArray,T.glyphOffsetArray,gc,D,G,Q,f,vr,je.predicate,bn.collisionCircleDiameter,vu),mi=at||Ga.circles.length>0&&!Ga.collisionDetected,Oi=Oi&&Ga.offscreen}if(pi.iconFeatureIndex&&(po=pi.iconFeatureIndex),pi.iconBox){var _l=function(aa){var Ws=ur&&fi?Vo(aa,fi.x,fi.y,Wt,vr,v.transform.angle):aa;return v.collisionIndex.placeCollisionBox(Ws,mt,ge,D,je.predicate)};ui=ho&&ho.box&&ho.box.length&&pi.verticalIconBox?(Ro=_l(pi.verticalIconBox)).box.length>0:(Ro=_l(pi.iconBox)).box.length>0,Oi=Oi&&Ro.offscreen}var Au=lt||bn.numHorizontalGlyphVertices===0&&bn.numVerticalGlyphVertices===0,xo=Re||bn.numIconVertices===0;if(Au||xo?xo?Au||(ui=ui&&mi):mi=ui&&mi:ui=mi=ui&&mi,mi&&Ti&&Ti.box&&v.collisionIndex.insertCollisionBox(Ti.box,P.get("text-ignore-placement"),T.bucketInstanceId,ho&&ho.box&&Qa?Qa:Lo,je.ID),ui&&Ro&&v.collisionIndex.insertCollisionBox(Ro.box,P.get("icon-ignore-placement"),T.bucketInstanceId,po,je.ID),Ga&&(mi&&v.collisionIndex.insertCollisionCircles(Ga.circles,P.get("text-ignore-placement"),T.bucketInstanceId,Lo,je.ID),f)){var Zu=T.bucketInstanceId,tl=v.collisionCircleArrays[Zu];tl===void 0&&(tl=v.collisionCircleArrays[Zu]=new yo);for(var Uu=0;Uu<Ga.circles.length;Uu+=4)tl.circles.push(Ga.circles[Uu+0]),tl.circles.push(Ga.circles[Uu+1]),tl.circles.push(Ga.circles[Uu+2]),tl.circles.push(Ga.collisionDetected?1:0)}v.placements[bn.crossTileID]=new Ru(mi||Lr,ui||Jr,Oi||T.justReloaded),h[bn.crossTileID]=!0}};if(hr)for(var yn=T.getSortedSymbolIndexes(this.transform.angle),Jn=yn.length-1;Jn>=0;--Jn){var ei=yn[Jn];Yr(T.symbolInstances.get(ei),T.collisionArrays[ei])}else for(var ni=c.symbolInstanceStart;ni<c.symbolInstanceEnd;ni++)Yr(T.symbolInstances.get(ni),T.collisionArrays[ni]);if(f&&T.bucketInstanceId in this.collisionCircleArrays){var Wi=this.collisionCircleArrays[T.bucketInstanceId];g.invert(Wi.invProjMatrix,D),Wi.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1},co.prototype.markUsedJustification=function(c,h,f,v){var S;S=v===g.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[g.getAnchorJustification(h)];for(var T=0,P=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];T<P.length;T+=1){var D=P[T];D>=0&&(c.text.placedSymbolArray.get(D).crossTileID=S>=0&&D!==S?0:f.crossTileID)}},co.prototype.markUsedOrientation=function(c,h,f){for(var v=h===g.WritingMode.horizontal||h===g.WritingMode.horizontalOnly?h:0,S=h===g.WritingMode.vertical?h:0,T=0,P=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];T<P.length;T+=1)c.text.placedSymbolArray.get(P[T]).placedOrientation=v;f.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=S)},co.prototype.commit=function(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;var h=this.prevPlacement,f=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;var v=h?h.symbolFadeChange(c):1,S=h?h.opacities:{},T=h?h.variableOffsets:{},P=h?h.placedOrientations:{};for(var D in this.placements){var G=this.placements[D],Q=S[D];Q?(this.opacities[D]=new Co(Q,v,G.text,G.icon),f=f||G.text!==Q.text.placed||G.icon!==Q.icon.placed):(this.opacities[D]=new Co(null,v,G.text,G.icon,G.skipFade),f=f||G.text||G.icon)}for(var ge in S){var Ee=S[ge];if(!this.opacities[ge]){var Se=new Co(Ee,v,!1,!1);Se.isHidden()||(this.opacities[ge]=Se,f=f||Ee.text.placed||Ee.icon.placed)}}for(var We in T)this.variableOffsets[We]||!this.opacities[We]||this.opacities[We].isHidden()||(this.variableOffsets[We]=T[We]);for(var je in P)this.placedOrientations[je]||!this.opacities[je]||this.opacities[je].isHidden()||(this.placedOrientations[je]=P[je]);f?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:c)},co.prototype.updateLayerOpacities=function(c,h){for(var f={},v=0,S=h;v<S.length;v+=1){var T=S[v],P=T.getBucket(c);P&&T.latestFeatureIndex&&c.id===P.layerIds[0]&&this.updateBucketOpacities(P,f,T.collisionBoxArray)}},co.prototype.updateBucketOpacities=function(c,h,f){var v=this;c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();var S=c.layers[0].layout,T=new Co(null,0,!1,!1,!0),P=S.get("text-allow-overlap"),D=S.get("icon-allow-overlap"),G=S.get("text-variable-anchor"),Q=S.get("text-rotation-alignment")==="map",ge=S.get("text-pitch-alignment")==="map",Ee=S.get("icon-text-fit")!=="none",Se=new Co(null,0,P&&(D||!c.hasIconData()||S.get("icon-optional")),D&&(P||!c.hasTextData()||S.get("text-optional")),!0);!c.collisionArrays&&f&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(f);for(var We=function(at,mt,Wt){for(var vr=0;vr<mt/4;vr++)at.opacityVertexArray.emplaceBack(Wt)},je=function(at){var mt=c.symbolInstances.get(at),Wt=mt.numHorizontalGlyphVertices,vr=mt.numVerticalGlyphVertices,ur=mt.crossTileID,hr=v.opacities[ur];h[ur]?hr=T:hr||(v.opacities[ur]=hr=Se),h[ur]=!0;var Lr=mt.numIconVertices>0,Jr=v.placedOrientations[mt.crossTileID],Yr=Jr===g.WritingMode.vertical,yn=Jr===g.WritingMode.horizontal||Jr===g.WritingMode.horizontalOnly;if(Wt>0||vr>0){var Jn=Un(hr.text);We(c.text,Wt,Yr?Bi:Jn),We(c.text,vr,yn?Bi:Jn);var ei=hr.text.isHidden();[mt.rightJustifiedTextSymbolIndex,mt.centerJustifiedTextSymbolIndex,mt.leftJustifiedTextSymbolIndex].forEach(function(li){li>=0&&(c.text.placedSymbolArray.get(li).hidden=ei||Yr?1:0)}),mt.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(mt.verticalPlacedTextSymbolIndex).hidden=ei||yn?1:0);var ni=v.variableOffsets[mt.crossTileID];ni&&v.markUsedJustification(c,ni.anchor,mt,Jr);var Wi=v.placedOrientations[mt.crossTileID];Wi&&(v.markUsedJustification(c,"left",mt,Wi),v.markUsedOrientation(c,Wi,mt))}if(Lr){var bn=Un(hr.icon),pi=!(Ee&&mt.verticalPlacedIconSymbolIndex&&Yr);mt.placedIconSymbolIndex>=0&&(We(c.icon,mt.numIconVertices,pi?bn:Bi),c.icon.placedSymbolArray.get(mt.placedIconSymbolIndex).hidden=hr.icon.isHidden()),mt.verticalPlacedIconSymbolIndex>=0&&(We(c.icon,mt.numVerticalIconVertices,pi?Bi:bn),c.icon.placedSymbolArray.get(mt.verticalPlacedIconSymbolIndex).hidden=hr.icon.isHidden())}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){var Ti=c.collisionArrays[at];if(Ti){var mi=new g.Point(0,0);if(Ti.textBox||Ti.verticalTextBox){var ui=!0;if(G){var Oi=v.variableOffsets[ur];Oi?(mi=lo(Oi.anchor,Oi.width,Oi.height,Oi.textOffset,Oi.textBoxScale),Q&&mi._rotate(ge?v.transform.angle:-v.transform.angle)):ui=!1}Ti.textBox&&Ns(c.textCollisionBox.collisionVertexArray,hr.text.placed,!ui||Yr,mi.x,mi.y),Ti.verticalTextBox&&Ns(c.textCollisionBox.collisionVertexArray,hr.text.placed,!ui||yn,mi.x,mi.y)}var fi=Boolean(!yn&&Ti.verticalIconBox);Ti.iconBox&&Ns(c.iconCollisionBox.collisionVertexArray,hr.icon.placed,fi,Ee?mi.x:0,Ee?mi.y:0),Ti.verticalIconBox&&Ns(c.iconCollisionBox.collisionVertexArray,hr.icon.placed,!fi,Ee?mi.x:0,Ee?mi.y:0)}}},lt=0;lt<c.symbolInstances.length;lt++)je(lt);if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){var Re=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=Re.invProjMatrix,c.placementViewportMatrix=Re.viewportMatrix,c.collisionCircleArray=Re.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}},co.prototype.symbolFadeChange=function(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},co.prototype.zoomAdjustment=function(c){return Math.max(0,(this.transform.zoom-c)/1.5)},co.prototype.hasTransitions=function(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration},co.prototype.stillRecent=function(c,h){var f=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*f>c},co.prototype.setStale=function(){this.stale=!0};var ul=Math.pow(2,25),us=Math.pow(2,24),me=Math.pow(2,17),Le=Math.pow(2,16),dt=Math.pow(2,9),ir=Math.pow(2,8),Vr=Math.pow(2,1);function Un(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;var h=c.placed?1:0,f=Math.floor(127*c.opacity);return f*ul+h*us+f*me+h*Le+f*dt+h*ir+f*Vr+h}var Bi=0,qa=function(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};qa.prototype.continuePlacement=function(c,h,f,v,S){for(var T=this._bucketParts;this._currentTileIndex<c.length;)if(h.getBucketParts(T,v,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort(function(P,D){return P.sortKey-D.sortKey}));this._currentPartIndex<T.length;)if(h.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,S())return!0;return!1};var Oa=function(c,h,f,v,S,T,P){this.placement=new co(c,S,T,P),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=v,this._done=!1};Oa.prototype.isDone=function(){return this._done},Oa.prototype.continuePlacement=function(c,h,f){for(var v=this,S=g.browser.now(),T=function(){var G=g.browser.now()-S;return!v._forceFullPlacement&&G>2};this._currentPlacementIndex>=0;){var P=h[c[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=D)&&(!P.maxzoom||P.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new qa(P)),this._inProgressLayer.continuePlacement(f[P.source],this.placement,this._showCollisionBoxes,P,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Oa.prototype.commit=function(c){return this.placement.commit(c),this.placement};var ja=512/g.EXTENT/2,Go=function(c,h,f){this.tileID=c,this.indexedSymbolInstances={},this.bucketInstanceId=f;for(var v=0;v<h.length;v++){var S=h.get(v),T=S.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,c)})}};Go.prototype.getScaledCoordinates=function(c,h){var f=ja/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*g.EXTENT+c.anchorX)*f),y:Math.floor((h.canonical.y*g.EXTENT+c.anchorY)*f)}},Go.prototype.findMatches=function(c,h,f){for(var v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),S=0;S<c.length;S++){var T=c.get(S);if(!T.crossTileID){var P=this.indexedSymbolInstances[T.key];if(P)for(var D=this.getScaledCoordinates(T,h),G=0,Q=P;G<Q.length;G+=1){var ge=Q[G];if(Math.abs(ge.coord.x-D.x)<=v&&Math.abs(ge.coord.y-D.y)<=v&&!f[ge.crossTileID]){f[ge.crossTileID]=!0,T.crossTileID=ge.crossTileID;break}}}}};var ms=function(){this.maxCrossTileID=0};ms.prototype.generate=function(){return++this.maxCrossTileID};var Ho=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ho.prototype.handleWrapJump=function(c){var h=Math.round((c-this.lng)/360);if(h!==0)for(var f in this.indexes){var v=this.indexes[f],S={};for(var T in v){var P=v[T];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),S[P.tileID.key]=P}this.indexes[f]=S}this.lng=c},Ho.prototype.addBucket=function(c,h,f){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(var v=0;v<h.symbolInstances.length;v++)h.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});var S=this.usedCrossTileIDs[c.overscaledZ];for(var T in this.indexes){var P=this.indexes[T];if(Number(T)>c.overscaledZ)for(var D in P){var G=P[D];G.tileID.isChildOf(c)&&G.findMatches(h.symbolInstances,c,S)}else{var Q=P[c.scaledTo(Number(T)).key];Q&&Q.findMatches(h.symbolInstances,c,S)}}for(var ge=0;ge<h.symbolInstances.length;ge++){var Ee=h.symbolInstances.get(ge);Ee.crossTileID||(Ee.crossTileID=f.generate(),S[Ee.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Go(c,h.symbolInstances,h.bucketInstanceId),!0},Ho.prototype.removeBucketCrossTileIDs=function(c,h){for(var f in h.indexedSymbolInstances)for(var v=0,S=h.indexedSymbolInstances[f];v<S.length;v+=1)delete this.usedCrossTileIDs[c][S[v].crossTileID]},Ho.prototype.removeStaleBuckets=function(c){var h=!1;for(var f in this.indexes){var v=this.indexes[f];for(var S in v)c[v[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,v[S]),delete v[S],h=!0)}return h};var ls=function(){this.layerIndexes={},this.crossTileIDs=new ms,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ls.prototype.addLayer=function(c,h,f){var v=this.layerIndexes[c.id];v===void 0&&(v=this.layerIndexes[c.id]=new Ho);var S=!1,T={};v.handleWrapJump(f);for(var P=0,D=h;P<D.length;P+=1){var G=D[P],Q=G.getBucket(c);Q&&c.id===Q.layerIds[0]&&(Q.bucketInstanceId||(Q.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(G.tileID,Q,this.crossTileIDs)&&(S=!0),T[Q.bucketInstanceId]=!0)}return v.removeStaleBuckets(T)&&(S=!0),S},ls.prototype.pruneUnusedLayers=function(c){var h={};for(var f in c.forEach(function(v){h[v]=!0}),this.layerIndexes)h[f]||delete this.layerIndexes[f]};var gs=function(c,h){return g.emitValidationErrors(c,h&&h.filter(function(f){return f.identifier!=="source.canvas"}))},ws=g.pick(cn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Qo=g.pick(cn,["setCenter","setZoom","setBearing","setPitch"]),cs=function(){var c={},h=g.styleSpec.$version;for(var f in g.styleSpec.$root){var v,S=g.styleSpec.$root[f];S.required&&(v=f==="version"?h:S.type==="array"?[]:{})!=null&&(c[f]=v)}return c}(),ys=function(c){function h(f,v){var S=this;v===void 0&&(v={}),c.call(this),this.map=f,this.dispatcher=new nr(tr(),this),this.imageManager=new _t,this.imageManager.setEventedParent(this),this.glyphManager=new rr(f._requestManager,v.localIdeographFontFamily),this.lineAtlas=new ut(256,512),this.crossTileSymbolIndex=new ls,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new g.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",g.getReferrer());var T=this;this._rtlTextPluginCallback=h.registerForPluginStateChange(function(P){T.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(D,G){if(g.triggerPluginCompletionEvent(D),G&&G.every(function(ge){return ge}))for(var Q in T.sourceCaches)T.sourceCaches[Q].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var D=S.sourceCaches[P.sourceId];if(D){var G=D.getSource();if(G&&G.vectorLayerIds)for(var Q in S._layers){var ge=S._layers[Q];ge.source===G.id&&S._validateLayer(ge)}}}})}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.loadURL=function(f,v){var S=this;v===void 0&&(v={}),this.fire(new g.Event("dataloading",{dataType:"style"}));var T=typeof v.validate=="boolean"?v.validate:!g.isMapboxURL(f);f=this.map._requestManager.normalizeStyleURL(f,v.accessToken);var P=this.map._requestManager.transformRequest(f,g.ResourceType.Style);this._request=g.getJSON(P,function(D,G){S._request=null,D?S.fire(new g.ErrorEvent(D)):G&&S._load(G,T)})},h.prototype.loadJSON=function(f,v){var S=this;v===void 0&&(v={}),this.fire(new g.Event("dataloading",{dataType:"style"})),this._request=g.browser.frame(function(){S._request=null,S._load(f,v.validate!==!1)})},h.prototype.loadEmpty=function(){this.fire(new g.Event("dataloading",{dataType:"style"})),this._load(cs,!1)},h.prototype._load=function(f,v){if(!v||!gs(this,g.validateStyle(f))){for(var S in this._loaded=!0,this.stylesheet=f,f.sources)this.addSource(S,f.sources[S],{validate:!1});f.sprite?this._loadSprite(f.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(f.glyphs);var T=rn(this.stylesheet.layers);this._order=T.map(function(Q){return Q.id}),this._layers={},this._serializedLayers={};for(var P=0,D=T;P<D.length;P+=1){var G=D[P];(G=g.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Zt(this.stylesheet.light),this.fire(new g.Event("data",{dataType:"style"})),this.fire(new g.Event("style.load"))}},h.prototype._loadSprite=function(f){var v=this;this._spriteRequest=function(S,T,P){var D,G,Q,ge=g.browser.devicePixelRatio>1?"@2x":"",Ee=g.getJSON(T.transformRequest(T.normalizeSpriteURL(S,ge,".json"),g.ResourceType.SpriteJSON),function(je,lt){Ee=null,Q||(Q=je,D=lt,We())}),Se=g.getImage(T.transformRequest(T.normalizeSpriteURL(S,ge,".png"),g.ResourceType.SpriteImage),function(je,lt){Se=null,Q||(Q=je,G=lt,We())});function We(){if(Q)P(Q);else if(D&&G){var je=g.browser.getImageData(G),lt={};for(var Re in D){var at=D[Re],mt=at.width,Wt=at.height,vr=at.x,ur=at.y,hr=at.sdf,Lr=at.pixelRatio,Jr=at.stretchX,Yr=at.stretchY,yn=at.content,Jn=new g.RGBAImage({width:mt,height:Wt});g.RGBAImage.copy(je,Jn,{x:vr,y:ur},{x:0,y:0},{width:mt,height:Wt}),lt[Re]={data:Jn,pixelRatio:Lr,sdf:hr,stretchX:Jr,stretchY:Yr,content:yn}}P(null,lt)}}return{cancel:function(){Ee&&(Ee.cancel(),Ee=null),Se&&(Se.cancel(),Se=null)}}}(f,this.map._requestManager,function(S,T){if(v._spriteRequest=null,S)v.fire(new g.ErrorEvent(S));else if(T)for(var P in T)v.imageManager.addImage(P,T[P]);v.imageManager.setLoaded(!0),v._availableImages=v.imageManager.listImages(),v.dispatcher.broadcast("setImages",v._availableImages),v.fire(new g.Event("data",{dataType:"style"}))})},h.prototype._validateLayer=function(f){var v=this.sourceCaches[f.source];if(v){var S=f.sourceLayer;if(S){var T=v.getSource();(T.type==="geojson"||T.vectorLayerIds&&T.vectorLayerIds.indexOf(S)===-1)&&this.fire(new g.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+T.id+'" as specified by style layer "'+f.id+'"')))}}},h.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var f in this.sourceCaches)if(!this.sourceCaches[f].loaded())return!1;return!!this.imageManager.isLoaded()},h.prototype._serializeLayers=function(f){for(var v=[],S=0,T=f;S<T.length;S+=1){var P=this._layers[T[S]];P.type!=="custom"&&v.push(P.serialize())}return v},h.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var f in this.sourceCaches)if(this.sourceCaches[f].hasTransition())return!0;for(var v in this._layers)if(this._layers[v].hasTransition())return!0;return!1},h.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},h.prototype.update=function(f){if(this._loaded){var v=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);for(var P in(S.length||T.length)&&this._updateWorkerLayers(S,T),this._updatedSources){var D=this._updatedSources[P];D==="reload"?this._reloadSource(P):D==="clear"&&this._clearSource(P)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(f);this.light.updateTransitions(f),this._resetUpdates()}var Q={};for(var ge in this.sourceCaches){var Ee=this.sourceCaches[ge];Q[ge]=Ee.used,Ee.used=!1}for(var Se=0,We=this._order;Se<We.length;Se+=1){var je=this._layers[We[Se]];je.recalculate(f,this._availableImages),!je.isHidden(f.zoom)&&je.source&&(this.sourceCaches[je.source].used=!0)}for(var lt in Q){var Re=this.sourceCaches[lt];Q[lt]!==Re.used&&Re.fire(new g.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:lt}))}this.light.recalculate(f),this.z=f.zoom,v&&this.fire(new g.Event("data",{dataType:"style"}))}},h.prototype._updateTilesForChangedImages=function(){var f=Object.keys(this._changedImages);if(f.length){for(var v in this.sourceCaches)this.sourceCaches[v].reloadTilesForDependencies(["icons","patterns"],f);this._changedImages={}}},h.prototype._updateWorkerLayers=function(f,v){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(f),removedIds:v})},h.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},h.prototype.setState=function(f){var v=this;if(this._checkLoaded(),gs(this,g.validateStyle(f)))return!1;(f=g.clone$1(f)).layers=rn(f.layers);var S=function(P,D){if(!P)return[{command:cn.setStyle,args:[D]}];var G=[];try{if(!g.deepEqual(P.version,D.version))return[{command:cn.setStyle,args:[D]}];g.deepEqual(P.center,D.center)||G.push({command:cn.setCenter,args:[D.center]}),g.deepEqual(P.zoom,D.zoom)||G.push({command:cn.setZoom,args:[D.zoom]}),g.deepEqual(P.bearing,D.bearing)||G.push({command:cn.setBearing,args:[D.bearing]}),g.deepEqual(P.pitch,D.pitch)||G.push({command:cn.setPitch,args:[D.pitch]}),g.deepEqual(P.sprite,D.sprite)||G.push({command:cn.setSprite,args:[D.sprite]}),g.deepEqual(P.glyphs,D.glyphs)||G.push({command:cn.setGlyphs,args:[D.glyphs]}),g.deepEqual(P.transition,D.transition)||G.push({command:cn.setTransition,args:[D.transition]}),g.deepEqual(P.light,D.light)||G.push({command:cn.setLight,args:[D.light]});var Q={},ge=[];(function(Se,We,je,lt){var Re;for(Re in We=We||{},Se=Se||{})Se.hasOwnProperty(Re)&&(We.hasOwnProperty(Re)||gn(Re,je,lt));for(Re in We)We.hasOwnProperty(Re)&&(Se.hasOwnProperty(Re)?g.deepEqual(Se[Re],We[Re])||(Se[Re].type==="geojson"&&We[Re].type==="geojson"&&ca(Se,We,Re)?je.push({command:cn.setGeoJSONSourceData,args:[Re,We[Re].data]}):zi(Re,We,je,lt)):wi(Re,We,je))})(P.sources,D.sources,ge,Q);var Ee=[];P.layers&&P.layers.forEach(function(Se){Q[Se.source]?G.push({command:cn.removeLayer,args:[Se.id]}):Ee.push(Se)}),G=G.concat(ge),function(Se,We,je){We=We||[];var lt,Re,at,mt,Wt,vr,ur,hr=(Se=Se||[]).map(ki),Lr=We.map(ki),Jr=Se.reduce(Pi,{}),Yr=We.reduce(Pi,{}),yn=hr.slice(),Jn=Object.create(null);for(lt=0,Re=0;lt<hr.length;lt++)Yr.hasOwnProperty(at=hr[lt])?Re++:(je.push({command:cn.removeLayer,args:[at]}),yn.splice(yn.indexOf(at,Re),1));for(lt=0,Re=0;lt<Lr.length;lt++)yn[yn.length-1-lt]!==(at=Lr[Lr.length-1-lt])&&(Jr.hasOwnProperty(at)?(je.push({command:cn.removeLayer,args:[at]}),yn.splice(yn.lastIndexOf(at,yn.length-Re),1)):Re++,je.push({command:cn.addLayer,args:[Yr[at],vr=yn[yn.length-lt]]}),yn.splice(yn.length-lt,0,at),Jn[at]=!0);for(lt=0;lt<Lr.length;lt++)if(mt=Jr[at=Lr[lt]],Wt=Yr[at],!Jn[at]&&!g.deepEqual(mt,Wt))if(g.deepEqual(mt.source,Wt.source)&&g.deepEqual(mt["source-layer"],Wt["source-layer"])&&g.deepEqual(mt.type,Wt.type)){for(ur in sn(mt.layout,Wt.layout,je,at,null,cn.setLayoutProperty),sn(mt.paint,Wt.paint,je,at,null,cn.setPaintProperty),g.deepEqual(mt.filter,Wt.filter)||je.push({command:cn.setFilter,args:[at,Wt.filter]}),g.deepEqual(mt.minzoom,Wt.minzoom)&&g.deepEqual(mt.maxzoom,Wt.maxzoom)||je.push({command:cn.setLayerZoomRange,args:[at,Wt.minzoom,Wt.maxzoom]}),mt)mt.hasOwnProperty(ur)&&ur!=="layout"&&ur!=="paint"&&ur!=="filter"&&ur!=="metadata"&&ur!=="minzoom"&&ur!=="maxzoom"&&(ur.indexOf("paint.")===0?sn(mt[ur],Wt[ur],je,at,ur.slice(6),cn.setPaintProperty):g.deepEqual(mt[ur],Wt[ur])||je.push({command:cn.setLayerProperty,args:[at,ur,Wt[ur]]}));for(ur in Wt)Wt.hasOwnProperty(ur)&&!mt.hasOwnProperty(ur)&&ur!=="layout"&&ur!=="paint"&&ur!=="filter"&&ur!=="metadata"&&ur!=="minzoom"&&ur!=="maxzoom"&&(ur.indexOf("paint.")===0?sn(mt[ur],Wt[ur],je,at,ur.slice(6),cn.setPaintProperty):g.deepEqual(mt[ur],Wt[ur])||je.push({command:cn.setLayerProperty,args:[at,ur,Wt[ur]]}))}else je.push({command:cn.removeLayer,args:[at]}),vr=yn[yn.lastIndexOf(at)+1],je.push({command:cn.addLayer,args:[Wt,vr]})}(Ee,D.layers,G)}catch(Se){console.warn("Unable to compute style diff:",Se),G=[{command:cn.setStyle,args:[D]}]}return G}(this.serialize(),f).filter(function(P){return!(P.command in Qo)});if(S.length===0)return!1;var T=S.filter(function(P){return!(P.command in ws)});if(T.length>0)throw new Error("Unimplemented: "+T.map(function(P){return P.command}).join(", ")+".");return S.forEach(function(P){P.command!=="setTransition"&&v[P.command].apply(v,P.args)}),this.stylesheet=f,!0},h.prototype.addImage=function(f,v){if(this.getImage(f))return this.fire(new g.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(f,v),this._afterImageUpdated(f)},h.prototype.updateImage=function(f,v){this.imageManager.updateImage(f,v)},h.prototype.getImage=function(f){return this.imageManager.getImage(f)},h.prototype.removeImage=function(f){if(!this.getImage(f))return this.fire(new g.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(f),this._afterImageUpdated(f)},h.prototype._afterImageUpdated=function(f){this._availableImages=this.imageManager.listImages(),this._changedImages[f]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.Event("data",{dataType:"style"}))},h.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},h.prototype.addSource=function(f,v,S){var T=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[f]!==void 0)throw new Error("There is already a source with this ID");if(!v.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(v).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(v.type)>=0&&this._validate(g.validateStyle.source,"sources."+f,v,null,S))){this.map&&this.map._collectResourceTiming&&(v.collectResourceTiming=!0);var P=this.sourceCaches[f]=new Ye(f,v,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:T.loaded(),source:P.serialize(),sourceId:f}}),P.onAdd(this.map),this._changed=!0}},h.prototype.removeSource=function(f){if(this._checkLoaded(),this.sourceCaches[f]===void 0)throw new Error("There is no source with this ID");for(var v in this._layers)if(this._layers[v].source===f)return this.fire(new g.ErrorEvent(new Error('Source "'+f+'" cannot be removed while layer "'+v+'" is using it.')));var S=this.sourceCaches[f];delete this.sourceCaches[f],delete this._updatedSources[f],S.fire(new g.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},h.prototype.setGeoJSONSourceData=function(f,v){this._checkLoaded(),this.sourceCaches[f].getSource().setData(v),this._changed=!0},h.prototype.getSource=function(f){return this.sourceCaches[f]&&this.sourceCaches[f].getSource()},h.prototype.addLayer=function(f,v,S){S===void 0&&(S={}),this._checkLoaded();var T=f.id;if(this.getLayer(T))this.fire(new g.ErrorEvent(new Error('Layer with id "'+T+'" already exists on this map')));else{var P;if(f.type==="custom"){if(gs(this,g.validateCustomStyleLayer(f)))return;P=g.createStyleLayer(f)}else{if(typeof f.source=="object"&&(this.addSource(T,f.source),f=g.clone$1(f),f=g.extend(f,{source:T})),this._validate(g.validateStyle.layer,"layers."+T,f,{arrayIndex:-1},S))return;P=g.createStyleLayer(f),this._validateLayer(P),P.setEventedParent(this,{layer:{id:T}}),this._serializedLayers[P.id]=P.serialize()}var D=v?this._order.indexOf(v):this._order.length;if(v&&D===-1)this.fire(new g.ErrorEvent(new Error('Layer with id "'+v+'" does not exist on this map.')));else{if(this._order.splice(D,0,T),this._layerOrderChanged=!0,this._layers[T]=P,this._removedLayers[T]&&P.source&&P.type!=="custom"){var G=this._removedLayers[T];delete this._removedLayers[T],G.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},h.prototype.moveLayer=function(f,v){if(this._checkLoaded(),this._changed=!0,this._layers[f]){if(f!==v){var S=this._order.indexOf(f);this._order.splice(S,1);var T=v?this._order.indexOf(v):this._order.length;v&&T===-1?this.fire(new g.ErrorEvent(new Error('Layer with id "'+v+'" does not exist on this map.'))):(this._order.splice(T,0,f),this._layerOrderChanged=!0)}}else this.fire(new g.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be moved.")))},h.prototype.removeLayer=function(f){this._checkLoaded();var v=this._layers[f];if(v){v.setEventedParent(null);var S=this._order.indexOf(f);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[f]=v,delete this._layers[f],delete this._serializedLayers[f],delete this._updatedLayers[f],delete this._updatedPaintProps[f],v.onRemove&&v.onRemove(this.map)}else this.fire(new g.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be removed.")))},h.prototype.getLayer=function(f){return this._layers[f]},h.prototype.hasLayer=function(f){return f in this._layers},h.prototype.setLayerZoomRange=function(f,v,S){this._checkLoaded();var T=this.getLayer(f);T?T.minzoom===v&&T.maxzoom===S||(v!=null&&(T.minzoom=v),S!=null&&(T.maxzoom=S),this._updateLayer(T)):this.fire(new g.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot have zoom extent.")))},h.prototype.setFilter=function(f,v,S){S===void 0&&(S={}),this._checkLoaded();var T=this.getLayer(f);if(T){if(!g.deepEqual(T.filter,v))return v==null?(T.filter=void 0,void this._updateLayer(T)):void(this._validate(g.validateStyle.filter,"layers."+T.id+".filter",v,null,S)||(T.filter=g.clone$1(v),this._updateLayer(T)))}else this.fire(new g.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be filtered.")))},h.prototype.getFilter=function(f){return g.clone$1(this.getLayer(f).filter)},h.prototype.setLayoutProperty=function(f,v,S,T){T===void 0&&(T={}),this._checkLoaded();var P=this.getLayer(f);P?g.deepEqual(P.getLayoutProperty(v),S)||(P.setLayoutProperty(v,S,T),this._updateLayer(P)):this.fire(new g.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getLayoutProperty=function(f,v){var S=this.getLayer(f);if(S)return S.getLayoutProperty(v);this.fire(new g.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style.")))},h.prototype.setPaintProperty=function(f,v,S,T){T===void 0&&(T={}),this._checkLoaded();var P=this.getLayer(f);P?g.deepEqual(P.getPaintProperty(v),S)||(P.setPaintProperty(v,S,T)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[f]=!0):this.fire(new g.ErrorEvent(new Error("The layer '"+f+"' does not exist in the map's style and cannot be styled.")))},h.prototype.getPaintProperty=function(f,v){return this.getLayer(f).getPaintProperty(v)},h.prototype.setFeatureState=function(f,v){this._checkLoaded();var S=f.source,T=f.sourceLayer,P=this.sourceCaches[S];if(P!==void 0){var D=P.getSource().type;D==="geojson"&&T?this.fire(new g.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):D!=="vector"||T?(f.id===void 0&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(T,f.id,v)):this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},h.prototype.removeFeatureState=function(f,v){this._checkLoaded();var S=f.source,T=this.sourceCaches[S];if(T!==void 0){var P=T.getSource().type,D=P==="vector"?f.sourceLayer:void 0;P!=="vector"||D?v&&typeof f.id!="string"&&typeof f.id!="number"?this.fire(new g.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):T.removeFeatureState(D,f.id,v):this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},h.prototype.getFeatureState=function(f){this._checkLoaded();var v=f.source,S=f.sourceLayer,T=this.sourceCaches[v];if(T!==void 0){if(T.getSource().type!=="vector"||S)return f.id===void 0&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),T.getFeatureState(S,f.id);this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error("The source '"+v+"' does not exist in the map's style.")))},h.prototype.getTransition=function(){return g.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},h.prototype.serialize=function(){return g.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:g.mapObject(this.sourceCaches,function(f){return f.serialize()}),layers:this._serializeLayers(this._order)},function(f){return f!==void 0})},h.prototype._updateLayer=function(f){this._updatedLayers[f.id]=!0,f.source&&!this._updatedSources[f.source]&&this.sourceCaches[f.source].getSource().type!=="raster"&&(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause()),this._changed=!0},h.prototype._flattenAndSortRenderedFeatures=function(f){for(var v=this,S=function(Jr){return v._layers[Jr].type==="fill-extrusion"},T={},P=[],D=this._order.length-1;D>=0;D--){var G=this._order[D];if(S(G)){T[G]=D;for(var Q=0,ge=f;Q<ge.length;Q+=1){var Ee=ge[Q][G];if(Ee)for(var Se=0,We=Ee;Se<We.length;Se+=1)P.push(We[Se])}}}P.sort(function(Jr,Yr){return Yr.intersectionZ-Jr.intersectionZ});for(var je=[],lt=this._order.length-1;lt>=0;lt--){var Re=this._order[lt];if(S(Re))for(var at=P.length-1;at>=0;at--){var mt=P[at].feature;if(T[mt.layer.id]<lt)break;je.push(mt),P.pop()}else for(var Wt=0,vr=f;Wt<vr.length;Wt+=1){var ur=vr[Wt][Re];if(ur)for(var hr=0,Lr=ur;hr<Lr.length;hr+=1)je.push(Lr[hr].feature)}}return je},h.prototype.queryRenderedFeatures=function(f,v,S){v&&v.filter&&this._validate(g.validateStyle.filter,"queryRenderedFeatures.filter",v.filter,null,v);var T={};if(v&&v.layers){if(!Array.isArray(v.layers))return this.fire(new g.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,D=v.layers;P<D.length;P+=1){var G=D[P],Q=this._layers[G];if(!Q)return this.fire(new g.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];T[Q.source]=!0}}var ge=[];for(var Ee in v.availableImages=this._availableImages,this.sourceCaches)v.layers&&!T[Ee]||ge.push(mr(this.sourceCaches[Ee],this._layers,this._serializedLayers,f,v,S));return this.placement&&ge.push(function(Se,We,je,lt,Re,at,mt){for(var Wt={},vr=at.queryRenderedSymbols(lt),ur=[],hr=0,Lr=Object.keys(vr).map(Number);hr<Lr.length;hr+=1)ur.push(mt[Lr[hr]]);ur.sort(An);for(var Jr=function(){var ni=yn[Yr],Wi=ni.featureIndex.lookupSymbolFeatures(vr[ni.bucketInstanceId],We,ni.bucketIndex,ni.sourceLayerIndex,Re.filter,Re.layers,Re.availableImages,Se);for(var bn in Wi){var pi=Wt[bn]=Wt[bn]||[],Ti=Wi[bn];Ti.sort(function(Oi,fi){var li=ni.featureSortOrder;if(li){var ho=li.indexOf(Oi.featureIndex);return li.indexOf(fi.featureIndex)-ho}return fi.featureIndex-Oi.featureIndex});for(var mi=0,ui=Ti;mi<ui.length;mi+=1)pi.push(ui[mi])}},Yr=0,yn=ur;Yr<yn.length;Yr+=1)Jr();var Jn=function(ni){Wt[ni].forEach(function(Wi){var bn=Wi.feature,pi=je[Se[ni].source].getFeatureState(bn.layer["source-layer"],bn.id);bn.source=bn.layer.source,bn.layer["source-layer"]&&(bn.sourceLayer=bn.layer["source-layer"]),bn.state=pi})};for(var ei in Wt)Jn(ei);return Wt}(this._layers,this._serializedLayers,this.sourceCaches,f,v,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ge)},h.prototype.querySourceFeatures=function(f,v){v&&v.filter&&this._validate(g.validateStyle.filter,"querySourceFeatures.filter",v.filter,null,v);var S=this.sourceCaches[f];return S?function(T,P){for(var D=T.getRenderableIds().map(function(We){return T.getTileByID(We)}),G=[],Q={},ge=0;ge<D.length;ge++){var Ee=D[ge],Se=Ee.tileID.canonical.key;Q[Se]||(Q[Se]=!0,Ee.querySourceFeatures(G,P))}return G}(S,v):[]},h.prototype.addSourceType=function(f,v,S){return h.getSourceType(f)?S(new Error('A source type called "'+f+'" already exists.')):(h.setSourceType(f,v),v.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:f,url:v.workerSourceURL},S):S(null,null))},h.prototype.getLight=function(){return this.light.getLight()},h.prototype.setLight=function(f,v){v===void 0&&(v={}),this._checkLoaded();var S=this.light.getLight(),T=!1;for(var P in f)if(!g.deepEqual(f[P],S[P])){T=!0;break}if(T){var D={now:g.browser.now(),transition:g.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(f,v),this.light.updateTransitions(D)}},h.prototype._validate=function(f,v,S,T,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&gs(this,f.call(g.validateStyle,g.extend({key:v,style:this.serialize(),value:S,styleSpec:g.styleSpec},T)))},h.prototype._remove=function(){for(var f in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),g.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[f].setEventedParent(null);for(var v in this.sourceCaches)this.sourceCaches[v].clearTiles(),this.sourceCaches[v].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},h.prototype._clearSource=function(f){this.sourceCaches[f].clearTiles()},h.prototype._reloadSource=function(f){this.sourceCaches[f].resume(),this.sourceCaches[f].reload()},h.prototype._updateSources=function(f){for(var v in this.sourceCaches)this.sourceCaches[v].update(f)},h.prototype._generateCollisionBoxes=function(){for(var f in this.sourceCaches)this._reloadSource(f)},h.prototype._updatePlacement=function(f,v,S,T,P){P===void 0&&(P=!1);for(var D=!1,G=!1,Q={},ge=0,Ee=this._order;ge<Ee.length;ge+=1){var Se=this._layers[Ee[ge]];if(Se.type==="symbol"){if(!Q[Se.source]){var We=this.sourceCaches[Se.source];Q[Se.source]=We.getRenderableIds(!0).map(function(mt){return We.getTileByID(mt)}).sort(function(mt,Wt){return Wt.tileID.overscaledZ-mt.tileID.overscaledZ||(mt.tileID.isLessThan(Wt.tileID)?-1:1)})}var je=this.crossTileSymbolIndex.addLayer(Se,Q[Se.source],f.center.lng);D=D||je}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(g.browser.now(),f.zoom))&&(this.pauseablePlacement=new Oa(f,this._order,P,v,S,T,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(g.browser.now()),G=!0),D&&this.pauseablePlacement.placement.setStale()),G||D)for(var lt=0,Re=this._order;lt<Re.length;lt+=1){var at=this._layers[Re[lt]];at.type==="symbol"&&this.placement.updateLayerOpacities(at,Q[at.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(g.browser.now())},h.prototype._releaseSymbolFadeTiles=function(){for(var f in this.sourceCaches)this.sourceCaches[f].releaseSymbolFadeTiles()},h.prototype.getImages=function(f,v,S){this.imageManager.getImages(v.icons,S),this._updateTilesForChangedImages();var T=this.sourceCaches[v.source];T&&T.setDependencies(v.tileID.key,v.type,v.icons)},h.prototype.getGlyphs=function(f,v,S){this.glyphManager.getGlyphs(v.stacks,S)},h.prototype.getResource=function(f,v,S){return g.makeRequest(v,S)},h}(g.Evented);ys.getSourceType=function(c){return bt[c]},ys.setSourceType=function(c,h){bt[c]=h},ys.registerForPluginStateChange=g.registerForPluginStateChange;var Sa=g.createLayout([{name:"a_pos",type:"Int16",components:2}]),_o=Si(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),ec=Si(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),kc=Si(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Yu=Si(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),fs=Si("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Jo=Si(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Ol=Si(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),bu=Si("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Ts=Si("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),x=Si("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),M=Si(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),z=Si(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Si(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),se=Si(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ie=Si(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),ct=Si(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Dt=Si(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Rt=Si(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),wr=Si(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Br=Si(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Xn=Si(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),bi=Si(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),ci=Si(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Ei=Si(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ua=Si(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ca=Si(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Si(c,h){var f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=h.match(/attribute ([\w]+) ([\w]+)/g),S=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=T?T.concat(S):S,D={};return{fragmentSource:c=c.replace(f,function(G,Q,ge,Ee,Se){return D[Se]=!0,Q==="define"?`
#ifndef HAS_UNIFORM_u_`+Se+`
varying `+ge+" "+Ee+" "+Se+`;
#else
uniform `+ge+" "+Ee+" u_"+Se+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Se+`
    `+ge+" "+Ee+" "+Se+" = u_"+Se+`;
#endif
`}),vertexSource:h=h.replace(f,function(G,Q,ge,Ee,Se){var We=Ee==="float"?"vec2":"vec4",je=Se.match(/color/)?"color":We;return D[Se]?Q==="define"?`
#ifndef HAS_UNIFORM_u_`+Se+`
uniform lowp float u_`+Se+`_t;
attribute `+ge+" "+We+" a_"+Se+`;
varying `+ge+" "+Ee+" "+Se+`;
#else
uniform `+ge+" "+Ee+" u_"+Se+`;
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Se+`
    `+Se+" = a_"+Se+`;
#else
    `+ge+" "+Ee+" "+Se+" = u_"+Se+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Se+`
    `+Se+" = unpack_mix_"+je+"(a_"+Se+", u_"+Se+`_t);
#else
    `+ge+" "+Ee+" "+Se+" = u_"+Se+`;
#endif
`:Q==="define"?`
#ifndef HAS_UNIFORM_u_`+Se+`
uniform lowp float u_`+Se+`_t;
attribute `+ge+" "+We+" a_"+Se+`;
#else
uniform `+ge+" "+Ee+" u_"+Se+`;
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Se+`
    `+ge+" "+Ee+" "+Se+" = a_"+Se+`;
#else
    `+ge+" "+Ee+" "+Se+" = u_"+Se+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Se+`
    `+ge+" "+Ee+" "+Se+" = unpack_mix_"+je+"(a_"+Se+", u_"+Se+`_t);
#else
    `+ge+" "+Ee+" "+Se+" = u_"+Se+`;
#endif
`}),staticAttributes:v,staticUniforms:P}}var _s=Object.freeze({__proto__:null,prelude:_o,background:ec,backgroundPattern:kc,circle:Yu,clippingMask:fs,heatmap:Jo,heatmapTexture:Ol,collisionBox:bu,collisionCircle:Ts,debug:x,fill:M,fillOutline:z,fillOutlinePattern:R,fillPattern:se,fillExtrusion:Ie,fillExtrusionPattern:ct,hillshadePrepare:Dt,hillshade:Rt,line:wr,lineGradient:Br,linePattern:Xn,lineSDF:bi,raster:ci,symbolIcon:Ei,symbolSDF:ua,symbolTextAndIcon:Ca}),uu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function ll(c){for(var h=[],f=0;f<c.length;f++)if(c[f]!==null){var v=c[f].split(" ");h.push(v.pop())}return h}uu.prototype.bind=function(c,h,f,v,S,T,P,D){this.context=c;for(var G=this.boundPaintVertexBuffers.length!==v.length,Q=0;!G&&Q<v.length;Q++)this.boundPaintVertexBuffers[Q]!==v[Q]&&(G=!0);c.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===f&&!G&&this.boundIndexBuffer===S&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===D?(c.bindVertexArrayOES.set(this.vao),P&&P.bind(),S&&S.dynamicDraw&&S.bind(),D&&D.bind()):this.freshBind(h,f,v,S,T,P,D)},uu.prototype.freshBind=function(c,h,f,v,S,T,P){var D,G=c.numAttributes,Q=this.context,ge=Q.gl;if(Q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Q.extVertexArrayObject.createVertexArrayOES(),Q.bindVertexArrayOES.set(this.vao),D=0,this.boundProgram=c,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=v,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=P;else{D=Q.currentNumAttributes||0;for(var Ee=G;Ee<D;Ee++)ge.disableVertexAttribArray(Ee)}h.enableAttributes(ge,c);for(var Se=0,We=f;Se<We.length;Se+=1)We[Se].enableAttributes(ge,c);T&&T.enableAttributes(ge,c),P&&P.enableAttributes(ge,c),h.bind(),h.setVertexAttribPointers(ge,c,S);for(var je=0,lt=f;je<lt.length;je+=1){var Re=lt[je];Re.bind(),Re.setVertexAttribPointers(ge,c,S)}T&&(T.bind(),T.setVertexAttribPointers(ge,c,S)),v&&v.bind(),P&&(P.bind(),P.setVertexAttribPointers(ge,c,S)),Q.currentNumAttributes=G},uu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var mf=function(c,h,f,v,S,T){var P=c.gl;this.program=P.createProgram();for(var D=ll(f.staticAttributes),G=v?v.getBinderAttributes():[],Q=D.concat(G),ge=f.staticUniforms?ll(f.staticUniforms):[],Ee=v?v.getBinderUniforms():[],Se=[],We=0,je=ge.concat(Ee);We<je.length;We+=1){var lt=je[We];Se.indexOf(lt)<0&&Se.push(lt)}var Re=v?v.defines():[];T&&Re.push("#define OVERDRAW_INSPECTOR;");var at=Re.concat(_o.fragmentSource,f.fragmentSource).join(`
`),mt=Re.concat(_o.vertexSource,f.vertexSource).join(`
`),Wt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Wt,at),P.compileShader(Wt),P.attachShader(this.program,Wt);var vr=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(vr,mt),P.compileShader(vr),P.attachShader(this.program,vr),this.attributes={};var ur={};this.numAttributes=Q.length;for(var hr=0;hr<this.numAttributes;hr++)Q[hr]&&(P.bindAttribLocation(this.program,hr,Q[hr]),this.attributes[Q[hr]]=hr);P.linkProgram(this.program),P.deleteShader(vr),P.deleteShader(Wt);for(var Lr=0;Lr<Se.length;Lr++){var Jr=Se[Lr];if(Jr&&!ur[Jr]){var Yr=P.getUniformLocation(this.program,Jr);Yr&&(ur[Jr]=Yr)}}this.fixedUniforms=S(c,ur),this.binderUniforms=v?v.getUniforms(c,ur):[]}}};function cl(c,h,f){var v=1/oa(f,1,h.transform.tileZoom),S=Math.pow(2,f.tileID.overscaledZ),T=f.tileSize*Math.pow(2,h.transform.tileZoom)/S,P=T*(f.tileID.canonical.x+f.tileID.wrap*S),D=T*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[v,c.fromScale,c.toScale],u_fade:c.t,u_pixel_coord_upper:[P>>16,D>>16],u_pixel_coord_lower:[65535&P,65535&D]}}mf.prototype.draw=function(c,h,f,v,S,T,P,D,G,Q,ge,Ee,Se,We,je,lt){var Re,at=c.gl;if(!this.failedToCreate){for(var mt in c.program.set(this.program),c.setDepthMode(f),c.setStencilMode(v),c.setColorMode(S),c.setCullFace(T),this.fixedUniforms)this.fixedUniforms[mt].set(P[mt]);We&&We.setUniforms(c,this.binderUniforms,Ee,{zoom:Se});for(var Wt=(Re={},Re[at.LINES]=2,Re[at.TRIANGLES]=3,Re[at.LINE_STRIP]=1,Re)[h],vr=0,ur=ge.get();vr<ur.length;vr+=1){var hr=ur[vr],Lr=hr.vaos||(hr.vaos={});(Lr[D]||(Lr[D]=new uu)).bind(c,this,G,We?We.getPaintVertexBuffers():[],Q,hr.vertexOffset,je,lt),at.drawElements(h,hr.primitiveLength*Wt,at.UNSIGNED_SHORT,hr.primitiveOffset*Wt*2)}}};var tc=function(c,h,f,v){var S=h.style.light,T=S.properties.get("position"),P=[T.x,T.y,T.z],D=g.create$1();S.properties.get("anchor")==="viewport"&&g.fromRotation(D,-h.transform.angle),g.transformMat3(P,P,D);var G=S.properties.get("color");return{u_matrix:c,u_lightpos:P,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+f,u_opacity:v}},Eu=function(c,h,f,v,S,T,P){return g.extend(tc(c,h,f,v),cl(T,h,P),{u_height_factor:-Math.pow(2,S.overscaledZ)/P.tileSize/8})},Lu=function(c){return{u_matrix:c}},ku=function(c,h,f,v){return g.extend(Lu(c),cl(f,h,v))},fo=function(c,h){return{u_matrix:c,u_world:h}},$f=function(c,h,f,v,S){return g.extend(ku(c,h,f,v),{u_world:S})},Qf=function(c,h,f,v){var S,T,P=c.transform;if(v.paint.get("circle-pitch-alignment")==="map"){var D=oa(f,1,P.zoom);S=!0,T=[D,D]}else S=!1,T=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(v.paint.get("circle-pitch-scale")==="map"),u_matrix:c.translatePosMatrix(h.posMatrix,f,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:g.browser.devicePixelRatio,u_extrude_scale:T}},xs=function(c,h,f){var v=oa(f,1,h.zoom),S=Math.pow(2,h.zoom-f.tileID.overscaledZ),T=f.tileID.overscaleFactor();return{u_matrix:c,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:v,u_extrude_scale:[h.pixelsToGLUnits[0]/(v*S),h.pixelsToGLUnits[1]/(v*S)],u_overscale_factor:T}},gf=function(c,h,f){return{u_matrix:c,u_inv_matrix:h,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}},Du=function(c,h,f){return f===void 0&&(f=1),{u_matrix:c,u_color:h,u_overlay:0,u_overlay_scale:f}},Ks=function(c){return{u_matrix:c}},rc=function(c,h,f,v){return{u_matrix:c,u_extrude_scale:oa(h,1,f),u_intensity:v}},qu=function(c,h,f){var v=c.transform;return{u_matrix:zs(c,h,f),u_ratio:1/oa(h,1,v.zoom),u_device_pixel_ratio:g.browser.devicePixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},Aa=function(c,h,f,v){return g.extend(qu(c,h,f),{u_image:0,u_image_height:v})},nc=function(c,h,f,v){var S=c.transform,T=Il(h,S);return{u_matrix:zs(c,h,f),u_texsize:h.imageAtlasTexture.size,u_ratio:1/oa(h,1,S.zoom),u_device_pixel_ratio:g.browser.devicePixelRatio,u_image:0,u_scale:[T,v.fromScale,v.toScale],u_fade:v.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Oh=function(c,h,f,v,S){var T=c.lineAtlas,P=Il(h,c.transform),D=f.layout.get("line-cap")==="round",G=T.getDash(v.from,D),Q=T.getDash(v.to,D),ge=G.width*S.fromScale,Ee=Q.width*S.toScale;return g.extend(qu(c,h,f),{u_patternscale_a:[P/ge,-G.height/2],u_patternscale_b:[P/Ee,-Q.height/2],u_sdfgamma:T.width/(256*Math.min(ge,Ee)*g.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:Q.y,u_mix:S.t})};function Il(c,h){return 1/oa(c,1,h.tileZoom)}function zs(c,h,f){return c.translatePosMatrix(h.tileID.posMatrix,h,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}var up=function(c,h,f,v,S){return{u_matrix:c,u_tl_parent:h,u_scale_parent:f,u_buffer_scale:1,u_fade_t:v.mix,u_opacity:v.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(P=S.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(T=S.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Ih(S.paint.get("raster-hue-rotate"))};var T,P};function Ih(c){c*=Math.PI/180;var h=Math.sin(c),f=Math.cos(c);return[(2*f+1)/3,(-Math.sqrt(3)*h-f+1)/3,(Math.sqrt(3)*h-f+1)/3]}var yf,fl=function(c,h,f,v,S,T,P,D,G,Q){var ge=S.transform;return{u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:ge.cameraToCenterDistance,u_pitch:ge.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:ge.width/ge.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:P,u_coord_matrix:D,u_is_text:+G,u_pitch_with_map:+v,u_texsize:Q,u_texture:0}},Ku=function(c,h,f,v,S,T,P,D,G,Q,ge){var Ee=S.transform;return g.extend(fl(c,h,f,v,S,T,P,D,G,Q),{u_gamma_scale:v?Math.cos(Ee._pitch)*Ee.cameraToCenterDistance:1,u_device_pixel_ratio:g.browser.devicePixelRatio,u_is_halo:+ge})},Rl=function(c,h,f,v,S,T,P,D,G,Q){return g.extend(Ku(c,h,f,v,S,T,P,D,!0,G,!0),{u_texsize_icon:Q,u_texture_icon:1})},ic=function(c,h,f){return{u_matrix:c,u_opacity:h,u_color:f}},Ll=function(c,h,f,v,S,T){return g.extend(function(P,D,G,Q){var ge=G.imageManager.getPattern(P.from.toString()),Ee=G.imageManager.getPattern(P.to.toString()),Se=G.imageManager.getPixelSize(),We=Se.width,je=Se.height,lt=Math.pow(2,Q.tileID.overscaledZ),Re=Q.tileSize*Math.pow(2,G.transform.tileZoom)/lt,at=Re*(Q.tileID.canonical.x+Q.tileID.wrap*lt),mt=Re*Q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ge.tl,u_pattern_br_a:ge.br,u_pattern_tl_b:Ee.tl,u_pattern_br_b:Ee.br,u_texsize:[We,je],u_mix:D.t,u_pattern_size_a:ge.displaySize,u_pattern_size_b:Ee.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/oa(Q,1,G.transform.tileZoom),u_pixel_coord_upper:[at>>16,mt>>16],u_pixel_coord_lower:[65535&at,65535&mt]}}(v,T,f,S),{u_matrix:c,u_opacity:h})},ac={fillExtrusion:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_lightpos:new g.Uniform3f(c,h.u_lightpos),u_lightintensity:new g.Uniform1f(c,h.u_lightintensity),u_lightcolor:new g.Uniform3f(c,h.u_lightcolor),u_vertical_gradient:new g.Uniform1f(c,h.u_vertical_gradient),u_opacity:new g.Uniform1f(c,h.u_opacity)}},fillExtrusionPattern:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_lightpos:new g.Uniform3f(c,h.u_lightpos),u_lightintensity:new g.Uniform1f(c,h.u_lightintensity),u_lightcolor:new g.Uniform3f(c,h.u_lightcolor),u_vertical_gradient:new g.Uniform1f(c,h.u_vertical_gradient),u_height_factor:new g.Uniform1f(c,h.u_height_factor),u_image:new g.Uniform1i(c,h.u_image),u_texsize:new g.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new g.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new g.Uniform3f(c,h.u_scale),u_fade:new g.Uniform1f(c,h.u_fade),u_opacity:new g.Uniform1f(c,h.u_opacity)}},fill:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix)}},fillPattern:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_image:new g.Uniform1i(c,h.u_image),u_texsize:new g.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new g.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new g.Uniform3f(c,h.u_scale),u_fade:new g.Uniform1f(c,h.u_fade)}},fillOutline:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_world:new g.Uniform2f(c,h.u_world)}},fillOutlinePattern:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_world:new g.Uniform2f(c,h.u_world),u_image:new g.Uniform1i(c,h.u_image),u_texsize:new g.Uniform2f(c,h.u_texsize),u_pixel_coord_upper:new g.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(c,h.u_pixel_coord_lower),u_scale:new g.Uniform3f(c,h.u_scale),u_fade:new g.Uniform1f(c,h.u_fade)}},circle:function(c,h){return{u_camera_to_center_distance:new g.Uniform1f(c,h.u_camera_to_center_distance),u_scale_with_map:new g.Uniform1i(c,h.u_scale_with_map),u_pitch_with_map:new g.Uniform1i(c,h.u_pitch_with_map),u_extrude_scale:new g.Uniform2f(c,h.u_extrude_scale),u_device_pixel_ratio:new g.Uniform1f(c,h.u_device_pixel_ratio),u_matrix:new g.UniformMatrix4f(c,h.u_matrix)}},collisionBox:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_camera_to_center_distance:new g.Uniform1f(c,h.u_camera_to_center_distance),u_pixels_to_tile_units:new g.Uniform1f(c,h.u_pixels_to_tile_units),u_extrude_scale:new g.Uniform2f(c,h.u_extrude_scale),u_overscale_factor:new g.Uniform1f(c,h.u_overscale_factor)}},collisionCircle:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_inv_matrix:new g.UniformMatrix4f(c,h.u_inv_matrix),u_camera_to_center_distance:new g.Uniform1f(c,h.u_camera_to_center_distance),u_viewport_size:new g.Uniform2f(c,h.u_viewport_size)}},debug:function(c,h){return{u_color:new g.UniformColor(c,h.u_color),u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_overlay:new g.Uniform1i(c,h.u_overlay),u_overlay_scale:new g.Uniform1f(c,h.u_overlay_scale)}},clippingMask:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix)}},heatmap:function(c,h){return{u_extrude_scale:new g.Uniform1f(c,h.u_extrude_scale),u_intensity:new g.Uniform1f(c,h.u_intensity),u_matrix:new g.UniformMatrix4f(c,h.u_matrix)}},heatmapTexture:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_world:new g.Uniform2f(c,h.u_world),u_image:new g.Uniform1i(c,h.u_image),u_color_ramp:new g.Uniform1i(c,h.u_color_ramp),u_opacity:new g.Uniform1f(c,h.u_opacity)}},hillshade:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_image:new g.Uniform1i(c,h.u_image),u_latrange:new g.Uniform2f(c,h.u_latrange),u_light:new g.Uniform2f(c,h.u_light),u_shadow:new g.UniformColor(c,h.u_shadow),u_highlight:new g.UniformColor(c,h.u_highlight),u_accent:new g.UniformColor(c,h.u_accent)}},hillshadePrepare:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_image:new g.Uniform1i(c,h.u_image),u_dimension:new g.Uniform2f(c,h.u_dimension),u_zoom:new g.Uniform1f(c,h.u_zoom),u_unpack:new g.Uniform4f(c,h.u_unpack)}},line:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_ratio:new g.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(c,h.u_units_to_pixels)}},lineGradient:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_ratio:new g.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(c,h.u_units_to_pixels),u_image:new g.Uniform1i(c,h.u_image),u_image_height:new g.Uniform1f(c,h.u_image_height)}},linePattern:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_texsize:new g.Uniform2f(c,h.u_texsize),u_ratio:new g.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(c,h.u_device_pixel_ratio),u_image:new g.Uniform1i(c,h.u_image),u_units_to_pixels:new g.Uniform2f(c,h.u_units_to_pixels),u_scale:new g.Uniform3f(c,h.u_scale),u_fade:new g.Uniform1f(c,h.u_fade)}},lineSDF:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_ratio:new g.Uniform1f(c,h.u_ratio),u_device_pixel_ratio:new g.Uniform1f(c,h.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(c,h.u_units_to_pixels),u_patternscale_a:new g.Uniform2f(c,h.u_patternscale_a),u_patternscale_b:new g.Uniform2f(c,h.u_patternscale_b),u_sdfgamma:new g.Uniform1f(c,h.u_sdfgamma),u_image:new g.Uniform1i(c,h.u_image),u_tex_y_a:new g.Uniform1f(c,h.u_tex_y_a),u_tex_y_b:new g.Uniform1f(c,h.u_tex_y_b),u_mix:new g.Uniform1f(c,h.u_mix)}},raster:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_tl_parent:new g.Uniform2f(c,h.u_tl_parent),u_scale_parent:new g.Uniform1f(c,h.u_scale_parent),u_buffer_scale:new g.Uniform1f(c,h.u_buffer_scale),u_fade_t:new g.Uniform1f(c,h.u_fade_t),u_opacity:new g.Uniform1f(c,h.u_opacity),u_image0:new g.Uniform1i(c,h.u_image0),u_image1:new g.Uniform1i(c,h.u_image1),u_brightness_low:new g.Uniform1f(c,h.u_brightness_low),u_brightness_high:new g.Uniform1f(c,h.u_brightness_high),u_saturation_factor:new g.Uniform1f(c,h.u_saturation_factor),u_contrast_factor:new g.Uniform1f(c,h.u_contrast_factor),u_spin_weights:new g.Uniform3f(c,h.u_spin_weights)}},symbolIcon:function(c,h){return{u_is_size_zoom_constant:new g.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new g.Uniform1f(c,h.u_size_t),u_size:new g.Uniform1f(c,h.u_size),u_camera_to_center_distance:new g.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new g.Uniform1f(c,h.u_pitch),u_rotate_symbol:new g.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new g.Uniform1f(c,h.u_fade_change),u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new g.Uniform1i(c,h.u_is_text),u_pitch_with_map:new g.Uniform1i(c,h.u_pitch_with_map),u_texsize:new g.Uniform2f(c,h.u_texsize),u_texture:new g.Uniform1i(c,h.u_texture)}},symbolSDF:function(c,h){return{u_is_size_zoom_constant:new g.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new g.Uniform1f(c,h.u_size_t),u_size:new g.Uniform1f(c,h.u_size),u_camera_to_center_distance:new g.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new g.Uniform1f(c,h.u_pitch),u_rotate_symbol:new g.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new g.Uniform1f(c,h.u_fade_change),u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new g.Uniform1i(c,h.u_is_text),u_pitch_with_map:new g.Uniform1i(c,h.u_pitch_with_map),u_texsize:new g.Uniform2f(c,h.u_texsize),u_texture:new g.Uniform1i(c,h.u_texture),u_gamma_scale:new g.Uniform1f(c,h.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(c,h.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(c,h.u_is_halo)}},symbolTextAndIcon:function(c,h){return{u_is_size_zoom_constant:new g.Uniform1i(c,h.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(c,h.u_is_size_feature_constant),u_size_t:new g.Uniform1f(c,h.u_size_t),u_size:new g.Uniform1f(c,h.u_size),u_camera_to_center_distance:new g.Uniform1f(c,h.u_camera_to_center_distance),u_pitch:new g.Uniform1f(c,h.u_pitch),u_rotate_symbol:new g.Uniform1i(c,h.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(c,h.u_aspect_ratio),u_fade_change:new g.Uniform1f(c,h.u_fade_change),u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(c,h.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(c,h.u_coord_matrix),u_is_text:new g.Uniform1i(c,h.u_is_text),u_pitch_with_map:new g.Uniform1i(c,h.u_pitch_with_map),u_texsize:new g.Uniform2f(c,h.u_texsize),u_texsize_icon:new g.Uniform2f(c,h.u_texsize_icon),u_texture:new g.Uniform1i(c,h.u_texture),u_texture_icon:new g.Uniform1i(c,h.u_texture_icon),u_gamma_scale:new g.Uniform1f(c,h.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(c,h.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(c,h.u_is_halo)}},background:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_opacity:new g.Uniform1f(c,h.u_opacity),u_color:new g.UniformColor(c,h.u_color)}},backgroundPattern:function(c,h){return{u_matrix:new g.UniformMatrix4f(c,h.u_matrix),u_opacity:new g.Uniform1f(c,h.u_opacity),u_image:new g.Uniform1i(c,h.u_image),u_pattern_tl_a:new g.Uniform2f(c,h.u_pattern_tl_a),u_pattern_br_a:new g.Uniform2f(c,h.u_pattern_br_a),u_pattern_tl_b:new g.Uniform2f(c,h.u_pattern_tl_b),u_pattern_br_b:new g.Uniform2f(c,h.u_pattern_br_b),u_texsize:new g.Uniform2f(c,h.u_texsize),u_mix:new g.Uniform1f(c,h.u_mix),u_pattern_size_a:new g.Uniform2f(c,h.u_pattern_size_a),u_pattern_size_b:new g.Uniform2f(c,h.u_pattern_size_b),u_scale_a:new g.Uniform1f(c,h.u_scale_a),u_scale_b:new g.Uniform1f(c,h.u_scale_b),u_pixel_coord_upper:new g.Uniform2f(c,h.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(c,h.u_pixel_coord_lower),u_tile_units_to_pixels:new g.Uniform1f(c,h.u_tile_units_to_pixels)}}};function kl(c,h,f,v,S,T,P){for(var D=c.context,G=D.gl,Q=c.useProgram("collisionBox"),ge=[],Ee=0,Se=0,We=0;We<v.length;We++){var je=v[We],lt=h.getTile(je),Re=lt.getBucket(f);if(Re){var at=je.posMatrix;S[0]===0&&S[1]===0||(at=c.translatePosMatrix(je.posMatrix,lt,S,T));var mt=P?Re.textCollisionBox:Re.iconCollisionBox,Wt=Re.collisionCircleArray;if(Wt.length>0){var vr=g.create(),ur=at;g.mul(vr,Re.placementInvProjMatrix,c.transform.glCoordMatrix),g.mul(vr,vr,Re.placementViewportMatrix),ge.push({circleArray:Wt,circleOffset:Se,transform:ur,invTransform:vr}),Se=Ee+=Wt.length/4}mt&&Q.draw(D,G.LINES,Te.disabled,Ze.disabled,c.colorModeForRenderPass(),gt.disabled,xs(at,c.transform,lt),f.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,null,c.transform.zoom,null,null,mt.collisionVertexBuffer)}}if(P&&ge.length){var hr=c.useProgram("collisionCircle"),Lr=new g.StructArrayLayout2f1f2i16;Lr.resize(4*Ee),Lr._trim();for(var Jr=0,Yr=0,yn=ge;Yr<yn.length;Yr+=1)for(var Jn=yn[Yr],ei=0;ei<Jn.circleArray.length/4;ei++){var ni=4*ei,Wi=Jn.circleArray[ni+0],bn=Jn.circleArray[ni+1],pi=Jn.circleArray[ni+2],Ti=Jn.circleArray[ni+3];Lr.emplace(Jr++,Wi,bn,pi,Ti,0),Lr.emplace(Jr++,Wi,bn,pi,Ti,1),Lr.emplace(Jr++,Wi,bn,pi,Ti,2),Lr.emplace(Jr++,Wi,bn,pi,Ti,3)}(!yf||yf.length<2*Ee)&&(yf=function(Ga){var Ro=2*Ga,Lo=new g.StructArrayLayout3ui6;Lo.resize(Ro),Lo._trim();for(var Qa=0;Qa<Ro;Qa++){var po=6*Qa;Lo.uint16[po+0]=4*Qa+0,Lo.uint16[po+1]=4*Qa+1,Lo.uint16[po+2]=4*Qa+2,Lo.uint16[po+3]=4*Qa+2,Lo.uint16[po+4]=4*Qa+3,Lo.uint16[po+5]=4*Qa+0}return Lo}(Ee));for(var mi=D.createIndexBuffer(yf,!0),ui=D.createVertexBuffer(Lr,g.collisionCircleLayout.members,!0),Oi=0,fi=ge;Oi<fi.length;Oi+=1){var li=fi[Oi],ho=gf(li.transform,li.invTransform,c.transform);hr.draw(D,G.TRIANGLES,Te.disabled,Ze.disabled,c.colorModeForRenderPass(),gt.disabled,ho,f.id,ui,mi,g.SegmentVector.simpleSegment(0,2*li.circleOffset,li.circleArray.length,li.circleArray.length/2),null,c.transform.zoom,null,null,null)}ui.destroy(),mi.destroy()}}var $s=g.identity(new Float32Array(16));function _f(c,h,f,v,S,T){var P=g.getAnchorAlignment(c),D=-(P.horizontalAlign-.5)*h,G=-(P.verticalAlign-.5)*f,Q=g.evaluateVariableOffset(c,v);return new g.Point((D/S+Q[0])*T,(G/S+Q[1])*T)}function xf(c,h,f,v,S,T,P,D,G,Q,ge){var Ee=c.text.placedSymbolArray,Se=c.text.dynamicLayoutVertexArray,We=c.icon.dynamicLayoutVertexArray,je={};Se.clear();for(var lt=0;lt<Ee.length;lt++){var Re=Ee.get(lt),at=Re.hidden||!Re.crossTileID||c.allowVerticalPlacement&&!Re.placedOrientation?null:v[Re.crossTileID];if(at){var mt=new g.Point(Re.anchorX,Re.anchorY),Wt=ji(mt,f?D:P),vr=Hi(T.cameraToCenterDistance,Wt.signedDistanceFromCamera),ur=S.evaluateSizeForFeature(c.textSizeData,Q,Re)*vr/g.ONE_EM;f&&(ur*=c.tilePixelRatio/G);for(var hr=_f(at.anchor,at.width,at.height,at.textOffset,at.textBoxScale,ur),Lr=f?ji(mt.add(hr),P).point:Wt.point.add(h?hr.rotate(-T.angle):hr),Jr=c.allowVerticalPlacement&&Re.placedOrientation===g.WritingMode.vertical?Math.PI/2:0,Yr=0;Yr<Re.numGlyphs;Yr++)g.addDynamicAttributes(Se,Lr,Jr);ge&&Re.associatedIconIndex>=0&&(je[Re.associatedIconIndex]={shiftedAnchor:Lr,angle:Jr})}else he(Re.numGlyphs,Se)}if(ge){We.clear();for(var yn=c.icon.placedSymbolArray,Jn=0;Jn<yn.length;Jn++){var ei=yn.get(Jn);if(ei.hidden)he(ei.numGlyphs,We);else{var ni=je[Jn];if(ni)for(var Wi=0;Wi<ei.numGlyphs;Wi++)g.addDynamicAttributes(We,ni.shiftedAnchor,ni.angle);else he(ei.numGlyphs,We)}}c.icon.dynamicLayoutVertexBuffer.updateData(We)}c.text.dynamicLayoutVertexBuffer.updateData(Se)}function bf(c,h,f){return f.iconsInText&&h?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function hl(c,h,f,v,S,T,P,D,G,Q,ge,Ee){for(var Se=c.context,We=Se.gl,je=c.transform,lt=D==="map",Re=G==="map",at=lt&&f.layout.get("symbol-placement")!=="point",mt=lt&&!Re&&!at,Wt=f.layout.get("symbol-sort-key").constantOr(1)!==void 0,vr=!1,ur=c.depthModeForSublayer(0,Te.ReadOnly),hr=f.layout.get("text-variable-anchor"),Lr=[],Jr=0,Yr=v;Jr<Yr.length;Jr+=1){var yn=Yr[Jr],Jn=h.getTile(yn),ei=Jn.getBucket(f);if(ei){var ni=S?ei.text:ei.icon;if(ni&&ni.segments.get().length){var Wi=ni.programConfigurations.get(f.id),bn=S||ei.sdfIcons,pi=S?ei.textSizeData:ei.iconSizeData,Ti=Re||je.pitch!==0,mi=c.useProgram(bf(bn,S,ei),Wi),ui=g.evaluateSizeForZoom(pi,je.zoom),Oi=void 0,fi=[0,0],li=void 0,ho=void 0,Ga=null,Ro=void 0;if(S)li=Jn.glyphAtlasTexture,ho=We.LINEAR,Oi=Jn.glyphAtlasTexture.size,ei.iconsInText&&(fi=Jn.imageAtlasTexture.size,Ga=Jn.imageAtlasTexture,Ro=Ti||c.options.rotating||c.options.zooming||pi.kind==="composite"||pi.kind==="camera"?We.LINEAR:We.NEAREST);else{var Lo=f.layout.get("icon-size").constantOr(0)!==1||ei.iconsNeedLinear;li=Jn.imageAtlasTexture,ho=bn||c.options.rotating||c.options.zooming||Lo||Ti?We.LINEAR:We.NEAREST,Oi=Jn.imageAtlasTexture.size}var Qa=oa(Jn,1,c.transform.zoom),po=qt(yn.posMatrix,Re,lt,c.transform,Qa),Ja=Gt(yn.posMatrix,Re,lt,c.transform,Qa),Wo=hr&&ei.hasTextData(),zu=f.layout.get("icon-text-fit")!=="none"&&Wo&&ei.hasIconData();at&&so(ei,yn.posMatrix,c,S,po,Ja,Re,Q);var hs=c.translatePosMatrix(yn.posMatrix,Jn,T,P),Xo=at||S&&hr||zu?$s:po,eu=c.translatePosMatrix(Ja,Jn,T,P,!0),Vl=bn&&f.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,yl={program:mi,buffers:ni,uniformValues:bn?ei.iconsInText?Rl(pi.kind,ui,mt,Re,c,hs,Xo,eu,Oi,fi):Ku(pi.kind,ui,mt,Re,c,hs,Xo,eu,S,Oi,!0):fl(pi.kind,ui,mt,Re,c,hs,Xo,eu,S,Oi),atlasTexture:li,atlasTextureIcon:Ga,atlasInterpolation:ho,atlasInterpolationIcon:Ro,isSDF:bn,hasHalo:Vl};if(Wt&&ei.canOverlap){vr=!0;for(var du=0,Gl=ni.segments.get();du<Gl.length;du+=1){var gc=Gl[du];Lr.push({segments:new g.SegmentVector([gc]),sortKey:gc.sortKey,state:yl})}}else Lr.push({segments:ni.segments,sortKey:0,state:yl})}}}vr&&Lr.sort(function(tl,Uu){return tl.sortKey-Uu.sortKey});for(var vu=0,_l=Lr;vu<_l.length;vu+=1){var Au=_l[vu],xo=Au.state;if(Se.activeTexture.set(We.TEXTURE0),xo.atlasTexture.bind(xo.atlasInterpolation,We.CLAMP_TO_EDGE),xo.atlasTextureIcon&&(Se.activeTexture.set(We.TEXTURE1),xo.atlasTextureIcon&&xo.atlasTextureIcon.bind(xo.atlasInterpolationIcon,We.CLAMP_TO_EDGE)),xo.isSDF){var Zu=xo.uniformValues;xo.hasHalo&&(Zu.u_is_halo=1,oc(xo.buffers,Au.segments,f,c,xo.program,ur,ge,Ee,Zu)),Zu.u_is_halo=0}oc(xo.buffers,Au.segments,f,c,xo.program,ur,ge,Ee,xo.uniformValues)}}function oc(c,h,f,v,S,T,P,D,G){var Q=v.context;S.draw(Q,Q.gl.TRIANGLES,T,P,D,gt.disabled,G,f.id,c.layoutVertexBuffer,c.indexBuffer,h,f.paint,v.transform.zoom,c.programConfigurations.get(f.id),c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer)}function Dc(c,h,f,v,S,T,P){var D,G,Q,ge,Ee,Se=c.context.gl,We=f.paint.get("fill-pattern"),je=We&&We.constantOr(1),lt=f.getCrossfadeParameters();P?(G=je&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=Se.LINES):(G=je?"fillPattern":"fill",D=Se.TRIANGLES);for(var Re=0,at=v;Re<at.length;Re+=1){var mt=at[Re],Wt=h.getTile(mt);if(!je||Wt.patternsLoaded()){var vr=Wt.getBucket(f);if(vr){var ur=vr.programConfigurations.get(f.id),hr=c.useProgram(G,ur);je&&(c.context.activeTexture.set(Se.TEXTURE0),Wt.imageAtlasTexture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE),ur.updatePaintBuffers(lt));var Lr=We.constantOr(null);if(Lr&&Wt.imageAtlas){var Jr=Wt.imageAtlas,Yr=Jr.patternPositions[Lr.to.toString()],yn=Jr.patternPositions[Lr.from.toString()];Yr&&yn&&ur.setConstantPatternPositions(Yr,yn)}var Jn=c.translatePosMatrix(mt.posMatrix,Wt,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(P){ge=vr.indexBuffer2,Ee=vr.segments2;var ei=[Se.drawingBufferWidth,Se.drawingBufferHeight];Q=G==="fillOutlinePattern"&&je?$f(Jn,c,lt,Wt,ei):fo(Jn,ei)}else ge=vr.indexBuffer,Ee=vr.segments,Q=je?ku(Jn,c,lt,Wt):Lu(Jn);hr.draw(c.context,D,S,c.stencilModeForClipping(mt),T,gt.disabled,Q,f.id,vr.layoutVertexBuffer,ge,Ee,f.paint,c.transform.zoom,ur)}}}}function Ef(c,h,f,v,S,T,P){for(var D=c.context,G=D.gl,Q=f.paint.get("fill-extrusion-pattern"),ge=Q.constantOr(1),Ee=f.getCrossfadeParameters(),Se=f.paint.get("fill-extrusion-opacity"),We=0,je=v;We<je.length;We+=1){var lt=je[We],Re=h.getTile(lt),at=Re.getBucket(f);if(at){var mt=at.programConfigurations.get(f.id),Wt=c.useProgram(ge?"fillExtrusionPattern":"fillExtrusion",mt);ge&&(c.context.activeTexture.set(G.TEXTURE0),Re.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),mt.updatePaintBuffers(Ee));var vr=Q.constantOr(null);if(vr&&Re.imageAtlas){var ur=Re.imageAtlas,hr=ur.patternPositions[vr.to.toString()],Lr=ur.patternPositions[vr.from.toString()];hr&&Lr&&mt.setConstantPatternPositions(hr,Lr)}var Jr=c.translatePosMatrix(lt.posMatrix,Re,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Yr=f.paint.get("fill-extrusion-vertical-gradient"),yn=ge?Eu(Jr,c,Yr,Se,lt,Ee,Re):tc(Jr,c,Yr,Se);Wt.draw(D,D.gl.TRIANGLES,S,T,P,gt.backCCW,yn,f.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,f.paint,c.transform.zoom,mt)}}}function $u(c,h,f,v,S,T){var P=c.context,D=P.gl,G=h.fbo;if(G){var Q=c.useProgram("hillshade");P.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,G.colorAttachment.get());var ge=function(Ee,Se,We){var je=We.paint.get("hillshade-shadow-color"),lt=We.paint.get("hillshade-highlight-color"),Re=We.paint.get("hillshade-accent-color"),at=We.paint.get("hillshade-illumination-direction")*(Math.PI/180);We.paint.get("hillshade-illumination-anchor")==="viewport"&&(at-=Ee.transform.angle);var mt,Wt,vr,ur=!Ee.options.moving;return{u_matrix:Ee.transform.calculatePosMatrix(Se.tileID.toUnwrapped(),ur),u_image:0,u_latrange:(mt=Se.tileID,Wt=Math.pow(2,mt.canonical.z),vr=mt.canonical.y,[new g.MercatorCoordinate(0,vr/Wt).toLngLat().lat,new g.MercatorCoordinate(0,(vr+1)/Wt).toLngLat().lat]),u_light:[We.paint.get("hillshade-exaggeration"),at],u_shadow:je,u_highlight:lt,u_accent:Re}}(c,h,f);Q.draw(P,D.TRIANGLES,v,S,T,gt.disabled,ge,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}}function Rh(c,h,f,v,S,T){var P=c.context,D=P.gl,G=h.dem;if(G&&G.data){var Q=G.dim,ge=G.stride,Ee=G.getPixels();if(P.activeTexture.set(D.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),h.demTexture=h.demTexture||c.getTileTexture(ge),h.demTexture){var Se=h.demTexture;Se.update(Ee,{premultiply:!1}),Se.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else h.demTexture=new g.Texture(P,Ee,D.RGBA,{premultiply:!1}),h.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);P.activeTexture.set(D.TEXTURE0);var We=h.fbo;if(!We){var je=new g.Texture(P,{width:Q,height:Q,data:null},D.RGBA);je.bind(D.LINEAR,D.CLAMP_TO_EDGE),(We=h.fbo=P.createFramebuffer(Q,Q,!0)).colorAttachment.set(je.texture)}P.bindFramebuffer.set(We.framebuffer),P.viewport.set([0,0,Q,Q]),c.useProgram("hillshadePrepare").draw(P,D.TRIANGLES,v,S,T,gt.disabled,function(lt,Re){var at=Re.stride,mt=g.create();return g.ortho(mt,0,g.EXTENT,-g.EXTENT,0,0,1),g.translate(mt,mt,[0,-g.EXTENT,0]),{u_matrix:mt,u_image:1,u_dimension:[at,at],u_zoom:lt.overscaledZ,u_unpack:Re.getUnpackVector()}}(h.tileID,G),f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments),h.needsHillshadePrepare=!1}}function Fc(c,h,f,v,S){var T=v.paint.get("raster-fade-duration");if(T>0){var P=g.browser.now(),D=(P-c.timeAdded)/T,G=h?(P-h.timeAdded)/T:-1,Q=f.getSource(),ge=S.coveringZoomLevel({tileSize:Q.tileSize,roundZoom:Q.roundZoom}),Ee=!h||Math.abs(h.tileID.overscaledZ-ge)>Math.abs(c.tileID.overscaledZ-ge),Se=Ee&&c.refreshedUponExpiration?1:g.clamp(Ee?D:1-G,0,1);return c.refreshedUponExpiration&&D>=1&&(c.refreshedUponExpiration=!1),h?{opacity:1,mix:1-Se}:{opacity:Se,mix:0}}return{opacity:1,mix:0}}var pl=new g.Color(1,0,0,1),sc=new g.Color(0,1,0,1),Jf=new g.Color(0,0,1,1),Dl=new g.Color(1,0,1,1),Lh=new g.Color(0,1,1,1);function eh(c,h,f,v){uc(c,0,h+f/2,c.transform.width,f,v)}function th(c,h,f,v){uc(c,h-f/2,0,f,c.transform.height,v)}function uc(c,h,f,v,S,T){var P=c.context,D=P.gl;D.enable(D.SCISSOR_TEST),D.scissor(h*g.browser.devicePixelRatio,f*g.browser.devicePixelRatio,v*g.browser.devicePixelRatio,S*g.browser.devicePixelRatio),P.clear({color:T}),D.disable(D.SCISSOR_TEST)}function Sf(c,h,f){var v=c.context,S=v.gl,T=f.posMatrix,P=c.useProgram("debug"),D=Te.disabled,G=Ze.disabled,Q=c.colorModeForRenderPass();v.activeTexture.set(S.TEXTURE0),c.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),P.draw(v,S.LINE_STRIP,D,G,Q,gt.disabled,Du(T,g.Color.red),"$debug",c.debugBuffer,c.tileBorderIndexBuffer,c.debugSegments);var ge=h.getTileByID(f.key).latestRawTileData,Ee=Math.floor((ge&&ge.byteLength||0)/1024),Se=h.getTile(f).tileSize,We=512/Math.min(Se,512)*(f.overscaledZ/c.transform.zoom)*.5,je=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(je+=" => "+f.overscaledZ),function(lt,Re){lt.initDebugOverlayCanvas();var at=lt.debugOverlayCanvas,mt=lt.context.gl,Wt=lt.debugOverlayCanvas.getContext("2d");Wt.clearRect(0,0,at.width,at.height),Wt.shadowColor="white",Wt.shadowBlur=2,Wt.lineWidth=1.5,Wt.strokeStyle="white",Wt.textBaseline="top",Wt.font="bold 36px Open Sans, sans-serif",Wt.fillText(Re,5,5),Wt.strokeText(Re,5,5),lt.debugOverlayTexture.update(at),lt.debugOverlayTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE)}(c,je+" "+Ee+"kb"),P.draw(v,S.TRIANGLES,D,G,it.alphaBlended,gt.disabled,Du(T,g.Color.transparent,We),"$debug",c.debugBuffer,c.quadTriangleIndexBuffer,c.debugSegments)}var lc={symbol:function(c,h,f,v,S){if(c.renderPass==="translucent"){var T=Ze.disabled,P=c.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(D,G,Q,ge,Ee,Se,We){for(var je=G.transform,lt=Ee==="map",Re=Se==="map",at=0,mt=D;at<mt.length;at+=1){var Wt=mt[at],vr=ge.getTile(Wt),ur=vr.getBucket(Q);if(ur&&ur.text&&ur.text.segments.get().length){var hr=g.evaluateSizeForZoom(ur.textSizeData,je.zoom),Lr=oa(vr,1,G.transform.zoom),Jr=qt(Wt.posMatrix,Re,lt,G.transform,Lr),Yr=Q.layout.get("icon-text-fit")!=="none"&&ur.hasIconData();if(hr){var yn=Math.pow(2,je.zoom-vr.tileID.overscaledZ);xf(ur,lt,Re,We,g.symbolSize,je,Jr,Wt.posMatrix,yn,hr,Yr)}}}}(v,c,f,h,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),S),f.paint.get("icon-opacity").constantOr(1)!==0&&hl(c,h,f,v,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),T,P),f.paint.get("text-opacity").constantOr(1)!==0&&hl(c,h,f,v,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),T,P),h.map.showCollisionBoxes&&(kl(c,h,f,v,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),kl(c,h,f,v,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))}},circle:function(c,h,f,v){if(c.renderPass==="translucent"){var S=f.paint.get("circle-opacity"),T=f.paint.get("circle-stroke-width"),P=f.paint.get("circle-stroke-opacity"),D=f.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||T.constantOr(1)!==0&&P.constantOr(1)!==0){for(var G=c.context,Q=G.gl,ge=c.depthModeForSublayer(0,Te.ReadOnly),Ee=Ze.disabled,Se=c.colorModeForRenderPass(),We=[],je=0;je<v.length;je++){var lt=v[je],Re=h.getTile(lt),at=Re.getBucket(f);if(at){var mt=at.programConfigurations.get(f.id),Wt={programConfiguration:mt,program:c.useProgram("circle",mt),layoutVertexBuffer:at.layoutVertexBuffer,indexBuffer:at.indexBuffer,uniformValues:Qf(c,lt,Re,f)};if(D)for(var vr=0,ur=at.segments.get();vr<ur.length;vr+=1){var hr=ur[vr];We.push({segments:new g.SegmentVector([hr]),sortKey:hr.sortKey,state:Wt})}else We.push({segments:at.segments,sortKey:0,state:Wt})}}D&&We.sort(function(Jn,ei){return Jn.sortKey-ei.sortKey});for(var Lr=0,Jr=We;Lr<Jr.length;Lr+=1){var Yr=Jr[Lr],yn=Yr.state;yn.program.draw(G,Q.TRIANGLES,ge,Ee,Se,gt.disabled,yn.uniformValues,f.id,yn.layoutVertexBuffer,yn.indexBuffer,Yr.segments,f.paint,c.transform.zoom,yn.programConfiguration)}}}},heatmap:function(c,h,f,v){if(f.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){var S=c.context,T=S.gl,P=Ze.disabled,D=new it([T.ONE,T.ONE],g.Color.transparent,[!0,!0,!0,!0]);(function(We,je,lt){var Re=We.gl;We.activeTexture.set(Re.TEXTURE1),We.viewport.set([0,0,je.width/4,je.height/4]);var at=lt.heatmapFbo;if(at)Re.bindTexture(Re.TEXTURE_2D,at.colorAttachment.get()),We.bindFramebuffer.set(at.framebuffer);else{var mt=Re.createTexture();Re.bindTexture(Re.TEXTURE_2D,mt),Re.texParameteri(Re.TEXTURE_2D,Re.TEXTURE_WRAP_S,Re.CLAMP_TO_EDGE),Re.texParameteri(Re.TEXTURE_2D,Re.TEXTURE_WRAP_T,Re.CLAMP_TO_EDGE),Re.texParameteri(Re.TEXTURE_2D,Re.TEXTURE_MIN_FILTER,Re.LINEAR),Re.texParameteri(Re.TEXTURE_2D,Re.TEXTURE_MAG_FILTER,Re.LINEAR),at=lt.heatmapFbo=We.createFramebuffer(je.width/4,je.height/4,!1),function(Wt,vr,ur,hr){var Lr=Wt.gl;Lr.texImage2D(Lr.TEXTURE_2D,0,Lr.RGBA,vr.width/4,vr.height/4,0,Lr.RGBA,Wt.extRenderToTextureHalfFloat?Wt.extTextureHalfFloat.HALF_FLOAT_OES:Lr.UNSIGNED_BYTE,null),hr.colorAttachment.set(ur)}(We,je,mt,at)}})(S,c,f),S.clear({color:g.Color.transparent});for(var G=0;G<v.length;G++){var Q=v[G];if(!h.hasRenderableParent(Q)){var ge=h.getTile(Q),Ee=ge.getBucket(f);if(Ee){var Se=Ee.programConfigurations.get(f.id);c.useProgram("heatmap",Se).draw(S,T.TRIANGLES,Te.disabled,P,D,gt.disabled,rc(Q.posMatrix,ge,c.transform.zoom,f.paint.get("heatmap-intensity")),f.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,f.paint,c.transform.zoom,Se)}}}S.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(We,je){var lt=We.context,Re=lt.gl,at=je.heatmapFbo;if(at){lt.activeTexture.set(Re.TEXTURE0),Re.bindTexture(Re.TEXTURE_2D,at.colorAttachment.get()),lt.activeTexture.set(Re.TEXTURE1);var mt=je.colorRampTexture;mt||(mt=je.colorRampTexture=new g.Texture(lt,je.colorRamp,Re.RGBA)),mt.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),We.useProgram("heatmapTexture").draw(lt,Re.TRIANGLES,Te.disabled,Ze.disabled,We.colorModeForRenderPass(),gt.disabled,function(Wt,vr,ur,hr){var Lr=g.create();g.ortho(Lr,0,Wt.width,Wt.height,0,0,1);var Jr=Wt.context.gl;return{u_matrix:Lr,u_world:[Jr.drawingBufferWidth,Jr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:vr.paint.get("heatmap-opacity")}}(We,je),je.id,We.viewportBuffer,We.quadTriangleIndexBuffer,We.viewportSegments,je.paint,We.transform.zoom)}}(c,f))},line:function(c,h,f,v){if(c.renderPass==="translucent"){var S=f.paint.get("line-opacity"),T=f.paint.get("line-width");if(S.constantOr(1)!==0&&T.constantOr(1)!==0)for(var P=c.depthModeForSublayer(0,Te.ReadOnly),D=c.colorModeForRenderPass(),G=f.paint.get("line-dasharray"),Q=f.paint.get("line-pattern"),ge=Q.constantOr(1),Ee=f.paint.get("line-gradient"),Se=f.getCrossfadeParameters(),We=ge?"linePattern":G?"lineSDF":Ee?"lineGradient":"line",je=c.context,lt=je.gl,Re=!0,at=0,mt=v;at<mt.length;at+=1){var Wt=mt[at],vr=h.getTile(Wt);if(!ge||vr.patternsLoaded()){var ur=vr.getBucket(f);if(ur){var hr=ur.programConfigurations.get(f.id),Lr=c.context.program.get(),Jr=c.useProgram(We,hr),Yr=Re||Jr.program!==Lr,yn=Q.constantOr(null);if(yn&&vr.imageAtlas){var Jn=vr.imageAtlas,ei=Jn.patternPositions[yn.to.toString()],ni=Jn.patternPositions[yn.from.toString()];ei&&ni&&hr.setConstantPatternPositions(ei,ni)}var Wi=ge?nc(c,vr,f,Se):G?Oh(c,vr,f,G,Se):Ee?Aa(c,vr,f,ur.lineClipsArray.length):qu(c,vr,f);if(ge)je.activeTexture.set(lt.TEXTURE0),vr.imageAtlasTexture.bind(lt.LINEAR,lt.CLAMP_TO_EDGE),hr.updatePaintBuffers(Se);else if(G&&(Yr||c.lineAtlas.dirty))je.activeTexture.set(lt.TEXTURE0),c.lineAtlas.bind(je);else if(Ee){var bn=ur.gradients[f.id],pi=bn.texture;if(f.gradientVersion!==bn.version){var Ti=256;if(f.stepInterpolant){var mi=h.getSource().maxzoom,ui=Wt.canonical.z===mi?Math.ceil(1<<c.transform.maxZoom-Wt.canonical.z):1;Ti=g.clamp(g.nextPowerOfTwo(ur.maxLineLength/g.EXTENT*1024*ui),256,je.maxTextureSize)}bn.gradient=g.renderColorRamp({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Ti,image:bn.gradient||void 0,clips:ur.lineClipsArray}),bn.texture?bn.texture.update(bn.gradient):bn.texture=new g.Texture(je,bn.gradient,lt.RGBA),bn.version=f.gradientVersion,pi=bn.texture}je.activeTexture.set(lt.TEXTURE0),pi.bind(f.stepInterpolant?lt.NEAREST:lt.LINEAR,lt.CLAMP_TO_EDGE)}Jr.draw(je,lt.TRIANGLES,P,c.stencilModeForClipping(Wt),D,gt.disabled,Wi,f.id,ur.layoutVertexBuffer,ur.indexBuffer,ur.segments,f.paint,c.transform.zoom,hr,ur.layoutVertexBuffer2),Re=!1}}}}},fill:function(c,h,f,v){var S=f.paint.get("fill-color"),T=f.paint.get("fill-opacity");if(T.constantOr(1)!==0){var P=c.colorModeForRenderPass(),D=f.paint.get("fill-pattern"),G=c.opaquePassEnabledForLayer()&&!D.constantOr(1)&&S.constantOr(g.Color.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===G){var Q=c.depthModeForSublayer(1,c.renderPass==="opaque"?Te.ReadWrite:Te.ReadOnly);Dc(c,h,f,v,Q,P,!1)}if(c.renderPass==="translucent"&&f.paint.get("fill-antialias")){var ge=c.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,Te.ReadOnly);Dc(c,h,f,v,ge,P,!0)}}},"fill-extrusion":function(c,h,f,v){var S=f.paint.get("fill-extrusion-opacity");if(S!==0&&c.renderPass==="translucent"){var T=new Te(c.context.gl.LEQUAL,Te.ReadWrite,c.depthRangeFor3D);if(S!==1||f.paint.get("fill-extrusion-pattern").constantOr(1))Ef(c,h,f,v,T,Ze.disabled,it.disabled),Ef(c,h,f,v,T,c.stencilModeFor3D(),c.colorModeForRenderPass());else{var P=c.colorModeForRenderPass();Ef(c,h,f,v,T,Ze.disabled,P)}}},hillshade:function(c,h,f,v){if(c.renderPass==="offscreen"||c.renderPass==="translucent"){for(var S=c.context,T=c.depthModeForSublayer(0,Te.ReadOnly),P=c.colorModeForRenderPass(),D=c.renderPass==="translucent"?c.stencilConfigForOverlap(v):[{},v],G=D[0],Q=0,ge=D[1];Q<ge.length;Q+=1){var Ee=ge[Q],Se=h.getTile(Ee);Se.needsHillshadePrepare&&c.renderPass==="offscreen"?Rh(c,Se,f,T,Ze.disabled,P):c.renderPass==="translucent"&&$u(c,Se,f,T,G[Ee.overscaledZ],P)}S.viewport.set([0,0,c.width,c.height])}},raster:function(c,h,f,v){if(c.renderPass==="translucent"&&f.paint.get("raster-opacity")!==0&&v.length)for(var S=c.context,T=S.gl,P=h.getSource(),D=c.useProgram("raster"),G=c.colorModeForRenderPass(),Q=P instanceof xt?[{},v]:c.stencilConfigForOverlap(v),ge=Q[0],Ee=Q[1],Se=Ee[Ee.length-1].overscaledZ,We=!c.options.moving,je=0,lt=Ee;je<lt.length;je+=1){var Re=lt[je],at=c.depthModeForSublayer(Re.overscaledZ-Se,f.paint.get("raster-opacity")===1?Te.ReadWrite:Te.ReadOnly,T.LESS),mt=h.getTile(Re),Wt=c.transform.calculatePosMatrix(Re.toUnwrapped(),We);mt.registerFadeDuration(f.paint.get("raster-fade-duration"));var vr=h.findLoadedParent(Re,0),ur=Fc(mt,vr,h,f,c.transform),hr=void 0,Lr=void 0,Jr=f.paint.get("raster-resampling")==="nearest"?T.NEAREST:T.LINEAR;S.activeTexture.set(T.TEXTURE0),mt.texture.bind(Jr,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(T.TEXTURE1),vr?(vr.texture.bind(Jr,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST),hr=Math.pow(2,vr.tileID.overscaledZ-mt.tileID.overscaledZ),Lr=[mt.tileID.canonical.x*hr%1,mt.tileID.canonical.y*hr%1]):mt.texture.bind(Jr,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST);var Yr=up(Wt,Lr||[0,0],hr||1,ur,f);P instanceof xt?D.draw(S,T.TRIANGLES,at,Ze.disabled,G,gt.disabled,Yr,f.id,P.boundsBuffer,c.quadTriangleIndexBuffer,P.boundsSegments):D.draw(S,T.TRIANGLES,at,ge[Re.overscaledZ],G,gt.disabled,Yr,f.id,c.rasterBoundsBuffer,c.quadTriangleIndexBuffer,c.rasterBoundsSegments)}},background:function(c,h,f){var v=f.paint.get("background-color"),S=f.paint.get("background-opacity");if(S!==0){var T=c.context,P=T.gl,D=c.transform,G=D.tileSize,Q=f.paint.get("background-pattern");if(!c.isPatternMissing(Q)){var ge=!Q&&v.a===1&&S===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass===ge){var Ee=Ze.disabled,Se=c.depthModeForSublayer(0,ge==="opaque"?Te.ReadWrite:Te.ReadOnly),We=c.colorModeForRenderPass(),je=c.useProgram(Q?"backgroundPattern":"background"),lt=D.coveringTiles({tileSize:G});Q&&(T.activeTexture.set(P.TEXTURE0),c.imageManager.bind(c.context));for(var Re=f.getCrossfadeParameters(),at=0,mt=lt;at<mt.length;at+=1){var Wt=mt[at],vr=c.transform.calculatePosMatrix(Wt.toUnwrapped()),ur=Q?Ll(vr,S,c,Q,{tileID:Wt,tileSize:G},Re):ic(vr,S,v);je.draw(T,P.TRIANGLES,Se,Ee,We,gt.disabled,ur,f.id,c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}}}},debug:function(c,h,f){for(var v=0;v<f.length;v++)Sf(c,h,f[v])},custom:function(c,h,f){var v=c.context,S=f.implementation;if(c.renderPass==="offscreen"){var T=S.prerender;T&&(c.setCustomLayerDefaults(),v.setColorMode(c.colorModeForRenderPass()),T.call(S,v.gl,c.transform.customLayerMatrix()),v.setDirty(),c.setBaseState())}else if(c.renderPass==="translucent"){c.setCustomLayerDefaults(),v.setColorMode(c.colorModeForRenderPass()),v.setStencilMode(Ze.disabled);var P=S.renderingMode==="3d"?new Te(c.context.gl.LEQUAL,Te.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,Te.ReadOnly);v.setDepthMode(P),S.render(v.gl,c.transform.customLayerMatrix()),v.setDirty(),c.setBaseState(),v.bindFramebuffer.set(null)}}},Ka=function(c,h){this.context=new be(c),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=Ye.maxUnderzooming+Ye.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ls,this.gpuTimers={}};Ka.prototype.resize=function(c,h){if(this.width=c*g.browser.devicePixelRatio,this.height=h*g.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var f=0,v=this.style._order;f<v.length;f+=1)this.style._layers[v[f]].resize()},Ka.prototype.setup=function(){var c=this.context,h=new g.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(g.EXTENT,0),h.emplaceBack(0,g.EXTENT),h.emplaceBack(g.EXTENT,g.EXTENT),this.tileExtentBuffer=c.createVertexBuffer(h,Sa.members),this.tileExtentSegments=g.SegmentVector.simpleSegment(0,0,4,2);var f=new g.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(g.EXTENT,0),f.emplaceBack(0,g.EXTENT),f.emplaceBack(g.EXTENT,g.EXTENT),this.debugBuffer=c.createVertexBuffer(f,Sa.members),this.debugSegments=g.SegmentVector.simpleSegment(0,0,4,5);var v=new g.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(g.EXTENT,0,g.EXTENT,0),v.emplaceBack(0,g.EXTENT,0,g.EXTENT),v.emplaceBack(g.EXTENT,g.EXTENT,g.EXTENT,g.EXTENT),this.rasterBoundsBuffer=c.createVertexBuffer(v,Qe.members),this.rasterBoundsSegments=g.SegmentVector.simpleSegment(0,0,4,2);var S=new g.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(S,Sa.members),this.viewportSegments=g.SegmentVector.simpleSegment(0,0,4,2);var T=new g.StructArrayLayout1ui2;T.emplaceBack(0),T.emplaceBack(1),T.emplaceBack(3),T.emplaceBack(2),T.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(T);var P=new g.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(P),this.emptyTexture=new g.Texture(c,{width:1,height:1,data:new Uint8Array([0,0,0,0])},c.gl.RGBA);var D=this.context.gl;this.stencilClearMode=new Ze({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)},Ka.prototype.clearStencil=function(){var c=this.context,h=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var f=g.create();g.ortho(f,0,this.width,this.height,0,0,1),g.scale(f,f,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,h.TRIANGLES,Te.disabled,this.stencilClearMode,it.disabled,gt.disabled,Ks(f),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ka.prototype._renderTileClippingMasks=function(c,h){if(this.currentStencilSource!==c.source&&c.isTileClipped()&&h&&h.length){this.currentStencilSource=c.source;var f=this.context,v=f.gl;this.nextStencilID+h.length>256&&this.clearStencil(),f.setColorMode(it.disabled),f.setDepthMode(Te.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var T=0,P=h;T<P.length;T+=1){var D=P[T],G=this._tileClippingMaskIDs[D.key]=this.nextStencilID++;S.draw(f,v.TRIANGLES,Te.disabled,new Ze({func:v.ALWAYS,mask:0},G,255,v.KEEP,v.KEEP,v.REPLACE),it.disabled,gt.disabled,Ks(D.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ka.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var c=this.nextStencilID++,h=this.context.gl;return new Ze({func:h.NOTEQUAL,mask:255},c,255,h.KEEP,h.KEEP,h.REPLACE)},Ka.prototype.stencilModeForClipping=function(c){var h=this.context.gl;return new Ze({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,h.KEEP,h.KEEP,h.REPLACE)},Ka.prototype.stencilConfigForOverlap=function(c){var h,f=this.context.gl,v=c.sort(function(G,Q){return Q.overscaledZ-G.overscaledZ}),S=v[v.length-1].overscaledZ,T=v[0].overscaledZ-S+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();for(var P={},D=0;D<T;D++)P[D+S]=new Ze({func:f.GEQUAL,mask:255},D+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=T,[P,v]}return[(h={},h[S]=Ze.disabled,h),v]},Ka.prototype.colorModeForRenderPass=function(){var c=this.context.gl;return this._showOverdrawInspector?new it([c.CONSTANT_COLOR,c.ONE],new g.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?it.unblended:it.alphaBlended},Ka.prototype.depthModeForSublayer=function(c,h,f){if(!this.opaquePassEnabledForLayer())return Te.disabled;var v=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new Te(f||this.context.gl.LEQUAL,h,[v,v])},Ka.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ka.prototype.render=function(c,h){var f=this;this.style=c,this.options=h,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(g.browser.now()),this.imageManager.beginFrame();var v=this.style._order,S=this.style.sourceCaches;for(var T in S){var P=S[T];P.used&&P.prepare(this.context)}var D,G,Q={},ge={},Ee={};for(var Se in S){var We=S[Se];Q[Se]=We.getVisibleCoordinates(),ge[Se]=Q[Se].slice().reverse(),Ee[Se]=We.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var je=0;je<v.length;je++)if(this.style._layers[v[je]].is3D()){this.opaquePassCutoff=je;break}this.renderPass="offscreen";for(var lt=0,Re=v;lt<Re.length;lt+=1){var at=this.style._layers[Re[lt]];if(at.hasOffscreenPass()&&!at.isHidden(this.transform.zoom)){var mt=ge[at.source];(at.type==="custom"||mt.length)&&this.renderLayer(this,S[at.source],at,mt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?g.Color.black:g.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){var Wt=this.style._layers[v[this.currentLayer]],vr=S[Wt.source],ur=Q[Wt.source];this._renderTileClippingMasks(Wt,ur),this.renderLayer(this,vr,Wt,ur)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){var hr=this.style._layers[v[this.currentLayer]],Lr=S[hr.source],Jr=(hr.type==="symbol"?Ee:ge)[hr.source];this._renderTileClippingMasks(hr,Q[hr.source]),this.renderLayer(this,Lr,hr,Jr)}this.options.showTileBoundaries&&(g.values(this.style._layers).forEach(function(Yr){Yr.source&&!Yr.isHidden(f.transform.zoom)&&(Yr.source!==(G&&G.id)&&(G=f.style.sourceCaches[Yr.source]),(!D||D.getSource().maxzoom<G.getSource().maxzoom)&&(D=G))}),D&&lc.debug(this,D,D.getVisibleCoordinates())),this.options.showPadding&&function(Yr){var yn=Yr.transform.padding;eh(Yr,Yr.transform.height-(yn.top||0),3,pl),eh(Yr,yn.bottom||0,3,sc),th(Yr,yn.left||0,3,Jf),th(Yr,Yr.transform.width-(yn.right||0),3,Dl);var Jn=Yr.transform.centerPoint;(function(ei,ni,Wi,bn){uc(ei,ni-1,Wi-10,2,20,bn),uc(ei,ni-10,Wi-1,20,2,bn)})(Yr,Jn.x,Yr.transform.height-Jn.y,Lh)}(this),this.context.setDefault()},Ka.prototype.renderLayer=function(c,h,f,v){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||v.length)&&(this.id=f.id,this.gpuTimingStart(f),lc[f.type](c,h,f,v,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ka.prototype.gpuTimingStart=function(c){if(this.options.gpuTiming){var h=this.context.extTimerQuery,f=this.gpuTimers[c.id];f||(f=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),f.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,f.query)}},Ka.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var c=this.context.extTimerQuery;c.endQueryEXT(c.TIME_ELAPSED_EXT)}},Ka.prototype.collectGpuTimers=function(){var c=this.gpuTimers;return this.gpuTimers={},c},Ka.prototype.queryGpuTimers=function(c){var h={};for(var f in c){var v=c[f],S=this.context.extTimerQuery,T=S.getQueryObjectEXT(v.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(v.query),h[f]=T}return h},Ka.prototype.translatePosMatrix=function(c,h,f,v,S){if(!f[0]&&!f[1])return c;var T=S?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(T){var P=Math.sin(T),D=Math.cos(T);f=[f[0]*D-f[1]*P,f[0]*P+f[1]*D]}var G=[S?f[0]:oa(h,f[0],this.transform.zoom),S?f[1]:oa(h,f[1],this.transform.zoom),0],Q=new Float32Array(16);return g.translate(Q,c,G),Q},Ka.prototype.saveTileTexture=function(c){var h=this._tileTextures[c.size[0]];h?h.push(c):this._tileTextures[c.size[0]]=[c]},Ka.prototype.getTileTexture=function(c){var h=this._tileTextures[c];return h&&h.length>0?h.pop():null},Ka.prototype.isPatternMissing=function(c){if(!c)return!1;if(!c.from||!c.to)return!0;var h=this.imageManager.getPattern(c.from.toString()),f=this.imageManager.getPattern(c.to.toString());return!h||!f},Ka.prototype.useProgram=function(c,h){this.cache=this.cache||{};var f=""+c+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[f]||(this.cache[f]=new mf(this.context,c,_s[c],h,ac[c],this._showOverdrawInspector)),this.cache[f]},Ka.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ka.prototype.setBaseState=function(){var c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)},Ka.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=g.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new g.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ka.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Bc=function(c,h){this.points=c,this.planes=h};Bc.fromInvProjectionMatrix=function(c,h,f){var v=Math.pow(2,f),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return g.transformMat4([],P,c)}).map(function(P){return g.scale$1([],P,1/P[3]/h*v)}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var D=g.sub([],S[P[0]],S[P[1]]),G=g.sub([],S[P[2]],S[P[1]]),Q=g.normalize([],g.cross([],D,G)),ge=-g.dot(Q,S[P[1]]);return Q.concat(ge)});return new Bc(S,T)};var Fl=function(c,h){this.min=c,this.max=h,this.center=g.scale$2([],g.add([],this.min,this.max),.5)};Fl.prototype.quadrant=function(c){for(var h=[c%2==0,c<2],f=g.clone$2(this.min),v=g.clone$2(this.max),S=0;S<h.length;S++)f[S]=h[S]?this.min[S]:this.center[S],v[S]=h[S]?this.center[S]:this.max[S];return v[2]=this.max[2],new Fl(f,v)},Fl.prototype.distanceX=function(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]},Fl.prototype.distanceY=function(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]},Fl.prototype.intersects=function(c){for(var h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],f=!0,v=0;v<c.planes.length;v++){for(var S=c.planes[v],T=0,P=0;P<h.length;P++)T+=g.dot$1(S,h[P])>=0;if(T===0)return 0;T!==h.length&&(f=!1)}if(f)return 2;for(var D=0;D<3;D++){for(var G=Number.MAX_VALUE,Q=-Number.MAX_VALUE,ge=0;ge<c.points.length;ge++){var Ee=c.points[ge][D]-this.min[D];G=Math.min(G,Ee),Q=Math.max(Q,Ee)}if(Q<0||G>this.max[D]-this.min[D])return 0}return 1};var Fu=function(c,h,f,v){if(c===void 0&&(c=0),h===void 0&&(h=0),f===void 0&&(f=0),v===void 0&&(v=0),isNaN(c)||c<0||isNaN(h)||h<0||isNaN(f)||f<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=h,this.left=f,this.right=v};Fu.prototype.interpolate=function(c,h,f){return h.top!=null&&c.top!=null&&(this.top=g.number(c.top,h.top,f)),h.bottom!=null&&c.bottom!=null&&(this.bottom=g.number(c.bottom,h.bottom,f)),h.left!=null&&c.left!=null&&(this.left=g.number(c.left,h.left,f)),h.right!=null&&c.right!=null&&(this.right=g.number(c.right,h.right,f)),this},Fu.prototype.getCenter=function(c,h){var f=g.clamp((this.left+c-this.right)/2,0,c),v=g.clamp((this.top+h-this.bottom)/2,0,h);return new g.Point(f,v)},Fu.prototype.equals=function(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right},Fu.prototype.clone=function(){return new Fu(this.top,this.bottom,this.left,this.right)},Fu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Ci=function(c,h,f,v,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=c||0,this._maxZoom=h||22,this._minPitch=f==null?0:f,this._maxPitch=v==null?60:v,this.setMaxBounds(),this.width=0,this.height=0,this._center=new g.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ia={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Ci.prototype.clone=function(){var c=new Ci(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.tileSize=this.tileSize,c.latRange=this.latRange,c.width=this.width,c.height=this.height,c._center=this._center,c.zoom=this.zoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._calcMatrices(),c},Ia.minZoom.get=function(){return this._minZoom},Ia.minZoom.set=function(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))},Ia.maxZoom.get=function(){return this._maxZoom},Ia.maxZoom.set=function(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))},Ia.minPitch.get=function(){return this._minPitch},Ia.minPitch.set=function(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))},Ia.maxPitch.get=function(){return this._maxPitch},Ia.maxPitch.set=function(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))},Ia.renderWorldCopies.get=function(){return this._renderWorldCopies},Ia.renderWorldCopies.set=function(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c},Ia.worldSize.get=function(){return this.tileSize*this.scale},Ia.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ia.size.get=function(){return new g.Point(this.width,this.height)},Ia.bearing.get=function(){return-this.angle/Math.PI*180},Ia.bearing.set=function(c){var h=-g.wrap(c,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=g.create$2(),g.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ia.pitch.get=function(){return this._pitch/Math.PI*180},Ia.pitch.set=function(c){var h=g.clamp(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())},Ia.fov.get=function(){return this._fov/Math.PI*180},Ia.fov.set=function(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())},Ia.zoom.get=function(){return this._zoom},Ia.zoom.set=function(c){var h=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())},Ia.center.get=function(){return this._center},Ia.center.set=function(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())},Ia.padding.get=function(){return this._edgeInsets.toJSON()},Ia.padding.set=function(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())},Ia.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Ci.prototype.isPaddingEqual=function(c){return this._edgeInsets.equals(c)},Ci.prototype.interpolatePadding=function(c,h,f){this._unmodified=!1,this._edgeInsets.interpolate(c,h,f),this._constrain(),this._calcMatrices()},Ci.prototype.coveringZoomLevel=function(c){var h=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,h)},Ci.prototype.getVisibleUnwrappedCoordinates=function(c){var h=[new g.UnwrappedTileID(0,c)];if(this._renderWorldCopies)for(var f=this.pointCoordinate(new g.Point(0,0)),v=this.pointCoordinate(new g.Point(this.width,0)),S=this.pointCoordinate(new g.Point(this.width,this.height)),T=this.pointCoordinate(new g.Point(0,this.height)),P=Math.floor(Math.min(f.x,v.x,S.x,T.x)),D=Math.floor(Math.max(f.x,v.x,S.x,T.x)),G=P-1;G<=D+1;G++)G!==0&&h.push(new g.UnwrappedTileID(G,c));return h},Ci.prototype.coveringTiles=function(c){var h=this.coveringZoomLevel(c),f=h;if(c.minzoom!==void 0&&h<c.minzoom)return[];c.maxzoom!==void 0&&h>c.maxzoom&&(h=c.maxzoom);var v=g.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,h),T=[S*v.x,S*v.y,0],P=Bc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h),D=c.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(D=h);var G=function(Yr){return{aabb:new Fl([Yr*S,0,0],[(Yr+1)*S,S,0]),zoom:0,x:0,y:0,wrap:Yr,fullyVisible:!1}},Q=[],ge=[],Ee=h,Se=c.reparseOverscaled?f:h;if(this._renderWorldCopies)for(var We=1;We<=3;We++)Q.push(G(-We)),Q.push(G(We));for(Q.push(G(0));Q.length>0;){var je=Q.pop(),lt=je.x,Re=je.y,at=je.fullyVisible;if(!at){var mt=je.aabb.intersects(P);if(mt===0)continue;at=mt===2}var Wt=je.aabb.distanceX(T),vr=je.aabb.distanceY(T),ur=Math.max(Math.abs(Wt),Math.abs(vr));if(je.zoom===Ee||ur>3+(1<<Ee-je.zoom)-2&&je.zoom>=D)ge.push({tileID:new g.OverscaledTileID(je.zoom===Ee?Se:je.zoom,je.wrap,je.zoom,lt,Re),distanceSq:g.sqrLen([T[0]-.5-lt,T[1]-.5-Re])});else for(var hr=0;hr<4;hr++){var Lr=(lt<<1)+hr%2,Jr=(Re<<1)+(hr>>1);Q.push({aabb:je.aabb.quadrant(hr),zoom:je.zoom+1,x:Lr,y:Jr,wrap:je.wrap,fullyVisible:at})}}return ge.sort(function(Yr,yn){return Yr.distanceSq-yn.distanceSq}).map(function(Yr){return Yr.tileID})},Ci.prototype.resize=function(c,h){this.width=c,this.height=h,this.pixelsToGLUnits=[2/c,-2/h],this._constrain(),this._calcMatrices()},Ia.unmodified.get=function(){return this._unmodified},Ci.prototype.zoomScale=function(c){return Math.pow(2,c)},Ci.prototype.scaleZoom=function(c){return Math.log(c)/Math.LN2},Ci.prototype.project=function(c){var h=g.clamp(c.lat,-this.maxValidLatitude,this.maxValidLatitude);return new g.Point(g.mercatorXfromLng(c.lng)*this.worldSize,g.mercatorYfromLat(h)*this.worldSize)},Ci.prototype.unproject=function(c){return new g.MercatorCoordinate(c.x/this.worldSize,c.y/this.worldSize).toLngLat()},Ia.point.get=function(){return this.project(this.center)},Ci.prototype.setLocationAtPoint=function(c,h){var f=this.pointCoordinate(h),v=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(c),T=new g.MercatorCoordinate(S.x-(f.x-v.x),S.y-(f.y-v.y));this.center=this.coordinateLocation(T),this._renderWorldCopies&&(this.center=this.center.wrap())},Ci.prototype.locationPoint=function(c){return this.coordinatePoint(this.locationCoordinate(c))},Ci.prototype.pointLocation=function(c){return this.coordinateLocation(this.pointCoordinate(c))},Ci.prototype.locationCoordinate=function(c){return g.MercatorCoordinate.fromLngLat(c)},Ci.prototype.coordinateLocation=function(c){return c.toLngLat()},Ci.prototype.pointCoordinate=function(c){var h=[c.x,c.y,0,1],f=[c.x,c.y,1,1];g.transformMat4(h,h,this.pixelMatrixInverse),g.transformMat4(f,f,this.pixelMatrixInverse);var v=h[3],S=f[3],T=h[1]/v,P=f[1]/S,D=h[2]/v,G=f[2]/S,Q=D===G?0:(0-D)/(G-D);return new g.MercatorCoordinate(g.number(h[0]/v,f[0]/S,Q)/this.worldSize,g.number(T,P,Q)/this.worldSize)},Ci.prototype.coordinatePoint=function(c){var h=[c.x*this.worldSize,c.y*this.worldSize,0,1];return g.transformMat4(h,h,this.pixelMatrix),new g.Point(h[0]/h[3],h[1]/h[3])},Ci.prototype.getBounds=function(){return new g.LngLatBounds().extend(this.pointLocation(new g.Point(0,0))).extend(this.pointLocation(new g.Point(this.width,0))).extend(this.pointLocation(new g.Point(this.width,this.height))).extend(this.pointLocation(new g.Point(0,this.height)))},Ci.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new g.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Ci.prototype.setMaxBounds=function(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Ci.prototype.calculatePosMatrix=function(c,h){h===void 0&&(h=!1);var f=c.key,v=h?this._alignedPosMatrixCache:this._posMatrixCache;if(v[f])return v[f];var S=c.canonical,T=this.worldSize/this.zoomScale(S.z),P=S.x+Math.pow(2,S.z)*c.wrap,D=g.identity(new Float64Array(16));return g.translate(D,D,[P*T,S.y*T,0]),g.scale(D,D,[T/g.EXTENT,T/g.EXTENT,1]),g.multiply(D,h?this.alignedProjMatrix:this.projMatrix,D),v[f]=new Float32Array(D),v[f]},Ci.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Ci.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var c,h,f,v,S=-90,T=90,P=-180,D=180,G=this.size,Q=this._unmodified;if(this.latRange){var ge=this.latRange;S=g.mercatorYfromLat(ge[1])*this.worldSize,c=(T=g.mercatorYfromLat(ge[0])*this.worldSize)-S<G.y?G.y/(T-S):0}if(this.lngRange){var Ee=this.lngRange;P=g.mercatorXfromLng(Ee[0])*this.worldSize,h=(D=g.mercatorXfromLng(Ee[1])*this.worldSize)-P<G.x?G.x/(D-P):0}var Se=this.point,We=Math.max(h||0,c||0);if(We)return this.center=this.unproject(new g.Point(h?(D+P)/2:Se.x,c?(T+S)/2:Se.y)),this.zoom+=this.scaleZoom(We),this._unmodified=Q,void(this._constraining=!1);if(this.latRange){var je=Se.y,lt=G.y/2;je-lt<S&&(v=S+lt),je+lt>T&&(v=T-lt)}if(this.lngRange){var Re=Se.x,at=G.x/2;Re-at<P&&(f=P+at),Re+at>D&&(f=D-at)}f===void 0&&v===void 0||(this.center=this.unproject(new g.Point(f!==void 0?f:Se.x,v!==void 0?v:Se.y))),this._unmodified=Q,this._constraining=!1}},Ci.prototype._calcMatrices=function(){if(this.height){var c=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var h=Math.PI/2+this._pitch,f=this._fov*(.5+c.y/this.height),v=Math.sin(f)*this.cameraToCenterDistance/Math.sin(g.clamp(Math.PI-h-f,.01,Math.PI-.01)),S=this.point,T=S.x,P=S.y,D=1.01*(Math.cos(Math.PI/2-this._pitch)*v+this.cameraToCenterDistance),G=this.height/50,Q=new Float64Array(16);g.perspective(Q,this._fov,this.width/this.height,G,D),Q[8]=2*-c.x/this.width,Q[9]=2*c.y/this.height,g.scale(Q,Q,[1,-1,1]),g.translate(Q,Q,[0,0,-this.cameraToCenterDistance]),g.rotateX(Q,Q,this._pitch),g.rotateZ(Q,Q,this.angle),g.translate(Q,Q,[-T,-P,0]),this.mercatorMatrix=g.scale([],Q,[this.worldSize,this.worldSize,this.worldSize]),g.scale(Q,Q,[1,1,g.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=Q,this.invProjMatrix=g.invert([],this.projMatrix);var ge=this.width%2/2,Ee=this.height%2/2,Se=Math.cos(this.angle),We=Math.sin(this.angle),je=T-Math.round(T)+Se*ge+We*Ee,lt=P-Math.round(P)+Se*Ee+We*ge,Re=new Float64Array(Q);if(g.translate(Re,Re,[je>.5?je-1:je,lt>.5?lt-1:lt,0]),this.alignedProjMatrix=Re,Q=g.create(),g.scale(Q,Q,[this.width/2,-this.height/2,1]),g.translate(Q,Q,[1,-1,0]),this.labelPlaneMatrix=Q,Q=g.create(),g.scale(Q,Q,[1,-1,1]),g.translate(Q,Q,[-1,-1,0]),g.scale(Q,Q,[2/this.width,2/this.height,1]),this.glCoordMatrix=Q,this.pixelMatrix=g.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(Q=g.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=Q,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Ci.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var c=this.pointCoordinate(new g.Point(0,0)),h=[c.x*this.worldSize,c.y*this.worldSize,0,1];return g.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance},Ci.prototype.getCameraPoint=function(){var c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new g.Point(0,c))},Ci.prototype.getCameraQueryGeometry=function(c){var h=this.getCameraPoint();if(c.length===1)return[c[0],h];for(var f=h.x,v=h.y,S=h.x,T=h.y,P=0,D=c;P<D.length;P+=1){var G=D[P];f=Math.min(f,G.x),v=Math.min(v,G.y),S=Math.max(S,G.x),T=Math.max(T,G.y)}return[new g.Point(f,v),new g.Point(S,v),new g.Point(S,T),new g.Point(f,T),new g.Point(f,v)]},Object.defineProperties(Ci.prototype,Ia);var Gi=function(c){var h,f,v,S;this._hashName=c&&encodeURIComponent(c),g.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),f=!1,v=null,S=function(){v=null,f&&(h(),v=setTimeout(S,300),f=!1)},function(){return f=!0,v||S(),v})};Gi.prototype.addTo=function(c){return this._map=c,g.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Gi.prototype.remove=function(){return g.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Gi.prototype.getHashString=function(c){var h=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,v=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,v),T=Math.round(h.lng*S)/S,P=Math.round(h.lat*S)/S,D=this._map.getBearing(),G=this._map.getPitch(),Q="";if(Q+=c?"/"+T+"/"+P+"/"+f:f+"/"+P+"/"+T,(D||G)&&(Q+="/"+Math.round(10*D)/10),G&&(Q+="/"+Math.round(G)),this._hashName){var ge=this._hashName,Ee=!1,Se=g.window.location.hash.slice(1).split("&").map(function(We){var je=We.split("=")[0];return je===ge?(Ee=!0,je+"="+Q):We}).filter(function(We){return We});return Ee||Se.push(ge+"="+Q),"#"+Se.join("&")}return"#"+Q},Gi.prototype._getCurrentHash=function(){var c,h=this,f=g.window.location.hash.replace("#","");return this._hashName?(f.split("&").map(function(v){return v.split("=")}).forEach(function(v){v[0]===h._hashName&&(c=v)}),(c&&c[1]||"").split("/")):f.split("/")},Gi.prototype._onHashChange=function(){var c=this._getCurrentHash();if(c.length>=3&&!c.some(function(f){return isNaN(f)})){var h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(c[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:h,pitch:+(c[4]||0)}),!0}return!1},Gi.prototype._updateHashUnthrottled=function(){var c=g.window.location.href.replace(/(#.+)?$/,this.getHashString());try{g.window.history.replaceState(g.window.history.state,null,c)}catch(h){}};var Nc={linearity:.3,easing:g.bezier(0,0,.3,1)},dl=g.extend({deceleration:2500,maxSpeed:1400},Nc),zc=g.extend({deceleration:20,maxSpeed:1400},Nc),kh=g.extend({deceleration:1e3,maxSpeed:360},Nc),lp=g.extend({deceleration:1e3,maxSpeed:90},Nc),Zc=function(c){this._map=c,this.clear()};function za(c,h){(!c.duration||c.duration<h.duration)&&(c.duration=h.duration,c.easing=h.easing)}function Zs(c,h,f){var v=f.maxSpeed,S=f.linearity,T=f.deceleration,P=g.clamp(c*S/(h/1e3),-v,v),D=Math.abs(P)/(T*S);return{easing:f.easing,duration:1e3*D,amount:P*(D/2)}}Zc.prototype.clear=function(){this._inertiaBuffer=[]},Zc.prototype.record=function(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:g.browser.now(),settings:c})},Zc.prototype._drainInertiaBuffer=function(){for(var c=this._inertiaBuffer,h=g.browser.now();c.length>0&&h-c[0].time>160;)c.shift()},Zc.prototype._onMoveEnd=function(c){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var h={zoom:0,bearing:0,pitch:0,pan:new g.Point(0,0),pinchAround:void 0,around:void 0},f=0,v=this._inertiaBuffer;f<v.length;f+=1){var S=v[f].settings;h.zoom+=S.zoomDelta||0,h.bearing+=S.bearingDelta||0,h.pitch+=S.pitchDelta||0,S.panDelta&&h.pan._add(S.panDelta),S.around&&(h.around=S.around),S.pinchAround&&(h.pinchAround=S.pinchAround)}var T=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(h.pan.mag()){var D=Zs(h.pan.mag(),T,g.extend({},dl,c||{}));P.offset=h.pan.mult(D.amount/h.pan.mag()),P.center=this._map.transform.center,za(P,D)}if(h.zoom){var G=Zs(h.zoom,T,zc);P.zoom=this._map.transform.zoom+G.amount,za(P,G)}if(h.bearing){var Q=Zs(h.bearing,T,kh);P.bearing=this._map.transform.bearing+g.clamp(Q.amount,-179,179),za(P,Q)}if(h.pitch){var ge=Zs(h.pitch,T,lp);P.pitch=this._map.transform.pitch+ge.amount,za(P,ge)}if(P.zoom||P.bearing){var Ee=h.pinchAround===void 0?h.around:h.pinchAround;P.around=Ee?this._map.unproject(Ee):this._map.getCenter()}return this.clear(),g.extend(P,{noMoveStart:!0})}};var Va=function(c){function h(v,S,T,P){P===void 0&&(P={});var D=N.mousePos(S.getCanvasContainer(),T),G=S.unproject(D);c.call(this,v,g.extend({point:D,lngLat:G,originalEvent:T},P)),this._defaultPrevented=!1,this.target=S}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(g.Event),Bu=function(c){function h(v,S,T){var P=v==="touchend"?T.changedTouches:T.touches,D=N.touchPos(S.getCanvasContainer(),P),G=D.map(function(Ee){return S.unproject(Ee)}),Q=D.reduce(function(Ee,Se,We,je){return Ee.add(Se.div(je.length))},new g.Point(0,0)),ge=S.unproject(Q);c.call(this,v,{points:D,point:Q,lngLats:G,lngLat:ge,originalEvent:T}),this._defaultPrevented=!1}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(g.Event),cc=function(c){function h(v,S,T){c.call(this,v,{originalEvent:T}),this._defaultPrevented=!1}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={defaultPrevented:{configurable:!0}};return h.prototype.preventDefault=function(){this._defaultPrevented=!0},f.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(h.prototype,f),h}(g.Event),go=function(c,h){this._map=c,this._clickTolerance=h.clickTolerance};go.prototype.reset=function(){delete this._mousedownPos},go.prototype.wheel=function(c){return this._firePreventable(new cc(c.type,this._map,c))},go.prototype.mousedown=function(c,h){return this._mousedownPos=h,this._firePreventable(new Va(c.type,this._map,c))},go.prototype.mouseup=function(c){this._map.fire(new Va(c.type,this._map,c))},go.prototype.click=function(c,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Va(c.type,this._map,c))},go.prototype.dblclick=function(c){return this._firePreventable(new Va(c.type,this._map,c))},go.prototype.mouseover=function(c){this._map.fire(new Va(c.type,this._map,c))},go.prototype.mouseout=function(c){this._map.fire(new Va(c.type,this._map,c))},go.prototype.touchstart=function(c){return this._firePreventable(new Bu(c.type,this._map,c))},go.prototype.touchmove=function(c){this._map.fire(new Bu(c.type,this._map,c))},go.prototype.touchend=function(c){this._map.fire(new Bu(c.type,this._map,c))},go.prototype.touchcancel=function(c){this._map.fire(new Bu(c.type,this._map,c))},go.prototype._firePreventable=function(c){if(this._map.fire(c),c.defaultPrevented)return{}},go.prototype.isEnabled=function(){return!0},go.prototype.isActive=function(){return!1},go.prototype.enable=function(){},go.prototype.disable=function(){};var Mn=function(c){this._map=c};Mn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Mn.prototype.mousemove=function(c){this._map.fire(new Va(c.type,this._map,c))},Mn.prototype.mousedown=function(){this._delayContextMenu=!0},Mn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Va("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Mn.prototype.contextmenu=function(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new Va(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()},Mn.prototype.isEnabled=function(){return!0},Mn.prototype.isActive=function(){return!1},Mn.prototype.enable=function(){},Mn.prototype.disable=function(){};var $a=function(c,h){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=h.clickTolerance||1};function Qu(c,h){for(var f={},v=0;v<c.length;v++)f[c[v].identifier]=h[v];return f}$a.prototype.isEnabled=function(){return!!this._enabled},$a.prototype.isActive=function(){return!!this._active},$a.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},$a.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},$a.prototype.mousedown=function(c,h){this.isEnabled()&&c.shiftKey&&c.button===0&&(N.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)},$a.prototype.mousemoveWindow=function(c,h){if(this._active){var f=h;if(!(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)){var v=this._startPos;this._lastPos=f,this._box||(this._box=N.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));var S=Math.min(v.x,f.x),T=Math.max(v.x,f.x),P=Math.min(v.y,f.y),D=Math.max(v.y,f.y);N.setTransform(this._box,"translate("+S+"px,"+P+"px)"),this._box.style.width=T-S+"px",this._box.style.height=D-P+"px"}}},$a.prototype.mouseupWindow=function(c,h){var f=this;if(this._active&&c.button===0){var v=this._startPos,S=h;if(this.reset(),N.suppressClick(),v.x!==S.x||v.y!==S.y)return this._map.fire(new g.Event("boxzoomend",{originalEvent:c})),{cameraAnimation:function(T){return T.fitScreenCoordinates(v,S,f._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",c)}},$a.prototype.keydown=function(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))},$a.prototype.blur=function(){this.reset()},$a.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(N.remove(this._box),this._box=null),N.enableDrag(),delete this._startPos,delete this._lastPos},$a.prototype._fireEvent=function(c,h){return this._map.fire(new g.Event(c,{originalEvent:h}))};var vl=function(c){this.reset(),this.numTouches=c.numTouches};vl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},vl.prototype.touchstart=function(c,h,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),f.length===this.numTouches&&(this.centroid=function(v){for(var S=new g.Point(0,0),T=0,P=v;T<P.length;T+=1)S._add(P[T]);return S.div(v.length)}(h),this.touches=Qu(f,h)))},vl.prototype.touchmove=function(c,h,f){if(!this.aborted&&this.centroid){var v=Qu(f,h);for(var S in this.touches){var T=v[S];(!T||T.dist(this.touches[S])>30)&&(this.aborted=!0)}}},vl.prototype.touchend=function(c,h,f){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){var v=!this.aborted&&this.centroid;if(this.reset(),v)return v}};var lu=function(c){this.singleTap=new vl(c),this.numTaps=c.numTaps,this.reset()};lu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},lu.prototype.touchstart=function(c,h,f){this.singleTap.touchstart(c,h,f)},lu.prototype.touchmove=function(c,h,f){this.singleTap.touchmove(c,h,f)},lu.prototype.touchend=function(c,h,f){var v=this.singleTap.touchend(c,h,f);if(v){var S=c.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(S&&T||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}};var Us=function(){this._zoomIn=new lu({numTouches:1,numTaps:2}),this._zoomOut=new lu({numTouches:2,numTaps:1}),this.reset()};Us.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Us.prototype.touchstart=function(c,h,f){this._zoomIn.touchstart(c,h,f),this._zoomOut.touchstart(c,h,f)},Us.prototype.touchmove=function(c,h,f){this._zoomIn.touchmove(c,h,f),this._zoomOut.touchmove(c,h,f)},Us.prototype.touchend=function(c,h,f){var v=this,S=this._zoomIn.touchend(c,h,f),T=this._zoomOut.touchend(c,h,f);return S?(this._active=!0,c.preventDefault(),setTimeout(function(){return v.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(S)},{originalEvent:c})}}):T?(this._active=!0,c.preventDefault(),setTimeout(function(){return v.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(T)},{originalEvent:c})}}):void 0},Us.prototype.touchcancel=function(){this.reset()},Us.prototype.enable=function(){this._enabled=!0},Us.prototype.disable=function(){this._enabled=!1,this.reset()},Us.prototype.isEnabled=function(){return this._enabled},Us.prototype.isActive=function(){return this._active};var Cf={0:1,2:2},Nr=function(c){this.reset(),this._clickTolerance=c.clickTolerance||1};Nr.prototype.blur=function(){this.reset()},Nr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Nr.prototype._correctButton=function(c,h){return!1},Nr.prototype._move=function(c,h){return{}},Nr.prototype.mousedown=function(c,h){if(!this._lastPoint){var f=N.mouseButton(c);this._correctButton(c,f)&&(this._lastPoint=h,this._eventButton=f)}},Nr.prototype.mousemoveWindow=function(c,h){var f=this._lastPoint;if(f){if(c.preventDefault(),function(v,S){var T=Cf[S];return v.buttons===void 0||(v.buttons&T)!==T}(c,this._eventButton))this.reset();else if(this._moved||!(h.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(f,h)}},Nr.prototype.mouseupWindow=function(c){this._lastPoint&&N.mouseButton(c)===this._eventButton&&(this._moved&&N.suppressClick(),this.reset())},Nr.prototype.enable=function(){this._enabled=!0},Nr.prototype.disable=function(){this._enabled=!1,this.reset()},Nr.prototype.isEnabled=function(){return this._enabled},Nr.prototype.isActive=function(){return this._active};var Af=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.mousedown=function(f,v){c.prototype.mousedown.call(this,f,v),this._lastPoint&&(this._active=!0)},h.prototype._correctButton=function(f,v){return v===0&&!f.ctrlKey},h.prototype._move=function(f,v){return{around:v,panDelta:v.sub(f)}},h}(Nr),wf=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype._correctButton=function(f,v){return v===0&&f.ctrlKey||v===2},h.prototype._move=function(f,v){var S=.8*(v.x-f.x);if(S)return this._active=!0,{bearingDelta:S}},h.prototype.contextmenu=function(f){f.preventDefault()},h}(Nr),Ju=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype._correctButton=function(f,v){return v===0&&f.ctrlKey||v===2},h.prototype._move=function(f,v){var S=-.5*(v.y-f.y);if(S)return this._active=!0,{pitchDelta:S}},h.prototype.contextmenu=function(f){f.preventDefault()},h}(Nr),Ba=function(c){this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset()};Ba.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new g.Point(0,0)},Ba.prototype.touchstart=function(c,h,f){return this._calculateTransform(c,h,f)},Ba.prototype.touchmove=function(c,h,f){if(this._active&&!(f.length<this._minTouches))return c.preventDefault(),this._calculateTransform(c,h,f)},Ba.prototype.touchend=function(c,h,f){this._calculateTransform(c,h,f),this._active&&f.length<this._minTouches&&this.reset()},Ba.prototype.touchcancel=function(){this.reset()},Ba.prototype._calculateTransform=function(c,h,f){f.length>0&&(this._active=!0);var v=Qu(f,h),S=new g.Point(0,0),T=new g.Point(0,0),P=0;for(var D in v){var G=v[D],Q=this._touches[D];Q&&(S._add(G),T._add(G.sub(Q)),P++,v[D]=G)}if(this._touches=v,!(P<this._minTouches)&&T.mag()){var ge=T.div(P);if(this._sum._add(ge),!(this._sum.mag()<this._clickTolerance))return{around:S.div(P),panDelta:ge}}},Ba.prototype.enable=function(){this._enabled=!0},Ba.prototype.disable=function(){this._enabled=!1,this.reset()},Ba.prototype.isEnabled=function(){return this._enabled},Ba.prototype.isActive=function(){return this._active};var Ms=function(){this.reset()};function Bl(c,h,f){for(var v=0;v<c.length;v++)if(c[v].identifier===f)return h[v]}function cu(c,h){return Math.log(c/h)/Math.LN2}Ms.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ms.prototype._start=function(c){},Ms.prototype._move=function(c,h,f){return{}},Ms.prototype.touchstart=function(c,h,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([h[0],h[1]]))},Ms.prototype.touchmove=function(c,h,f){if(this._firstTwoTouches){c.preventDefault();var v=this._firstTwoTouches,S=v[1],T=Bl(f,h,v[0]),P=Bl(f,h,S);if(T&&P){var D=this._aroundCenter?null:T.add(P).div(2);return this._move([T,P],D,c)}}},Ms.prototype.touchend=function(c,h,f){if(this._firstTwoTouches){var v=this._firstTwoTouches,S=v[1],T=Bl(f,h,v[0]),P=Bl(f,h,S);T&&P||(this._active&&N.suppressClick(),this.reset())}},Ms.prototype.touchcancel=function(){this.reset()},Ms.prototype.enable=function(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"},Ms.prototype.disable=function(){this._enabled=!1,this.reset()},Ms.prototype.isEnabled=function(){return this._enabled},Ms.prototype.isActive=function(){return this._active};var Ps=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),delete this._distance,delete this._startDistance},h.prototype._start=function(f){this._startDistance=this._distance=f[0].dist(f[1])},h.prototype._move=function(f,v){var S=this._distance;if(this._distance=f[0].dist(f[1]),this._active||!(Math.abs(cu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:cu(this._distance,S),pinchAround:v}},h}(Ms);function Ta(c,h){return 180*c.angleWith(h)/Math.PI}var rh=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},h.prototype._start=function(f){this._startVector=this._vector=f[0].sub(f[1]),this._minDiameter=f[0].dist(f[1])},h.prototype._move=function(f,v){var S=this._vector;if(this._vector=f[0].sub(f[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ta(this._vector,S),pinchAround:v}},h.prototype._isBelowThreshold=function(f){this._minDiameter=Math.min(this._minDiameter,f.mag());var v=25/(Math.PI*this._minDiameter)*360,S=Ta(f,this._startVector);return Math.abs(S)<v},h}(Ms);function Uc(c){return Math.abs(c.y)>Math.abs(c.x)}var nh=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.reset=function(){c.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},h.prototype._start=function(f){this._lastPoints=f,Uc(f[0].sub(f[1]))&&(this._valid=!1)},h.prototype._move=function(f,v,S){var T=f[0].sub(this._lastPoints[0]),P=f[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(T,P,S.timeStamp),this._valid)return this._lastPoints=f,this._active=!0,{pitchDelta:(T.y+P.y)/2*-.5}},h.prototype.gestureBeginsVertically=function(f,v,S){if(this._valid!==void 0)return this._valid;var T=f.mag()>=2,P=v.mag()>=2;if(T||P){if(!T||!P)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var D=f.y>0==v.y>0;return Uc(f)&&Uc(v)&&D}},h}(Ms),fc={panStep:100,bearingStep:15,pitchStep:10},Os=function(){var c=fc;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1};function js(c){return c*(2-c)}Os.prototype.blur=function(){this.reset()},Os.prototype.reset=function(){this._active=!1},Os.prototype.keydown=function(c){var h=this;if(!(c.altKey||c.ctrlKey||c.metaKey)){var f=0,v=0,S=0,T=0,P=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?v=-1:(c.preventDefault(),T=-1);break;case 39:c.shiftKey?v=1:(c.preventDefault(),T=1);break;case 38:c.shiftKey?S=1:(c.preventDefault(),P=-1);break;case 40:c.shiftKey?S=-1:(c.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(v=0,S=0),{cameraAnimation:function(D){var G=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:js,zoom:f?Math.round(G)+f*(c.shiftKey?2:1):G,bearing:D.getBearing()+v*h._bearingStep,pitch:D.getPitch()+S*h._pitchStep,offset:[-T*h._panStep,-P*h._panStep],center:D.getCenter()},{originalEvent:c})}}}},Os.prototype.enable=function(){this._enabled=!0},Os.prototype.disable=function(){this._enabled=!1,this.reset()},Os.prototype.isEnabled=function(){return this._enabled},Os.prototype.isActive=function(){return this._active},Os.prototype.disableRotation=function(){this._rotationDisabled=!0},Os.prototype.enableRotation=function(){this._rotationDisabled=!1};var Sn=function(c,h){this._map=c,this._el=c.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,g.bindAll(["_onTimeout"],this)};Sn.prototype.setZoomRate=function(c){this._defaultZoomRate=c},Sn.prototype.setWheelZoomRate=function(c){this._wheelZoomRate=c},Sn.prototype.isEnabled=function(){return!!this._enabled},Sn.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Sn.prototype.isZooming=function(){return!!this._zooming},Sn.prototype.enable=function(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=c&&c.around==="center")},Sn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Sn.prototype.wheel=function(c){if(this.isEnabled()){var h=c.deltaMode===g.window.WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY,f=g.browser.now(),v=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,h!==0&&h%4.000244140625==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),c.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=c,this._delta-=h,this._active||this._start(c)),c.preventDefault()}},Sn.prototype._onTimeout=function(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},Sn.prototype._start=function(c){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var h=N.mousePos(this._el,c);this._around=g.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Sn.prototype.renderFrame=function(){var c=this;if(this._frameId&&(this._frameId=null,this.isActive())){var h=this._map.transform;if(this._delta!==0){var f=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,v=2/(1+Math.exp(-Math.abs(this._delta*f)));this._delta<0&&v!==0&&(v=1/v);var S=typeof this._targetZoom=="number"?h.zoomScale(this._targetZoom):h.scale;this._targetZoom=Math.min(h.maxZoom,Math.max(h.minZoom,h.scaleZoom(S*v))),this._type==="wheel"&&(this._startZoom=h.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var T,P=typeof this._targetZoom=="number"?this._targetZoom:h.zoom,D=this._startZoom,G=this._easing,Q=!1;if(this._type==="wheel"&&D&&G){var ge=Math.min((g.browser.now()-this._lastWheelEventTime)/200,1),Ee=G(ge);T=g.number(D,P,Ee),ge<1?this._frameId||(this._frameId=!0):Q=!0}else T=P,Q=!0;return this._active=!0,Q&&(this._active=!1,this._finishTimeout=setTimeout(function(){c._zooming=!1,c._handler._triggerRenderFrame(),delete c._targetZoom,delete c._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Q,zoomDelta:T-h.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Sn.prototype._smoothOutEasing=function(c){var h=g.ease;if(this._prevEase){var f=this._prevEase,v=(g.browser.now()-f.start)/f.duration,S=f.easing(v+.01)-f.easing(v),T=.27/Math.sqrt(S*S+1e-4)*.01,P=Math.sqrt(.0729-T*T);h=g.bezier(T,P,.25,1)}return this._prevEase={start:g.browser.now(),duration:c,easing:h},h},Sn.prototype.blur=function(){this.reset()},Sn.prototype.reset=function(){this._active=!1};var Su=function(c,h){this._clickZoom=c,this._tapZoom=h};Su.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Su.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Su.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Su.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var fu=function(){this.reset()};fu.prototype.reset=function(){this._active=!1},fu.prototype.blur=function(){this.reset()},fu.prototype.dblclick=function(c,h){return c.preventDefault(),{cameraAnimation:function(f){f.easeTo({duration:300,zoom:f.getZoom()+(c.shiftKey?-1:1),around:f.unproject(h)},{originalEvent:c})}}},fu.prototype.enable=function(){this._enabled=!0},fu.prototype.disable=function(){this._enabled=!1,this.reset()},fu.prototype.isEnabled=function(){return this._enabled},fu.prototype.isActive=function(){return this._active};var es=function(){this._tap=new lu({numTouches:1,numTaps:1}),this.reset()};es.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},es.prototype.touchstart=function(c,h,f){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=h[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(c,h,f))},es.prototype.touchmove=function(c,h,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;var v=h[0],S=v.y-this._swipePoint.y;return this._swipePoint=v,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,h,f)},es.prototype.touchend=function(c,h,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(c,h,f)&&(this._tapTime=c.timeStamp)},es.prototype.touchcancel=function(){this.reset()},es.prototype.enable=function(){this._enabled=!0},es.prototype.disable=function(){this._enabled=!1,this.reset()},es.prototype.isEnabled=function(){return this._enabled},es.prototype.isActive=function(){return this._active};var el=function(c,h,f){this._el=c,this._mousePan=h,this._touchPan=f};el.prototype.enable=function(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},el.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},el.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},el.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Qs=function(c,h,f){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=h,this._mousePitch=f};Qs.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Qs.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Qs.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Qs.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Vs=function(c,h,f,v){this._el=c,this._touchZoom=h,this._touchRotate=f,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0};Vs.prototype.enable=function(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Vs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Vs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Vs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Vs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Vs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var bs=function(c){return c.zoom||c.drag||c.pitch||c.rotate},Js=function(c){function h(){c.apply(this,arguments)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h}(g.Event);function Kn(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}var jn=function(c,h){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Zc(c),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),g.bindAll(["handleEvent","handleWindowEvent"],this);var f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[g.window.document,"mousemove",{capture:!0}],[g.window.document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[g.window,"blur",void 0]];for(var v=0,S=this._listeners;v<S.length;v+=1){var T=S[v],P=T[0];N.addEventListener(P,T[1],P===g.window.document?this.handleWindowEvent:this.handleEvent,T[2])}};jn.prototype.destroy=function(){for(var c=0,h=this._listeners;c<h.length;c+=1){var f=h[c],v=f[0];N.removeEventListener(v,f[1],v===g.window.document?this.handleWindowEvent:this.handleEvent,f[2])}},jn.prototype._addDefaultHandlers=function(c){var h=this._map,f=h.getCanvasContainer();this._add("mapEvent",new go(h,c));var v=h.boxZoom=new $a(h,c);this._add("boxZoom",v);var S=new Us,T=new fu;h.doubleClickZoom=new Su(T,S),this._add("tapZoom",S),this._add("clickZoom",T);var P=new es;this._add("tapDragZoom",P);var D=h.touchPitch=new nh;this._add("touchPitch",D);var G=new wf(c),Q=new Ju(c);h.dragRotate=new Qs(c,G,Q),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",Q,["mouseRotate"]);var ge=new Af(c),Ee=new Ba(c);h.dragPan=new el(f,ge,Ee),this._add("mousePan",ge),this._add("touchPan",Ee,["touchZoom","touchRotate"]);var Se=new rh,We=new Ps;h.touchZoomRotate=new Vs(f,We,Se,P),this._add("touchRotate",Se,["touchPan","touchZoom"]),this._add("touchZoom",We,["touchPan","touchRotate"]);var je=h.scrollZoom=new Sn(h,this);this._add("scrollZoom",je,["mousePan"]);var lt=h.keyboard=new Os;this._add("keyboard",lt),this._add("blockableMapEvent",new Mn(h));for(var Re=0,at=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Re<at.length;Re+=1){var mt=at[Re];c.interactive&&c[mt]&&h[mt].enable(c[mt])}},jn.prototype._add=function(c,h,f){this._handlers.push({handlerName:c,handler:h,allowed:f}),this._handlersById[c]=h},jn.prototype.stop=function(c){if(!this._updatingCamera){for(var h=0,f=this._handlers;h<f.length;h+=1)f[h].handler.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}},jn.prototype.isActive=function(){for(var c=0,h=this._handlers;c<h.length;c+=1)if(h[c].handler.isActive())return!0;return!1},jn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},jn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},jn.prototype.isMoving=function(){return Boolean(bs(this._eventsInProgress))||this.isZooming()},jn.prototype._blockedByActive=function(c,h,f){for(var v in c)if(v!==f&&(!h||h.indexOf(v)<0))return!0;return!1},jn.prototype.handleWindowEvent=function(c){this.handleEvent(c,c.type+"Window")},jn.prototype._getMapTouches=function(c){for(var h=[],f=0,v=c;f<v.length;f+=1){var S=v[f];this._el.contains(S.target)&&h.push(S)}return h},jn.prototype.handleEvent=function(c,h){this._updatingCamera=!0;for(var f=c.type==="renderFrame"?void 0:c,v={needsRenderFrame:!1},S={},T={},P=c.touches?this._getMapTouches(c.touches):void 0,D=P?N.touchPos(this._el,P):N.mousePos(this._el,c),G=0,Q=this._handlers;G<Q.length;G+=1){var ge=Q[G],Ee=ge.handlerName,Se=ge.handler,We=ge.allowed;if(Se.isEnabled()){var je=void 0;this._blockedByActive(T,We,Ee)?Se.reset():Se[h||c.type]&&(je=Se[h||c.type](c,D,P),this.mergeHandlerResult(v,S,je,Ee,f),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||Se.isActive())&&(T[Ee]=Se)}}var lt={};for(var Re in this._previousActiveHandlers)T[Re]||(lt[Re]=f);this._previousActiveHandlers=T,(Object.keys(lt).length||Kn(v))&&(this._changes.push([v,S,lt]),this._triggerRenderFrame()),(Object.keys(T).length||Kn(v))&&this._map._stop(!0),this._updatingCamera=!1;var at=v.cameraAnimation;at&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],at(this._map))},jn.prototype.mergeHandlerResult=function(c,h,f,v,S){if(f){g.extend(c,f);var T={handlerName:v,originalEvent:f.originalEvent||S};f.zoomDelta!==void 0&&(h.zoom=T),f.panDelta!==void 0&&(h.drag=T),f.pitchDelta!==void 0&&(h.pitch=T),f.bearingDelta!==void 0&&(h.rotate=T)}},jn.prototype._applyChanges=function(){for(var c={},h={},f={},v=0,S=this._changes;v<S.length;v+=1){var T=S[v],P=T[0],D=T[1],G=T[2];P.panDelta&&(c.panDelta=(c.panDelta||new g.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(c.around=P.around),P.pinchAround!==void 0&&(c.pinchAround=P.pinchAround),P.noInertia&&(c.noInertia=P.noInertia),g.extend(h,D),g.extend(f,G)}this._updateMapTransform(c,h,f),this._changes=[]},jn.prototype._updateMapTransform=function(c,h,f){var v=this._map,S=v.transform;if(!Kn(c))return this._fireEvents(h,f,!0);var T=c.panDelta,P=c.zoomDelta,D=c.bearingDelta,G=c.pitchDelta,Q=c.around,ge=c.pinchAround;ge!==void 0&&(Q=ge),v._stop(!0),Q=Q||v.transform.centerPoint;var Ee=S.pointLocation(T?Q.sub(T):Q);D&&(S.bearing+=D),G&&(S.pitch+=G),P&&(S.zoom+=P),S.setLocationAtPoint(Ee,Q),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(h,f,!0)},jn.prototype._fireEvents=function(c,h,f){var v=this,S=bs(this._eventsInProgress),T=bs(c),P={};for(var D in c)this._eventsInProgress[D]||(P[D+"start"]=c[D].originalEvent),this._eventsInProgress[D]=c[D];for(var G in!S&&T&&this._fireEvent("movestart",T.originalEvent),P)this._fireEvent(G,P[G]);for(var Q in T&&this._fireEvent("move",T.originalEvent),c)this._fireEvent(Q,c[Q].originalEvent);var ge,Ee={};for(var Se in this._eventsInProgress){var We=this._eventsInProgress[Se],je=We.handlerName,lt=We.originalEvent;this._handlersById[je].isActive()||(delete this._eventsInProgress[Se],Ee[Se+"end"]=ge=h[je]||lt)}for(var Re in Ee)this._fireEvent(Re,Ee[Re]);var at=bs(this._eventsInProgress);if(f&&(S||T)&&!at){this._updatingCamera=!0;var mt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Wt=function(vr){return vr!==0&&-v._bearingSnap<vr&&vr<v._bearingSnap};mt?(Wt(mt.bearing||this._map.getBearing())&&(mt.bearing=0),this._map.easeTo(mt,{originalEvent:ge})):(this._map.fire(new g.Event("moveend",{originalEvent:ge})),Wt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},jn.prototype._fireEvent=function(c,h){this._map.fire(new g.Event(c,h?{originalEvent:h}:{}))},jn.prototype._requestFrame=function(){var c=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(h){delete c._frameId,c.handleEvent(new Js("renderFrame",{timeStamp:h})),c._applyChanges()})},jn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Nl=function(c){function h(f,v){c.call(this),this._moving=!1,this._zooming=!1,this.transform=f,this._bearingSnap=v.bearingSnap,g.bindAll(["_renderFrameCallback"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.getCenter=function(){return new g.LngLat(this.transform.center.lng,this.transform.center.lat)},h.prototype.setCenter=function(f,v){return this.jumpTo({center:f},v)},h.prototype.panBy=function(f,v,S){return f=g.Point.convert(f).mult(-1),this.panTo(this.transform.center,g.extend({offset:f},v),S)},h.prototype.panTo=function(f,v,S){return this.easeTo(g.extend({center:f},v),S)},h.prototype.getZoom=function(){return this.transform.zoom},h.prototype.setZoom=function(f,v){return this.jumpTo({zoom:f},v),this},h.prototype.zoomTo=function(f,v,S){return this.easeTo(g.extend({zoom:f},v),S)},h.prototype.zoomIn=function(f,v){return this.zoomTo(this.getZoom()+1,f,v),this},h.prototype.zoomOut=function(f,v){return this.zoomTo(this.getZoom()-1,f,v),this},h.prototype.getBearing=function(){return this.transform.bearing},h.prototype.setBearing=function(f,v){return this.jumpTo({bearing:f},v),this},h.prototype.getPadding=function(){return this.transform.padding},h.prototype.setPadding=function(f,v){return this.jumpTo({padding:f},v),this},h.prototype.rotateTo=function(f,v,S){return this.easeTo(g.extend({bearing:f},v),S)},h.prototype.resetNorth=function(f,v){return this.rotateTo(0,g.extend({duration:1e3},f),v),this},h.prototype.resetNorthPitch=function(f,v){return this.easeTo(g.extend({bearing:0,pitch:0,duration:1e3},f),v),this},h.prototype.snapToNorth=function(f,v){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(f,v):this},h.prototype.getPitch=function(){return this.transform.pitch},h.prototype.setPitch=function(f,v){return this.jumpTo({pitch:f},v),this},h.prototype.cameraForBounds=function(f,v){f=g.LngLatBounds.convert(f);var S=v&&v.bearing||0;return this._cameraForBoxAndBearing(f.getNorthWest(),f.getSouthEast(),S,v)},h.prototype._cameraForBoxAndBearing=function(f,v,S,T){var P={top:0,bottom:0,right:0,left:0};if(typeof(T=g.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},T)).padding=="number"){var D=T.padding;T.padding={top:D,bottom:D,right:D,left:D}}T.padding=g.extend(P,T.padding);var G=this.transform,Q=G.padding,ge=G.project(g.LngLat.convert(f)),Ee=G.project(g.LngLat.convert(v)),Se=ge.rotate(-S*Math.PI/180),We=Ee.rotate(-S*Math.PI/180),je=new g.Point(Math.max(Se.x,We.x),Math.max(Se.y,We.y)),lt=new g.Point(Math.min(Se.x,We.x),Math.min(Se.y,We.y)),Re=je.sub(lt),at=(G.width-(Q.left+Q.right+T.padding.left+T.padding.right))/Re.x,mt=(G.height-(Q.top+Q.bottom+T.padding.top+T.padding.bottom))/Re.y;if(!(mt<0||at<0)){var Wt=Math.min(G.scaleZoom(G.scale*Math.min(at,mt)),T.maxZoom),vr=typeof T.offset.x=="number"?new g.Point(T.offset.x,T.offset.y):g.Point.convert(T.offset),ur=new g.Point((T.padding.left-T.padding.right)/2,(T.padding.top-T.padding.bottom)/2).rotate(S*Math.PI/180),hr=vr.add(ur).mult(G.scale/G.zoomScale(Wt));return{center:G.unproject(ge.add(Ee).div(2).sub(hr)),zoom:Wt,bearing:S}}g.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},h.prototype.fitBounds=function(f,v,S){return this._fitInternal(this.cameraForBounds(f,v),v,S)},h.prototype.fitScreenCoordinates=function(f,v,S,T,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(g.Point.convert(f)),this.transform.pointLocation(g.Point.convert(v)),S,T),T,P)},h.prototype._fitInternal=function(f,v,S){return f?(delete(v=g.extend(f,v)).padding,v.linear?this.easeTo(v,S):this.flyTo(v,S)):this},h.prototype.jumpTo=function(f,v){this.stop();var S=this.transform,T=!1,P=!1,D=!1;return"zoom"in f&&S.zoom!==+f.zoom&&(T=!0,S.zoom=+f.zoom),f.center!==void 0&&(S.center=g.LngLat.convert(f.center)),"bearing"in f&&S.bearing!==+f.bearing&&(P=!0,S.bearing=+f.bearing),"pitch"in f&&S.pitch!==+f.pitch&&(D=!0,S.pitch=+f.pitch),f.padding==null||S.isPaddingEqual(f.padding)||(S.padding=f.padding),this.fire(new g.Event("movestart",v)).fire(new g.Event("move",v)),T&&this.fire(new g.Event("zoomstart",v)).fire(new g.Event("zoom",v)).fire(new g.Event("zoomend",v)),P&&this.fire(new g.Event("rotatestart",v)).fire(new g.Event("rotate",v)).fire(new g.Event("rotateend",v)),D&&this.fire(new g.Event("pitchstart",v)).fire(new g.Event("pitch",v)).fire(new g.Event("pitchend",v)),this.fire(new g.Event("moveend",v))},h.prototype.easeTo=function(f,v){var S=this;this._stop(!1,f.easeId),((f=g.extend({offset:[0,0],duration:500,easing:g.ease},f)).animate===!1||!f.essential&&g.browser.prefersReducedMotion)&&(f.duration=0);var T=this.transform,P=this.getZoom(),D=this.getBearing(),G=this.getPitch(),Q=this.getPadding(),ge="zoom"in f?+f.zoom:P,Ee="bearing"in f?this._normalizeBearing(f.bearing,D):D,Se="pitch"in f?+f.pitch:G,We="padding"in f?f.padding:T.padding,je=g.Point.convert(f.offset),lt=T.centerPoint.add(je),Re=T.pointLocation(lt),at=g.LngLat.convert(f.center||Re);this._normalizeCenter(at);var mt,Wt,vr=T.project(Re),ur=T.project(at).sub(vr),hr=T.zoomScale(ge-P);f.around&&(mt=g.LngLat.convert(f.around),Wt=T.locationPoint(mt));var Lr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ge!==P,this._rotating=this._rotating||D!==Ee,this._pitching=this._pitching||Se!==G,this._padding=!T.isPaddingEqual(We),this._easeId=f.easeId,this._prepareEase(v,f.noMoveStart,Lr),this._ease(function(Jr){if(S._zooming&&(T.zoom=g.number(P,ge,Jr)),S._rotating&&(T.bearing=g.number(D,Ee,Jr)),S._pitching&&(T.pitch=g.number(G,Se,Jr)),S._padding&&(T.interpolatePadding(Q,We,Jr),lt=T.centerPoint.add(je)),mt)T.setLocationAtPoint(mt,Wt);else{var Yr=T.zoomScale(T.zoom-P),yn=ge>P?Math.min(2,hr):Math.max(.5,hr),Jn=Math.pow(yn,1-Jr),ei=T.unproject(vr.add(ur.mult(Jr*Jn)).mult(Yr));T.setLocationAtPoint(T.renderWorldCopies?ei.wrap():ei,lt)}S._fireMoveEvents(v)},function(Jr){S._afterEase(v,Jr)},f),this},h.prototype._prepareEase=function(f,v,S){S===void 0&&(S={}),this._moving=!0,v||S.moving||this.fire(new g.Event("movestart",f)),this._zooming&&!S.zooming&&this.fire(new g.Event("zoomstart",f)),this._rotating&&!S.rotating&&this.fire(new g.Event("rotatestart",f)),this._pitching&&!S.pitching&&this.fire(new g.Event("pitchstart",f))},h.prototype._fireMoveEvents=function(f){this.fire(new g.Event("move",f)),this._zooming&&this.fire(new g.Event("zoom",f)),this._rotating&&this.fire(new g.Event("rotate",f)),this._pitching&&this.fire(new g.Event("pitch",f))},h.prototype._afterEase=function(f,v){if(!this._easeId||!v||this._easeId!==v){delete this._easeId;var S=this._zooming,T=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new g.Event("zoomend",f)),T&&this.fire(new g.Event("rotateend",f)),P&&this.fire(new g.Event("pitchend",f)),this.fire(new g.Event("moveend",f))}},h.prototype.flyTo=function(f,v){var S=this;if(!f.essential&&g.browser.prefersReducedMotion){var T=g.pick(f,["center","zoom","bearing","pitch","around"]);return this.jumpTo(T,v)}this.stop(),f=g.extend({offset:[0,0],speed:1.2,curve:1.42,easing:g.ease},f);var P=this.transform,D=this.getZoom(),G=this.getBearing(),Q=this.getPitch(),ge=this.getPadding(),Ee="zoom"in f?g.clamp(+f.zoom,P.minZoom,P.maxZoom):D,Se="bearing"in f?this._normalizeBearing(f.bearing,G):G,We="pitch"in f?+f.pitch:Q,je="padding"in f?f.padding:P.padding,lt=P.zoomScale(Ee-D),Re=g.Point.convert(f.offset),at=P.centerPoint.add(Re),mt=P.pointLocation(at),Wt=g.LngLat.convert(f.center||mt);this._normalizeCenter(Wt);var vr=P.project(mt),ur=P.project(Wt).sub(vr),hr=f.curve,Lr=Math.max(P.width,P.height),Jr=Lr/lt,Yr=ur.mag();if("minZoom"in f){var yn=g.clamp(Math.min(f.minZoom,D,Ee),P.minZoom,P.maxZoom),Jn=Lr/P.zoomScale(yn-D);hr=Math.sqrt(Jn/Yr*2)}var ei=hr*hr;function ni(fi){var li=(Jr*Jr-Lr*Lr+(fi?-1:1)*ei*ei*Yr*Yr)/(2*(fi?Jr:Lr)*ei*Yr);return Math.log(Math.sqrt(li*li+1)-li)}function Wi(fi){return(Math.exp(fi)-Math.exp(-fi))/2}function bn(fi){return(Math.exp(fi)+Math.exp(-fi))/2}var pi=ni(0),Ti=function(fi){return bn(pi)/bn(pi+hr*fi)},mi=function(fi){return Lr*((bn(pi)*(Wi(li=pi+hr*fi)/bn(li))-Wi(pi))/ei)/Yr;var li},ui=(ni(1)-pi)/hr;if(Math.abs(Yr)<1e-6||!isFinite(ui)){if(Math.abs(Lr-Jr)<1e-6)return this.easeTo(f,v);var Oi=Jr<Lr?-1:1;ui=Math.abs(Math.log(Jr/Lr))/hr,mi=function(){return 0},Ti=function(fi){return Math.exp(Oi*hr*fi)}}return f.duration="duration"in f?+f.duration:1e3*ui/("screenSpeed"in f?+f.screenSpeed/hr:+f.speed),f.maxDuration&&f.duration>f.maxDuration&&(f.duration=0),this._zooming=!0,this._rotating=G!==Se,this._pitching=We!==Q,this._padding=!P.isPaddingEqual(je),this._prepareEase(v,!1),this._ease(function(fi){var li=fi*ui,ho=1/Ti(li);P.zoom=fi===1?Ee:D+P.scaleZoom(ho),S._rotating&&(P.bearing=g.number(G,Se,fi)),S._pitching&&(P.pitch=g.number(Q,We,fi)),S._padding&&(P.interpolatePadding(ge,je,fi),at=P.centerPoint.add(Re));var Ga=fi===1?Wt:P.unproject(vr.add(ur.mult(mi(li))).mult(ho));P.setLocationAtPoint(P.renderWorldCopies?Ga.wrap():Ga,at),S._fireMoveEvents(v)},function(){return S._afterEase(v)},f),this},h.prototype.isEasing=function(){return!!this._easeFrameId},h.prototype.stop=function(){return this._stop()},h.prototype._stop=function(f,v){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,v)}if(!f){var T=this.handlers;T&&T.stop(!1)}return this},h.prototype._ease=function(f,v,S){S.animate===!1||S.duration===0?(f(1),v()):(this._easeStart=g.browser.now(),this._easeOptions=S,this._onEaseFrame=f,this._onEaseEnd=v,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},h.prototype._renderFrameCallback=function(){var f=Math.min((g.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},h.prototype._normalizeBearing=function(f,v){f=g.wrap(f,-180,180);var S=Math.abs(f-v);return Math.abs(f-360-v)<S&&(f-=360),Math.abs(f+360-v)<S&&(f+=360),f},h.prototype._normalizeCenter=function(f){var v=this.transform;if(v.renderWorldCopies&&!v.lngRange){var S=f.lng-v.center.lng;f.lng+=S>180?-360:S<-180?360:0}},h}(g.Evented),Es=function(c){c===void 0&&(c={}),this.options=c,g.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Es.prototype.getDefaultPosition=function(){return"bottom-right"},Es.prototype.onAdd=function(c){var h=this.options&&this.options.compact;return this._map=c,this._container=N.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=N.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=N.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Es.prototype.onRemove=function(){N.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Es.prototype._setElementTitle=function(c,h){var f=this._map._getUIString("AttributionControl."+h);c.title=f,c.setAttribute("aria-label",f)},Es.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Es.prototype._updateEditLink=function(){var c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));var h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||g.config.ACCESS_TOKEN}];if(c){var f=h.reduce(function(v,S,T){return S.value&&(v+=S.key+"="+S.value+(T<h.length-1?"&":"")),v},"?");c.href=g.config.FEEDBACK_URL+"/"+f+(this._map._hash?this._map._hash.getHashString(!0):""),c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}},Es.prototype._updateData=function(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Es.prototype._updateAttributions=function(){if(this._map.style){var c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(function(D){return typeof D!="string"?"":D})):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){var h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}var f=this._map.style.sourceCaches;for(var v in f){var S=f[v];if(S.used){var T=S.getSource();T.attribution&&c.indexOf(T.attribution)<0&&c.push(T.attribution)}}c.sort(function(D,G){return D.length-G.length});var P=(c=c.filter(function(D,G){for(var Q=G+1;Q<c.length;Q++)if(c[Q].indexOf(D)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,c.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Es.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Gs=function(){g.bindAll(["_updateLogo"],this),g.bindAll(["_updateCompact"],this)};Gs.prototype.onAdd=function(c){this._map=c,this._container=N.create("div","mapboxgl-ctrl");var h=N.create("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Gs.prototype.onRemove=function(){N.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Gs.prototype.getDefaultPosition=function(){return"bottom-left"},Gs.prototype._updateLogo=function(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Gs.prototype._logoRequired=function(){if(this._map.style){var c=this._map.style.sourceCaches;for(var h in c)if(c[h].getSource().mapbox_logo)return!0;return!1}},Gs.prototype._updateCompact=function(){var c=this._container.children;if(c.length){var h=c[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}};var ts=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};ts.prototype.add=function(c){var h=++this._id;return this._queue.push({callback:c,id:h,cancelled:!1}),h},ts.prototype.remove=function(c){for(var h=this._currentlyRunning,f=0,v=h?this._queue.concat(h):this._queue;f<v.length;f+=1){var S=v[f];if(S.id===c)return void(S.cancelled=!0)}},ts.prototype.run=function(c){c===void 0&&(c=0);var h=this._currentlyRunning=this._queue;this._queue=[];for(var f=0,v=h;f<v.length;f+=1){var S=v[f];if(!S.cancelled&&(S.callback(c),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},ts.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Nu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},jc=g.window.HTMLImageElement,Vc=g.window.HTMLElement,va=g.window.ImageBitmap,Ma={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},ih=function(c){function h(v){var S=this;if((v=g.extend({},Ma,v)).minZoom!=null&&v.maxZoom!=null&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(v.minPitch!=null&&v.maxPitch!=null&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(v.minPitch!=null&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(v.maxPitch!=null&&v.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var T=new Ci(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies);if(c.call(this,T,v),this._interactive=v.interactive,this._maxTileCacheSize=v.maxTileCacheSize,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._crossSourceCollisions=v.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=v.collectResourceTiming,this._renderTaskQueue=new ts,this._controls=[],this._mapId=g.uniqueId(),this._locale=g.extend({},Nu,v.locale),this._clickTolerance=v.clickTolerance,this._requestManager=new g.RequestManager(v.transformRequest,v.accessToken),typeof v.container=="string"){if(this._container=g.window.document.getElementById(v.container),!this._container)throw new Error("Container '"+v.container+"' not found.")}else{if(!(v.container instanceof Vc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(v.maxBounds&&this.setMaxBounds(v.maxBounds),g.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),g.window!==void 0&&(g.window.addEventListener("online",this._onWindowOnline,!1),g.window.addEventListener("resize",this._onWindowResize,!1),g.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new jn(this,v),this._hash=v.hash&&new Gi(typeof v.hash=="string"&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,g.extend({},v.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=v.localIdeographFontFamily,v.style&&this.setStyle(v.style,{localIdeographFontFamily:v.localIdeographFontFamily}),v.attributionControl&&this.addControl(new Es({customAttribution:v.customAttribution})),this.addControl(new Gs,v.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(P){S._update(P.dataType==="style"),S.fire(new g.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){S.fire(new g.Event(P.dataType+"dataloading",P))})}c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h;var f={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return h.prototype._getMapId=function(){return this._mapId},h.prototype.addControl=function(v,S){if(S===void 0&&(S=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var T=v.onAdd(this);this._controls.push(v);var P=this._controlPositions[S];return S.indexOf("bottom")!==-1?P.insertBefore(T,P.firstChild):P.appendChild(T),this},h.prototype.removeControl=function(v){if(!v||!v.onRemove)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(v);return S>-1&&this._controls.splice(S,1),v.onRemove(this),this},h.prototype.hasControl=function(v){return this._controls.indexOf(v)>-1},h.prototype.resize=function(v){var S=this._containerDimensions(),T=S[0],P=S[1];if(T===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(T,P),this.transform.resize(T,P),this.painter.resize(T,P);var D=!this._moving;return D&&this.fire(new g.Event("movestart",v)).fire(new g.Event("move",v)),this.fire(new g.Event("resize",v)),D&&this.fire(new g.Event("moveend",v)),this},h.prototype.getBounds=function(){return this.transform.getBounds()},h.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},h.prototype.setMaxBounds=function(v){return this.transform.setMaxBounds(g.LngLatBounds.convert(v)),this._update()},h.prototype.setMinZoom=function(v){if((v=v==null?-2:v)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},h.prototype.getMinZoom=function(){return this.transform.minZoom},h.prototype.setMaxZoom=function(v){if((v=v==null?22:v)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")},h.prototype.getMaxZoom=function(){return this.transform.maxZoom},h.prototype.setMinPitch=function(v){if((v=v==null?0:v)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},h.prototype.getMinPitch=function(){return this.transform.minPitch},h.prototype.setMaxPitch=function(v){if((v=v==null?60:v)>60)throw new Error("maxPitch must be less than or equal to 60");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")},h.prototype.getMaxPitch=function(){return this.transform.maxPitch},h.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},h.prototype.setRenderWorldCopies=function(v){return this.transform.renderWorldCopies=v,this._update()},h.prototype.project=function(v){return this.transform.locationPoint(g.LngLat.convert(v))},h.prototype.unproject=function(v){return this.transform.pointLocation(g.Point.convert(v))},h.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},h.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},h.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},h.prototype._createDelegatedListener=function(v,S,T){var P,D=this;if(v==="mouseenter"||v==="mouseover"){var G=!1;return{layer:S,listener:T,delegates:{mousemove:function(ge){var Ee=D.getLayer(S)?D.queryRenderedFeatures(ge.point,{layers:[S]}):[];Ee.length?G||(G=!0,T.call(D,new Va(v,D,ge.originalEvent,{features:Ee}))):G=!1},mouseout:function(){G=!1}}}}if(v==="mouseleave"||v==="mouseout"){var Q=!1;return{layer:S,listener:T,delegates:{mousemove:function(ge){(D.getLayer(S)?D.queryRenderedFeatures(ge.point,{layers:[S]}):[]).length?Q=!0:Q&&(Q=!1,T.call(D,new Va(v,D,ge.originalEvent)))},mouseout:function(ge){Q&&(Q=!1,T.call(D,new Va(v,D,ge.originalEvent)))}}}}return{layer:S,listener:T,delegates:(P={},P[v]=function(ge){var Ee=D.getLayer(S)?D.queryRenderedFeatures(ge.point,{layers:[S]}):[];Ee.length&&(ge.features=Ee,T.call(D,ge),delete ge.features)},P)}},h.prototype.on=function(v,S,T){if(T===void 0)return c.prototype.on.call(this,v,S);var P=this._createDelegatedListener(v,S,T);for(var D in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(P),P.delegates)this.on(D,P.delegates[D]);return this},h.prototype.once=function(v,S,T){if(T===void 0)return c.prototype.once.call(this,v,S);var P=this._createDelegatedListener(v,S,T);for(var D in P.delegates)this.once(D,P.delegates[D]);return this},h.prototype.off=function(v,S,T){var P=this;return T===void 0?c.prototype.off.call(this,v,S):(this._delegatedListeners&&this._delegatedListeners[v]&&function(D){for(var G=D[v],Q=0;Q<G.length;Q++){var ge=G[Q];if(ge.layer===S&&ge.listener===T){for(var Ee in ge.delegates)P.off(Ee,ge.delegates[Ee]);return G.splice(Q,1),P}}}(this._delegatedListeners),this)},h.prototype.queryRenderedFeatures=function(v,S){if(!this.style)return[];var T;if(S!==void 0||v===void 0||v instanceof g.Point||Array.isArray(v)||(S=v,v=void 0),S=S||{},(v=v||[[0,0],[this.transform.width,this.transform.height]])instanceof g.Point||typeof v[0]=="number")T=[g.Point.convert(v)];else{var P=g.Point.convert(v[0]),D=g.Point.convert(v[1]);T=[P,new g.Point(D.x,P.y),D,new g.Point(P.x,D.y),P]}return this.style.queryRenderedFeatures(T,S,this.transform)},h.prototype.querySourceFeatures=function(v,S){return this.style.querySourceFeatures(v,S)},h.prototype.setStyle=function(v,S){return(S=g.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(v,S))},h.prototype._getUIString=function(v){var S=this._locale[v];if(S==null)throw new Error("Missing UI string '"+v+"'");return S},h.prototype._updateStyle=function(v,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),v?(this.style=new ys(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v):this.style.loadJSON(v),this):(delete this.style,this)},h.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ys(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},h.prototype._diffStyle=function(v,S){var T=this;if(typeof v=="string"){var P=this._requestManager.normalizeStyleURL(v),D=this._requestManager.transformRequest(P,g.ResourceType.Style);g.getJSON(D,function(G,Q){G?T.fire(new g.ErrorEvent(G)):Q&&T._updateDiff(Q,S)})}else typeof v=="object"&&this._updateDiff(v,S)},h.prototype._updateDiff=function(v,S){try{this.style.setState(v)&&this._update(!0)}catch(T){g.warnOnce("Unable to perform style diff: "+(T.message||T.error||T)+".  Rebuilding the style from scratch."),this._updateStyle(v,S)}},h.prototype.getStyle=function(){if(this.style)return this.style.serialize()},h.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():g.warnOnce("There is no style added to the map.")},h.prototype.addSource=function(v,S){return this._lazyInitEmptyStyle(),this.style.addSource(v,S),this._update(!0)},h.prototype.isSourceLoaded=function(v){var S=this.style&&this.style.sourceCaches[v];if(S!==void 0)return S.loaded();this.fire(new g.ErrorEvent(new Error("There is no source with ID '"+v+"'")))},h.prototype.areTilesLoaded=function(){var v=this.style&&this.style.sourceCaches;for(var S in v){var T=v[S]._tiles;for(var P in T){var D=T[P];if(D.state!=="loaded"&&D.state!=="errored")return!1}}return!0},h.prototype.addSourceType=function(v,S,T){return this._lazyInitEmptyStyle(),this.style.addSourceType(v,S,T)},h.prototype.removeSource=function(v){return this.style.removeSource(v),this._update(!0)},h.prototype.getSource=function(v){return this.style.getSource(v)},h.prototype.addImage=function(v,S,T){T===void 0&&(T={});var P=T.pixelRatio;P===void 0&&(P=1);var D=T.sdf;D===void 0&&(D=!1);var G=T.stretchX,Q=T.stretchY,ge=T.content;if(this._lazyInitEmptyStyle(),S instanceof jc||va&&S instanceof va){var Ee=g.browser.getImageData(S);this.style.addImage(v,{data:new g.RGBAImage({width:Ee.width,height:Ee.height},Ee.data),pixelRatio:P,stretchX:G,stretchY:Q,content:ge,sdf:D,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Se=S;this.style.addImage(v,{data:new g.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:P,stretchX:G,stretchY:Q,content:ge,sdf:D,version:0,userImage:Se}),Se.onAdd&&Se.onAdd(this,v)}},h.prototype.updateImage=function(v,S){var T=this.style.getImage(v);if(!T)return this.fire(new g.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=S instanceof jc||va&&S instanceof va?g.browser.getImageData(S):S,D=P.width,G=P.height,Q=P.data;return D===void 0||G===void 0?this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):D!==T.data.width||G!==T.data.height?this.fire(new g.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(T.data.replace(Q,!(S instanceof jc||va&&S instanceof va)),void this.style.updateImage(v,T))},h.prototype.hasImage=function(v){return v?!!this.style.getImage(v):(this.fire(new g.ErrorEvent(new Error("Missing required image id"))),!1)},h.prototype.removeImage=function(v){this.style.removeImage(v)},h.prototype.loadImage=function(v,S){g.getImage(this._requestManager.transformRequest(v,g.ResourceType.Image),S)},h.prototype.listImages=function(){return this.style.listImages()},h.prototype.addLayer=function(v,S){return this._lazyInitEmptyStyle(),this.style.addLayer(v,S),this._update(!0)},h.prototype.moveLayer=function(v,S){return this.style.moveLayer(v,S),this._update(!0)},h.prototype.removeLayer=function(v){return this.style.removeLayer(v),this._update(!0)},h.prototype.getLayer=function(v){return this.style.getLayer(v)},h.prototype.setLayerZoomRange=function(v,S,T){return this.style.setLayerZoomRange(v,S,T),this._update(!0)},h.prototype.setFilter=function(v,S,T){return T===void 0&&(T={}),this.style.setFilter(v,S,T),this._update(!0)},h.prototype.getFilter=function(v){return this.style.getFilter(v)},h.prototype.setPaintProperty=function(v,S,T,P){return P===void 0&&(P={}),this.style.setPaintProperty(v,S,T,P),this._update(!0)},h.prototype.getPaintProperty=function(v,S){return this.style.getPaintProperty(v,S)},h.prototype.setLayoutProperty=function(v,S,T,P){return P===void 0&&(P={}),this.style.setLayoutProperty(v,S,T,P),this._update(!0)},h.prototype.getLayoutProperty=function(v,S){return this.style.getLayoutProperty(v,S)},h.prototype.setLight=function(v,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(v,S),this._update(!0)},h.prototype.getLight=function(){return this.style.getLight()},h.prototype.setFeatureState=function(v,S){return this.style.setFeatureState(v,S),this._update()},h.prototype.removeFeatureState=function(v,S){return this.style.removeFeatureState(v,S),this._update()},h.prototype.getFeatureState=function(v){return this.style.getFeatureState(v)},h.prototype.getContainer=function(){return this._container},h.prototype.getCanvasContainer=function(){return this._canvasContainer},h.prototype.getCanvas=function(){return this._canvas},h.prototype._containerDimensions=function(){var v=0,S=0;return this._container&&(v=this._container.clientWidth||400,S=this._container.clientHeight||300),[v,S]},h.prototype._detectMissingCSS=function(){g.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&g.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},h.prototype._setupContainer=function(){var v=this._container;v.classList.add("mapboxgl-map"),(this._missingCSSCanary=N.create("div","mapboxgl-canary",v)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=N.create("div","mapboxgl-canvas-container",v);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=N.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var T=this._containerDimensions();this._resizeCanvas(T[0],T[1]);var P=this._controlContainer=N.create("div","mapboxgl-control-container",v),D=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){D[G]=N.create("div","mapboxgl-ctrl-"+G,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},h.prototype._resizeCanvas=function(v,S){var T=g.browser.devicePixelRatio||1;this._canvas.width=T*v,this._canvas.height=T*S,this._canvas.style.width=v+"px",this._canvas.style.height=S+"px"},h.prototype._setupPainter=function(){var v=g.extend({},fe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",v)||this._canvas.getContext("experimental-webgl",v);S?(this.painter=new Ka(S,this.transform),g.webpSupported.testSupport(S)):this.fire(new g.ErrorEvent(new Error("Failed to initialize WebGL")))},h.prototype._contextLost=function(v){v.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new g.Event("webglcontextlost",{originalEvent:v}))},h.prototype._contextRestored=function(v){this._setupPainter(),this.resize(),this._update(),this.fire(new g.Event("webglcontextrestored",{originalEvent:v}))},h.prototype._onMapScroll=function(v){if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},h.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},h.prototype._update=function(v){return this.style?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this},h.prototype._requestRenderFrame=function(v){return this._update(),this._renderTaskQueue.add(v)},h.prototype._cancelRenderFrame=function(v){this._renderTaskQueue.remove(v)},h.prototype._render=function(v){var S,T=this,P=0,D=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=D.createQueryEXT(),D.beginQueryEXT(D.TIME_ELAPSED_EXT,S),P=g.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var Q=this.transform.zoom,ge=g.browser.now();this.style.zoomHistory.update(Q,ge);var Ee=new g.EvaluationParameters(Q,{now:ge,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Se=Ee.crossFadingFactor();Se===1&&Se===this._crossFadingFactor||(G=!0,this._crossFadingFactor=Se),this.style.update(Ee)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new g.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new g.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var We=g.browser.now()-P;D.endQueryEXT(D.TIME_ELAPSED_EXT,S),setTimeout(function(){var Re=D.getQueryObjectEXT(S,D.QUERY_RESULT_EXT)/1e6;D.deleteQueryEXT(S),T.fire(new g.Event("gpu-timing-frame",{cpuTime:We,gpuTime:Re}))},50)}if(this.listens("gpu-timing-layer")){var je=this.painter.collectGpuTimers();setTimeout(function(){var Re=T.painter.queryGpuTimers(je);T.fire(new g.Event("gpu-timing-layer",{layerTimes:Re}))},50)}var lt=this._sourcesDirty||this._styleDirty||this._placementDirty;return lt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new g.Event("idle")),!this._loaded||this._fullyLoaded||lt||(this._fullyLoaded=!0),this}},h.prototype.remove=function(){this._hash&&this._hash.remove();for(var v=0,S=this._controls;v<S.length;v+=1)S[v].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),g.window!==void 0&&(g.window.removeEventListener("resize",this._onWindowResize,!1),g.window.removeEventListener("orientationchange",this._onWindowResize,!1),g.window.removeEventListener("online",this._onWindowOnline,!1));var T=this.painter.context.gl.getExtension("WEBGL_lose_context");T&&T.loseContext(),zl(this._canvasContainer),zl(this._controlContainer),zl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new g.Event("remove"))},h.prototype.triggerRepaint=function(){var v=this;this.style&&!this._frame&&(this._frame=g.browser.frame(function(S){v._frame=null,v._render(S)}))},h.prototype._onWindowOnline=function(){this._update()},h.prototype._onWindowResize=function(v){this._trackResize&&this.resize({originalEvent:v})._update()},f.showTileBoundaries.get=function(){return!!this._showTileBoundaries},f.showTileBoundaries.set=function(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())},f.showPadding.get=function(){return!!this._showPadding},f.showPadding.set=function(v){this._showPadding!==v&&(this._showPadding=v,this._update())},f.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},f.showCollisionBoxes.set=function(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())},f.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},f.showOverdrawInspector.set=function(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())},f.repaint.get=function(){return!!this._repaint},f.repaint.set=function(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())},f.vertices.get=function(){return!!this._vertices},f.vertices.set=function(v){this._vertices=v,this._update()},h.prototype._setCacheLimits=function(v,S){g.setCacheLimits(v,S)},f.version.get=function(){return g.version},Object.defineProperties(h.prototype,f),h}(Nl);function zl(c){c.parentNode&&c.parentNode.removeChild(c)}var Hs={showCompass:!0,showZoom:!0,visualizePitch:!1},Cu=function(c){var h=this;this.options=g.extend({},Hs,c),this._container=N.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(f){return f.preventDefault()}),this.options.showZoom&&(g.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(f){return h._map.zoomIn({},{originalEvent:f})}),N.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(f){return h._map.zoomOut({},{originalEvent:f})}),N.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(g.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(f){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:f}):h._map.resetNorth({},{originalEvent:f})}),this._compassIcon=N.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Cu.prototype._updateZoomButtons=function(){var c=this._map.getZoom(),h=c===this._map.getMaxZoom(),f=c===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())},Cu.prototype._rotateCompassArrow=function(){var c=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=c},Cu.prototype.onAdd=function(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wo(this._map,this._compass,this.options.visualizePitch)),this._container},Cu.prototype.onRemove=function(){N.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Cu.prototype._createButton=function(c,h){var f=N.create("button",c,this._container);return f.type="button",f.addEventListener("click",h),f},Cu.prototype._setButtonTitle=function(c,h){var f=this._map._getUIString("NavigationControl."+h);c.title=f,c.setAttribute("aria-label",f)};var wo=function(c,h,f){f===void 0&&(f=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new wf({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,f&&(this.mousePitch=new Ju({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),g.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),N.addEventListener(h,"mousedown",this.mousedown),N.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),N.addEventListener(h,"touchmove",this.touchmove),N.addEventListener(h,"touchend",this.touchend),N.addEventListener(h,"touchcancel",this.reset)};function ml(c,h,f){if(c=new g.LngLat(c.lng,c.lat),h){var v=new g.LngLat(c.lng-360,c.lat),S=new g.LngLat(c.lng+360,c.lat),T=f.locationPoint(c).distSqr(h);f.locationPoint(v).distSqr(h)<T?c=v:f.locationPoint(S).distSqr(h)<T&&(c=S)}for(;Math.abs(c.lng-f.center.lng)>180;){var P=f.locationPoint(c);if(P.x>=0&&P.y>=0&&P.x<=f.width&&P.y<=f.height)break;c.lng>f.center.lng?c.lng-=360:c.lng+=360}return c}wo.prototype.down=function(c,h){this.mouseRotate.mousedown(c,h),this.mousePitch&&this.mousePitch.mousedown(c,h),N.disableDrag()},wo.prototype.move=function(c,h){var f=this.map,v=this.mouseRotate.mousemoveWindow(c,h);if(v&&v.bearingDelta&&f.setBearing(f.getBearing()+v.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(c,h);S&&S.pitchDelta&&f.setPitch(f.getPitch()+S.pitchDelta)}},wo.prototype.off=function(){var c=this.element;N.removeEventListener(c,"mousedown",this.mousedown),N.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),N.removeEventListener(c,"touchmove",this.touchmove),N.removeEventListener(c,"touchend",this.touchend),N.removeEventListener(c,"touchcancel",this.reset),this.offTemp()},wo.prototype.offTemp=function(){N.enableDrag(),N.removeEventListener(g.window,"mousemove",this.mousemove),N.removeEventListener(g.window,"mouseup",this.mouseup)},wo.prototype.mousedown=function(c){this.down(g.extend({},c,{ctrlKey:!0,preventDefault:function(){return c.preventDefault()}}),N.mousePos(this.element,c)),N.addEventListener(g.window,"mousemove",this.mousemove),N.addEventListener(g.window,"mouseup",this.mouseup)},wo.prototype.mousemove=function(c){this.move(c,N.mousePos(this.element,c))},wo.prototype.mouseup=function(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()},wo.prototype.touchstart=function(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=N.touchPos(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return c.preventDefault()}},this._startPos))},wo.prototype.touchmove=function(c){c.targetTouches.length!==1?this.reset():(this._lastPos=N.touchPos(this.element,c.targetTouches)[0],this.move({preventDefault:function(){return c.preventDefault()}},this._lastPos))},wo.prototype.touchend=function(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},wo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var hu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zl(c,h,f){var v=c.classList;for(var S in hu)v.remove("mapboxgl-"+f+"-anchor-"+S);v.add("mapboxgl-"+f+"-anchor-"+h)}var hc,pc=function(c){function h(f,v){if(c.call(this),(f instanceof g.window.HTMLElement||v)&&(f=g.extend({element:f},v)),g.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=f&&f.anchor||"center",this._color=f&&f.color||"#3FB1CE",this._scale=f&&f.scale||1,this._draggable=f&&f.draggable||!1,this._clickTolerance=f&&f.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=f&&f.rotation||0,this._rotationAlignment=f&&f.rotationAlignment||"auto",this._pitchAlignment=f&&f.pitchAlignment&&f.pitchAlignment!=="auto"?f.pitchAlignment:this._rotationAlignment,f&&f.element)this._element=f.element,this._offset=g.Point.convert(f&&f.offset||[0,0]);else{this._defaultMarker=!0,this._element=N.create("div"),this._element.setAttribute("aria-label","Map marker");var S=N.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var T=N.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"stroke","none"),T.setAttributeNS(null,"stroke-width","1"),T.setAttributeNS(null,"fill","none"),T.setAttributeNS(null,"fill-rule","evenodd");var P=N.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var D=N.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");for(var G=0,Q=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<Q.length;G+=1){var ge=Q[G],Ee=N.createNS("http://www.w3.org/2000/svg","ellipse");Ee.setAttributeNS(null,"opacity","0.04"),Ee.setAttributeNS(null,"cx","10.5"),Ee.setAttributeNS(null,"cy","5.80029008"),Ee.setAttributeNS(null,"rx",ge.rx),Ee.setAttributeNS(null,"ry",ge.ry),D.appendChild(Ee)}var Se=N.createNS("http://www.w3.org/2000/svg","g");Se.setAttributeNS(null,"fill",this._color);var We=N.createNS("http://www.w3.org/2000/svg","path");We.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Se.appendChild(We);var je=N.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"opacity","0.25"),je.setAttributeNS(null,"fill","#000000");var lt=N.createNS("http://www.w3.org/2000/svg","path");lt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),je.appendChild(lt);var Re=N.createNS("http://www.w3.org/2000/svg","g");Re.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Re.setAttributeNS(null,"fill","#FFFFFF");var at=N.createNS("http://www.w3.org/2000/svg","g");at.setAttributeNS(null,"transform","translate(8.0, 8.0)");var mt=N.createNS("http://www.w3.org/2000/svg","circle");mt.setAttributeNS(null,"fill","#000000"),mt.setAttributeNS(null,"opacity","0.25"),mt.setAttributeNS(null,"cx","5.5"),mt.setAttributeNS(null,"cy","5.5"),mt.setAttributeNS(null,"r","5.4999962");var Wt=N.createNS("http://www.w3.org/2000/svg","circle");Wt.setAttributeNS(null,"fill","#FFFFFF"),Wt.setAttributeNS(null,"cx","5.5"),Wt.setAttributeNS(null,"cy","5.5"),Wt.setAttributeNS(null,"r","5.4999962"),at.appendChild(mt),at.appendChild(Wt),P.appendChild(D),P.appendChild(Se),P.appendChild(je),P.appendChild(Re),P.appendChild(at),S.appendChild(P),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=g.Point.convert(f&&f.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(vr){vr.preventDefault()}),this._element.addEventListener("mousedown",function(vr){vr.preventDefault()}),Zl(this._element,this._anchor,"marker"),this._popup=null}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.addTo=function(f){return this.remove(),this._map=f,f.getCanvasContainer().appendChild(this._element),f.on("move",this._update),f.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},h.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),N.remove(this._element),this._popup&&this._popup.remove(),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(f){return this._lngLat=g.LngLat.convert(f),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},h.prototype.getElement=function(){return this._element},h.prototype.setPopup=function(f){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),f){if(!("offset"in f.options)){var v=Math.sqrt(Math.pow(13.5,2)/2);f.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=f,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},h.prototype._onKeyPress=function(f){var v=f.code,S=f.charCode||f.keyCode;v!=="Space"&&v!=="Enter"&&S!==32&&S!==13||this.togglePopup()},h.prototype._onMapClick=function(f){var v=f.originalEvent.target,S=this._element;this._popup&&(v===S||S.contains(v))&&this.togglePopup()},h.prototype.getPopup=function(){return this._popup},h.prototype.togglePopup=function(){var f=this._popup;return f?(f.isOpen()?f.remove():f.addTo(this._map),this):this},h.prototype._update=function(f){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ml(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(v="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),f&&f.type!=="moveend"||(this._pos=this._pos.round()),N.setTransform(this._element,hu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+v)}},h.prototype.getOffset=function(){return this._offset},h.prototype.setOffset=function(f){return this._offset=g.Point.convert(f),this._update(),this},h.prototype._onMove=function(f){if(!this._isDragging){var v=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=v}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new g.Event("dragstart"))),this.fire(new g.Event("drag")))},h.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new g.Event("dragend")),this._state="inactive"},h.prototype._addDragHandler=function(f){this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},h.prototype.setDraggable=function(f){return this._draggable=!!f,this._map&&(f?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},h.prototype.isDraggable=function(){return this._draggable},h.prototype.setRotation=function(f){return this._rotation=f||0,this._update(),this},h.prototype.getRotation=function(){return this._rotation},h.prototype.setRotationAlignment=function(f){return this._rotationAlignment=f||"auto",this._update(),this},h.prototype.getRotationAlignment=function(){return this._rotationAlignment},h.prototype.setPitchAlignment=function(f){return this._pitchAlignment=f&&f!=="auto"?f:this._rotationAlignment,this._update(),this},h.prototype.getPitchAlignment=function(){return this._pitchAlignment},h}(g.Evented),Tf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},dc=0,Ss=!1,Dh=function(c){function h(f){c.call(this),this.options=g.extend({},Tf,f),g.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.onAdd=function(f){var v;return this._map=f,this._container=N.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),v=this._setupUI,hc!==void 0?v(hc):g.window.navigator.permissions!==void 0?g.window.navigator.permissions.query({name:"geolocation"}).then(function(S){v(hc=S.state!=="denied")}):v(hc=!!g.window.navigator.geolocation),this._container},h.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),N.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,dc=0,Ss=!1},h.prototype._isOutOfMapMaxBounds=function(f){var v=this._map.getMaxBounds(),S=f.coords;return v&&(S.longitude<v.getWest()||S.longitude>v.getEast()||S.latitude<v.getSouth()||S.latitude>v.getNorth())},h.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},h.prototype._onSuccess=function(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new g.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("geolocate",f)),this._finish()}},h.prototype._updateCamera=function(f){var v=new g.LngLat(f.coords.longitude,f.coords.latitude),S=f.coords.accuracy,T=this._map.getBearing(),P=g.extend({bearing:T},this.options.fitBoundsOptions);this._map.fitBounds(v.toBounds(S),P,{geolocateSource:!0})},h.prototype._updateMarker=function(f){if(f){var v=new g.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(v).addTo(this._map),this._userLocationDotMarker.setLngLat(v).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},h.prototype._updateCircleRadius=function(){var f=this._map._container.clientHeight/2,v=this._map.unproject([0,f]),S=this._map.unproject([1,f]),T=v.distanceTo(S),P=Math.ceil(2*this._accuracy/T);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},h.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},h.prototype._onError=function(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var v=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=v,this._geolocateButton.setAttribute("aria-label",v),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&Ss)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("error",f)),this._finish()}},h.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},h.prototype._setupUI=function(f){var v=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=N.create("button","mapboxgl-ctrl-geolocate",this._container),N.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",f===!1){g.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var T=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=T,this._geolocateButton.setAttribute("aria-label",T)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=N.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new pc(this._dotElement),this._circleElement=N.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||v._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(v._watchState="BACKGROUND",v._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),v._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),v.fire(new g.Event("trackuserlocationend")))})},h.prototype.trigger=function(){if(!this._setup)return g.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new g.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":dc--,Ss=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new g.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new g.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++dc>1?(f={maximumAge:6e5,timeout:0},Ss=!0):(f=this.options.positionOptions,Ss=!1),this._geolocationWatchID=g.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else g.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},h.prototype._clearWatch=function(){g.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},h}(g.Evented),Ul={maxWidth:100,unit:"metric"},gl=function(c){this.options=g.extend({},Ul,c),g.bindAll(["_onMove","setUnit"],this)};function ah(c,h,f){var v=f&&f.maxWidth||100,S=c._container.clientHeight/2,T=c.unproject([0,S]),P=c.unproject([v,S]),D=T.distanceTo(P);if(f&&f.unit==="imperial"){var G=3.2808*D;G>5280?pu(h,v,G/5280,c._getUIString("ScaleControl.Miles")):pu(h,v,G,c._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?pu(h,v,D/1852,c._getUIString("ScaleControl.NauticalMiles")):D>=1e3?pu(h,v,D/1e3,c._getUIString("ScaleControl.Kilometers")):pu(h,v,D,c._getUIString("ScaleControl.Meters"))}function pu(c,h,f,v){var S,T,P,D=(S=f,(T=Math.pow(10,(""+Math.floor(S)).length-1))*(P=(P=S/T)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(G){var Q=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*Q)/Q}(P)));c.style.width=h*(D/f)+"px",c.innerHTML=D+"&nbsp;"+v}gl.prototype.getDefaultPosition=function(){return"bottom-left"},gl.prototype._onMove=function(){ah(this._map,this._container,this.options)},gl.prototype.onAdd=function(c){return this._map=c,this._container=N.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},gl.prototype.onRemove=function(){N.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},gl.prototype.setUnit=function(c){this.options.unit=c,ah(this._map,this._container,this.options)};var Is=function(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof g.window.HTMLElement?this._container=c.container:g.warnOnce("Full screen control 'container' must be a DOM element.")),g.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in g.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in g.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in g.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in g.window.document&&(this._fullscreenchange="MSFullscreenChange")};Is.prototype.onAdd=function(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=N.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",g.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Is.prototype.onRemove=function(){N.remove(this._controlContainer),this._map=null,g.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Is.prototype._checkFullscreenSupport=function(){return!!(g.window.document.fullscreenEnabled||g.window.document.mozFullScreenEnabled||g.window.document.msFullscreenEnabled||g.window.document.webkitFullscreenEnabled)},Is.prototype._setupUI=function(){var c=this._fullscreenButton=N.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);N.create("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden",!0),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),g.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Is.prototype._updateTitle=function(){var c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.title=c},Is.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Is.prototype._isFullscreen=function(){return this._fullscreen},Is.prototype._changeIcon=function(){(g.window.document.fullscreenElement||g.window.document.mozFullScreenElement||g.window.document.webkitFullscreenElement||g.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Is.prototype._onClickFullscreen=function(){this._isFullscreen()?g.window.document.exitFullscreen?g.window.document.exitFullscreen():g.window.document.mozCancelFullScreen?g.window.document.mozCancelFullScreen():g.window.document.msExitFullscreen?g.window.document.msExitFullscreen():g.window.document.webkitCancelFullScreen&&g.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var jl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},vc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Mf=function(c){function h(f){c.call(this),this.options=g.extend(Object.create(jl),f),g.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return c&&(h.__proto__=c),(h.prototype=Object.create(c&&c.prototype)).constructor=h,h.prototype.addTo=function(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new g.Event("open")),this},h.prototype.isOpen=function(){return!!this._map},h.prototype.remove=function(){return this._content&&N.remove(this._content),this._container&&(N.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new g.Event("close")),this},h.prototype.getLngLat=function(){return this._lngLat},h.prototype.setLngLat=function(f){return this._lngLat=g.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},h.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},h.prototype.getElement=function(){return this._container},h.prototype.setText=function(f){return this.setDOMContent(g.window.document.createTextNode(f))},h.prototype.setHTML=function(f){var v,S=g.window.document.createDocumentFragment(),T=g.window.document.createElement("body");for(T.innerHTML=f;v=T.firstChild;)S.appendChild(v);return this.setDOMContent(S)},h.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},h.prototype.setMaxWidth=function(f){return this.options.maxWidth=f,this._update(),this},h.prototype.setDOMContent=function(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=N.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this},h.prototype.addClassName=function(f){this._container&&this._container.classList.add(f)},h.prototype.removeClassName=function(f){this._container&&this._container.classList.remove(f)},h.prototype.setOffset=function(f){return this.options.offset=f,this._update(),this},h.prototype.toggleClassName=function(f){if(this._container)return this._container.classList.toggle(f)},h.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=N.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},h.prototype._onMouseUp=function(f){this._update(f.point)},h.prototype._onMouseMove=function(f){this._update(f.point)},h.prototype._onDrag=function(f){this._update(f.point)},h.prototype._update=function(f){var v=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=N.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=N.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Ee){return v._container.classList.add(Ee)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ml(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f)){var S=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),T=this.options.anchor,P=function Ee(Se){if(Se){if(typeof Se=="number"){var We=Math.round(Math.sqrt(.5*Math.pow(Se,2)));return{center:new g.Point(0,0),top:new g.Point(0,Se),"top-left":new g.Point(We,We),"top-right":new g.Point(-We,We),bottom:new g.Point(0,-Se),"bottom-left":new g.Point(We,-We),"bottom-right":new g.Point(-We,-We),left:new g.Point(Se,0),right:new g.Point(-Se,0)}}if(Se instanceof g.Point||Array.isArray(Se)){var je=g.Point.convert(Se);return{center:je,top:je,"top-left":je,"top-right":je,bottom:je,"bottom-left":je,"bottom-right":je,left:je,right:je}}return{center:g.Point.convert(Se.center||[0,0]),top:g.Point.convert(Se.top||[0,0]),"top-left":g.Point.convert(Se["top-left"]||[0,0]),"top-right":g.Point.convert(Se["top-right"]||[0,0]),bottom:g.Point.convert(Se.bottom||[0,0]),"bottom-left":g.Point.convert(Se["bottom-left"]||[0,0]),"bottom-right":g.Point.convert(Se["bottom-right"]||[0,0]),left:g.Point.convert(Se.left||[0,0]),right:g.Point.convert(Se.right||[0,0])}}return Ee(new g.Point(0,0))}(this.options.offset);if(!T){var D,G=this._container.offsetWidth,Q=this._container.offsetHeight;D=S.y+P.bottom.y<Q?["top"]:S.y>this._map.transform.height-Q?["bottom"]:[],S.x<G/2?D.push("left"):S.x>this._map.transform.width-G/2&&D.push("right"),T=D.length===0?"bottom":D.join("-")}var ge=S.add(P[T]).round();N.setTransform(this._container,hu[T]+" translate("+ge.x+"px,"+ge.y+"px)"),Zl(this._container,T,"popup")}},h.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var f=this._container.querySelector(vc);f&&f.focus()}},h.prototype._onClose=function(){this.remove()},h}(g.Evented),mc={version:g.version,supported:fe,setRTLTextPlugin:g.setRTLTextPlugin,getRTLTextPluginStatus:g.getRTLTextPluginStatus,Map:ih,NavigationControl:Cu,GeolocateControl:Dh,AttributionControl:Es,ScaleControl:gl,FullscreenControl:Is,Popup:Mf,Marker:pc,Style:ys,LngLat:g.LngLat,LngLatBounds:g.LngLatBounds,Point:g.Point,MercatorCoordinate:g.MercatorCoordinate,Evented:g.Evented,config:g.config,prewarm:function(){tr().acquire(cr)},clearPrewarmedResources:function(){var c=zn;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(cr),zn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return g.config.ACCESS_TOKEN},set accessToken(c){g.config.ACCESS_TOKEN=c},get baseApiUrl(){return g.config.API_URL},set baseApiUrl(c){g.config.API_URL=c},get workerCount(){return Rr.workerCount},set workerCount(c){Rr.workerCount=c},get maxParallelImageRequests(){return g.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){g.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage:function(c){g.clearTileCache(c)},workerUrl:""};return mc}),J})},3614:function(It,ie,F){"use strict";It.exports=Y;var J=F(80645);function Y(q){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(q)?q:new Uint8Array(q||0),this.pos=0,this.type=0,this.length=this.buf.length}Y.Varint=0,Y.Fixed64=1,Y.Bytes=2,Y.Fixed32=5;var g=(1<<16)*(1<<16),fe=1/g,N=12,oe=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");Y.prototype={destroy:function(){this.buf=null},readFields:function(q,pe,b){for(b=b||this.length;this.pos<b;){var le=this.readVarint(),xe=le>>3,Qe=this.pos;this.type=le&7,q(xe,pe,this),this.pos===Qe&&this.skip(le)}return pe},readMessage:function(q,pe){return this.readFields(q,pe,this.readVarint()+this.pos)},readFixed32:function(){var q=At(this.buf,this.pos);return this.pos+=4,q},readSFixed32:function(){var q=Zt(this.buf,this.pos);return this.pos+=4,q},readFixed64:function(){var q=At(this.buf,this.pos)+At(this.buf,this.pos+4)*g;return this.pos+=8,q},readSFixed64:function(){var q=At(this.buf,this.pos)+Zt(this.buf,this.pos+4)*g;return this.pos+=8,q},readFloat:function(){var q=J.read(this.buf,this.pos,!0,23,4);return this.pos+=4,q},readDouble:function(){var q=J.read(this.buf,this.pos,!0,52,8);return this.pos+=8,q},readVarint:function(q){var pe=this.buf,b,le;return le=pe[this.pos++],b=le&127,le<128||(le=pe[this.pos++],b|=(le&127)<<7,le<128)||(le=pe[this.pos++],b|=(le&127)<<14,le<128)||(le=pe[this.pos++],b|=(le&127)<<21,le<128)?b:(le=pe[this.pos],b|=(le&15)<<28,ne(b,q,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var q=this.readVarint();return q%2==1?(q+1)/-2:q/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var q=this.readVarint()+this.pos,pe=this.pos;return this.pos=q,q-pe>=N&&oe?nr(this.buf,pe,q):ut(this.buf,pe,q)},readBytes:function(){var q=this.readVarint()+this.pos,pe=this.buf.subarray(this.pos,q);return this.pos=q,pe},readPackedVarint:function(q,pe){if(this.type!==Y.Bytes)return q.push(this.readVarint(pe));var b=we(this);for(q=q||[];this.pos<b;)q.push(this.readVarint(pe));return q},readPackedSVarint:function(q){if(this.type!==Y.Bytes)return q.push(this.readSVarint());var pe=we(this);for(q=q||[];this.pos<pe;)q.push(this.readSVarint());return q},readPackedBoolean:function(q){if(this.type!==Y.Bytes)return q.push(this.readBoolean());var pe=we(this);for(q=q||[];this.pos<pe;)q.push(this.readBoolean());return q},readPackedFloat:function(q){if(this.type!==Y.Bytes)return q.push(this.readFloat());var pe=we(this);for(q=q||[];this.pos<pe;)q.push(this.readFloat());return q},readPackedDouble:function(q){if(this.type!==Y.Bytes)return q.push(this.readDouble());var pe=we(this);for(q=q||[];this.pos<pe;)q.push(this.readDouble());return q},readPackedFixed32:function(q){if(this.type!==Y.Bytes)return q.push(this.readFixed32());var pe=we(this);for(q=q||[];this.pos<pe;)q.push(this.readFixed32());return q},readPackedSFixed32:function(q){if(this.type!==Y.Bytes)return q.push(this.readSFixed32());var pe=we(this);for(q=q||[];this.pos<pe;)q.push(this.readSFixed32());return q},readPackedFixed64:function(q){if(this.type!==Y.Bytes)return q.push(this.readFixed64());var pe=we(this);for(q=q||[];this.pos<pe;)q.push(this.readFixed64());return q},readPackedSFixed64:function(q){if(this.type!==Y.Bytes)return q.push(this.readSFixed64());var pe=we(this);for(q=q||[];this.pos<pe;)q.push(this.readSFixed64());return q},skip:function(q){var pe=q&7;if(pe===Y.Varint)for(;this.buf[this.pos++]>127;);else if(pe===Y.Bytes)this.pos=this.readVarint()+this.pos;else if(pe===Y.Fixed32)this.pos+=4;else if(pe===Y.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+pe)},writeTag:function(q,pe){this.writeVarint(q<<3|pe)},realloc:function(q){for(var pe=this.length||16;pe<this.pos+q;)pe*=2;if(pe!==this.length){var b=new Uint8Array(pe);b.set(this.buf),this.buf=b,this.length=pe}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(q){this.realloc(4),nt(this.buf,q,this.pos),this.pos+=4},writeSFixed32:function(q){this.realloc(4),nt(this.buf,q,this.pos),this.pos+=4},writeFixed64:function(q){this.realloc(8),nt(this.buf,q&-1,this.pos),nt(this.buf,Math.floor(q*fe),this.pos+4),this.pos+=8},writeSFixed64:function(q){this.realloc(8),nt(this.buf,q&-1,this.pos),nt(this.buf,Math.floor(q*fe),this.pos+4),this.pos+=8},writeVarint:function(q){if(q=+q||0,q>268435455||q<0){ke(q,this);return}this.realloc(4),this.buf[this.pos++]=q&127|(q>127?128:0),!(q<=127)&&(this.buf[this.pos++]=(q>>>=7)&127|(q>127?128:0),!(q<=127)&&(this.buf[this.pos++]=(q>>>=7)&127|(q>127?128:0),!(q<=127)&&(this.buf[this.pos++]=q>>>7&127)))},writeSVarint:function(q){this.writeVarint(q<0?-q*2-1:q*2)},writeBoolean:function(q){this.writeVarint(Boolean(q))},writeString:function(q){q=String(q),this.realloc(q.length*4),this.pos++;var pe=this.pos;this.pos=Mr(this.buf,q,this.pos);var b=this.pos-pe;b>=128&&Je(pe,b,this),this.pos=pe-1,this.writeVarint(b),this.pos+=b},writeFloat:function(q){this.realloc(4),J.write(this.buf,q,this.pos,!0,23,4),this.pos+=4},writeDouble:function(q){this.realloc(8),J.write(this.buf,q,this.pos,!0,52,8),this.pos+=8},writeBytes:function(q){var pe=q.length;this.writeVarint(pe),this.realloc(pe);for(var b=0;b<pe;b++)this.buf[this.pos++]=q[b]},writeRawMessage:function(q,pe){this.pos++;var b=this.pos;q(pe,this);var le=this.pos-b;le>=128&&Je(b,le,this),this.pos=b-1,this.writeVarint(le),this.pos+=le},writeMessage:function(q,pe,b){this.writeTag(q,Y.Bytes),this.writeRawMessage(pe,b)},writePackedVarint:function(q,pe){pe.length&&this.writeMessage(q,Jt,pe)},writePackedSVarint:function(q,pe){pe.length&&this.writeMessage(q,_t,pe)},writePackedBoolean:function(q,pe){pe.length&&this.writeMessage(q,vt,pe)},writePackedFloat:function(q,pe){pe.length&&this.writeMessage(q,Ut,pe)},writePackedDouble:function(q,pe){pe.length&&this.writeMessage(q,Tt,pe)},writePackedFixed32:function(q,pe){pe.length&&this.writeMessage(q,pt,pe)},writePackedSFixed32:function(q,pe){pe.length&&this.writeMessage(q,Vt,pe)},writePackedFixed64:function(q,pe){pe.length&&this.writeMessage(q,ee,pe)},writePackedSFixed64:function(q,pe){pe.length&&this.writeMessage(q,rr,pe)},writeBytesField:function(q,pe){this.writeTag(q,Y.Bytes),this.writeBytes(pe)},writeFixed32Field:function(q,pe){this.writeTag(q,Y.Fixed32),this.writeFixed32(pe)},writeSFixed32Field:function(q,pe){this.writeTag(q,Y.Fixed32),this.writeSFixed32(pe)},writeFixed64Field:function(q,pe){this.writeTag(q,Y.Fixed64),this.writeFixed64(pe)},writeSFixed64Field:function(q,pe){this.writeTag(q,Y.Fixed64),this.writeSFixed64(pe)},writeVarintField:function(q,pe){this.writeTag(q,Y.Varint),this.writeVarint(pe)},writeSVarintField:function(q,pe){this.writeTag(q,Y.Varint),this.writeSVarint(pe)},writeStringField:function(q,pe){this.writeTag(q,Y.Bytes),this.writeString(pe)},writeFloatField:function(q,pe){this.writeTag(q,Y.Fixed32),this.writeFloat(pe)},writeDoubleField:function(q,pe){this.writeTag(q,Y.Fixed64),this.writeDouble(pe)},writeBooleanField:function(q,pe){this.writeVarintField(q,Boolean(pe))}};function ne(q,pe,b){var le=b.buf,xe,Qe;if(Qe=le[b.pos++],xe=(Qe&112)>>4,Qe<128||(Qe=le[b.pos++],xe|=(Qe&127)<<3,Qe<128)||(Qe=le[b.pos++],xe|=(Qe&127)<<10,Qe<128)||(Qe=le[b.pos++],xe|=(Qe&127)<<17,Qe<128)||(Qe=le[b.pos++],xe|=(Qe&127)<<24,Qe<128)||(Qe=le[b.pos++],xe|=(Qe&1)<<31,Qe<128))return re(q,xe,pe);throw new Error("Expected varint not more than 10 bytes")}function we(q){return q.type===Y.Bytes?q.readVarint()+q.pos:q.pos+1}function re(q,pe,b){return b?pe*4294967296+(q>>>0):(pe>>>0)*4294967296+(q>>>0)}function ke(q,pe){var b,le;if(q>=0?(b=q%4294967296|0,le=q/4294967296|0):(b=~(-q%4294967296),le=~(-q/4294967296),b^4294967295?b=b+1|0:(b=0,le=le+1|0)),q>=18446744073709552e3||q<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");pe.realloc(10),Ve(b,le,pe),Ne(le,pe)}function Ve(q,pe,b){b.buf[b.pos++]=q&127|128,q>>>=7,b.buf[b.pos++]=q&127|128,q>>>=7,b.buf[b.pos++]=q&127|128,q>>>=7,b.buf[b.pos++]=q&127|128,q>>>=7,b.buf[b.pos]=q&127}function Ne(q,pe){var b=(q&7)<<4;pe.buf[pe.pos++]|=b|((q>>>=3)?128:0),!!q&&(pe.buf[pe.pos++]=q&127|((q>>>=7)?128:0),!!q&&(pe.buf[pe.pos++]=q&127|((q>>>=7)?128:0),!!q&&(pe.buf[pe.pos++]=q&127|((q>>>=7)?128:0),!!q&&(pe.buf[pe.pos++]=q&127|((q>>>=7)?128:0),!!q&&(pe.buf[pe.pos++]=q&127)))))}function Je(q,pe,b){var le=pe<=16383?1:pe<=2097151?2:pe<=268435455?3:Math.floor(Math.log(pe)/(Math.LN2*7));b.realloc(le);for(var xe=b.pos-1;xe>=q;xe--)b.buf[xe+le]=b.buf[xe]}function Jt(q,pe){for(var b=0;b<q.length;b++)pe.writeVarint(q[b])}function _t(q,pe){for(var b=0;b<q.length;b++)pe.writeSVarint(q[b])}function Ut(q,pe){for(var b=0;b<q.length;b++)pe.writeFloat(q[b])}function Tt(q,pe){for(var b=0;b<q.length;b++)pe.writeDouble(q[b])}function vt(q,pe){for(var b=0;b<q.length;b++)pe.writeBoolean(q[b])}function pt(q,pe){for(var b=0;b<q.length;b++)pe.writeFixed32(q[b])}function Vt(q,pe){for(var b=0;b<q.length;b++)pe.writeSFixed32(q[b])}function ee(q,pe){for(var b=0;b<q.length;b++)pe.writeFixed64(q[b])}function rr(q,pe){for(var b=0;b<q.length;b++)pe.writeSFixed64(q[b])}function At(q,pe){return(q[pe]|q[pe+1]<<8|q[pe+2]<<16)+q[pe+3]*16777216}function nt(q,pe,b){q[b]=pe,q[b+1]=pe>>>8,q[b+2]=pe>>>16,q[b+3]=pe>>>24}function Zt(q,pe){return(q[pe]|q[pe+1]<<8|q[pe+2]<<16)+(q[pe+3]<<24)}function ut(q,pe,b){for(var le="",xe=pe;xe<b;){var Qe=q[xe],xt=null,Bt=Qe>239?4:Qe>223?3:Qe>191?2:1;if(xe+Bt>b)break;var Fe,bt,br;Bt===1?Qe<128&&(xt=Qe):Bt===2?(Fe=q[xe+1],(Fe&192)==128&&(xt=(Qe&31)<<6|Fe&63,xt<=127&&(xt=null))):Bt===3?(Fe=q[xe+1],bt=q[xe+2],(Fe&192)==128&&(bt&192)==128&&(xt=(Qe&15)<<12|(Fe&63)<<6|bt&63,(xt<=2047||xt>=55296&&xt<=57343)&&(xt=null))):Bt===4&&(Fe=q[xe+1],bt=q[xe+2],br=q[xe+3],(Fe&192)==128&&(bt&192)==128&&(br&192)==128&&(xt=(Qe&15)<<18|(Fe&63)<<12|(bt&63)<<6|br&63,(xt<=65535||xt>=1114112)&&(xt=null))),xt===null?(xt=65533,Bt=1):xt>65535&&(xt-=65536,le+=String.fromCharCode(xt>>>10&1023|55296),xt=56320|xt&1023),le+=String.fromCharCode(xt),xe+=Bt}return le}function nr(q,pe,b){return oe.decode(q.subarray(pe,b))}function Mr(q,pe,b){for(var le=0,xe,Qe;le<pe.length;le++){if(xe=pe.charCodeAt(le),xe>55295&&xe<57344)if(Qe)if(xe<56320){q[b++]=239,q[b++]=191,q[b++]=189,Qe=xe;continue}else xe=Qe-55296<<10|xe-56320|65536,Qe=null;else{xe>56319||le+1===pe.length?(q[b++]=239,q[b++]=191,q[b++]=189):Qe=xe;continue}else Qe&&(q[b++]=239,q[b++]=191,q[b++]=189,Qe=null);xe<128?q[b++]=xe:(xe<2048?q[b++]=xe>>6|192:(xe<65536?q[b++]=xe>>12|224:(q[b++]=xe>>18|240,q[b++]=xe>>12&63|128),q[b++]=xe>>6&63|128),q[b++]=xe&63|128)}return b}},32676:function(It,ie,F){var J=F(34155);(function(Y,g){It.exports=g()})(this,function(){"use strict";function Y(Et,de){if(!(Et instanceof de))throw new TypeError("Cannot call a class as a function")}function g(Et,de){for(var V=0;V<de.length;V++){var X=de[V];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(Et,X.key,X)}}function fe(Et,de,V){return de&&g(Et.prototype,de),V&&g(Et,V),Et}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var N=function(){function Et(de,V){this.next=null,this.key=de,this.data=V,this.left=null,this.right=null}return Et}();function oe(Et,de){return Et>de?1:Et<de?-1:0}function ne(Et,de,V){for(var X=new N(null,null),k=X,Ce=X;;){var et=V(Et,de.key);if(et<0){if(de.left===null)break;if(V(Et,de.left.key)<0){var Qt=de.left;if(de.left=Qt.right,Qt.right=de,de=Qt,de.left===null)break}Ce.left=de,Ce=de,de=de.left}else if(et>0){if(de.right===null)break;if(V(Et,de.right.key)>0){var Qt=de.right;if(de.right=Qt.left,Qt.left=de,de=Qt,de.right===null)break}k.right=de,k=de,de=de.right}else break}return k.right=de.left,Ce.left=de.right,de.left=X.right,de.right=X.left,de}function we(Et,de,V,X){var k=new N(Et,de);if(V===null)return k.left=k.right=null,k;V=ne(Et,V,X);var Ce=X(Et,V.key);return Ce<0?(k.left=V.left,k.right=V,V.left=null):Ce>=0&&(k.right=V.right,k.left=V,V.right=null),k}function re(Et,de,V){var X=null,k=null;if(de){de=ne(Et,de,V);var Ce=V(de.key,Et);Ce===0?(X=de.left,k=de.right):Ce<0?(k=de.right,de.right=null,X=de):(X=de.left,de.left=null,k=de)}return{left:X,right:k}}function ke(Et,de,V){return de===null?Et:(Et===null||(de=ne(Et.key,de,V),de.left=Et),de)}function Ve(Et,de,V,X,k){if(Et){X(""+de+(V?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+k(Et)+`
`);var Ce=de+(V?"    ":"\u2502   ");Et.left&&Ve(Et.left,Ce,!1,X,k),Et.right&&Ve(Et.right,Ce,!0,X,k)}}var Ne=function(){function Et(de){de===void 0&&(de=oe),this._root=null,this._size=0,this._comparator=de}return Et.prototype.insert=function(de,V){return this._size++,this._root=we(de,V,this._root,this._comparator)},Et.prototype.add=function(de,V){var X=new N(de,V);this._root===null&&(X.left=X.right=null,this._size++,this._root=X);var k=this._comparator,Ce=ne(de,this._root,k),et=k(de,Ce.key);return et===0?this._root=Ce:(et<0?(X.left=Ce.left,X.right=Ce,Ce.left=null):et>0&&(X.right=Ce.right,X.left=Ce,Ce.right=null),this._size++,this._root=X),this._root},Et.prototype.remove=function(de){this._root=this._remove(de,this._root,this._comparator)},Et.prototype._remove=function(de,V,X){var k;if(V===null)return null;V=ne(de,V,X);var Ce=X(de,V.key);return Ce===0?(V.left===null?k=V.right:(k=ne(de,V.left,X),k.right=V.right),this._size--,k):V},Et.prototype.pop=function(){var de=this._root;if(de){for(;de.left;)de=de.left;return this._root=ne(de.key,this._root,this._comparator),this._root=this._remove(de.key,this._root,this._comparator),{key:de.key,data:de.data}}return null},Et.prototype.findStatic=function(de){for(var V=this._root,X=this._comparator;V;){var k=X(de,V.key);if(k===0)return V;k<0?V=V.left:V=V.right}return null},Et.prototype.find=function(de){return this._root&&(this._root=ne(de,this._root,this._comparator),this._comparator(de,this._root.key)!==0)?null:this._root},Et.prototype.contains=function(de){for(var V=this._root,X=this._comparator;V;){var k=X(de,V.key);if(k===0)return!0;k<0?V=V.left:V=V.right}return!1},Et.prototype.forEach=function(de,V){for(var X=this._root,k=[],Ce=!1;!Ce;)X!==null?(k.push(X),X=X.left):k.length!==0?(X=k.pop(),de.call(V,X),X=X.right):Ce=!0;return this},Et.prototype.range=function(de,V,X,k){for(var Ce=[],et=this._comparator,Qt=this._root,Oe;Ce.length!==0||Qt;)if(Qt)Ce.push(Qt),Qt=Qt.left;else{if(Qt=Ce.pop(),Oe=et(Qt.key,V),Oe>0)break;if(et(Qt.key,de)>=0&&X.call(k,Qt))return this;Qt=Qt.right}return this},Et.prototype.keys=function(){var de=[];return this.forEach(function(V){var X=V.key;return de.push(X)}),de},Et.prototype.values=function(){var de=[];return this.forEach(function(V){var X=V.data;return de.push(X)}),de},Et.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Et.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Et.prototype.minNode=function(de){if(de===void 0&&(de=this._root),de)for(;de.left;)de=de.left;return de},Et.prototype.maxNode=function(de){if(de===void 0&&(de=this._root),de)for(;de.right;)de=de.right;return de},Et.prototype.at=function(de){for(var V=this._root,X=!1,k=0,Ce=[];!X;)if(V)Ce.push(V),V=V.left;else if(Ce.length>0){if(V=Ce.pop(),k===de)return V;k++,V=V.right}else X=!0;return null},Et.prototype.next=function(de){var V=this._root,X=null;if(de.right){for(X=de.right;X.left;)X=X.left;return X}for(var k=this._comparator;V;){var Ce=k(de.key,V.key);if(Ce===0)break;Ce<0?(X=V,V=V.left):V=V.right}return X},Et.prototype.prev=function(de){var V=this._root,X=null;if(de.left!==null){for(X=de.left;X.right;)X=X.right;return X}for(var k=this._comparator;V;){var Ce=k(de.key,V.key);if(Ce===0)break;Ce<0?V=V.left:(X=V,V=V.right)}return X},Et.prototype.clear=function(){return this._root=null,this._size=0,this},Et.prototype.toList=function(){return _t(this._root)},Et.prototype.load=function(de,V,X){V===void 0&&(V=[]),X===void 0&&(X=!1);var k=de.length,Ce=this._comparator;if(X&&vt(de,V,0,k-1,Ce),this._root===null)this._root=Je(de,V,0,k),this._size=k;else{var et=Tt(this.toList(),Jt(de,V),Ce);k=this._size+k,this._root=Ut({head:et},0,k)}return this},Et.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Et.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Et.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Et.prototype.toString=function(de){de===void 0&&(de=function(k){return String(k.key)});var V=[];return Ve(this._root,"",!0,function(X){return V.push(X)},de),V.join("")},Et.prototype.update=function(de,V,X){var k=this._comparator,Ce=re(de,this._root,k),et=Ce.left,Qt=Ce.right;k(de,V)<0?Qt=we(V,X,Qt,k):et=we(V,X,et,k),this._root=ke(et,Qt,k)},Et.prototype.split=function(de){return re(de,this._root,this._comparator)},Et}();function Je(Et,de,V,X){var k=X-V;if(k>0){var Ce=V+Math.floor(k/2),et=Et[Ce],Qt=de[Ce],Oe=new N(et,Qt);return Oe.left=Je(Et,de,V,Ce),Oe.right=Je(Et,de,Ce+1,X),Oe}return null}function Jt(Et,de){for(var V=new N(null,null),X=V,k=0;k<Et.length;k++)X=X.next=new N(Et[k],de[k]);return X.next=null,V.next}function _t(Et){for(var de=Et,V=[],X=!1,k=new N(null,null),Ce=k;!X;)de?(V.push(de),de=de.left):V.length>0?(de=Ce=Ce.next=V.pop(),de=de.right):X=!0;return Ce.next=null,k.next}function Ut(Et,de,V){var X=V-de;if(X>0){var k=de+Math.floor(X/2),Ce=Ut(Et,de,k),et=Et.head;return et.left=Ce,Et.head=Et.head.next,et.right=Ut(Et,k+1,V),et}return null}function Tt(Et,de,V){for(var X=new N(null,null),k=X,Ce=Et,et=de;Ce!==null&&et!==null;)V(Ce.key,et.key)<0?(k.next=Ce,Ce=Ce.next):(k.next=et,et=et.next),k=k.next;return Ce!==null?k.next=Ce:et!==null&&(k.next=et),X.next}function vt(Et,de,V,X,k){if(!(V>=X)){for(var Ce=Et[V+X>>1],et=V-1,Qt=X+1;;){do et++;while(k(Et[et],Ce)<0);do Qt--;while(k(Et[Qt],Ce)>0);if(et>=Qt)break;var Oe=Et[et];Et[et]=Et[Qt],Et[Qt]=Oe,Oe=de[et],de[et]=de[Qt],de[Qt]=Oe}vt(Et,de,V,Qt,k),vt(Et,de,Qt+1,X,k)}}var pt=function(de,V){return de.ll.x<=V.x&&V.x<=de.ur.x&&de.ll.y<=V.y&&V.y<=de.ur.y},Vt=function(de,V){if(V.ur.x<de.ll.x||de.ur.x<V.ll.x||V.ur.y<de.ll.y||de.ur.y<V.ll.y)return null;var X=de.ll.x<V.ll.x?V.ll.x:de.ll.x,k=de.ur.x<V.ur.x?de.ur.x:V.ur.x,Ce=de.ll.y<V.ll.y?V.ll.y:de.ll.y,et=de.ur.y<V.ur.y?de.ur.y:V.ur.y;return{ll:{x:X,y:Ce},ur:{x:k,y:et}}},ee=Number.EPSILON;ee===void 0&&(ee=Math.pow(2,-52));var rr=ee*ee,At=function(de,V){if(-ee<de&&de<ee&&-ee<V&&V<ee)return 0;var X=de-V;return X*X<rr*de*V?0:de<V?-1:1},nt=function(){function Et(){Y(this,Et),this.reset()}return fe(Et,[{key:"reset",value:function(){this.xRounder=new Zt,this.yRounder=new Zt}},{key:"round",value:function(V,X){return{x:this.xRounder.round(V),y:this.yRounder.round(X)}}}]),Et}(),Zt=function(){function Et(){Y(this,Et),this.tree=new Ne,this.round(0)}return fe(Et,[{key:"round",value:function(V){var X=this.tree.add(V),k=this.tree.prev(X);if(k!==null&&At(X.key,k.key)===0)return this.tree.remove(V),k.key;var Ce=this.tree.next(X);return Ce!==null&&At(X.key,Ce.key)===0?(this.tree.remove(V),Ce.key):V}}]),Et}(),ut=new nt,nr=function(de,V){return de.x*V.y-de.y*V.x},Mr=function(de,V){return de.x*V.x+de.y*V.y},q=function(de,V,X){var k={x:V.x-de.x,y:V.y-de.y},Ce={x:X.x-de.x,y:X.y-de.y},et=nr(k,Ce);return At(et,0)},pe=function(de){return Math.sqrt(Mr(de,de))},b=function(de,V,X){var k={x:V.x-de.x,y:V.y-de.y},Ce={x:X.x-de.x,y:X.y-de.y};return nr(Ce,k)/pe(Ce)/pe(k)},le=function(de,V,X){var k={x:V.x-de.x,y:V.y-de.y},Ce={x:X.x-de.x,y:X.y-de.y};return Mr(Ce,k)/pe(Ce)/pe(k)},xe=function(de,V,X){return V.y===0?null:{x:de.x+V.x/V.y*(X-de.y),y:X}},Qe=function(de,V,X){return V.x===0?null:{x:X,y:de.y+V.y/V.x*(X-de.x)}},xt=function(de,V,X,k){if(V.x===0)return Qe(X,k,de.x);if(k.x===0)return Qe(de,V,X.x);if(V.y===0)return xe(X,k,de.y);if(k.y===0)return xe(de,V,X.y);var Ce=nr(V,k);if(Ce==0)return null;var et={x:X.x-de.x,y:X.y-de.y},Qt=nr(et,V)/Ce,Oe=nr(et,k)/Ce,$e=de.x+Oe*V.x,Ht=X.x+Qt*k.x,or=de.y+Oe*V.y,pr=X.y+Qt*k.y,xr=($e+Ht)/2,Qr=(or+pr)/2;return{x:xr,y:Qr}},Bt=function(){fe(Et,null,[{key:"compare",value:function(V,X){var k=Et.comparePoints(V.point,X.point);return k!==0?k:(V.point!==X.point&&V.link(X),V.isLeft!==X.isLeft?V.isLeft?1:-1:bt.compare(V.segment,X.segment))}},{key:"comparePoints",value:function(V,X){return V.x<X.x?-1:V.x>X.x?1:V.y<X.y?-1:V.y>X.y?1:0}}]);function Et(de,V){Y(this,Et),de.events===void 0?de.events=[this]:de.events.push(this),this.point=de,this.isLeft=V}return fe(Et,[{key:"link",value:function(V){if(V.point===this.point)throw new Error("Tried to link already linked events");for(var X=V.point.events,k=0,Ce=X.length;k<Ce;k++){var et=X[k];this.point.events.push(et),et.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var V=this.point.events.length,X=0;X<V;X++){var k=this.point.events[X];if(k.segment.consumedBy===void 0)for(var Ce=X+1;Ce<V;Ce++){var et=this.point.events[Ce];et.consumedBy===void 0&&k.otherSE.point.events===et.otherSE.point.events&&k.segment.consume(et.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var V=[],X=0,k=this.point.events.length;X<k;X++){var Ce=this.point.events[X];Ce!==this&&!Ce.segment.ringOut&&Ce.segment.isInResult()&&V.push(Ce)}return V}},{key:"getLeftmostComparator",value:function(V){var X=this,k=new Map,Ce=function(Qt){var Oe=Qt.otherSE;k.set(Qt,{sine:b(X.point,V.point,Oe.point),cosine:le(X.point,V.point,Oe.point)})};return function(et,Qt){k.has(et)||Ce(et),k.has(Qt)||Ce(Qt);var Oe=k.get(et),$e=Oe.sine,Ht=Oe.cosine,or=k.get(Qt),pr=or.sine,xr=or.cosine;return $e>=0&&pr>=0?Ht<xr?1:Ht>xr?-1:0:$e<0&&pr<0?Ht<xr?-1:Ht>xr?1:0:pr<$e?-1:pr>$e?1:0}}}]),Et}(),Fe=0,bt=function(){fe(Et,null,[{key:"compare",value:function(V,X){var k=V.leftSE.point.x,Ce=X.leftSE.point.x,et=V.rightSE.point.x,Qt=X.rightSE.point.x;if(Qt<k)return 1;if(et<Ce)return-1;var Oe=V.leftSE.point.y,$e=X.leftSE.point.y,Ht=V.rightSE.point.y,or=X.rightSE.point.y;if(k<Ce){if($e<Oe&&$e<Ht)return 1;if($e>Oe&&$e>Ht)return-1;var pr=V.comparePoint(X.leftSE.point);if(pr<0)return 1;if(pr>0)return-1;var xr=X.comparePoint(V.rightSE.point);return xr!==0?xr:-1}if(k>Ce){if(Oe<$e&&Oe<or)return-1;if(Oe>$e&&Oe>or)return 1;var Qr=X.comparePoint(V.leftSE.point);if(Qr!==0)return Qr;var en=V.comparePoint(X.rightSE.point);return en<0?1:en>0?-1:1}if(Oe<$e)return-1;if(Oe>$e)return 1;if(et<Qt){var Dr=X.comparePoint(V.rightSE.point);if(Dr!==0)return Dr}if(et>Qt){var Wn=V.comparePoint(X.rightSE.point);if(Wn<0)return 1;if(Wn>0)return-1}if(et!==Qt){var qn=Ht-Oe,ta=et-k,na=or-$e,ba=Qt-Ce;if(qn>ta&&na<ba)return 1;if(qn<ta&&na>ba)return-1}return et>Qt?1:et<Qt||Ht<or?-1:Ht>or?1:V.id<X.id?-1:V.id>X.id?1:0}}]);function Et(de,V,X,k){Y(this,Et),this.id=++Fe,this.leftSE=de,de.segment=this,de.otherSE=V,this.rightSE=V,V.segment=this,V.otherSE=de,this.rings=X,this.windings=k}return fe(Et,[{key:"replaceRightSE",value:function(V){this.rightSE=V,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var V=this.leftSE.point.y,X=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:V<X?V:X},ur:{x:this.rightSE.point.x,y:V>X?V:X}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(V){return V.x===this.leftSE.point.x&&V.y===this.leftSE.point.y||V.x===this.rightSE.point.x&&V.y===this.rightSE.point.y}},{key:"comparePoint",value:function(V){if(this.isAnEndpoint(V))return 0;var X=this.leftSE.point,k=this.rightSE.point,Ce=this.vector();if(X.x===k.x)return V.x===X.x?0:V.x<X.x?1:-1;var et=(V.y-X.y)/Ce.y,Qt=X.x+et*Ce.x;if(V.x===Qt)return 0;var Oe=(V.x-X.x)/Ce.x,$e=X.y+Oe*Ce.y;return V.y===$e?0:V.y<$e?-1:1}},{key:"getIntersection",value:function(V){var X=this.bbox(),k=V.bbox(),Ce=Vt(X,k);if(Ce===null)return null;var et=this.leftSE.point,Qt=this.rightSE.point,Oe=V.leftSE.point,$e=V.rightSE.point,Ht=pt(X,Oe)&&this.comparePoint(Oe)===0,or=pt(k,et)&&V.comparePoint(et)===0,pr=pt(X,$e)&&this.comparePoint($e)===0,xr=pt(k,Qt)&&V.comparePoint(Qt)===0;if(or&&Ht)return xr&&!pr?Qt:!xr&&pr?$e:null;if(or)return pr&&et.x===$e.x&&et.y===$e.y?null:et;if(Ht)return xr&&Qt.x===Oe.x&&Qt.y===Oe.y?null:Oe;if(xr&&pr)return null;if(xr)return Qt;if(pr)return $e;var Qr=xt(et,this.vector(),Oe,V.vector());return Qr===null||!pt(Ce,Qr)?null:ut.round(Qr.x,Qr.y)}},{key:"split",value:function(V){var X=[],k=V.events!==void 0,Ce=new Bt(V,!0),et=new Bt(V,!1),Qt=this.rightSE;this.replaceRightSE(et),X.push(et),X.push(Ce);var Oe=new Et(Ce,Qt,this.rings.slice(),this.windings.slice());return Bt.comparePoints(Oe.leftSE.point,Oe.rightSE.point)>0&&Oe.swapEvents(),Bt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),k&&(Ce.checkForConsuming(),et.checkForConsuming()),X}},{key:"swapEvents",value:function(){var V=this.rightSE;this.rightSE=this.leftSE,this.leftSE=V,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var X=0,k=this.windings.length;X<k;X++)this.windings[X]*=-1}},{key:"consume",value:function(V){for(var X=this,k=V;X.consumedBy;)X=X.consumedBy;for(;k.consumedBy;)k=k.consumedBy;var Ce=Et.compare(X,k);if(Ce!==0){if(Ce>0){var et=X;X=k,k=et}if(X.prev===k){var Qt=X;X=k,k=Qt}for(var Oe=0,$e=k.rings.length;Oe<$e;Oe++){var Ht=k.rings[Oe],or=k.windings[Oe],pr=X.rings.indexOf(Ht);pr===-1?(X.rings.push(Ht),X.windings.push(or)):X.windings[pr]+=or}k.rings=null,k.windings=null,k.consumedBy=X,k.leftSE.consumedBy=X.leftSE,k.rightSE.consumedBy=X.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var V=this.prev.consumedBy||this.prev;this._beforeState=V.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var V=this.beforeState();this._afterState={rings:V.rings.slice(0),windings:V.windings.slice(0),multiPolys:[]};for(var X=this._afterState.rings,k=this._afterState.windings,Ce=this._afterState.multiPolys,et=0,Qt=this.rings.length;et<Qt;et++){var Oe=this.rings[et],$e=this.windings[et],Ht=X.indexOf(Oe);Ht===-1?(X.push(Oe),k.push($e)):k[Ht]+=$e}for(var or=[],pr=[],xr=0,Qr=X.length;xr<Qr;xr++)if(k[xr]!==0){var en=X[xr],Dr=en.poly;if(pr.indexOf(Dr)===-1)if(en.isExterior)or.push(Dr);else{pr.indexOf(Dr)===-1&&pr.push(Dr);var Wn=or.indexOf(en.poly);Wn!==-1&&or.splice(Wn,1)}}for(var qn=0,ta=or.length;qn<ta;qn++){var na=or[qn].multiPoly;Ce.indexOf(na)===-1&&Ce.push(na)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var V=this.beforeState().multiPolys,X=this.afterState().multiPolys;switch(ai.type){case"union":{var k=V.length===0,Ce=X.length===0;this._isInResult=k!==Ce;break}case"intersection":{var et,Qt;V.length<X.length?(et=V.length,Qt=X.length):(et=X.length,Qt=V.length),this._isInResult=Qt===ai.numMultiPolys&&et<Qt;break}case"xor":{var Oe=Math.abs(V.length-X.length);this._isInResult=Oe%2==1;break}case"difference":{var $e=function(or){return or.length===1&&or[0].isSubject};this._isInResult=$e(V)!==$e(X);break}default:throw new Error("Unrecognized operation type found ".concat(ai.type))}return this._isInResult}}],[{key:"fromRing",value:function(V,X,k){var Ce,et,Qt,Oe=Bt.comparePoints(V,X);if(Oe<0)Ce=V,et=X,Qt=1;else if(Oe>0)Ce=X,et=V,Qt=-1;else throw new Error("Tried to create degenerate segment at [".concat(V.x,", ").concat(V.y,"]"));var $e=new Bt(Ce,!0),Ht=new Bt(et,!1);return new Et($e,Ht,[k],[Qt])}}]),Et}(),br=function(){function Et(de,V,X){if(Y(this,Et),!Array.isArray(de)||de.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=V,this.isExterior=X,this.segments=[],typeof de[0][0]!="number"||typeof de[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var k=ut.round(de[0][0],de[0][1]);this.bbox={ll:{x:k.x,y:k.y},ur:{x:k.x,y:k.y}};for(var Ce=k,et=1,Qt=de.length;et<Qt;et++){if(typeof de[et][0]!="number"||typeof de[et][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Oe=ut.round(de[et][0],de[et][1]);Oe.x===Ce.x&&Oe.y===Ce.y||(this.segments.push(bt.fromRing(Ce,Oe,this)),Oe.x<this.bbox.ll.x&&(this.bbox.ll.x=Oe.x),Oe.y<this.bbox.ll.y&&(this.bbox.ll.y=Oe.y),Oe.x>this.bbox.ur.x&&(this.bbox.ur.x=Oe.x),Oe.y>this.bbox.ur.y&&(this.bbox.ur.y=Oe.y),Ce=Oe)}(k.x!==Ce.x||k.y!==Ce.y)&&this.segments.push(bt.fromRing(Ce,k,this))}return fe(Et,[{key:"getSweepEvents",value:function(){for(var V=[],X=0,k=this.segments.length;X<k;X++){var Ce=this.segments[X];V.push(Ce.leftSE),V.push(Ce.rightSE)}return V}}]),Et}(),mr=function(){function Et(de,V){if(Y(this,Et),!Array.isArray(de))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new br(de[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var X=1,k=de.length;X<k;X++){var Ce=new br(de[X],this,!1);Ce.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Ce.bbox.ll.x),Ce.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Ce.bbox.ll.y),Ce.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Ce.bbox.ur.x),Ce.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Ce.bbox.ur.y),this.interiorRings.push(Ce)}this.multiPoly=V}return fe(Et,[{key:"getSweepEvents",value:function(){for(var V=this.exteriorRing.getSweepEvents(),X=0,k=this.interiorRings.length;X<k;X++)for(var Ce=this.interiorRings[X].getSweepEvents(),et=0,Qt=Ce.length;et<Qt;et++)V.push(Ce[et]);return V}}]),Et}(),An=function(){function Et(de,V){if(Y(this,Et),!Array.isArray(de))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof de[0][0][0]=="number"&&(de=[de])}catch(et){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var X=0,k=de.length;X<k;X++){var Ce=new mr(de[X],this);Ce.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Ce.bbox.ll.x),Ce.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Ce.bbox.ll.y),Ce.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Ce.bbox.ur.x),Ce.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Ce.bbox.ur.y),this.polys.push(Ce)}this.isSubject=V}return fe(Et,[{key:"getSweepEvents",value:function(){for(var V=[],X=0,k=this.polys.length;X<k;X++)for(var Ce=this.polys[X].getSweepEvents(),et=0,Qt=Ce.length;et<Qt;et++)V.push(Ce[et]);return V}}]),Et}(),mn=function(){fe(Et,null,[{key:"factory",value:function(V){for(var X=[],k=0,Ce=V.length;k<Ce;k++){var et=V[k];if(!(!et.isInResult()||et.ringOut)){for(var Qt=null,Oe=et.leftSE,$e=et.rightSE,Ht=[Oe],or=Oe.point,pr=[];Qt=Oe,Oe=$e,Ht.push(Oe),Oe.point!==or;)for(;;){var xr=Oe.getAvailableLinkedEvents();if(xr.length===0){var Qr=Ht[0].point,en=Ht[Ht.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(Qr.x,",")+" ".concat(Qr.y,"]. Last matching segment found ends at")+" [".concat(en.x,", ").concat(en.y,"]."))}if(xr.length===1){$e=xr[0].otherSE;break}for(var Dr=null,Wn=0,qn=pr.length;Wn<qn;Wn++)if(pr[Wn].point===Oe.point){Dr=Wn;break}if(Dr!==null){var ta=pr.splice(Dr)[0],na=Ht.splice(ta.index);na.unshift(na[0].otherSE),X.push(new Et(na.reverse()));continue}pr.push({index:Ht.length,point:Oe.point});var ba=Oe.getLeftmostComparator(Qt);$e=xr.sort(ba)[0].otherSE;break}X.push(new Et(Ht))}}return X}}]);function Et(de){Y(this,Et),this.events=de;for(var V=0,X=de.length;V<X;V++)de[V].segment.ringOut=this;this.poly=null}return fe(Et,[{key:"getGeom",value:function(){for(var V=this.events[0].point,X=[V],k=1,Ce=this.events.length-1;k<Ce;k++){var et=this.events[k].point,Qt=this.events[k+1].point;q(et,V,Qt)!==0&&(X.push(et),V=et)}if(X.length===1)return null;var Oe=X[0],$e=X[1];q(Oe,V,$e)===0&&X.shift(),X.push(X[0]);for(var Ht=this.isExteriorRing()?1:-1,or=this.isExteriorRing()?0:X.length-1,pr=this.isExteriorRing()?X.length:-1,xr=[],Qr=or;Qr!=pr;Qr+=Ht)xr.push([X[Qr].x,X[Qr].y]);return xr}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var V=this.enclosingRing();this._isExteriorRing=V?!V.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var V=this.events[0],X=1,k=this.events.length;X<k;X++){var Ce=this.events[X];Bt.compare(V,Ce)>0&&(V=Ce)}for(var et=V.segment.prevInResult(),Qt=et?et.prevInResult():null;;){if(!et)return null;if(!Qt)return et.ringOut;if(Qt.ringOut!==et.ringOut)return Qt.ringOut.enclosingRing()!==et.ringOut?et.ringOut:et.ringOut.enclosingRing();et=Qt.prevInResult(),Qt=et?et.prevInResult():null}}}]),Et}(),wn=function(){function Et(de){Y(this,Et),this.exteriorRing=de,de.poly=this,this.interiorRings=[]}return fe(Et,[{key:"addInterior",value:function(V){this.interiorRings.push(V),V.poly=this}},{key:"getGeom",value:function(){var V=[this.exteriorRing.getGeom()];if(V[0]===null)return null;for(var X=0,k=this.interiorRings.length;X<k;X++){var Ce=this.interiorRings[X].getGeom();Ce!==null&&V.push(Ce)}return V}}]),Et}(),Ri=function(){function Et(de){Y(this,Et),this.rings=de,this.polys=this._composePolys(de)}return fe(Et,[{key:"getGeom",value:function(){for(var V=[],X=0,k=this.polys.length;X<k;X++){var Ce=this.polys[X].getGeom();Ce!==null&&V.push(Ce)}return V}},{key:"_composePolys",value:function(V){for(var X=[],k=0,Ce=V.length;k<Ce;k++){var et=V[k];if(!et.poly)if(et.isExteriorRing())X.push(new wn(et));else{var Qt=et.enclosingRing();Qt.poly||X.push(new wn(Qt)),Qt.poly.addInterior(et)}}return X}}]),Et}(),Qn=function(){function Et(de){var V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bt.compare;Y(this,Et),this.queue=de,this.tree=new Ne(V),this.segments=[]}return fe(Et,[{key:"process",value:function(V){var X=V.segment,k=[];if(V.consumedBy)return V.isLeft?this.queue.remove(V.otherSE):this.tree.remove(X),k;var Ce=V.isLeft?this.tree.insert(X):this.tree.find(X);if(!Ce)throw new Error("Unable to find segment #".concat(X.id," ")+"[".concat(X.leftSE.point.x,", ").concat(X.leftSE.point.y,"] -> ")+"[".concat(X.rightSE.point.x,", ").concat(X.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var et=Ce,Qt=Ce,Oe=void 0,$e=void 0;Oe===void 0;)et=this.tree.prev(et),et===null?Oe=null:et.key.consumedBy===void 0&&(Oe=et.key);for(;$e===void 0;)Qt=this.tree.next(Qt),Qt===null?$e=null:Qt.key.consumedBy===void 0&&($e=Qt.key);if(V.isLeft){var Ht=null;if(Oe){var or=Oe.getIntersection(X);if(or!==null&&(X.isAnEndpoint(or)||(Ht=or),!Oe.isAnEndpoint(or)))for(var pr=this._splitSafely(Oe,or),xr=0,Qr=pr.length;xr<Qr;xr++)k.push(pr[xr])}var en=null;if($e){var Dr=$e.getIntersection(X);if(Dr!==null&&(X.isAnEndpoint(Dr)||(en=Dr),!$e.isAnEndpoint(Dr)))for(var Wn=this._splitSafely($e,Dr),qn=0,ta=Wn.length;qn<ta;qn++)k.push(Wn[qn])}if(Ht!==null||en!==null){var na=null;if(Ht===null)na=en;else if(en===null)na=Ht;else{var ba=Bt.comparePoints(Ht,en);na=ba<=0?Ht:en}this.queue.remove(X.rightSE),k.push(X.rightSE);for(var ia=X.split(na),Ki=0,$=ia.length;Ki<$;Ki++)k.push(ia[Ki])}k.length>0?(this.tree.remove(X),k.push(V)):(this.segments.push(X),X.prev=Oe)}else{if(Oe&&$e){var ue=Oe.getIntersection($e);if(ue!==null){if(!Oe.isAnEndpoint(ue))for(var ve=this._splitSafely(Oe,ue),Te=0,Ze=ve.length;Te<Ze;Te++)k.push(ve[Te]);if(!$e.isAnEndpoint(ue))for(var it=this._splitSafely($e,ue),gt=0,be=it.length;gt<be;gt++)k.push(it[gt])}}this.tree.remove(X)}return k}},{key:"_splitSafely",value:function(V,X){this.tree.remove(V);var k=V.rightSE;this.queue.remove(k);var Ce=V.split(X);return Ce.push(k),V.consumedBy===void 0&&this.tree.insert(V),Ce}}]),Et}(),ii=typeof J!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Vi=typeof J!="undefined"&&{NODE_ENV:"production"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Ni=function(){function Et(){Y(this,Et)}return fe(Et,[{key:"run",value:function(V,X,k){ai.type=V,ut.reset();for(var Ce=[new An(X,!0)],et=0,Qt=k.length;et<Qt;et++)Ce.push(new An(k[et],!1));if(ai.numMultiPolys=Ce.length,ai.type==="difference")for(var Oe=Ce[0],$e=1;$e<Ce.length;)Vt(Ce[$e].bbox,Oe.bbox)!==null?$e++:Ce.splice($e,1);if(ai.type==="intersection"){for(var Ht=0,or=Ce.length;Ht<or;Ht++)for(var pr=Ce[Ht],xr=Ht+1,Qr=Ce.length;xr<Qr;xr++)if(Vt(pr.bbox,Ce[xr].bbox)===null)return[]}for(var en=new Ne(Bt.compare),Dr=0,Wn=Ce.length;Dr<Wn;Dr++)for(var qn=Ce[Dr].getSweepEvents(),ta=0,na=qn.length;ta<na;ta++)if(en.insert(qn[ta]),en.size>ii)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var ba=new Qn(en),ia=en.size,Ki=en.pop();Ki;){var $=Ki.key;if(en.size===ia){var ue=$.segment;throw new Error("Unable to pop() ".concat($.isLeft?"left":"right"," SweepEvent ")+"[".concat($.point.x,", ").concat($.point.y,"] from segment #").concat(ue.id," ")+"[".concat(ue.leftSE.point.x,", ").concat(ue.leftSE.point.y,"] -> ")+"[".concat(ue.rightSE.point.x,", ").concat(ue.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(en.size>ii)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(ba.segments.length>Vi)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var ve=ba.process($),Te=0,Ze=ve.length;Te<Ze;Te++){var it=ve[Te];it.consumedBy===void 0&&en.insert(it)}ia=en.size,Ki=en.pop()}ut.reset();var gt=mn.factory(ba.segments),be=new Ri(gt);return be.getGeom()}}]),Et}(),ai=new Ni,Vn=function(de){for(var V=arguments.length,X=new Array(V>1?V-1:0),k=1;k<V;k++)X[k-1]=arguments[k];return ai.run("union",de,X)},Yn=function(de){for(var V=arguments.length,X=new Array(V>1?V-1:0),k=1;k<V;k++)X[k-1]=arguments[k];return ai.run("intersection",de,X)},Li=function(de){for(var V=arguments.length,X=new Array(V>1?V-1:0),k=1;k<V;k++)X[k-1]=arguments[k];return ai.run("xor",de,X)},ra=function(de){for(var V=arguments.length,X=new Array(V>1?V-1:0),k=1;k<V;k++)X[k-1]=arguments[k];return ai.run("difference",de,X)},ri={union:Vn,intersection:Yn,xor:Li,difference:ra};return ri})},28660:function(It,ie,F){var J=F(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Y;(function(g){(function(fe){var N=typeof F.g=="object"?F.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),oe=ne(g);typeof N.Reflect=="undefined"?N.Reflect=g:oe=ne(N.Reflect,oe),fe(oe);function ne(we,re){return function(ke,Ve){typeof we[ke]!="function"&&Object.defineProperty(we,ke,{configurable:!0,writable:!0,value:Ve}),re&&re(ke,Ve)}}})(function(fe){var N=Object.prototype.hasOwnProperty,oe=typeof Symbol=="function",ne=oe&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",we=oe&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",re=typeof Object.create=="function",ke={__proto__:[]}instanceof Array,Ve=!re&&!ke,Ne={create:re?function(){return Qt(Object.create(null))}:ke?function(){return Qt({__proto__:null})}:function(){return Qt({})},has:Ve?function(Oe,$e){return N.call(Oe,$e)}:function(Oe,$e){return $e in Oe},get:Ve?function(Oe,$e){return N.call(Oe,$e)?Oe[$e]:void 0}:function(Oe,$e){return Oe[$e]}},Je=Object.getPrototypeOf(Function),Jt=typeof J=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",_t=!Jt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:k(),Ut=!Jt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ce(),Tt=!Jt&&typeof WeakMap=="function"?WeakMap:et(),vt=new Tt;function pt(Oe,$e,Ht,or){if(mr(Ht)){if(!ai(Oe))throw new TypeError;if(!Yn($e))throw new TypeError;return q(Oe,$e)}else{if(!ai(Oe))throw new TypeError;if(!wn($e))throw new TypeError;if(!wn(or)&&!mr(or)&&!An(or))throw new TypeError;return An(or)&&(or=void 0),Ht=Ni(Ht),pe(Oe,$e,Ht,or)}}fe("decorate",pt);function Vt(Oe,$e){function Ht(or,pr){if(!wn(or))throw new TypeError;if(!mr(pr)&&!Li(pr))throw new TypeError;Bt(Oe,$e,or,pr)}return Ht}fe("metadata",Vt);function ee(Oe,$e,Ht,or){if(!wn(Ht))throw new TypeError;return mr(or)||(or=Ni(or)),Bt(Oe,$e,Ht,or)}fe("defineMetadata",ee);function rr(Oe,$e,Ht){if(!wn($e))throw new TypeError;return mr(Ht)||(Ht=Ni(Ht)),le(Oe,$e,Ht)}fe("hasMetadata",rr);function At(Oe,$e,Ht){if(!wn($e))throw new TypeError;return mr(Ht)||(Ht=Ni(Ht)),xe(Oe,$e,Ht)}fe("hasOwnMetadata",At);function nt(Oe,$e,Ht){if(!wn($e))throw new TypeError;return mr(Ht)||(Ht=Ni(Ht)),Qe(Oe,$e,Ht)}fe("getMetadata",nt);function Zt(Oe,$e,Ht){if(!wn($e))throw new TypeError;return mr(Ht)||(Ht=Ni(Ht)),xt(Oe,$e,Ht)}fe("getOwnMetadata",Zt);function ut(Oe,$e){if(!wn(Oe))throw new TypeError;return mr($e)||($e=Ni($e)),Fe(Oe,$e)}fe("getMetadataKeys",ut);function nr(Oe,$e){if(!wn(Oe))throw new TypeError;return mr($e)||($e=Ni($e)),bt(Oe,$e)}fe("getOwnMetadataKeys",nr);function Mr(Oe,$e,Ht){if(!wn($e))throw new TypeError;mr(Ht)||(Ht=Ni(Ht));var or=b($e,Ht,!1);if(mr(or)||!or.delete(Oe))return!1;if(or.size>0)return!0;var pr=vt.get($e);return pr.delete(Ht),pr.size>0||vt.delete($e),!0}fe("deleteMetadata",Mr);function q(Oe,$e){for(var Ht=Oe.length-1;Ht>=0;--Ht){var or=Oe[Ht],pr=or($e);if(!mr(pr)&&!An(pr)){if(!Yn(pr))throw new TypeError;$e=pr}}return $e}function pe(Oe,$e,Ht,or){for(var pr=Oe.length-1;pr>=0;--pr){var xr=Oe[pr],Qr=xr($e,Ht,or);if(!mr(Qr)&&!An(Qr)){if(!wn(Qr))throw new TypeError;or=Qr}}return or}function b(Oe,$e,Ht){var or=vt.get(Oe);if(mr(or)){if(!Ht)return;or=new _t,vt.set(Oe,or)}var pr=or.get($e);if(mr(pr)){if(!Ht)return;pr=new _t,or.set($e,pr)}return pr}function le(Oe,$e,Ht){var or=xe(Oe,$e,Ht);if(or)return!0;var pr=X($e);return An(pr)?!1:le(Oe,pr,Ht)}function xe(Oe,$e,Ht){var or=b($e,Ht,!1);return mr(or)?!1:ii(or.has(Oe))}function Qe(Oe,$e,Ht){var or=xe(Oe,$e,Ht);if(or)return xt(Oe,$e,Ht);var pr=X($e);if(!An(pr))return Qe(Oe,pr,Ht)}function xt(Oe,$e,Ht){var or=b($e,Ht,!1);if(!mr(or))return or.get(Oe)}function Bt(Oe,$e,Ht,or){var pr=b(Ht,or,!0);pr.set(Oe,$e)}function Fe(Oe,$e){var Ht=bt(Oe,$e),or=X(Oe);if(or===null)return Ht;var pr=Fe(or,$e);if(pr.length<=0)return Ht;if(Ht.length<=0)return pr;for(var xr=new Ut,Qr=[],en=0,Dr=Ht;en<Dr.length;en++){var Wn=Dr[en],qn=xr.has(Wn);qn||(xr.add(Wn),Qr.push(Wn))}for(var ta=0,na=pr;ta<na.length;ta++){var Wn=na[ta],qn=xr.has(Wn);qn||(xr.add(Wn),Qr.push(Wn))}return Qr}function bt(Oe,$e){var Ht=[],or=b(Oe,$e,!1);if(mr(or))return Ht;for(var pr=or.keys(),xr=ri(pr),Qr=0;;){var en=de(xr);if(!en)return Ht.length=Qr,Ht;var Dr=Et(en);try{Ht[Qr]=Dr}catch(Wn){try{V(xr)}finally{throw Wn}}Qr++}}function br(Oe){if(Oe===null)return 1;switch(typeof Oe){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Oe===null?1:6;default:return 6}}function mr(Oe){return Oe===void 0}function An(Oe){return Oe===null}function mn(Oe){return typeof Oe=="symbol"}function wn(Oe){return typeof Oe=="object"?Oe!==null:typeof Oe=="function"}function Ri(Oe,$e){switch(br(Oe)){case 0:return Oe;case 1:return Oe;case 2:return Oe;case 3:return Oe;case 4:return Oe;case 5:return Oe}var Ht=$e===3?"string":$e===5?"number":"default",or=ra(Oe,ne);if(or!==void 0){var pr=or.call(Oe,Ht);if(wn(pr))throw new TypeError;return pr}return Qn(Oe,Ht==="default"?"number":Ht)}function Qn(Oe,$e){if($e==="string"){var Ht=Oe.toString;if(Vn(Ht)){var or=Ht.call(Oe);if(!wn(or))return or}var pr=Oe.valueOf;if(Vn(pr)){var or=pr.call(Oe);if(!wn(or))return or}}else{var pr=Oe.valueOf;if(Vn(pr)){var or=pr.call(Oe);if(!wn(or))return or}var xr=Oe.toString;if(Vn(xr)){var or=xr.call(Oe);if(!wn(or))return or}}throw new TypeError}function ii(Oe){return!!Oe}function Vi(Oe){return""+Oe}function Ni(Oe){var $e=Ri(Oe,3);return mn($e)?$e:Vi($e)}function ai(Oe){return Array.isArray?Array.isArray(Oe):Oe instanceof Object?Oe instanceof Array:Object.prototype.toString.call(Oe)==="[object Array]"}function Vn(Oe){return typeof Oe=="function"}function Yn(Oe){return typeof Oe=="function"}function Li(Oe){switch(br(Oe)){case 3:return!0;case 4:return!0;default:return!1}}function ra(Oe,$e){var Ht=Oe[$e];if(Ht!=null){if(!Vn(Ht))throw new TypeError;return Ht}}function ri(Oe){var $e=ra(Oe,we);if(!Vn($e))throw new TypeError;var Ht=$e.call(Oe);if(!wn(Ht))throw new TypeError;return Ht}function Et(Oe){return Oe.value}function de(Oe){var $e=Oe.next();return $e.done?!1:$e}function V(Oe){var $e=Oe.return;$e&&$e.call(Oe)}function X(Oe){var $e=Object.getPrototypeOf(Oe);if(typeof Oe!="function"||Oe===Je||$e!==Je)return $e;var Ht=Oe.prototype,or=Ht&&Object.getPrototypeOf(Ht);if(or==null||or===Object.prototype)return $e;var pr=or.constructor;return typeof pr!="function"||pr===Oe?$e:pr}function k(){var Oe={},$e=[],Ht=function(){function Qr(en,Dr,Wn){this._index=0,this._keys=en,this._values=Dr,this._selector=Wn}return Qr.prototype["@@iterator"]=function(){return this},Qr.prototype[we]=function(){return this},Qr.prototype.next=function(){var en=this._index;if(en>=0&&en<this._keys.length){var Dr=this._selector(this._keys[en],this._values[en]);return en+1>=this._keys.length?(this._index=-1,this._keys=$e,this._values=$e):this._index++,{value:Dr,done:!1}}return{value:void 0,done:!0}},Qr.prototype.throw=function(en){throw this._index>=0&&(this._index=-1,this._keys=$e,this._values=$e),en},Qr.prototype.return=function(en){return this._index>=0&&(this._index=-1,this._keys=$e,this._values=$e),{value:en,done:!0}},Qr}();return function(){function Qr(){this._keys=[],this._values=[],this._cacheKey=Oe,this._cacheIndex=-2}return Object.defineProperty(Qr.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Qr.prototype.has=function(en){return this._find(en,!1)>=0},Qr.prototype.get=function(en){var Dr=this._find(en,!1);return Dr>=0?this._values[Dr]:void 0},Qr.prototype.set=function(en,Dr){var Wn=this._find(en,!0);return this._values[Wn]=Dr,this},Qr.prototype.delete=function(en){var Dr=this._find(en,!1);if(Dr>=0){for(var Wn=this._keys.length,qn=Dr+1;qn<Wn;qn++)this._keys[qn-1]=this._keys[qn],this._values[qn-1]=this._values[qn];return this._keys.length--,this._values.length--,en===this._cacheKey&&(this._cacheKey=Oe,this._cacheIndex=-2),!0}return!1},Qr.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Oe,this._cacheIndex=-2},Qr.prototype.keys=function(){return new Ht(this._keys,this._values,or)},Qr.prototype.values=function(){return new Ht(this._keys,this._values,pr)},Qr.prototype.entries=function(){return new Ht(this._keys,this._values,xr)},Qr.prototype["@@iterator"]=function(){return this.entries()},Qr.prototype[we]=function(){return this.entries()},Qr.prototype._find=function(en,Dr){return this._cacheKey!==en&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=en)),this._cacheIndex<0&&Dr&&(this._cacheIndex=this._keys.length,this._keys.push(en),this._values.push(void 0)),this._cacheIndex},Qr}();function or(Qr,en){return Qr}function pr(Qr,en){return en}function xr(Qr,en){return[Qr,en]}}function Ce(){return function(){function Oe(){this._map=new _t}return Object.defineProperty(Oe.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Oe.prototype.has=function($e){return this._map.has($e)},Oe.prototype.add=function($e){return this._map.set($e,$e),this},Oe.prototype.delete=function($e){return this._map.delete($e)},Oe.prototype.clear=function(){this._map.clear()},Oe.prototype.keys=function(){return this._map.keys()},Oe.prototype.values=function(){return this._map.values()},Oe.prototype.entries=function(){return this._map.entries()},Oe.prototype["@@iterator"]=function(){return this.keys()},Oe.prototype[we]=function(){return this.keys()},Oe}()}function et(){var Oe=16,$e=Ne.create(),Ht=or();return function(){function Dr(){this._key=or()}return Dr.prototype.has=function(Wn){var qn=pr(Wn,!1);return qn!==void 0?Ne.has(qn,this._key):!1},Dr.prototype.get=function(Wn){var qn=pr(Wn,!1);return qn!==void 0?Ne.get(qn,this._key):void 0},Dr.prototype.set=function(Wn,qn){var ta=pr(Wn,!0);return ta[this._key]=qn,this},Dr.prototype.delete=function(Wn){var qn=pr(Wn,!1);return qn!==void 0?delete qn[this._key]:!1},Dr.prototype.clear=function(){this._key=or()},Dr}();function or(){var Dr;do Dr="@@WeakMap@@"+en();while(Ne.has($e,Dr));return $e[Dr]=!0,Dr}function pr(Dr,Wn){if(!N.call(Dr,Ht)){if(!Wn)return;Object.defineProperty(Dr,Ht,{value:Ne.create()})}return Dr[Ht]}function xr(Dr,Wn){for(var qn=0;qn<Wn;++qn)Dr[qn]=Math.random()*255|0;return Dr}function Qr(Dr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Dr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Dr)):xr(new Uint8Array(Dr),Dr):xr(new Array(Dr),Dr)}function en(){var Dr=Qr(Oe);Dr[6]=Dr[6]&79|64,Dr[8]=Dr[8]&191|128;for(var Wn="",qn=0;qn<Oe;++qn){var ta=Dr[qn];(qn===4||qn===6||qn===8)&&(Wn+="-"),ta<16&&(Wn+="0"),Wn+=ta.toString(16).toLowerCase()}return Wn}}function Qt(Oe){return Oe.__=void 0,delete Oe.__,Oe}})})(Y||(Y={}))},69848:function(It){(function(ie,F){It.exports=F()})(this,function(){"use strict";function ie(At,nt,Zt,ut,nr,Mr){if(!(nr-ut<=Zt)){var q=ut+nr>>1;F(At,nt,q,ut,nr,Mr%2),ie(At,nt,Zt,ut,q-1,Mr+1),ie(At,nt,Zt,q+1,nr,Mr+1)}}function F(At,nt,Zt,ut,nr,Mr){for(;nr>ut;){if(nr-ut>600){var q=nr-ut+1,pe=Zt-ut+1,b=Math.log(q),le=.5*Math.exp(2*b/3),xe=.5*Math.sqrt(b*le*(q-le)/q)*(pe-q/2<0?-1:1),Qe=Math.max(ut,Math.floor(Zt-pe*le/q+xe)),xt=Math.min(nr,Math.floor(Zt+(q-pe)*le/q+xe));F(At,nt,Zt,Qe,xt,Mr)}var Bt=nt[2*Zt+Mr],Fe=ut,bt=nr;for(J(At,nt,ut,Zt),nt[2*nr+Mr]>Bt&&J(At,nt,ut,nr);Fe<bt;){for(J(At,nt,Fe,bt),Fe++,bt--;nt[2*Fe+Mr]<Bt;)Fe++;for(;nt[2*bt+Mr]>Bt;)bt--}nt[2*ut+Mr]===Bt?J(At,nt,ut,bt):(bt++,J(At,nt,bt,nr)),bt<=Zt&&(ut=bt+1),Zt<=bt&&(nr=bt-1)}}function J(At,nt,Zt,ut){Y(At,Zt,ut),Y(nt,2*Zt,2*ut),Y(nt,2*Zt+1,2*ut+1)}function Y(At,nt,Zt){var ut=At[nt];At[nt]=At[Zt],At[Zt]=ut}function g(At,nt,Zt,ut,nr,Mr,q){for(var pe=[0,At.length-1,0],b=[],le,xe;pe.length;){var Qe=pe.pop(),xt=pe.pop(),Bt=pe.pop();if(xt-Bt<=q){for(var Fe=Bt;Fe<=xt;Fe++)le=nt[2*Fe],xe=nt[2*Fe+1],le>=Zt&&le<=nr&&xe>=ut&&xe<=Mr&&b.push(At[Fe]);continue}var bt=Math.floor((Bt+xt)/2);le=nt[2*bt],xe=nt[2*bt+1],le>=Zt&&le<=nr&&xe>=ut&&xe<=Mr&&b.push(At[bt]);var br=(Qe+1)%2;(Qe===0?Zt<=le:ut<=xe)&&(pe.push(Bt),pe.push(bt-1),pe.push(br)),(Qe===0?nr>=le:Mr>=xe)&&(pe.push(bt+1),pe.push(xt),pe.push(br))}return b}function fe(At,nt,Zt,ut,nr,Mr){for(var q=[0,At.length-1,0],pe=[],b=nr*nr;q.length;){var le=q.pop(),xe=q.pop(),Qe=q.pop();if(xe-Qe<=Mr){for(var xt=Qe;xt<=xe;xt++)N(nt[2*xt],nt[2*xt+1],Zt,ut)<=b&&pe.push(At[xt]);continue}var Bt=Math.floor((Qe+xe)/2),Fe=nt[2*Bt],bt=nt[2*Bt+1];N(Fe,bt,Zt,ut)<=b&&pe.push(At[Bt]);var br=(le+1)%2;(le===0?Zt-nr<=Fe:ut-nr<=bt)&&(q.push(Qe),q.push(Bt-1),q.push(br)),(le===0?Zt+nr>=Fe:ut+nr>=bt)&&(q.push(Bt+1),q.push(xe),q.push(br))}return pe}function N(At,nt,Zt,ut){var nr=At-Zt,Mr=nt-ut;return nr*nr+Mr*Mr}var oe=function(At){return At[0]},ne=function(At){return At[1]},we=function(nt,Zt,ut,nr,Mr){Zt===void 0&&(Zt=oe),ut===void 0&&(ut=ne),nr===void 0&&(nr=64),Mr===void 0&&(Mr=Float64Array),this.nodeSize=nr,this.points=nt;for(var q=nt.length<65536?Uint16Array:Uint32Array,pe=this.ids=new q(nt.length),b=this.coords=new Mr(nt.length*2),le=0;le<nt.length;le++)pe[le]=le,b[2*le]=Zt(nt[le]),b[2*le+1]=ut(nt[le]);ie(pe,b,nr,0,pe.length-1,0)};we.prototype.range=function(nt,Zt,ut,nr){return g(this.ids,this.coords,nt,Zt,ut,nr,this.nodeSize)},we.prototype.within=function(nt,Zt,ut){return fe(this.ids,this.coords,nt,Zt,ut,this.nodeSize)};var re={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(At){return At}},ke=Math.fround||function(At){return function(nt){return At[0]=+nt,At[0]}}(new Float32Array(1)),Ve=function(nt){this.options=Vt(Object.create(re),nt),this.trees=new Array(this.options.maxZoom+1)};Ve.prototype.load=function(nt){var Zt=this.options,ut=Zt.log,nr=Zt.minZoom,Mr=Zt.maxZoom,q=Zt.nodeSize;ut&&console.time("total time");var pe="prepare "+nt.length+" points";ut&&console.time(pe),this.points=nt;for(var b=[],le=0;le<nt.length;le++)!nt[le].geometry||b.push(Je(nt[le],le));this.trees[Mr+1]=new we(b,ee,rr,q,Float32Array),ut&&console.timeEnd(pe);for(var xe=Mr;xe>=nr;xe--){var Qe=+Date.now();b=this._cluster(b,xe),this.trees[xe]=new we(b,ee,rr,q,Float32Array),ut&&console.log("z%d: %d clusters in %dms",xe,b.length,+Date.now()-Qe)}return ut&&console.timeEnd("total time"),this},Ve.prototype.getClusters=function(nt,Zt){var ut=((nt[0]+180)%360+360)%360-180,nr=Math.max(-90,Math.min(90,nt[1])),Mr=nt[2]===180?180:((nt[2]+180)%360+360)%360-180,q=Math.max(-90,Math.min(90,nt[3]));if(nt[2]-nt[0]>=360)ut=-180,Mr=180;else if(ut>Mr){var pe=this.getClusters([ut,nr,180,q],Zt),b=this.getClusters([-180,nr,Mr,q],Zt);return pe.concat(b)}for(var le=this.trees[this._limitZoom(Zt)],xe=le.range(Ut(ut),Tt(q),Ut(Mr),Tt(nr)),Qe=[],xt=0,Bt=xe;xt<Bt.length;xt+=1){var Fe=Bt[xt],bt=le.points[Fe];Qe.push(bt.numPoints?Jt(bt):this.points[bt.index])}return Qe},Ve.prototype.getChildren=function(nt){var Zt=this._getOriginId(nt),ut=this._getOriginZoom(nt),nr="No cluster with the specified id.",Mr=this.trees[ut];if(!Mr)throw new Error(nr);var q=Mr.points[Zt];if(!q)throw new Error(nr);for(var pe=this.options.radius/(this.options.extent*Math.pow(2,ut-1)),b=Mr.within(q.x,q.y,pe),le=[],xe=0,Qe=b;xe<Qe.length;xe+=1){var xt=Qe[xe],Bt=Mr.points[xt];Bt.parentId===nt&&le.push(Bt.numPoints?Jt(Bt):this.points[Bt.index])}if(le.length===0)throw new Error(nr);return le},Ve.prototype.getLeaves=function(nt,Zt,ut){Zt=Zt||10,ut=ut||0;var nr=[];return this._appendLeaves(nr,nt,Zt,ut,0),nr},Ve.prototype.getTile=function(nt,Zt,ut){var nr=this.trees[this._limitZoom(nt)],Mr=Math.pow(2,nt),q=this.options,pe=q.extent,b=q.radius,le=b/pe,xe=(ut-le)/Mr,Qe=(ut+1+le)/Mr,xt={features:[]};return this._addTileFeatures(nr.range((Zt-le)/Mr,xe,(Zt+1+le)/Mr,Qe),nr.points,Zt,ut,Mr,xt),Zt===0&&this._addTileFeatures(nr.range(1-le/Mr,xe,1,Qe),nr.points,Mr,ut,Mr,xt),Zt===Mr-1&&this._addTileFeatures(nr.range(0,xe,le/Mr,Qe),nr.points,-1,ut,Mr,xt),xt.features.length?xt:null},Ve.prototype.getClusterExpansionZoom=function(nt){for(var Zt=this._getOriginZoom(nt)-1;Zt<=this.options.maxZoom;){var ut=this.getChildren(nt);if(Zt++,ut.length!==1)break;nt=ut[0].properties.cluster_id}return Zt},Ve.prototype._appendLeaves=function(nt,Zt,ut,nr,Mr){for(var q=this.getChildren(Zt),pe=0,b=q;pe<b.length;pe+=1){var le=b[pe],xe=le.properties;if(xe&&xe.cluster?Mr+xe.point_count<=nr?Mr+=xe.point_count:Mr=this._appendLeaves(nt,xe.cluster_id,ut,nr,Mr):Mr<nr?Mr++:nt.push(le),nt.length===ut)break}return Mr},Ve.prototype._addTileFeatures=function(nt,Zt,ut,nr,Mr,q){for(var pe=0,b=nt;pe<b.length;pe+=1){var le=b[pe],xe=Zt[le],Qe=xe.numPoints,xt=void 0,Bt=void 0,Fe=void 0;if(Qe)xt=_t(xe),Bt=xe.x,Fe=xe.y;else{var bt=this.points[xe.index];xt=bt.properties,Bt=Ut(bt.geometry.coordinates[0]),Fe=Tt(bt.geometry.coordinates[1])}var br={type:1,geometry:[[Math.round(this.options.extent*(Bt*Mr-ut)),Math.round(this.options.extent*(Fe*Mr-nr))]],tags:xt},mr=void 0;Qe?mr=xe.id:this.options.generateId?mr=xe.index:this.points[xe.index].id&&(mr=this.points[xe.index].id),mr!==void 0&&(br.id=mr),q.features.push(br)}},Ve.prototype._limitZoom=function(nt){return Math.max(this.options.minZoom,Math.min(Math.floor(+nt),this.options.maxZoom+1))},Ve.prototype._cluster=function(nt,Zt){for(var ut=[],nr=this.options,Mr=nr.radius,q=nr.extent,pe=nr.reduce,b=nr.minPoints,le=Mr/(q*Math.pow(2,Zt)),xe=0;xe<nt.length;xe++){var Qe=nt[xe];if(!(Qe.zoom<=Zt)){Qe.zoom=Zt;for(var xt=this.trees[Zt+1],Bt=xt.within(Qe.x,Qe.y,le),Fe=Qe.numPoints||1,bt=Fe,br=0,mr=Bt;br<mr.length;br+=1){var An=mr[br],mn=xt.points[An];mn.zoom>Zt&&(bt+=mn.numPoints||1)}if(bt>Fe&&bt>=b){for(var wn=Qe.x*Fe,Ri=Qe.y*Fe,Qn=pe&&Fe>1?this._map(Qe,!0):null,ii=(xe<<5)+(Zt+1)+this.points.length,Vi=0,Ni=Bt;Vi<Ni.length;Vi+=1){var ai=Ni[Vi],Vn=xt.points[ai];if(!(Vn.zoom<=Zt)){Vn.zoom=Zt;var Yn=Vn.numPoints||1;wn+=Vn.x*Yn,Ri+=Vn.y*Yn,Vn.parentId=ii,pe&&(Qn||(Qn=this._map(Qe,!0)),pe(Qn,this._map(Vn)))}}Qe.parentId=ii,ut.push(Ne(wn/bt,Ri/bt,ii,bt,Qn))}else if(ut.push(Qe),bt>1)for(var Li=0,ra=Bt;Li<ra.length;Li+=1){var ri=ra[Li],Et=xt.points[ri];Et.zoom<=Zt||(Et.zoom=Zt,ut.push(Et))}}}return ut},Ve.prototype._getOriginId=function(nt){return nt-this.points.length>>5},Ve.prototype._getOriginZoom=function(nt){return(nt-this.points.length)%32},Ve.prototype._map=function(nt,Zt){if(nt.numPoints)return Zt?Vt({},nt.properties):nt.properties;var ut=this.points[nt.index].properties,nr=this.options.map(ut);return Zt&&nr===ut?Vt({},nr):nr};function Ne(At,nt,Zt,ut,nr){return{x:ke(At),y:ke(nt),zoom:Infinity,id:Zt,parentId:-1,numPoints:ut,properties:nr}}function Je(At,nt){var Zt=At.geometry.coordinates,ut=Zt[0],nr=Zt[1];return{x:ke(Ut(ut)),y:ke(Tt(nr)),zoom:Infinity,index:nt,parentId:-1}}function Jt(At){return{type:"Feature",id:At.id,properties:_t(At),geometry:{type:"Point",coordinates:[vt(At.x),pt(At.y)]}}}function _t(At){var nt=At.numPoints,Zt=nt>=1e4?Math.round(nt/1e3)+"k":nt>=1e3?Math.round(nt/100)/10+"k":nt;return Vt(Vt({},At.properties),{cluster:!0,cluster_id:At.id,point_count:nt,point_count_abbreviated:Zt})}function Ut(At){return At/360+.5}function Tt(At){var nt=Math.sin(At*Math.PI/180),Zt=.5-.25*Math.log((1+nt)/(1-nt))/Math.PI;return Zt<0?0:Zt>1?1:Zt}function vt(At){return(At-.5)*360}function pt(At){var nt=(180-At*360)*Math.PI/180;return 360*Math.atan(Math.exp(nt))/Math.PI-90}function Vt(At,nt){for(var Zt in nt)At[Zt]=nt[Zt];return At}function ee(At){return At.x}function rr(At){return At.y}return Ve})},75752:function(It){It.exports.RADIUS=6378137,It.exports.FLATTENING=1/298.257223563,It.exports.POLAR_RADIUS=63567523142e-4}}]);
